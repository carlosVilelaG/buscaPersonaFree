(self.webpackChunkbuscaPersonaFree=self.webpackChunkbuscaPersonaFree||[]).push([[179],{406:(Ht,$t,_e)=>{"use strict";var dt=_e(564),ze=_e(498),u="\n  ",Q={};function Me(At){var he=Array.isArray(At);return function(Ue){var Re=Pe(Q.plainArray,Ue);if(Re)return Re;if(he&&Ue.length!==At.length)return"an array with "+At.length+" items";for(var it=0;it<Ue.length;it++)if(Re=Pe(he?At[it]:At,Ue[it]))return[it].concat(Re)}}function Pe(At,he){if(null!=he||At.hasOwnProperty("__required")){var Ye=At(he);if(Ye)return Array.isArray(Ye)?Ye:[Ye]}}function Se(At,he){var Ye=At.length,_t=At[Ye-1],Ue=At.slice(0,Ye-1);return 0===Ue.length&&(Ue=["value"]),he=ze(he,{path:Ue}),"function"==typeof _t?_t(he):Ft(he,function pt(At){return"must be "+function Zt(At){return/^an? /.test(At)?At:/^[aeiou]/i.test(At)?"an "+At:/^[a-z]/i.test(At)?"a "+At:At}(At)+"."}(_t))}function Ft(At,he){return(Ct(At.path)?"Item at position ":"")+At.path.join(".")+" "+he}function Ct(At){return"number"==typeof At[At.length-1]||"number"==typeof At[0]}Q.assert=function(At,he){return he=he||{},function(Ye){var _t=Pe(At,Ye);if(_t){var Ue=Se(_t,he);throw he.apiName&&(Ue=he.apiName+": "+Ue),new Error(Ue)}}},Q.shape=function(he){var Ye=function Lt(At){return Object.keys(At||{}).map(function(he){return{key:he,value:At[he]}})}(he);return function(Ue){var Re=Pe(Q.plainObject,Ue);if(Re)return Re;for(var it,Pt=[],Gt=0;Gt<Ye.length;Gt++)(Re=Pe(Ye[Gt].value,Ue[it=Ye[Gt].key]))&&Pt.push([it].concat(Re));return Pt.length<2?Pt[0]:function(It){Pt=Pt.map(function(Ui){return"- "+Ui[0]+": "+Se(Ui,It).split("\n").join(u)});var En=It.path.join(".");return"The following properties"+("value"===En?"":" of "+En)+" have invalid values:"+u+Pt.join(u)}}},Q.strictShape=function(he){var Ye=Q.shape(he);return function(Ue){var Re=Ye(Ue);if(Re)return Re;var it=Object.keys(Ue).reduce(function(Oe,Pt){return void 0===he[Pt]&&Oe.push(Pt),Oe},[]);return 0!==it.length?function(){return"The following keys are invalid: "+it.join(", ")}:void 0}},Q.arrayOf=function(he){return Me(he)},Q.tuple=function(){return Me(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},Q.required=function(he){function Ye(_t){return null==_t?function(Ue){return Ft(Ue,Ct(Ue.path)?"cannot be undefined/null.":"is required.")}:he.apply(this,arguments)}return Ye.__required=!0,Ye},Q.oneOfType=function(){var he=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(_t){var Ue=he.map(function(Re){return Pe(Re,_t)}).filter(Boolean);if(Ue.length===he.length)return Ue.every(function(Re){return 1===Re.length&&"string"==typeof Re[0]})?function Ae(At){return At.length<2?At[0]:2===At.length?At.join(" or "):At.slice(0,-1).join(", ")+", or "+At.slice(-1)}(Ue.map(function(Re){return Re[0]})):Ue.reduce(function(Re,it){return it.length>Re.length?it:Re})}},Q.equal=function(he){return function(_t){if(_t!==he)return JSON.stringify(he)}},Q.oneOf=function(){var Ye=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(_t){return Q.equal(_t)});return Q.oneOfType.apply(this,Ye)},Q.range=function(he){var Ye=he[0],_t=he[1];return function(Re){if(Pe(Q.number,Re)||Re<Ye||Re>_t)return"number between "+Ye+" & "+_t+" (inclusive)"}},Q.any=function(){},Q.boolean=function(he){if("boolean"!=typeof he)return"boolean"},Q.number=function(he){if("number"!=typeof he)return"number"},Q.plainArray=function(he){if(!Array.isArray(he))return"array"},Q.plainObject=function(he){if(!dt(he))return"object"},Q.string=function(he){if("string"!=typeof he)return"string"},Q.func=function(he){if("function"!=typeof he)return"function"},Q.validate=Pe,Q.processMessage=Se,Ht.exports=Q},564:Ht=>{"use strict";var $t=Object.prototype.toString;Ht.exports=function(_e){var dt;return"[object Object]"===$t.call(_e)&&(null===(dt=Object.getPrototypeOf(_e))||dt===Object.getPrototypeOf({}))}},805:(Ht,$t,_e)=>{"use strict";var dt=_e(630).x0;function ze(Te){this.origin=Te.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=Te.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=Te,this.send=this.send.bind(this),this.countries=Te.countries?Te.countries.split(","):null,this.types=Te.types?Te.types.split(","):null,this.bbox=Te.bbox?Te.bbox:null,this.language=Te.language?Te.language.split(","):null,this.limit=Te.limit?+Te.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(Te),this.eventQueue=new Array,this.flushInterval=Te.flushInterval||1e3,this.maxQueueSize=Te.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}ze.prototype={select:function(Te,u){var Q=this.getSelectedIndex(Te,u),Me=this.getEventPayload("search.select",u);if(Me.resultIndex=Q,Me.resultPlaceName=Te.place_name,Me.resultId=Te.id,(Q!==this.lastSentIndex||Me.queryString!==this.lastSentInput)&&-1!=Q&&(this.lastSentIndex=Q,this.lastSentInput=Me.queryString,Me.queryString))return this.push(Me)},start:function(Te){var u=this.getEventPayload("search.start",Te);if(u.queryString)return this.push(u)},keyevent:function(Te,u){if(Te.key&&!Te.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(Te.keyCode)){var Q=this.getEventPayload("search.keystroke",u);if(Q.lastAction=Te.key,Q.queryString)return this.push(Q)}},send:function(Te,u){if(!this.enableEventLogging)return u?u():void 0;var Q=this.getRequestOptions(Te);this.request(Q,function(Me){return Me?this.handleError(Me,u):u?u():void 0}.bind(this))},getRequestOptions:function(Te){return Array.isArray(Te)||(Te=[Te]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(Te)}},getEventPayload:function(Te,u){var Q;Q=u.options.proximity?"object"==typeof u.options.proximity?[u.options.proximity.longitude,u.options.proximity.latitude]:"ip"===u.options.proximity?[999,999]:u.options.proximity:null;var Me=u._map?u._map.getZoom():void 0,Pe={event:Te,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:u.options.autocomplete,fuzzyMatch:u.options.fuzzyMatch,proximity:Q,limit:u.options.limit,routing:u.options.routing,worldview:u.options.worldview,mapZoom:Me,keyboardLocale:this.locale};return Pe.queryString="search.select"===Te?u.inputString:"search.select"!=Te&&u._inputEl?u._inputEl.value:u.inputString,Pe},request:function(Te,u){var Q=new XMLHttpRequest;for(var Me in Q.onreadystatechange=function(){if(4==this.readyState)return u(204==this.status?null:this.statusText)},Q.open(Te.method,Te.host+"/"+Te.path,!0),Te.headers)Q.setRequestHeader(Me,Te.headers[Me]);Q.send(Te.body)},handleError:function(Te,u){if(u)return u(Te)},generateSessionID:function(){return dt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(Te,u){if(u._typeahead){var Me=Te.id;return u._typeahead.data.map(function(Ae){return Ae.id}).indexOf(Me)}},shouldEnableLogging:function(Te){return!(!1===Te.enableEventLogging||Te.origin&&"https://api.mapbox.com"!==Te.origin||Te.localGeocoder||Te.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(Te,u){this.eventQueue.push(Te),(this.eventQueue.length>=this.maxQueueSize||u)&&this.flush()},remove:function(){this.flush()}},Ht.exports=ze},280:Ht=>{Ht.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},272:Ht=>{function $t(){}$t.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const _e={enableHighAccuracy:!0};return new Promise(function(dt,ze){window.navigator.geolocation.getCurrentPosition(dt,ze,_e)})}},Ht.exports=$t},904:(Ht,$t,_e)=>{"use strict";var dt=_e(28),ze=_e(220),Te=_e(498),u=_e(16).EventEmitter,Q=_e(280),Me=_e(658),Pe=_e(725),Se=_e(805),Ae=_e(251),pt=_e(681),Zt=_e(272),Ft=_e(485);function At(he){this._eventEmitter=new u,this.options=Te({},this.options,he),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Zt}At.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(he){return he.place_name},render:function(he){var Ye=he.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Ye[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Ye.splice(1,Ye.length).join(",")+"</div></div>"}},addTo:function(he){function Ye(_t,Ue){if(!document.body.contains(Ue))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const Re=_t.onAdd();Ue.appendChild(Re)}if(he._controlContainer)he.addControl(this);else if(he instanceof HTMLElement)Ye(this,he);else{if("string"!=typeof he)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const _t=document.querySelectorAll(he);if(0===_t.length)throw new Error("Element ",he,"not found.");if(_t.length>1)throw new Error("Geocoder can only be added to a single html element");Ye(this,_t[0])}}},onAdd:function(he){if(he&&"string"!=typeof he&&(this._map=he),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Pe(Me({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Se(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var Ye=this.container=document.createElement("div");Ye.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var _t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",ze(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(It){this.eventManager.keyevent(It,this)}.bind(this));var Ue=document.createElement("div");Ue.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var Re=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(Re),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Ue.appendChild(this._clearEl),Ue.appendChild(this._loadingEl),Ye.appendChild(_t),Ye.appendChild(this._inputEl),Ye.appendChild(Ue),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var it=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(it),Ue.appendChild(this._geolocateEl),this._showGeolocateButton()}var Oe=this._typeahead=new dt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Oe.getItemValue=this.options.getItemValue;var Pt=Oe.list.draw,Gt=this._footerNode=function Lt(){var he=document.createElement("div");return he.className="mapboxgl-ctrl-geocoder--powered-by",he.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',he}();return Oe.list.draw=function(){Pt.call(this),Gt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Gt.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(Gt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Ye},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(he){this._hideLoadingIcon();const Ye={geometry:{type:"Point",coordinates:[he.coords.longitude,he.coords.latitude]}};this._handleMarker(Ye),this._fly(Ye),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(Ye),this._showClearButton(),this.fresh=!1;const _t={limit:1,language:[this.options.language],query:Ye.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(Ye.geometry.coordinates[0]+","+Ye.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:Ye})):this.geocoderService.reverseGeocode(_t).send().then(function(Ue){const Re=Ue.body.features[0];if(Re){const it=Ft.transformFeatureToGeolocationText(Re,this.options.addressAccuracy);this._setInputValue(it),Re.user_coordinates=Ye.geometry.coordinates,this._eventEmitter.emit("result",{result:Re})}else this._eventEmitter.emit("result",{result:{user_coordinates:Ye.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(he){1===he.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(he,Ye){var _t=document.createElementNS("http://www.w3.org/2000/svg","svg");return _t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+he),_t.setAttribute("viewBox","0 0 18 18"),_t.setAttribute("xml:space","preserve"),_t.setAttribute("width",18),_t.setAttribute("height",18),_t.innerHTML=Ye,_t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(he){this._inputEl.value=he,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(he){var Ye=(he.clipboardData||window.clipboardData).getData("text");Ye.length>=this.options.minLength&&this._geocode(Ye)},_onKeyDown:function(he){var Ye=27,_t=9;if(he.keyCode===Ye&&this.options.clearAndBlurOnEsc)return this._clear(he),this._inputEl.blur();var Ue=he.target&&he.target.shadowRoot?he.target.shadowRoot.activeElement:he.target;if(!Ue||!Ue.value)return this.fresh=!0,he.keyCode!==_t&&this.clear(he),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!he.metaKey&&-1===[_t,Ye,37,39,13,38,40].indexOf(he.keyCode)&&Ue.value.length>=this.options.minLength&&this._geocode(Ue.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(he){this.options.clearOnBlur&&this._clearOnBlur(he),this.options.collapsed&&this._collapse()},_onChange:function(){var he=this._typeahead.selected;he&&JSON.stringify(he)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(he),this.options.marker&&this._mapboxgl&&this._handleMarker(he),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(he),this._eventEmitter.emit("result",{result:he}),this.eventManager.select(he,this))},_fly:function(he){var Ye;if(he.properties&&Q[he.properties.short_code])Ye=Te({},this.options.flyTo),this._map&&this._map.fitBounds(Q[he.properties.short_code].bbox,Ye);else if(he.bbox){var _t=he.bbox;Ye=Te({},this.options.flyTo),this._map&&this._map.fitBounds([[_t[0],_t[1]],[_t[2],_t[3]]],Ye)}else Ye=Te({},{zoom:this.options.zoom},this.options.flyTo),he.center?Ye.center=he.center:he.geometry&&he.geometry.type&&"Point"===he.geometry.type&&he.geometry.coordinates&&(Ye.center=he.geometry.coordinates),this._map&&this._map.flyTo(Ye)},_requestType:function(he,Ye){return he.localGeocoderOnly?1:he.reverseGeocode&&Ft.REVERSE_GEOCODE_COORD_RGX.test(Ye)?2:0},_setupConfig:function(he,Ye){const Ue=/[\s,]+/;var Re=this,it=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(Pt,Gt){return null==Re.options[Gt]||(Pt[Gt]=["countries","types","language"].indexOf(Gt)>-1?Re.options[Gt].split(Ue):Re.options[Gt],"proximity"===Gt&&"number"==typeof Re.options[Gt].longitude&&"number"==typeof Re.options[Gt].latitude&&(Pt[Gt]=[Re.options[Gt].longitude,Re.options[Gt].latitude])),Pt},{});switch(he){case 2:var Oe=Ye.split(Ue).map(function(Pt){return parseFloat(Pt,10)});Re.options.flipCoordinates||Oe.reverse(),it=Te(it,{query:Oe,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Pt){Pt in it&&delete it[Pt]});break;case 0:{const Pt=Ye.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(Pt)&&(Ye=Ye.replace(/,/g," ")),it=Te(it,{query:Ye})}}return it},_geocode:function(he){this.inputString=he,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:he});const Ye=this._requestType(this.options,he),_t=this._setupConfig(Ye,he);var Ue;switch(Ye){case 1:Ue=Promise.resolve();break;case 0:Ue=this.geocoderService.forwardGeocode(_t).send();break;case 2:Ue=this.geocoderService.reverseGeocode(_t).send()}var Re=this.options.localGeocoder&&this.options.localGeocoder(he)||[],it=[],Oe=null;return Ue.catch(function(Pt){Oe=Pt}.bind(this)).then(function(Pt){this._hideLoadingIcon();var Gt={};return Pt?"200"==Pt.statusCode&&((Gt=Pt.body).request=Pt.request,Gt.headers=Pt.headers):Gt={type:"FeatureCollection",features:[]},Gt.config=_t,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Gt.features=Gt.features?Re.concat(Gt.features):Re,this.options.externalGeocoder?(it=this.options.externalGeocoder(he,Gt.features)||Promise.resolve([])).then(function(It){return Gt.features=Gt.features?It.concat(Gt.features):It,Gt},function(){return Gt}):Gt}.bind(this)).then(function(Pt){if(Oe)throw Oe;this.options.filter&&Pt.features.length&&(Pt.features=Pt.features.filter(this.options.filter)),Pt.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",Pt),this._typeahead.update(Pt.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Pt))}.bind(this)).catch(function(Pt){this._hideLoadingIcon(),this._hideAttribution(),Re.length&&this.options.localGeocoder||it.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(Re)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:Re}),this._eventEmitter.emit("error",{error:Pt})}.bind(this)),Ue},_clear:function(he){he&&he.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(he){this._clear(he),this._inputEl.focus()},_clearOnBlur:function(he){he.relatedTarget&&this._clear(he)},_onQueryResult:function(he){var Ye=he.body;if(Ye.features.length){var _t=Ye.features[0];this._typeahead.selected=_t,this._inputEl.value=_t.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var he=this._map.getCenter().wrap();this.setProximity({longitude:he.lng,latitude:he.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(he){return this._geocode(he).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(he){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(he)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var he=this.options.language.split(",")[0],Ye=pt.language(he),_t=Ae.placeholder[Ye];if(_t)return _t}return"Search"},setInput:function(he){return this._inputEl.value=he,this._typeahead.selected=null,this._typeahead.clear(),he.length>=this.options.minLength&&this._geocode(he),this},setProximity:function(he,Ye=!0){return this.options.proximity=he,Ye&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(he){return he&&"function"==typeof he&&(this._typeahead.render=he),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(he){var Ye=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=he||this.options.language||Ye,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(he){return this.options.zoom=he,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(he){return this.options.flyTo=he,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(he){return this.placeholder=he||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(he){return this.options.bbox=he,this},getCountries:function(){return this.options.countries},setCountries:function(he){return this.options.countries=he,this},getTypes:function(){return this.options.types},setTypes:function(he){return this.options.types=he,this},getMinLength:function(){return this.options.minLength},setMinLength:function(he){return this.options.minLength=he,this._typeahead&&(this._typeahead.options.minLength=he),this},getLimit:function(){return this.options.limit},setLimit:function(he){return this.options.limit=he,this._typeahead&&(this._typeahead.options.limit=he),this},getFilter:function(){return this.options.filter},setFilter:function(he){return this.options.filter=he,this},setOrigin:function(he){return this.options.origin=he,this.geocoderService=Pe(Me({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(he){return this.options.accessToken=he,this.geocoderService=Pe(Me({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(he){return this.options.autocomplete=he,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(he){return this.options.fuzzyMatch=he,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(he){return this.options.routing=he,this},getRouting:function(){return this.options.routing},setWorldview:function(he){return this.options.worldview=he,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(he){if(this._map){this._removeMarker();var _t=Te({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(_t),he.center?this.mapMarker.setLngLat(he.center).addTo(this._map):he.geometry&&he.geometry.type&&"Point"===he.geometry.type&&he.geometry.coordinates&&this.mapMarker.setLngLat(he.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(he,Ye){return this._eventEmitter.on(he,Ye),this},off:function(he,Ye){return this._eventEmitter.removeListener(he,Ye),this.eventManager.remove(),this}},Ht.exports=At},251:Ht=>{"use strict";Ht.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},485:Ht=>{function _e(ze){const Te=ze.address||"",u=ze.text||"",Q=ze.place_name||"",Pe={address:Q.split(",")[0],houseNumber:Te,street:u,placeName:Q};return ze.context.forEach(function(Se){const Ae=Se.id.split(".")[0];Pe[Ae]=Se.text}),Pe}Ht.exports={transformFeatureToGeolocationText:function $t(ze,Te){const u=_e(ze),Q=["address","street","place","country"];if("function"==typeof Te)return Te(u);const Pe=Q.indexOf(Te);return(-1===Pe?Q:Q.slice(Pe)).reduce(function(Se,Ae){return u[Ae]?(""!==Se&&(Se+=", "),Se+u[Ae]):Se},"")},getAddressInfo:_e,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},658:(Ht,$t,_e)=>{"use strict";var dt=_e(819);Ht.exports=dt},819:(Ht,$t,_e)=>{"use strict";var dt=_e(561),ze=_e(983);function Te(Q){ze.call(this,Q)}(Te.prototype=Object.create(ze.prototype)).constructor=Te,Te.prototype.sendRequest=dt.browserSend,Te.prototype.abortRequest=dt.browserAbort,Ht.exports=function u(Q){return new Te(Q)}},561:(Ht,$t,_e)=>{"use strict";var dt=_e(896),ze=_e(43),Te=_e(889),u=_e(17),Q={};function Se(Ft){var Ct=Ft.total,Lt=Ft.loaded;return{total:Ct,transferred:Lt,percent:100*Lt/Ct}}function Ae(Ft,Ct){return new Promise(function(Lt,At){Ct.onprogress=function(_t){Ft.emitter.emit(Te.EVENT_PROGRESS_DOWNLOAD,Se(_t))};var he=Ft.file;he&&(Ct.upload.onprogress=function(_t){Ft.emitter.emit(Te.EVENT_PROGRESS_UPLOAD,Se(_t))}),Ct.onerror=function(_t){At(_t)},Ct.onabort=function(){var _t=new ze({request:Ft,type:Te.ERROR_REQUEST_ABORTED});At(_t)},Ct.onload=function(){if(delete Q[Ft.id],Ct.status<200||Ct.status>=400){var _t=new ze({request:Ft,body:Ct.response,statusCode:Ct.status});At(_t)}else Lt(Ct)};var Ye=Ft.body;"string"==typeof Ye?Ct.send(Ye):Ye?Ct.send(JSON.stringify(Ye)):he?Ct.send(he):Ct.send(),Q[Ft.id]=Ct}).then(function(Lt){return function Pe(Ft,Ct){return new dt(Ft,{body:Ct.response,headers:u(Ct.getAllResponseHeaders()),statusCode:Ct.status})}(Ft,Lt)})}function pt(Ft,Ct){var Lt=Ft.url(Ct),At=new window.XMLHttpRequest;return At.open(Ft.method,Lt),Object.keys(Ft.headers).forEach(function(he){At.setRequestHeader(he,Ft.headers[he])}),At}Ht.exports={browserAbort:function Me(Ft){var Ct=Q[Ft.id];Ct&&(Ct.abort(),delete Q[Ft.id])},sendRequestXhr:Ae,browserSend:function Zt(Ft){return Promise.resolve().then(function(){var Ct=pt(Ft,Ft.client.accessToken);return Ae(Ft,Ct)})},createRequestXhr:pt}},983:(Ht,$t,_e)=>{"use strict";var dt=_e(746),ze=_e(323),Te=_e(889);function u(Q){if(!Q||!Q.accessToken)throw new Error("Cannot create a client without an access token");dt(Q.accessToken),this.accessToken=Q.accessToken,this.origin=Q.origin||Te.API_ORIGIN}u.prototype.createRequest=function(Me){return new ze(this,Me)},Ht.exports=u},43:(Ht,$t,_e)=>{"use strict";var dt=_e(889);Ht.exports=function ze(Te){var Q,u=Te.type||dt.ERROR_HTTP;if(Te.body)try{Q=JSON.parse(Te.body)}catch{Q=Te.body}else Q=null;var Me=Te.message||null;Me||("string"==typeof Q?Me=Q:Q&&"string"==typeof Q.message?Me=Q.message:u===dt.ERROR_REQUEST_ABORTED&&(Me="Request aborted")),this.message=Me,this.type=u,this.statusCode=Te.statusCode||null,this.request=Te.request,this.body=Q}},323:(Ht,$t,_e)=>{"use strict";var dt=_e(746),ze=_e(498),Te=_e(81),u=_e(51),Q=_e(889),Me=1;function Pe(Se,Ae){if(!Se)throw new Error("MapiRequest requires a client");if(!Ae||!Ae.path||!Ae.method)throw new Error("MapiRequest requires an options object with path and method properties");var pt={};Ae.body&&(pt["content-type"]="application/json");var Zt=ze(pt,Ae.headers),Ft=Object.keys(Zt).reduce(function(Ct,Lt){return Ct[Lt.toLowerCase()]=Zt[Lt],Ct},{});this.id=Me++,this._options=Ae,this.emitter=new Te,this.client=Se,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=Ae.path,this.method=Ae.method,this.origin=Ae.origin||Se.origin,this.query=Ae.query||{},this.params=Ae.params||{},this.body=Ae.body||null,this.file=Ae.file||null,this.encoding=Ae.encoding||"utf8",this.sendFileAs=Ae.sendFileAs||null,this.headers=Ft}Pe.prototype.url=function(Ae){var pt=u.prependOrigin(this.path,this.origin);pt=u.appendQueryObject(pt,this.query);var Zt=this.params,Ft=Ae??this.client.accessToken;if(Ft){pt=u.appendQueryParam(pt,"access_token",Ft);var Ct=dt(Ft).user;Zt=ze({ownerId:Ct},Zt)}return u.interpolateRouteParams(pt,Zt)},Pe.prototype.send=function(){var Ae=this;if(Ae.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return Ae.sent=!0,Ae.client.sendRequest(Ae).then(function(pt){return Ae.response=pt,Ae.emitter.emit(Q.EVENT_RESPONSE,pt),pt},function(pt){throw Ae.error=pt,Ae.emitter.emit(Q.EVENT_ERROR,pt),pt})},Pe.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Pe.prototype.eachPage=function(Ae){var pt=this;function Zt(Lt){Ae(null,Lt,function At(){delete pt._nextPageRequest;var he=Lt.nextPage();he&&(pt._nextPageRequest=he,Ct(he))})}function Ft(Lt){Ae(Lt,null,function(){})}function Ct(Lt){Lt.send().then(Zt,Ft)}Ct(this)},Pe.prototype.clone=function(){return this._extend()},Pe.prototype._extend=function(Ae){var pt=ze(this._options,Ae);return new Pe(this.client,pt)},Ht.exports=Pe},896:(Ht,$t,_e)=>{"use strict";var dt=_e(295);function ze(Te,u){this.request=Te,this.headers=u.headers,this.rawBody=u.body,this.statusCode=u.statusCode;try{this.body=JSON.parse(u.body||"{}")}catch{this.body=u.body}this.links=dt(this.headers.link)}ze.prototype.hasNextPage=function(){return!!this.links.next},ze.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Ht.exports=ze},889:Ht=>{"use strict";Ht.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},17:Ht=>{"use strict";Ht.exports=function _e(dt){var ze={};return dt&&dt.trim().split(/[\r|\n]+/).forEach(function(Te){var u=function $t(dt){var ze=dt.indexOf(":");return{name:dt.substring(0,ze).trim().toLowerCase(),value:dt.substring(ze+1).trim()}}(Te);ze[u.name]=u.value}),ze}},295:Ht=>{"use strict";Ht.exports=function dt(ze){return ze?ze.split(/,\s*</).reduce(function(Te,u){var Q=function _e(ze){var Te=ze.match(/<?([^>]*)>(.*)/);if(!Te)return null;var u=Te[1],Q=Te[2].split(";"),Me=null,Pe=Q.reduce(function(Se,Ae){var pt=function $t(ze){var Te=ze.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return Te?{key:Te[1],value:Te[2]}:null}(Ae);return pt?"rel"===pt.key?(Me||(Me=pt.value),Se):(Se[pt.key]=pt.value,Se):Se},{});return Me?{url:u,rel:Me,params:Pe}:null}(u);return Q?(Q.rel.split(/\s+/).forEach(function(Pe){Te[Pe]||(Te[Pe]={url:Q.url,params:Q.params})}),Te):Te},{}):{}}},51:Ht=>{"use strict";function _e(Q){return Array.isArray(Q)?function $t(Q){return Q.map(encodeURIComponent).join(",")}(Q):encodeURIComponent(String(Q))}function dt(Q,Me,Pe){if(!1===Pe||null===Pe)return Q;var Se=/\?/.test(Q)?"&":"?",Ae=encodeURIComponent(Me);return void 0!==Pe&&""!==Pe&&!0!==Pe&&(Ae+="="+_e(Pe)),""+Q+Se+Ae}Ht.exports={appendQueryObject:function ze(Q,Me){if(!Me)return Q;var Pe=Q;return Object.keys(Me).forEach(function(Se){var Ae=Me[Se];void 0!==Ae&&(Array.isArray(Ae)&&(Ae=Ae.filter(function(pt){return null!=pt}).join(",")),Pe=dt(Pe,Se,Ae))}),Pe},appendQueryParam:dt,prependOrigin:function Te(Q,Me){if(!Me||"http"===Q.slice(0,4))return Q;var Pe="/"===Q[0]?"":"/";return""+Me.replace(/\/$/,"")+Pe+Q},interpolateRouteParams:function u(Q,Me){return Me?Q.replace(/\/:([a-zA-Z0-9]+)/g,function(Pe,Se){var Ae=Me[Se];if(void 0===Ae)throw new Error("Unspecified route parameter "+Se);return"/"+_e(Ae)}):Q}}},81:Ht=>{"use strict";var $t=Object.prototype.hasOwnProperty,_e="~";function dt(){}function ze(Me,Pe,Se){this.fn=Me,this.context=Pe,this.once=Se||!1}function Te(Me,Pe,Se,Ae,pt){if("function"!=typeof Se)throw new TypeError("The listener must be a function");var Zt=new ze(Se,Ae||Me,pt),Ft=_e?_e+Pe:Pe;return Me._events[Ft]?Me._events[Ft].fn?Me._events[Ft]=[Me._events[Ft],Zt]:Me._events[Ft].push(Zt):(Me._events[Ft]=Zt,Me._eventsCount++),Me}function u(Me,Pe){0==--Me._eventsCount?Me._events=new dt:delete Me._events[Pe]}function Q(){this._events=new dt,this._eventsCount=0}Object.create&&(dt.prototype=Object.create(null),(new dt).__proto__||(_e=!1)),Q.prototype.eventNames=function(){var Se,Ae,Pe=[];if(0===this._eventsCount)return Pe;for(Ae in Se=this._events)$t.call(Se,Ae)&&Pe.push(_e?Ae.slice(1):Ae);return Object.getOwnPropertySymbols?Pe.concat(Object.getOwnPropertySymbols(Se)):Pe},Q.prototype.listeners=function(Pe){var Ae=this._events[_e?_e+Pe:Pe];if(!Ae)return[];if(Ae.fn)return[Ae.fn];for(var pt=0,Zt=Ae.length,Ft=new Array(Zt);pt<Zt;pt++)Ft[pt]=Ae[pt].fn;return Ft},Q.prototype.listenerCount=function(Pe){var Ae=this._events[_e?_e+Pe:Pe];return Ae?Ae.fn?1:Ae.length:0},Q.prototype.emit=function(Pe,Se,Ae,pt,Zt,Ft){var Ct=_e?_e+Pe:Pe;if(!this._events[Ct])return!1;var he,Ye,Lt=this._events[Ct],At=arguments.length;if(Lt.fn){switch(Lt.once&&this.removeListener(Pe,Lt.fn,void 0,!0),At){case 1:return Lt.fn.call(Lt.context),!0;case 2:return Lt.fn.call(Lt.context,Se),!0;case 3:return Lt.fn.call(Lt.context,Se,Ae),!0;case 4:return Lt.fn.call(Lt.context,Se,Ae,pt),!0;case 5:return Lt.fn.call(Lt.context,Se,Ae,pt,Zt),!0;case 6:return Lt.fn.call(Lt.context,Se,Ae,pt,Zt,Ft),!0}for(Ye=1,he=new Array(At-1);Ye<At;Ye++)he[Ye-1]=arguments[Ye];Lt.fn.apply(Lt.context,he)}else{var Ue,_t=Lt.length;for(Ye=0;Ye<_t;Ye++)switch(Lt[Ye].once&&this.removeListener(Pe,Lt[Ye].fn,void 0,!0),At){case 1:Lt[Ye].fn.call(Lt[Ye].context);break;case 2:Lt[Ye].fn.call(Lt[Ye].context,Se);break;case 3:Lt[Ye].fn.call(Lt[Ye].context,Se,Ae);break;case 4:Lt[Ye].fn.call(Lt[Ye].context,Se,Ae,pt);break;default:if(!he)for(Ue=1,he=new Array(At-1);Ue<At;Ue++)he[Ue-1]=arguments[Ue];Lt[Ye].fn.apply(Lt[Ye].context,he)}}return!0},Q.prototype.on=function(Pe,Se,Ae){return Te(this,Pe,Se,Ae,!1)},Q.prototype.once=function(Pe,Se,Ae){return Te(this,Pe,Se,Ae,!0)},Q.prototype.removeListener=function(Pe,Se,Ae,pt){var Zt=_e?_e+Pe:Pe;if(!this._events[Zt])return this;if(!Se)return u(this,Zt),this;var Ft=this._events[Zt];if(Ft.fn)Ft.fn===Se&&(!pt||Ft.once)&&(!Ae||Ft.context===Ae)&&u(this,Zt);else{for(var Ct=0,Lt=[],At=Ft.length;Ct<At;Ct++)(Ft[Ct].fn!==Se||pt&&!Ft[Ct].once||Ae&&Ft[Ct].context!==Ae)&&Lt.push(Ft[Ct]);Lt.length?this._events[Zt]=1===Lt.length?Lt[0]:Lt:u(this,Zt)}return this},Q.prototype.removeAllListeners=function(Pe){var Se;return Pe?this._events[Se=_e?_e+Pe:Pe]&&u(this,Se):(this._events=new dt,this._eventsCount=0),this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.addListener=Q.prototype.on,Q.prefixed=_e,Q.EventEmitter=Q,Ht.exports=Q},725:(Ht,$t,_e)=>{"use strict";var dt=_e(498),ze=_e(253),Te=_e(160),u=_e(193),Q=_e(981),Me={},Pe=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Me.forwardGeocode=function(Se){ze.assertShape({query:ze.required(ze.string),mode:ze.oneOf("mapbox.places","mapbox.places-permanent"),countries:ze.arrayOf(ze.string),proximity:ze.oneOf(ze.coordinates,"ip"),types:ze.arrayOf(ze.oneOf(Pe)),autocomplete:ze.boolean,bbox:ze.arrayOf(ze.number),limit:ze.number,language:ze.arrayOf(ze.string),routing:ze.boolean,fuzzyMatch:ze.boolean,worldview:ze.string})(Se),Se.mode=Se.mode||"mapbox.places";var Ae=u(dt({country:Se.countries},Te(Se,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Te(Se,["mode","query"]),query:Ae})},Me.reverseGeocode=function(Se){ze.assertShape({query:ze.required(ze.coordinates),mode:ze.oneOf("mapbox.places","mapbox.places-permanent"),countries:ze.arrayOf(ze.string),types:ze.arrayOf(ze.oneOf(Pe)),bbox:ze.arrayOf(ze.number),limit:ze.number,language:ze.arrayOf(ze.string),reverseMode:ze.oneOf("distance","score"),routing:ze.boolean,worldview:ze.string})(Se),Se.mode=Se.mode||"mapbox.places";var Ae=u(dt({country:Se.countries},Te(Se,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Te(Se,["mode","query"]),query:Ae})},Ht.exports=Q(Me)},981:(Ht,$t,_e)=>{"use strict";var dt=_e(983),ze=_e(819);Ht.exports=function Te(u){return function(Q){var Me;Me=dt.prototype.isPrototypeOf(Q)?Q:ze(Q);var Pe=Object.create(u);return Pe.client=Me,Pe}}},99:Ht=>{"use strict";Ht.exports=function $t(_e,dt){return Object.keys(_e).reduce(function(ze,Te){return ze[Te]=dt(Te,_e[Te]),ze},{})}},160:Ht=>{"use strict";Ht.exports=function $t(_e,dt){var ze=function(Te,u){return-1!==dt.indexOf(Te)&&void 0!==u};return"function"==typeof dt&&(ze=dt),Object.keys(_e).filter(function(Te){return ze(Te,_e[Te])}).reduce(function(Te,u){return Te[u]=_e[u],Te},{})}},193:(Ht,$t,_e)=>{"use strict";var dt=_e(99);Ht.exports=function ze(Te){return dt(Te,function(u,Q){return"boolean"==typeof Q?JSON.stringify(Q):Q})}},253:(Ht,$t,_e)=>{"use strict";var dt=_e(498),ze=_e(406);Ht.exports=dt(ze,{file:function Te(Pe){return typeof window<"u"?Pe instanceof global.Blob||Pe instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Pe&&void 0===Pe.pipe?"Filename or Readable stream":void 0},date:function Q(Pe){var Se="date";if("boolean"==typeof Pe)return Se;try{var Ae=new Date(Pe);if(Ae.getTime&&isNaN(Ae.getTime()))return Se}catch{return Se}},coordinates:function Me(Pe){return ze.tuple(ze.number,ze.number)(Pe)},assertShape:function u(Pe,Se){return ze.assert(ze.strictShape(Pe),Se)}})},746:(Ht,$t,_e)=>{"use strict";var dt=_e(391),ze={};function Q(Me,Pe){return Object.prototype.hasOwnProperty.call(Me,Pe)}Ht.exports=function Te(Me){if(ze[Me])return ze[Me];var Pe=Me.split("."),Se=Pe[0],Ae=Pe[1];if(!Ae)throw new Error("Invalid token");var pt=function u(Me){try{return JSON.parse(dt.decode(Me))}catch{throw new Error("Invalid token")}}(Ae),Zt={usage:Se,user:pt.u};return Q(pt,"a")&&(Zt.authorization=pt.a),Q(pt,"exp")&&(Zt.expires=1e3*pt.exp),Q(pt,"iat")&&(Zt.created=1e3*pt.iat),Q(pt,"scopes")&&(Zt.scopes=pt.scopes),Q(pt,"client")&&(Zt.client=pt.client),Q(pt,"ll")&&(Zt.lastLogin=pt.ll),Q(pt,"iu")&&(Zt.impersonator=pt.iu),ze[Me]=Zt,Zt}},378:(Ht,$t,_e)=>{"use strict";var dt={};_e.r(dt),_e.d(dt,{Decoder:()=>EE,Encoder:()=>cj,PacketType:()=>Oi,protocol:()=>a2});var ze={};function Te(e){return"function"==typeof e}function u(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}_e.r(ze),_e.d(ze,{Manager:()=>Ix,Socket:()=>CE,connect:()=>Ad,default:()=>Ad,io:()=>Ad,protocol:()=>a2});const Q=u(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,l)=>`${l+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Me(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Pe{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const f of t)f.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Te(r))try{r()}catch(f){n=f instanceof Q?f.errors:[f]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const f of l)try{pt(f)}catch(y){n=n??[],y instanceof Q?n=[...n,...y.errors]:n.push(y)}}if(n)throw new Q(n)}}add(n){var t;if(n&&n!==this)if(this.closed)pt(n);else{if(n instanceof Pe){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&Me(t,n)}remove(n){const{_finalizers:t}=this;t&&Me(t,n),n instanceof Pe&&n._removeParent(this)}}Pe.EMPTY=(()=>{const e=new Pe;return e.closed=!0,e})();const Se=Pe.EMPTY;function Ae(e){return e instanceof Pe||e&&"closed"in e&&Te(e.remove)&&Te(e.add)&&Te(e.unsubscribe)}function pt(e){Te(e)?e():e.unsubscribe()}const Zt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ft={setTimeout(e,n,...t){const{delegate:r}=Ft;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Ft;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Ct(e){Ft.setTimeout(()=>{const{onUnhandledError:n}=Zt;if(!n)throw e;n(e)})}function Lt(){}const At=_t("C",void 0,void 0);function _t(e,n,t){return{kind:e,value:n,error:t}}let Ue=null;function Re(e){if(Zt.useDeprecatedSynchronousErrorHandling){const n=!Ue;if(n&&(Ue={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=Ue;if(Ue=null,t)throw r}}else e()}class Oe extends Pe{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Ae(n)&&n.add(this)):this.destination=yr}static create(n,t,r){return new En(n,t,r)}next(n){this.isStopped?jr(function Ye(e){return _t("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?jr(function he(e){return _t("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?jr(At,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Pt=Function.prototype.bind;function Gt(e,n){return Pt.call(e,n)}class It{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){Ii(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){Ii(r)}else Ii(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){Ii(t)}}}class En extends Oe{constructor(n,t,r){let l;if(super(),Te(n)||!n)l={next:n??void 0,error:t??void 0,complete:r??void 0};else{let f;this&&Zt.useDeprecatedNextContext?(f=Object.create(n),f.unsubscribe=()=>this.unsubscribe(),l={next:n.next&&Gt(n.next,f),error:n.error&&Gt(n.error,f),complete:n.complete&&Gt(n.complete,f)}):l=n}this.destination=new It(l)}}function Ii(e){Zt.useDeprecatedSynchronousErrorHandling?function it(e){Zt.useDeprecatedSynchronousErrorHandling&&Ue&&(Ue.errorThrown=!0,Ue.error=e)}(e):Ct(e)}function jr(e,n){const{onStoppedNotification:t}=Zt;t&&Ft.setTimeout(()=>t(e,n))}const yr={closed:!0,next:Lt,error:function Ui(e){throw e},complete:Lt},Cn="function"==typeof Symbol&&Symbol.observable||"@@observable";function bn(e){return e}function un(e){return 0===e.length?bn:1===e.length?e[0]:function(t){return e.reduce((r,l)=>l(r),t)}}let Mn=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,l){const f=function Ai(e){return e&&e instanceof Oe||function ji(e){return e&&Te(e.next)&&Te(e.error)&&Te(e.complete)}(e)&&Ae(e)}(t)?t:new En(t,r,l);return Re(()=>{const{operator:y,source:C}=this;f.add(y?y.call(f,C):C?this._subscribe(f):this._trySubscribe(f))}),f}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=ni(r))((l,f)=>{const y=new En({next:C=>{try{t(C)}catch(D){f(D),y.unsubscribe()}},error:f,complete:l});this.subscribe(y)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Cn](){return this}pipe(...t){return un(t)(this)}toPromise(t){return new(t=ni(t))((r,l)=>{let f;this.subscribe(y=>f=y,y=>l(y),()=>r(f))})}}return e.create=n=>new e(n),e})();function ni(e){var n;return null!==(n=e??Zt.Promise)&&void 0!==n?n:Promise}const ri=u(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Tn=(()=>{class e extends Mn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new $r(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new ri}next(t){Re(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Re(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Re(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:l,observers:f}=this;return r||l?Se:(this.currentObservers=null,f.push(t),new Pe(()=>{this.currentObservers=null,Me(f,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:l,isStopped:f}=this;r?t.error(l):f&&t.complete()}asObservable(){const t=new Mn;return t.source=this,t}}return e.create=(n,t)=>new $r(n,t),e})();class $r extends Tn{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:Se}}function li(e){return Te(e?.lift)}function ui(e){return n=>{if(li(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function sn(e,n,t,r,l){return new Jo(e,n,t,r,l)}class Jo extends Oe{constructor(n,t,r,l,f,y){super(n),this.onFinalize=f,this.shouldUnsubscribe=y,this._next=t?function(C){try{t(C)}catch(D){n.error(D)}}:super._next,this._error=l?function(C){try{l(C)}catch(D){n.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(C){n.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function Nn(e,n){return ui((t,r)=>{let l=0;t.subscribe(sn(r,f=>{r.next(e.call(n,f,l++))}))})}function eo(e){return this instanceof eo?(this.v=e,this):new eo(e)}function Za(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function fa(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(f){t[f]=e[f]&&function(y){return new Promise(function(C,D){!function l(f,y,C,D){Promise.resolve(D).then(function(O){f({value:O,done:C})},y)}(C,D,(y=e[f](y)).done,y.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Mt=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Ot(e){return Te(e?.then)}function xt(e){return Te(e[Cn])}function Rn(e){return Symbol.asyncIterator&&Te(e?.[Symbol.asyncIterator])}function Hn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Dn=function Fn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Nt(e){return Te(e?.[Dn])}function Ni(e){return function ds(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,r=t.apply(e,n||[]),f=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(oe){r[oe]&&(l[oe]=function(ve){return new Promise(function(qe,Ke){f.push([oe,ve,qe,Ke])>1||C(oe,ve)})})}function C(oe,ve){try{!function D(oe){oe.value instanceof eo?Promise.resolve(oe.value.v).then(O,$):W(f[0][2],oe)}(r[oe](ve))}catch(qe){W(f[0][3],qe)}}function O(oe){C("next",oe)}function $(oe){C("throw",oe)}function W(oe,ve){oe(ve),f.shift(),f.length&&C(f[0][0],f[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:l}=yield eo(t.read());if(l)return yield eo(void 0);yield yield eo(r)}}finally{t.releaseLock()}})}function lr(e){return Te(e?.getReader)}function wi(e){if(e instanceof Mn)return e;if(null!=e){if(xt(e))return function vr(e){return new Mn(n=>{const t=e[Cn]();if(Te(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Mt(e))return function zo(e){return new Mn(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(Ot(e))return function Ir(e){return new Mn(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,Ct)})}(e);if(Rn(e))return _a(e);if(Nt(e))return function wr(e){return new Mn(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(lr(e))return function Pd(e){return _a(Ni(e))}(e)}throw Hn(e)}function _a(e){return new Mn(n=>{(function Ch(e,n){var t,r,l,f;return function tc(e,n,t,r){return new(t||(t=Promise))(function(f,y){function C($){try{O(r.next($))}catch(W){y(W)}}function D($){try{O(r.throw($))}catch(W){y(W)}}function O($){$.done?f($.value):function l(f){return f instanceof t?f:new t(function(y){y(f)})}($.value).then(C,D)}O((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Za(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(y){l={error:y}}finally{try{r&&!r.done&&(f=t.return)&&(yield f.call(t))}finally{if(l)throw l.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Xn(e,n,t,r=0,l=!1){const f=n.schedule(function(){t(),l?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(f),!l)return f}function fr(e,n,t=1/0){return Te(n)?fr((r,l)=>Nn((f,y)=>n(r,f,l,y))(wi(e(r,l))),t):("number"==typeof n&&(t=n),ui((r,l)=>function Du(e,n,t,r,l,f,y,C){const D=[];let O=0,$=0,W=!1;const oe=()=>{W&&!D.length&&!O&&n.complete()},ve=Ke=>O<r?qe(Ke):D.push(Ke),qe=Ke=>{f&&n.next(Ke),O++;let ht=!1;wi(t(Ke,$++)).subscribe(sn(n,zt=>{l?.(zt),f?ve(zt):n.next(zt)},()=>{ht=!0},void 0,()=>{if(ht)try{for(O--;D.length&&O<r;){const zt=D.shift();y?Xn(n,y,()=>qe(zt)):qe(zt)}oe()}catch(zt){n.error(zt)}}))};return e.subscribe(sn(n,ve,()=>{W=!0,oe()})),()=>{C?.()}}(r,l,e,t)))}function ya(e=1/0){return fr(bn,e)}const to=new Mn(e=>e.complete());function nc(e){return e[e.length-1]}function va(e){return Te(nc(e))?e.pop():void 0}function fo(e){return function Mu(e){return e&&Te(e.schedule)}(nc(e))?e.pop():void 0}function Je(e,n=0){return ui((t,r)=>{t.subscribe(sn(r,l=>Xn(r,e,()=>r.next(l),n),()=>Xn(r,e,()=>r.complete(),n),l=>Xn(r,e,()=>r.error(l),n)))})}function es(e,n=0){return ui((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function Ns(e,n){if(!e)throw new Error("Iterable cannot be null");return new Mn(t=>{Xn(t,n,()=>{const r=e[Symbol.asyncIterator]();Xn(t,n,()=>{r.next().then(l=>{l.done?t.complete():t.next(l.value)})},0,!0)})})}function et(e,n){return n?function xa(e,n){if(null!=e){if(xt(e))return function Wi(e,n){return wi(e).pipe(es(n),Je(n))}(e,n);if(Mt(e))return function Qi(e,n){return new Mn(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(Ot(e))return function Ln(e,n){return wi(e).pipe(es(n),Je(n))}(e,n);if(Rn(e))return Ns(e,n);if(Nt(e))return function Do(e,n){return new Mn(t=>{let r;return Xn(t,n,()=>{r=e[Dn](),Xn(t,n,()=>{let l,f;try{({value:l,done:f}=r.next())}catch(y){return void t.error(y)}f?t.complete():t.next(l)},0,!0)}),()=>Te(r?.return)&&r.return()})}(e,n);if(lr(e))return function Wa(e,n){return Ns(Ni(e),n)}(e,n)}throw Hn(e)}(e,n):wi(e)}class fn extends Tn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function dn(...e){return et(e,fo(e))}function er(e={}){const{connector:n=(()=>new Tn),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:l=!0}=e;return f=>{let y,C,D,O=0,$=!1,W=!1;const oe=()=>{C?.unsubscribe(),C=void 0},ve=()=>{oe(),y=D=void 0,$=W=!1},qe=()=>{const Ke=y;ve(),Ke?.unsubscribe()};return ui((Ke,ht)=>{O++,!W&&!$&&oe();const zt=D=D??n();ht.add(()=>{O--,0===O&&!W&&!$&&(C=Gn(qe,l))}),zt.subscribe(ht),!y&&O>0&&(y=new En({next:lt=>zt.next(lt),error:lt=>{W=!0,oe(),C=Gn(ve,t,lt),zt.error(lt)},complete:()=>{$=!0,oe(),C=Gn(ve,r),zt.complete()}}),wi(Ke).subscribe(y))})(f)}}function Gn(e,n,...t){if(!0===n)return void e();if(!1===n)return;const r=new En({next:()=>{r.unsubscribe(),e()}});return wi(n(...t)).subscribe(r)}function $i(e,n){return ui((t,r)=>{let l=null,f=0,y=!1;const C=()=>y&&!l&&r.complete();t.subscribe(sn(r,D=>{l?.unsubscribe();let O=0;const $=f++;wi(e(D,$)).subscribe(l=sn(r,W=>r.next(n?n(D,W,$,O++):W),()=>{l=null,C()}))},()=>{y=!0,C()}))})}function Hi(e,n){return e===n}function Un(e){for(let n in e)if(e[n]===Un)return n;throw Error("Could not find renamed property on target object.")}function di(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function tr(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(tr).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Mo(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const Fs=Un({__forward_ref__:Un});function yi(e){return e.__forward_ref__=yi,e.toString=function(){return tr(this())},e}function Sn(e){return Xa(e)?e():e}function Xa(e){return"function"==typeof e&&e.hasOwnProperty(Fs)&&e.__forward_ref__===yi}function zs(e){return e&&!!e.\u0275providers}const ba="https://g.co/ng/security#xss";class Et extends Error{constructor(n,t){super(function Ar(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function an(e){return"string"==typeof e?e:null==e?"":String(e)}function Cl(e,n){throw new Et(-201,!1)}function Fr(e,n){null==e&&function Bt(e,n,t,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${t} ${r} ${n} <=Actual]`))}(n,e,null,"!=")}function on(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Rr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Vs(e){return Au(e,Dl)||Au(e,ci)}function Au(e,n){return e.hasOwnProperty(n)?e[n]:null}function Ta(e){return e&&(e.hasOwnProperty(Gr)||e.hasOwnProperty(Mh))?e[Gr]:null}const Dl=Un({\u0275prov:Un}),Gr=Un({\u0275inj:Un}),ci=Un({ngInjectableDef:Un}),Mh=Un({ngInjectorDef:Un});var jn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(jn||{});let ic;function qr(e){const n=ic;return ic=e,n}function $c(e,n,t){const r=Vs(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&jn.Optional?null:void 0!==n?n:void Cl(tr(e))}const bi=globalThis;class qt{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=on({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const js={},Al="__NG_DI_FLAG__",fs="ngTempTokenPath",Sh=/\n/gm,Uo="__source";let Ao;function zr(e){const n=Ao;return Ao=e,n}function Hc(e,n=jn.Default){if(void 0===Ao)throw new Et(-203,!1);return null===Ao?$c(e,void 0,n):Ao.get(e,n&jn.Optional?null:void 0,n)}function rn(e,n=jn.Default){return(function rc(){return ic}()||Hc)(Sn(e),n)}function Qt(e,n=jn.Default){return rn(e,$s(n))}function $s(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function is(e){const n=[];for(let t=0;t<e.length;t++){const r=Sn(e[t]);if(Array.isArray(r)){if(0===r.length)throw new Et(900,!1);let l,f=jn.Default;for(let y=0;y<r.length;y++){const C=r[y],D=jo(C);"number"==typeof D?-1===D?l=C.token:f|=D:l=C}n.push(rn(l,f))}else n.push(rn(r))}return n}function Ja(e,n){return e[Al]=n,e.prototype[Al]=n,e}function jo(e){return e[Al]}function xo(e){return{toString:e}.toString()}var Rl=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Rl||{}),pr=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(pr||{});const rs={},Qn=[],Gc=Un({\u0275cmp:Un}),Po=Un({\u0275dir:Un}),Hs=Un({\u0275pipe:Un}),Qa=Un({\u0275mod:Un}),$o=Un({\u0275fac:Un}),ms=Un({__NG_ELEMENT_ID__:Un}),qc=Un({__NG_ENV_ID__:Un});function el(e,n,t){let r=e.length;for(;;){const l=e.indexOf(n,t);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const f=n.length;if(l+f===r||e.charCodeAt(l+f)<=32)return l}t=l+1}}function Gs(e,n,t){let r=0;for(;r<t.length;){const l=t[r];if("number"==typeof l){if(0!==l)break;r++;const f=t[r++],y=t[r++],C=t[r++];e.setAttribute(n,y,C,f)}else{const f=l,y=t[++r];lc(f)?e.setProperty(n,f,y):e.setAttribute(n,f,y),r++}}return r}function qs(e){return 3===e||4===e||6===e}function lc(e){return 64===e.charCodeAt(0)}function Zs(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const l=n[r];"number"==typeof l?t=l:0===t||ku(e,t,l,null,-1===t||2===t?n[++r]:null)}}return e}function ku(e,n,t,r,l){let f=0,y=e.length;if(-1===n)y=-1;else for(;f<e.length;){const C=e[f++];if("number"==typeof C){if(C===n){y=-1;break}if(C>n){y=f-1;break}}}for(;f<e.length;){const C=e[f];if("number"==typeof C)break;if(C===t){if(null===r)return void(null!==l&&(e[f+1]=l));if(r===e[f+1])return void(e[f+2]=l)}f++,null!==r&&f++,null!==l&&f++}-1!==y&&(e.splice(y,0,n),f=y+1),e.splice(f++,0,t),null!==r&&e.splice(f++,0,r),null!==l&&e.splice(f++,0,l)}const gs="ng-template";function kd(e,n,t){let r=0,l=!0;for(;r<e.length;){let f=e[r++];if("string"==typeof f&&l){const y=e[r++];if(t&&"class"===f&&-1!==el(y.toLowerCase(),n,0))return!0}else{if(1===f){for(;r<e.length&&"string"==typeof(f=e[r++]);)if(f.toLowerCase()===n)return!0;return!1}"number"==typeof f&&(l=!1)}}return!1}function Ou(e){return 4===e.type&&e.value!==gs}function Od(e,n,t){return n===(4!==e.type||t?e.value:gs)}function Ih(e,n,t){let r=4;const l=e.attrs||[],f=function cc(e){for(let n=0;n<e.length;n++)if(qs(e[n]))return n;return e.length}(l);let y=!1;for(let C=0;C<n.length;C++){const D=n[C];if("number"!=typeof D){if(!y)if(4&r){if(r=2|1&r,""!==D&&!Od(e,D,t)||""===D&&1===n.length){if(os(r))return!1;y=!0}}else{const O=8&r?D:n[++C];if(8&r&&null!==e.attrs){if(!kd(e.attrs,O,t)){if(os(r))return!1;y=!0}continue}const W=ss(8&r?"class":D,l,Ou(e),t);if(-1===W){if(os(r))return!1;y=!0;continue}if(""!==O){let oe;oe=W>f?"":l[W+1].toLowerCase();const ve=8&r?oe:null;if(ve&&-1!==el(ve,O,0)||2&r&&O!==oe){if(os(r))return!1;y=!0}}}}else{if(!y&&!os(r)&&!os(D))return!1;if(y&&os(D))continue;y=!1,r=D|1&r}}return os(r)||y}function os(e){return 0==(1&e)}function ss(e,n,t,r){if(null===n)return-1;let l=0;if(r||!t){let f=!1;for(;l<n.length;){const y=n[l];if(y===e)return l;if(3===y||6===y)f=!0;else{if(1===y||2===y){let C=n[++l];for(;"string"==typeof C;)C=n[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=f?1:2}return-1}return function Ah(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function Sa(e,n,t=!1){for(let r=0;r<n.length;r++)if(Ih(e,n[r],t))return!0;return!1}function uc(e,n){return e?":not("+n.trim()+")":n}function io(e){let n=e[0],t=1,r=2,l="",f=!1;for(;t<e.length;){let y=e[t];if("string"==typeof y)if(2&r){const C=e[++t];l+="["+y+(C.length>0?'="'+C+'"':"")+"]"}else 8&r?l+="."+y:4&r&&(l+=" "+y);else""!==l&&!os(y)&&(n+=uc(f,l),l=""),r=y,f=f||!os(r);t++}return""!==l&&(n+=uc(f,l)),n}function mr(e){return xo(()=>{const n=Ia(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Rl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||pr.Emulated,styles:e.styles||Qn,_:null,schemas:e.schemas||null,tView:null,id:""};Aa(t);const r=e.dependencies;return t.directiveDefs=ol(r,!1),t.pipeDefs=ol(r,!0),t.id=function dc(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const l of t)n=Math.imul(31,n)+l.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function Zc(e){return ei(e)||xr(e)}function Ho(e){return null!==e}function kn(e){return xo(()=>({type:e.type,bootstrap:e.bootstrap||Qn,declarations:e.declarations||Qn,imports:e.imports||Qn,exports:e.exports||Qn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function il(e,n){if(null==e)return rs;const t={};for(const r in e)if(e.hasOwnProperty(r)){let l=e[r],f=l;Array.isArray(l)&&(f=l[1],l=l[0]),t[l]=r,n&&(n[l]=f)}return t}function An(e){return xo(()=>{const n=Ia(e);return Aa(n),n})}function ei(e){return e[Gc]||null}function xr(e){return e[Po]||null}function ir(e){return e[Hs]||null}function Zr(e,n){const t=e[Qa]||null;if(!t&&!0===n)throw new Error(`Type ${tr(e)} does not have '\u0275mod' property.`);return t}function Ia(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||rs,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Qn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:il(e.inputs,n),outputs:il(e.outputs)}}function Aa(e){e.features?.forEach(n=>n(e))}function ol(e,n){if(!e)return null;const t=n?ir:Zc;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(Ho)}const Gi=0,Xt=1,ct=2,h=3,x=4,M=5,k=6,U=7,X=8,xe=9,je=10,Le=11,bt=12,tn=13,yn=14,_n=15,Lr=16,rr=17,qi=18,Er=19,Ws=20,ys=21,Go=22,Xs=23,vs=24,ti=25,or=1,Nl=2,Wr=7,sl=9,kr=11;function Ro(e){return Array.isArray(e)&&"object"==typeof e[or]}function bo(e){return Array.isArray(e)&&!0===e[or]}function ro(e){return 0!=(4&e.flags)}function pc(e){return e.componentOffset>-1}function Nu(e){return 1==(1&e.flags)}function Ys(e){return!!e.template}function Nd(e){return 0!=(512&e[ct])}function ll(e,n){return e.hasOwnProperty($o)?e[$o]:null}let a=null,d=!1;function _(e){const n=a;return a=e,n}const b={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function I(e){if(!re(e)||e.dirty){if(!e.producerMustRecompute(e)&&!K(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function B(e){e.dirty=!0,function A(e){if(void 0===e.liveConsumerNode)return;const n=d;d=!0;try{for(const t of e.liveConsumerNode)t.dirty||B(t)}finally{d=n}}(e),e.consumerMarkedDirty?.(e)}function z(e){return e&&(e.nextProducerIndex=0),_(e)}function H(e,n){if(_(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(re(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)ne(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function K(e){G(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(I(t),r!==t.version))return!0}return!1}function te(e){if(G(e),re(e))for(let n=0;n<e.producerNode.length;n++)ne(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function ne(e,n){if(function ee(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),G(e),1===e.liveConsumerNode.length)for(let r=0;r<e.producerNode.length;r++)ne(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],l=e.liveConsumerNode[n];G(l),l.producerIndexOfThis[r]=n}}function re(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function G(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let Ie=null;const Jt=()=>{},vn=(()=>({...b,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:Jt}))();class Yn{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Wt(){return xi}function xi(e){return e.type.prototype.ngOnChanges&&(e.setInput=Ri),Pi}function Pi(){const e=po(this),n=e?.current;if(n){const t=e.previous;if(t===rs)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function Ri(e,n,t,r){const l=this.declaredInputs[t],f=po(e)||function oo(e,n){return e[Ei]=n}(e,{previous:rs,current:null}),y=f.current||(f.current={}),C=f.previous,D=C[l];y[l]=new Yn(D&&D.currentValue,n,C===rs),e[r]=n}Wt.ngInherit=!0;const Ei="__ngSimpleChanges__";function po(e){return e[Ei]||null}const fi=function(e,n,t){};function Wn(e){for(;Array.isArray(e);)e=e[Gi];return e}function Li(e,n){return Wn(n[e])}function Xi(e,n){return Wn(n[e.index])}function Fl(e,n){return e.data[n]}function Or(e,n){const t=n[e];return Ro(t)?t:t[Gi]}function bs(e,n){return null==n?null:e[n]}function Oh(e){e[rr]=0}function Cy(e){1024&e[ct]||(e[ct]|=1024,Ty(e,1))}function Km(e){1024&e[ct]&&(e[ct]&=-1025,Ty(e,-1))}function Ty(e,n){let t=e[h];if(null===t)return;t[M]+=n;let r=t;for(t=t[h];null!==t&&(1===n&&1===r[M]||-1===n&&0===r[M]);)t[M]+=n,r=t,t=t[h]}const qn={lFrame:Py(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Qm(){return qn.bindingsEnabled}function mt(){return qn.lFrame.lView}function Jn(){return qn.lFrame.tView}function Nr(){let e=My();for(;null!==e&&64===e.type;)e=e.parent;return e}function My(){return qn.lFrame.currentTNode}function Bl(e,n){const t=qn.lFrame;t.currentTNode=e,t.isParent=n}function tg(){return qn.lFrame.isParent}function as(){const e=qn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function Js(){return qn.lFrame.bindingIndex++}function Ay(e,n){const t=qn.lFrame;t.bindingIndex=t.bindingRootIndex=e,jd(n)}function jd(e){qn.lFrame.currentDirectiveIndex=e}function zh(){return qn.lFrame.currentQueryIndex}function yc(e){qn.lFrame.currentQueryIndex=e}function ig(e){const n=e[Xt];return 2===n.type?n.declTNode:1===n.type?e[k]:null}function $d(e,n,t){if(t&jn.SkipSelf){let l=n,f=e;for(;!(l=l.parent,null!==l||t&jn.Host||(l=ig(f),null===l||(f=f[yn],10&l.type))););if(null===l)return!1;n=l,e=f}const r=qn.lFrame=rg();return r.currentTNode=n,r.lView=e,!0}function up(e){const n=rg(),t=e[Xt];qn.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function rg(){const e=qn.lFrame,n=null===e?null:e.child;return null===n?Py(e):n}function Py(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function hp(){const e=qn.lFrame;return qn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const og=hp;function Bu(){const e=hp();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Lo(){return qn.lFrame.selectedIndex}function Jc(e){qn.lFrame.selectedIndex=e}function cr(){const e=qn.lFrame;return Fl(e.tView,e.selectedIndex)}let dp=!0;function ur(){return dp}function xc(e){dp=e}function Es(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const f=e.data[t].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:C,ngAfterViewInit:D,ngAfterViewChecked:O,ngOnDestroy:$}=f;y&&(e.contentHooks??=[]).push(-t,y),C&&((e.contentHooks??=[]).push(t,C),(e.contentCheckHooks??=[]).push(t,C)),D&&(e.viewHooks??=[]).push(-t,D),O&&((e.viewHooks??=[]).push(t,O),(e.viewCheckHooks??=[]).push(t,O)),null!=$&&(e.destroyHooks??=[]).push(t,$)}}function fp(e,n,t){sg(e,n,3,t)}function pp(e,n,t,r){(3&e[ct])===t&&sg(e,n,t,r)}function mp(e,n){let t=e[ct];(3&t)===n&&(t&=8191,t+=1,e[ct]=t)}function sg(e,n,t,r){const f=r??-1,y=n.length-1;let C=0;for(let D=void 0!==r?65535&e[rr]:0;D<y;D++)if("number"==typeof n[D+1]){if(C=n[D],null!=r&&C>=r)break}else n[D]<0&&(e[rr]+=65536),(C<f||-1==f)&&(Ry(e,t,n,D),e[rr]=(4294901760&e[rr])+D+2),D++}function Qc(e,n){fi(4,e,n);const t=_(null);try{n.call(e)}finally{_(t),fi(5,e,n)}}function Ry(e,n,t,r){const l=t[r]<0,f=t[r+1],C=e[l?-t[r]:t[r]];l?e[ct]>>13<e[rr]>>16&&(3&e[ct])===n&&(e[ct]+=8192,Qc(C,f)):Qc(C,f)}const Vu=-1;class Vh{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Wd(e){return e!==Vu}function so(e){return 32767&e}function Uh(e,n){let t=function lg(e){return e>>16}(e),r=n;for(;t>0;)r=r[yn],t--;return r}let Na=!0;function gp(e){const n=Na;return Na=e,n}const $h=255,ta=5;let Fa=0;const Ul={};function Xd(e,n){const t=yp(e,n);if(-1!==t)return t;const r=n[Xt];r.firstCreatePass&&(e.injectorIndex=n.length,cg(r.data,e),cg(n,null),cg(r.blueprint,null));const l=na(e,n),f=e.injectorIndex;if(Wd(l)){const y=so(l),C=Uh(l,n),D=C[Xt].data;for(let O=0;O<8;O++)n[f+O]=C[y+O]|D[y+O]}return n[f+8]=l,f}function cg(e,n){e.push(0,0,0,0,0,0,0,0,n)}function yp(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function na(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,l=n;for(;null!==l;){if(r=Uy(l),null===r)return Vu;if(t++,l=l[yn],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return Vu}function bc(e,n,t){!function _p(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(ms)&&(r=t[ms]),null==r&&(r=t[ms]=Fa++);const l=r&$h;n.data[e+(l>>ta)]|=1<<l}(e,n,t)}function ug(e,n,t){if(t&jn.Optional||void 0!==e)return e;Cl()}function zy(e,n,t,r){if(t&jn.Optional&&void 0===r&&(r=null),!(t&(jn.Self|jn.Host))){const l=e[xe],f=qr(void 0);try{return l?l.get(n,r,t&jn.Optional):$c(n,r,t&jn.Optional)}finally{qr(f)}}return ug(r,0,t)}function Yd(e,n,t,r=jn.Default,l){if(null!==e){if(2048&n[ct]&&!(r&jn.Self)){const y=function Lx(e,n,t,r,l){let f=e,y=n;for(;null!==f&&null!==y&&2048&y[ct]&&!(512&y[ct]);){const C=vp(f,y,t,r|jn.Self,Ul);if(C!==Ul)return C;let D=f.parent;if(!D){const O=y[Ws];if(O){const $=O.get(t,Ul,r);if($!==Ul)return $}D=Uy(y),y=y[yn]}f=D}return l}(e,n,t,r,Ul);if(y!==Ul)return y}const f=vp(e,n,t,r,Ul);if(f!==Ul)return f}return zy(n,t,r,l)}function vp(e,n,t,r,l){const f=function xp(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(ms)?e[ms]:void 0;return"number"==typeof n?n>=0?n&$h:Vy:n}(t);if("function"==typeof f){if(!$d(n,e,r))return r&jn.Host?ug(l,0,r):zy(n,t,r,l);try{let y;if(y=f(r),null!=y||r&jn.Optional)return y;Cl()}finally{og()}}else if("number"==typeof f){let y=null,C=yp(e,n),D=Vu,O=r&jn.Host?n[_n][k]:null;for((-1===C||r&jn.SkipSelf)&&(D=-1===C?na(e,n):n[C+8],D!==Vu&&Gh(r,!1)?(y=n[Xt],C=so(D),n=Uh(D,n)):C=-1);-1!==C;){const $=n[Xt];if(hg(f,C,$.data)){const W=Hh(C,n,t,y,r,O);if(W!==Ul)return W}D=n[C+8],D!==Vu&&Gh(r,n[Xt].data[C+8]===O)&&hg(f,C,n)?(y=$,C=so(D),n=Uh(D,n)):C=-1}}return l}function Hh(e,n,t,r,l,f){const y=n[Xt],C=y.data[e+8],$=wc(C,y,t,null==r?pc(C)&&Na:r!=y&&0!=(3&C.type),l&jn.Host&&f===C);return null!==$?ul(n,y,$,C):Ul}function wc(e,n,t,r,l){const f=e.providerIndexes,y=n.data,C=1048575&f,D=e.directiveStart,$=f>>20,oe=l?C+$:e.directiveEnd;for(let ve=r?C:C+$;ve<oe;ve++){const qe=y[ve];if(ve<D&&t===qe||ve>=D&&qe.type===t)return ve}if(l){const ve=y[D];if(ve&&Ys(ve)&&ve.type===t)return D}return null}function ul(e,n,t,r){let l=e[t];const f=n.data;if(function Ly(e){return e instanceof Vh}(l)){const y=l;y.resolving&&function Bo(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new Et(-200,`Circular dependency in DI detected for ${e}${t}`)}(function nn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():an(e)}(f[t]));const C=gp(y.canSeeViewProviders);y.resolving=!0;const O=y.injectImpl?qr(y.injectImpl):null;$d(e,r,jn.Default);try{l=e[t]=y.factory(void 0,f,e,r),n.firstCreatePass&&t>=r.directiveStart&&function qd(e,n,t){const{ngOnChanges:r,ngOnInit:l,ngDoCheck:f}=n.type.prototype;if(r){const y=xi(n);(t.preOrderHooks??=[]).push(e,y),(t.preOrderCheckHooks??=[]).push(e,y)}l&&(t.preOrderHooks??=[]).push(0-e,l),f&&((t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f))}(t,f[t],n)}finally{null!==O&&qr(O),gp(C),y.resolving=!1,og()}}return l}function hg(e,n,t){return!!(t[n+(e>>ta)]&1<<e)}function Gh(e,n){return!(e&jn.Self||e&jn.Host&&n)}class ao{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return Yd(this._tNode,this._lView,n,$s(r),t)}}function Vy(){return new ao(Nr(),mt())}function go(e){return xo(()=>{const n=e.prototype.constructor,t=n[$o]||bp(n),r=Object.prototype;let l=Object.getPrototypeOf(e.prototype).constructor;for(;l&&l!==r;){const f=l[$o]||bp(l);if(f&&f!==t)return f;l=Object.getPrototypeOf(l)}return f=>new f})}function bp(e){return Xa(e)?()=>{const n=bp(Sn(e));return n&&n()}:ll(e)}function Uy(e){const n=e[Xt],t=n.type;return 2===t?n.declTNode:1===t?e[k]:null}const ia="__parameters__";function ls(e,n,t){return xo(()=>{const r=function za(e){return function(...t){if(e){const r=e(...t);for(const l in r)this[l]=r[l]}}}(n);function l(...f){if(this instanceof l)return r.apply(this,f),this;const y=new l(...f);return C.annotation=y,C;function C(D,O,$){const W=D.hasOwnProperty(ia)?D[ia]:Object.defineProperty(D,ia,{value:[]})[ia];for(;W.length<=$;)W.push(null);return(W[$]=W[$]||[]).push(y),D}}return t&&(l.prototype=Object.create(t.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}function Cc(e,n){e.forEach(t=>Array.isArray(t)?Cc(t,n):n(t))}function Qd(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function qh(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function oa(e,n,t){let r=Hu(e,n);return r>=0?e[1|r]=t:(r=~r,function Bx(e,n,t,r){let l=e.length;if(l==n)e.push(t,r);else if(1===l)e.push(r,e[0]),e[0]=t;else{for(l--,e.push(e[l-1],e[l]);l>n;)e[l]=e[l-2],l--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function ef(e,n){const t=Hu(e,n);if(t>=0)return e[1|t]}function Hu(e,n){return function tu(e,n,t){let r=0,l=e.length>>t;for(;l!==r;){const f=r+(l-r>>1),y=e[f<<t];if(n===y)return f<<t;y>n?l=f:r=f+1}return~(l<<t)}(e,n,1)}const Tp=Ja(ls("Optional"),8),Dp=Ja(ls("SkipSelf"),4);function Qh(e){return 128==(128&e.flags)}var $l=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}($l||{});const bg=new Map;let Xx=0;const Eg="__ngContext__";function No(e,n){Ro(n)?(e[Eg]=n[Er],function Kx(e){bg.set(e[Er],e)}(n)):e[Eg]=n}let Fp;function Wu(e,n){return Fp(e,n)}function cf(e){const n=e[h];return bo(n)?n[h]:n}function Cg(e){return Dg(e[bt])}function Tg(e){return Dg(e[x])}function Dg(e){for(;null!==e&&!bo(e);)e=e[x];return e}function Xu(e,n,t,r,l){if(null!=r){let f,y=!1;bo(r)?f=r:Ro(r)&&(y=!0,r=r[Gi]);const C=Wn(r);0===e&&null!==t?null==l?Pg(n,t,C):Ku(n,t,C,l||null,!0):1===e&&null!==t?Ku(n,t,C,l||null,!0):2===e?function jp(e,n,t){const r=Up(e,n);r&&function gv(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,C,y):3===e&&n.destroyNode(C),null!=f&&function xv(e,n,t,r,l){const f=t[Wr];f!==Wn(t)&&Xu(n,e,r,f,l);for(let C=kr;C<t.length;C++){const D=t[C];pf(D[Xt],D,e,n,r,f)}}(n,e,f,t,l)}}function Yu(e,n,t){return e.createElement(n,t)}function Mg(e,n){const t=e[sl],r=t.indexOf(n);Km(n),t.splice(r,1)}function Vp(e,n){if(e.length<=kr)return;const t=kr+n,r=e[t];if(r){const l=r[Lr];null!==l&&l!==e&&Mg(l,r),n>0&&(e[t-1][x]=r[x]);const f=qh(e,kr+n);!function pv(e,n){pf(e,n,n[Le],2,null,null),n[Gi]=null,n[k]=null}(r[Xt],r);const y=f[qi];null!==y&&y.detachView(f[Xt]),r[h]=null,r[x]=null,r[ct]&=-129}return r}function Sg(e,n){if(!(256&n[ct])){const t=n[Le];n[Xs]&&te(n[Xs]),n[vs]&&te(n[vs]),t.destroyNode&&pf(e,n,t,3,null,null),function td(e){let n=e[bt];if(!n)return Ig(e[Xt],e);for(;n;){let t=null;if(Ro(n))t=n[bt];else{const r=n[kr];r&&(t=r)}if(!t){for(;n&&!n[x]&&n!==e;)Ro(n)&&Ig(n[Xt],n),n=n[h];null===n&&(n=e),Ro(n)&&Ig(n[Xt],n),t=n&&n[x]}n=t}}(n)}}function Ig(e,n){if(!(256&n[ct])){n[ct]&=-129,n[ct]|=256,function nb(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const l=n[t[r]];if(!(l instanceof Vh)){const f=t[r+1];if(Array.isArray(f))for(let y=0;y<f.length;y+=2){const C=l[f[y]],D=f[y+1];fi(4,C,D);try{D.call(C)}finally{fi(5,C,D)}}else{fi(4,l,f);try{f.call(l)}finally{fi(5,l,f)}}}}}(e,n),function tb(e,n){const t=e.cleanup,r=n[U];if(null!==t)for(let f=0;f<t.length-1;f+=2)if("string"==typeof t[f]){const y=t[f+3];y>=0?r[y]():r[-y].unsubscribe(),f+=2}else t[f].call(r[t[f+1]]);null!==r&&(n[U]=null);const l=n[ys];if(null!==l){n[ys]=null;for(let f=0;f<l.length;f++)(0,l[f])()}}(e,n),1===n[Xt].type&&n[Le].destroy();const t=n[Lr];if(null!==t&&bo(n[h])){t!==n[h]&&Mg(t,n);const r=n[qi];null!==r&&r.detachView(e)}!function Jx(e){bg.delete(e[Er])}(n)}}function Ag(e,n,t){return function df(e,n,t){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return t[Gi];{const{componentOffset:l}=r;if(l>-1){const{encapsulation:f}=e.data[r.directiveStart+l];if(f===pr.None||f===pr.Emulated)return null}return Xi(r,t)}}(e,n.parent,t)}function Ku(e,n,t,r,l){e.insertBefore(n,t,r,l)}function Pg(e,n,t){e.appendChild(n,t)}function Rg(e,n,t,r,l){null!==r?Ku(e,n,t,r,l):Pg(e,n,t)}function Up(e,n){return e.parentNode(n)}let kg,Fg,Hp,Lg=function yv(e,n,t){return 40&e.type?Xi(e,t):null};function Ts(e,n,t,r){const l=Ag(e,r,n),f=n[Le],C=function _v(e,n,t){return Lg(e,n,t)}(r.parent||n[k],r,n);if(null!=l)if(Array.isArray(t))for(let D=0;D<t.length;D++)Rg(f,l,t[D],C,!1);else Rg(f,l,t,C,!1);void 0!==kg&&kg(f,r,n,t,l)}function Ju(e,n){if(null!==n){const t=n.type;if(3&t)return Xi(n,e);if(4&t)return ru(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return Ju(e,r);{const l=e[n.index];return bo(l)?ru(-1,l):Wn(l)}}if(32&t)return Wu(n,e)()||Wn(e[n.index]);{const r=ff(e,n);return null!==r?Array.isArray(r)?r[0]:Ju(cf(e[_n]),r):Ju(e,n.next)}}return null}function ff(e,n){return null!==n?e[_n][k].projection[n.projection]:null}function ru(e,n){const t=kr+e+1;if(t<n.length){const r=n[t],l=r[Xt].firstChild;if(null!==l)return Ju(r,l)}return n[Wr]}function Qu(e,n,t,r,l,f,y){for(;null!=t;){const C=r[t.index],D=t.type;if(y&&0===n&&(C&&No(Wn(C),r),t.flags|=2),32!=(32&t.flags))if(8&D)Qu(e,n,t.child,r,l,f,!1),Xu(n,e,l,C,f);else if(32&D){const O=Wu(t,r);let $;for(;$=O();)Xu(n,e,l,$,f);Xu(n,e,l,C,f)}else 16&D?Og(e,n,r,t,l,f):Xu(n,e,l,C,f);t=y?t.projectionNext:t.next}}function pf(e,n,t,r,l,f){Qu(t,r,e.firstChild,n,l,f,!1)}function Og(e,n,t,r,l,f){const y=t[_n],D=y[k].projection[r.projection];if(Array.isArray(D))for(let O=0;O<D.length;O++)Xu(n,e,l,D[O],f);else{let O=D;const $=y[h];Qh(r)&&(O.flags|=128),Qu(e,n,O,$,l,f,!0)}}function $p(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function Ng(e,n,t){const{mergedAttrs:r,classes:l,styles:f}=t;null!==r&&Gs(e,n,r),null!==l&&$p(e,n,l),null!==f&&function zi(e,n,t){e.setAttribute(n,"style",t)}(e,n,f)}function eh(e){return function zg(){if(void 0===Hp&&(Hp=null,bi.trustedTypes))try{Hp=bi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Hp}()?.createScriptURL(e)||e}class Bg{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ba})`}}function Dc(e){return e instanceof Bg?e.changingThisBreaksApplicationSecurity:e}function th(e,n){const t=function cs(e){return e instanceof Bg&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${ba})`)}return t===n}const Tv=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var pl=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(pl||{});function Qp(e){const n=Hl();return n?n.sanitize(pl.URL,e)||"":th(e,"URL")?Dc(e):function Wp(e){return(e=String(e)).match(Tv)?e:"unsafe:"+e}(an(e))}function xf(e){const n=Hl();if(n)return eh(n.sanitize(pl.RESOURCE_URL,e)||"");if(th(e,"ResourceURL"))return eh(Dc(e));throw new Et(904,!1)}function Hl(){const e=mt();return e&&e[je].sanitizer}const ih=new qt("ENVIRONMENT_INITIALIZER"),Pv=new qt("INJECTOR",-1),Gg=new qt("INJECTOR_DEF_TYPES");class qg{get(n,t=js){if(t===js){const r=new Error(`NullInjectorError: No provider for ${tr(n)}!`);throw r.name="NullInjectorError",r}return t}}function bb(...e){return{\u0275providers:od(0,e),\u0275fromNgModule:!0}}function od(e,...n){const t=[],r=new Set;let l;const f=y=>{t.push(y)};return Cc(n,y=>{const C=y;Ef(C,f,[],r)&&(l||=[],l.push(C))}),void 0!==l&&Sc(l,f),t}function Sc(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:l}=e[t];sd(l,f=>{n(f,r)})}}function Ef(e,n,t,r){if(!(e=Sn(e)))return!1;let l=null,f=Ta(e);const y=!f&&ei(e);if(f||y){if(y&&!y.standalone)return!1;l=e}else{const D=e.ngModule;if(f=Ta(D),!f)return!1;l=D}const C=r.has(l);if(y){if(C)return!1;if(r.add(l),y.dependencies){const D="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const O of D)Ef(O,n,t,r)}}else{if(!f)return!1;{if(null!=f.imports&&!C){let O;r.add(l);try{Cc(f.imports,$=>{Ef($,n,t,r)&&(O||=[],O.push($))})}finally{}void 0!==O&&Sc(O,n)}if(!C){const O=ll(l)||(()=>new l);n({provide:l,useFactory:O,deps:Qn},l),n({provide:Gg,useValue:l,multi:!0},l),n({provide:ih,useValue:()=>rn(l),multi:!0},l)}const D=f.providers;if(null!=D&&!C){const O=e;sd(D,$=>{n($,O)})}}}return l!==e&&void 0!==e.providers}function sd(e,n){for(let t of e)zs(t)&&(t=t.\u0275providers),Array.isArray(t)?sd(t,n):n(t)}const Zg=Un({provide:String,useValue:Un});function Wg(e){return null!==e&&"object"==typeof e&&Zg in e}function rh(e){return"function"==typeof e}const Yg=new qt("Set Injector scope."),lu={},Cf={};let oh;function cu(){return void 0===oh&&(oh=new qg),oh}class Xo{}class ad extends Xo{get destroyed(){return this._destroyed}constructor(n,t,r,l){super(),this.parent=t,this.source=r,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Jg(n,y=>this.processProvider(y)),this.records.set(Pv,sh(void 0,this)),l.has("environment")&&this.records.set(Xo,sh(void 0,this));const f=this.records.get(Yg);null!=f&&"string"==typeof f.value&&this.scopes.add(f.value),this.injectorDefTypes=new Set(this.get(Gg.multi,Qn,jn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=zr(this),r=qr(void 0);try{return n()}finally{zr(t),qr(r)}}get(n,t=js,r=jn.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(qc))return n[qc](this);r=$s(r);const f=zr(this),y=qr(void 0);try{if(!(r&jn.SkipSelf)){let D=this.records.get(n);if(void 0===D){const O=function kv(e){return"function"==typeof e||"object"==typeof e&&e instanceof qt}(n)&&Vs(n);D=O&&this.injectableDefInScope(O)?sh(Kg(n),lu):null,this.records.set(n,D)}if(null!=D)return this.hydrate(n,D)}return(r&jn.Self?cu():this.parent).get(n,t=r&jn.Optional&&t===js?null:t)}catch(C){if("NullInjectorError"===C.name){if((C[fs]=C[fs]||[]).unshift(tr(n)),f)throw C;return function Pl(e,n,t,r){const l=e[fs];throw n[Uo]&&l.unshift(n[Uo]),e.message=function ps(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let l=tr(n);if(Array.isArray(n))l=n.map(tr).join(" -> ");else if("object"==typeof n){let f=[];for(let y in n)if(n.hasOwnProperty(y)){let C=n[y];f.push(y+":"+("string"==typeof C?JSON.stringify(C):tr(C)))}l=`{${f.join(", ")}}`}return`${t}${r?"("+r+")":""}[${l}]: ${e.replace(Sh,"\n  ")}`}("\n"+e.message,l,t,r),e.ngTokenPath=l,e[fs]=null,e}(C,n,"R3InjectorError",this.source)}throw C}finally{qr(y),zr(f)}}resolveInjectorInitializers(){const n=zr(this),t=qr(void 0);try{const l=this.get(ih.multi,Qn,jn.Self);for(const f of l)f()}finally{zr(n),qr(t)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(tr(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Et(205,!1)}processProvider(n){let t=rh(n=Sn(n))?n:Sn(n&&n.provide);const r=function tm(e){return Wg(e)?sh(void 0,e.useValue):sh(Rv(e),lu)}(n);if(rh(n)||!0!==n.multi)this.records.get(t);else{let l=this.records.get(t);l||(l=sh(void 0,lu,!0),l.factory=()=>is(l.multi),this.records.set(t,l)),t=n,l.multi.push(n)}this.records.set(t,r)}hydrate(n,t){return t.value===lu&&(t.value=Cf,t.value=t.factory()),"object"==typeof t.value&&t.value&&function Eb(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Sn(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Kg(e){const n=Vs(e),t=null!==n?n.factory:ll(e);if(null!==t)return t;if(e instanceof qt)throw new Et(204,!1);if(e instanceof Function)return function ld(e){const n=e.length;if(n>0)throw function Zh(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(n,"?"),new Et(204,!1);const t=function jc(e){return e&&(e[Dl]||e[ci])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new Et(204,!1)}function Rv(e,n,t){let r;if(rh(e)){const l=Sn(e);return ll(l)||Kg(l)}if(Wg(e))r=()=>Sn(e.useValue);else if(function su(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...is(e.deps||[]));else if(function Xg(e){return!(!e||!e.useExisting)}(e))r=()=>rn(Sn(e.useExisting));else{const l=Sn(e&&(e.useClass||e.provide));if(!function Lv(e){return!!e.deps}(e))return ll(l)||Kg(l);r=()=>new l(...is(e.deps))}return r}function sh(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function Jg(e,n){for(const t of e)Array.isArray(t)?Jg(t,n):t&&zs(t)?Jg(t.\u0275providers,n):n(t)}const Tf=new qt("AppId",{providedIn:"root",factory:()=>Cb}),Cb="ng",Qg=new qt("Platform Initializer"),ah=new qt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Df=new qt("CSP nonce",{providedIn:"root",factory:()=>function nd(){if(void 0!==Fg)return Fg;if(typeof document<"u")return document;throw new Et(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let o_=(e,n,t)=>null;function ql(e,n,t=!1){return o_(e,n,t)}class Fv{}class a_{}class Bv{resolveComponentFactory(n){throw function zv(e){const n=Error(`No component factory found for ${tr(e)}.`);return n.ngComponent=e,n}(n)}}let sm=(()=>{class e{static#e=this.NULL=new Bv}return e})();function Sb(){return Ic(Nr(),mt())}function Ic(e,n){return new sa(Xi(e,n))}let sa=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=Sb}return e})();function fd(e){return e instanceof sa?e.nativeElement:e}class am{}let Ua=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Zl(){const e=mt(),t=Or(Nr().index,e);return(Ro(t)?t:e)[Le]}()}return e})(),c_=(()=>{class e{static#e=this.\u0275prov=on({token:e,providedIn:"root",factory:()=>null})}return e})();class uh{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const gl=new uh("16.2.11"),Ac={};function um(e,n=null,t=null,r){const l=d_(e,n,t,r);return l.resolveInjectorInitializers(),l}function d_(e,n=null,t=null,r,l=new Set){const f=[t||Qn,bb(e)];return r=r||("object"==typeof e?void 0:tr(e)),new ad(f,n||cu(),r||null,l)}let Ds=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=js;static#t=this.NULL=new qg;static create(t,r){if(Array.isArray(t))return um({name:""},r,t,"");{const l=t.name??"";return um({name:l},t.parent,t.providers,l)}}static#n=this.\u0275prov=on({token:e,providedIn:"any",factory:()=>rn(Pv)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function Lf(e){return e.ngOriginalError}class Wl{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&Lf(n);for(;t&&Lf(t);)t=Lf(t);return t||null}}function i(e){return n=>{setTimeout(e,void 0,n)}}const s=class o extends Tn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,r){let l=n,f=t||(()=>null),y=r;if(n&&"object"==typeof n){const D=n;l=D.next?.bind(D),f=D.error?.bind(D),y=D.complete?.bind(D)}this.__isAsync&&(f=i(f),l&&(l=i(l)),y&&(y=i(y)));const C=super.subscribe({next:l,error:f,complete:y});return n instanceof Pe&&n.add(C),C}};function c(...e){}class v{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new s(!1),this.onMicrotaskEmpty=new s(!1),this.onStable=new s(!1),this.onError=new s(!1),typeof Zone>"u")throw new Et(908,!1);Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!r&&t,l.shouldCoalesceRunChangeDetection=r,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function p(){const e="function"==typeof bi.requestAnimationFrame;let n=bi[e?"requestAnimationFrame":"setTimeout"],t=bi[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const l=t[Zone.__symbol__("OriginalDelegate")];l&&(t=l)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function P(e){const n=()=>{!function S(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(bi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,N(e),e.isCheckStableRunning=!0,T(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),N(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,l,f,y,C)=>{if(function se(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(C))return t.invokeTask(l,f,y,C);try{return F(e),t.invokeTask(l,f,y,C)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||e.shouldCoalesceRunChangeDetection)&&n(),V(e)}},onInvoke:(t,r,l,f,y,C,D)=>{try{return F(e),t.invoke(l,f,y,C,D)}finally{e.shouldCoalesceRunChangeDetection&&n(),V(e)}},onHasTask:(t,r,l,f)=>{t.hasTask(l,f),r===l&&("microTask"==f.change?(e._hasPendingMicrotasks=f.microTask,N(e),T(e)):"macroTask"==f.change&&(e.hasPendingMacrotasks=f.macroTask))},onHandleError:(t,r,l,f)=>(t.handleError(l,f),e.runOutsideAngular(()=>e.onError.emit(f)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!v.isInAngularZone())throw new Et(909,!1)}static assertNotInAngularZone(){if(v.isInAngularZone())throw new Et(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,l){const f=this._inner,y=f.scheduleEventTask("NgZoneEvent: "+l,n,w,c,c);try{return f.runTask(y,t,r)}finally{f.cancelTask(y)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const w={};function T(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function N(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function F(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function V(e){e._nesting--,T(e)}class j{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new s,this.onMicrotaskEmpty=new s,this.onStable=new s,this.onError=new s}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,l){return n.apply(t,r)}}const q=new qt("",{providedIn:"root",factory:J});function J(){const e=Qt(v);let n=!0;return function gn(...e){const n=fo(e),t=function Os(e,n){return"number"==typeof nc(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?wi(r[0]):ya(t)(et(r,n)):to}(new Mn(l=>{n=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{l.next(n),l.complete()})}),new Mn(l=>{let f;e.runOutsideAngular(()=>{f=e.onStable.subscribe(()=>{v.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(n=!0,l.next(!0))})})});const y=e.onUnstable.subscribe(()=>{v.assertInAngularZone(),n&&(n=!1,e.runOutsideAngular(()=>{l.next(!1)}))});return()=>{f.unsubscribe(),y.unsubscribe()}}).pipe(er()))}function me(e){return e instanceof Function?e():e}let at=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=on({token:e,providedIn:"root",factory:()=>new e})}return e})();function ot(e){for(;e;){e[ct]|=64;const n=cf(e);if(Nd(e)&&!n)return e;e=n}return null}const Qe=new qt("",{providedIn:"root",factory:()=>!1});let On=null;function Ti(e,n){return e[n]??sr()}function ki(e,n){const t=sr();t.producerNode?.length&&(e[n]=On,t.lView=e,On=Di())}const Vi={...b,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{ot(e.lView)},lView:null};function Di(){return Object.create(Vi)}function sr(){return On??=Di(),On}const hn={};function Yt(e){Mi(Jn(),mt(),Lo()+e,!1)}function Mi(e,n,t,r){if(!r)if(3==(3&n[ct])){const f=e.preOrderCheckHooks;null!==f&&fp(n,f,t)}else{const f=e.preOrderHooks;null!==f&&pp(n,f,0,t)}Jc(t)}function nt(e,n=jn.Default){const t=mt();return null===t?rn(e,n):Yd(Nr(),t,Sn(e),n)}function si(e,n,t,r,l,f,y,C,D,O,$){const W=n.blueprint.slice();return W[Gi]=l,W[ct]=140|r,(null!==O||e&&2048&e[ct])&&(W[ct]|=2048),Oh(W),W[h]=W[yn]=e,W[X]=t,W[je]=y||e&&e[je],W[Le]=C||e&&e[Le],W[xe]=D||e&&e[xe]||null,W[k]=f,W[Er]=function Yx(){return Xx++}(),W[Go]=$,W[Ws]=O,W[_n]=2==n.type?e[_n]:W,W}function ar(e,n,t,r,l){let f=e.data[n];if(null===f)f=function Si(e,n,t,r,l){const f=My(),y=tg(),D=e.data[n]=function g_(e,n,t,r,l,f){let y=n?n.injectorIndex:-1,C=0;return function Nh(){return null!==qn.skipHydrationRootTNode}()&&(C|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:C,providerIndexes:0,value:l,attrs:f,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?f:f&&f.parent,t,n,r,l);return null===e.firstChild&&(e.firstChild=D),null!==f&&(y?null==f.child&&null!==D.parent&&(f.child=D):null===f.next&&(f.next=D,D.prev=f)),D}(e,n,t,r,l),function ws(){return qn.lFrame.inI18n}()&&(f.flags|=32);else if(64&f.type){f.type=t,f.value=r,f.attrs=l;const y=function Ud(){const e=qn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();f.injectorIndex=null===y?-1:y.injectorIndex}return Bl(f,!0),f}function co(e,n,t,r){if(0===t)return-1;const l=n.length;for(let f=0;f<t;f++)n.push(r),e.blueprint.push(r),e.data.push(null);return l}function Tr(e,n,t,r,l){const f=Ti(n,Xs),y=Lo(),C=2&r;try{Jc(-1),C&&n.length>ti&&Mi(e,n,ti,!1),fi(C?2:0,l);const O=C?f:null,$=z(O);try{null!==O&&(O.dirty=!1),t(r,l)}finally{H(O,$)}}finally{C&&null===n[Xs]&&ki(n,Xs),Jc(y),fi(C?3:1,l)}}function Yr(e,n,t){if(ro(n)){const r=_(null);try{const f=n.directiveEnd;for(let y=n.directiveStart;y<f;y++){const C=e.data[y];C.contentQueries&&C.contentQueries(1,t[y],y)}}finally{_(r)}}}function Vr(e,n,t){Qm()&&(function v_(e,n,t,r){const l=t.directiveStart,f=t.directiveEnd;pc(t)&&function g2(e,n,t){const r=Xi(n,e),l=Kr(t);let y=16;t.signals?y=4096:t.onPush&&(y=64);const C=Xv(e,si(e,l,null,y,r,n,null,e[je].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=C}(n,t,e.data[l+t.componentOffset]),e.firstCreatePass||Xd(t,n),No(r,n);const y=t.initialInputs;for(let C=l;C<f;C++){const D=e.data[C],O=ul(n,e,C,t);No(O,n),null!==y&&_2(0,C-l,O,D,0,y),Ys(D)&&(Or(t.index,n)[X]=ul(n,e,C,t))}}(e,n,t,Xi(t,n)),64==(64&t.flags)&&x_(e,n,t))}function Eo(e,n,t=Xi){const r=n.localNames;if(null!==r){let l=n.index+1;for(let f=0;f<r.length;f+=2){const y=r[f+1],C=-1===y?t(n,e):e[y];e[l++]=C}}}function Kr(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=aa(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function aa(e,n,t,r,l,f,y,C,D,O,$){const W=ti+r,oe=W+l,ve=function md(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:hn);return t}(W,oe),qe="function"==typeof O?O():O;return ve[Xt]={type:e,blueprint:ve,template:t,queries:null,viewQuery:C,declTNode:n,data:ve.slice().fill(null,W),bindingStartIndex:W,expandoStartIndex:oe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof f?f():f,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:D,consts:qe,incompleteFirstPass:!1,ssrId:$}}let m_=e=>null;function hm(e,n,t,r){for(let l in e)if(e.hasOwnProperty(l)){t=null===t?{}:t;const f=e[l];null===r?_l(t,n,l,f):r.hasOwnProperty(l)&&_l(t,n,r[l],f)}return t}function _l(e,n,t,r){e.hasOwnProperty(t)?e[t].push(n,r):e[t]=[n,r]}function us(e,n,t,r,l,f,y,C){const D=Xi(n,t);let $,O=n.inputs;!C&&null!=O&&($=O[r])?(Ob(e,t,$,r,l),pc(n)&&function __(e,n){const t=Or(n,e);16&t[ct]||(t[ct]|=64)}(t,n.index)):3&n.type&&(r=function dh(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),l=null!=y?y(l,n.value||"",r):l,f.setProperty(D,r,l))}function y_(e,n,t,r){if(Qm()){const l=null===r?null:{"":-1},f=function h2(e,n){const t=e.directiveRegistry;let r=null,l=null;if(t)for(let f=0;f<t.length;f++){const y=t[f];if(Sa(n,y.selectors,!1))if(r||(r=[]),Ys(y))if(null!==y.findHostDirectiveDefs){const C=[];l=l||new Map,y.findHostDirectiveDefs(y,C,l),r.unshift(...C,y),Rb(e,n,C.length)}else r.unshift(y),Rb(e,n,0);else l=l||new Map,y.findHostDirectiveDefs?.(y,r,l),r.push(y)}return null===r?null:[r,l]}(e,t);let y,C;null===f?y=C=null:[y,C]=f,null!==y&&hs(e,n,t,y,l,C),l&&function d2(e,n,t){if(n){const r=e.localNames=[];for(let l=0;l<n.length;l+=2){const f=t[n[l+1]];if(null==f)throw new Et(-301,!1);r.push(n[l],f)}}}(t,r,l)}t.mergedAttrs=Zs(t.mergedAttrs,t.attrs)}function hs(e,n,t,r,l,f){for(let O=0;O<r.length;O++)bc(Xd(t,n),e,r[O].type);!function p2(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let O=0;O<r.length;O++){const $=r[O];$.providersResolver&&$.providersResolver($)}let y=!1,C=!1,D=co(e,n,r.length,null);for(let O=0;O<r.length;O++){const $=r[O];t.mergedAttrs=Zs(t.mergedAttrs,$.hostAttrs),m2(e,t,n,D,$),f2(D,$,l),null!==$.contentQueries&&(t.flags|=4),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(t.flags|=64);const W=$.type.prototype;!y&&(W.ngOnChanges||W.ngOnInit||W.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),y=!0),!C&&(W.ngOnChanges||W.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),C=!0),D++}!function Zv(e,n,t){const l=n.directiveEnd,f=e.data,y=n.attrs,C=[];let D=null,O=null;for(let $=n.directiveStart;$<l;$++){const W=f[$],oe=t?t.get(W):null,qe=oe?oe.outputs:null;D=hm(W.inputs,$,D,oe?oe.inputs:null),O=hm(W.outputs,$,O,qe);const Ke=null===D||null===y||Ou(n)?null:y2(D,$,y);C.push(Ke)}null!==D&&(D.hasOwnProperty("class")&&(n.flags|=8),D.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=C,n.inputs=D,n.outputs=O}(e,t,f)}function x_(e,n,t){const r=t.directiveStart,l=t.directiveEnd,f=t.index,y=function cl(){return qn.lFrame.currentDirectiveIndex}();try{Jc(f);for(let C=r;C<l;C++){const D=e.data[C],O=n[C];jd(C),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&fh(D,O)}}finally{Jc(-1),jd(y)}}function fh(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function Rb(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function f2(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;Ys(n)&&(t[""]=e)}}function m2(e,n,t,r,l){e.data[r]=l;const f=l.factory||(l.factory=ll(l.type)),y=new Vh(f,Ys(l),nt);e.blueprint[r]=y,t[r]=y,function Ms(e,n,t,r,l){const f=l.hostBindings;if(f){let y=e.hostBindingOpCodes;null===y&&(y=e.hostBindingOpCodes=[]);const C=~n.index;(function Nf(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(y)!=C&&y.push(C),y.push(t,r,f)}}(e,n,r,co(e,t,l.hostVars,hn),l)}function pu(e,n,t,r,l,f){const y=Xi(e,n);!function Lb(e,n,t,r,l,f,y){if(null==f)e.removeAttribute(n,l,t);else{const C=null==y?an(f):y(f,r||"",l);e.setAttribute(n,l,C,t)}}(n[Le],y,f,e.value,t,r,l)}function _2(e,n,t,r,l,f){const y=f[n];if(null!==y)for(let C=0;C<y.length;)VE(r,t,y[C++],y[C++],y[C++])}function VE(e,n,t,r,l){const f=_(null);try{const y=e.inputTransforms;null!==y&&y.hasOwnProperty(r)&&(l=y[r].call(n,l)),null!==e.setInput?e.setInput(n,l,t,r):n[r]=l}finally{_(f)}}function y2(e,n,t){let r=null,l=0;for(;l<t.length;){const f=t[l];if(0!==f)if(5!==f){if("number"==typeof f)break;if(e.hasOwnProperty(f)){null===r&&(r=[]);const y=e[f];for(let C=0;C<y.length;C+=2)if(y[C]===n){r.push(f,y[C+1],t[l+1]);break}}l+=2}else l+=2;else l+=4}return r}function UE(e,n,t,r){return[e,!0,!1,n,null,0,r,t,null,null,null]}function jE(e,n){const t=e.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const f=t[r+1];if(-1!==f){const y=e.data[f];yc(t[r]),y.contentQueries(2,n[f],f)}}}function Xv(e,n){return e[bt]?e[tn][x]=n:e[bt]=n,e[tn]=n,n}function kb(e,n,t){yc(0);const r=_(null);try{n(e,t)}finally{_(r)}}function $E(e){return e[U]||(e[U]=[])}function HE(e){return e.cleanup||(e.cleanup=[])}function qE(e,n){const t=e[xe],r=t?t.get(Wl,null):null;r&&r.handleError(n)}function Ob(e,n,t,r,l){for(let f=0;f<t.length;){const y=t[f++],C=t[f++];VE(e.data[y],n[y],r,C,l)}}function v2(e,n){const t=Or(n,e),r=t[Xt];!function x2(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const l=t[Gi];null!==l&&null===t[Go]&&(t[Go]=ql(l,t[xe])),Nb(r,t,t[X])}function Nb(e,n,t){up(n);try{const r=e.viewQuery;null!==r&&kb(1,r,t);const l=e.template;null!==l&&Tr(e,n,l,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&jE(e,n),e.staticViewQueries&&kb(2,e.viewQuery,t);const f=e.components;null!==f&&function b2(e,n){for(let t=0;t<n.length;t++)v2(e,n[t])}(n,f)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[ct]&=-5,Bu()}}let ZE=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,r,l){const f=typeof Zone>"u"?null:Zone.current,y=function Pn(e,n,t){const r=Object.create(vn);t&&(r.consumerAllowSignalWrites=!0),r.fn=e,r.schedule=n;const l=y=>{r.cleanupFn=y};return r.ref={notify:()=>B(r),run:()=>{if(r.dirty=!1,r.hasRun&&!K(r))return;r.hasRun=!0;const y=z(r);try{r.cleanupFn(),r.cleanupFn=Jt,r.fn(l)}finally{H(r,y)}},cleanup:()=>r.cleanupFn()},r.ref}(t,O=>{this.all.has(O)&&this.queue.set(O,f)},l);let C;this.all.add(y),y.notify();const D=()=>{y.cleanup(),C?.(),this.all.delete(y),this.queue.delete(y)};return C=r?.onDestroy(D),{destroy:D}}flush(){if(0!==this.queue.size)for(const[t,r]of this.queue)this.queue.delete(t),r?r.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=on({token:e,providedIn:"root",factory:()=>new e})}return e})();function Yv(e,n,t){let r=t?e.styles:null,l=t?e.classes:null,f=0;if(null!==n)for(let y=0;y<n.length;y++){const C=n[y];"number"==typeof C?f=C:1==f?l=Mo(l,C):2==f&&(r=Mo(r,C+": "+n[++y]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=l:e.classesWithoutHost=l}function b_(e,n,t,r,l=!1){for(;null!==t;){const f=n[t.index];null!==f&&r.push(Wn(f)),bo(f)&&WE(f,r);const y=t.type;if(8&y)b_(e,n,t.child,r);else if(32&y){const C=Wu(t,n);let D;for(;D=C();)r.push(D)}else if(16&y){const C=ff(n,t);if(Array.isArray(C))r.push(...C);else{const D=cf(n[_n]);b_(D[Xt],D,C,r,!0)}}t=l?t.projectionNext:t.next}return r}function WE(e,n){for(let t=kr;t<e.length;t++){const r=e[t],l=r[Xt].firstChild;null!==l&&b_(r[Xt],r,l,n)}e[Wr]!==e[Gi]&&n.push(e[Wr])}function Kv(e,n,t,r=!0){const l=n[je],f=l.rendererFactory,y=l.afterRenderEventManager;f.begin?.(),y?.begin();try{XE(e,n,e.template,t)}catch(D){throw r&&qE(n,D),D}finally{f.end?.(),l.effectManager?.flush(),y?.end()}}function XE(e,n,t,r){const l=n[ct];if(256!=(256&l)){n[je].effectManager?.flush(),up(n);try{Oh(n),function pn(e){return qn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Tr(e,n,t,2,r);const y=3==(3&l);if(y){const O=e.preOrderCheckHooks;null!==O&&fp(n,O,null)}else{const O=e.preOrderHooks;null!==O&&pp(n,O,0,null),mp(n,0)}if(function C2(e){for(let n=Cg(e);null!==n;n=Tg(n)){if(!n[Nl])continue;const t=n[sl];for(let r=0;r<t.length;r++){Cy(t[r])}}}(n),YE(n,2),null!==e.contentQueries&&jE(e,n),y){const O=e.contentCheckHooks;null!==O&&fp(n,O)}else{const O=e.contentHooks;null!==O&&pp(n,O,1),mp(n,1)}!function _r(e,n){const t=e.hostBindingOpCodes;if(null===t)return;const r=Ti(n,vs);try{for(let l=0;l<t.length;l++){const f=t[l];if(f<0)Jc(~f);else{const y=f,C=t[++l],D=t[++l];Ay(C,y),r.dirty=!1;const O=z(r);try{D(2,n[y])}finally{H(r,O)}}}}finally{null===n[vs]&&ki(n,vs),Jc(-1)}}(e,n);const C=e.components;null!==C&&JE(n,C,0);const D=e.viewQuery;if(null!==D&&kb(2,D,r),y){const O=e.viewCheckHooks;null!==O&&fp(n,O)}else{const O=e.viewHooks;null!==O&&pp(n,O,2),mp(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[ct]&=-73,Km(n)}finally{Bu()}}}function YE(e,n){for(let t=Cg(e);null!==t;t=Tg(t))for(let r=kr;r<t.length;r++)KE(t[r],n)}function T2(e,n,t){KE(Or(n,e),t)}function KE(e,n){if(!function mc(e){return 128==(128&e[ct])}(e))return;const t=e[Xt],r=e[ct];if(80&r&&0===n||1024&r||2===n)XE(t,e,t.template,e[X]);else if(e[M]>0){YE(e,1);const l=t.components;null!==l&&JE(e,l,1)}}function JE(e,n,t){for(let r=0;r<n.length;r++)T2(e,n[r],t)}class w_{get rootNodes(){const n=this._lView,t=n[Xt];return b_(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[X]}set context(n){this._lView[X]=n}get destroyed(){return 256==(256&this._lView[ct])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[h];if(bo(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(Vp(n,r),qh(t,r))}this._attachedToViewContainer=!1}Sg(this._lView[Xt],this._lView)}onDestroy(n){!function op(e,n){if(256==(256&e[ct]))throw new Et(911,!1);null===e[ys]&&(e[ys]=[]),e[ys].push(n)}(this._lView,n)}markForCheck(){ot(this._cdRefInjectingView||this._lView)}detach(){this._lView[ct]&=-129}reattach(){this._lView[ct]|=128}detectChanges(){Kv(this._lView[Xt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Et(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function uf(e,n){pf(e,n,n[Le],2,null,null)}(this._lView[Xt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Et(902,!1);this._appRef=n}}class D2 extends w_{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Kv(n[Xt],n,n[X],!1)}checkNoChanges(){}get context(){return null}}class QE extends sm{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=ei(n);return new E_(t,this.ngModule)}}function eC(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class S2{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=$s(r);const l=this.injector.get(n,Ac,r);return l!==Ac||t===Ac?l:this.parentInjector.get(n,t,r)}}class E_ extends a_{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=eC(n.inputs);if(null!==t)for(const l of r)t.hasOwnProperty(l.propName)&&(l.transform=t[l.propName]);return r}get outputs(){return eC(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function hc(e){return e.map(io).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,l){let f=(l=l||this.ngModule)instanceof Xo?l:l?.injector;f&&null!==this.componentDef.getStandaloneInjector&&(f=this.componentDef.getStandaloneInjector(f)||f);const y=f?new S2(n,f):n,C=y.get(am,null);if(null===C)throw new Et(407,!1);const W={rendererFactory:C,sanitizer:y.get(c_,null),effectManager:y.get(ZE,null),afterRenderEventManager:y.get(at,null)},oe=C.createRenderer(null,this.componentDef),ve=this.componentDef.selectors[0][0]||"div",qe=r?function kf(e,n,t,r){const f=r.get(Qe,!1)||t===pr.ShadowDom,y=e.selectRootElement(n,f);return function Of(e){m_(e)}(y),y}(oe,r,this.componentDef.encapsulation,y):Yu(oe,ve,function M2(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(ve)),zt=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let lt=null;null!==qe&&(lt=ql(qe,y,!0));const cn=aa(0,null,null,1,0,null,null,null,null,null,null),Vn=si(null,cn,null,zt,null,null,W,oe,y,null,lt);let _i,Ko;up(Vn);try{const Tu=this.componentDef;let Jf,DE=null;Tu.findHostDirectiveDefs?(Jf=[],DE=new Map,Tu.findHostDirectiveDefs(Tu,Jf,DE),Jf.push(Tu)):Jf=[Tu];const Gj=function A2(e,n){const t=e[Xt],r=ti;return e[r]=n,ar(t,r,2,"#host",null)}(Vn,qe),qj=function P2(e,n,t,r,l,f,y){const C=l[Xt];!function R2(e,n,t,r){for(const l of e)n.mergedAttrs=Zs(n.mergedAttrs,l.hostAttrs);null!==n.mergedAttrs&&(Yv(n,n.mergedAttrs,!0),null!==t&&Ng(r,t,n))}(r,e,n,y);let D=null;null!==n&&(D=ql(n,l[xe]));const O=f.rendererFactory.createRenderer(n,t);let $=16;t.signals?$=4096:t.onPush&&($=64);const W=si(l,Kr(t),null,$,l[e.index],e,f,O,null,null,D);return C.firstCreatePass&&Rb(C,e,r.length-1),Xv(l,W),l[e.index]=W}(Gj,qe,Tu,Jf,Vn,W,oe);Ko=Fl(cn,ti),qe&&function k2(e,n,t,r){if(r)Gs(e,t,["ng-version",gl.full]);else{const{attrs:l,classes:f}=function tl(e){const n=[],t=[];let r=1,l=2;for(;r<e.length;){let f=e[r];if("string"==typeof f)2===l?""!==f&&n.push(f,e[++r]):8===l&&t.push(f);else{if(!os(l))break;l=f}r++}return{attrs:n,classes:t}}(n.selectors[0]);l&&Gs(e,t,l),f&&f.length>0&&$p(e,t,f.join(" "))}}(oe,Tu,qe,r),void 0!==t&&function O2(e,n,t){const r=e.projection=[];for(let l=0;l<n.length;l++){const f=t[l];r.push(null!=f?Array.from(f):null)}}(Ko,this.ngContentSelectors,t),_i=function L2(e,n,t,r,l,f){const y=Nr(),C=l[Xt],D=Xi(y,l);hs(C,l,y,t,null,r);for(let $=0;$<t.length;$++)No(ul(l,C,y.directiveStart+$,y),l);x_(C,l,y),D&&No(D,l);const O=ul(l,C,y.directiveStart+y.componentOffset,y);if(e[X]=l[X]=O,null!==f)for(const $ of f)$(O,n);return Yr(C,y,e),O}(qj,Tu,Jf,DE,Vn,[N2]),Nb(cn,Vn,null)}finally{Bu()}return new I2(this.componentType,_i,Ic(Ko,Vn),Vn,Ko)}}class I2 extends Fv{constructor(n,t,r,l,f){super(),this.location=r,this._rootLView=l,this._tNode=f,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new D2(l),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let l;if(null!==r&&(l=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const f=this._rootLView;Ob(f[Xt],f,l,n,t),this.previousInputValues.set(n,t),ot(Or(this._tNode.index,f))}}get injector(){return new ao(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function N2(){const e=Nr();Es(mt()[Xt],e)}function hr(e){let n=function tC(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let l;if(Ys(e))l=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Et(903,!1);l=n.\u0275dir}if(l){if(t){r.push(l);const y=e;y.inputs=Jv(e.inputs),y.inputTransforms=Jv(e.inputTransforms),y.declaredInputs=Jv(e.declaredInputs),y.outputs=Jv(e.outputs);const C=l.hostBindings;C&&V2(e,C);const D=l.viewQuery,O=l.contentQueries;if(D&&z2(e,D),O&&B2(e,O),di(e.inputs,l.inputs),di(e.declaredInputs,l.declaredInputs),di(e.outputs,l.outputs),null!==l.inputTransforms&&(null===y.inputTransforms&&(y.inputTransforms={}),di(y.inputTransforms,l.inputTransforms)),Ys(l)&&l.data.animation){const $=e.data;$.animation=($.animation||[]).concat(l.data.animation)}}const f=l.features;if(f)for(let y=0;y<f.length;y++){const C=f[y];C&&C.ngInherit&&C(e),C===hr&&(t=!1)}}n=Object.getPrototypeOf(n)}!function F2(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const l=e[r];l.hostVars=n+=l.hostVars,l.hostAttrs=Zs(l.hostAttrs,t=Zs(t,l.hostAttrs))}}(r)}function Jv(e){return e===rs?{}:e===Qn?[]:e}function z2(e,n){const t=e.viewQuery;e.viewQuery=t?(r,l)=>{n(r,l),t(r,l)}:n}function B2(e,n){const t=e.contentQueries;e.contentQueries=t?(r,l,f)=>{n(r,l,f),t(r,l,f)}:n}function V2(e,n){const t=e.hostBindings;e.hostBindings=t?(r,l)=>{n(r,l),t(r,l)}:n}function oC(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const l=n[r];Array.isArray(l)&&l[2]&&(t[r]=l[2])}e.inputTransforms=t}function Qv(e){return!!Fb(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Fb(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function mu(e,n,t){return e[n]=t}function Ss(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function e0(e,n,t,r,l){const f=function Ff(e,n,t,r){const l=Ss(e,n,t);return Ss(e,n+1,r)||l}(e,n,t,r);return Ss(e,n+2,l)||f}function gu(e,n,t,r){const l=mt();return Ss(l,Js(),n)&&(Jn(),pu(cr(),l,e,n,t,r)),gu}function fm(e,n,t,r){return Ss(e,Js(),t)?n+an(t)+r:hn}function Dr(e,n,t,r,l,f,y,C){const D=mt(),O=Jn(),$=e+ti,W=O.firstCreatePass?function hP(e,n,t,r,l,f,y,C,D){const O=n.consts,$=ar(n,e,4,y||null,bs(O,C));y_(n,t,$,bs(O,D)),Es(n,$);const W=$.tView=aa(2,$,r,l,f,n.directiveRegistry,n.pipeRegistry,null,n.schemas,O,null);return null!==n.queries&&(n.queries.template(n,$),W.queries=n.queries.embeddedTView($)),$}($,O,D,n,t,r,l,f,y):O.data[$];Bl(W,!1);const oe=yC(O,D,W,e);ur()&&Ts(O,D,oe,W),No(oe,D),Xv(D,D[$]=UE(oe,D,oe,W)),Nu(W)&&Vr(O,D,W),null!=y&&Eo(D,W,C)}let yC=function vC(e,n,t,r){return xc(!0),n[Le].createComment("")};function $b(e){return function ka(e,n){return e[n]}(function Sy(){return qn.lFrame.contextLView}(),ti+e)}function In(e,n,t){const r=mt();return Ss(r,Js(),n)&&us(Jn(),cr(),r,e,n,r[Le],t,!1),In}function Hb(e,n,t,r,l){const y=l?"class":"style";Ob(e,t,n.inputs[y],y,r)}function kt(e,n,t,r){const l=mt(),f=Jn(),y=ti+e,C=l[Le],D=f.firstCreatePass?function mP(e,n,t,r,l,f){const y=n.consts,D=ar(n,e,2,r,bs(y,l));return y_(n,t,D,bs(y,f)),null!==D.attrs&&Yv(D,D.attrs,!1),null!==D.mergedAttrs&&Yv(D,D.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,D),D}(y,f,l,n,t,r):f.data[y],O=xC(f,l,D,C,n,e);l[y]=O;const $=Nu(D);return Bl(D,!0),Ng(C,O,D),32!=(32&D.flags)&&ur()&&Ts(f,l,O,D),0===function gc(){return qn.lFrame.elementDepthCount}()&&No(O,l),function lp(){qn.lFrame.elementDepthCount++}(),$&&(Vr(f,l,D),Yr(f,D,l)),null!==r&&Eo(l,D),kt}function Rt(){let e=Nr();tg()?function cp(){qn.lFrame.isParent=!1}():(e=e.parent,Bl(e,!1));const n=e;(function Ax(e){return qn.skipHydrationRootTNode===e})(n)&&function Fh(){qn.skipHydrationRootTNode=null}(),function Dy(){qn.lFrame.elementDepthCount--}();const t=Jn();return t.firstCreatePass&&(Es(t,e),ro(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function ky(e){return 0!=(8&e.flags)}(n)&&Hb(t,n,mt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Zd(e){return 0!=(16&e.flags)}(n)&&Hb(t,n,mt(),n.stylesWithoutHost,!1),Rt}function yo(e,n,t,r){return kt(e,n,t,r),Rt(),yo}let xC=(e,n,t,r,l,f)=>(xc(!0),Yu(r,l,function ea(){return qn.lFrame.currentNamespace}()));function S_(e){return!!e&&"function"==typeof e.then}function EC(e){return!!e&&"function"==typeof e.subscribe}function gi(e,n,t,r){const l=mt(),f=Jn(),y=Nr();return function TC(e,n,t,r,l,f,y){const C=Nu(r),O=e.firstCreatePass&&HE(e),$=n[X],W=$E(n);let oe=!0;if(3&r.type||y){const Ke=Xi(r,n),ht=y?y(Ke):Ke,zt=W.length,lt=y?Vn=>y(Wn(Vn[r.index])):r.index;let cn=null;if(!y&&C&&(cn=function wP(e,n,t,r){const l=e.cleanup;if(null!=l)for(let f=0;f<l.length-1;f+=2){const y=l[f];if(y===t&&l[f+1]===r){const C=n[U],D=l[f+2];return C.length>D?C[D]:null}"string"==typeof y&&(f+=2)}return null}(e,n,l,r.index)),null!==cn)(cn.__ngLastListenerFn__||cn).__ngNextListenerFn__=f,cn.__ngLastListenerFn__=f,oe=!1;else{f=MC(r,n,$,f,!1);const Vn=t.listen(ht,l,f);W.push(f,Vn),O&&O.push(l,lt,zt,zt+1)}}else f=MC(r,n,$,f,!1);const ve=r.outputs;let qe;if(oe&&null!==ve&&(qe=ve[l])){const Ke=qe.length;if(Ke)for(let ht=0;ht<Ke;ht+=2){const _i=n[qe[ht]][qe[ht+1]].subscribe(f),Ko=W.length;W.push(f,_i),O&&O.push(l,r.index,Ko,-(Ko+1))}}}(f,l,l[Le],y,e,n,r),gi}function DC(e,n,t,r){try{return fi(6,n,t),!1!==t(r)}catch(l){return qE(e,l),!1}finally{fi(7,n,t)}}function MC(e,n,t,r,l){return function f(y){if(y===Function)return r;ot(e.componentOffset>-1?Or(e.index,n):n);let D=DC(n,t,r,y),O=f.__ngNextListenerFn__;for(;O;)D=DC(n,t,O,y)&&D,O=O.__ngNextListenerFn__;return l&&!1===D&&y.preventDefault(),D}}function I_(e=1){return function Bh(e){return(qn.lFrame.contextLView=function vc(e,n){for(;e>0;)n=n[yn],e--;return n}(e,qn.lFrame.contextLView))[X]}(e)}function Zb(e,n,t){return Wb(e,"",n,"",t),Zb}function Wb(e,n,t,r,l){const f=mt(),y=fm(f,n,t,r);return y!==hn&&us(Jn(),cr(),f,e,y,f[Le],l,!1),Wb}function o0(e,n){return e<<17|n<<2}function gd(e){return e>>17&32767}function Xb(e){return 2|e}function zf(e){return(131068&e)>>2}function Yb(e,n){return-131069&e|n<<2}function Kb(e){return 1|e}function NC(e,n,t,r,l){const f=e[t+1],y=null===n;let C=r?gd(f):zf(f),D=!1;for(;0!==C&&(!1===D||y);){const $=e[C+1];PP(e[C],n)&&(D=!0,e[C+1]=r?Kb($):Xb($)),C=r?gd($):zf($)}D&&(e[t+1]=r?Xb(f):Kb(f))}function PP(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&Hu(e,n)>=0}function s0(e,n){return function Pc(e,n,t,r){const l=mt(),f=Jn(),y=function Oa(e){const n=qn.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}(2);f.firstUpdatePass&&function GC(e,n,t,r){const l=e.data;if(null===l[t+1]){const f=l[Lo()],y=function HC(e,n){return n>=e.expandoStartIndex}(e,t);(function XC(e,n){return 0!=(e.flags&(n?8:16))})(f,r)&&null===n&&!y&&(n=!1),n=function VP(e,n,t,r){const l=function _c(e){const n=qn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let f=r?n.residualClasses:n.residualStyles;if(null===l)0===(r?n.classBindings:n.styleBindings)&&(t=A_(t=Jb(null,e,n,t,r),n.attrs,r),f=null);else{const y=n.directiveStylingLast;if(-1===y||e[y]!==l)if(t=Jb(l,e,n,t,r),null===f){let D=function UP(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==zf(r))return e[gd(r)]}(e,n,r);void 0!==D&&Array.isArray(D)&&(D=Jb(null,e,n,D[1],r),D=A_(D,n.attrs,r),function jP(e,n,t,r){e[gd(t?n.classBindings:n.styleBindings)]=r}(e,n,r,D))}else f=function $P(e,n,t){let r;const l=n.directiveEnd;for(let f=1+n.directiveStylingLast;f<l;f++)r=A_(r,e[f].hostAttrs,t);return A_(r,n.attrs,t)}(e,n,r)}return void 0!==f&&(r?n.residualClasses=f:n.residualStyles=f),t}(l,f,n,r),function IP(e,n,t,r,l,f){let y=f?n.classBindings:n.styleBindings,C=gd(y),D=zf(y);e[r]=t;let $,O=!1;if(Array.isArray(t)?($=t[1],(null===$||Hu(t,$)>0)&&(O=!0)):$=t,l)if(0!==D){const oe=gd(e[C+1]);e[r+1]=o0(oe,C),0!==oe&&(e[oe+1]=Yb(e[oe+1],r)),e[C+1]=function MP(e,n){return 131071&e|n<<17}(e[C+1],r)}else e[r+1]=o0(C,0),0!==C&&(e[C+1]=Yb(e[C+1],r)),C=r;else e[r+1]=o0(D,0),0===C?C=r:e[D+1]=Yb(e[D+1],r),D=r;O&&(e[r+1]=Xb(e[r+1])),NC(e,$,r,!0),NC(e,$,r,!1),function AP(e,n,t,r,l){const f=l?e.residualClasses:e.residualStyles;null!=f&&"string"==typeof n&&Hu(f,n)>=0&&(t[r+1]=Kb(t[r+1]))}(n,$,e,r,f),y=o0(C,D),f?n.classBindings=y:n.styleBindings=y}(l,f,n,t,y,r)}}(f,e,y,r),n!==hn&&Ss(l,y,n)&&function ZC(e,n,t,r,l,f,y,C){if(!(3&n.type))return;const D=e.data,O=D[C+1],$=function SP(e){return 1==(1&e)}(O)?WC(D,n,t,l,zf(O),y):void 0;a0($)||(a0(f)||function DP(e){return 2==(2&e)}(O)&&(f=WC(D,null,t,l,C,y)),function bv(e,n,t,r,l){if(n)l?e.addClass(t,r):e.removeClass(t,r);else{let f=-1===r.indexOf("-")?void 0:$l.DashCase;null==l?e.removeStyle(t,r,f):("string"==typeof l&&l.endsWith("!important")&&(l=l.slice(0,-10),f|=$l.Important),e.setStyle(t,r,l,f))}}(r,y,Li(Lo(),t),l,f))}(f,f.data[Lo()],l,l[Le],e,l[y+1]=function ZP(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=tr(Dc(e)))),e}(n,t),r,y)}(e,n,null,!0),s0}function Jb(e,n,t,r,l){let f=null;const y=t.directiveEnd;let C=t.directiveStylingLast;for(-1===C?C=t.directiveStart:C++;C<y&&(f=n[C],r=A_(r,f.hostAttrs,l),f!==e);)C++;return null!==e&&(t.directiveStylingLast=C),r}function A_(e,n,t){const r=t?1:2;let l=-1;if(null!==n)for(let f=0;f<n.length;f++){const y=n[f];"number"==typeof y?l=y:l===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),oa(e,y,!!t||n[++f]))}return void 0===e?null:e}function WC(e,n,t,r,l,f){const y=null===n;let C;for(;l>0;){const D=e[l],O=Array.isArray(D),$=O?D[1]:D,W=null===$;let oe=t[l+1];oe===hn&&(oe=W?Qn:void 0);let ve=W?ef(oe,r):$===r?oe:void 0;if(O&&!a0(ve)&&(ve=ef(D,r)),a0(ve)&&(C=ve,y))return C;const qe=e[l+1];l=y?gd(qe):zf(qe)}if(null!==n){let D=f?n.residualClasses:n.residualStyles;null!=D&&(C=ef(D,r))}return C}function a0(e){return void 0!==e}function xn(e,n=""){const t=mt(),r=Jn(),l=e+ti,f=r.firstCreatePass?ar(r,l,1,n,null):r.data[l],y=YC(r,t,f,n,e);t[l]=y,ur()&&Ts(r,t,y,f),Bl(f,!1)}let YC=(e,n,t,r,l)=>(xc(!0),function zp(e,n){return e.createText(n)}(n[Le],r));function wm(e){return mh("",e,""),wm}function mh(e,n,t){const r=mt(),l=fm(r,e,n,t);return l!==hn&&function ph(e,n,t){const r=Li(n,e);!function fv(e,n,t){e.setValue(n,t)}(e[Le],r,t)}(r,Lo(),l),mh}const Cm="en-US";let yT=Cm;function tw(e,n,t,r,l){if(e=Sn(e),Array.isArray(e))for(let f=0;f<e.length;f++)tw(e[f],n,t,r,l);else{const f=Jn(),y=mt(),C=Nr();let D=rh(e)?e:Sn(e.provide);const O=Rv(e),$=1048575&C.providerIndexes,W=C.directiveStart,oe=C.providerIndexes>>20;if(rh(e)||!e.multi){const ve=new Vh(O,l,nt),qe=iw(D,n,l?$:$+oe,W);-1===qe?(bc(Xd(C,y),f,D),nw(f,e,n.length),n.push(D),C.directiveStart++,C.directiveEnd++,l&&(C.providerIndexes+=1048576),t.push(ve),y.push(ve)):(t[qe]=ve,y[qe]=ve)}else{const ve=iw(D,n,$+oe,W),qe=iw(D,n,$,$+oe),ht=qe>=0&&t[qe];if(l&&!ht||!l&&!(ve>=0&&t[ve])){bc(Xd(C,y),f,D);const zt=function pL(e,n,t,r,l){const f=new Vh(e,t,nt);return f.multi=[],f.index=n,f.componentProviders=0,$T(f,l,r&&!t),f}(l?fL:dL,t.length,l,r,O);!l&&ht&&(t[qe].providerFactory=zt),nw(f,e,n.length,0),n.push(D),C.directiveStart++,C.directiveEnd++,l&&(C.providerIndexes+=1048576),t.push(zt),y.push(zt)}else nw(f,e,ve>-1?ve:qe,$T(t[l?qe:ve],O,!l&&r));!l&&r&&ht&&t[qe].componentProviders++}}}function nw(e,n,t,r){const l=rh(n),f=function au(e){return!!e.useClass}(n);if(l||f){const D=(f?Sn(n.useClass):n).prototype.ngOnDestroy;if(D){const O=e.destroyHooks||(e.destroyHooks=[]);if(!l&&n.multi){const $=O.indexOf(t);-1===$?O.push(t,[r,D]):O[$+1].push(r,D)}else O.push(t,D)}}}function $T(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function iw(e,n,t,r){for(let l=t;l<r;l++)if(n[l]===e)return l;return-1}function dL(e,n,t,r){return rw(this.multi,[])}function fL(e,n,t,r){const l=this.multi;let f;if(this.providerFactory){const y=this.providerFactory.componentProviders,C=ul(t,t[Xt],this.providerFactory.index,r);f=C.slice(0,y),rw(l,f);for(let D=y;D<C.length;D++)f.push(C[D])}else f=[],rw(l,f);return f}function rw(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Ur(e,n=[]){return t=>{t.providersResolver=(r,l)=>function hL(e,n,t){const r=Jn();if(r.firstCreatePass){const l=Ys(e);tw(t,r.data,r.blueprint,l,!0),tw(n,r.data,r.blueprint,l,!1)}}(r,l?l(e):e,n)}}class Vf{}class HT{}class ow extends Vf{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new QE(this);const l=Zr(n);this._bootstrapComponents=me(l.bootstrap),this._r3Injector=d_(n,t,[{provide:Vf,useValue:this},{provide:sm,useValue:this.componentFactoryResolver},...r],tr(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class sw extends HT{constructor(n){super(),this.moduleType=n}create(n){return new ow(this.moduleType,n,[])}}class GT extends Vf{constructor(n){super(),this.componentFactoryResolver=new QE(this),this.instance=null;const t=new ad([...n.providers,{provide:Vf,useValue:this},{provide:sm,useValue:this.componentFactoryResolver}],n.parent||cu(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function aw(e,n,t=null){return new GT({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let _L=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=od(0,t.type),l=r.length>0?aw([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,l)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=on({token:e,providedIn:"environment",factory:()=>new e(rn(Xo))})}return e})();function qT(e){e.getStandaloneInjector=n=>n.get(_L).getOrCreateStandaloneInjector(e)}function cw(e,n,t,r){return function tD(e,n,t,r,l,f){const y=n+t;return Ss(e,y,l)?mu(e,y+1,f?r.call(f,l):r(l)):N_(e,y+1)}(mt(),as(),e,n,t,r)}function eD(e,n,t,r,l,f){return function iD(e,n,t,r,l,f,y,C){const D=n+t;return e0(e,D,l,f,y)?mu(e,D+3,C?r.call(C,l,f,y):r(l,f,y)):N_(e,D+3)}(mt(),as(),e,n,t,r,l,f)}function N_(e,n){const t=e[n];return t===hn?void 0:t}function VL(){return this._results[Symbol.iterator]()}class uw{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new s)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=uw.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=VL)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){const r=this;r.dirty=!1;const l=function wo(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Ec(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let l=e[r],f=n[r];if(t&&(l=t(l),f=t(f)),f!==l)return!1}return!0}(r._results,l,t))&&(r._results=l,r.length=l.length,r.last=l[this.length-1],r.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function jL(e,n,t,r=!0){const l=n[Xt];if(function hf(e,n,t,r){const l=kr+r,f=t.length;r>0&&(t[l-1][x]=n),r<f-kr?(n[x]=t[l],Qd(t,kr+r,n)):(t.push(n),n[x]=null),n[h]=t;const y=n[Lr];null!==y&&t!==y&&function mv(e,n){const t=e[sl];n[_n]!==n[h][h][_n]&&(e[Nl]=!0),null===t?e[sl]=[n]:t.push(n)}(y,n);const C=n[qi];null!==C&&C.insertView(e),n[ct]|=128}(l,n,e,t),r){const f=ru(t,e),y=n[Le],C=Up(y,e[Wr]);null!==C&&function Wo(e,n,t,r,l,f){r[Gi]=l,r[k]=n,pf(e,r,t,1,l,f)}(l,e[k],y,n,C,f)}}let gh=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=GL}return e})();const $L=gh,HL=class extends $L{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const l=function UL(e,n,t,r){const l=n.tView,C=si(e,l,t,4096&e[ct]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);C[Lr]=e[n.index];const O=e[qi];return null!==O&&(C[qi]=O.createEmbeddedView(l)),Nb(l,C,t),C}(this._declarationLView,this._declarationTContainer,n,{injector:t,hydrationInfo:r});return new w_(l)}};function GL(){return d0(Nr(),mt())}function d0(e,n){return 4&e.type?new HL(n,e,Ic(e,n)):null}let Lc=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=KL}return e})();function KL(){return dD(Nr(),mt())}const JL=Lc,uD=class extends JL{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Ic(this._hostTNode,this._hostLView)}get injector(){return new ao(this._hostTNode,this._hostLView)}get parentInjector(){const n=na(this._hostTNode,this._hostLView);if(Wd(n)){const t=Uh(n,this._hostLView),r=so(n);return new ao(t[Xt].data[r+8],t)}return new ao(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=hD(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-kr}createEmbeddedView(n,t,r){let l,f;"number"==typeof r?l=r:null!=r&&(l=r.index,f=r.injector);const C=n.createEmbeddedViewImpl(t||{},f,null);return this.insertImpl(C,l,false),C}createComponent(n,t,r,l,f){const y=n&&!function Jd(e){return"function"==typeof e}(n);let C;if(y)C=t;else{const Ke=t||{};C=Ke.index,r=Ke.injector,l=Ke.projectableNodes,f=Ke.environmentInjector||Ke.ngModuleRef}const D=y?n:new E_(ei(n)),O=r||this.parentInjector;if(!f&&null==D.ngModule){const ht=(y?O:this.parentInjector).get(Xo,null);ht&&(f=ht)}ei(D.componentType??{});const ve=D.create(O,l,null,f);return this.insertImpl(ve.hostView,C,false),ve}insert(n,t){return this.insertImpl(n,t,!1)}insertImpl(n,t,r){const l=n._lView;if(function kh(e){return bo(e[h])}(l)){const D=this.indexOf(n);if(-1!==D)this.detach(D);else{const O=l[h],$=new uD(O,O[k],O[h]);$.detach($.indexOf(n))}}const y=this._adjustIndex(t),C=this._lContainer;return jL(C,l,y,!r),n.attachToViewContainerRef(),Qd(hw(C),y,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=hD(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=Vp(this._lContainer,t);r&&(qh(hw(this._lContainer),t),Sg(r[Xt],r))}detach(n){const t=this._adjustIndex(n,-1),r=Vp(this._lContainer,t);return r&&null!=qh(hw(this._lContainer),t)?new w_(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function hD(e){return e[8]}function hw(e){return e[8]||(e[8]=[])}function dD(e,n){let t;const r=n[e.index];return bo(r)?t=r:(t=UE(r,n,null,e),n[e.index]=t,Xv(n,t)),fD(t,n,e,r),new uD(t,e,n)}let fD=function pD(e,n,t,r){if(e[Wr])return;let l;l=8&t.type?Wn(r):function QL(e,n){const t=e[Le],r=t.createComment(""),l=Xi(n,e);return Ku(t,Up(t,l),r,function ib(e,n){return e.nextSibling(n)}(t,l),!1),r}(n,t),e[Wr]=l};class dw{constructor(n){this.queryList=n,this.matches=null}clone(){return new dw(this.queryList)}setDirty(){this.queryList.setDirty()}}class fw{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,l=[];for(let f=0;f<r;f++){const y=t.getByIndex(f);l.push(this.queries[y.indexInDeclarationView].clone())}return new fw(l)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==bD(n,t).matches&&this.queries[t].setDirty()}}class mD{constructor(n,t,r=null){this.predicate=n,this.flags=t,this.read=r}}class pw{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const l=null!==t?t.length:0,f=this.getByIndex(r).embeddedTView(n,l);f&&(f.indexInDeclarationView=r,null!==t?t.push(f):t=[f])}return null!==t?new pw(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class mw{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new mw(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let l=0;l<r.length;l++){const f=r[l];this.matchTNodeWithReadOption(n,t,nk(t,f)),this.matchTNodeWithReadOption(n,t,wc(t,n,f,!1,!1))}else r===gh?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,wc(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const l=this.metadata.read;if(null!==l)if(l===sa||l===Lc||l===gh&&4&t.type)this.addMatch(t.index,-2);else{const f=wc(t,n,l,!1,!1);null!==f&&this.addMatch(t.index,f)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function nk(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function rk(e,n,t,r){return-1===t?function ik(e,n){return 11&e.type?Ic(e,n):4&e.type?d0(e,n):null}(n,e):-2===t?function ok(e,n,t){return t===sa?Ic(n,e):t===gh?d0(n,e):t===Lc?dD(n,e):void 0}(e,n,r):ul(e,e[Xt],t,n)}function gD(e,n,t,r){const l=n[qi].queries[r];if(null===l.matches){const f=e.data,y=t.matches,C=[];for(let D=0;D<y.length;D+=2){const O=y[D];C.push(O<0?null:rk(n,f[O],y[D+1],t.metadata.read))}l.matches=C}return l.matches}function gw(e,n,t,r){const l=e.queries.getByIndex(t),f=l.matches;if(null!==f){const y=gD(e,n,l,t);for(let C=0;C<f.length;C+=2){const D=f[C];if(D>0)r.push(y[C/2]);else{const O=f[C+1],$=n[-D];for(let W=kr;W<$.length;W++){const oe=$[W];oe[Lr]===oe[h]&&gw(oe[Xt],oe,O,r)}if(null!==$[sl]){const W=$[sl];for(let oe=0;oe<W.length;oe++){const ve=W[oe];gw(ve[Xt],ve,O,r)}}}}}return r}function _w(e){const n=mt(),t=Jn(),r=zh();yc(r+1);const l=bD(t,r);if(e.dirty&&function zl(e){return 4==(4&e[ct])}(n)===(2==(2&l.metadata.flags))){if(null===l.matches)e.reset([]);else{const f=l.crossesNgTemplate?gw(t,n,r,[]):gD(t,n,l,r);e.reset(f,fd),e.notifyOnChanges()}return!0}return!1}function _D(e,n,t){const r=Jn();r.firstCreatePass&&(function xD(e,n,t){null===e.queries&&(e.queries=new pw),e.queries.track(new mw(n,t))}(r,new mD(e,n,t),-1),2==(2&n)&&(r.staticViewQueries=!0)),function vD(e,n,t){const r=new uw(4==(4&t));(function qv(e,n,t,r){const l=$E(n);l.push(t),e.firstCreatePass&&HE(e).push(r,l.length-1)})(e,n,r,r.destroy),null===n[qi]&&(n[qi]=new fw),n[qi].queries.push(new dw(r))}(r,mt(),n)}function bD(e,n){return e.queries.getByIndex(n)}const Cw=new qt("Application Initializer");let Tw=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=Qt(Cw,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const l of this.appInits){const f=l();if(S_(f))t.push(f);else if(EC(f)){const y=new Promise((C,D)=>{f.subscribe({complete:C,error:D})});t.push(y)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(l=>{this.reject(l)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),zD=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const _h=new qt("LocaleId",{providedIn:"root",factory:()=>Qt(_h,jn.Optional|jn.SkipSelf)||function Ik(){return typeof $localize<"u"&&$localize.locale||Cm}()});let m0=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new fn(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Rk{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let BD=(()=>{class e{compileModuleSync(t){return new sw(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),f=me(Zr(t).declarations).reduce((y,C)=>{const D=ei(C);return D&&y.push(new E_(D)),y},[]);return new Rk(r,f)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const $D=new qt(""),_0=new qt("");let Aw,Sw=(()=>{class e{constructor(t,r,l){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Aw||(function eO(e){Aw=e}(l),l.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{v.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,l){let f=-1;r&&r>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==f),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:f,updateCb:l})}whenStable(t,r,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,l){return[]}static#e=this.\u0275fac=function(r){return new(r||e)(rn(v),rn(Iw),rn(_0))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})(),Iw=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return Aw?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),_d=null;const HD=new qt("AllowMultipleToken"),Pw=new qt("PlatformDestroyListeners"),Rw=new qt("appBootstrapListener");class qD{constructor(n,t){this.name=n,this.token=t}}function WD(e,n,t=[]){const r=`Platform: ${n}`,l=new qt(r);return(f=[])=>{let y=Lw();if(!y||y.injector.get(HD,!1)){const C=[...t,...f,{provide:l,useValue:!0}];e?e(C):function iO(e){if(_d&&!_d.get(HD,!1))throw new Et(400,!1);(function GD(){!function vt(e){Ie=e}(()=>{throw new Et(600,!1)})})(),_d=e;const n=e.get(YD);(function ZD(e){e.get(Qg,null)?.forEach(t=>t())})(e)}(function XD(e=[],n){return Ds.create({name:n,providers:[{provide:Yg,useValue:"platform"},{provide:Pw,useValue:new Set([()=>_d=null])},...e]})}(C,r))}return function oO(e){const n=Lw();if(!n)throw new Et(401,!1);return n}()}}function Lw(){return _d?.get(YD)??null}let YD=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const l=function sO(e="zone.js",n){return"noop"===e?new j:"zone.js"===e?new v(n):e}(r?.ngZone,function KD(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return l.run(()=>{const f=function gL(e,n,t){return new ow(e,n,t)}(t.moduleType,this.injector,function nM(e){return[{provide:v,useFactory:e},{provide:ih,multi:!0,useFactory:()=>{const n=Qt(lO,{optional:!0});return()=>n.initialize()}},{provide:tM,useFactory:aO},{provide:q,useFactory:J}]}(()=>l)),y=f.injector.get(Wl,null);return l.runOutsideAngular(()=>{const C=l.onError.subscribe({next:D=>{y.handleError(D)}});f.onDestroy(()=>{y0(this._modules,f),C.unsubscribe()})}),function JD(e,n,t){try{const r=t();return S_(r)?r.catch(l=>{throw n.runOutsideAngular(()=>e.handleError(l)),l}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(y,l,()=>{const C=f.injector.get(Tw);return C.runInitializers(),C.donePromise.then(()=>(function vT(e){Fr(e,"Expected localeId to be defined"),"string"==typeof e&&(yT=e.toLowerCase().replace(/_/g,"-"))}(f.injector.get(_h,Cm)||Cm),this._moduleDoBootstrap(f),f))})})}bootstrapModule(t,r=[]){const l=QD({},r);return function tO(e,n,t){const r=new sw(t);return Promise.resolve(r)}(0,0,t).then(f=>this.bootstrapModuleFactory(f,l))}_moduleDoBootstrap(t){const r=t.injector.get(Mm);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(l=>r.bootstrap(l));else{if(!t.instance.ngDoBootstrap)throw new Et(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Et(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(Pw,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)(rn(Ds))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function QD(e,n){return Array.isArray(n)?n.reduce(QD,e):{...e,...n}}let Mm=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Qt(tM),this.zoneIsStable=Qt(q),this.componentTypes=[],this.components=[],this.isStable=Qt(m0).hasPendingTasks.pipe($i(t=>t?dn(!1):this.zoneIsStable),function ts(e,n=bn){return e=e??Hi,ui((t,r)=>{let l,f=!0;t.subscribe(sn(r,y=>{const C=n(y);(f||!e(l,C))&&(f=!1,l=C,r.next(y))}))})}(),er()),this._injector=Qt(Xo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const l=t instanceof a_;if(!this._injector.get(Tw).done)throw!l&&function rl(e){const n=ei(e)||xr(e)||ir(e);return null!==n&&n.standalone}(t),new Et(405,!1);let y;y=l?t:this._injector.get(sm).resolveComponentFactory(t),this.componentTypes.push(y.componentType);const C=function nO(e){return e.isBoundToModule}(y)?void 0:this._injector.get(Vf),O=y.create(Ds.NULL,[],r||y.selector,C),$=O.location.nativeElement,W=O.injector.get($D,null);return W?.registerApplication($),O.onDestroy(()=>{this.detachView(O.hostView),y0(this.components,O),W?.unregisterApplication($)}),this._loadComponent(O),O}tick(){if(this._runningTick)throw new Et(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;y0(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(Rw,[]);r.push(...this._bootstrapListeners),r.forEach(l=>l(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>y0(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Et(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function y0(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}const tM=new qt("",{providedIn:"root",factory:()=>Qt(Wl).handleError.bind(void 0)});function aO(){const e=Qt(v),n=Qt(Wl);return t=>e.runOutsideAngular(()=>n.handleError(t))}let lO=(()=>{class e{constructor(){this.zone=Qt(v),this.applicationRef=Qt(Mm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let v0=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=uO}return e})();function uO(e){return function hO(e,n,t){if(pc(e)&&!t){const r=Or(e.index,n);return new w_(r,r)}return 47&e.type?new w_(n[_n],n):null}(Nr(),mt(),16==(16&e))}class sM{constructor(){}supports(n){return Qv(n)}create(n){return new _O(n)}}const gO=(e,n)=>n;class _O{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||gO}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,r=this._removalsHead,l=0,f=null;for(;t||r;){const y=!r||t&&t.currentIndex<lM(r,l,f)?t:r,C=lM(y,l,f),D=y.currentIndex;if(y===r)l--,r=r._nextRemoved;else if(t=t._next,null==y.previousIndex)l++;else{f||(f=[]);const O=C-l,$=D-l;if(O!=$){for(let oe=0;oe<O;oe++){const ve=oe<f.length?f[oe]:f[oe]=0,qe=ve+oe;$<=qe&&qe<O&&(f[oe]=ve+1)}f[y.previousIndex]=$-O}}C!==D&&n(y,C,D)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!Qv(n))throw new Et(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l,f,y,t=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let C=0;C<this.length;C++)f=n[C],y=this._trackByFn(C,f),null!==t&&Object.is(t.trackById,y)?(r&&(t=this._verifyReinsertion(t,f,y,C)),Object.is(t.item,f)||this._addIdentityChange(t,f)):(t=this._mismatch(t,f,y,C),r=!0),t=t._next}else l=0,function Z2(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let r;for(;!(r=t.next()).done;)n(r.value)}}(n,C=>{y=this._trackByFn(l,C),null!==t&&Object.is(t.trackById,y)?(r&&(t=this._verifyReinsertion(t,C,y,l)),Object.is(t.item,C)||this._addIdentityChange(t,C)):(t=this._mismatch(t,C,y,l),r=!0),t=t._next,l++}),this.length=l;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,r,l){let f;return null===n?f=this._itTail:(f=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,f,l)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,l))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,f,l)):n=this._addAfter(new yO(t,r),f,l),n}_verifyReinsertion(n,t,r,l){let f=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==f?n=this._reinsertAfter(f,n._prev,l):n.currentIndex!=l&&(n.currentIndex=l,this._addToMoves(n,l)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const l=n._prevRemoved,f=n._nextRemoved;return null===l?this._removalsHead=f:l._nextRemoved=f,null===f?this._removalsTail=l:f._prevRemoved=l,this._insertAfter(n,t,r),this._addToMoves(n,r),n}_moveAfter(n,t,r){return this._unlink(n),this._insertAfter(n,t,r),this._addToMoves(n,r),n}_addAfter(n,t,r){return this._insertAfter(n,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,r){const l=null===t?this._itHead:t._next;return n._next=l,n._prev=t,null===l?this._itTail=n:l._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new aM),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,r=n._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new aM),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class yO{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class vO{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const t=n._prevDup,r=n._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class aM{constructor(){this.map=new Map}put(n){const t=n.trackById;let r=this.map.get(t);r||(r=new vO,this.map.set(t,r)),r.add(n)}get(n,t){const l=this.map.get(n);return l?l.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function lM(e,n,t){const r=e.previousIndex;if(null===r)return r;let l=0;return t&&r<t.length&&(l=t[r]),r+n+l}class cM{constructor(){}supports(n){return n instanceof Map||Fb(n)}create(){return new xO}}class xO{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let t;for(t=this._mapHead;null!==t;t=t._next)n(t)}forEachPreviousItem(n){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)n(t)}forEachChangedItem(n){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}diff(n){if(n){if(!(n instanceof Map||Fb(n)))throw new Et(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,l)=>{if(t&&t.key===l)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const f=this._getOrCreateRecordForKey(l,r);t=this._insertBeforeOrAppend(t,f)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,t){if(n){const r=n._prev;return t._next=n,t._prev=r,n._prev=t,r&&(r._next=t),n===this._mapHead&&(this._mapHead=t),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(n,t){if(this._records.has(n)){const l=this._records.get(n);this._maybeAddToChanges(l,t);const f=l._prev,y=l._next;return f&&(f._next=y),y&&(y._prev=f),l._next=null,l._prev=null,l}const r=new bO(n);return this._records.set(n,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,t){Object.is(t,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=t,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,t){n instanceof Map?n.forEach(t):Object.keys(n).forEach(r=>t(n[r],r))}}class bO{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function uM(){return new w0([new sM])}let w0=(()=>{class e{static#e=this.\u0275prov=on({token:e,providedIn:"root",factory:uM});constructor(t){this.factories=t}static create(t,r){if(null!=r){const l=r.factories.slice();t=t.concat(l)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||uM()),deps:[[e,new Dp,new Tp]]}}find(t){const r=this.factories.find(l=>l.supports(t));if(null!=r)return r;throw new Et(901,!1)}}return e})();function hM(){return new V_([new cM])}let V_=(()=>{class e{static#e=this.\u0275prov=on({token:e,providedIn:"root",factory:hM});constructor(t){this.factories=t}static create(t,r){if(r){const l=r.factories.slice();t=t.concat(l)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||hM()),deps:[[e,new Dp,new Tp]]}}find(t){const r=this.factories.find(l=>l.supports(t));if(r)return r;throw new Et(901,!1)}}return e})();const CO=WD(null,"core",[]);let TO=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)(rn(Mm))};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({})}return e})();function Sm(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let Bw=null;function yd(){return Bw}class BO{}const yl=new qt("DocumentToken");let Vw=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return Qt(UO)},providedIn:"platform"})}return e})();const VO=new qt("Location Initialized");let UO=(()=>{class e extends Vw{constructor(){super(),this._doc=Qt(yl),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return yd().getBaseHref(this._doc)}onPopState(t){const r=yd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=yd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,l){this._history.pushState(t,r,l)}replaceState(t,r,l){this._history.replaceState(t,r,l)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function Uw(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function xM(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function yh(e){return e&&"?"!==e[0]?"?"+e:e}let jf=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return Qt(wM)},providedIn:"root"})}return e})();const bM=new qt("appBaseHref");let wM=(()=>{class e extends jf{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Qt(yl).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Uw(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+yh(this._platformLocation.search),l=this._platformLocation.hash;return l&&t?`${r}${l}`:r}pushState(t,r,l,f){const y=this.prepareExternalUrl(l+yh(f));this._platformLocation.pushState(t,r,y)}replaceState(t,r,l,f){const y=this.prepareExternalUrl(l+yh(f));this._platformLocation.replaceState(t,r,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(Vw),rn(bM,8))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),jO=(()=>{class e extends jf{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Uw(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,l,f){let y=this.prepareExternalUrl(l+yh(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(t,r,y)}replaceState(t,r,l,f){let y=this.prepareExternalUrl(l+yh(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(Vw),rn(bM,8))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})(),jw=(()=>{class e{constructor(t){this._subject=new s,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function GO(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(xM(EM(r))),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+yh(r))}normalize(t){return e.stripTrailingSlash(function HO(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,EM(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",l=null){this._locationStrategy.pushState(l,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+yh(r)),l)}replaceState(t,r="",l=null){this._locationStrategy.replaceState(l,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+yh(r)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(l=>l(t,r))}subscribe(t,r,l){return this._subject.subscribe({next:t,error:r,complete:l})}static#e=this.normalizeQueryParams=yh;static#t=this.joinWithSlash=Uw;static#n=this.stripTrailingSlash=xM;static#i=this.\u0275fac=function(r){return new(r||e)(rn(jf))};static#r=this.\u0275prov=on({token:e,factory:function(){return function $O(){return new jw(rn(jf))}()},providedIn:"root"})}return e})();function EM(e){return e.replace(/\/index.html$/,"")}function RM(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[l,f]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(l.trim()===n)return decodeURIComponent(f)}return null}const Jw=/\s+/,LM=[];let kM=(()=>{class e{constructor(t,r,l,f){this._iterableDiffers=t,this._keyValueDiffers=r,this._ngEl=l,this._renderer=f,this.initialClasses=LM,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(Jw):LM}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(Jw):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){const l=this.stateMap.get(t);void 0!==l?(l.enabled!==r&&(l.changed=!0,l.enabled=r),l.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],l=t[1];l.changed?(this._toggleClass(r,l.enabled),l.changed=!1):l.touched||(l.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),l.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split(Jw).forEach(l=>{r?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}static#e=this.\u0275fac=function(r){return new(r||e)(nt(w0),nt(V_),nt(sa),nt(Ua))};static#t=this.\u0275dir=An({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class AN{constructor(n,t,r,l){this.$implicit=n,this.ngForOf=t,this.index=r,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Qw=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,l){this._viewContainer=t,this._template=r,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((l,f,y)=>{if(null==l.previousIndex)r.createEmbeddedView(this._template,new AN(l.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)r.remove(null===f?void 0:f);else if(null!==f){const C=r.get(f);r.move(C,y),NM(C,l)}});for(let l=0,f=r.length;l<f;l++){const C=r.get(l).context;C.index=l,C.count=f,C.ngForOf=this._ngForOf}t.forEachIdentityChange(l=>{NM(r.get(l.currentIndex),l)})}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Lc),nt(gh),nt(w0))};static#t=this.\u0275dir=An({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function NM(e,n){e.context.$implicit=n.item}let Am=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new PN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){FM("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){FM("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Lc),nt(gh))};static#t=this.\u0275dir=An({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class PN{constructor(){this.$implicit=null,this.ngIf=null}}function FM(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${tr(n)}'.`)}let nF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({})}return e})();function UM(e){return"server"===e}let sF=(()=>{class e{static#e=this.\u0275prov=on({token:e,providedIn:"root",factory:()=>new aF(rn(yl),window)})}return e})();class aF{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function lF(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=r.currentNode;for(;l;){const f=l.shadowRoot;if(f){const y=f.getElementById(n)||f.querySelector(`[name="${n}"]`);if(y)return y}l=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,l=t.top+this.window.pageYOffset,f=this.offset();this.window.scrollTo(r-f[0],l-f[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class jM{}class PF extends BO{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class s1 extends PF{static makeCurrent(){!function zO(e){Bw||(Bw=e)}(new s1)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function RF(){return H_=H_||document.querySelector("base"),H_?H_.getAttribute("href"):null}();return null==t?null:function LF(e){N0=N0||document.createElement("a"),N0.setAttribute("href",e);const n=N0.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){H_=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return RM(document.cookie,n)}}let N0,H_=null,OF=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();const a1=new qt("EventManagerPlugins");let ZM=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(l=>{l.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,l){return this._findPluginFor(r).addEventListener(t,r,l)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(f=>f.supports(t)),!r)throw new Et(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)(rn(a1),rn(v))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();class WM{constructor(n){this._doc=n}}const l1="ng-app-id";let XM=(()=>{class e{constructor(t,r,l,f={}){this.doc=t,this.appId=r,this.nonce=l,this.platformId=f,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=UM(f),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(l=>l.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${l1}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(l=>{null!=l.textContent&&r.set(l.textContent,l)}),r}return null}changeUsageCount(t,r){const l=this.styleRef;if(l.has(t)){const f=l.get(t);return f.usage+=r,f.usage}return l.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const l=this.styleNodesInDOM,f=l?.get(r);if(f?.parentNode===t)return l.delete(r),f.removeAttribute(l1),f;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=r,this.platformIsServer&&y.setAttribute(l1,this.appId),y}}addStyleToHost(t,r){const l=this.getStyleElement(t,r);t.appendChild(l);const f=this.styleRef,y=f.get(r)?.elements;y?y.push(l):f.set(r,{elements:[l],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(yl),rn(Tf),rn(Df,8),rn(ah))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();const c1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},u1=/%COMP%/g,BF=new qt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function KM(e,n){return n.map(t=>t.replace(u1,e))}let JM=(()=>{class e{constructor(t,r,l,f,y,C,D,O=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=l,this.removeStylesOnCompDestroy=f,this.doc=y,this.platformId=C,this.ngZone=D,this.nonce=O,this.rendererByCompId=new Map,this.platformIsServer=UM(C),this.defaultRenderer=new h1(t,y,D,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===pr.ShadowDom&&(r={...r,encapsulation:pr.Emulated});const l=this.getOrCreateRenderer(t,r);return l instanceof eS?l.applyToHost(t):l instanceof d1&&l.applyStyles(),l}getOrCreateRenderer(t,r){const l=this.rendererByCompId;let f=l.get(r.id);if(!f){const y=this.doc,C=this.ngZone,D=this.eventManager,O=this.sharedStylesHost,$=this.removeStylesOnCompDestroy,W=this.platformIsServer;switch(r.encapsulation){case pr.Emulated:f=new eS(D,O,r,this.appId,$,y,C,W);break;case pr.ShadowDom:return new $F(D,O,t,r,y,C,this.nonce,W);default:f=new d1(D,O,r,$,y,C,W)}l.set(r.id,f)}return f}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)(rn(ZM),rn(XM),rn(Tf),rn(BF),rn(yl),rn(ah),rn(v),rn(Df))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();class h1{constructor(n,t,r,l){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(c1[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(QM(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(QM(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new Et(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,l){if(l){t=l+":"+t;const f=c1[l];f?n.setAttributeNS(f,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const l=c1[r];l?n.removeAttributeNS(l,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,l){l&($l.DashCase|$l.Important)?n.style.setProperty(t,r,l&$l.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&$l.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){n[t]=r}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=yd().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function QM(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class $F extends h1{constructor(n,t,r,l,f,y,C,D){super(n,f,y,D),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const O=KM(l.id,l.styles);for(const $ of O){const W=document.createElement("style");C&&W.setAttribute("nonce",C),W.textContent=$,this.shadowRoot.appendChild(W)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class d1 extends h1{constructor(n,t,r,l,f,y,C,D){super(n,f,y,C),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=l,this.styles=D?KM(D,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class eS extends d1{constructor(n,t,r,l,f,y,C,D){const O=l+"-"+r.id;super(n,t,r,f,y,C,D,O),this.contentAttr=function VF(e){return"_ngcontent-%COMP%".replace(u1,e)}(O),this.hostAttr=function UF(e){return"_nghost-%COMP%".replace(u1,e)}(O)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let HF=(()=>{class e extends WM{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,l){return t.addEventListener(r,l,!1),()=>this.removeEventListener(t,r,l)}removeEventListener(t,r,l){return t.removeEventListener(r,l)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(yl))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();const tS=["alt","control","meta","shift"],GF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},qF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let ZF=(()=>{class e extends WM{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,l){const f=e.parseEventName(r),y=e.eventCallback(f.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>yd().onAndCancel(t,f.domEventName,y))}static parseEventName(t){const r=t.toLowerCase().split("."),l=r.shift();if(0===r.length||"keydown"!==l&&"keyup"!==l)return null;const f=e._normalizeKey(r.pop());let y="",C=r.indexOf("code");if(C>-1&&(r.splice(C,1),y="code."),tS.forEach(O=>{const $=r.indexOf(O);$>-1&&(r.splice($,1),y+=O+".")}),y+=f,0!=r.length||0===f.length)return null;const D={};return D.domEventName=l,D.fullKey=y,D}static matchEventFullKeyCode(t,r){let l=GF[t.key]||t.key,f="";return r.indexOf("code.")>-1&&(l=t.code,f="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),tS.forEach(y=>{y!==l&&(0,qF[y])(t)&&(f+=y+".")}),f+=l,f===r)}static eventCallback(t,r,l){return f=>{e.matchEventFullKeyCode(f,t)&&l.runGuarded(()=>r(f))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)(rn(yl))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();const KF=WD(CO,"browser",[{provide:ah,useValue:"browser"},{provide:Qg,useValue:function WF(){s1.makeCurrent()},multi:!0},{provide:yl,useFactory:function YF(){return function ab(e){Fg=e}(document),document},deps:[]}]),JF=new qt(""),rS=[{provide:_0,useClass:class kF{addToWindow(n){bi.getAngularTestability=(r,l=!0)=>{const f=n.findTestabilityInTree(r,l);if(null==f)throw new Et(5103,!1);return f},bi.getAllAngularTestabilities=()=>n.getAllTestabilities(),bi.getAllAngularRootElements=()=>n.getAllRootElements(),bi.frameworkStabilizers||(bi.frameworkStabilizers=[]),bi.frameworkStabilizers.push(r=>{const l=bi.getAllAngularTestabilities();let f=l.length,y=!1;const C=function(D){y=y||D,f--,0==f&&r(y)};l.forEach(D=>{D.whenStable(C)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?yd().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:$D,useClass:Sw,deps:[v,Iw,_0]},{provide:Sw,useClass:Sw,deps:[v,Iw,_0]}],oS=[{provide:Yg,useValue:"root"},{provide:Wl,useFactory:function XF(){return new Wl},deps:[]},{provide:a1,useClass:HF,multi:!0,deps:[yl,v,ah]},{provide:a1,useClass:ZF,multi:!0,deps:[yl]},JM,XM,ZM,{provide:am,useExisting:JM},{provide:jM,useClass:OF,deps:[]},[]];let QF=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Tf,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)(rn(JF,12))};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({providers:[...oS,...rS],imports:[nF,TO]})}return e})(),sS=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)(rn(yl))};static#t=this.\u0275prov=on({token:e,factory:function(r){let l=null;return l=r?new r:function tz(){return new sS(rn(yl))}(),l},providedIn:"root"})}return e})();typeof window<"u"&&window;const{isArray:az}=Array,{getPrototypeOf:lz,prototype:cz,keys:uz}=Object;function uS(e){if(1===e.length){const n=e[0];if(az(n))return{args:n,keys:null};if(function hz(e){return e&&"object"==typeof e&&lz(e)===cz}(n)){const t=uz(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:dz}=Array;function hS(e){return Nn(n=>function fz(e,n){return dz(n)?e(...n):e(n)}(e,n))}function dS(e,n){return e.reduce((t,r,l)=>(t[r]=n[l],t),{})}function p1(...e){const n=fo(e),t=va(e),{args:r,keys:l}=uS(e);if(0===r.length)return et([],n);const f=new Mn(function pz(e,n,t=bn){return r=>{fS(n,()=>{const{length:l}=e,f=new Array(l);let y=l,C=l;for(let D=0;D<l;D++)fS(n,()=>{const O=et(e[D],n);let $=!1;O.subscribe(sn(r,W=>{f[D]=W,$||($=!0,C--),C||r.next(t(f.slice()))},()=>{--y||r.complete()}))},r)},r)}}(r,n,l?y=>dS(l,y):bn));return t?f.pipe(hS(t)):f}function fS(e,n,t){e?Xn(t,e,n):n()}const F0=u(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function m1(...e){return function mz(){return ya(1)}()(et(e,fo(e)))}function pS(e){return new Mn(n=>{wi(e()).subscribe(n)})}function vu(e,n){const t=Te(e)?e:()=>e,r=l=>l.error(t());return new Mn(n?l=>n.schedule(r,0,l):r)}function g1(){return ui((e,n)=>{let t=null;e._refCount++;const r=sn(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const l=e._connection,f=t;t=null,l&&(!f||l===f)&&l.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class mS extends Mn{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,li(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Pe;const t=this.getSubject();n.add(this.source.subscribe(sn(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Pe.EMPTY)}return n}refCount(){return g1()(this)}}function Pm(e){return e<=0?()=>to:ui((n,t)=>{let r=0;n.subscribe(sn(t,l=>{++r<=e&&(t.next(l),e<=r&&t.complete())}))})}function bh(e,n){return ui((t,r)=>{let l=0;t.subscribe(sn(r,f=>e.call(n,f,l++)&&r.next(f)))})}function z0(e){return ui((n,t)=>{let r=!1;n.subscribe(sn(t,l=>{r=!0,t.next(l)},()=>{r||t.next(e),t.complete()}))})}function gS(e=_z){return ui((n,t)=>{let r=!1;n.subscribe(sn(t,l=>{r=!0,t.next(l)},()=>r?t.complete():t.error(e())))})}function _z(){return new F0}function $f(e,n){const t=arguments.length>=2;return r=>r.pipe(e?bh((l,f)=>e(l,f,r)):bn,Pm(1),t?z0(n):gS(()=>new F0))}function Rm(e,n){return Te(n)?fr(e,n,1):fr(e,1)}function Yo(e,n,t){const r=Te(e)||n||t?{next:e,error:n,complete:t}:e;return r?ui((l,f)=>{var y;null===(y=r.subscribe)||void 0===y||y.call(r);let C=!0;l.subscribe(sn(f,D=>{var O;null===(O=r.next)||void 0===O||O.call(r,D),f.next(D)},()=>{var D;C=!1,null===(D=r.complete)||void 0===D||D.call(r),f.complete()},D=>{var O;C=!1,null===(O=r.error)||void 0===O||O.call(r,D),f.error(D)},()=>{var D,O;C&&(null===(D=r.unsubscribe)||void 0===D||D.call(r)),null===(O=r.finalize)||void 0===O||O.call(r)}))}):bn}function Jl(e){return ui((n,t)=>{let f,r=null,l=!1;r=n.subscribe(sn(t,void 0,void 0,y=>{f=wi(e(y,Jl(e)(n))),r?(r.unsubscribe(),r=null,f.subscribe(t)):l=!0})),l&&(r.unsubscribe(),r=null,f.subscribe(t))})}function _1(e){return e<=0?()=>to:ui((n,t)=>{let r=[];n.subscribe(sn(t,l=>{r.push(l),e<r.length&&r.shift()},()=>{for(const l of r)t.next(l);t.complete()},void 0,()=>{r=null}))})}function G_(e){return ui((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const ai="primary",q_=Symbol("RouteTitle");class Ez{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Lm(e){return new Ez(e)}function Cz(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const l={};for(let f=0;f<r.length;f++){const y=r[f],C=e[f];if(y.startsWith(":"))l[y.substring(1)]=C;else if(y!==C.path)return null}return{consumed:e.slice(0,r.length),posParams:l}}function xu(e,n){const t=e?Object.keys(e):void 0,r=n?Object.keys(n):void 0;if(!t||!r||t.length!=r.length)return!1;let l;for(let f=0;f<t.length;f++)if(l=t[f],!_S(e[l],n[l]))return!1;return!0}function _S(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((l,f)=>r[f]===l)}return e===n}function yS(e){return e.length>0?e[e.length-1]:null}function xd(e){return function sz(e){return!!e&&(e instanceof Mn||Te(e.lift)&&Te(e.subscribe))}(e)?e:S_(e)?et(Promise.resolve(e)):dn(e)}const Dz={exact:function bS(e,n,t){if(!Hf(e.segments,n.segments)||!B0(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!bS(e.children[r],n.children[r],t))return!1;return!0},subset:wS},vS={exact:function Mz(e,n){return xu(e,n)},subset:function Sz(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>_S(e[t],n[t]))},ignored:()=>!0};function xS(e,n,t){return Dz[t.paths](e.root,n.root,t.matrixParams)&&vS[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function wS(e,n,t){return ES(e,n,n.segments,t)}function ES(e,n,t,r){if(e.segments.length>t.length){const l=e.segments.slice(0,t.length);return!(!Hf(l,t)||n.hasChildren()||!B0(l,t,r))}if(e.segments.length===t.length){if(!Hf(e.segments,t)||!B0(e.segments,t,r))return!1;for(const l in n.children)if(!e.children[l]||!wS(e.children[l],n.children[l],r))return!1;return!0}{const l=t.slice(0,e.segments.length),f=t.slice(e.segments.length);return!!(Hf(e.segments,l)&&B0(e.segments,l,r)&&e.children[ai])&&ES(e.children[ai],n,f,r)}}function B0(e,n,t){return n.every((r,l)=>vS[t](e[l].parameters,r.parameters))}class km{constructor(n=new dr([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Lm(this.queryParams)),this._queryParamMap}toString(){return Pz.serialize(this)}}class dr{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return V0(this)}}class Z_{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Lm(this.parameters)),this._parameterMap}toString(){return DS(this)}}function Hf(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let W_=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return new y1},providedIn:"root"})}return e})();class y1{parse(n){const t=new jz(n);return new km(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${X_(n.root,!0)}`,r=function kz(e){const n=Object.keys(e).map(t=>{const r=e[t];return Array.isArray(r)?r.map(l=>`${U0(t)}=${U0(l)}`).join("&"):`${U0(t)}=${U0(r)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function Rz(e){return encodeURI(e)}(n.fragment)}`:""}`}}const Pz=new y1;function V0(e){return e.segments.map(n=>DS(n)).join("/")}function X_(e,n){if(!e.hasChildren())return V0(e);if(n){const t=e.children[ai]?X_(e.children[ai],!1):"",r=[];return Object.entries(e.children).forEach(([l,f])=>{l!==ai&&r.push(`${l}:${X_(f,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function Az(e,n){let t=[];return Object.entries(e.children).forEach(([r,l])=>{r===ai&&(t=t.concat(n(l,r)))}),Object.entries(e.children).forEach(([r,l])=>{r!==ai&&(t=t.concat(n(l,r)))}),t}(e,(r,l)=>l===ai?[X_(e.children[ai],!1)]:[`${l}:${X_(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[ai]?`${V0(e)}/${t[0]}`:`${V0(e)}/(${t.join("//")})`}}function CS(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function U0(e){return CS(e).replace(/%3B/gi,";")}function v1(e){return CS(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function j0(e){return decodeURIComponent(e)}function TS(e){return j0(e.replace(/\+/g,"%20"))}function DS(e){return`${v1(e.path)}${function Lz(e){return Object.keys(e).map(n=>`;${v1(n)}=${v1(e[n])}`).join("")}(e.parameters)}`}const Oz=/^[^\/()?;#]+/;function x1(e){const n=e.match(Oz);return n?n[0]:""}const Nz=/^[^\/()?;=#]+/,zz=/^[^=?&#]+/,Vz=/^[^&#]+/;class jz{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new dr([],{}):new dr([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[ai]=new dr(n,t)),r}parseSegment(){const n=x1(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Et(4009,!1);return this.capture(n),new Z_(j0(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function Fz(e){const n=e.match(Nz);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const l=x1(this.remaining);l&&(r=l,this.capture(r))}n[j0(t)]=j0(r)}parseQueryParam(n){const t=function Bz(e){const n=e.match(zz);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const y=function Uz(e){const n=e.match(Vz);return n?n[0]:""}(this.remaining);y&&(r=y,this.capture(r))}const l=TS(t),f=TS(r);if(n.hasOwnProperty(l)){let y=n[l];Array.isArray(y)||(y=[y],n[l]=y),y.push(f)}else n[l]=f}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=x1(this.remaining),l=this.remaining[r.length];if("/"!==l&&")"!==l&&";"!==l)throw new Et(4010,!1);let f;r.indexOf(":")>-1?(f=r.slice(0,r.indexOf(":")),this.capture(f),this.capture(":")):n&&(f=ai);const y=this.parseChildren();t[f]=1===Object.keys(y).length?y[ai]:new dr([],y),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Et(4011,!1)}}function MS(e){return e.segments.length>0?new dr([],{[ai]:e}):e}function SS(e){const n={};for(const r of Object.keys(e.children)){const f=SS(e.children[r]);if(r===ai&&0===f.segments.length&&f.hasChildren())for(const[y,C]of Object.entries(f.children))n[y]=C;else(f.segments.length>0||f.hasChildren())&&(n[r]=f)}return function $z(e){if(1===e.numberOfChildren&&e.children[ai]){const n=e.children[ai];return new dr(e.segments.concat(n.segments),n.children)}return e}(new dr(e.segments,n))}function Gf(e){return e instanceof km}function IS(e){let n;const l=MS(function t(f){const y={};for(const D of f.children){const O=t(D);y[D.outlet]=O}const C=new dr(f.url,y);return f===e&&(n=C),C}(e.root));return n??l}function AS(e,n,t,r){let l=e;for(;l.parent;)l=l.parent;if(0===n.length)return b1(l,l,l,t,r);const f=function Gz(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new RS(!0,0,e);let n=0,t=!1;const r=e.reduce((l,f,y)=>{if("object"==typeof f&&null!=f){if(f.outlets){const C={};return Object.entries(f.outlets).forEach(([D,O])=>{C[D]="string"==typeof O?O.split("/"):O}),[...l,{outlets:C}]}if(f.segmentPath)return[...l,f.segmentPath]}return"string"!=typeof f?[...l,f]:0===y?(f.split("/").forEach((C,D)=>{0==D&&"."===C||(0==D&&""===C?t=!0:".."===C?n++:""!=C&&l.push(C))}),l):[...l,f]},[]);return new RS(t,n,r)}(n);if(f.toRoot())return b1(l,l,new dr([],{}),t,r);const y=function qz(e,n,t){if(e.isAbsolute)return new H0(n,!0,0);if(!t)return new H0(n,!1,NaN);if(null===t.parent)return new H0(t,!0,0);const r=$0(e.commands[0])?0:1;return function Zz(e,n,t){let r=e,l=n,f=t;for(;f>l;){if(f-=l,r=r.parent,!r)throw new Et(4005,!1);l=r.segments.length}return new H0(r,!1,l-f)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(f,l,e),C=y.processChildren?K_(y.segmentGroup,y.index,f.commands):LS(y.segmentGroup,y.index,f.commands);return b1(l,y.segmentGroup,C,t,r)}function $0(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Y_(e){return"object"==typeof e&&null!=e&&e.outlets}function b1(e,n,t,r,l){let y,f={};r&&Object.entries(r).forEach(([D,O])=>{f[D]=Array.isArray(O)?O.map($=>`${$}`):`${O}`}),y=e===n?t:PS(e,n,t);const C=MS(SS(y));return new km(C,f,l)}function PS(e,n,t){const r={};return Object.entries(e.children).forEach(([l,f])=>{r[l]=f===n?t:PS(f,n,t)}),new dr(e.segments,r)}class RS{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&$0(r[0]))throw new Et(4003,!1);const l=r.find(Y_);if(l&&l!==yS(r))throw new Et(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class H0{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function LS(e,n,t){if(e||(e=new dr([],{})),0===e.segments.length&&e.hasChildren())return K_(e,n,t);const r=function Xz(e,n,t){let r=0,l=n;const f={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(r>=t.length)return f;const y=e.segments[l],C=t[r];if(Y_(C))break;const D=`${C}`,O=r<t.length-1?t[r+1]:null;if(l>0&&void 0===D)break;if(D&&O&&"object"==typeof O&&void 0===O.outlets){if(!OS(D,O,y))return f;r+=2}else{if(!OS(D,{},y))return f;r++}l++}return{match:!0,pathIndex:l,commandIndex:r}}(e,n,t),l=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const f=new dr(e.segments.slice(0,r.pathIndex),{});return f.children[ai]=new dr(e.segments.slice(r.pathIndex),e.children),K_(f,0,l)}return r.match&&0===l.length?new dr(e.segments,{}):r.match&&!e.hasChildren()?w1(e,n,t):r.match?K_(e,0,l):w1(e,n,t)}function K_(e,n,t){if(0===t.length)return new dr(e.segments,{});{const r=function Wz(e){return Y_(e[0])?e[0].outlets:{[ai]:e}}(t),l={};if(Object.keys(r).some(f=>f!==ai)&&e.children[ai]&&1===e.numberOfChildren&&0===e.children[ai].segments.length){const f=K_(e.children[ai],n,t);return new dr(e.segments,f.children)}return Object.entries(r).forEach(([f,y])=>{"string"==typeof y&&(y=[y]),null!==y&&(l[f]=LS(e.children[f],n,y))}),Object.entries(e.children).forEach(([f,y])=>{void 0===r[f]&&(l[f]=y)}),new dr(e.segments,l)}}function w1(e,n,t){const r=e.segments.slice(0,n);let l=0;for(;l<t.length;){const f=t[l];if(Y_(f)){const D=Yz(f.outlets);return new dr(r,D)}if(0===l&&$0(t[0])){r.push(new Z_(e.segments[n].path,kS(t[0]))),l++;continue}const y=Y_(f)?f.outlets[ai]:`${f}`,C=l<t.length-1?t[l+1]:null;y&&C&&$0(C)?(r.push(new Z_(y,kS(C))),l+=2):(r.push(new Z_(y,{})),l++)}return new dr(r,{})}function Yz(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=w1(new dr([],{}),0,r))}),n}function kS(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function OS(e,n,t){return e==t.path&&xu(n,t.parameters)}const J_="imperative";class bu{constructor(n,t){this.id=n,this.url=t}}class G0 extends bu{constructor(n,t,r="imperative",l=null){super(n,t),this.type=0,this.navigationTrigger=r,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class bd extends bu{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Q_ extends bu{constructor(n,t,r,l){super(n,t),this.reason=r,this.code=l,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Om extends bu{constructor(n,t,r,l){super(n,t),this.reason=r,this.code=l,this.type=16}}class q0 extends bu{constructor(n,t,r,l){super(n,t),this.error=r,this.target=l,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class NS extends bu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Kz extends bu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Jz extends bu{constructor(n,t,r,l,f){super(n,t),this.urlAfterRedirects=r,this.state=l,this.shouldActivate=f,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Qz extends bu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class eB extends bu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class tB{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class nB{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class iB{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class rB{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class oB{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class sB{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class FS{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class E1{}class C1{constructor(n){this.url=n}}class aB{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ey,this.attachRef=null}}let ey=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const l=this.getOrCreateContext(t);l.outlet=r,this.contexts.set(t,l)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new aB,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class zS{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=T1(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=T1(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=D1(n,this._root);return t.length<2?[]:t[t.length-2].children.map(l=>l.value).filter(l=>l!==n)}pathFromRoot(n){return D1(n,this._root).map(t=>t.value)}}function T1(e,n){if(e===n.value)return n;for(const t of n.children){const r=T1(e,t);if(r)return r}return null}function D1(e,n){if(e===n.value)return[n];for(const t of n.children){const r=D1(e,t);if(r.length)return r.unshift(n),r}return[]}class wh{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Nm(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class BS extends zS{constructor(n,t){super(n),this.snapshot=t,M1(this,n)}toString(){return this.snapshot.toString()}}function VS(e,n){const t=function lB(e,n){const y=new Z0([],{},{},"",{},ai,n,null,{});return new jS("",new wh(y,[]))}(0,n),r=new fn([new Z_("",{})]),l=new fn({}),f=new fn({}),y=new fn({}),C=new fn(""),D=new wd(r,l,y,C,f,ai,n,t.root);return D.snapshot=t.root,new BS(new wh(D,[]),t)}class wd{constructor(n,t,r,l,f,y,C,D){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=l,this.dataSubject=f,this.outlet=y,this.component=C,this._futureSnapshot=D,this.title=this.dataSubject?.pipe(Nn(O=>O[q_]))??dn(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=l,this.data=f}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Nn(n=>Lm(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Nn(n=>Lm(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function US(e,n="emptyOnly"){const t=e.pathFromRoot;let r=0;if("always"!==n)for(r=t.length-1;r>=1;){const l=t[r],f=t[r-1];if(l.routeConfig&&""===l.routeConfig.path)r--;else{if(f.component)break;r--}}return function cB(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Z0{get title(){return this.data?.[q_]}constructor(n,t,r,l,f,y,C,D,O){this.url=n,this.params=t,this.queryParams=r,this.fragment=l,this.data=f,this.outlet=y,this.component=C,this.routeConfig=D,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Lm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Lm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class jS extends zS{constructor(n,t){super(t),this.url=n,M1(this,t)}toString(){return $S(this._root)}}function M1(e,n){n.value._routerState=e,n.children.forEach(t=>M1(e,t))}function $S(e){const n=e.children.length>0?` { ${e.children.map($S).join(", ")} } `:"";return`${e.value}${n}`}function S1(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,xu(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),xu(n.params,t.params)||e.paramsSubject.next(t.params),function Tz(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!xu(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),xu(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function I1(e,n){const t=xu(e.params,n.params)&&function Iz(e,n){return Hf(e,n)&&e.every((t,r)=>xu(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||I1(e.parent,n.parent))}let A1=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=ai,this.activateEvents=new s,this.deactivateEvents=new s,this.attachEvents=new s,this.detachEvents=new s,this.parentContexts=Qt(ey),this.location=Qt(Lc),this.changeDetector=Qt(v0),this.environmentInjector=Qt(Xo),this.inputBinder=Qt(W0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:l}=t.name;if(r)return;this.isTrackedInParentContexts(l)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(l)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Et(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Et(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Et(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Et(4013,!1);this._activatedRoute=t;const l=this.location,y=t.snapshot.component,C=this.parentContexts.getOrCreateContext(this.name).children,D=new uB(t,C,l.injector);this.activated=l.createComponent(y,{index:l.length,injector:D,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=An({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Wt]})}return e})();class uB{constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===wd?this.route:n===ey?this.childContexts:this.parent.get(n,t)}}const W0=new qt("");let HS=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,l=p1([r.queryParams,r.params,r.data]).pipe($i(([f,y,C],D)=>(C={...f,...y,...C},0===D?dn(C):Promise.resolve(C)))).subscribe(f=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const y=function FO(e){const n=ei(e);if(!n)return null;const t=new E_(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(y)for(const{templateName:C}of y.inputs)t.activatedComponentRef.setInput(C,f[C]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,l)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();function ty(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const l=function dB(e,n,t){return n.children.map(r=>{for(const l of t.children)if(e.shouldReuseRoute(r.value,l.value.snapshot))return ty(e,r,l);return ty(e,r)})}(e,n,t);return new wh(r,l)}{if(e.shouldAttach(n.value)){const f=e.retrieve(n.value);if(null!==f){const y=f.route;return y.value._futureSnapshot=n.value,y.children=n.children.map(C=>ty(e,C)),y}}const r=function fB(e){return new wd(new fn(e.url),new fn(e.params),new fn(e.queryParams),new fn(e.fragment),new fn(e.data),e.outlet,e.component,e)}(n.value),l=n.children.map(f=>ty(e,f));return new wh(r,l)}}const P1="ngNavigationCancelingError";function GS(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=Gf(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,l=qS(!1,0,n);return l.url=t,l.navigationBehaviorOptions=r,l}function qS(e,n,t){const r=new Error("NavigationCancelingError: "+(e||""));return r[P1]=!0,r.cancellationCode=n,t&&(r.url=t),r}function ZS(e){return e&&e[P1]}let WS=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["ng-component"]],standalone:!0,features:[qT],decls:1,vars:0,template:function(r,l){1&r&&yo(0,"router-outlet")},dependencies:[A1],encapsulation:2})}return e})();function R1(e){const n=e.children&&e.children.map(R1),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==ai&&(t.component=WS),t}function Nc(e){return e.outlet||ai}function ny(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class bB{constructor(n,t,r,l,f){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=l,this.inputBindingEnabled=f}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),S1(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const l=Nm(t);n.children.forEach(f=>{const y=f.value.outlet;this.deactivateRoutes(f,l[y],r),delete l[y]}),Object.values(l).forEach(f=>{this.deactivateRouteAndItsChildren(f,r)})}deactivateRoutes(n,t,r){const l=n.value,f=t?t.value:null;if(l===f)if(l.component){const y=r.getContext(l.outlet);y&&this.deactivateChildRoutes(n,t,y.children)}else this.deactivateChildRoutes(n,t,r);else f&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),l=r&&n.value.component?r.children:t,f=Nm(n);for(const y of Object.keys(f))this.deactivateRouteAndItsChildren(f[y],l);if(r&&r.outlet){const y=r.outlet.detach(),C=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:y,route:n,contexts:C})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),l=r&&n.value.component?r.children:t,f=Nm(n);for(const y of Object.keys(f))this.deactivateRouteAndItsChildren(f[y],l);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const l=Nm(t);n.children.forEach(f=>{this.activateRoutes(f,l[f.value.outlet],r),this.forwardEvent(new sB(f.value.snapshot))}),n.children.length&&this.forwardEvent(new rB(n.value.snapshot))}activateRoutes(n,t,r){const l=n.value,f=t?t.value:null;if(S1(l),l===f)if(l.component){const y=r.getOrCreateContext(l.outlet);this.activateChildRoutes(n,t,y.children)}else this.activateChildRoutes(n,t,r);else if(l.component){const y=r.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const C=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(C.contexts),y.attachRef=C.componentRef,y.route=C.route.value,y.outlet&&y.outlet.attach(C.componentRef,C.route.value),S1(C.route.value),this.activateChildRoutes(n,null,y.children)}else{const C=ny(l.snapshot);y.attachRef=null,y.route=l,y.injector=C,y.outlet&&y.outlet.activateWith(l,y.injector),this.activateChildRoutes(n,null,y.children)}}else this.activateChildRoutes(n,null,r)}}class XS{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class X0{constructor(n,t){this.component=n,this.route=t}}function wB(e,n,t){const r=e._root;return iy(r,n?n._root:null,t,[r.value])}function Fm(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function Tl(e){return null!==Vs(e)}(e)?n.get(e):e:r}function iy(e,n,t,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const f=Nm(n);return e.children.forEach(y=>{(function CB(e,n,t,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const f=e.value,y=n?n.value:null,C=t?t.getContext(e.value.outlet):null;if(y&&f.routeConfig===y.routeConfig){const D=function TB(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!Hf(e.url,n.url);case"pathParamsOrQueryParamsChange":return!Hf(e.url,n.url)||!xu(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!I1(e,n)||!xu(e.queryParams,n.queryParams);default:return!I1(e,n)}}(y,f,f.routeConfig.runGuardsAndResolvers);D?l.canActivateChecks.push(new XS(r)):(f.data=y.data,f._resolvedData=y._resolvedData),iy(e,n,f.component?C?C.children:null:t,r,l),D&&C&&C.outlet&&C.outlet.isActivated&&l.canDeactivateChecks.push(new X0(C.outlet.component,y))}else y&&ry(n,C,l),l.canActivateChecks.push(new XS(r)),iy(e,null,f.component?C?C.children:null:t,r,l)})(y,f[y.value.outlet],t,r.concat([y.value]),l),delete f[y.value.outlet]}),Object.entries(f).forEach(([y,C])=>ry(C,t.getContext(y),l)),l}function ry(e,n,t){const r=Nm(e),l=e.value;Object.entries(r).forEach(([f,y])=>{ry(y,l.component?n?n.children.getContext(f):null:n,t)}),t.canDeactivateChecks.push(new X0(l.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,l))}function oy(e){return"function"==typeof e}function YS(e){return e instanceof F0||"EmptyError"===e?.name}const Y0=Symbol("INITIAL_VALUE");function zm(){return $i(e=>p1(e.map(n=>n.pipe(Pm(1),function gz(...e){const n=fo(e);return ui((t,r)=>{(n?m1(e,t,n):m1(e,t)).subscribe(r)})}(Y0)))).pipe(Nn(n=>{for(const t of n)if(!0!==t){if(t===Y0)return Y0;if(!1===t||t instanceof km)return t}return!0}),bh(n=>n!==Y0),Pm(1)))}function KS(e){return function Ji(...e){return un(e)}(Yo(n=>{if(Gf(n))throw GS(0,n)}),Nn(n=>!0===n))}class K0{constructor(n){this.segmentGroup=n||null}}class JS{constructor(n){this.urlTree=n}}function Bm(e){return vu(new K0(e))}function QS(e){return vu(new JS(e))}class GB{constructor(n,t){this.urlSerializer=n,this.urlTree=t}noMatchError(n){return new Et(4002,!1)}lineralizeSegments(n,t){let r=[],l=t.root;for(;;){if(r=r.concat(l.segments),0===l.numberOfChildren)return dn(r);if(l.numberOfChildren>1||!l.children[ai])return vu(new Et(4e3,!1));l=l.children[ai]}}applyRedirectCommands(n,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r)}applyRedirectCreateUrlTree(n,t,r,l){const f=this.createSegmentGroup(n,t.root,r,l);return new km(f,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([l,f])=>{if("string"==typeof f&&f.startsWith(":")){const C=f.substring(1);r[l]=t[C]}else r[l]=f}),r}createSegmentGroup(n,t,r,l){const f=this.createSegments(n,t.segments,r,l);let y={};return Object.entries(t.children).forEach(([C,D])=>{y[C]=this.createSegmentGroup(n,D,r,l)}),new dr(f,y)}createSegments(n,t,r,l){return t.map(f=>f.path.startsWith(":")?this.findPosParam(n,f,l):this.findOrReturn(f,r))}findPosParam(n,t,r){const l=r[t.path.substring(1)];if(!l)throw new Et(4001,!1);return l}findOrReturn(n,t){let r=0;for(const l of t){if(l.path===n.path)return t.splice(r),l;r++}return n}}const L1={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function qB(e,n,t,r,l){const f=k1(e,n,t);return f.matched?(r=function mB(e,n){return e.providers&&!e._injector&&(e._injector=aw(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function jB(e,n,t,r){const l=n.canMatch;return l&&0!==l.length?dn(l.map(y=>{const C=Fm(y,e);return xd(function PB(e){return e&&oy(e.canMatch)}(C)?C.canMatch(n,t):e.runInContext(()=>C(n,t)))})).pipe(zm(),KS()):dn(!0)}(r,n,t).pipe(Nn(y=>!0===y?f:{...L1}))):dn(f)}function k1(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...L1}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const l=(n.matcher||Cz)(t,e,n);if(!l)return{...L1};const f={};Object.entries(l.posParams??{}).forEach(([C,D])=>{f[C]=D.path});const y=l.consumed.length>0?{...f,...l.consumed[l.consumed.length-1].parameters}:f;return{matched:!0,consumedSegments:l.consumed,remainingSegments:t.slice(l.consumed.length),parameters:y,positionalParamSegments:l.posParams??{}}}function eI(e,n,t,r){return t.length>0&&function XB(e,n,t){return t.some(r=>J0(e,n,r)&&Nc(r)!==ai)}(e,t,r)?{segmentGroup:new dr(n,WB(r,new dr(t,e.children))),slicedSegments:[]}:0===t.length&&function YB(e,n,t){return t.some(r=>J0(e,n,r))}(e,t,r)?{segmentGroup:new dr(e.segments,ZB(e,0,t,r,e.children)),slicedSegments:t}:{segmentGroup:new dr(e.segments,e.children),slicedSegments:t}}function ZB(e,n,t,r,l){const f={};for(const y of r)if(J0(e,t,y)&&!l[Nc(y)]){const C=new dr([],{});f[Nc(y)]=C}return{...l,...f}}function WB(e,n){const t={};t[ai]=n;for(const r of e)if(""===r.path&&Nc(r)!==ai){const l=new dr([],{});t[Nc(r)]=l}return t}function J0(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class e3{constructor(n,t,r,l,f,y,C){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=l,this.urlTree=f,this.paramsInheritanceStrategy=y,this.urlSerializer=C,this.allowRedirects=!0,this.applyRedirects=new GB(this.urlSerializer,this.urlTree)}noMatchError(n){return new Et(4002,!1)}recognize(){const n=eI(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,ai).pipe(Jl(t=>{if(t instanceof JS)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof K0?this.noMatchError(t):t}),Nn(t=>{const r=new Z0([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ai,this.rootComponentType,null,{}),l=new wh(r,t),f=new jS("",l),y=function Hz(e,n,t=null,r=null){return AS(IS(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,f.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(f._root),{state:f,tree:y}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,ai).pipe(Jl(r=>{throw r instanceof K0?this.noMatchError(r):r}))}inheritParamsAndData(n){const t=n.value,r=US(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),n.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(n,t,r,l){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r):this.processSegment(n,t,r,r.segments,l,!0)}processChildren(n,t,r){const l=[];for(const f of Object.keys(r.children))"primary"===f?l.unshift(f):l.push(f);return et(l).pipe(Rm(f=>{const y=r.children[f],C=function vB(e,n){const t=e.filter(r=>Nc(r)===n);return t.push(...e.filter(r=>Nc(r)!==n)),t}(t,f);return this.processSegmentGroup(n,C,y,f)}),function vz(e,n){return ui(function yz(e,n,t,r,l){return(f,y)=>{let C=t,D=n,O=0;f.subscribe(sn(y,$=>{const W=O++;D=C?e(D,$,W):(C=!0,$),r&&y.next(D)},l&&(()=>{C&&y.next(D),y.complete()})))}}(e,n,arguments.length>=2,!0))}((f,y)=>(f.push(...y),f)),z0(null),function xz(e,n){const t=arguments.length>=2;return r=>r.pipe(e?bh((l,f)=>e(l,f,r)):bn,_1(1),t?z0(n):gS(()=>new F0))}(),fr(f=>{if(null===f)return Bm(r);const y=tI(f);return function t3(e){e.sort((n,t)=>n.value.outlet===ai?-1:t.value.outlet===ai?1:n.value.outlet.localeCompare(t.value.outlet))}(y),dn(y)}))}processSegment(n,t,r,l,f,y){return et(t).pipe(Rm(C=>this.processSegmentAgainstRoute(C._injector??n,t,C,r,l,f,y).pipe(Jl(D=>{if(D instanceof K0)return dn(null);throw D}))),$f(C=>!!C),Jl(C=>{if(YS(C))return function JB(e,n,t){return 0===n.length&&!e.children[t]}(r,l,f)?dn([]):Bm(r);throw C}))}processSegmentAgainstRoute(n,t,r,l,f,y,C){return function KB(e,n,t,r){return!!(Nc(e)===r||r!==ai&&J0(n,t,e))&&("**"===e.path||k1(n,e,t).matched)}(r,l,f,y)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,l,r,f,y,C):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,l,t,r,f,y):Bm(l):Bm(l)}expandSegmentAgainstRouteUsingRedirect(n,t,r,l,f,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,l,f,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,r,l){const f=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?QS(f):this.applyRedirects.lineralizeSegments(r,f).pipe(fr(y=>{const C=new dr(y,{});return this.processSegment(n,t,C,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,l,f,y){const{matched:C,consumedSegments:D,remainingSegments:O,positionalParamSegments:$}=k1(t,l,f);if(!C)return Bm(t);const W=this.applyRedirects.applyRedirectCommands(D,l.redirectTo,$);return l.redirectTo.startsWith("/")?QS(W):this.applyRedirects.lineralizeSegments(l,W).pipe(fr(oe=>this.processSegment(n,r,t,oe.concat(O),y,!1)))}matchSegmentAgainstRoute(n,t,r,l,f,y){let C;if("**"===r.path){const D=l.length>0?yS(l).parameters:{};C=dn({snapshot:new Z0(l,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,nI(r),Nc(r),r.component??r._loadedComponent??null,r,iI(r)),consumedSegments:[],remainingSegments:[]}),t.children={}}else C=qB(t,r,l,n).pipe(Nn(({matched:D,consumedSegments:O,remainingSegments:$,parameters:W})=>D?{snapshot:new Z0(O,W,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,nI(r),Nc(r),r.component??r._loadedComponent??null,r,iI(r)),consumedSegments:O,remainingSegments:$}:null));return C.pipe($i(D=>null===D?Bm(t):this.getChildConfig(n=r._injector??n,r,l).pipe($i(({routes:O})=>{const $=r._loadedInjector??n,{snapshot:W,consumedSegments:oe,remainingSegments:ve}=D,{segmentGroup:qe,slicedSegments:Ke}=eI(t,oe,ve,O);if(0===Ke.length&&qe.hasChildren())return this.processChildren($,O,qe).pipe(Nn(zt=>null===zt?null:[new wh(W,zt)]));if(0===O.length&&0===Ke.length)return dn([new wh(W,[])]);const ht=Nc(r)===f;return this.processSegment($,O,qe,Ke,ht?ai:f,!0).pipe(Nn(zt=>[new wh(W,zt)]))}))))}getChildConfig(n,t,r){return t.children?dn({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?dn({routes:t._loadedRoutes,injector:t._loadedInjector}):function UB(e,n,t,r){const l=n.canLoad;return void 0===l||0===l.length?dn(!0):dn(l.map(y=>{const C=Fm(y,e);return xd(function MB(e){return e&&oy(e.canLoad)}(C)?C.canLoad(n,t):e.runInContext(()=>C(n,t)))})).pipe(zm(),KS())}(n,t,r).pipe(fr(l=>l?this.configLoader.loadChildren(n,t).pipe(Yo(f=>{t._loadedRoutes=f.routes,t._loadedInjector=f.injector})):function HB(e){return vu(qS(!1,3))}())):dn({routes:[],injector:n})}}function n3(e){const n=e.value.routeConfig;return n&&""===n.path}function tI(e){const n=[],t=new Set;for(const r of e){if(!n3(r)){n.push(r);continue}const l=n.find(f=>r.value.routeConfig===f.value.routeConfig);void 0!==l?(l.children.push(...r.children),t.add(l)):n.push(r)}for(const r of t){const l=tI(r.children);n.push(new wh(r.value,l))}return n.filter(r=>!t.has(r))}function nI(e){return e.data||{}}function iI(e){return e.resolve||{}}function rI(e){return"string"==typeof e.title||null===e.title}function O1(e){return $i(n=>{const t=e(n);return t?et(t).pipe(Nn(()=>n)):dn(n)})}const Vm=new qt("ROUTES");let N1=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Qt(BD)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return dn(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=xd(t.loadComponent()).pipe(Nn(oI),Yo(f=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=f}),G_(()=>{this.componentLoaders.delete(t)})),l=new mS(r,()=>new Tn).pipe(g1());return this.componentLoaders.set(t,l),l}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return dn({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const f=function c3(e,n,t,r){return xd(e.loadChildren()).pipe(Nn(oI),fr(l=>l instanceof HT||Array.isArray(l)?dn(l):et(n.compileModuleAsync(l))),Nn(l=>{r&&r(e);let f,y,C=!1;return Array.isArray(l)?(y=l,!0):(f=l.create(t).injector,y=f.get(Vm,[],{optional:!0,self:!0}).flat()),{routes:y.map(R1),injector:f}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(G_(()=>{this.childrenLoaders.delete(r)})),y=new mS(f,()=>new Tn).pipe(g1());return this.childrenLoaders.set(r,y),y}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function oI(e){return function u3(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let Q0=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Tn,this.transitionAbortSubject=new Tn,this.configLoader=Qt(N1),this.environmentInjector=Qt(Xo),this.urlSerializer=Qt(W_),this.rootContexts=Qt(ey),this.inputBindingEnabled=null!==Qt(W0,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>dn(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=l=>this.events.next(new nB(l)),this.configLoader.onLoadStartListener=l=>this.events.next(new tB(l))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,l){return this.transitions=new fn({id:0,currentUrlTree:r,currentRawUrl:r,currentBrowserUrl:r,extractedUrl:t.urlHandlingStrategy.extract(r),urlAfterRedirects:t.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:J_,restoredState:null,currentSnapshot:l.snapshot,targetSnapshot:null,currentRouterState:l,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(bh(f=>0!==f.id),Nn(f=>({...f,extractedUrl:t.urlHandlingStrategy.extract(f.rawUrl)})),$i(f=>{this.currentTransition=f;let y=!1,C=!1;return dn(f).pipe(Yo(D=>{this.currentNavigation={id:D.id,initialUrl:D.rawUrl,extractedUrl:D.extractedUrl,trigger:D.source,extras:D.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),$i(D=>{const O=D.currentBrowserUrl.toString(),$=!t.navigated||D.extractedUrl.toString()!==O||O!==D.currentUrlTree.toString();if(!$&&"reload"!==(D.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const oe="";return this.events.next(new Om(D.id,this.urlSerializer.serialize(D.rawUrl),oe,0)),D.resolve(null),to}if(t.urlHandlingStrategy.shouldProcessUrl(D.rawUrl))return dn(D).pipe($i(oe=>{const ve=this.transitions?.getValue();return this.events.next(new G0(oe.id,this.urlSerializer.serialize(oe.extractedUrl),oe.source,oe.restoredState)),ve!==this.transitions?.getValue()?to:Promise.resolve(oe)}),function i3(e,n,t,r,l,f){return fr(y=>function QB(e,n,t,r,l,f,y="emptyOnly"){return new e3(e,n,t,r,l,y,f).recognize()}(e,n,t,r,y.extractedUrl,l,f).pipe(Nn(({state:C,tree:D})=>({...y,targetSnapshot:C,urlAfterRedirects:D}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),Yo(oe=>{f.targetSnapshot=oe.targetSnapshot,f.urlAfterRedirects=oe.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:oe.urlAfterRedirects};const ve=new NS(oe.id,this.urlSerializer.serialize(oe.extractedUrl),this.urlSerializer.serialize(oe.urlAfterRedirects),oe.targetSnapshot);this.events.next(ve)}));if($&&t.urlHandlingStrategy.shouldProcessUrl(D.currentRawUrl)){const{id:oe,extractedUrl:ve,source:qe,restoredState:Ke,extras:ht}=D,zt=new G0(oe,this.urlSerializer.serialize(ve),qe,Ke);this.events.next(zt);const lt=VS(0,this.rootComponentType).snapshot;return this.currentTransition=f={...D,targetSnapshot:lt,urlAfterRedirects:ve,extras:{...ht,skipLocationChange:!1,replaceUrl:!1}},dn(f)}{const oe="";return this.events.next(new Om(D.id,this.urlSerializer.serialize(D.extractedUrl),oe,1)),D.resolve(null),to}}),Yo(D=>{const O=new Kz(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(O)}),Nn(D=>(this.currentTransition=f={...D,guards:wB(D.targetSnapshot,D.currentSnapshot,this.rootContexts)},f)),function LB(e,n){return fr(t=>{const{targetSnapshot:r,currentSnapshot:l,guards:{canActivateChecks:f,canDeactivateChecks:y}}=t;return 0===y.length&&0===f.length?dn({...t,guardsResult:!0}):function kB(e,n,t,r){return et(e).pipe(fr(l=>function VB(e,n,t,r,l){const f=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return f&&0!==f.length?dn(f.map(C=>{const D=ny(n)??l,O=Fm(C,D);return xd(function AB(e){return e&&oy(e.canDeactivate)}(O)?O.canDeactivate(e,n,t,r):D.runInContext(()=>O(e,n,t,r))).pipe($f())})).pipe(zm()):dn(!0)}(l.component,l.route,t,n,r)),$f(l=>!0!==l,!0))}(y,r,l,e).pipe(fr(C=>C&&function DB(e){return"boolean"==typeof e}(C)?function OB(e,n,t,r){return et(n).pipe(Rm(l=>m1(function FB(e,n){return null!==e&&n&&n(new iB(e)),dn(!0)}(l.route.parent,r),function NB(e,n){return null!==e&&n&&n(new oB(e)),dn(!0)}(l.route,r),function BB(e,n,t){const r=n[n.length-1],f=n.slice(0,n.length-1).reverse().map(y=>function EB(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(y)).filter(y=>null!==y).map(y=>pS(()=>dn(y.guards.map(D=>{const O=ny(y.node)??t,$=Fm(D,O);return xd(function IB(e){return e&&oy(e.canActivateChild)}($)?$.canActivateChild(r,e):O.runInContext(()=>$(r,e))).pipe($f())})).pipe(zm())));return dn(f).pipe(zm())}(e,l.path,t),function zB(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return dn(!0);const l=r.map(f=>pS(()=>{const y=ny(n)??t,C=Fm(f,y);return xd(function SB(e){return e&&oy(e.canActivate)}(C)?C.canActivate(n,e):y.runInContext(()=>C(n,e))).pipe($f())}));return dn(l).pipe(zm())}(e,l.route,t))),$f(l=>!0!==l,!0))}(r,f,e,n):dn(C)),Nn(C=>({...t,guardsResult:C})))})}(this.environmentInjector,D=>this.events.next(D)),Yo(D=>{if(f.guardsResult=D.guardsResult,Gf(D.guardsResult))throw GS(0,D.guardsResult);const O=new Jz(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot,!!D.guardsResult);this.events.next(O)}),bh(D=>!!D.guardsResult||(this.cancelNavigationTransition(D,"",3),!1)),O1(D=>{if(D.guards.canActivateChecks.length)return dn(D).pipe(Yo(O=>{const $=new Qz(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next($)}),$i(O=>{let $=!1;return dn(O).pipe(function r3(e,n){return fr(t=>{const{targetSnapshot:r,guards:{canActivateChecks:l}}=t;if(!l.length)return dn(t);let f=0;return et(l).pipe(Rm(y=>function o3(e,n,t,r){const l=e.routeConfig,f=e._resolve;return void 0!==l?.title&&!rI(l)&&(f[q_]=l.title),function s3(e,n,t,r){const l=function a3(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===l.length)return dn({});const f={};return et(l).pipe(fr(y=>function l3(e,n,t,r){const l=ny(n)??r,f=Fm(e,l);return xd(f.resolve?f.resolve(n,t):l.runInContext(()=>f(n,t)))}(e[y],n,t,r).pipe($f(),Yo(C=>{f[y]=C}))),_1(1),function bz(e){return Nn(()=>e)}(f),Jl(y=>YS(y)?to:vu(y)))}(f,e,n,r).pipe(Nn(y=>(e._resolvedData=y,e.data=US(e,t).resolve,l&&rI(l)&&(e.data[q_]=l.title),null)))}(y.route,r,e,n)),Yo(()=>f++),_1(1),fr(y=>f===l.length?dn(t):to))})}(t.paramsInheritanceStrategy,this.environmentInjector),Yo({next:()=>$=!0,complete:()=>{$||this.cancelNavigationTransition(O,"",2)}}))}),Yo(O=>{const $=new eB(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next($)}))}),O1(D=>{const O=$=>{const W=[];$.routeConfig?.loadComponent&&!$.routeConfig._loadedComponent&&W.push(this.configLoader.loadComponent($.routeConfig).pipe(Yo(oe=>{$.component=oe}),Nn(()=>{})));for(const oe of $.children)W.push(...O(oe));return W};return p1(O(D.targetSnapshot.root)).pipe(z0(),Pm(1))}),O1(()=>this.afterPreactivation()),Nn(D=>{const O=function hB(e,n,t){const r=ty(e,n._root,t?t._root:void 0);return new BS(r,n)}(t.routeReuseStrategy,D.targetSnapshot,D.currentRouterState);return this.currentTransition=f={...D,targetRouterState:O},f}),Yo(()=>{this.events.next(new E1)}),((e,n,t,r)=>Nn(l=>(new bB(n,l.targetRouterState,l.currentRouterState,t,r).activate(e),l)))(this.rootContexts,t.routeReuseStrategy,D=>this.events.next(D),this.inputBindingEnabled),Pm(1),Yo({next:D=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new bd(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects))),t.titleStrategy?.updateTitle(D.targetRouterState.snapshot),D.resolve(!0)},complete:()=>{y=!0}}),function wz(e){return ui((n,t)=>{wi(e).subscribe(sn(t,()=>t.complete(),Lt)),!t.closed&&n.subscribe(t)})}(this.transitionAbortSubject.pipe(Yo(D=>{throw D}))),G_(()=>{y||C||this.cancelNavigationTransition(f,"",1),this.currentNavigation?.id===f.id&&(this.currentNavigation=null)}),Jl(D=>{if(C=!0,ZS(D))this.events.next(new Q_(f.id,this.urlSerializer.serialize(f.extractedUrl),D.message,D.cancellationCode)),function pB(e){return ZS(e)&&Gf(e.url)}(D)?this.events.next(new C1(D.url)):f.resolve(!1);else{this.events.next(new q0(f.id,this.urlSerializer.serialize(f.extractedUrl),D,f.targetSnapshot??void 0));try{f.resolve(t.errorHandler(D))}catch(O){f.reject(O)}}return to}))}))}cancelNavigationTransition(t,r,l){const f=new Q_(t.id,this.urlSerializer.serialize(t.extractedUrl),r,l);this.events.next(f),t.resolve(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function sI(e){return e!==J_}let aI=(()=>{class e{buildTitle(t){let r,l=t.root;for(;void 0!==l;)r=this.getResolvedTitleForRoute(l)??r,l=l.children.find(f=>f.outlet===ai);return r}getResolvedTitleForRoute(t){return t.data[q_]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return Qt(h3)},providedIn:"root"})}return e})(),h3=(()=>{class e extends aI{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(sS))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),d3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return Qt(p3)},providedIn:"root"})}return e})();class f3{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let p3=(()=>{class e extends f3{static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const ex=new qt("",{providedIn:"root",factory:()=>({})});let m3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:function(){return Qt(g3)},providedIn:"root"})}return e})(),g3=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var sy=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(sy||{});function lI(e,n){e.events.pipe(bh(t=>t instanceof bd||t instanceof Q_||t instanceof q0||t instanceof Om),Nn(t=>t instanceof bd||t instanceof Om?sy.COMPLETE:t instanceof Q_&&(0===t.code||1===t.code)?sy.REDIRECTING:sy.FAILED),bh(t=>t!==sy.REDIRECTING),Pm(1)).subscribe(()=>{n()})}function _3(e){throw e}function y3(e,n,t){return n.parse("/")}const v3={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},x3={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Is=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Qt(zD),this.isNgZoneEnabled=!1,this._events=new Tn,this.options=Qt(ex,{optional:!0})||{},this.pendingTasks=Qt(m0),this.errorHandler=this.options.errorHandler||_3,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||y3,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Qt(m3),this.routeReuseStrategy=Qt(d3),this.titleStrategy=Qt(aI),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Qt(Vm,{optional:!0})?.flat()??[],this.navigationTransitions=Qt(Q0),this.urlSerializer=Qt(W_),this.location=Qt(jw),this.componentInputBindingEnabled=!!Qt(W0,{optional:!0}),this.eventsSubscription=new Pe,this.isNgZoneEnabled=Qt(v)instanceof v&&v.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new km,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=VS(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const{currentTransition:l}=this.navigationTransitions;if(null===l)return void(cI(r)&&this._events.next(r));if(r instanceof G0)sI(l.source)&&(this.browserUrlTree=l.extractedUrl);else if(r instanceof Om)this.rawUrlTree=l.rawUrl;else if(r instanceof NS){if("eager"===this.urlUpdateStrategy){if(!l.extras.skipLocationChange){const f=this.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl);this.setBrowserUrl(f,l)}this.browserUrlTree=l.urlAfterRedirects}}else if(r instanceof E1)this.currentUrlTree=l.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl),this.routerState=l.targetRouterState,"deferred"===this.urlUpdateStrategy&&(l.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,l),this.browserUrlTree=l.urlAfterRedirects);else if(r instanceof Q_)0!==r.code&&1!==r.code&&(this.navigated=!0),(3===r.code||2===r.code)&&this.restoreHistory(l);else if(r instanceof C1){const f=this.urlHandlingStrategy.merge(r.url,l.currentRawUrl),y={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||sI(l.source)};this.scheduleNavigation(f,J_,null,y,{resolve:l.resolve,reject:l.reject,promise:l.promise})}r instanceof q0&&this.restoreHistory(l,!0),r instanceof bd&&(this.navigated=!0),cI(r)&&this._events.next(r)}catch(l){this.navigationTransitions.transitionAbortSubject.next(l)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),J_,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,l){const f={replaceUrl:!0},y=l?.navigationId?l:null;if(l){const D={...l};delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(f.state=D)}const C=this.parseUrl(t);this.scheduleNavigation(C,r,y,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(R1),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:l,queryParams:f,fragment:y,queryParamsHandling:C,preserveFragment:D}=r,O=D?this.currentUrlTree.fragment:y;let W,$=null;switch(C){case"merge":$={...this.currentUrlTree.queryParams,...f};break;case"preserve":$=this.currentUrlTree.queryParams;break;default:$=f||null}null!==$&&($=this.removeEmptyProps($));try{W=IS(l?l.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),W=this.currentUrlTree.root}return AS(W,t,$,O??null)}navigateByUrl(t,r={skipLocationChange:!1}){const l=Gf(t)?t:this.parseUrl(t),f=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(f,J_,null,r)}navigate(t,r={skipLocationChange:!1}){return function b3(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new Et(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(l){r=this.malformedUriErrorHandler(l,this.urlSerializer,t)}return r}isActive(t,r){let l;if(l=!0===r?{...v3}:!1===r?{...x3}:r,Gf(t))return xS(this.currentUrlTree,t,l);const f=this.parseUrl(t);return xS(this.currentUrlTree,f,l)}removeEmptyProps(t){return Object.keys(t).reduce((r,l)=>{const f=t[l];return null!=f&&(r[l]=f),r},{})}scheduleNavigation(t,r,l,f,y){if(this.disposed)return Promise.resolve(!1);let C,D,O;y?(C=y.resolve,D=y.reject,O=y.promise):O=new Promise((W,oe)=>{C=W,D=oe});const $=this.pendingTasks.add();return lI(this,()=>{queueMicrotask(()=>this.pendingTasks.remove($))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:f,resolve:C,reject:D,promise:O,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),O.catch(W=>Promise.reject(W))}setBrowserUrl(t,r){const l=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(l)||r.extras.replaceUrl){const y={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(l,"",y)}else{const f={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(l,"",f)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-this.browserPageId;0!==f?this.location.historyGo(f):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===f&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function cI(e){return!(e instanceof E1||e instanceof C1)}let tx=(()=>{class e{constructor(t,r,l,f,y,C){this.router=t,this.route=r,this.tabIndexAttribute=l,this.renderer=f,this.el=y,this.locationStrategy=C,this.href=null,this.commands=null,this.onChanges=new Tn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const D=y.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===D||"area"===D,this.isAnchorElement?this.subscription=t.events.subscribe(O=>{O instanceof bd&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,r,l,f,y){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||r||l||f||y||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function Av(e,n,t){return function xb(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?xf:Qp}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,r){const l=this.renderer,f=this.el.nativeElement;null!==r?l.setAttribute(f,t,r):l.removeAttribute(f,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Is),nt(wd),function eu(e){return function Fy(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let l=0;for(;l<r;){const f=t[l];if(qs(f))break;if(0===f)l+=2;else if("number"==typeof f)for(l++;l<r&&"string"==typeof t[l];)l++;else{if(f===n)return t[l+1];l+=2}}}return null}(Nr(),e)}("tabindex"),nt(Ua),nt(sa),nt(jf))};static#t=this.\u0275dir=An({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,l){1&r&&gi("click",function(y){return l.onClick(y.button,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey)}),2&r&&gu("target",l.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",Sm],skipLocationChange:["skipLocationChange","skipLocationChange",Sm],replaceUrl:["replaceUrl","replaceUrl",Sm],routerLink:"routerLink"},standalone:!0,features:[oC,Wt]})}return e})();class uI{}let C3=(()=>{class e{constructor(t,r,l,f,y){this.router=t,this.injector=l,this.preloadingStrategy=f,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(bh(t=>t instanceof bd),Rm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const l=[];for(const f of r){f.providers&&!f._injector&&(f._injector=aw(f.providers,t,`Route: ${f.path}`));const y=f._injector??t,C=f._loadedInjector??y;(f.loadChildren&&!f._loadedRoutes&&void 0===f.canLoad||f.loadComponent&&!f._loadedComponent)&&l.push(this.preloadConfig(y,f)),(f.children||f._loadedRoutes)&&l.push(this.processRoutes(C,f.children??f._loadedRoutes))}return et(l).pipe(ya())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let l;l=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):dn(null);const f=l.pipe(fr(y=>null===y?dn(void 0):(r._loadedRoutes=y.routes,r._loadedInjector=y.injector,this.processRoutes(y.injector??t,y.routes))));return r.loadComponent&&!r._loadedComponent?et([f,this.loader.loadComponent(r)]).pipe(ya()):f})}static#e=this.\u0275fac=function(r){return new(r||e)(rn(Is),rn(BD),rn(Xo),rn(uI),rn(N1))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const F1=new qt("");let hI=(()=>{class e{constructor(t,r,l,f,y={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=l,this.zone=f,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof G0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof bd?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Om&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof FS&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new FS(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function Cr(){throw new Error("invalid")}()};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();function Eh(e,n){return{\u0275kind:e,\u0275providers:n}}function fI(){const e=Qt(Ds);return n=>{const t=e.get(Mm);if(n!==t.components[0])return;const r=e.get(Is),l=e.get(pI);1===e.get(z1)&&r.initialNavigation(),e.get(mI,null,jn.Optional)?.setUpPreloading(),e.get(F1,null,jn.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),l.closed||(l.next(),l.complete(),l.unsubscribe())}}const pI=new qt("",{factory:()=>new Tn}),z1=new qt("",{providedIn:"root",factory:()=>1}),mI=new qt("");function S3(e){return Eh(0,[{provide:mI,useExisting:C3},{provide:uI,useExisting:e}])}const gI=new qt("ROUTER_FORROOT_GUARD"),A3=[jw,{provide:W_,useClass:y1},Is,ey,{provide:wd,useFactory:function dI(e){return e.routerState.root},deps:[Is]},N1,[]];function P3(){return new qD("Router",Is)}let _I=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[A3,[],{provide:Vm,multi:!0,useValue:t},{provide:gI,useFactory:O3,deps:[[Is,new Tp,new Dp]]},{provide:ex,useValue:r||{}},r?.useHash?{provide:jf,useClass:jO}:{provide:jf,useClass:wM},{provide:F1,useFactory:()=>{const e=Qt(sF),n=Qt(v),t=Qt(ex),r=Qt(Q0),l=Qt(W_);return t.scrollOffset&&e.setOffset(t.scrollOffset),new hI(l,r,e,n,t)}},r?.preloadingStrategy?S3(r.preloadingStrategy).\u0275providers:[],{provide:qD,multi:!0,useFactory:P3},r?.initialNavigation?N3(r):[],r?.bindToComponentInputs?Eh(8,[HS,{provide:W0,useExisting:HS}]).\u0275providers:[],[{provide:yI,useFactory:fI},{provide:Rw,multi:!0,useExisting:yI}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Vm,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)(rn(gI,8))};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({})}return e})();function O3(e){return"guarded"}function N3(e){return["disabled"===e.initialNavigation?Eh(3,[{provide:Cw,multi:!0,useFactory:()=>{const n=Qt(Is);return()=>{n.setUpLocationChangeListener()}}},{provide:z1,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Eh(2,[{provide:z1,useValue:0},{provide:Cw,multi:!0,deps:[Ds],useFactory:n=>{const t=n.get(VO,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const l=n.get(Is),f=n.get(pI);lI(l,()=>{r(!0)}),n.get(Q0).afterPreactivation=()=>(r(!0),f.closed?dn(void 0):f),l.initialNavigation()}))}}]).\u0275providers:[]]}const yI=new qt(""),Ed_urlApi="https://api-back-service-3uomm4d6da-uc.a.run.app/localizador";class nx{}class ix{}class wu{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const l=t.slice(0,r),f=l.toLowerCase(),y=t.slice(r+1).trim();this.maybeSetNormalizedName(l,f),this.headers.has(f)?this.headers.get(f).push(y):this.headers.set(f,[y])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof wu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new wu;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof wu?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const l=("a"===n.op?this.headers.get(t):void 0)||[];l.push(...r),this.headers.set(t,l);break;case"d":const f=n.value;if(f){let y=this.headers.get(t);if(!y)return;y=y.filter(C=>-1===f.indexOf(C)),0===y.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,y)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(n,t){const r=(Array.isArray(t)?t:[t]).map(f=>f.toString()),l=n.toLowerCase();this.headers.set(l,r),this.maybeSetNormalizedName(n,l)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class z3{encodeKey(n){return vI(n)}encodeValue(n){return vI(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const V3=/%(\d[a-f0-9])/gi,U3={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function vI(e){return encodeURIComponent(e).replace(V3,(n,t)=>U3[t]??n)}function rx(e){return`${e}`}class Cd{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new z3,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function B3(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const f=l.indexOf("="),[y,C]=-1==f?[n.decodeKey(l),""]:[n.decodeKey(l.slice(0,f)),n.decodeValue(l.slice(f+1))],D=t.get(y)||[];D.push(C),t.set(y,D)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],l=Array.isArray(r)?r.map(rx):[rx(r)];this.map.set(t,l)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const l=n[r];Array.isArray(l)?l.forEach(f=>{t.push({param:r,value:f,op:"a"})}):t.push({param:r,value:l,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new Cd({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(rx(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const l=r.indexOf(rx(n.value));-1!==l&&r.splice(l,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class j3{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function xI(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function bI(e){return typeof Blob<"u"&&e instanceof Blob}function wI(e){return typeof FormData<"u"&&e instanceof FormData}class ay{constructor(n,t,r,l){let f;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function $3(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==r?r:null,f=l):f=r,f&&(this.reportProgress=!!f.reportProgress,this.withCredentials=!!f.withCredentials,f.responseType&&(this.responseType=f.responseType),f.headers&&(this.headers=f.headers),f.context&&(this.context=f.context),f.params&&(this.params=f.params)),this.headers||(this.headers=new wu),this.context||(this.context=new j3),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=t;else{const C=t.indexOf("?");this.urlWithParams=t+(-1===C?"?":C<t.length-1?"&":"")+y}}else this.params=new Cd,this.urlWithParams=t}serializeBody(){return null===this.body?null:xI(this.body)||bI(this.body)||wI(this.body)||function H3(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Cd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||wI(this.body)?null:bI(this.body)?this.body.type||null:xI(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Cd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,l=n.responseType||this.responseType,f=void 0!==n.body?n.body:this.body,y=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,C=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let D=n.headers||this.headers,O=n.params||this.params;const $=n.context??this.context;return void 0!==n.setHeaders&&(D=Object.keys(n.setHeaders).reduce((W,oe)=>W.set(oe,n.setHeaders[oe]),D)),n.setParams&&(O=Object.keys(n.setParams).reduce((W,oe)=>W.set(oe,n.setParams[oe]),O)),new ay(t,r,f,{params:O,headers:D,context:$,reportProgress:C,responseType:l,withCredentials:y})}}var Um=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Um||{});class B1{constructor(n,t=200,r="OK"){this.headers=n.headers||new wu,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class V1 extends B1{constructor(n={}){super(n),this.type=Um.ResponseHeader}clone(n={}){return new V1({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class jm extends B1{constructor(n={}){super(n),this.type=Um.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new jm({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class EI extends B1{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function U1(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let qf=(()=>{class e{constructor(t){this.handler=t}request(t,r,l={}){let f;if(t instanceof ay)f=t;else{let D,O;D=l.headers instanceof wu?l.headers:new wu(l.headers),l.params&&(O=l.params instanceof Cd?l.params:new Cd({fromObject:l.params})),f=new ay(t,r,void 0!==l.body?l.body:null,{headers:D,context:l.context,params:O,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=dn(f).pipe(Rm(D=>this.handler.handle(D)));if(t instanceof ay||"events"===l.observe)return y;const C=y.pipe(bh(D=>D instanceof jm));switch(l.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return C.pipe(Nn(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return C.pipe(Nn(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return C.pipe(Nn(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return C.pipe(Nn(D=>D.body))}case"response":return C;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new Cd).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,l={}){return this.request("PATCH",t,U1(l,r))}post(t,r,l={}){return this.request("POST",t,U1(l,r))}put(t,r,l={}){return this.request("PUT",t,U1(l,r))}static#e=this.\u0275fac=function(r){return new(r||e)(rn(nx))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();function DI(e,n){return n(e)}function q3(e,n){return(t,r)=>n.intercept(t,{handle:l=>e(l,r)})}const W3=new qt(""),ly=new qt(""),MI=new qt("");function X3(){let e=null;return(n,t)=>{null===e&&(e=(Qt(W3,{optional:!0})??[]).reduceRight(q3,DI));const r=Qt(m0),l=r.add();return e(n,t).pipe(G_(()=>r.remove(l)))}}let SI=(()=>{class e extends nx{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=Qt(m0)}handle(t){if(null===this.chain){const l=Array.from(new Set([...this.injector.get(ly),...this.injector.get(MI,[])]));this.chain=l.reduceRight((f,y)=>function Z3(e,n,t){return(r,l)=>t.runInContext(()=>n(r,f=>e(f,l)))}(f,y,this.injector),DI)}const r=this.pendingTasks.add();return this.chain(t,l=>this.backend.handle(l)).pipe(G_(()=>this.pendingTasks.remove(r)))}static#e=this.\u0275fac=function(r){return new(r||e)(rn(ix),rn(Xo))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();const Q3=/^\)\]\}',?\n/;let AI=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Et(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?et(r.\u0275loadImpl()):dn(null)).pipe($i(()=>new Mn(f=>{const y=r.build();if(y.open(t.method,t.urlWithParams),t.withCredentials&&(y.withCredentials=!0),t.headers.forEach((Ke,ht)=>y.setRequestHeader(Ke,ht.join(","))),t.headers.has("Accept")||y.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const Ke=t.detectContentTypeHeader();null!==Ke&&y.setRequestHeader("Content-Type",Ke)}if(t.responseType){const Ke=t.responseType.toLowerCase();y.responseType="json"!==Ke?Ke:"text"}const C=t.serializeBody();let D=null;const O=()=>{if(null!==D)return D;const Ke=y.statusText||"OK",ht=new wu(y.getAllResponseHeaders()),zt=function eV(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(y)||t.url;return D=new V1({headers:ht,status:y.status,statusText:Ke,url:zt}),D},$=()=>{let{headers:Ke,status:ht,statusText:zt,url:lt}=O(),cn=null;204!==ht&&(cn=typeof y.response>"u"?y.responseText:y.response),0===ht&&(ht=cn?200:0);let Vn=ht>=200&&ht<300;if("json"===t.responseType&&"string"==typeof cn){const _i=cn;cn=cn.replace(Q3,"");try{cn=""!==cn?JSON.parse(cn):null}catch(Ko){cn=_i,Vn&&(Vn=!1,cn={error:Ko,text:cn})}}Vn?(f.next(new jm({body:cn,headers:Ke,status:ht,statusText:zt,url:lt||void 0})),f.complete()):f.error(new EI({error:cn,headers:Ke,status:ht,statusText:zt,url:lt||void 0}))},W=Ke=>{const{url:ht}=O(),zt=new EI({error:Ke,status:y.status||0,statusText:y.statusText||"Unknown Error",url:ht||void 0});f.error(zt)};let oe=!1;const ve=Ke=>{oe||(f.next(O()),oe=!0);let ht={type:Um.DownloadProgress,loaded:Ke.loaded};Ke.lengthComputable&&(ht.total=Ke.total),"text"===t.responseType&&y.responseText&&(ht.partialText=y.responseText),f.next(ht)},qe=Ke=>{let ht={type:Um.UploadProgress,loaded:Ke.loaded};Ke.lengthComputable&&(ht.total=Ke.total),f.next(ht)};return y.addEventListener("load",$),y.addEventListener("error",W),y.addEventListener("timeout",W),y.addEventListener("abort",W),t.reportProgress&&(y.addEventListener("progress",ve),null!==C&&y.upload&&y.upload.addEventListener("progress",qe)),y.send(C),f.next({type:Um.Sent}),()=>{y.removeEventListener("error",W),y.removeEventListener("abort",W),y.removeEventListener("load",$),y.removeEventListener("timeout",W),t.reportProgress&&(y.removeEventListener("progress",ve),null!==C&&y.upload&&y.upload.removeEventListener("progress",qe)),y.readyState!==y.DONE&&y.abort()}})))}static#e=this.\u0275fac=function(r){return new(r||e)(rn(jM))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();const j1=new qt("XSRF_ENABLED"),PI=new qt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),RI=new qt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class LI{}let iV=(()=>{class e{constructor(t,r,l){this.doc=t,this.platform=r,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=RM(t,this.cookieName),this.lastCookieString=t),this.lastToken}static#e=this.\u0275fac=function(r){return new(r||e)(rn(yl),rn(ah),rn(PI))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac})}return e})();function rV(e,n){const t=e.url.toLowerCase();if(!Qt(j1)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const r=Qt(LI).getToken(),l=Qt(RI);return null!=r&&!e.headers.has(l)&&(e=e.clone({headers:e.headers.set(l,r)})),n(e)}var Td=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(Td||{});function oV(...e){const n=[qf,AI,SI,{provide:nx,useExisting:SI},{provide:ix,useExisting:AI},{provide:ly,useValue:rV,multi:!0},{provide:j1,useValue:!0},{provide:LI,useClass:iV}];for(const t of e)n.push(...t.\u0275providers);return function wf(e){return{\u0275providers:e}}(n)}const kI=new qt("LEGACY_INTERCEPTOR_FN");function sV(){return function Zf(e,n){return{\u0275kind:e,\u0275providers:n}}(Td.LegacyInterceptors,[{provide:kI,useFactory:X3},{provide:ly,useExisting:kI,multi:!0}])}let aV=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({providers:[oV(sV())]})}return e})(),$m=(()=>{class e{constructor(t){this.http=t,this.userEmail=new fn(""),this.userEmail$=this.userEmail.asObservable(),this.userId=new fn(0),this.userId$=this.userId.asObservable(),this.userName=new fn(""),this.userName$=this.userName.asObservable(),this.userIdentificacion=new fn(""),this.userIdentificacion$=this.userIdentificacion.asObservable(),this.currentUserLoginOn=new fn(!1),this.currentUserData=new fn({id:0,nombres:"",email:"",password:"",rol:0,identificacion:"",tipoIdentificacion:""}),this.API_ENDPOINT_USER=Ed_urlApi+"/usuario"}setUserEmail(t){this.userEmail.next(t)}setUserId(t){this.userId.next(t)}setUserName(t){this.userName.next(t)}setUserIdentificacion(t){this.userIdentificacion.next(t)}login(t,r){return this.http.post(this.API_ENDPOINT_USER+"/login",{email:t,password:r}).pipe(Yo(f=>{this.currentUserData.next(f),this.currentUserLoginOn.next(!0)}),Nn(f=>{if(!f)throw new Error("Credenciales inv\xe1lidas o usuario no encontrado");return f}),Jl(this.handleError))}crearUsuario(t,r){return this.http.post(`${this.API_ENDPOINT_USER}/crear`,{usuario:t,perfil:r}).pipe(Jl(this.handleCreUsuarioError))}handleError(t){let r="Error en la conexi\xf3n o la consulta ";return console.log("Error desde servicio::",t.message),401===t.status?r="Credenciales inv\xe1lidas":402===t.status?r="Usuario no existe.":500===t.status&&(r="Error al verificar la contrase\xf1a"),vu(()=>new Error(r))}handleCreUsuarioError(t){let r="Error en la conexi\xf3n para crear el usuario ";return 500===t.status&&(r="Error al crear el usuario con su perfil"),vu(()=>new Error(r))}get usuarioData(){return this.currentUserData.asObservable()}get usuarioLoginOn(){return this.currentUserLoginOn.asObservable()}initializeUserDetails(){this.setUserEmail(""),this.setUserId(0),this.setUserName(""),this.setUserIdentificacion(""),this.currentUserLoginOn.next(!1),this.currentUserData.next({id:0,nombres:"",email:"",password:"",rol:0,identificacion:"",tipoIdentificacion:""})}static#e=this.\u0275fac=function(r){return new(r||e)(rn(qf))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var sx=_e(433);let OI=(()=>{class e{constructor(t){this.http=t,this.API_ENDPOINT_USER=Ed_urlApi+"/usuario"}obtenerUbicacionUsuarioPorEmail(t){return t?this.http.get(`${this.API_ENDPOINT_USER}/ubicacion/${t}`).pipe(Jl(this.handleUbicacionError)):vu(()=>new Error("Email no puede ser nulo o vac\xedo"))}guardaActualizaUbicacion(t){return this.http.post(this.API_ENDPOINT_USER+"/ubicacion",t).pipe(Jl(this.handleUbicacionError))}handleUbicacionError(t){return vu(()=>new Error("Error en ubicaci\xf3n: "+t.message))}static#e=this.\u0275fac=function(r){return new(r||e)(rn(qf))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),fV=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ed_urlApi+"/perfilestrabajo"}obtenerPerfilesPorProfesion(t){return this.http.get(`${this.API_URL}/${t}`)}obtenerPerfilesProfesion(){return this.http.get(`${this.API_URL}`)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(qf))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),NI=(()=>{class e{constructor(){this.navigateToContrato=new s}triggerNavigation(t,r){console.log("Se llamo al evento con id ",t),this.navigateToContrato.emit({idcontratante:t,idtrabajador:r})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),pV=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ed_urlApi+"/profesion"}obtenerAreaYProfesion(){return this.http.get(`${this.API_URL}`)}obtenerAreaProfesionPorId(t){return this.http.get(`${this.API_URL}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(qf))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),FI=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Ua),nt(sa))};static#t=this.\u0275dir=An({type:e})}return e})(),Wf=(()=>{class e extends FI{static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,features:[hr]})}return e})();const Eu=new qt("NgValueAccessor"),_V={provide:Eu,useExisting:yi(()=>Xf),multi:!0},vV=new qt("CompositionEventMode");let Xf=(()=>{class e extends FI{constructor(t,r,l){super(t,r),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function yV(){const e=yd()?yd().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Ua),nt(sa),nt(vV,8))};static#t=this.\u0275dir=An({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,l){1&r&&gi("input",function(y){return l._handleInput(y.target.value)})("blur",function(){return l.onTouched()})("compositionstart",function(){return l._compositionStart()})("compositionend",function(y){return l._compositionEnd(y.target.value)})},features:[Ur([_V]),hr]})}return e})();function Dd(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function BI(e){return null!=e&&"number"==typeof e.length}const As=new qt("NgValidators"),Md=new qt("NgAsyncValidators"),xV=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class $1{static min(n){return function VI(e){return n=>{if(Dd(n.value)||Dd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function UI(e){return n=>{if(Dd(n.value)||Dd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return jI(n)}static requiredTrue(n){return function $I(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function HI(e){return Dd(e.value)||xV.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function GI(e){return n=>Dd(n.value)||!BI(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return qI(n)}static pattern(n){return ZI(n)}static nullValidator(n){return null}static compose(n){return QI(n)}static composeAsync(n){return eA(n)}}function jI(e){return Dd(e.value)?{required:!0}:null}function qI(e){return n=>BI(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}function ZI(e){if(!e)return ax;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),r=>{if(Dd(r.value))return null;const l=r.value;return n.test(l)?null:{pattern:{requiredPattern:t,actualValue:l}}}}function ax(e){return null}function WI(e){return null!=e}function XI(e){return S_(e)?et(e):e}function YI(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function KI(e,n){return n.map(t=>t(e))}function JI(e){return e.map(n=>function bV(e){return!e.validate}(n)?n:t=>n.validate(t))}function QI(e){if(!e)return null;const n=e.filter(WI);return 0==n.length?null:function(t){return YI(KI(t,n))}}function H1(e){return null!=e?QI(JI(e)):null}function eA(e){if(!e)return null;const n=e.filter(WI);return 0==n.length?null:function(t){return function mV(...e){const n=va(e),{args:t,keys:r}=uS(e),l=new Mn(f=>{const{length:y}=t;if(!y)return void f.complete();const C=new Array(y);let D=y,O=y;for(let $=0;$<y;$++){let W=!1;wi(t[$]).subscribe(sn(f,oe=>{W||(W=!0,O--),C[$]=oe},()=>D--,void 0,()=>{(!D||!W)&&(O||f.next(r?dS(r,C):C),f.complete())}))}});return n?l.pipe(hS(n)):l}(KI(t,n).map(XI)).pipe(Nn(YI))}}function G1(e){return null!=e?eA(JI(e)):null}function tA(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function nA(e){return e._rawValidators}function iA(e){return e._rawAsyncValidators}function q1(e){return e?Array.isArray(e)?e:[e]:[]}function lx(e,n){return Array.isArray(e)?e.includes(n):e===n}function rA(e,n){const t=q1(n);return q1(e).forEach(l=>{lx(t,l)||t.push(l)}),t}function oA(e,n){return q1(n).filter(t=>!lx(e,t))}class sA{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=H1(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=G1(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class ha extends sA{get formDirective(){return null}get path(){return null}}class Sd extends sA{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class aA{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Hm=(()=>{class e extends aA{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Sd,2))};static#t=this.\u0275dir=An({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,l){2&r&&s0("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)},features:[hr]})}return e})(),cx=(()=>{class e extends aA{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(nt(ha,10))};static#t=this.\u0275dir=An({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,l){2&r&&s0("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)("ng-submitted",l.isSubmitted)},features:[hr]})}return e})();const cy="VALID",hx="INVALID",Gm="PENDING",uy="DISABLED";function X1(e){return(dx(e)?e.validators:e)||null}function Y1(e,n){return(dx(n)?n.asyncValidators:e)||null}function dx(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function cA(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new Et(1e3,"");if(!r[t])throw new Et(1001,"")}function uA(e,n,t){e._forEachChild((r,l)=>{if(void 0===t[l])throw new Et(1002,"")})}class fx{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===cy}get invalid(){return this.status===hx}get pending(){return this.status==Gm}get disabled(){return this.status===uy}get enabled(){return this.status!==uy}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(rA(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(rA(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(oA(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(oA(n,this._rawAsyncValidators))}hasValidator(n){return lx(this._rawValidators,n)}hasAsyncValidator(n){return lx(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Gm,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=uy,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=cy,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===cy||this.status===Gm)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?uy:cy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Gm,this._hasOwnPendingAsyncValidator=!0;const t=XI(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,l)=>r&&r._find(l),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new s,this.statusChanges=new s}_calculateStatus(){return this._allControlsDisabled()?uy:this.errors?hx:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Gm)?Gm:this._anyControlsHaveStatus(hx)?hx:cy}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){dx(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function TV(e){return Array.isArray(e)?H1(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function DV(e){return Array.isArray(e)?G1(e):e||null}(this._rawAsyncValidators)}}class hy extends fx{constructor(n,t,r){super(X1(t),Y1(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){uA(this,0,n),Object.keys(n).forEach(r=>{cA(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const l=this.controls[r];l&&l.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,l)=>{r.reset(n?n[l]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,l)=>((r.enabled||this.disabled)&&(t[l]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((l,f)=>{r=t(r,l,f)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class hA extends hy{}const Yf=new qt("CallSetDisabledState",{providedIn:"root",factory:()=>dy}),dy="always";function px(e,n){return[...n.path,e]}function fy(e,n,t=dy){K1(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function SV(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&dA(e,n)})}(e,n),function AV(e,n){const t=(r,l)=>{n.valueAccessor.writeValue(r),l&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function IV(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&dA(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function MV(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function mx(e,n,t=!0){const r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),_x(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function gx(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function K1(e,n){const t=nA(e);null!==n.validator?e.setValidators(tA(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=iA(e);null!==n.asyncValidator?e.setAsyncValidators(tA(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const l=()=>e.updateValueAndValidity();gx(n._rawValidators,l),gx(n._rawAsyncValidators,l)}function _x(e,n){let t=!1;if(null!==e){if(null!==n.validator){const l=nA(e);if(Array.isArray(l)&&l.length>0){const f=l.filter(y=>y!==n.validator);f.length!==l.length&&(t=!0,e.setValidators(f))}}if(null!==n.asyncValidator){const l=iA(e);if(Array.isArray(l)&&l.length>0){const f=l.filter(y=>y!==n.asyncValidator);f.length!==l.length&&(t=!0,e.setAsyncValidators(f))}}}const r=()=>{};return gx(n._rawValidators,r),gx(n._rawAsyncValidators,r),t}function dA(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function fA(e,n){K1(e,n)}function Q1(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}function pA(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function eE(e,n){if(!n)return null;let t,r,l;return Array.isArray(n),n.forEach(f=>{f.constructor===Xf?t=f:function LV(e){return Object.getPrototypeOf(e.constructor)===Wf}(f)?r=f:l=f}),l||r||t||null}const OV={provide:ha,useExisting:yi(()=>my)},py=(()=>Promise.resolve())();let my=(()=>{class e extends ha{constructor(t,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._directives=new Set,this.ngSubmit=new s,this.form=new hy({},H1(t),G1(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){py.then(()=>{const r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),fy(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){py.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){py.then(()=>{const r=this._findContainer(t.path),l=new hy({});fA(l,t),r.registerControl(t.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){py.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){py.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,pA(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(r){return new(r||e)(nt(As,10),nt(Md,10),nt(Yf,8))};static#t=this.\u0275dir=An({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,l){1&r&&gi("submit",function(y){return l.onSubmit(y)})("reset",function(){return l.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ur([OV]),hr]})}return e})();function mA(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function gA(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const gy=class extends fx{constructor(n=null,t,r){super(X1(t),Y1(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),dx(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=gA(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){mA(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){mA(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){gA(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},zV={provide:Sd,useExisting:yi(()=>qm)},vA=(()=>Promise.resolve())();let qm=(()=>{class e extends Sd{constructor(t,r,l,f,y,C){super(),this._changeDetectorRef=y,this.callSetDisabledState=C,this.control=new gy,this._registered=!1,this.name="",this.update=new s,this._parent=t,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=eE(0,f)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Q1(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){fy(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){vA.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const r=t.isDisabled.currentValue,l=0!==r&&Sm(r);vA.then(()=>{l&&!this.control.disabled?this.control.disable():!l&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?px(t,this._parent):[t]}static#e=this.\u0275fac=function(r){return new(r||e)(nt(ha,9),nt(As,10),nt(Md,10),nt(Eu,10),nt(v0,8),nt(Yf,8))};static#t=this.\u0275dir=An({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Ur([zV]),hr,Wt]})}return e})(),yx=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=An({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})();const BV={provide:Eu,useExisting:yi(()=>tE),multi:!0};let tE=(()=>{class e extends Wf{writeValue(t){this.setProperty("value",t??"")}registerOnChange(t){this.onChange=r=>{t(""==r?null:parseFloat(r))}}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,l){1&r&&gi("input",function(y){return l.onChange(y.target.value)})("blur",function(){return l.onTouched()})},features:[Ur([BV]),hr]})}return e})(),xA=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({})}return e})();const nE=new qt("NgModelWithFormControlWarning"),HV={provide:ha,useExisting:yi(()=>vx)};let vx=(()=>{class e extends ha{constructor(t,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new s,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(_x(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return fy(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){mx(t.control||null,t,!1),function kV(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,pA(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,l=this.form.get(t.path);r!==l&&(mx(r||null,t),(e=>e instanceof gy)(l)&&(fy(l,t,this.callSetDisabledState),t.control=l))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);fA(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function PV(e,n){return _x(e,n)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){K1(this.form,this),this._oldForm&&_x(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(r){return new(r||e)(nt(As,10),nt(Md,10),nt(Yf,8))};static#t=this.\u0275dir=An({type:e,selectors:[["","formGroup",""]],hostBindings:function(r,l){1&r&&gi("submit",function(y){return l.onSubmit(y)})("reset",function(){return l.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ur([HV]),hr,Wt]})}return e})();const ZV={provide:Sd,useExisting:yi(()=>oE)};let oE=(()=>{class e extends Sd{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,r,l,f,y){super(),this._ngModelWarningConfig=y,this._added=!1,this.name=null,this.update=new s,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=eE(0,f)}ngOnChanges(t){this._added||this._setUpControl(),Q1(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return px(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(r){return new(r||e)(nt(ha,13),nt(As,10),nt(Md,10),nt(Eu,10),nt(nE,8))};static#n=this.\u0275dir=An({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Ur([ZV]),hr,Wt]})}return e})();const WV={provide:Eu,useExisting:yi(()=>_y),multi:!0};function TA(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let _y=(()=>{class e extends Wf{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const l=TA(this._getOptionId(t),t);this.setProperty("value",l)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function XV(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,l){1&r&&gi("change",function(y){return l.onChange(y.target.value)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[Ur([WV]),hr]})}return e})(),sE=(()=>{class e{constructor(t,r,l){this._element=t,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(TA(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(nt(sa),nt(Ua),nt(_y,9))};static#t=this.\u0275dir=An({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();const YV={provide:Eu,useExisting:yi(()=>aE),multi:!0};function DA(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let aE=(()=>{class e extends Wf{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const l=t.map(f=>this._getOptionId(f));r=(f,y)=>{f._setSelected(l.indexOf(y.toString())>-1)}}else r=(l,f)=>{l._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const l=[],f=r.selectedOptions;if(void 0!==f){const y=f;for(let C=0;C<y.length;C++){const O=this._getOptionValue(y[C].value);l.push(O)}}else{const y=r.options;for(let C=0;C<y.length;C++){const D=y[C];if(D.selected){const O=this._getOptionValue(D.value);l.push(O)}}}this.value=l,t(l)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function KV(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,l){1&r&&gi("change",function(y){return l.onChange(y.target)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[Ur([YV]),hr]})}return e})(),lE=(()=>{class e{constructor(t,r,l){this._element=t,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(DA(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(DA(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(nt(sa),nt(Ua),nt(aE,9))};static#t=this.\u0275dir=An({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();let Kf=(()=>{class e{constructor(){this._validator=ax}ngOnChanges(t){if(this.inputName in t){const r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):ax,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return null!=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=An({type:e,features:[Wt]})}return e})();const eU={provide:As,useExisting:yi(()=>xx),multi:!0};let xx=(()=>{class e extends Kf{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Sm,this.createValidator=t=>jI}enabled(t){return t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,l){2&r&&gu("required",l._enabled?"":null)},inputs:{required:"required"},features:[Ur([eU]),hr]})}return e})();const rU={provide:As,useExisting:yi(()=>cE),multi:!0};let cE=(()=>{class e extends Kf{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=t=>function MA(e){return"number"==typeof e?e:parseInt(e,10)}(t),this.createValidator=t=>qI(t)}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(r,l){2&r&&gu("maxlength",l._enabled?l.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Ur([rU]),hr]})}return e})();const oU={provide:As,useExisting:yi(()=>uE),multi:!0};let uE=(()=>{class e extends Kf{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=t=>t,this.createValidator=t=>ZI(t)}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=go(e)))(l||e)}}();static#t=this.\u0275dir=An({type:e,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(r,l){2&r&&gu("pattern",l._enabled?l.pattern:null)},inputs:{pattern:"pattern"},features:[Ur([oU]),hr]})}return e})(),kA=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({imports:[xA]})}return e})();class OA extends fx{constructor(n,t,r){super(X1(t),Y1(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,r={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,t={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,r={}){let l=this._adjustIndex(n);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),t&&(this.controls.splice(l,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){uA(this,0,n),n.forEach((r,l)=>{cA(this,!1,l),this.at(l).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((r,l)=>{this.at(l)&&this.at(l).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((r,l)=>{r.reset(n[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,r)=>{n(t,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function NA(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let sU=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,r=null){const l=this._reduceControls(t);let f={};return NA(r)?f=r:null!==r&&(f.validators=r.validator,f.asyncValidators=r.asyncValidator),new hy(l,f)}record(t,r=null){const l=this._reduceControls(t);return new hA(l,r)}control(t,r,l){let f={};return this.useNonNullable?(NA(r)?f=r:(f.validators=r,f.asyncValidators=l),new gy(t,{...f,nonNullable:!0})):new gy(t,r,l)}array(t,r,l){const f=t.map(y=>this._createControl(y));return new OA(f,r,l)}_reduceControls(t){const r={};return Object.keys(t).forEach(l=>{r[l]=this._createControl(t[l])}),r}_createControl(t){return t instanceof gy||t instanceof fx?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),aU=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:Yf,useValue:t.callSetDisabledState??dy}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({imports:[kA]})}return e})(),lU=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:nE,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Yf,useValue:t.callSetDisabledState??dy}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({imports:[kA]})}return e})();function cU(e,n){1&e&&(kt(0,"div",7),xn(1," NO TIENE UBICACI\xd3N REGISTRADA, FAVOR INGRESAR SUS DATOS DE UBICACI\xd3N. "),Rt())}function uU(e,n){if(1&e&&(kt(0,"option",8),xn(1),Rt()),2&e){const t=n.$implicit;In("value",t.id_area),Yt(1),mh(" ",t.nombre_area_profesion," ")}}let hU=(()=>{class e{constructor(t,r,l,f,y,C,D){this.ubicacionService=t,this.perfiltrabajoService=r,this.router=l,this.navegacionService=f,this.zone=y,this.usuarioServicio=C,this.areaProfesionService=D,this.latUser=0,this.lonUser=0,this.profesionBuscada="",this.mimapa=null,this.marcadores=[],this.userId=0,this.profesiones=[],this.areaProfesionPersona="",this.noTieneUbicacion=!1}ngOnInit(){this.areaProfesionService.obtenerAreaYProfesion().subscribe({next:t=>{this.profesiones=t},error:t=>{console.error("Error al obtener profesiones",t)}})}cargarUbicacionUsuarioLogin(t){console.log("Ejecutado cargarUbicacionUsuarioLogin:",t),this.ubicacionService.obtenerUbicacionUsuarioPorEmail(t).subscribe({next:r=>{r?(this.latUser=r.latitud,this.lonUser=r.longitud,console.log("UBICACION :::: ",r),console.log("1. this.latUser:",this.latUser),console.log("1. this.lonUser:",this.lonUser),this.inicializarMapaUsuarioLogin()):(this.noTieneUbicacion=!0,console.log("No existe ubicacion para usuario, favor registre su ubicacion ahoraaa"))},error:r=>{console.log("UBICACION ::: algo paso :( ",r)}})}inicializarMapaUsuarioLogin(){console.log("Entro en incializa mapa,",this.usuarioServicio.usuarioLoginOn),this.mimapa?console.log("Mapa ya inicializado."):(console.log("this.latUser:",this.latUser),console.log("this.lonUser:",this.lonUser),this.mimapa=new sx.Map("mapUOC").setView([this.latUser,this.lonUser],10),(0,sx.tileLayer)("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:30,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(this.mimapa),(0,sx.marker)([this.latUser,this.lonUser]).addTo(this.mimapa).bindPopup(`${this.usuarioServicio.userName$}`),console.log("Mapa se iinicializoo."))}ngAfterViewInit(){this.mapaSubscription=this.usuarioServicio.userEmail$.subscribe(t=>{this.usuarioServicio.usuarioLoginOn&&(console.log("::::Email:::",t),this.cargarUbicacionUsuarioLogin(t))}),this.usuarioServicio.userId$.subscribe(t=>{this.usuarioServicio.usuarioLoginOn&&(this.userId=t)})}buscarProfesion(){this.profesionBuscada&&(this.marcadores.forEach(t=>{this.mimapa?.removeLayer(t)}),this.marcadores=[],this.perfiltrabajoService.obtenerPerfilesPorProfesion(this.profesionBuscada).subscribe({next:t=>{t.forEach(r=>{const l=Number(r.latitud),f=Number(r.longitud);if(console.log("perfil:::",r),!isNaN(l)&&!isNaN(f)&&this.mimapa){const y=`<div>\n               <p>${r.nombres} :: Profesi\xf3n: ${r.profesion}</p>\n               <div class="d-flex justify-content-center"><button class="btn btn-primary me-3" id="contratar${r.id}">Contratar</button>\n               <button class="btn btn-primary" id="perfil${r.id}">Perfil</button> </div>               \n               </div>`,C=(0,sx.marker)([l,f]).addTo(this.mimapa).bindPopup(y);C.on("popupopen",()=>{const D=document.getElementById(`contratar${r.id}`);D&&D.addEventListener("click",()=>{console.log("Bot\xf3n contratar clickeado!"),this.navegarAContrato(this.userId,r.id)})}),this.marcadores.push(C)}})},error:t=>{console.error(t)}}))}onProfesionChange(){this.buscarProfesion()}navegarAContrato(t,r){console.log("Se llamo a navegarAContrato:::::cin id ::",t),this.router.navigate(["/crear-contrato",t,r])}ngOnDestroy(){console.log("destroy de mapa subscribe"),this.mapaSubscription&&this.mapaSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(nt(OI),nt(fV),nt(Is),nt(NI),nt(v),nt($m),nt(pV))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-mapa"]],decls:9,vars:3,consts:[[1,"custom-container","my-5"],[1,"mb-3"],["for","profesional",1,"form-label"],["class","alert alert-danger","style","text-align: center; font-weight: bold;",4,"ngIf"],["name","profesional",1,"form-select",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["id","mapUOC",1,"map-container"],[1,"alert","alert-danger",2,"text-align","center","font-weight","bold"],[3,"value"]],template:function(r,l){1&r&&(kt(0,"div",0)(1,"div",1)(2,"label",2),xn(3,"Buscar Profesional"),Rt(),kt(4,"div"),Dr(5,cU,2,0,"div",3),Rt(),kt(6,"select",4),gi("ngModelChange",function(y){return l.profesionBuscada=y})("change",function(){return l.buscarProfesion()}),Dr(7,uU,2,2,"option",5),Rt()(),yo(8,"div",6),Rt()),2&r&&(Yt(5),In("ngIf",l.noTieneUbicacion),Yt(1),In("ngModel",l.profesionBuscada),Yt(1),In("ngForOf",l.profesiones))},dependencies:[Qw,Am,sE,lE,_y,Hm,qm],styles:["#mapUOC[_ngcontent-%COMP%]{height:590px}.custom-container[_ngcontent-%COMP%]{max-width:60%;margin-right:auto;margin-left:auto}.map-container[_ngcontent-%COMP%]{width:100%;height:400px}@media (max-width: 768px){.custom-container[_ngcontent-%COMP%]{max-width:100%}}"]})}return e})();function dU(e,n){1&e&&(kt(0,"p"),xn(1,"Usuario No autenticado"),Rt())}function fU(e,n){if(1&e&&(kt(0,"p"),xn(1),Rt()),2&e){const t=I_();Yt(1),mh("Usuario ",null==t.userDatos?null:t.userDatos.nombres," Autenticado")}}function pU(e,n){1&e&&yo(0,"img",2)}function mU(e,n){1&e&&yo(0,"app-mapa")}let FA=(()=>{class e{constructor(t,r){this.usuarioServer=t,this.route=r,this.userLoginOn=!1}ngOnInit(){this.route.params.subscribe(t=>{"outsesion"===t.outsesion?(console.log("entro a cerrar sesiony destruir subscricion"),this.usuarioServer.initializeUserDetails(),this.userLoginOn=!1,this.userDatos={id:0,nombres:"",email:"",password:"",rol:0,estado:"",identificacion:"",tipoIdentificacion:""},this.subscription1?.unsubscribe(),this.subscription2?.unsubscribe()):this.subscribeToUserData()})}subscribeToUserData(){this.subscription1=this.usuarioServer.currentUserLoginOn.subscribe({next:t=>{this.userLoginOn=t}}),this.subscription2=this.usuarioServer.currentUserData.subscribe({next:t=>{this.userDatos=t}})}static#e=this.\u0275fac=function(r){return new(r||e)(nt($m),nt(wd))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-dashboard"]],decls:4,vars:4,consts:[[4,"ngIf"],["src","assets/images/Youtube-Finance.png","alt","Portada","class","img-portada",4,"ngIf"],["src","assets/images/Youtube-Finance.png","alt","Portada",1,"img-portada"]],template:function(r,l){1&r&&(Dr(0,dU,2,0,"p",0),Dr(1,fU,2,1,"p",0),Dr(2,pU,1,0,"img",1),Dr(3,mU,1,0,"app-mapa",0)),2&r&&(In("ngIf",!l.userLoginOn),Yt(1),In("ngIf",l.userLoginOn),Yt(1),In("ngIf",!l.userLoginOn),Yt(1),In("ngIf",l.userLoginOn))},dependencies:[Am,hU],styles:[".img-portada[_ngcontent-%COMP%]{width:100%;height:auto;display:block;margin:0 auto}"]})}return e})();function gU(e,n){1&e&&(kt(0,"div"),xn(1," Email es requerido. "),Rt())}function _U(e,n){1&e&&(kt(0,"div"),xn(1," Email tiene formato invalido. "),Rt())}function yU(e,n){if(1&e&&(kt(0,"div",14),Dr(1,gU,2,0,"div",15),Dr(2,_U,2,0,"div",15),Rt()),2&e){const t=I_();Yt(1),In("ngIf",null==t.user.errors?null:t.user.errors.required),Yt(1),In("ngIf",null==t.user.errors?null:t.user.errors.email)}}function vU(e,n){1&e&&(kt(0,"div"),xn(1," Pasword es requerido. "),Rt())}function xU(e,n){if(1&e&&(kt(0,"div",14),Dr(1,vU,2,0,"div",15),Rt()),2&e){const t=I_();Yt(1),In("ngIf",null==t.pasword.errors?null:t.pasword.errors.required)}}let bU=(()=>{class e{constructor(t,r,l){this.formBuilder=t,this.router=r,this.usuarioService=l,this.loginError="",this.loginForm=this.formBuilder.group({email:["",[$1.required,$1.email]],password:["",$1.required]})}ngOnInit(){}get user(){return this.loginForm.controls.email}get pasword(){return this.loginForm.controls.password}login(){if(this.loginForm.valid){const t=this.loginForm.get("email")?.value||"",r=this.loginForm.get("password")?.value||"";console.log("entro a login"),this.loginSubscription=this.usuarioService.login(t,r).subscribe({next:l=>{this.usuarioService.setUserEmail(t),this.usuarioService.setUserId(l.id),this.usuarioService.setUserName(l.nombres),this.usuarioService.setUserIdentificacion(l.identificacion),console.log("Credenciales correctas:",l),console.log("Credenciales correctas::: usuarioId",l.id)},error:l=>{console.log("entro a errorData::",l),this.loginError=l},complete:()=>{this.router.navigateByUrl("/inicio"),this.loginForm.reset()}})}else this.loginForm.markAllAsTouched()}ngOnDestroy(){this.loginSubscription&&this.loginSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(nt(sU),nt(Is),nt($m))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-login"]],decls:22,vars:4,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[3,"formGroup"],[1,"text-danger"],[1,"mb-3"],["for","inputEmail1",1,"form-label"],["formControlName","email","type","email","id","inputEmail1","aria-describedby","emailHelp",1,"form-control"],["id","emailHelp",1,"form-text"],["class","alert alert-danger",4,"ngIf"],["for","inputPassword1",1,"form-label"],["formControlName","password","type","password","id","inputPassword1",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"alert","alert-danger"],[4,"ngIf"]],template:function(r,l){1&r&&(kt(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),xn(4,"Inicie Sesi\xf3n"),Rt(),kt(5,"form",4)(6,"p",5),xn(7),Rt(),kt(8,"div",6)(9,"label",7),xn(10,"Email"),Rt(),yo(11,"input",8),kt(12,"div",9),xn(13,"Nunca compartiremos sus datos personales con nadie m\xe1s.."),Rt(),Dr(14,yU,3,2,"div",10),Rt(),kt(15,"div",6)(16,"label",11),xn(17,"Contrase\xf1a"),Rt(),yo(18,"input",12),Dr(19,xU,2,1,"div",10),Rt(),kt(20,"button",13),gi("click",function(){return l.login()}),xn(21,"Iniciar Sesi\xf3n"),Rt()()()()()),2&r&&(Yt(5),In("formGroup",l.loginForm),Yt(2),wm(l.loginError),Yt(7),In("ngIf",l.user.invalid&&(l.user.dirty||l.user.touched)),Yt(5),In("ngIf",l.pasword.invalid&&(l.pasword.dirty||l.pasword.touched)))},dependencies:[Am,yx,Xf,Hm,cx,vx,oE],styles:["form[_ngcontent-%COMP%]{margin:20px}"]})}return e})(),wU=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ed_urlApi}crearContrato(t){return this.http.post(`${this.API_URL}/contrato/crear`,t)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(qf))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),EU=(()=>{class e{constructor(t,r,l,f){this.navegacionService=t,this.router=r,this.route=l,this.contratoService=f,this.contrato={id_usuario_contratante:0,id_usuario_trabajador:0,tipo_contrato:0,fecha_inicio:"",fecha_fin:"",descripcion:""},console.log("Se llama a componente:: es constructor")}guardarContrato(){this.contratoService.crearContrato(this.contrato).pipe(Yo(t=>console.log("Contrato guardado",t)),Jl(t=>(console.error("Error al guardar contrato",t),vu(()=>t)))).subscribe()}cancelarRegistro(){this.route.navigate(["/inicio"])}ngOnInit(){console.log("::Se llama a ngOnInit::"),this.router.params.subscribe(t=>{this.contrato.id_usuario_contratante=+t.idcontratante,this.contrato.id_usuario_trabajador=+t.idtrabajador,this.contrato.estado="CONTRATADO"})}ngOnDestroy(){console.log("::Se llama a ngOnDestroy::"),this.navigationSubscription&&(console.log("Se llama a ngOnDestroy"),this.navigationSubscription.unsubscribe())}static#e=this.\u0275fac=function(r){return new(r||e)(nt(NI),nt(wd),nt(Is),nt(wU))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-contrato"]],decls:28,vars:6,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[1,"card","p-4",3,"ngSubmit"],["type","hidden","name","id_usuario_contratante",3,"ngModel","ngModelChange"],["type","hidden","name","id_usuario_trabajador",3,"ngModel","ngModelChange"],[1,"form-group","mb-3"],["for","tipo_contrato"],["type","number","name","tipo_contrato","placeholder","Tipo de Contrato",1,"form-control",3,"ngModel","ngModelChange"],["for","fecha_inicio"],["type","date","name","fecha_inicio",1,"form-control",3,"ngModel","ngModelChange"],["for","fecha_fin"],["type","date","name","fecha_fin",1,"form-control",3,"ngModel","ngModelChange"],["for","descripcion"],["name","descripcion","placeholder","Descripci\xf3n",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","mb-3"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"]],template:function(r,l){1&r&&(kt(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),xn(4,"Registro de Contrato"),Rt(),kt(5,"form",4),gi("ngSubmit",function(){return l.guardarContrato()}),kt(6,"input",5),gi("ngModelChange",function(y){return l.contrato.id_usuario_contratante=y}),Rt(),kt(7,"input",6),gi("ngModelChange",function(y){return l.contrato.id_usuario_trabajador=y}),Rt(),kt(8,"div",7)(9,"label",8),xn(10,"Tipo de Contrato"),Rt(),kt(11,"input",9),gi("ngModelChange",function(y){return l.contrato.tipo_contrato=y}),Rt()(),kt(12,"div",7)(13,"label",10),xn(14,"Fecha de Inicio"),Rt(),kt(15,"input",11),gi("ngModelChange",function(y){return l.contrato.fecha_inicio=y}),Rt()(),kt(16,"div",7)(17,"label",12),xn(18,"Fecha de Fin"),Rt(),kt(19,"input",13),gi("ngModelChange",function(y){return l.contrato.fecha_fin=y}),Rt()(),kt(20,"div",7)(21,"label",14),xn(22,"Descripci\xf3n"),Rt(),kt(23,"textarea",15),gi("ngModelChange",function(y){return l.contrato.descripcion=y}),Rt()(),kt(24,"button",16),xn(25,"Genera Contrato"),Rt(),kt(26,"button",17),gi("click",function(){return l.cancelarRegistro()}),xn(27,"Cancelar"),Rt()()()()()),2&r&&(Yt(6),In("ngModel",l.contrato.id_usuario_contratante),Yt(1),In("ngModel",l.contrato.id_usuario_trabajador),Yt(4),In("ngModel",l.contrato.tipo_contrato),Yt(4),In("ngModel",l.contrato.fecha_inicio),Yt(4),In("ngModel",l.contrato.fecha_fin),Yt(4),In("ngModel",l.contrato.descripcion))},dependencies:[yx,Xf,tE,Hm,cx,qm,my]})}return e})();function zA(e,n,t,r,l,f,y){try{var C=e[f](y),D=C.value}catch(O){return void t(O)}C.done?n(D):Promise.resolve(D).then(r,l)}function BA(e){return function(){var n=this,t=arguments;return new Promise(function(r,l){var f=e.apply(n,t);function y(D){zA(f,r,l,y,C,"next",D)}function C(D){zA(f,r,l,y,C,"throw",D)}y(void 0)})}}var Zm=_e(574),CU=_e(904);let TU=(()=>{class e{constructor(t){this.httpClient=t,this.cbAddres=new s,this.mapbox=Zm,this.map=null,this.style="mapbox://styles/mapbox/streets-v12",this.lat=-2.275817,this.lng=-79.875993,this.zoom=14,this.wayPoint=[],this.markerDriver=null,this.mapbox.accessToken="pk.eyJ1IjoiY3ZpbGVsYTE5NzkiLCJhIjoiY2xuYWljM2x2MDJ6bTJzbzF1bzhxOWM1aiJ9.L8Me7xG665eiS43VvjW03A",console.log("constructor ###################### evento: ")}buildMap(t,r){return new Promise((l,f)=>{try{console.log("buildMap ###################### evento: "),this.lng=Number(t),this.lat=Number(r),console.log("buildMap valores iniciales lat: ",this.lat),console.log("buildMap valores iniciales lng: ",this.lng),this.map=new Zm.Map({container:"map",style:this.style,zoom:this.zoom,center:[this.lat,this.lng]});const y=new CU({accessToken:Zm.accessToken,mapboxgl:Zm});y.on("result",C=>{const{result:D}=C,O=C.result.geometry.coordinates;console.log("###################### evento result: ",C.result),console.log("###################### evento coordinates: "+O),console.log("### Coord 0 Seleccionada: "+O[0]),console.log("### Coord 1 Seleccionada: "+O[1]),console.log("###################### evento capturado: "+D),this.lat=O[0],this.lng=O[1],y.clear(),console.log("### Evento this.lat: "+this.lat),console.log("### Evento this.lng: "+this.lng),this.marker.setLngLat([Number(this.lat),Number(this.lng)]),this.cbAddres.emit(D)}),console.log("****** lat:",this.lat),console.log("****** lng:",this.lng),this.marker=(new Zm.Marker).setLngLat([Number(this.lat),Number(this.lng)]).addTo(this.map),l({map:this.map,geocoder:y})}catch(y){f(y)}})}addMarkerCustom(t){console.log("addMarkerCustom -----\x3e",t);const r=document.createElement("div");r.className="marker",this.markerDriver?this.markerDriver.setLngLat(t).addTo(this.map):this.markerDriver=new Zm.Marker(r)}static#e=this.\u0275fac=function(r){return new(r||e)(rn(qf))};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Cu=Object.create(null);Cu.open="0",Cu.close="1",Cu.ping="2",Cu.pong="3",Cu.message="4",Cu.upgrade="5",Cu.noop="6";const bx=Object.create(null);Object.keys(Cu).forEach(e=>{bx[Cu[e]]=e});const hE={type:"error",data:"parser error"},VA="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),UA="function"==typeof ArrayBuffer,jA=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,dE=({type:e,data:n},t,r)=>VA&&n instanceof Blob?t?r(n):$A(n,r):UA&&(n instanceof ArrayBuffer||jA(n))?t?r(n):$A(new Blob([n]),r):r(Cu[e]+(n||"")),$A=(e,n)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];n("b"+(r||""))},t.readAsDataURL(e)};function HA(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let fE;const yy=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<64;e++)yy["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const SU="function"==typeof ArrayBuffer,pE=(e,n)=>{if("string"!=typeof e)return{type:"message",data:GA(e,n)};const t=e.charAt(0);return"b"===t?{type:"message",data:IU(e.substring(1),n)}:bx[t]?e.length>1?{type:bx[t],data:e.substring(1)}:{type:bx[t]}:hE},IU=(e,n)=>{if(SU){const t=(e=>{let r,f,y,C,D,n=.75*e.length,t=e.length,l=0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);const O=new ArrayBuffer(n),$=new Uint8Array(O);for(r=0;r<t;r+=4)f=yy[e.charCodeAt(r)],y=yy[e.charCodeAt(r+1)],C=yy[e.charCodeAt(r+2)],D=yy[e.charCodeAt(r+3)],$[l++]=f<<2|y>>4,$[l++]=(15&y)<<4|C>>2,$[l++]=(3&C)<<6|63&D;return O})(e);return GA(t,n)}return{base64:!0,data:e}},GA=(e,n)=>"blob"===n?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,qA=String.fromCharCode(30);let mE;function wx(e){return e.reduce((n,t)=>n+t.length,0)}function Ex(e,n){if(e[0].length===n)return e.shift();const t=new Uint8Array(n);let r=0;for(let l=0;l<n;l++)t[l]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),t}function To(e){if(e)return function kU(e){for(var n in To.prototype)e[n]=To.prototype[n];return e}(e)}To.prototype.on=To.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(n),this},To.prototype.once=function(e,n){function t(){this.off(e,t),n.apply(this,arguments)}return t.fn=n,this.on(e,t),this},To.prototype.off=To.prototype.removeListener=To.prototype.removeAllListeners=To.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+e];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,l=0;l<t.length;l++)if((r=t[l])===n||r.fn===n){t.splice(l,1);break}return 0===t.length&&delete this._callbacks["$"+e],this},To.prototype.emitReserved=To.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),t=this._callbacks["$"+e],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(t){r=0;for(var l=(t=t.slice(0)).length;r<l;++r)t[r].apply(this,n)}return this},To.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},To.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ql=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function WA(e,...n){return n.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const OU=Ql.setTimeout,NU=Ql.clearTimeout;function Cx(e,n){n.useNativeTimers?(e.setTimeoutFn=OU.bind(Ql),e.clearTimeoutFn=NU.bind(Ql)):(e.setTimeoutFn=Ql.setTimeout.bind(Ql),e.clearTimeoutFn=Ql.clearTimeout.bind(Ql))}function zU(e){return"string"==typeof e?function BU(e){let n=0,t=0;for(let r=0,l=e.length;r<l;r++)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:n<55296||n>=57344?t+=3:(r++,t+=4);return t}(e):Math.ceil(1.33*(e.byteLength||e.size))}class jU extends Error{constructor(n,t,r){super(n),this.description=t,this.context=r,this.type="TransportError"}}class gE extends To{constructor(n){super(),this.writable=!1,Cx(this,n),this.opts=n,this.query=n.query,this.socket=n.socket}onError(n,t,r){return super.emitReserved("error",new jU(n,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(n){"open"===this.readyState&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const t=pE(n,this.socket.binaryType);this.onPacket(t)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,t={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const n=this.opts.hostname;return-1===n.indexOf(":")?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(n){const t=function VU(e){let n="";for(let t in e)e.hasOwnProperty(t)&&(n.length&&(n+="&"),n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n}(n);return t.length?"?"+t:""}}const XA="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Tx=64,YA={};let JA,KA=0,Id=0;function QA(e){let n="";do{n=XA[e%Tx]+n,e=Math.floor(e/Tx)}while(e>0);return n}function e2(){const e=QA(+new Date);return e!==JA?(KA=0,JA=e):e+"."+QA(KA++)}for(;Id<Tx;Id++)YA[XA[Id]]=Id;let t2=!1;try{t2=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const $U=t2;function n2(e){const n=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||$U))return new XMLHttpRequest}catch{}if(!n)try{return new(Ql[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function HU(){}const GU=null!=new n2({xdomain:!1}).responseType;let Dx=(()=>{class e extends To{constructor(t,r){super(),Cx(this,r),this.opts=r,this.method=r.method||"GET",this.uri=t,this.data=void 0!==r.data?r.data:null,this.create()}create(){var t;const r=WA(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;const l=this.xhr=new n2(r);try{l.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let f in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(f)&&l.setRequestHeader(f,this.opts.extraHeaders[f])}}catch{}if("POST"===this.method)try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(l),"withCredentials"in l&&(l.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(l.timeout=this.opts.requestTimeout),l.onreadystatechange=()=>{var f;3===l.readyState&&(null===(f=this.opts.cookieJar)||void 0===f||f.parseCookies(l)),4===l.readyState&&(200===l.status||1223===l.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof l.status?l.status:0)},0))},l.send(this.data)}catch(f){return void this.setTimeoutFn(()=>{this.onError(f)},0)}typeof document<"u"&&(this.index=e.requestsCount++,e.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=HU,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete e.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return e.requestsCount=0,e.requests={},e})();function i2(){for(let e in Dx.requests)Dx.requests.hasOwnProperty(e)&&Dx.requests[e].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",i2):"function"==typeof addEventListener&&addEventListener("onpagehide"in Ql?"pagehide":"unload",i2,!1));const _E="function"==typeof Promise&&"function"==typeof Promise.resolve?n=>Promise.resolve().then(n):(n,t)=>t(n,0),Mx=Ql.WebSocket||Ql.MozWebSocket,r2=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),YU={websocket:class WU extends gE{constructor(n){super(n),this.supportsBinary=!n.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const n=this.uri(),t=this.opts.protocols,r=r2?{}:WA(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=r2?new Mx(n,t,r):t?new Mx(n,t):new Mx(n)}catch(l){return this.emitReserved("error",l)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const l=t===n.length-1;dE(n[t],this.supportsBinary,f=>{try{this.ws.send(f)}catch{}l&&_E(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=e2()),this.supportsBinary||(t.b64=1),this.createUri(n,t)}check(){return!!Mx}},webtransport:class XU extends gE{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(n=>{const t=function LU(e,n){mE||(mE=new TextDecoder);const t=[];let r=0,l=-1,f=!1;return new TransformStream({transform(y,C){for(t.push(y);;){if(0===r){if(wx(t)<1)break;const D=Ex(t,1);f=128==(128&D[0]),l=127&D[0],r=l<126?3:126===l?1:2}else if(1===r){if(wx(t)<2)break;const D=Ex(t,2);l=new DataView(D.buffer,D.byteOffset,D.length).getUint16(0),r=3}else if(2===r){if(wx(t)<8)break;const D=Ex(t,8),O=new DataView(D.buffer,D.byteOffset,D.length),$=O.getUint32(0);if($>Math.pow(2,21)-1){C.enqueue(hE);break}l=$*Math.pow(2,32)+O.getUint32(4),r=3}else{if(wx(t)<l)break;const D=Ex(t,l);C.enqueue(pE(f?D:mE.decode(D),n)),r=0}if(0===l||l>e){C.enqueue(hE);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=n.readable.pipeThrough(t).getReader(),l=function RU(){return new TransformStream({transform(e,n){!function DU(e,n){VA&&e.data instanceof Blob?e.data.arrayBuffer().then(HA).then(n):UA&&(e.data instanceof ArrayBuffer||jA(e.data))?n(HA(e.data)):dE(e,!1,t=>{fE||(fE=new TextEncoder),n(fE.encode(t))})}(e,t=>{const r=t.length;let l;if(r<126)l=new Uint8Array(1),new DataView(l.buffer).setUint8(0,r);else if(r<65536){l=new Uint8Array(3);const f=new DataView(l.buffer);f.setUint8(0,126),f.setUint16(1,r)}else{l=new Uint8Array(9);const f=new DataView(l.buffer);f.setUint8(0,127),f.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(l[0]|=128),n.enqueue(l),n.enqueue(t)})}})}();l.readable.pipeTo(n.writable),this.writer=l.writable.getWriter();const f=()=>{r.read().then(({done:C,value:D})=>{C||(this.onPacket(D),f())}).catch(C=>{})};f();const y={type:"open"};this.query.sid&&(y.data=`{"sid":"${this.query.sid}"}`),this.writer.write(y).then(()=>this.onOpen())})}))}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const l=t===n.length-1;this.writer.write(n[t]).then(()=>{l&&_E(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;null===(n=this.transport)||void 0===n||n.close()}},polling:class qU extends gE{constructor(n){if(super(n),this.polling=!1,typeof location<"u"){const r="https:"===location.protocol;let l=location.port;l||(l=r?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||l!==n.port}this.supportsBinary=GU&&!(n&&n.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(n){this.readyState="pausing";const t=()=>{this.readyState="paused",n()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){((e,n)=>{const t=e.split(qA),r=[];for(let l=0;l<t.length;l++){const f=pE(t[l],n);if(r.push(f),"error"===f.type)break}return r})(n,this.socket.binaryType).forEach(r=>{if("opening"===this.readyState&&"open"===r.type&&this.onOpen(),"close"===r.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const n=()=>{this.write([{type:"close"}])};"open"===this.readyState?n():this.once("open",n)}write(n){this.writable=!1,((e,n)=>{const t=e.length,r=new Array(t);let l=0;e.forEach((f,y)=>{dE(f,!1,C=>{r[y]=C,++l===t&&n(r.join(qA))})})})(n,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=e2()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(n,t)}request(n={}){return Object.assign(n,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Dx(this.uri(),n)}doWrite(n,t){const r=this.request({method:"POST",data:n});r.on("success",t),r.on("error",(l,f)=>{this.onError("xhr post error",l,f)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=n}}},KU=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,JU=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function vE(e){const n=e,t=e.indexOf("["),r=e.indexOf("]");-1!=t&&-1!=r&&(e=e.substring(0,t)+e.substring(t,r).replace(/:/g,";")+e.substring(r,e.length));let l=KU.exec(e||""),f={},y=14;for(;y--;)f[JU[y]]=l[y]||"";return-1!=t&&-1!=r&&(f.source=n,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=function QU(e,n){const r=n.replace(/\/{2,9}/g,"/").split("/");return("/"==n.slice(0,1)||0===n.length)&&r.splice(0,1),"/"==n.slice(-1)&&r.splice(r.length-1,1),r}(0,f.path),f.queryKey=function ej(e,n){const t={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,l,f){l&&(t[l]=f)}),t}(0,f.query),f}let o2=(()=>{class e extends To{constructor(t,r={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(r=t,t=null),t?(t=vE(t),r.hostname=t.host,r.secure="https"===t.protocol||"wss"===t.protocol,r.port=t.port,t.query&&(r.query=t.query)):r.host&&(r.hostname=vE(r.host).host),Cx(this,r),this.secure=null!=r.secure?r.secure:typeof location<"u"&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=r.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function UU(e){let n={},t=e.split("&");for(let r=0,l=t.length;r<l;r++){let f=t[r].split("=");n[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return n}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=4,r.transport=t,this.id&&(r.sid=this.id);const l=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new YU[t](l)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch{return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",r=>this.onClose("transport close",r))}probe(t){let r=this.createTransport(t),l=!1;e.priorWebsocketSuccess=!1;const f=()=>{l||(r.send([{type:"ping",data:"probe"}]),r.once("packet",oe=>{if(!l)if("pong"===oe.type&&"probe"===oe.data){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;e.priorWebsocketSuccess="websocket"===r.name,this.transport.pause(()=>{l||"closed"!==this.readyState&&(W(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const ve=new Error("probe error");ve.transport=r.name,this.emitReserved("upgradeError",ve)}}))};function y(){l||(l=!0,W(),r.close(),r=null)}const C=oe=>{const ve=new Error("probe error: "+oe);ve.transport=r.name,y(),this.emitReserved("upgradeError",ve)};function D(){C("transport closed")}function O(){C("socket closed")}function $(oe){r&&oe.name!==r.name&&y()}const W=()=>{r.removeListener("open",f),r.removeListener("error",C),r.removeListener("close",D),this.off("close",O),this.off("upgrading",$)};r.once("open",f),r.once("error",C),r.once("close",D),this.once("close",O),this.once("upgrading",$),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn(()=>{l||r.open()},200):r.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const r=this.upgrades.length;for(;t<r;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const r=new Error("server error");r.code=t.data,this.onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let l=0;l<this.writeBuffer.length;l++){const f=this.writeBuffer[l].data;if(f&&(r+=zU(f)),l>0&&r>this.maxPayload)return this.writeBuffer.slice(0,l);r+=2}return this.writeBuffer}write(t,r,l){return this.sendPacket("message",t,r,l),this}send(t,r,l){return this.sendPacket("message",t,r,l),this}sendPacket(t,r,l,f){if("function"==typeof r&&(f=r,r=void 0),"function"==typeof l&&(f=l,l=null),"closing"===this.readyState||"closed"===this.readyState)return;(l=l||{}).compress=!1!==l.compress;const y={type:t,data:r,options:l};this.emitReserved("packetCreate",y),this.writeBuffer.push(y),f&&this.once("flush",f),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},l=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():t()}):this.upgrading?l():t()),this}onError(t){e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,r){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const r=[];let l=0;const f=t.length;for(;l<f;l++)~this.transports.indexOf(t[l])&&r.push(t[l]);return r}}return e.protocol=4,e})();const nj="function"==typeof ArrayBuffer,ij=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,s2=Object.prototype.toString,rj="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===s2.call(Blob),oj="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===s2.call(File);function xE(e){return nj&&(e instanceof ArrayBuffer||ij(e))||rj&&e instanceof Blob||oj&&e instanceof File}function Sx(e,n){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Sx(e[t]))return!0;return!1}if(xE(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Sx(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Sx(e[t]))return!0;return!1}function sj(e){const n=[],r=e;return r.data=bE(e.data,n),r.attachments=n.length,{packet:r,buffers:n}}function bE(e,n){if(!e)return e;if(xE(e)){const t={_placeholder:!0,num:n.length};return n.push(e),t}if(Array.isArray(e)){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=bE(e[r],n);return t}if("object"==typeof e&&!(e instanceof Date)){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=bE(e[r],n));return t}return e}function aj(e,n){return e.data=wE(e.data,n),delete e.attachments,e}function wE(e,n){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<n.length)return n[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=wE(e[t],n);else if("object"==typeof e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=wE(e[t],n));return e}const lj=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],a2=5;var Oi=function(e){return e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK",e}(Oi||{});class cj{constructor(n){this.replacer=n}encode(n){return n.type!==Oi.EVENT&&n.type!==Oi.ACK||!Sx(n)?[this.encodeAsString(n)]:this.encodeAsBinary({type:n.type===Oi.EVENT?Oi.BINARY_EVENT:Oi.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id})}encodeAsString(n){let t=""+n.type;return(n.type===Oi.BINARY_EVENT||n.type===Oi.BINARY_ACK)&&(t+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(t+=n.nsp+","),null!=n.id&&(t+=n.id),null!=n.data&&(t+=JSON.stringify(n.data,this.replacer)),t}encodeAsBinary(n){const t=sj(n),r=this.encodeAsString(t.packet),l=t.buffers;return l.unshift(r),l}}function l2(e){return"[object Object]"===Object.prototype.toString.call(e)}class EE extends To{constructor(n){super(),this.reviver=n}add(n){let t;if("string"==typeof n){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(n);const r=t.type===Oi.BINARY_EVENT;r||t.type===Oi.BINARY_ACK?(t.type=r?Oi.EVENT:Oi.ACK,this.reconstructor=new uj(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!xE(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(n),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(n){let t=0;const r={type:Number(n.charAt(0))};if(void 0===Oi[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Oi.BINARY_EVENT||r.type===Oi.BINARY_ACK){const f=t+1;for(;"-"!==n.charAt(++t)&&t!=n.length;);const y=n.substring(f,t);if(y!=Number(y)||"-"!==n.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(y)}if("/"===n.charAt(t+1)){const f=t+1;for(;++t&&","!==n.charAt(t)&&t!==n.length;);r.nsp=n.substring(f,t)}else r.nsp="/";const l=n.charAt(t+1);if(""!==l&&Number(l)==l){const f=t+1;for(;++t;){const y=n.charAt(t);if(null==y||Number(y)!=y){--t;break}if(t===n.length)break}r.id=Number(n.substring(f,t+1))}if(n.charAt(++t)){const f=this.tryParse(n.substr(t));if(!EE.isPayloadValid(r.type,f))throw new Error("invalid payload");r.data=f}return r}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,t){switch(n){case Oi.CONNECT:return l2(t);case Oi.DISCONNECT:return void 0===t;case Oi.CONNECT_ERROR:return"string"==typeof t||l2(t);case Oi.EVENT:case Oi.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===lj.indexOf(t[0]));case Oi.ACK:case Oi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class uj{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const t=aj(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Fc(e,n,t){return e.on(n,t),function(){e.off(n,t)}}const hj=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class CE extends To{constructor(n,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[Fc(n,"open",this.onopen.bind(this)),Fc(n,"packet",this.onpacket.bind(this)),Fc(n,"error",this.onerror.bind(this)),Fc(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...t){if(hj.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(t.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Oi.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const y=this.ids++,C=t.pop();this._registerAckCallback(y,C),r.id=y}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(n,t){var r;const l=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===l)return void(this.acks[n]=t);const f=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let y=0;y<this.sendBuffer.length;y++)this.sendBuffer[y].id===n&&this.sendBuffer.splice(y,1);t.call(this,new Error("operation has timed out"))},l);this.acks[n]=(...y)=>{this.io.clearTimeoutFn(f),t.apply(this,[null,...y])}}emitWithAck(n,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((l,f)=>{t.push((y,C)=>r?y?f(y):l(C):l(y)),this.emit(n,...t)})}_addToQueue(n){let t;"function"==typeof n[n.length-1]&&(t=n.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((l,...f)=>r!==this._queue[0]?void 0:(null!==l?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(l)):(this._queue.shift(),t&&t(null,...f)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!n||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){"function"==typeof this.auth?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:Oi.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,t)}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case Oi.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Oi.EVENT:case Oi.BINARY_EVENT:this.onevent(n);break;case Oi.ACK:case Oi.BINARY_ACK:this.onack(n);break;case Oi.DISCONNECT:this.ondisconnect();break;case Oi.CONNECT_ERROR:this.destroy();const r=new Error(n.data.message);r.data=n.data.data,this.emitReserved("connect_error",r)}}onevent(n){const t=n.data||[];null!=n.id&&t.push(this.ack(n.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&"string"==typeof n[n.length-1]&&(this._lastOffset=n[n.length-1])}ack(n){const t=this;let r=!1;return function(...l){r||(r=!0,t.packet({type:Oi.ACK,id:n,data:l}))}}onack(n){const t=this.acks[n.id];"function"==typeof t&&(t.apply(this,n.data),delete this.acks[n.id])}onconnect(n,t){this.id=n,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Oi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,n.data)}}}function Xm(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Xm.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),t=Math.floor(n*this.jitter*e);e=1&Math.floor(10*n)?e+t:e-t}return 0|Math.min(e,this.max)},Xm.prototype.reset=function(){this.attempts=0},Xm.prototype.setMin=function(e){this.ms=e},Xm.prototype.setMax=function(e){this.max=e},Xm.prototype.setJitter=function(e){this.jitter=e};class Ix extends To{constructor(n,t){var r;super(),this.nsps={},this.subs=[],n&&"object"==typeof n&&(t=n,n=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Cx(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Xm({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=n;const l=t.parser||dt;this.encoder=new l.Encoder,this.decoder=new l.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection}reconnectionAttempts(n){return void 0===n?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var t;return void 0===n?this._reconnectionDelay:(this._reconnectionDelay=n,null===(t=this.backoff)||void 0===t||t.setMin(n),this)}randomizationFactor(n){var t;return void 0===n?this._randomizationFactor:(this._randomizationFactor=n,null===(t=this.backoff)||void 0===t||t.setJitter(n),this)}reconnectionDelayMax(n){var t;return void 0===n?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,null===(t=this.backoff)||void 0===t||t.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new o2(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const l=Fc(t,"open",function(){r.onopen(),n&&n()}),f=C=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",C),n?n(C):this.maybeReconnectOnOpen()},y=Fc(t,"error",f);if(!1!==this._timeout){const D=this.setTimeoutFn(()=>{l(),f(new Error("timeout")),t.close()},this._timeout);this.opts.autoUnref&&D.unref(),this.subs.push(()=>{this.clearTimeoutFn(D)})}return this.subs.push(l),this.subs.push(y),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push(Fc(n,"ping",this.onping.bind(this)),Fc(n,"data",this.ondata.bind(this)),Fc(n,"error",this.onerror.bind(this)),Fc(n,"close",this.onclose.bind(this)),Fc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(t){this.onclose("parse error",t)}}ondecoded(n){_E(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,t){let r=this.nsps[n];return r?this._autoConnect&&!r.active&&r.connect():(r=new CE(this,n,t),this.nsps[n]=r),r}_destroy(n){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(n){const t=this.encoder.encode(n);for(let r=0;r<t.length;r++)this.engine.write(t[r],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(n,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(l=>{l?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",l)):n.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}}const vy={};function Ad(e,n){"object"==typeof e&&(n=e,e=void 0);const t=function tj(e,n="",t){let r=e;t=t||typeof location<"u"&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(e=typeof t<"u"?t.protocol+"//"+e:"https://"+e),r=vE(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const f=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+f+":"+r.port+n,r.href=r.protocol+"://"+f+(t&&t.port===r.port?"":":"+r.port),r}(e,(n=n||{}).path||"/socket.io"),r=t.source,l=t.id;let D;return n.forceNew||n["force new connection"]||!1===n.multiplex||vy[l]&&t.path in vy[l].nsps?D=new Ix(r,n):(vy[l]||(vy[l]=new Ix(r,n)),D=vy[l]),t.query&&!n.query&&(n.query=t.queryKey),D.socket(t.path,n)}Object.assign(Ad,{Manager:Ix,Socket:CE,io:Ad,connect:Ad});class TE{constructor(n){this.config=n,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===n&&(n=this.emptyConfig),this.ioSocket=(Ad||ze)(n.url,n.options)}of(n){this.ioSocket.of(n)}on(n,t){this.ioSocket.on(n,t)}once(n,t){this.ioSocket.once(n,t)}connect(){return this.ioSocket.connect()}disconnect(n){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(n,...t){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(n,t){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(n){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(n){return this.subscribersCounter[n]||(this.subscribersCounter[n]=0),this.subscribersCounter[n]++,this.eventObservables$[n]||(this.eventObservables$[n]=new Mn(t=>{const r=l=>{t.next(l)};return this.ioSocket.on(n,r),()=>{this.subscribersCounter[n]--,0===this.subscribersCounter[n]&&(this.ioSocket.removeListener(n,r),delete this.eventObservables$[n])}}).pipe(er())),this.eventObservables$[n]}fromOneTimeEvent(n){return new Promise(t=>this.once(n,t))}listeners(n){return this.ioSocket.listeners(n)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(n,t){return n?n&&!t?this.ioSocket.off(n):this.ioSocket.off(n,t):this.ioSocket.offAny()}onAny(n){return this.ioSocket.onAny(n)}onAnyOutgoing(n){return this.ioSocket.onAnyOutgoing(n)}prependAny(n){return this.ioSocket.prependAny(n)}prependAnyOutgoing(n){return this.ioSocket.prependAnyOutgoing(n)}timeout(n){return this.ioSocket.timeout(n)}volatile(){return this.ioSocket.volatile}}function dj(e){return new TE(e)}const c2=new qt("__SOCKET_IO_CONFIG__");let fj=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[{provide:c2,useValue:t},{provide:TE,useFactory:dj,deps:[c2]}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=kn({type:e}),e.\u0275inj=Rr({}),e})();const pj=["asGeoCoder"];function mj(e,n){1&e&&(kt(0,"div",17),xn(1," La descripci\xf3n es requerida. "),Rt())}function gj(e,n){1&e&&(kt(0,"div",17),xn(1," Descripci\xf3n con caracteres no permitidos "),Rt())}function _j(e,n){1&e&&(kt(0,"div",17),xn(1," Tel\xe9fono es requerido. "),Rt())}function yj(e,n){1&e&&(kt(0,"div",17),xn(1," Tel\xe9fono inv\xe1lido, ingrese solo n\xfameros. "),Rt())}const vj=function(e,n,t){return{"alert-success":e,"alert-danger":n,"fade-out":t}};function xj(e,n){if(1&e&&(kt(0,"div",18),xn(1),Rt()),2&e){const t=I_();In("ngClass",eD(2,vj,t.mensaje.includes("\xe9xito"),t.mensaje.includes("Error"),"fade-out"===t.mensajeClass)),Yt(1),mh(" ",t.mensaje," ")}}const bj=function(e){return{"active-way":e}};let wj=(()=>{class e{constructor(t,r,l,f,y){this.mapCustonService=t,this.renderer2=r,this.socket=l,this.ubicacionService=f,this.usuarioServicio=y,this.modeInput="start",this.wayPoints={start:null,end:null},this.mensajeClass="",this.ubicacion={identificacion_usuario:"",telefono:"",latitud:"",longitud:"",estado:"",descripcion:""}}ngOnInit(){this.usuarioServicio.userEmail$.subscribe(l=>{this.usuarioServicio.usuarioLoginOn&&(this.email=l)}),this.ubicacionService.obtenerUbicacionUsuarioPorEmail(this.email).subscribe({next:l=>{l?(this.ubicacion=l,console.log("UBICACION 2 :::: ",this.ubicacion),this.mapCustonService.buildMap(this.ubicacion.latitud,this.ubicacion.longitud).then(({geocoder:f,map:y})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,f.onAdd(y))}).catch(f=>{console.log("***** ERROR ****",f)})):(this.usuarioServicio.userIdentificacion$.subscribe(f=>{this.ubicacion.identificacion_usuario=f}),this.mapCustonService.buildMap("41.398176","2.170946").then(({geocoder:f,map:y})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,f.onAdd(y))}).catch(f=>{console.log("***** ERROR ****",f)}))},error:l=>{console.log("UBICACION ::: algo paso :( ",l)}}),this.mapCustonService.cbAddres.subscribe(l=>{"start"===this.modeInput&&(this.wayPoints.start=l,this.ubicacion.longitud=this.wayPoints.start.geometry.coordinates[0],this.ubicacion.latitud=this.wayPoints.start.geometry.coordinates[1],console.log("##*** this.ubicacion.longitud 0::",this.ubicacion.longitud),console.log("##*** this.ubicacion.latitud 1::",this.ubicacion.latitud))}),this.socket.fromEvent("position").subscribe(({coords:l})=>{console.log("************* DESDE SERVER **********",l),this.mapCustonService.addMarkerCustom(l)})}changeMode(t){this.modeInput=t}actualizaUbicacion(){var t=this;return BA(function*(){t.mensaje="",t.mensajeClass="",console.log("Enviado ubicacion para guardar o actualizar :: ",t.ubicacion),t.ubicacionService.guardaActualizaUbicacion(t.ubicacion).subscribe({next:r=>{t.mensaje="Guardado con \xe9xito",console.log("Se guard\xf3 correctamente:",r),t.ocultarMensajeSegunTiempo()},error:r=>{console.error("Error al guardar ubicaciones:",r),t.mensaje="Presentamos inconvenientes: "+r,t.ocultarMensajeSegunTiempo()}})})()}ocultarMensajeSegunTiempo(){setTimeout(()=>{this.mensaje="",this.mensajeClass="fade-out"},5e3),setTimeout(()=>{this.mensajeClass="fade-out"},3e3)}static#e=this.\u0275fac=function(r){return new(r||e)(nt(TU),nt(Ua),nt(TE),nt(OI),nt($m))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-trabajador"]],viewQuery:function(r,l){if(1&r&&_D(pj,5),2&r){let f;_w(f=function yw(){return function sk(e,n){return e[qi].queries[n].queryList}(mt(),zh())}())&&(l.asGeoCoder=f.first)}},decls:43,vars:14,consts:[[1,"text-center"],[1,"wrapper"],[1,"box-inputs"],["id","geocoder",1,"geocoder"],["asGeoCoder",""],[3,"ngClass","click"],[1,"mock-label"],[1,"mock-input"],["type","text","pattern","^[a-zA-Z0-9.,;'\\s\xf1\xd1]*$","maxlength","200","required","true","placeholder","Ingresa una descripci\xf3n",1,"mock-input","form-control",3,"ngModel","ngModelChange"],["descripcion","ngModel"],["class","alert alert-danger",4,"ngIf"],["type","tel","pattern","[0-9]*","maxlength","15","required","true","placeholder","Ingresa un n\xfamero de tel\xe9fono",1,"mock-input","form-control",3,"ngModel","ngModelChange"],["telefono","ngModel"],["class","alert",3,"ngClass",4,"ngIf"],["id","map",1,"map-container-trabajador"],["asMap",""],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[1,"alert",3,"ngClass"]],template:function(r,l){if(1&r&&(kt(0,"h1",0),xn(1,"Actualice Datos de Ubicaci\xf3n"),Rt(),kt(2,"div",1)(3,"div",2)(4,"div"),yo(5,"div",3,4),Rt(),kt(7,"div",5),gi("click",function(){return l.changeMode("start")}),kt(8,"div",6),xn(9,"Ubicaci\xf3n"),Rt(),kt(10,"div",7),xn(11),Rt()(),kt(12,"div")(13,"div",6),xn(14,"Longitud"),Rt(),kt(15,"div",7),xn(16),Rt()(),kt(17,"div")(18,"div",6),xn(19,"Latitud"),Rt(),kt(20,"div",7),xn(21),Rt()(),kt(22,"div")(23,"div",6),xn(24,"Descripci\xf3n del Lugar"),Rt(),kt(25,"textarea",8,9),gi("ngModelChange",function(y){return l.ubicacion.descripcion=y}),Rt(),Dr(27,mj,2,0,"div",10),Dr(28,gj,2,0,"div",10),Rt(),kt(29,"div")(30,"div",6),xn(31,"Tel\xe9fono de Ubicaci\xf3n"),Rt(),kt(32,"input",11,12),gi("ngModelChange",function(y){return l.ubicacion.telefono=y}),Rt(),Dr(34,_j,2,0,"div",10),Dr(35,yj,2,0,"div",10),Dr(36,xj,2,6,"div",13),Rt()()(),kt(37,"div",1),yo(38,"div",14,15),Rt(),kt(40,"div",0)(41,"button",16),gi("click",function(){return l.actualizaUbicacion()}),xn(42,"Guardar"),Rt()()),2&r){const f=$b(26),y=$b(33);Yt(7),In("ngClass",cw(12,bj,"start"===l.modeInput)),Yt(4),wm(null==l.wayPoints.start?null:l.wayPoints.start.place_name),Yt(5),wm(l.ubicacion.longitud),Yt(5),wm(l.ubicacion.latitud),Yt(4),In("ngModel",l.ubicacion.descripcion),Yt(2),In("ngIf",(null==f.errors?null:f.errors.required)&&(f.dirty||f.touched)),Yt(1),In("ngIf",(null==f.errors?null:f.errors.pattern)&&(f.dirty||f.touched)),Yt(4),In("ngModel",l.ubicacion.telefono),Yt(2),In("ngIf",(null==y.errors?null:y.errors.required)&&(y.dirty||y.touched)),Yt(1),In("ngIf",(null==y.errors?null:y.errors.pattern)&&(y.dirty||y.touched)),Yt(1),In("ngIf",l.mensaje),Yt(5),In("disabled",f.invalid||y.invalid)}},dependencies:[kM,Am,Xf,Hm,xx,cE,uE,qm],styles:[".map-container-trabajador[_ngcontent-%COMP%]{width:52%;height:500px;border-radius:1rem;border:solid 10px white;box-shadow:0 12.5px 10px #00000009,0 100px 80px #00000012}.marker[_ngcontent-%COMP%]{width:50px;height:50px;background-image:url(maps-and-location.1cc4b9a453b3e1ef.png);background-size:contain;background-repeat:no-repeat;background-position:center}.box-inputs[_ngcontent-%COMP%]{background-color:#fff;width:52%;border-radius:.5rem;border:solid 2px #00000008;padding:1rem;box-shadow:0 12.5px 10px #00000009,0 100px 80px #00000012}.mock-input[_ngcontent-%COMP%]{width:100%;background:white;padding:.5rem;margin-bottom:.5rem;box-shadow:0 0 10px #0000001a;color:gray;min-height:18px}.mock-label[_ngcontent-%COMP%]{padding:.25rem;font-weight:600}.geocoder[_ngcontent-%COMP%]{margin-bottom:.5rem}.active-way[_ngcontent-%COMP%]{border:solid 2px #09c509;box-shadow:0 0 10px #09c5094a}.btn-route[_ngcontent-%COMP%]{background-color:#fff;padding:.5rem 1rem;border:solid 2px gray}.wrapper[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:center}.fade-out[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOut 2s;-webkit-animation:_ngcontent-%COMP%_fadeOut 2s}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1}to{opacity:0}}"]})}return e})(),Ej=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-perfil"]],decls:2,vars:0,template:function(r,l){1&r&&(kt(0,"p"),xn(1,"perfil works!"),Rt())}})}return e})(),Cj=(()=>{class e{constructor(){this.tiposIdentificacion=[{id:"CEDULA",nombre:"C\xe9dula"},{id:"PASAPORTE",nombre:"Pasaporte"},{id:"OTRO",nombre:"Otro"}],this.tiposRol=[{id:"1",nombre:"Contratista"},{id:"2",nombre:"Trabajador"}],this.areaprofesione=[{id:"1",nombre:"TECNOLOGIA"},{id:"2",nombre:"ABOGACIA"},{id:"3",nombre:"ELECTRONICO"},{id:"4",nombre:"CONSTRUCCION"},{id:"5",nombre:"DISE\xd1O DIGITAL"},{id:"6",nombre:"ALBA\xd1IL"},{id:"7",nombre:"PLOMERO"},{id:"8",nombre:"CLASES MATEMATICAS"},{id:"9",nombre:"ELECTRICO"},{id:"10",nombre:"CONTRATISTA"}]}getTiposIdentificacion(){return this.tiposIdentificacion}getTiposRol(){return this.tiposRol}getAreProfesiones(){return this.areaprofesione}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=on({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Tj(e,n){if(1&e&&(kt(0,"option",28),xn(1),Rt()),2&e){const t=n.$implicit;In("value",t.id),Yt(1),mh(" ",t.nombre," ")}}function Dj(e,n){if(1&e&&(kt(0,"option",28),xn(1),Rt()),2&e){const t=n.$implicit;In("value",t.id),Yt(1),mh(" ",t.nombre," ")}}function Mj(e,n){if(1&e&&(kt(0,"option",28),xn(1),Rt()),2&e){const t=n.$implicit;In("value",t.id),Yt(1),mh(" ",t.nombre," ")}}const Sj=[{path:"",redirectTo:"/inicio",pathMatch:"full"},{path:"inicio",component:FA},{path:"inicio/:outsesion",component:FA},{path:"iniciar-sesion",component:bU},{path:"crear-contrato/:idcontratante/:idtrabajador",component:EU},{path:"ubicacion",component:wj},{path:"registro",component:(()=>{class e{constructor(t,r){this.selectores=t,this.usuarioServicio=r,this.usuario={id:0,nombres:"",email:"",password:"",rol:0,estado:"INACTIVO",identificacion:"",tipoIdentificacion:""},this.perfilTrabajo={id_perfil:0,id_usuario:0,profesion:0,tiempo_experiencia:"",introduccion:""}}ngOnInit(){this.tiposIdentificaciones=this.selectores.getTiposIdentificacion(),this.tiposRoles=this.selectores.getTiposRol(),this.profesiones=this.selectores.getAreProfesiones()}registrarUsuario(){var t=this;return BA(function*(){console.log("Enviado registro usuario para guardar :: "),t.usuarioServicio.crearUsuario(t.usuario,t.perfilTrabajo).subscribe({next:r=>{t.mensaje="Registro con \xe9xito",console.log("Registro con exito:::",r)},error:r=>{t.mensaje="Presentamos inconvenientes: "+r}})})()}cancelarRegistro(){console.log("Cancelacion registro usuario para guardar :: ")}static#e=this.\u0275fac=function(r){return new(r||e)(nt(Cj),nt($m))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-registro"]],decls:51,vars:14,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[1,"card","p-4",3,"ngSubmit"],["type","hidden","name","id_usuario",3,"ngModel","ngModelChange"],[1,"form-group","mb-3"],["for","nombres"],["type","text","name","nombres","placeholder","Nombres completo",1,"form-control",3,"ngModel","ngModelChange"],["for","email"],["type","email","name","nombres","placeholder","Email",1,"form-control",3,"ngModel","ngModelChange"],["for","password"],["type","password","name","password","placeholder","******",1,"form-control",3,"ngModel","ngModelChange"],["for","rol"],["name","rol",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","tipoidentificacion"],["for","identificacion"],["type","text","name","identificacion","placeholder","0172621900",1,"form-control",3,"ngModel","ngModelChange"],["type","hidden","name","id_perfil",3,"ngModel","ngModelChange"],["for","profesion"],["name","profesion",1,"form-select",3,"ngModel","ngModelChange"],["for","tiempoTrabajo"],["type","text","name","tiempoTrabajo","placeholder","1 a\xf1o 3 meses",1,"form-control",3,"ngModel","ngModelChange"],["for","introduccion"],["type","text","name","introduccion","placeholder","introduccion",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","mb-3"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],[3,"value"]],template:function(r,l){1&r&&(kt(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),xn(4,"Registro de Usuario"),Rt(),kt(5,"form",4),gi("ngSubmit",function(){return l.registrarUsuario()}),kt(6,"input",5),gi("ngModelChange",function(y){return l.usuario.id=y}),Rt(),kt(7,"div",6)(8,"label",7),xn(9,"Nombres"),Rt(),kt(10,"input",8),gi("ngModelChange",function(y){return l.usuario.nombres=y}),Rt()(),kt(11,"div",6)(12,"label",9),xn(13,"Email"),Rt(),kt(14,"input",10),gi("ngModelChange",function(y){return l.usuario.email=y}),Rt()(),kt(15,"div",6)(16,"label",11),xn(17,"Password"),Rt(),kt(18,"input",12),gi("ngModelChange",function(y){return l.usuario.password=y}),Rt()(),kt(19,"div",6)(20,"label",13),xn(21,"Rol"),Rt(),kt(22,"select",14),gi("ngModelChange",function(y){return l.usuario.rol=y}),Dr(23,Tj,2,2,"option",15),Rt()(),kt(24,"div",6)(25,"label",16),xn(26,"Tipo Identificaci\xf3n"),Rt(),kt(27,"select",14),gi("ngModelChange",function(y){return l.usuario.tipoIdentificacion=y}),Dr(28,Dj,2,2,"option",15),Rt()(),kt(29,"div",6)(30,"label",17),xn(31,"Identificacion"),Rt(),kt(32,"input",18),gi("ngModelChange",function(y){return l.usuario.identificacion=y}),Rt()(),kt(33,"input",19),gi("ngModelChange",function(y){return l.perfilTrabajo.id_perfil=y}),Rt(),kt(34,"div",6)(35,"label",20),xn(36,"Profesi\xf3n"),Rt(),kt(37,"select",21),gi("ngModelChange",function(y){return l.perfilTrabajo.profesion=y}),Dr(38,Mj,2,2,"option",15),Rt()(),kt(39,"div",6)(40,"label",22),xn(41,"Tiempo Experiencia"),Rt(),kt(42,"input",23),gi("ngModelChange",function(y){return l.perfilTrabajo.tiempo_experiencia=y}),Rt()(),kt(43,"div",6)(44,"label",24),xn(45,"Actividades Profesionales"),Rt(),kt(46,"input",25),gi("ngModelChange",function(y){return l.perfilTrabajo.introduccion=y}),Rt()(),kt(47,"button",26),xn(48,"Guardar"),Rt(),kt(49,"button",27),gi("click",function(){return l.cancelarRegistro()}),xn(50,"Cancelar"),Rt()()()()()),2&r&&(Yt(6),In("ngModel",l.usuario.id),Yt(4),In("ngModel",l.usuario.nombres),Yt(4),In("ngModel",l.usuario.email),Yt(4),In("ngModel",l.usuario.password),Yt(4),In("ngModel",l.usuario.rol),Yt(1),In("ngForOf",l.tiposRoles),Yt(4),In("ngModel",l.usuario.tipoIdentificacion),Yt(1),In("ngForOf",l.tiposIdentificaciones),Yt(4),In("ngModel",l.usuario.identificacion),Yt(1),In("ngModel",l.perfilTrabajo.id_perfil),Yt(4),In("ngModel",l.perfilTrabajo.profesion),Yt(1),In("ngForOf",l.profesiones),Yt(4),In("ngModel",l.perfilTrabajo.tiempo_experiencia),Yt(4),In("ngModel",l.perfilTrabajo.introduccion))},dependencies:[Qw,yx,sE,lE,Xf,_y,Hm,cx,qm,my]})}return e})()},{path:"perfil",component:Ej},{path:"admin-contrato",component:(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-admincontrato"]],decls:2,vars:0,template:function(r,l){1&r&&(kt(0,"p"),xn(1,"admincontrato works!"),Rt())}})}return e})()}];let Ij=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e});static#n=this.\u0275inj=Rr({imports:[_I.forRoot(Sj),_I]})}return e})(),Aj=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-header"]],decls:6,vars:0,consts:[[1,"jumotron","bg-cover","text-white"],[1,"container","py-5","text-center"],[1,"display-4","font-weight-bold"]],template:function(r,l){1&r&&(kt(0,"header",0)(1,"div",1)(2,"h1",2),xn(3,"Soluciones Inmediatas"),Rt(),kt(4,"h1",2),xn(5,"Conectamos Expertos de su area. Sin Esperas."),Rt()()())},styles:["header[_ngcontent-%COMP%]{background:url(question-mark-1872665_640.fcfd18a32560cc9e.jpg)}"]})}return e})(),Pj=(()=>{class e{getIconSvgPath(){return`assets/icons/${this.iconName}.svg`}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-icon"]],inputs:{iconName:"iconName"},decls:1,vars:2,consts:[[3,"src","alt"]],template:function(r,l){1&r&&yo(0,"img",0),2&r&&(Zb("alt",l.iconName),In("src",l.getIconSvgPath(),Qp))},styles:["a[_ngcontent-%COMP%]{text-decoration:none;display:inline-block;margin:0 10px}img[_ngcontent-%COMP%]{width:24px;height:auto}"]})}return e})(),Rj=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-footer"]],decls:20,vars:0,consts:[[1,"jumotron"],[1,"text-center","text-white"],[1,"container-fluid"],[1,"row","justify-content-center"],[1,"col-lg-8","mt-2"],[1,"text-center","mb-2"],["href","",1,"text-white","me-4"],["iconName","facebook-logo-svgrepo-com"],["iconName","twitter-social-logotype-svgrepo-com"],["iconName","google-logo-fill-svgrepo-com"],["iconName","instagram-logo-svgrepo-com"],["iconName","linkedin-logo-svgrepo-com"],["iconName","github-142-svgrepo-com"]],template:function(r,l){1&r&&(kt(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"p"),xn(6," Este sitio tiene como objetivo facilitar la distribuci\xf3n laboral a corto plazo para personas sin trabajo fijo y emprendedores, sitio web sin fines de lucro "),Rt()()(),kt(7,"div",5)(8,"a",6),yo(9,"app-icon",7),Rt(),kt(10,"a",6),yo(11,"app-icon",8),Rt(),kt(12,"a",6),yo(13,"app-icon",9),Rt(),kt(14,"a",6),yo(15,"app-icon",10),Rt(),kt(16,"a",6),yo(17,"app-icon",11),Rt(),kt(18,"a",6),yo(19,"app-icon",12),Rt()()()()())},dependencies:[Pj],styles:["footer[_ngcontent-%COMP%]{background-color:#646262}.app-footer[_ngcontent-%COMP%]{height:60px}"]})}return e})();function Lj(e,n){1&e&&(kt(0,"li",7)(1,"a",10),xn(2,"Inicio Sesi\xf3n"),Rt()())}function kj(e,n){1&e&&(kt(0,"li",7)(1,"a",11),xn(2,"Registrarse"),Rt()())}function Oj(e,n){1&e&&(kt(0,"li",7)(1,"a",12),xn(2,"Mi Ubicaci\xf3n"),Rt()())}function Nj(e,n){1&e&&(kt(0,"li",7)(1,"a",13),xn(2,"Mi Perfil"),Rt()())}function Fj(e,n){1&e&&(kt(0,"li",7)(1,"a",14),xn(2,"Administra Contratos"),Rt()())}const zj=function(){return{outsesion:"outsesion"}},Bj=function(e){return["/inicio",e]};function Vj(e,n){1&e&&(kt(0,"li",7)(1,"a",15),xn(2,"Cerrar Sesi\xf3n"),Rt()()),2&e&&(Yt(1),In("routerLink",cw(2,Bj,function QT(e,n,t){const r=as()+e,l=mt();return l[r]===hn?mu(l,r,t?n.call(t):n()):function C_(e,n){return e[n]}(l,r)}(1,zj))))}let Uj=(()=>{class e{constructor(t,r){this.usuarioServer=t,this.router=r,this.userLoginOn=!1}ngOnInit(){this.usuarioServer.currentUserLoginOn.subscribe({next:t=>{this.userLoginOn=t}})}static#e=this.\u0275fac=function(r){return new(r||e)(nt($m),nt(Is))};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-nav"]],decls:17,vars:6,consts:[[1,"navbar","navbar-expand-lg","bg-body-tertiary"],[1,"container-fluid"],[1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],[1,"nav-item"],["aria-current","page","routerLink","/inicio",1,"nav-link"],["class","nav-item",4,"ngIf"],["routerLink","/iniciar-sesion",1,"nav-link","active"],["routerLink","/registro","aria-disabled","true",1,"nav-link"],["routerLink","/ubicacion","aria-disabled","true",1,"nav-link"],["routerLink","/perfil","aria-disabled","true",1,"nav-link"],["routerLink","/admin-contrato","aria-disabled","true",1,"nav-link"],["aria-disabled","true",1,"nav-link",3,"routerLink"]],template:function(r,l){1&r&&(kt(0,"nav",0)(1,"div",1)(2,"a",2),xn(3,"Localizador"),Rt(),kt(4,"button",3),yo(5,"span",4),Rt(),kt(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),xn(10,"Inicio"),Rt()(),Dr(11,Lj,3,0,"li",9),Dr(12,kj,3,0,"li",9),Dr(13,Oj,3,0,"li",9),Dr(14,Nj,3,0,"li",9),Dr(15,Fj,3,0,"li",9),Dr(16,Vj,3,4,"li",9),Rt()()()()),2&r&&(Yt(11),In("ngIf",!l.userLoginOn),Yt(1),In("ngIf",!l.userLoginOn),Yt(1),In("ngIf",l.userLoginOn),Yt(1),In("ngIf",l.userLoginOn),Yt(1),In("ngIf",l.userLoginOn),Yt(1),In("ngIf",l.userLoginOn))},dependencies:[Am,tx],styles:["button[_ngcontent-%COMP%]:hover{background-color:#4caf50;color:#fff}"]})}return e})(),jj=(()=>{class e{constructor(){this.title="buscaPersonaFree"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=mr({type:e,selectors:[["app-root"]],decls:7,vars:0,consts:[[1,"main-container"],[1,"content-wrapper"],[1,"app-footer"]],template:function(r,l){1&r&&(kt(0,"div",0),yo(1,"app-header")(2,"app-nav"),kt(3,"div",1),yo(4,"router-outlet"),Rt(),kt(5,"div",2),yo(6,"app-footer"),Rt()())},dependencies:[A1,Aj,Rj,Uj]})}return e})();const $j={url:"https://api-back-service-3uomm4d6da-uc.a.run.app",options:{}};let Hj=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=kn({type:e,bootstrap:[jj]});static#n=this.\u0275inj=Rr({imports:[QF,Ij,lU,aV,fj.forRoot($j),aU]})}return e})();KF().bootstrapModule(Hj).catch(e=>console.error(e))},391:function(Ht,$t,_e){var dt;Ht=_e.nmd(Ht),function(ze){"object"==typeof global&&global;var Me=function(Lt){this.message=Lt};(Me.prototype=new Error).name="InvalidCharacterError";var Pe=function(Lt){throw new Me(Lt)},Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ae=/[\t\n\f\r ]/g,Ft={encode:function(Lt){Lt=String(Lt),/[^\0-\xFF]/.test(Lt)&&Pe("The string to be encoded contains characters outside of the Latin1 range.");for(var _t,Ue,Re,Oe,At=Lt.length%3,he="",Ye=-1,Pt=Lt.length-At;++Ye<Pt;)_t=Lt.charCodeAt(Ye)<<16,Ue=Lt.charCodeAt(++Ye)<<8,Re=Lt.charCodeAt(++Ye),he+=Se.charAt((Oe=_t+Ue+Re)>>18&63)+Se.charAt(Oe>>12&63)+Se.charAt(Oe>>6&63)+Se.charAt(63&Oe);return 2==At?(_t=Lt.charCodeAt(Ye)<<8,Ue=Lt.charCodeAt(++Ye),he+=Se.charAt((Oe=_t+Ue)>>10)+Se.charAt(Oe>>4&63)+Se.charAt(Oe<<2&63)+"="):1==At&&(Oe=Lt.charCodeAt(Ye),he+=Se.charAt(Oe>>2)+Se.charAt(Oe<<4&63)+"=="),he},decode:function(Lt){var At=(Lt=String(Lt).replace(Ae,"")).length;At%4==0&&(At=(Lt=Lt.replace(/==?$/,"")).length),(At%4==1||/[^+a-zA-Z0-9/]/.test(Lt))&&Pe("Invalid character: the string to be decoded is not correctly encoded.");for(var Ye,_t,he=0,Ue="",Re=-1;++Re<At;)_t=Se.indexOf(Lt.charAt(Re)),Ye=he%4?64*Ye+_t:_t,he++%4&&(Ue+=String.fromCharCode(255&Ye>>(-2*he&6)));return Ue},version:"0.1.0"};void 0!==(dt=function(){return Ft}.call($t,_e,$t,Ht))&&(Ht.exports=dt)}()},16:Ht=>{"use strict";var dt,$t="object"==typeof Reflect?Reflect:null,_e=$t&&"function"==typeof $t.apply?$t.apply:function(Re,it,Oe){return Function.prototype.apply.call(Re,it,Oe)};dt=$t&&"function"==typeof $t.ownKeys?$t.ownKeys:Object.getOwnPropertySymbols?function(Re){return Object.getOwnPropertyNames(Re).concat(Object.getOwnPropertySymbols(Re))}:function(Re){return Object.getOwnPropertyNames(Re)};var Te=Number.isNaN||function(Re){return Re!=Re};function u(){u.init.call(this)}Ht.exports=u,Ht.exports.once=function he(Ue,Re){return new Promise(function(it,Oe){function Pt(It){Ue.removeListener(Re,Gt),Oe(It)}function Gt(){"function"==typeof Ue.removeListener&&Ue.removeListener("error",Pt),it([].slice.call(arguments))}_t(Ue,Re,Gt,{once:!0}),"error"!==Re&&function Ye(Ue,Re,it){"function"==typeof Ue.on&&_t(Ue,"error",Re,it)}(Ue,Pt,{once:!0})})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var Q=10;function Me(Ue){if("function"!=typeof Ue)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ue)}function Pe(Ue){return void 0===Ue._maxListeners?u.defaultMaxListeners:Ue._maxListeners}function Se(Ue,Re,it,Oe){var Pt,Gt,It;if(Me(it),void 0===(Gt=Ue._events)?(Gt=Ue._events=Object.create(null),Ue._eventsCount=0):(void 0!==Gt.newListener&&(Ue.emit("newListener",Re,it.listener?it.listener:it),Gt=Ue._events),It=Gt[Re]),void 0===It)It=Gt[Re]=it,++Ue._eventsCount;else if("function"==typeof It?It=Gt[Re]=Oe?[it,It]:[It,it]:Oe?It.unshift(it):It.push(it),(Pt=Pe(Ue))>0&&It.length>Pt&&!It.warned){It.warned=!0;var En=new Error("Possible EventEmitter memory leak detected. "+It.length+" "+String(Re)+" listeners added. Use emitter.setMaxListeners() to increase limit");En.name="MaxListenersExceededWarning",En.emitter=Ue,En.type=Re,En.count=It.length,function ze(Ue){console&&console.warn&&console.warn(Ue)}(En)}return Ue}function Ae(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function pt(Ue,Re,it){var Oe={fired:!1,wrapFn:void 0,target:Ue,type:Re,listener:it},Pt=Ae.bind(Oe);return Pt.listener=it,Oe.wrapFn=Pt,Pt}function Zt(Ue,Re,it){var Oe=Ue._events;if(void 0===Oe)return[];var Pt=Oe[Re];return void 0===Pt?[]:"function"==typeof Pt?it?[Pt.listener||Pt]:[Pt]:it?function At(Ue){for(var Re=new Array(Ue.length),it=0;it<Re.length;++it)Re[it]=Ue[it].listener||Ue[it];return Re}(Pt):Ct(Pt,Pt.length)}function Ft(Ue){var Re=this._events;if(void 0!==Re){var it=Re[Ue];if("function"==typeof it)return 1;if(void 0!==it)return it.length}return 0}function Ct(Ue,Re){for(var it=new Array(Re),Oe=0;Oe<Re;++Oe)it[Oe]=Ue[Oe];return it}function _t(Ue,Re,it,Oe){if("function"==typeof Ue.on)Oe.once?Ue.once(Re,it):Ue.on(Re,it);else{if("function"!=typeof Ue.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ue);Ue.addEventListener(Re,function Pt(Gt){Oe.once&&Ue.removeEventListener(Re,Pt),it(Gt)})}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function(Ue){if("number"!=typeof Ue||Ue<0||Te(Ue))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ue+".");Q=Ue}}),u.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(Re){if("number"!=typeof Re||Re<0||Te(Re))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Re+".");return this._maxListeners=Re,this},u.prototype.getMaxListeners=function(){return Pe(this)},u.prototype.emit=function(Re){for(var it=[],Oe=1;Oe<arguments.length;Oe++)it.push(arguments[Oe]);var Pt="error"===Re,Gt=this._events;if(void 0!==Gt)Pt=Pt&&void 0===Gt.error;else if(!Pt)return!1;if(Pt){var It;if(it.length>0&&(It=it[0]),It instanceof Error)throw It;var En=new Error("Unhandled error."+(It?" ("+It.message+")":""));throw En.context=It,En}var Ii=Gt[Re];if(void 0===Ii)return!1;if("function"==typeof Ii)_e(Ii,this,it);else{var Ui=Ii.length,jr=Ct(Ii,Ui);for(Oe=0;Oe<Ui;++Oe)_e(jr[Oe],this,it)}return!0},u.prototype.on=u.prototype.addListener=function(Re,it){return Se(this,Re,it,!1)},u.prototype.prependListener=function(Re,it){return Se(this,Re,it,!0)},u.prototype.once=function(Re,it){return Me(it),this.on(Re,pt(this,Re,it)),this},u.prototype.prependOnceListener=function(Re,it){return Me(it),this.prependListener(Re,pt(this,Re,it)),this},u.prototype.off=u.prototype.removeListener=function(Re,it){var Oe,Pt,Gt,It,En;if(Me(it),void 0===(Pt=this._events))return this;if(void 0===(Oe=Pt[Re]))return this;if(Oe===it||Oe.listener===it)0==--this._eventsCount?this._events=Object.create(null):(delete Pt[Re],Pt.removeListener&&this.emit("removeListener",Re,Oe.listener||it));else if("function"!=typeof Oe){for(Gt=-1,It=Oe.length-1;It>=0;It--)if(Oe[It]===it||Oe[It].listener===it){En=Oe[It].listener,Gt=It;break}if(Gt<0)return this;0===Gt?Oe.shift():function Lt(Ue,Re){for(;Re+1<Ue.length;Re++)Ue[Re]=Ue[Re+1];Ue.pop()}(Oe,Gt),1===Oe.length&&(Pt[Re]=Oe[0]),void 0!==Pt.removeListener&&this.emit("removeListener",Re,En||it)}return this},u.prototype.removeAllListeners=function(Re){var it,Oe,Pt;if(void 0===(Oe=this._events))return this;if(void 0===Oe.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Oe[Re]&&(0==--this._eventsCount?this._events=Object.create(null):delete Oe[Re]),this;if(0===arguments.length){var It,Gt=Object.keys(Oe);for(Pt=0;Pt<Gt.length;++Pt)"removeListener"!==(It=Gt[Pt])&&this.removeAllListeners(It);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(it=Oe[Re]))this.removeListener(Re,it);else if(void 0!==it)for(Pt=it.length-1;Pt>=0;Pt--)this.removeListener(Re,it[Pt]);return this},u.prototype.listeners=function(Re){return Zt(this,Re,!0)},u.prototype.rawListeners=function(Re){return Zt(this,Re,!1)},u.listenerCount=function(Ue,Re){return"function"==typeof Ue.listenerCount?Ue.listenerCount(Re):Ft.call(Ue,Re)},u.prototype.listenerCount=Ft,u.prototype.eventNames=function(){return this._eventsCount>0?dt(this._events):[]}},424:Ht=>{var _e;Ht.exports=_e={},_e.simpleFilter=function(dt,ze){return ze.filter(function(Te){return _e.test(dt,Te)})},_e.test=function(dt,ze){return null!==_e.match(dt,ze)},_e.match=function(dt,ze,Te){var Ft,u=0,Q=[],Me=ze.length,Pe=0,Se=0,Ae=(Te=Te||{}).pre||"",pt=Te.post||"",Zt=Te.caseSensitive&&ze||ze.toLowerCase();dt=Te.caseSensitive&&dt||dt.toLowerCase();for(var Ct=0;Ct<Me;Ct++)Ft=ze[Ct],Zt[Ct]===dt[u]?(Ft=Ae+Ft+pt,u+=1,Se+=1+Se):Se=0,Pe+=Se,Q[Q.length]=Ft;return u===dt.length?(Pe=Zt===dt?1/0:Pe,{rendered:Q.join(""),score:Pe}):null},_e.filter=function(dt,ze,Te){return ze&&0!==ze.length?"string"!=typeof dt?ze:(Te=Te||{},ze.reduce(function(u,Q,Me,Pe){var Se=Q;Te.extract&&(Se=Te.extract(Q));var Ae=_e.match(dt,Se,Te);return null!=Ae&&(u[u.length]={string:Ae.rendered,score:Ae.score,index:Me,original:Q}),u},[]).sort(function(u,Q){return Q.score-u.score||u.index-Q.index})):[]}},433:function(Ht,$t){!function(_e){"use strict";function ze(h){var x,M,k,U;for(M=1,k=arguments.length;M<k;M++)for(x in U=arguments[M])h[x]=U[x];return h}var Te=Object.create||function(){function h(){}return function(x){return h.prototype=x,new h}}();function u(h,x){var M=Array.prototype.slice;if(h.bind)return h.bind.apply(h,M.call(arguments,1));var k=M.call(arguments,2);return function(){return h.apply(x,k.length?k.concat(M.call(arguments)):arguments)}}var Q=0;function Me(h){return"_leaflet_id"in h||(h._leaflet_id=++Q),h._leaflet_id}function Pe(h,x,M){var k,U,X,xe;return xe=function(){k=!1,U&&(X.apply(M,U),U=!1)},X=function(){k?U=arguments:(h.apply(M,arguments),setTimeout(xe,x),k=!0)},X}function Se(h,x,M){var k=x[1],U=x[0],X=k-U;return h===k&&M?h:((h-U)%X+X)%X+U}function Ae(){return!1}function pt(h,x){if(!1===x)return h;var M=Math.pow(10,void 0===x?6:x);return Math.round(h*M)/M}function Zt(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function Ft(h){return Zt(h).split(/\s+/)}function Ct(h,x){for(var M in Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?Te(h.options):{}),x)h.options[M]=x[M];return h.options}function Lt(h,x,M){var k=[];for(var U in h)k.push(encodeURIComponent(M?U.toUpperCase():U)+"="+encodeURIComponent(h[U]));return(x&&-1!==x.indexOf("?")?"&":"?")+k.join("&")}var At=/\{ *([\w_ -]+) *\}/g;function he(h,x){return h.replace(At,function(M,k){var U=x[k];if(void 0===U)throw new Error("No value provided for variable "+M);return"function"==typeof U&&(U=U(x)),U})}var Ye=Array.isArray||function(h){return"[object Array]"===Object.prototype.toString.call(h)};function _t(h,x){for(var M=0;M<h.length;M++)if(h[M]===x)return M;return-1}var Ue="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Re(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var it=0;function Oe(h){var x=+new Date,M=Math.max(0,16-(x-it));return it=x+M,window.setTimeout(h,M)}var Pt=window.requestAnimationFrame||Re("RequestAnimationFrame")||Oe,Gt=window.cancelAnimationFrame||Re("CancelAnimationFrame")||Re("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function It(h,x,M){if(!M||Pt!==Oe)return Pt.call(window,u(h,x));h.call(x)}function En(h){h&&Gt.call(window,h)}var Ii={__proto__:null,extend:ze,create:Te,bind:u,get lastId(){return Q},stamp:Me,throttle:Pe,wrapNum:Se,falseFn:Ae,formatNum:pt,trim:Zt,splitWords:Ft,setOptions:Ct,getParamString:Lt,template:he,isArray:Ye,indexOf:_t,emptyImageUrl:Ue,requestFn:Pt,cancelFn:Gt,requestAnimFrame:It,cancelAnimFrame:En};function Ui(){}Ui.extend=function(h){var x=function(){Ct(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},M=x.__super__=this.prototype,k=Te(M);for(var U in k.constructor=x,x.prototype=k,this)Object.prototype.hasOwnProperty.call(this,U)&&"prototype"!==U&&"__super__"!==U&&(x[U]=this[U]);return h.statics&&ze(x,h.statics),h.includes&&(function jr(h){if(!(typeof L>"u")&&L&&L.Mixin){h=Ye(h)?h:[h];for(var x=0;x<h.length;x++)h[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(h.includes),ze.apply(null,[k].concat(h.includes))),ze(k,h),delete k.statics,delete k.includes,k.options&&(k.options=M.options?Te(M.options):{},ze(k.options,h.options)),k._initHooks=[],k.callInitHooks=function(){if(!this._initHooksCalled){M.callInitHooks&&M.callInitHooks.call(this),this._initHooksCalled=!0;for(var X=0,xe=k._initHooks.length;X<xe;X++)k._initHooks[X].call(this)}},x},Ui.include=function(h){var x=this.prototype.options;return ze(this.prototype,h),h.options&&(this.prototype.options=x,this.mergeOptions(h.options)),this},Ui.mergeOptions=function(h){return ze(this.prototype.options,h),this},Ui.addInitHook=function(h){var x=Array.prototype.slice.call(arguments,1),M="function"==typeof h?h:function(){this[h].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(M),this};var yr={on:function(h,x,M){if("object"==typeof h)for(var k in h)this._on(k,h[k],x);else for(var U=0,X=(h=Ft(h)).length;U<X;U++)this._on(h[U],x,M);return this},off:function(h,x,M){if(arguments.length)if("object"==typeof h)for(var k in h)this._off(k,h[k],x);else{h=Ft(h);for(var U=1===arguments.length,X=0,xe=h.length;X<xe;X++)U?this._off(h[X]):this._off(h[X],x,M)}else delete this._events;return this},_on:function(h,x,M,k){if("function"==typeof x){if(!1===this._listens(h,x,M)){M===this&&(M=void 0);var U={fn:x,ctx:M};k&&(U.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(U)}}else console.warn("wrong listener type: "+typeof x)},_off:function(h,x,M){var k,U,X;if(this._events&&(k=this._events[h])){if(1===arguments.length){if(this._firingCount)for(U=0,X=k.length;U<X;U++)k[U].fn=Ae;return void delete this._events[h]}if("function"!=typeof x)return void console.warn("wrong listener type: "+typeof x);var xe=this._listens(h,x,M);!1!==xe&&(this._firingCount&&(k[xe].fn=Ae,this._events[h]=k=k.slice()),k.splice(xe,1))}},fire:function(h,x,M){if(!this.listens(h,M))return this;var k=ze({},x,{type:h,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var U=this._events[h];if(U){this._firingCount=this._firingCount+1||1;for(var X=0,xe=U.length;X<xe;X++){var je=U[X],Le=je.fn;je.once&&this.off(h,Le,je.ctx),Le.call(je.ctx||this,k)}this._firingCount--}}return M&&this._propagateEvent(k),this},listens:function(h,x,M,k){"string"!=typeof h&&console.warn('"string" type argument expected');var U=x;"function"!=typeof x&&(k=!!x,U=void 0,M=void 0);var X=this._events&&this._events[h];if(X&&X.length&&!1!==this._listens(h,U,M))return!0;if(k)for(var xe in this._eventParents)if(this._eventParents[xe].listens(h,x,M,k))return!0;return!1},_listens:function(h,x,M){if(!this._events)return!1;var k=this._events[h]||[];if(!x)return!!k.length;M===this&&(M=void 0);for(var U=0,X=k.length;U<X;U++)if(k[U].fn===x&&k[U].ctx===M)return U;return!1},once:function(h,x,M){if("object"==typeof h)for(var k in h)this._on(k,h[k],x,!0);else for(var U=0,X=(h=Ft(h)).length;U<X;U++)this._on(h[U],x,M,!0);return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[Me(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[Me(h)],this},_propagateEvent:function(h){for(var x in this._eventParents)this._eventParents[x].fire(h.type,ze({layer:h.target,propagatedFrom:h.target},h),!0)}};yr.addEventListener=yr.on,yr.removeEventListener=yr.clearAllEventListeners=yr.off,yr.addOneTimeEventListener=yr.once,yr.fireEvent=yr.fire,yr.hasEventListeners=yr.listens;var Cn=Ui.extend(yr);function bn(h,x,M){this.x=M?Math.round(h):h,this.y=M?Math.round(x):x}var Ji=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};function un(h,x,M){return h instanceof bn?h:Ye(h)?new bn(h[0],h[1]):null==h?h:"object"==typeof h&&"x"in h&&"y"in h?new bn(h.x,h.y):new bn(h,x,M)}function Mn(h,x){if(h)for(var M=x?[h,x]:h,k=0,U=M.length;k<U;k++)this.extend(M[k])}function ni(h,x){return!h||h instanceof Mn?h:new Mn(h,x)}function ji(h,x){if(h)for(var M=x?[h,x]:h,k=0,U=M.length;k<U;k++)this.extend(M[k])}function Ai(h,x){return h instanceof ji?h:new ji(h,x)}function ri(h,x,M){if(isNaN(h)||isNaN(x))throw new Error("Invalid LatLng object: ("+h+", "+x+")");this.lat=+h,this.lng=+x,void 0!==M&&(this.alt=+M)}function Tn(h,x,M){return h instanceof ri?h:Ye(h)&&"object"!=typeof h[0]?3===h.length?new ri(h[0],h[1],h[2]):2===h.length?new ri(h[0],h[1]):null:null==h?h:"object"==typeof h&&"lat"in h?new ri(h.lat,"lng"in h?h.lng:h.lon,h.alt):void 0===x?null:new ri(h,x,M)}bn.prototype={clone:function(){return new bn(this.x,this.y)},add:function(h){return this.clone()._add(un(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(un(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new bn(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new bn(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Ji(this.x),this.y=Ji(this.y),this},distanceTo:function(h){var x=(h=un(h)).x-this.x,M=h.y-this.y;return Math.sqrt(x*x+M*M)},equals:function(h){return(h=un(h)).x===this.x&&h.y===this.y},contains:function(h){return h=un(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+pt(this.x)+", "+pt(this.y)+")"}},Mn.prototype={extend:function(h){var x,M;if(!h)return this;if(h instanceof bn||"number"==typeof h[0]||"x"in h)x=M=un(h);else if(M=(h=ni(h)).max,!(x=h.min)||!M)return this;return this.min||this.max?(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(M.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(M.y,this.max.y)):(this.min=x.clone(),this.max=M.clone()),this},getCenter:function(h){return un((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return un(this.min.x,this.max.y)},getTopRight:function(){return un(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var x,M;return(h="number"==typeof h[0]||h instanceof bn?un(h):ni(h))instanceof Mn?(x=h.min,M=h.max):x=M=h,x.x>=this.min.x&&M.x<=this.max.x&&x.y>=this.min.y&&M.y<=this.max.y},intersects:function(h){h=ni(h);var x=this.min,M=this.max,k=h.min,U=h.max;return U.x>=x.x&&k.x<=M.x&&U.y>=x.y&&k.y<=M.y},overlaps:function(h){h=ni(h);var x=this.min,M=this.max,k=h.min,U=h.max;return U.x>x.x&&k.x<M.x&&U.y>x.y&&k.y<M.y},isValid:function(){return!(!this.min||!this.max)},pad:function(h){var x=this.min,M=this.max,k=Math.abs(x.x-M.x)*h,U=Math.abs(x.y-M.y)*h;return ni(un(x.x-k,x.y-U),un(M.x+k,M.y+U))},equals:function(h){return!!h&&(h=ni(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight()))}},ji.prototype={extend:function(h){var k,U,x=this._southWest,M=this._northEast;if(h instanceof ri)k=h,U=h;else{if(!(h instanceof ji))return h?this.extend(Tn(h)||Ai(h)):this;if(U=h._northEast,!(k=h._southWest)||!U)return this}return x||M?(x.lat=Math.min(k.lat,x.lat),x.lng=Math.min(k.lng,x.lng),M.lat=Math.max(U.lat,M.lat),M.lng=Math.max(U.lng,M.lng)):(this._southWest=new ri(k.lat,k.lng),this._northEast=new ri(U.lat,U.lng)),this},pad:function(h){var x=this._southWest,M=this._northEast,k=Math.abs(x.lat-M.lat)*h,U=Math.abs(x.lng-M.lng)*h;return new ji(new ri(x.lat-k,x.lng-U),new ri(M.lat+k,M.lng+U))},getCenter:function(){return new ri((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ri(this.getNorth(),this.getWest())},getSouthEast:function(){return new ri(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){h="number"==typeof h[0]||h instanceof ri||"lat"in h?Tn(h):Ai(h);var k,U,x=this._southWest,M=this._northEast;return h instanceof ji?(k=h.getSouthWest(),U=h.getNorthEast()):k=U=h,k.lat>=x.lat&&U.lat<=M.lat&&k.lng>=x.lng&&U.lng<=M.lng},intersects:function(h){h=Ai(h);var x=this._southWest,M=this._northEast,k=h.getSouthWest(),U=h.getNorthEast();return U.lat>=x.lat&&k.lat<=M.lat&&U.lng>=x.lng&&k.lng<=M.lng},overlaps:function(h){h=Ai(h);var x=this._southWest,M=this._northEast,k=h.getSouthWest(),U=h.getNorthEast();return U.lat>x.lat&&k.lat<M.lat&&U.lng>x.lng&&k.lng<M.lng},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,x){return!!h&&(h=Ai(h),this._southWest.equals(h.getSouthWest(),x)&&this._northEast.equals(h.getNorthEast(),x))},isValid:function(){return!(!this._southWest||!this._northEast)}},ri.prototype={equals:function(h,x){return!!h&&(h=Tn(h),Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng))<=(void 0===x?1e-9:x))},toString:function(h){return"LatLng("+pt(this.lat,h)+", "+pt(this.lng,h)+")"},distanceTo:function(h){return li.distance(this,Tn(h))},wrap:function(){return li.wrapLatLng(this)},toBounds:function(h){var x=180*h/40075017,M=x/Math.cos(Math.PI/180*this.lat);return Ai([this.lat-x,this.lng-M],[this.lat+x,this.lng+M])},clone:function(){return new ri(this.lat,this.lng,this.alt)}};var h,$r={latLngToPoint:function(h,x){var M=this.projection.project(h),k=this.scale(x);return this.transformation._transform(M,k)},pointToLatLng:function(h,x){var M=this.scale(x),k=this.transformation.untransform(h,M);return this.projection.unproject(k)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var x=this.projection.bounds,M=this.scale(h);return new Mn(this.transformation.transform(x.min,M),this.transformation.transform(x.max,M))},infinite:!1,wrapLatLng:function(h){var x=this.wrapLng?Se(h.lng,this.wrapLng,!0):h.lng;return new ri(this.wrapLat?Se(h.lat,this.wrapLat,!0):h.lat,x,h.alt)},wrapLatLngBounds:function(h){var x=h.getCenter(),M=this.wrapLatLng(x),k=x.lat-M.lat,U=x.lng-M.lng;if(0===k&&0===U)return h;var X=h.getSouthWest(),xe=h.getNorthEast();return new ji(new ri(X.lat-k,X.lng-U),new ri(xe.lat-k,xe.lng-U))}},li=ze({},$r,{wrapLng:[-180,180],R:6371e3,distance:function(h,x){var M=Math.PI/180,k=h.lat*M,U=x.lat*M,X=Math.sin((x.lat-h.lat)*M/2),xe=Math.sin((x.lng-h.lng)*M/2),je=X*X+Math.cos(k)*Math.cos(U)*xe*xe,Le=2*Math.atan2(Math.sqrt(je),Math.sqrt(1-je));return this.R*Le}}),sn={R:6378137,MAX_LATITUDE:85.0511287798,project:function(h){var x=Math.PI/180,M=this.MAX_LATITUDE,k=Math.max(Math.min(M,h.lat),-M),U=Math.sin(k*x);return new bn(this.R*h.lng*x,this.R*Math.log((1+U)/(1-U))/2)},unproject:function(h){var x=180/Math.PI;return new ri((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*x,h.x*x/this.R)},bounds:(h=6378137*Math.PI,new Mn([-h,-h],[h,h]))};function Jo(h,x,M,k){if(Ye(h))return this._a=h[0],this._b=h[1],this._c=h[2],void(this._d=h[3]);this._a=h,this._b=x,this._c=M,this._d=k}function Nn(h,x,M,k){return new Jo(h,x,M,k)}Jo.prototype={transform:function(h,x){return this._transform(h.clone(),x)},_transform:function(h,x){return h.x=(x=x||1)*(this._a*h.x+this._b),h.y=x*(this._c*h.y+this._d),h},untransform:function(h,x){return new bn((h.x/(x=x||1)-this._b)/this._a,(h.y/x-this._d)/this._c)}};var Ps=ze({},li,{code:"EPSG:3857",projection:sn,transformation:function(){var h=.5/(Math.PI*sn.R);return Nn(h,.5,-h,.5)}()}),Zi=ze({},Ps,{code:"EPSG:900913"});function ho(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function ec(h,x){var k,U,X,xe,je,Le,M="";for(k=0,X=h.length;k<X;k++){for(U=0,xe=(je=h[k]).length;U<xe;U++)M+=(U?"L":"M")+(Le=je[U]).x+" "+Le.y;M+=x?Nt.svg?"z":"x":""}return M||"M0 0"}var Qo=document.documentElement.style,Jr="ActiveXObject"in window,zc=Jr&&!document.addEventListener,xl="msLaunchUri"in navigator&&!("documentMode"in document),bl=Dn("webkit"),da=Dn("android"),Ha=Dn("android 2")||Dn("android 3"),tc=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Bc=da&&Dn("Google")&&tc<537&&!("AudioNode"in window),Qr=!!window.opera,Rs=!xl&&Dn("chrome"),fa=Dn("gecko")&&!bl&&!Qr&&!Jr,pa=!Rs&&Dn("safari"),Ga=Dn("phantom"),wl="OTransition"in Qo,qa=0===navigator.platform.indexOf("Win"),eo=Jr&&"transition"in Qo,ds="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ha,ma="MozPerspective"in Qo,Za=!window.L_DISABLE_3D&&(eo||ds||ma)&&!wl&&!Ga,ga=typeof orientation<"u"||Dn("mobile"),fe=ga&&bl,Z=ga&&ds,Y=!window.PointerEvent&&window.MSPointerEvent,ue=!(!window.PointerEvent&&!Y),ye="ontouchstart"in window||!!window.TouchEvent,De=!window.L_NO_TOUCH&&(ye||ue),Fe=ga&&Qr,Ne=ga&&fa,Ce=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,We=function(){var h=!1;try{var x=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",Ae,x),window.removeEventListener("testPassiveEventSupport",Ae,x)}catch{}return h}(),Mt=!!document.createElement("canvas").getContext,Ot=!(!document.createElementNS||!ho("svg").createSVGRect),xt=!!Ot&&function(){var h=document.createElement("div");return h.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(h.firstChild&&h.firstChild.namespaceURI)}(),Rn=!Ot&&function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var x=h.firstChild;return x.style.behavior="url(#default#VML)",x&&"object"==typeof x.adj}catch{return!1}}();function Dn(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var Nt={ie:Jr,ielt9:zc,edge:xl,webkit:bl,android:da,android23:Ha,androidStock:Bc,opera:Qr,chrome:Rs,gecko:fa,safari:pa,phantom:Ga,opera12:wl,win:qa,ie3d:eo,webkit3d:ds,gecko3d:ma,any3d:Za,mobile:ga,mobileWebkit:fe,mobileWebkit3d:Z,msPointer:Y,pointer:ue,touch:De,touchNative:ye,mobileOpera:Fe,mobileGecko:Ne,retina:Ce,passiveEvents:We,canvas:Mt,svg:Ot,vml:Rn,inlineSvg:xt,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Ni=Nt.msPointer?"MSPointerDown":"pointerdown",lr=Nt.msPointer?"MSPointerMove":"pointermove",wi=Nt.msPointer?"MSPointerUp":"pointerup",vr=Nt.msPointer?"MSPointerCancel":"pointercancel",zo={touchstart:Ni,touchmove:lr,touchend:wi,touchcancel:vr},Ir={touchstart:function Ls(h,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&vi(x),to(h,x)},touchmove:to,touchend:to,touchcancel:to},wr={},_a=!1;function Pd(h,x,M){return"touchstart"===x&&function ya(){_a||(document.addEventListener(Ni,Xn,!0),document.addEventListener(lr,Du,!0),document.addEventListener(wi,fr,!0),document.addEventListener(vr,fr,!0),_a=!0)}(),Ir[x]?(M=Ir[x].bind(this,M),h.addEventListener(zo[x],M,!1),M):(console.warn("wrong event specified:",x),Ae)}function Xn(h){wr[h.pointerId]=h}function Du(h){wr[h.pointerId]&&(wr[h.pointerId]=h)}function fr(h){delete wr[h.pointerId]}function to(h,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){for(var M in x.touches=[],wr)x.touches.push(wr[M]);x.changedTouches=[x],h(x)}}var Mu=200;var di,tr,Mo,Xa,zs,fo=$i(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Os=$i(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Je="webkitTransition"===Os||"OTransition"===Os?Os+"End":"transitionend";function es(h){return"string"==typeof h?document.getElementById(h):h}function Wi(h,x){var M=h.style[x]||h.currentStyle&&h.currentStyle[x];if((!M||"auto"===M)&&document.defaultView){var k=document.defaultView.getComputedStyle(h,null);M=k?k[x]:null}return"auto"===M?null:M}function Ln(h,x,M){var k=document.createElement(h);return k.className=x||"",M&&M.appendChild(k),k}function Qi(h){var x=h.parentNode;x&&x.removeChild(h)}function Do(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Ns(h){var x=h.parentNode;x&&x.lastChild!==h&&x.appendChild(h)}function Wa(h){var x=h.parentNode;x&&x.firstChild!==h&&x.insertBefore(h,x.firstChild)}function xa(h,x){if(void 0!==h.classList)return h.classList.contains(x);var M=dn(h);return M.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(M)}function et(h,x){if(void 0!==h.classList)for(var M=Ft(x),k=0,U=M.length;k<U;k++)h.classList.add(M[k]);else if(!xa(h,x)){var X=dn(h);fn(h,(X?X+" ":"")+x)}}function gn(h,x){void 0!==h.classList?h.classList.remove(x):fn(h,Zt((" "+dn(h)+" ").replace(" "+x+" "," ")))}function fn(h,x){void 0===h.className.baseVal?h.className=x:h.className.baseVal=x}function dn(h){return h.correspondingElement&&(h=h.correspondingElement),void 0===h.className.baseVal?h.className:h.className.baseVal}function er(h,x){"opacity"in h.style?h.style.opacity=x:"filter"in h.style&&function Gn(h,x){var M=!1,k="DXImageTransform.Microsoft.Alpha";try{M=h.filters.item(k)}catch{if(1===x)return}x=Math.round(100*x),M?(M.Enabled=100!==x,M.Opacity=x):h.style.filter+=" progid:"+k+"(opacity="+x+")"}(h,x)}function $i(h){for(var x=document.documentElement.style,M=0;M<h.length;M++)if(h[M]in x)return h[M];return!1}function ts(h,x,M){var k=x||new bn(0,0);h.style[fo]=(Nt.ie3d?"translate("+k.x+"px,"+k.y+"px)":"translate3d("+k.x+"px,"+k.y+"px,0)")+(M?" scale("+M+")":"")}function Hi(h,x){h._leaflet_pos=x,Nt.any3d?ts(h,x):(h.style.left=x.x+"px",h.style.top=x.y+"px")}function Un(h){return h._leaflet_pos||new bn(0,0)}if("onselectstart"in document)di=function(){nn(window,"selectstart",vi)},tr=function(){ii(window,"selectstart",vi)};else{var Fs=$i(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);di=function(){if(Fs){var h=document.documentElement.style;Mo=h[Fs],h[Fs]="none"}},tr=function(){Fs&&(document.documentElement.style[Fs]=Mo,Mo=void 0)}}function yi(){nn(window,"dragstart",vi)}function Sn(){ii(window,"dragstart",vi)}function El(h){for(;-1===h.tabIndex;)h=h.parentNode;h.style&&(ba(),Xa=h,zs=h.style.outlineStyle,h.style.outlineStyle="none",nn(window,"keydown",ba))}function ba(){Xa&&(Xa.style.outlineStyle=zs,Xa=void 0,zs=void 0,ii(window,"keydown",ba))}function Et(h){do{h=h.parentNode}while(!(h.offsetWidth&&h.offsetHeight||h===document.body));return h}function Ar(h){var x=h.getBoundingClientRect();return{x:x.width/h.offsetWidth||1,y:x.height/h.offsetHeight||1,boundingClientRect:x}}var an={__proto__:null,TRANSFORM:fo,TRANSITION:Os,TRANSITION_END:Je,get:es,getStyle:Wi,create:Ln,remove:Qi,empty:Do,toFront:Ns,toBack:Wa,hasClass:xa,addClass:et,removeClass:gn,setClass:fn,getClass:dn,setOpacity:er,testProp:$i,setTransform:ts,setPosition:Hi,getPosition:Un,get disableTextSelection(){return di},get enableTextSelection(){return tr},disableImageDrag:yi,enableImageDrag:Sn,preventOutline:El,restoreOutline:ba,getSizedParentNode:Et,getScale:Ar};function nn(h,x,M,k){if(x&&"object"==typeof x)for(var U in x)Pr(h,U,x[U],M);else for(var X=0,xe=(x=Ft(x)).length;X<xe;X++)Pr(h,x[X],M,k);return this}var Bo="_leaflet_events";function ii(h,x,M,k){if(1===arguments.length)So(h),delete h[Bo];else if(x&&"object"==typeof x)for(var U in x)nr(h,U,x[U],M);else if(x=Ft(x),2===arguments.length)So(h,function(je){return-1!==_t(x,je)});else for(var X=0,xe=x.length;X<xe;X++)nr(h,x[X],M,k);return this}function So(h,x){for(var M in h[Bo]){var k=M.split(/\d/)[0];(!x||x(k))&&nr(h,k,null,null,M)}}var Cl={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Pr(h,x,M,k){var U=x+Me(M)+(k?"_"+Me(k):"");if(h[Bo]&&h[Bo][U])return this;var X=function(je){return M.call(k||h,je||window.event)},xe=X;!Nt.touchNative&&Nt.pointer&&0===x.indexOf("touch")?X=Pd(h,x,X):Nt.touch&&"dblclick"===x?X=function nc(h,x){h.addEventListener("dblclick",x);var k,M=0;function U(X){if(1===X.detail){if("mouse"!==X.pointerType&&(!X.sourceCapabilities||X.sourceCapabilities.firesTouchEvents)){var xe=Su(X);if(!xe.some(function(Le){return Le instanceof HTMLLabelElement&&Le.attributes.for})||xe.some(function(Le){return Le instanceof HTMLInputElement||Le instanceof HTMLSelectElement})){var je=Date.now();je-M<=Mu?2==++k&&x(function ks(h){var M,k,x={};for(k in h)x[k]=(M=h[k])&&M.bind?M.bind(h):M;return h=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}(X)):k=1,M=je}}}else k=X.detail}return h.addEventListener("click",U),{dblclick:x,simDblclick:U}}(h,X):"addEventListener"in h?"touchstart"===x||"touchmove"===x||"wheel"===x||"mousewheel"===x?h.addEventListener(Cl[x]||x,X,!!Nt.passiveEvents&&{passive:!1}):"mouseenter"===x||"mouseleave"===x?h.addEventListener(Cl[x],X=function(je){je=je||window.event,Iu(h,je)&&xe(je)},!1):h.addEventListener(x,xe,!1):h.attachEvent("on"+x,X),h[Bo]=h[Bo]||{},h[Bo][U]=X}function nr(h,x,M,k,U){U=U||x+Me(M)+(k?"_"+Me(k):"");var X=h[Bo]&&h[Bo][U];if(!X)return this;!Nt.touchNative&&Nt.pointer&&0===x.indexOf("touch")?function Ch(h,x,M){zo[x]?h.removeEventListener(zo[x],M,!1):console.warn("wrong event specified:",x)}(h,x,X):Nt.touch&&"dblclick"===x?function va(h,x){h.removeEventListener("dblclick",x.dblclick),h.removeEventListener("click",x.simDblclick)}(h,X):"removeEventListener"in h?h.removeEventListener(Cl[x]||x,X,!1):h.detachEvent("on"+x,X),h[Bo][U]=null}function ns(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function Vc(h){return Pr(h,"wheel",ns),this}function Hr(h){return nn(h,"mousedown touchstart dblclick contextmenu",ns),h._leaflet_disable_click=!0,this}function vi(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function wa(h){return vi(h),ns(h),this}function Su(h){if(h.composedPath)return h.composedPath();for(var x=[],M=h.target;M;)x.push(M),M=M.parentNode;return x}function Bs(h,x){if(!x)return new bn(h.clientX,h.clientY);var M=Ar(x),k=M.boundingClientRect;return new bn((h.clientX-k.left)/M.x-x.clientLeft,(h.clientY-k.top)/M.y-x.clientTop)}var Ea=Nt.linux&&Nt.chrome?window.devicePixelRatio:Nt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Uc(h){return Nt.edge?h.wheelDeltaY/2:h.deltaY&&0===h.deltaMode?-h.deltaY/Ea:h.deltaY&&1===h.deltaMode?20*-h.deltaY:h.deltaY&&2===h.deltaMode?60*-h.deltaY:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?20*-h.detail:h.detail?h.detail/-32765*60:0}function Iu(h,x){var M=x.relatedTarget;if(!M)return!0;try{for(;M&&M!==h;)M=M.parentNode}catch{return!1}return M!==h}var Th={__proto__:null,on:nn,off:ii,stopPropagation:ns,disableScrollPropagation:Vc,disableClickPropagation:Hr,preventDefault:vi,stop:wa,getPropagationPath:Su,getMousePosition:Bs,getWheelDelta:Uc,isExternalTarget:Iu,addListener:nn,removeListener:ii},Fr=Cn.extend({run:function(h,x,M,k){this.stop(),this._el=h,this._inProgress=!0,this._duration=M||.25,this._easeOutPower=1/Math.max(k||.5,.2),this._startPos=Un(h),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=It(this._animate,this),this._step()},_step:function(h){var x=+new Date-this._startTime,M=1e3*this._duration;x<M?this._runFrame(this._easeOut(x/M),h):(this._runFrame(1),this._complete())},_runFrame:function(h,x){var M=this._startPos.add(this._offset.multiplyBy(h));x&&M._round(),Hi(this._el,M),this.fire("step")},_complete:function(){En(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),Bt=Cn.extend({options:{crs:Ps,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,x){x=Ct(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),void 0!==x.zoom&&(this._zoom=this._limitZoom(x.zoom)),x.center&&void 0!==x.zoom&&this.setView(Tn(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Os&&Nt.any3d&&!Nt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),nn(this._proxy,Je,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,x,M){return x=void 0===x?this._zoom:this._limitZoom(x),h=this._limitCenter(Tn(h),x,this.options.maxBounds),M=M||{},this._stop(),this._loaded&&!M.reset&&!0!==M&&(void 0!==M.animate&&(M.zoom=ze({animate:M.animate},M.zoom),M.pan=ze({animate:M.animate,duration:M.duration},M.pan)),this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,x,M.zoom):this._tryAnimatedPan(h,M.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(h,x,M.pan&&M.pan.noMoveStart),this)},setZoom:function(h,x){return this._loaded?this.setView(this.getCenter(),h,{zoom:x}):(this._zoom=h,this)},zoomIn:function(h,x){return this.setZoom(this._zoom+(h=h||(Nt.any3d?this.options.zoomDelta:1)),x)},zoomOut:function(h,x){return this.setZoom(this._zoom-(h=h||(Nt.any3d?this.options.zoomDelta:1)),x)},setZoomAround:function(h,x,M){var k=this.getZoomScale(x),U=this.getSize().divideBy(2),xe=(h instanceof bn?h:this.latLngToContainerPoint(h)).subtract(U).multiplyBy(1-1/k),je=this.containerPointToLatLng(U.add(xe));return this.setView(je,x,{zoom:M})},_getBoundsCenterZoom:function(h,x){x=x||{},h=h.getBounds?h.getBounds():Ai(h);var M=un(x.paddingTopLeft||x.padding||[0,0]),k=un(x.paddingBottomRight||x.padding||[0,0]),U=this.getBoundsZoom(h,!1,M.add(k));if((U="number"==typeof x.maxZoom?Math.min(x.maxZoom,U):U)===1/0)return{center:h.getCenter(),zoom:U};var X=k.subtract(M).divideBy(2),xe=this.project(h.getSouthWest(),U),je=this.project(h.getNorthEast(),U);return{center:this.unproject(xe.add(je).divideBy(2).add(X),U),zoom:U}},fitBounds:function(h,x){if(!(h=Ai(h)).isValid())throw new Error("Bounds are not valid.");var M=this._getBoundsCenterZoom(h,x);return this.setView(M.center,M.zoom,x)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,x){return this.setView(h,this._zoom,{pan:x})},panBy:function(h,x){if(x=x||{},!(h=un(h).round()).x&&!h.y)return this.fire("moveend");if(!0!==x.animate&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Fr,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),!1!==x.animate){et(this._mapPane,"leaflet-pan-anim");var M=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,M,x.duration||.25,x.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,x,M){if(!1===(M=M||{}).animate||!Nt.any3d)return this.setView(h,x,M);this._stop();var k=this.project(this.getCenter()),U=this.project(h),X=this.getSize(),xe=this._zoom;h=Tn(h),x=void 0===x?xe:x;var je=Math.max(X.x,X.y),Le=je*this.getZoomScale(xe,x),bt=U.distanceTo(k)||1,tn=1.42,yn=tn*tn;function _n(or){var al=(Le*Le-je*je+(or?-1:1)*yn*yn*bt*bt)/(2*(or?Le:je)*yn*bt),kr=Math.sqrt(al*al+1)-al;return kr<1e-9?-18:Math.log(kr)}function Lr(or){return(Math.exp(or)-Math.exp(-or))/2}function rr(or){return(Math.exp(or)+Math.exp(-or))/2}var Er=_n(0);function ys(or){return je*(rr(Er)*function qi(or){return Lr(or)/rr(or)}(Er+tn*or)-Lr(Er))/yn}var Xs=Date.now(),vs=(_n(1)-Er)/tn,ti=M.duration?1e3*M.duration:1e3*vs*.8;return this._moveStart(!0,M.noMoveStart),function Ph(){var or=(Date.now()-Xs)/ti,Nl=function Go(or){return 1-Math.pow(1-or,1.5)}(or)*vs;or<=1?(this._flyToFrame=It(Ph,this),this._move(this.unproject(k.add(U.subtract(k).multiplyBy(ys(Nl)/bt)),xe),this.getScaleZoom(je/function Ws(or){return je*(rr(Er)/rr(Er+tn*or))}(Nl),xe),{flyTo:!0})):this._move(h,x)._moveEnd(!0)}.call(this),this},flyToBounds:function(h,x){var M=this._getBoundsCenterZoom(h,x);return this.flyTo(M.center,M.zoom,x)},setMaxBounds:function(h){return h=Ai(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var x=this.options.minZoom;return this.options.minZoom=h,this._loaded&&x!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var x=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&x!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,x){this._enforcingBounds=!0;var M=this.getCenter(),k=this._limitCenter(M,this._zoom,Ai(h));return M.equals(k)||this.panTo(k,x),this._enforcingBounds=!1,this},panInside:function(h,x){var M=un((x=x||{}).paddingTopLeft||x.padding||[0,0]),k=un(x.paddingBottomRight||x.padding||[0,0]),U=this.project(this.getCenter()),X=this.project(h),xe=this.getPixelBounds(),je=ni([xe.min.add(M),xe.max.subtract(k)]),Le=je.getSize();if(!je.contains(X)){this._enforcingBounds=!0;var bt=X.subtract(je.getCenter()),tn=je.extend(X).getSize().subtract(Le);U.x+=bt.x<0?-tn.x:tn.x,U.y+=bt.y<0?-tn.y:tn.y,this.panTo(this.unproject(U),x),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=ze({animate:!1,pan:!0},!0===h?{animate:!0}:h);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var M=this.getSize(),k=x.divideBy(2).round(),U=M.divideBy(2).round(),X=k.subtract(U);return X.x||X.y?(h.animate&&h.pan?this.panBy(X):(h.pan&&this._rawPanBy(X),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:M})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=ze({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=u(this._handleGeolocationResponse,this),M=u(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,M,h):navigator.geolocation.getCurrentPosition(x,M,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var x=h.code,M=h.message||(1===x?"permission denied":2===x?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+M+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var k=new ri(h.coords.latitude,h.coords.longitude),U=k.toBounds(2*h.coords.accuracy),X=this._locateOptions;if(X.setView){var xe=this.getBoundsZoom(U);this.setView(k,X.maxZoom?Math.min(xe,X.maxZoom):xe)}var je={latlng:k,bounds:U,timestamp:h.timestamp};for(var Le in h.coords)"number"==typeof h.coords[Le]&&(je[Le]=h.coords[Le]);this.fire("locationfound",je)}},addHandler:function(h,x){if(!x)return this;var M=this[h]=new x(this);return this._handlers.push(M),this.options[h]&&M.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}var h;for(h in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),Qi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(En(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[h].remove();for(h in this._panes)Qi(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,x){var k=Ln("div","leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),x||this._mapPane);return h&&(this._panes[h]=k),k},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds();return new ji(this.unproject(h.getBottomLeft()),this.unproject(h.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,x,M){h=Ai(h),M=un(M||[0,0]);var k=this.getZoom()||0,U=this.getMinZoom(),X=this.getMaxZoom(),xe=h.getNorthWest(),je=h.getSouthEast(),Le=this.getSize().subtract(M),bt=ni(this.project(je,k),this.project(xe,k)).getSize(),tn=Nt.any3d?this.options.zoomSnap:1,yn=Le.x/bt.x,_n=Le.y/bt.y,Lr=x?Math.max(yn,_n):Math.min(yn,_n);return k=this.getScaleZoom(Lr,k),tn&&(k=Math.round(k/(tn/100))*(tn/100),k=x?Math.ceil(k/tn)*tn:Math.floor(k/tn)*tn),Math.max(U,Math.min(X,k))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new bn(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,x){var M=this._getTopLeftPoint(h,x);return new Mn(M,M.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(void 0===h?this.getZoom():h)},getPane:function(h){return"string"==typeof h?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,x){var M=this.options.crs;return x=void 0===x?this._zoom:x,M.scale(h)/M.scale(x)},getScaleZoom:function(h,x){var M=this.options.crs,k=M.zoom(h*M.scale(x=void 0===x?this._zoom:x));return isNaN(k)?1/0:k},project:function(h,x){return x=void 0===x?this._zoom:x,this.options.crs.latLngToPoint(Tn(h),x)},unproject:function(h,x){return x=void 0===x?this._zoom:x,this.options.crs.pointToLatLng(un(h),x)},layerPointToLatLng:function(h){var x=un(h).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(h){return this.project(Tn(h))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(Tn(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(Ai(h))},distance:function(h,x){return this.options.crs.distance(Tn(h),Tn(x))},containerPointToLayerPoint:function(h){return un(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return un(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var x=this.containerPointToLayerPoint(un(h));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Tn(h)))},mouseEventToContainerPoint:function(h){return Bs(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var x=this._container=es(h);if(!x)throw new Error("Map container not found.");if(x._leaflet_id)throw new Error("Map container is already initialized.");nn(x,"scroll",this._onScroll,this),this._containerId=Me(x)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&Nt.any3d,et(h,"leaflet-container"+(Nt.touch?" leaflet-touch":"")+(Nt.retina?" leaflet-retina":"")+(Nt.ielt9?" leaflet-oldie":"")+(Nt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=Wi(h,"position");"absolute"!==x&&"relative"!==x&&"fixed"!==x&&"sticky"!==x&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Hi(this._mapPane,new bn(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(et(h.markerPane,"leaflet-zoom-hide"),et(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,x,M){Hi(this._mapPane,new bn(0,0));var k=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var U=this._zoom!==x;this._moveStart(U,M)._move(h,x)._moveEnd(U),this.fire("viewreset"),k&&this.fire("load")},_moveStart:function(h,x){return h&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(h,x,M,k){void 0===x&&(x=this._zoom);var U=this._zoom!==x;return this._zoom=x,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),k?M&&M.pinch&&this.fire("zoom",M):((U||M&&M.pinch)&&this.fire("zoom",M),this.fire("move",M)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return En(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){Hi(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[Me(this._container)]=this;var x=h?ii:nn;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),Nt.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){En(this._resizeRequest),this._resizeRequest=It(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,x){for(var k,M=[],U="mouseout"===x||"mouseover"===x,X=h.target||h.srcElement,xe=!1;X;){if((k=this._targets[Me(X)])&&("click"===x||"preclick"===x)&&this._draggableMoved(k)){xe=!0;break}if(k&&k.listens(x,!0)&&(U&&!Iu(X,h)||(M.push(k),U))||X===this._container)break;X=X.parentNode}return!M.length&&!xe&&!U&&this.listens(x,!0)&&(M=[this]),M},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var x=h.target||h.srcElement;if(!(!this._loaded||x._leaflet_disable_events||"click"===h.type&&this._isClickDisabled(x))){var M=h.type;"mousedown"===M&&El(x),this._fireDOMEvent(h,M)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,x,M){if("click"===h.type){var k=ze({},h);k.type="preclick",this._fireDOMEvent(k,k.type,M)}var U=this._findEventTargets(h,x);if(M){for(var X=[],xe=0;xe<M.length;xe++)M[xe].listens(x,!0)&&X.push(M[xe]);U=X.concat(U)}if(U.length){"contextmenu"===x&&vi(h);var je=U[0],Le={originalEvent:h};if("keypress"!==h.type&&"keydown"!==h.type&&"keyup"!==h.type){var bt=je.getLatLng&&(!je._radius||je._radius<=10);Le.containerPoint=bt?this.latLngToContainerPoint(je.getLatLng()):this.mouseEventToContainerPoint(h),Le.layerPoint=this.containerPointToLayerPoint(Le.containerPoint),Le.latlng=bt?je.getLatLng():this.layerPointToLatLng(Le.layerPoint)}for(xe=0;xe<U.length;xe++)if(U[xe].fire(x,Le,!0),Le.originalEvent._stopped||!1===U[xe].options.bubblingMouseEvents&&-1!==_t(this._mouseEvents,x))return}},_draggableMoved:function(h){return(h=h.dragging&&h.dragging.enabled()?h:this).dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,x=this._handlers.length;h<x;h++)this._handlers[h].disable()},whenReady:function(h,x){return this._loaded?h.call(x||this,{target:this}):this.on("load",h,x),this},_getMapPanePos:function(){return Un(this._mapPane)||new bn(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,x){return(h&&void 0!==x?this._getNewPixelOrigin(h,x):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,x){var M=this.getSize()._divideBy(2);return this.project(h,x)._subtract(M)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,x,M){var k=this._getNewPixelOrigin(M,x);return this.project(h,x)._subtract(k)},_latLngBoundsToNewLayerBounds:function(h,x,M){var k=this._getNewPixelOrigin(M,x);return ni([this.project(h.getSouthWest(),x)._subtract(k),this.project(h.getNorthWest(),x)._subtract(k),this.project(h.getSouthEast(),x)._subtract(k),this.project(h.getNorthEast(),x)._subtract(k)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,x,M){if(!M)return h;var k=this.project(h,x),U=this.getSize().divideBy(2),X=new Mn(k.subtract(U),k.add(U)),xe=this._getBoundsOffset(X,M,x);return Math.abs(xe.x)<=1&&Math.abs(xe.y)<=1?h:this.unproject(k.add(xe),x)},_limitOffset:function(h,x){if(!x)return h;var M=this.getPixelBounds(),k=new Mn(M.min.add(h),M.max.add(h));return h.add(this._getBoundsOffset(k,x))},_getBoundsOffset:function(h,x,M){var k=ni(this.project(x.getNorthEast(),M),this.project(x.getSouthWest(),M)),U=k.min.subtract(h.min),X=k.max.subtract(h.max);return new bn(this._rebound(U.x,-X.x),this._rebound(U.y,-X.y))},_rebound:function(h,x){return h+x>0?Math.round(h-x)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(x))},_limitZoom:function(h){var x=this.getMinZoom(),M=this.getMaxZoom(),k=Nt.any3d?this.options.zoomSnap:1;return k&&(h=Math.round(h/k)*k),Math.max(x,Math.min(M,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){gn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,x){var M=this._getCenterOffset(h)._trunc();return!(!0!==(x&&x.animate)&&!this.getSize().contains(M)||(this.panBy(M,x),0))},_createAnimProxy:function(){var h=this._proxy=Ln("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(x){var M=fo,k=this._proxy.style[M];ts(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),k===this._proxy.style[M]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Qi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),x=this.getZoom();ts(this._proxy,this.project(h,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,x,M){if(this._animatingZoom)return!0;if(M=M||{},!this._zoomAnimated||!1===M.animate||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var k=this.getZoomScale(x),U=this._getCenterOffset(h)._divideBy(1-1/k);return!(!0!==M.animate&&!this.getSize().contains(U)||(It(function(){this._moveStart(!0,M.noMoveStart||!1)._animateZoom(h,x,!0)},this),0))},_animateZoom:function(h,x,M,k){this._mapPane&&(M&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=x,et(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:x,noUpdate:k}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&gn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var no=Ui.extend({options:{position:"topright"},initialize:function(h){Ct(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var x=this._map;return x&&x.removeControl(this),this.options.position=h,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var x=this._container=this.onAdd(h),M=this.getPosition(),k=h._controlCorners[M];return et(x,"leaflet-control"),-1!==M.indexOf("bottom")?k.insertBefore(x,k.firstChild):k.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Qi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),Vo=function(h){return new no(h)};Bt.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},x="leaflet-",M=this._controlContainer=Ln("div",x+"control-container",this._container);function k(U,X){h[U+X]=Ln("div",x+U+" "+x+X,M)}k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)Qi(this._controlCorners[h]);Qi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var on=no.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,x,M,k){return M<k?-1:k<M?1:0}},initialize:function(h,x,M){for(var k in Ct(this,M),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,h)this._addLayer(h[k],k);for(k in x)this._addLayer(x[k],k,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return no.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,x){return this._addLayer(h,x),this._map?this._update():this},addOverlay:function(h,x){return this._addLayer(h,x,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var x=this._getLayer(Me(h));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){et(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(et(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):gn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return gn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",x=this._container=Ln("div",h),M=this.options.collapsed;x.setAttribute("aria-haspopup",!0),Hr(x),Vc(x);var k=this._section=Ln("section",h+"-list");M&&(this._map.on("click",this.collapse,this),nn(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var U=this._layersLink=Ln("a",h+"-toggle",x);U.href="#",U.title="Layers",U.setAttribute("role","button"),nn(U,{keydown:function(X){13===X.keyCode&&this._expandSafely()},click:function(X){vi(X),this._expandSafely()}},this),M||this.expand(),this._baseLayersList=Ln("div",h+"-base",k),this._separator=Ln("div",h+"-separator",k),this._overlaysList=Ln("div",h+"-overlays",k),x.appendChild(k)},_getLayer:function(h){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&Me(this._layers[x].layer)===h)return this._layers[x]},_addLayer:function(h,x,M){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:x,overlay:M}),this.options.sortLayers&&this._layers.sort(u(function(k,U){return this.options.sortFunction(k.layer,U.layer,k.name,U.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Do(this._baseLayersList),Do(this._overlaysList),this._layerControlInputs=[];var h,x,M,k,U=0;for(M=0;M<this._layers.length;M++)this._addItem(k=this._layers[M]),x=x||k.overlay,h=h||!k.overlay,U+=k.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(h=h&&U>1)?"":"none"),this._separator.style.display=x&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var x=this._getLayer(Me(h.target)),M=x.overlay?"add"===h.type?"overlayadd":"overlayremove":"add"===h.type?"baselayerchange":null;M&&this._map.fire(M,x)},_createRadioElement:function(h,x){var M='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(x?' checked="checked"':"")+"/>",k=document.createElement("div");return k.innerHTML=M,k.firstChild},_addItem:function(h){var k,x=document.createElement("label"),M=this._map.hasLayer(h.layer);h.overlay?((k=document.createElement("input")).type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=M):k=this._createRadioElement("leaflet-base-layers_"+Me(this),M),this._layerControlInputs.push(k),k.layerId=Me(h.layer),nn(k,"click",this._onInputClick,this);var U=document.createElement("span");U.innerHTML=" "+h.name;var X=document.createElement("span");return x.appendChild(X),X.appendChild(k),X.appendChild(U),(h.overlay?this._overlaysList:this._baseLayersList).appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var x,M,h=this._layerControlInputs,k=[],U=[];this._handlingClick=!0;for(var X=h.length-1;X>=0;X--)M=this._getLayer((x=h[X]).layerId).layer,x.checked?k.push(M):x.checked||U.push(M);for(X=0;X<U.length;X++)this._map.hasLayer(U[X])&&this._map.removeLayer(U[X]);for(X=0;X<k.length;X++)this._map.hasLayer(k[X])||this._map.addLayer(k[X]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var x,M,h=this._layerControlInputs,k=this._map.getZoom(),U=h.length-1;U>=0;U--)M=this._getLayer((x=h[U]).layerId).layer,x.disabled=void 0!==M.options.minZoom&&k<M.options.minZoom||void 0!==M.options.maxZoom&&k>M.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,nn(h,"click",vi),this.expand();var x=this;setTimeout(function(){ii(h,"click",vi),x._preventClick=!1})}}),Rr=no.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var x="leaflet-control-zoom",M=Ln("div",x+" leaflet-bar"),k=this.options;return this._zoomInButton=this._createButton(k.zoomInText,k.zoomInTitle,x+"-in",M,this._zoomIn),this._zoomOutButton=this._createButton(k.zoomOutText,k.zoomOutTitle,x+"-out",M,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),M},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,x,M,k,U){var X=Ln("a",M,k);return X.innerHTML=h,X.href="#",X.title=x,X.setAttribute("role","button"),X.setAttribute("aria-label",x),Hr(X),nn(X,"click",wa),nn(X,"click",U,this),nn(X,"click",this._refocusOnMap,this),X},_updateDisabled:function(){var h=this._map,x="leaflet-disabled";gn(this._zoomInButton,x),gn(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(et(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(et(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});Bt.mergeOptions({zoomControl:!0}),Bt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Rr,this.addControl(this.zoomControl))});var Tl=no.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var x="leaflet-control-scale",M=Ln("div",x),k=this.options;return this._addScales(k,x+"-line",M),h.on(k.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),M},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,x,M){h.metric&&(this._mScale=Ln("div",x,M)),h.imperial&&(this._iScale=Ln("div",x,M))},_update:function(){var h=this._map,x=h.getSize().y/2,M=h.distance(h.containerPointToLatLng([0,x]),h.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(M)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var x=this._getRoundNum(h);this._updateScale(this._mScale,x<1e3?x+" m":x/1e3+" km",x/h)},_updateImperial:function(h){var M,k,U,x=3.2808399*h;x>5280?(k=this._getRoundNum(M=x/5280),this._updateScale(this._iScale,k+" mi",k/M)):(U=this._getRoundNum(x),this._updateScale(this._iScale,U+" ft",U/x))},_updateScale:function(h,x,M){h.style.width=Math.round(this.options.maxWidth*M)+"px",h.innerHTML=x},_getRoundNum:function(h){var x=Math.pow(10,(Math.floor(h)+"").length-1),M=h/x;return x*(M>=10?10:M>=5?5:M>=3?3:M>=2?2:1)}}),Ta=no.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Nt.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(h){Ct(this,h),this._attributions={}},onAdd:function(h){for(var x in h.attributionControl=this,this._container=Ln("div","leaflet-control-attribution"),Hr(this._container),h._layers)h._layers[x].getAttribution&&this.addAttribution(h._layers[x].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var x in this._attributions)this._attributions[x]&&h.push(x);var M=[];this.options.prefix&&M.push(this.options.prefix),h.length&&M.push(h.join(", ")),this._container.innerHTML=M.join(' <span aria-hidden="true">|</span> ')}}});Bt.mergeOptions({attributionControl:!0}),Bt.addInitHook(function(){this.options.attributionControl&&(new Ta).addTo(this)});no.Layers=on,no.Zoom=Rr,no.Scale=Tl,no.Attribution=Ta,Vo.layers=function(h,x,M){return new on(h,x,M)},Vo.zoom=function(h){return new Rr(h)},Vo.scale=function(h){return new Tl(h)},Vo.attribution=function(h){return new Ta(h)};var Gr=Ui.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Gr.addTo=function(h,x){return h.addHandler(x,this),this};var ci={Events:yr},Mh=Nt.touch?"touchstart mousedown":"mousedown",jn=Cn.extend({options:{clickTolerance:3},initialize:function(h,x,M,k){Ct(this,k),this._element=h,this._dragStartTarget=x||h,this._preventOutline=M},enable:function(){this._enabled||(nn(this._dragStartTarget,Mh,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(jn._dragging===this&&this.finishDrag(!0),ii(this._dragStartTarget,Mh,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!xa(this._element,"leaflet-zoom-anim"))){if(h.touches&&1!==h.touches.length)return void(jn._dragging===this&&this.finishDrag());if(!(jn._dragging||h.shiftKey||1!==h.which&&1!==h.button&&!h.touches||(jn._dragging=this,this._preventOutline&&El(this._element),yi(),di(),this._moving))){this.fire("down");var x=h.touches?h.touches[0]:h,M=Et(this._element);this._startPoint=new bn(x.clientX,x.clientY),this._startPos=Un(this._element),this._parentScale=Ar(M);var k="mousedown"===h.type;nn(document,k?"mousemove":"touchmove",this._onMove,this),nn(document,k?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1)return void(this._moved=!0);var x=h.touches&&1===h.touches.length?h.touches[0]:h,M=new bn(x.clientX,x.clientY)._subtract(this._startPoint);!M.x&&!M.y||Math.abs(M.x)+Math.abs(M.y)<this.options.clickTolerance||(M.x/=this._parentScale.x,M.y/=this._parentScale.y,vi(h),this._moved||(this.fire("dragstart"),this._moved=!0,et(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),et(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(M),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),Hi(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){gn(document.body,"leaflet-dragging"),this._lastTarget&&(gn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ii(document,"mousemove touchmove",this._onMove,this),ii(document,"mouseup touchend touchcancel",this._onUp,this),Sn(),tr();var x=this._moved&&this._moving;this._moving=!1,jn._dragging=!1,x&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function ic(h,x,M){var k,X,xe,je,Le,bt,tn,yn,_n,U=[1,4,2,8];for(X=0,tn=h.length;X<tn;X++)h[X]._code=Us(h[X],x);for(je=0;je<4;je++){for(yn=U[je],k=[],X=0,xe=(tn=h.length)-1;X<tn;xe=X++)bt=h[xe],(Le=h[X])._code&yn?bt._code&yn||((_n=Ma(bt,Le,yn,x,M))._code=Us(_n,x),k.push(_n)):(bt._code&yn&&((_n=Ma(bt,Le,yn,x,M))._code=Us(_n,x),k.push(_n)),k.push(Le));h=k}return h}function rc(h,x){var M,k,U,X,xe,je,Le,bt;if(!h||0===h.length)throw new Error("latlngs not passed");Io(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var yn=Tn([0,0]),_n=Ai(h);_n.getNorthWest().distanceTo(_n.getSouthWest())*_n.getNorthEast().distanceTo(_n.getNorthWest())<1700&&(yn=qr(h));var rr=h.length,qi=[];for(M=0;M<rr;M++){var Er=Tn(h[M]);qi.push(x.project(Tn([Er.lat-yn.lat,Er.lng-yn.lng])))}for(je=Le=bt=0,M=0,k=rr-1;M<rr;k=M++)Le+=((U=qi[M]).x+(X=qi[k]).x)*(xe=U.y*X.x-X.y*U.x),bt+=(U.y+X.y)*xe,je+=3*xe;var Ws=x.unproject(un(0===je?qi[0]:[Le/je,bt/je]));return Tn([Ws.lat+yn.lat,Ws.lng+yn.lng])}function qr(h){for(var x=0,M=0,k=0,U=0;U<h.length;U++){var X=Tn(h[U]);x+=X.lat,M+=X.lng,k++}return Tn([x/k,M/k])}var sc,$c={__proto__:null,clipPolygon:ic,polygonCenter:rc,centroid:qr};function Ml(h,x){if(!x||!h.length)return h.slice();var M=x*x;return function Da(h,x){var M=h.length,U=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(M);U[0]=U[M-1]=1,qt(h,U,x,0,M-1);var X,xe=[];for(X=0;X<M;X++)U[X]&&xe.push(h[X]);return xe}(h=function Sl(h,x){for(var M=[h[0]],k=1,U=0,X=h.length;k<X;k++)Il(h[k],h[U])>x&&(M.push(h[k]),U=k);return U<X-1&&M.push(h[X-1]),M}(h,M),M)}function bi(h,x,M){return Math.sqrt(Ka(h,x,M,!0))}function qt(h,x,M,k,U){var xe,je,Le,X=0;for(je=k+1;je<=U-1;je++)(Le=Ka(h[je],h[k],h[U],!0))>X&&(xe=je,X=Le);X>M&&(x[xe]=1,qt(h,x,M,k,xe),qt(h,x,M,xe,U))}function Ya(h,x,M,k,U){var je,Le,bt,X=k?sc:Us(h,M),xe=Us(x,M);for(sc=xe;;){if(!(X|xe))return[h,x];if(X&xe)return!1;bt=Us(Le=Ma(h,x,je=X||xe,M,U),M),je===X?(h=Le,X=bt):(x=Le,xe=bt)}}function Ma(h,x,M,k,U){var bt,tn,X=x.x-h.x,xe=x.y-h.y,je=k.min,Le=k.max;return 8&M?(bt=h.x+X*(Le.y-h.y)/xe,tn=Le.y):4&M?(bt=h.x+X*(je.y-h.y)/xe,tn=je.y):2&M?(bt=Le.x,tn=h.y+xe*(Le.x-h.x)/X):1&M&&(bt=je.x,tn=h.y+xe*(je.x-h.x)/X),new bn(bt,tn,U)}function Us(h,x){var M=0;return h.x<x.min.x?M|=1:h.x>x.max.x&&(M|=2),h.y<x.min.y?M|=4:h.y>x.max.y&&(M|=8),M}function Il(h,x){var M=x.x-h.x,k=x.y-h.y;return M*M+k*k}function Ka(h,x,M,k){var bt,U=x.x,X=x.y,xe=M.x-U,je=M.y-X,Le=xe*xe+je*je;return Le>0&&((bt=((h.x-U)*xe+(h.y-X)*je)/Le)>1?(U=M.x,X=M.y):bt>0&&(U+=xe*bt,X+=je*bt)),xe=h.x-U,je=h.y-X,k?xe*xe+je*je:new bn(U,X)}function Io(h){return!Ye(h[0])||"object"!=typeof h[0][0]&&typeof h[0][0]<"u"}function oi(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Io(h)}function ac(h,x){var M,k,U,X,xe,je,Le,bt;if(!h||0===h.length)throw new Error("latlngs not passed");Io(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var tn=Tn([0,0]),yn=Ai(h);yn.getNorthWest().distanceTo(yn.getSouthWest())*yn.getNorthEast().distanceTo(yn.getNorthWest())<1700&&(tn=qr(h));var Lr=h.length,rr=[];for(M=0;M<Lr;M++){var qi=Tn(h[M]);rr.push(x.project(Tn([qi.lat-tn.lat,qi.lng-tn.lng])))}for(M=0,k=0;M<Lr-1;M++)k+=rr[M].distanceTo(rr[M+1])/2;if(0===k)bt=rr[0];else for(M=0,X=0;M<Lr-1;M++)if((X+=U=(xe=rr[M]).distanceTo(je=rr[M+1]))>k){bt=[je.x-(Le=(X-k)/U)*(je.x-xe.x),je.y-Le*(je.y-xe.y)];break}var Er=x.unproject(un(bt));return Tn([Er.lat+tn.lat,Er.lng+tn.lng])}var Rd={__proto__:null,simplify:Ml,pointToSegmentDistance:bi,closestPointOnSegment:function oc(h,x,M){return Ka(h,x,M)},clipSegment:Ya,_getEdgeIntersection:Ma,_getBitCode:Us,_sqClosestPointOnSegment:Ka,isFlat:Io,_flat:oi,polylineCenter:ac},js={project:function(h){return new bn(h.lng,h.lat)},unproject:function(h){return new ri(h.y,h.x)},bounds:new Mn([-180,-90],[180,90])},Al={R:6378137,R_MINOR:6356752.314245179,bounds:new Mn([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(h){var x=Math.PI/180,M=this.R,k=h.lat*x,U=this.R_MINOR/M,X=Math.sqrt(1-U*U),xe=X*Math.sin(k),je=Math.tan(Math.PI/4-k/2)/Math.pow((1-xe)/(1+xe),X/2);return k=-M*Math.log(Math.max(je,1e-10)),new bn(h.lng*x*M,k)},unproject:function(h){for(var bt,x=180/Math.PI,M=this.R,k=this.R_MINOR/M,U=Math.sqrt(1-k*k),X=Math.exp(-h.y/M),xe=Math.PI/2-2*Math.atan(X),je=0,Le=.1;je<15&&Math.abs(Le)>1e-7;je++)bt=U*Math.sin(xe),bt=Math.pow((1-bt)/(1+bt),U/2),xe+=Le=Math.PI/2-2*Math.atan(X*bt)-xe;return new ri(xe*x,h.x*x/M)}},fs={__proto__:null,LonLat:js,Mercator:Al,SphericalMercator:sn},Pu=ze({},li,{code:"EPSG:3395",projection:Al,transformation:function(){var h=.5/(Math.PI*Al.R);return Nn(h,.5,-h,.5)}()}),Sh=ze({},li,{code:"EPSG:4326",projection:js,transformation:Nn(1/180,1,-1/180,.5)}),Ld=ze({},$r,{projection:js,transformation:Nn(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,x){var M=x.lng-h.lng,k=x.lat-h.lat;return Math.sqrt(M*M+k*k)},infinite:!0});$r.Earth=li,$r.EPSG3395=Pu,$r.EPSG3857=Ps,$r.EPSG900913=Zi,$r.EPSG4326=Sh,$r.Simple=Ld;var Uo=Cn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[Me(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[Me(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var x=h.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var M=this.getEvents();x.on(M,this),this.once("remove",function(){x.off(M,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});Bt.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var x=Me(h);return this._layers[x]||(this._layers[x]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h)),this},removeLayer:function(h){var x=Me(h);return this._layers[x]?(this._loaded&&h.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return Me(h)in this._layers},eachLayer:function(h,x){for(var M in this._layers)h.call(x,this._layers[M]);return this},_addLayers:function(h){for(var x=0,M=(h=h?Ye(h)?h:[h]:[]).length;x<M;x++)this.addLayer(h[x])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[Me(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var x=Me(h);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,x=-1/0,M=this._getZoomSpan();for(var k in this._zoomBoundLayers){var U=this._zoomBoundLayers[k].options;h=void 0===U.minZoom?h:Math.min(h,U.minZoom),x=void 0===U.maxZoom?x:Math.max(x,U.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=h===1/0?void 0:h,M!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ao=Uo.extend({initialize:function(h,x){var M,k;if(Ct(this,x),this._layers={},h)for(M=0,k=h.length;M<k;M++)this.addLayer(h[M])},addLayer:function(h){var x=this.getLayerId(h);return this._layers[x]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var x=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(h){return("number"==typeof h?h:this.getLayerId(h))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var M,k,x=Array.prototype.slice.call(arguments,1);for(M in this._layers)(k=this._layers[M])[h]&&k[h].apply(k,x);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,x){for(var M in this._layers)h.call(x,this._layers[M]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return Me(h)}}),zr=Ao.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),Ao.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),Ao.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new ji;for(var x in this._layers){var M=this._layers[x];h.extend(M.getBounds?M.getBounds():M.getLatLng())}return h}}),rn=Ui.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){Ct(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,x){var M=this._getIconUrl(h);if(!M){if("icon"===h)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var k=this._createImg(M,x&&"IMG"===x.tagName?x:null);return this._setIconStyles(k,h),(this.options.crossOrigin||""===this.options.crossOrigin)&&(k.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),k},_setIconStyles:function(h,x){var M=this.options,k=M[x+"Size"];"number"==typeof k&&(k=[k,k]);var U=un(k),X=un("shadow"===x&&M.shadowAnchor||M.iconAnchor||U&&U.divideBy(2,!0));h.className="leaflet-marker-"+x+" "+(M.className||""),X&&(h.style.marginLeft=-X.x+"px",h.style.marginTop=-X.y+"px"),U&&(h.style.width=U.x+"px",h.style.height=U.y+"px")},_createImg:function(h,x){return(x=x||document.createElement("img")).src=h,x},_getIconUrl:function(h){return Nt.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});var Qt=rn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return"string"!=typeof Qt.imagePath&&(Qt.imagePath=this._detectIconPath()),(this.options.imagePath||Qt.imagePath)+rn.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var x=function(M,k,U){var X=k.exec(M);return X&&X[U]};return(h=x(h,/^url\((['"])?(.+)\1\)$/,2))&&x(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=Ln("div","leaflet-default-icon-path",document.body),x=Wi(h,"background-image")||Wi(h,"backgroundImage");if(document.body.removeChild(h),x=this._stripUrl(x))return x;var M=document.querySelector('link[href$="leaflet.css"]');return M?M.href.substring(0,M.href.length-11-1):""}}),$s=Gr.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new jn(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),et(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&gn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var x=this._marker,M=x._map,k=this._marker.options.autoPanSpeed,U=this._marker.options.autoPanPadding,X=Un(x._icon),xe=M.getPixelBounds(),je=M.getPixelOrigin(),Le=ni(xe.min._subtract(je).add(U),xe.max._subtract(je).subtract(U));if(!Le.contains(X)){var bt=un((Math.max(Le.max.x,X.x)-Le.max.x)/(xe.max.x-Le.max.x)-(Math.min(Le.min.x,X.x)-Le.min.x)/(xe.min.x-Le.min.x),(Math.max(Le.max.y,X.y)-Le.max.y)/(xe.max.y-Le.max.y)-(Math.min(Le.min.y,X.y)-Le.min.y)/(xe.min.y-Le.min.y)).multiplyBy(k);M.panBy(bt,{animate:!1}),this._draggable._newPos._add(bt),this._draggable._startPos._add(bt),Hi(x._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=It(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(En(this._panRequest),this._panRequest=It(this._adjustPan.bind(this,h)))},_onDrag:function(h){var x=this._marker,M=x._shadow,k=Un(x._icon),U=x._map.layerPointToLatLng(k);M&&Hi(M,k),x._latlng=U,h.latlng=U,h.oldLatLng=this._oldLatLng,x.fire("move",h).fire("drag",h)},_onDragEnd:function(h){En(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),is=Uo.extend({options:{icon:new Qt,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,x){Ct(this,x),this._latlng=Tn(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var x=this._latlng;return this._latlng=Tn(h),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),M=h.icon.createIcon(this._icon),k=!1;M!==this._icon&&(this._icon&&this._removeIcon(),k=!0,h.title&&(M.title=h.title),"IMG"===M.tagName&&(M.alt=h.alt||"")),et(M,x),h.keyboard&&(M.tabIndex="0",M.setAttribute("role","button")),this._icon=M,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&nn(M,"focus",this._panOnFocus,this);var U=h.icon.createShadow(this._shadow),X=!1;U!==this._shadow&&(this._removeShadow(),X=!0),U&&(et(U,x),U.alt=""),this._shadow=U,h.opacity<1&&this._updateOpacity(),k&&this.getPane().appendChild(this._icon),this._initInteraction(),U&&X&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ii(this._icon,"focus",this._panOnFocus,this),Qi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Qi(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&Hi(this._icon,h),this._shadow&&Hi(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(et(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),$s)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new $s(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&er(this._icon,h),this._shadow&&er(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var x=this.options.icon.options,M=x.iconSize?un(x.iconSize):un(0,0),k=x.iconAnchor?un(x.iconAnchor):un(0,0);h.panInside(this._latlng,{paddingTopLeft:k,paddingBottomRight:M.subtract(k)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var jo=Uo.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return Ct(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Pl=jo.extend({options:{fill:!0,radius:10},initialize:function(h,x){Ct(this,x),this._latlng=Tn(h),this._radius=this.options.radius},setLatLng:function(h){var x=this._latlng;return this._latlng=Tn(h),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var x=h&&h.radius||this._radius;return jo.prototype.setStyle.call(this,h),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,x=this._radiusY||h,M=this._clickTolerance(),k=[h+M,x+M];this._pxBounds=new Mn(this._point.subtract(k),this._point.add(k))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var xo=Pl.extend({initialize:function(h,x,M){if("number"==typeof x&&(x=ze({},M,{radius:x})),Ct(this,x),this._latlng=Tn(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new ji(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:jo.prototype.setStyle,_project:function(){var h=this._latlng.lng,x=this._latlng.lat,M=this._map,k=M.options.crs;if(k.distance===li.distance){var U=Math.PI/180,X=this._mRadius/li.R/U,xe=M.project([x+X,h]),je=M.project([x-X,h]),Le=xe.add(je).divideBy(2),bt=M.unproject(Le).lat,tn=Math.acos((Math.cos(X*U)-Math.sin(x*U)*Math.sin(bt*U))/(Math.cos(x*U)*Math.cos(bt*U)))/U;(isNaN(tn)||0===tn)&&(tn=X/Math.cos(Math.PI/180*x)),this._point=Le.subtract(M.getPixelOrigin()),this._radius=isNaN(tn)?0:Le.x-M.project([bt,h-tn]).x,this._radiusY=Le.y-xe.y}else{var yn=k.unproject(k.project(this._latlng).subtract([this._mRadius,0]));this._point=M.latLngToLayerPoint(this._latlng),this._radius=this._point.x-M.latLngToLayerPoint(yn).x}this._updateBounds()}});var pr=jo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,x){Ct(this,x),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var U,X,x=1/0,M=null,k=Ka,xe=0,je=this._parts.length;xe<je;xe++)for(var Le=this._parts[xe],bt=1,tn=Le.length;bt<tn;bt++){var yn=k(h,U=Le[bt-1],X=Le[bt],!0);yn<x&&(x=yn,M=k(h,U,X))}return M&&(M.distance=Math.sqrt(x)),M},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ac(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,x){return x=x||this._defaultShape(),h=Tn(h),x.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new ji,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Io(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var x=[],M=Io(h),k=0,U=h.length;k<U;k++)M?(x[k]=Tn(h[k]),this._bounds.extend(x[k])):x[k]=this._convertLatLngs(h[k]);return x},_project:function(){var h=new Mn;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),x=new bn(h,h);this._rawPxBounds&&(this._pxBounds=new Mn([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(h,x,M){var X,xe,U=h.length;if(h[0]instanceof ri){for(xe=[],X=0;X<U;X++)xe[X]=this._map.latLngToLayerPoint(h[X]),M.extend(xe[X]);x.push(xe)}else for(X=0;X<U;X++)this._projectLatlngs(h[X],x,M)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(h)){if(this.options.noClip)return void(this._parts=this._rings);var M,k,U,X,xe,je,Le,x=this._parts;for(M=0,U=0,X=this._rings.length;M<X;M++)for(k=0,xe=(Le=this._rings[M]).length;k<xe-1;k++)(je=Ya(Le[k],Le[k+1],h,k,!0))&&(x[U]=x[U]||[],x[U].push(je[0]),(je[1]!==Le[k+1]||k===xe-2)&&(x[U].push(je[1]),U++))}},_simplifyPoints:function(){for(var h=this._parts,x=this.options.smoothFactor,M=0,k=h.length;M<k;M++)h[M]=Ml(h[M],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,x){var M,k,U,X,xe,je,Le=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(M=0,X=this._parts.length;M<X;M++)for(k=0,U=(xe=(je=this._parts[M]).length)-1;k<xe;U=k++)if((x||0!==k)&&bi(h,je[U],je[k])<=Le)return!0;return!1}});pr._flat=oi;var Qn=pr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return rc(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var x=pr.prototype._convertLatLngs.call(this,h),M=x.length;return M>=2&&x[0]instanceof ri&&x[0].equals(x[M-1])&&x.pop(),x},_setLatLngs:function(h){pr.prototype._setLatLngs.call(this,h),Io(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Io(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,x=this.options.weight,M=new bn(x,x);if(h=new Mn(h.min.subtract(M),h.max.add(M)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(h)){if(this.options.noClip)return void(this._parts=this._rings);for(var X,k=0,U=this._rings.length;k<U;k++)(X=ic(this._rings[k],h,!0)).length&&this._parts.push(X)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var M,k,U,X,xe,je,Le,bt,x=!1;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(X=0,Le=this._parts.length;X<Le;X++)for(xe=0,je=(bt=(M=this._parts[X]).length)-1;xe<bt;je=xe++)(k=M[xe]).y>h.y!=(U=M[je]).y>h.y&&h.x<(U.x-k.x)*(h.y-k.y)/(U.y-k.y)+k.x&&(x=!x);return x||pr.prototype._containsPoint.call(this,h,!0)}});var Po=zr.extend({initialize:function(h,x){Ct(this,x),this._layers={},h&&this.addData(h)},addData:function(h){var M,k,U,x=Ye(h)?h:h.features;if(x){for(M=0,k=x.length;M<k;M++)((U=x[M]).geometries||U.geometry||U.features||U.coordinates)&&this.addData(U);return this}var X=this.options;if(X.filter&&!X.filter(h))return this;var xe=Hs(h,X);return xe?(xe.feature=qs(h),xe.defaultOptions=xe.options,this.resetStyle(xe),X.onEachFeature&&X.onEachFeature(h,xe),this.addLayer(xe)):this},resetStyle:function(h){return void 0===h?this.eachLayer(this.resetStyle,this):(h.options=ze({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(x){this._setLayerStyle(x,h)},this)},_setLayerStyle:function(h,x){h.setStyle&&("function"==typeof x&&(x=x(h.feature)),h.setStyle(x))}});function Hs(h,x){var je,Le,bt,tn,M="Feature"===h.type?h.geometry:h,k=M?M.coordinates:null,U=[],X=x&&x.pointToLayer,xe=x&&x.coordsToLatLng||$o;if(!k&&!M)return null;switch(M.type){case"Point":return Qa(X,h,je=xe(k),x);case"MultiPoint":for(bt=0,tn=k.length;bt<tn;bt++)je=xe(k[bt]),U.push(Qa(X,h,je,x));return new zr(U);case"LineString":case"MultiLineString":return Le=ms(k,"LineString"===M.type?0:1,xe),new pr(Le,x);case"Polygon":case"MultiPolygon":return Le=ms(k,"Polygon"===M.type?1:2,xe),new Qn(Le,x);case"GeometryCollection":for(bt=0,tn=M.geometries.length;bt<tn;bt++){var yn=Hs({geometry:M.geometries[bt],type:"Feature",properties:h.properties},x);yn&&U.push(yn)}return new zr(U);case"FeatureCollection":for(bt=0,tn=M.features.length;bt<tn;bt++){var _n=Hs(M.features[bt],x);_n&&U.push(_n)}return new zr(U);default:throw new Error("Invalid GeoJSON object.")}}function Qa(h,x,M,k){return h?h(x,M):new is(M,k&&k.markersInheritOptions&&k)}function $o(h){return new ri(h[1],h[0],h[2])}function ms(h,x,M){for(var xe,k=[],U=0,X=h.length;U<X;U++)xe=x?ms(h[U],x-1,M):(M||$o)(h[U]),k.push(xe);return k}function qc(h,x){return void 0!==(h=Tn(h)).alt?[pt(h.lng,x),pt(h.lat,x),pt(h.alt,x)]:[pt(h.lng,x),pt(h.lat,x)]}function el(h,x,M,k){for(var U=[],X=0,xe=h.length;X<xe;X++)U.push(x?el(h[X],Io(h[X])?0:x-1,M,k):qc(h[X],k));return!x&&M&&U.length>0&&U.push(U[0].slice()),U}function Gs(h,x){return h.feature?ze({},h.feature,{geometry:x}):qs(x)}function qs(h){return"Feature"===h.type||"FeatureCollection"===h.type?h:{type:"Feature",properties:{},geometry:h}}var lc={toGeoJSON:function(h){return Gs(this,{type:"Point",coordinates:qc(this.getLatLng(),h)})}};function Zs(h,x){return new Po(h,x)}is.include(lc),xo.include(lc),Pl.include(lc),pr.include({toGeoJSON:function(h){var x=!Io(this._latlngs);return Gs(this,{type:(x?"Multi":"")+"LineString",coordinates:el(this._latlngs,x?1:0,!1,h)})}}),Qn.include({toGeoJSON:function(h){var x=!Io(this._latlngs),M=x&&!Io(this._latlngs[0]),k=el(this._latlngs,M?2:x?1:0,!0,h);return x||(k=[k]),Gs(this,{type:(M?"Multi":"")+"Polygon",coordinates:k})}}),Ao.include({toMultiPoint:function(h){var x=[];return this.eachLayer(function(M){x.push(M.toGeoJSON(h).geometry.coordinates)}),Gs(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(h){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===x)return this.toMultiPoint(h);var M="GeometryCollection"===x,k=[];return this.eachLayer(function(U){if(U.toGeoJSON){var X=U.toGeoJSON(h);if(M)k.push(X.geometry);else{var xe=qs(X);"FeatureCollection"===xe.type?k.push.apply(k,xe.features):k.push(xe)}}}),M?Gs(this,{geometries:k,type:"GeometryCollection"}):{type:"FeatureCollection",features:k}}});var ku=Zs,gs=Uo.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,x,M){this._url=h,this._bounds=Ai(x),Ct(this,M)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(et(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Qi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Ns(this._image),this},bringToBack:function(){return this._map&&Wa(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=Ai(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h="IMG"===this._url.tagName,x=this._image=h?this._url:Ln("img");et(x,"leaflet-image-layer"),this._zoomAnimated&&et(x,"leaflet-zoom-animated"),this.options.className&&et(x,this.options.className),x.onselectstart=Ae,x.onmousemove=Ae,x.onload=u(this.fire,this,"load"),x.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(x.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h?this._url=x.src:(x.src=this._url,x.alt=this.options.alt)},_animateZoom:function(h){var x=this._map.getZoomScale(h.zoom),M=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;ts(this._image,M,x)},_reset:function(){var h=this._image,x=new Mn(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),M=x.getSize();Hi(h,x.min),h.style.width=M.x+"px",h.style.height=M.y+"px"},_updateOpacity:function(){er(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&null!=this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),Ou=gs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h="VIDEO"===this._url.tagName,x=this._image=h?this._url:Ln("video");if(et(x,"leaflet-image-layer"),this._zoomAnimated&&et(x,"leaflet-zoom-animated"),this.options.className&&et(x,this.options.className),x.onselectstart=Ae,x.onmousemove=Ae,x.onloadeddata=u(this.fire,this,"load"),h){for(var M=x.getElementsByTagName("source"),k=[],U=0;U<M.length;U++)k.push(M[U].src);this._url=M.length>0?k:[x.src]}else{Ye(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var X=0;X<this._url.length;X++){var xe=Ln("source");xe.src=this._url[X],x.appendChild(xe)}}}});var Ih=gs.extend({_initImage:function(){var h=this._image=this._url;et(h,"leaflet-image-layer"),this._zoomAnimated&&et(h,"leaflet-zoom-animated"),this.options.className&&et(h,this.options.className),h.onselectstart=Ae,h.onmousemove=Ae}});var ss=Uo.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,x){h&&(h instanceof ri||Ye(h))?(this._latlng=Tn(h),Ct(this,x)):(Ct(this,h),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(h){return(h=arguments.length?h:this._source._map).hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&er(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&er(this._container,1),this.bringToFront(),this.options.interactive&&(et(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(er(this._container,0),this._removeTimeout=setTimeout(u(Qi,void 0,this._container),200)):Qi(this._container),this.options.interactive&&(gn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=Tn(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ns(this._container),this},bringToBack:function(){return this._map&&Wa(this._container),this},_prepareOpen:function(h){var x=this._source;if(!x._map)return!1;if(x instanceof zr){x=null;var M=this._source._layers;for(var k in M)if(M[k]._map){x=M[k];break}if(!x)return!1;this._source=x}if(!h)if(x.getCenter)h=x.getCenter();else if(x.getLatLng)h=x.getLatLng();else{if(!x.getBounds)throw new Error("Unable to get source layer LatLng.");h=x.getBounds().getCenter()}return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,x="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof x)h.innerHTML=x;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),x=un(this.options.offset),M=this._getAnchor();this._zoomAnimated?Hi(this._container,h.add(M)):x=x.add(h).add(M);var k=this._containerBottom=-x.y,U=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=k+"px",this._container.style.left=U+"px"}},_getAnchor:function(){return[0,0]}});Bt.include({_initOverlay:function(h,x,M,k){var U=x;return U instanceof h||(U=new h(k).setContent(x)),M&&U.setLatLng(M),U}}),Uo.include({_initOverlay:function(h,x,M,k){var U=M;return U instanceof h?(Ct(U,k),U._source=this):(U=x&&!k?x:new h(k,this)).setContent(M),U}});var Sa=ss.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return!(h=arguments.length?h:this._source._map).hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,ss.prototype.openOn.call(this,h)},onAdd:function(h){ss.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof jo||this._source.on("preclick",ns))},onRemove:function(h){ss.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof jo||this._source.off("preclick",ns))},getEvents:function(){var h=ss.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",x=this._container=Ln("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),M=this._wrapper=Ln("div",h+"-content-wrapper",x);if(this._contentNode=Ln("div",h+"-content",M),Hr(x),Vc(this._contentNode),nn(x,"contextmenu",ns),this._tipContainer=Ln("div",h+"-tip-container",x),this._tip=Ln("div",h+"-tip",this._tipContainer),this.options.closeButton){var k=this._closeButton=Ln("a",h+"-close-button",x);k.setAttribute("role","button"),k.setAttribute("aria-label","Close popup"),k.href="#close",k.innerHTML='<span aria-hidden="true">&#215;</span>',nn(k,"click",function(U){vi(U),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,x=h.style;x.width="",x.whiteSpace="nowrap";var M=h.offsetWidth;M=Math.min(M,this.options.maxWidth),M=Math.max(M,this.options.minWidth),x.width=M+1+"px",x.whiteSpace="",x.height="";var U=this.options.maxHeight,X="leaflet-popup-scrolled";U&&h.offsetHeight>U?(x.height=U+"px",et(h,X)):gn(h,X),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),M=this._getAnchor();Hi(this._container,x.add(M))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)return void(this._autopanning=!1);var h=this._map,x=parseInt(Wi(this._container,"marginBottom"),10)||0,M=this._container.offsetHeight+x,k=this._containerWidth,U=new bn(this._containerLeft,-M-this._containerBottom);U._add(Un(this._container));var X=h.layerPointToContainerPoint(U),xe=un(this.options.autoPanPadding),je=un(this.options.autoPanPaddingTopLeft||xe),Le=un(this.options.autoPanPaddingBottomRight||xe),bt=h.getSize(),tn=0,yn=0;X.x+k+Le.x>bt.x&&(tn=X.x+k-bt.x+Le.x),X.x-tn-je.x<0&&(tn=X.x-je.x),X.y+M+Le.y>bt.y&&(yn=X.y+M-bt.y+Le.y),X.y-yn-je.y<0&&(yn=X.y-je.y),(tn||yn)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([tn,yn]))}},_getAnchor:function(){return un(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Bt.mergeOptions({closePopupOnClick:!0}),Bt.include({openPopup:function(h,x,M){return this._initOverlay(Sa,h,x,M).openOn(this),this},closePopup:function(h){return(h=arguments.length?h:this._popup)&&h.close(),this}}),Uo.include({bindPopup:function(h,x){return this._popup=this._initOverlay(Sa,this._popup,h,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof zr||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(this._popup&&this._map){wa(h);var x=h.layer||h.target;if(this._popup._source===x&&!(x instanceof jo))return void(this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng));this._popup._source=x,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){13===h.originalEvent.keyCode&&this._openPopup(h)}});var cc=ss.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){ss.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){ss.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=ss.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){this._contentNode=this._container=Ln("div","leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide")),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+Me(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var x,M,k=this._map,U=this._container,X=k.latLngToContainerPoint(k.getCenter()),xe=k.layerPointToContainerPoint(h),je=this.options.direction,Le=U.offsetWidth,bt=U.offsetHeight,tn=un(this.options.offset),yn=this._getAnchor();"top"===je?(x=Le/2,M=bt):"bottom"===je?(x=Le/2,M=0):"center"===je?(x=Le/2,M=bt/2):"right"===je?(x=0,M=bt/2):"left"===je?(x=Le,M=bt/2):xe.x<X.x?(je="right",x=0,M=bt/2):(je="left",x=Le+2*(tn.x+yn.x),M=bt/2),h=h.subtract(un(x,M,!0)).add(tn).add(yn),gn(U,"leaflet-tooltip-right"),gn(U,"leaflet-tooltip-left"),gn(U,"leaflet-tooltip-top"),gn(U,"leaflet-tooltip-bottom"),et(U,"leaflet-tooltip-"+je),Hi(U,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&er(this._container,h)},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(x)},_getAnchor:function(){return un(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Bt.include({openTooltip:function(h,x,M){return this._initOverlay(cc,h,x,M).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Uo.include({bindTooltip:function(h,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(cc,this._tooltip,h,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(h||!this._tooltipHandlersAdded){var x=h?"off":"on",M={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?M.add=this._openTooltip:(M.mouseover=this._openTooltip,M.mouseout=this.closeTooltip,M.click=this._openTooltip,this._map?this._addFocusListeners():M.add=this._addFocusListeners),this._tooltip.options.sticky&&(M.mousemove=this._moveTooltip),this[x](M),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof zr||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var x="function"==typeof h.getElement&&h.getElement();x&&(nn(x,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),nn(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var x="function"==typeof h.getElement&&h.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(this._tooltip&&this._map){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;return void this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(h)})}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var M,k,x=h.latlng;this._tooltip.options.sticky&&h.originalEvent&&(M=this._map.mouseEventToContainerPoint(h.originalEvent),k=this._map.containerPointToLayerPoint(M),x=this._map.layerPointToLatLng(k)),this._tooltip.setLatLng(x)}});var _s=rn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var x=h&&"DIV"===h.tagName?h:document.createElement("div"),M=this.options;if(M.html instanceof Element?(Do(x),x.appendChild(M.html)):x.innerHTML=!1!==M.html?M.html:"",M.bgPos){var k=un(M.bgPos);x.style.backgroundPosition=-k.x+"px "+-k.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});rn.Default=Qt;var io=Uo.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Nt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){Ct(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),Qi(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ns(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Wa(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Pe(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof bn?h:new bn(h,h)},_updateZIndex:function(){this._container&&null!=this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var X,x=this.getPane().children,M=-h(-1/0,1/0),k=0,U=x.length;k<U;k++)X=x[k].style.zIndex,x[k]!==this._container&&X&&(M=h(M,+X));isFinite(M)&&(this.options.zIndex=M+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Nt.ielt9){er(this._container,this.options.opacity);var h=+new Date,x=!1,M=!1;for(var k in this._tiles){var U=this._tiles[k];if(U.current&&U.loaded){var X=Math.min(1,(h-U.loaded)/200);er(U.el,X),X<1?x=!0:(U.active?M=!0:this._onOpaqueTile(U),U.active=!0)}}M&&!this._noPrune&&this._pruneTiles(),x&&(En(this._fadeFrame),this._fadeFrame=It(this._updateOpacity,this))}},_onOpaqueTile:Ae,_initContainer:function(){this._container||(this._container=Ln("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,x=this.options.maxZoom;if(void 0!==h){for(var M in this._levels)M=Number(M),this._levels[M].el.children.length||M===h?(this._levels[M].el.style.zIndex=x-Math.abs(h-M),this._onUpdateLevel(M)):(Qi(this._levels[M].el),this._removeTilesAtZoom(M),this._onRemoveLevel(M),delete this._levels[M]);var k=this._levels[h],U=this._map;return k||((k=this._levels[h]={}).el=Ln("div","leaflet-tile-container leaflet-zoom-animated",this._container),k.el.style.zIndex=x,k.origin=U.project(U.unproject(U.getPixelOrigin()),h).round(),k.zoom=h,this._setZoomTransform(k,U.getCenter(),U.getZoom()),this._onCreateLevel(k)),this._level=k,k}},_onUpdateLevel:Ae,_onRemoveLevel:Ae,_onCreateLevel:Ae,_pruneTiles:function(){if(this._map){var h,x,M=this._map.getZoom();if(M>this.options.maxZoom||M<this.options.minZoom)return void this._removeAllTiles();for(h in this._tiles)(x=this._tiles[h]).retain=x.current;for(h in this._tiles)if((x=this._tiles[h]).current&&!x.active){var k=x.coords;this._retainParent(k.x,k.y,k.z,k.z-5)||this._retainChildren(k.x,k.y,k.z,k.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var x in this._tiles)this._tiles[x].coords.z===h&&this._removeTile(x)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)Qi(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,x,M,k){var U=Math.floor(h/2),X=Math.floor(x/2),xe=M-1,je=new bn(+U,+X);je.z=+xe;var Le=this._tileCoordsToKey(je),bt=this._tiles[Le];return bt&&bt.active?(bt.retain=!0,!0):(bt&&bt.loaded&&(bt.retain=!0),xe>k&&this._retainParent(U,X,xe,k))},_retainChildren:function(h,x,M,k){for(var U=2*h;U<2*h+2;U++)for(var X=2*x;X<2*x+2;X++){var xe=new bn(U,X);xe.z=M+1;var je=this._tileCoordsToKey(xe),Le=this._tiles[je];Le&&Le.active?Le.retain=!0:(Le&&Le.loaded&&(Le.retain=!0),M+1<k&&this._retainChildren(U,X,M+1,k))}},_resetView:function(h){var x=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var x=this.options;return void 0!==x.minNativeZoom&&h<x.minNativeZoom?x.minNativeZoom:void 0!==x.maxNativeZoom&&x.maxNativeZoom<h?x.maxNativeZoom:h},_setView:function(h,x,M,k){var U=Math.round(x);U=void 0!==this.options.maxZoom&&U>this.options.maxZoom||void 0!==this.options.minZoom&&U<this.options.minZoom?void 0:this._clampZoom(U),(!k||this.options.updateWhenZooming&&U!==this._tileZoom)&&(this._tileZoom=U,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==U&&this._update(h),M||this._pruneTiles(),this._noPrune=!!M),this._setZoomTransforms(h,x)},_setZoomTransforms:function(h,x){for(var M in this._levels)this._setZoomTransform(this._levels[M],h,x)},_setZoomTransform:function(h,x,M){var k=this._map.getZoomScale(M,h.zoom),U=h.origin.multiplyBy(k).subtract(this._map._getNewPixelOrigin(x,M)).round();Nt.any3d?ts(h.el,U,k):Hi(h.el,U)},_resetGrid:function(){var h=this._map,x=h.options.crs,M=this._tileSize=this.getTileSize(),k=this._tileZoom,U=this._map.getPixelWorldBounds(this._tileZoom);U&&(this._globalTileRange=this._pxBoundsToTileRange(U)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,x.wrapLng[0]],k).x/M.x),Math.ceil(h.project([0,x.wrapLng[1]],k).x/M.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([x.wrapLat[0],0],k).y/M.x),Math.ceil(h.project([x.wrapLat[1],0],k).y/M.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var x=this._map,M=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),k=x.getZoomScale(M,this._tileZoom),U=x.project(h,this._tileZoom).floor(),X=x.getSize().divideBy(2*k);return new Mn(U.subtract(X),U.add(X))},_update:function(h){var x=this._map;if(x){var M=this._clampZoom(x.getZoom());if(void 0===h&&(h=x.getCenter()),void 0!==this._tileZoom){var k=this._getTiledPixelBounds(h),U=this._pxBoundsToTileRange(k),X=U.getCenter(),xe=[],je=this.options.keepBuffer,Le=new Mn(U.getBottomLeft().subtract([je,-je]),U.getTopRight().add([je,-je]));if(!(isFinite(U.min.x)&&isFinite(U.min.y)&&isFinite(U.max.x)&&isFinite(U.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var bt in this._tiles){var tn=this._tiles[bt].coords;(tn.z!==this._tileZoom||!Le.contains(new bn(tn.x,tn.y)))&&(this._tiles[bt].current=!1)}if(Math.abs(M-this._tileZoom)>1)return void this._setView(h,M);for(var yn=U.min.y;yn<=U.max.y;yn++)for(var _n=U.min.x;_n<=U.max.x;_n++){var Lr=new bn(_n,yn);if(Lr.z=this._tileZoom,this._isValidTile(Lr)){var rr=this._tiles[this._tileCoordsToKey(Lr)];rr?rr.current=!0:xe.push(Lr)}}if(xe.sort(function(Er,Ws){return Er.distanceTo(X)-Ws.distanceTo(X)}),0!==xe.length){this._loading||(this._loading=!0,this.fire("loading"));var qi=document.createDocumentFragment();for(_n=0;_n<xe.length;_n++)this._addTile(xe[_n],qi);this._level.el.appendChild(qi)}}}},_isValidTile:function(h){var x=this._map.options.crs;if(!x.infinite){var M=this._globalTileRange;if(!x.wrapLng&&(h.x<M.min.x||h.x>M.max.x)||!x.wrapLat&&(h.y<M.min.y||h.y>M.max.y))return!1}if(!this.options.bounds)return!0;var k=this._tileCoordsToBounds(h);return Ai(this.options.bounds).overlaps(k)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var x=this._map,M=this.getTileSize(),k=h.scaleBy(M),U=k.add(M);return[x.unproject(k,h.z),x.unproject(U,h.z)]},_tileCoordsToBounds:function(h){var x=this._tileCoordsToNwSe(h),M=new ji(x[0],x[1]);return this.options.noWrap||(M=this._map.wrapLatLngBounds(M)),M},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var x=h.split(":"),M=new bn(+x[0],+x[1]);return M.z=+x[2],M},_removeTile:function(h){var x=this._tiles[h];x&&(Qi(x.el),delete this._tiles[h],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){et(h,"leaflet-tile");var x=this.getTileSize();h.style.width=x.x+"px",h.style.height=x.y+"px",h.onselectstart=Ae,h.onmousemove=Ae,Nt.ielt9&&this.options.opacity<1&&er(h,this.options.opacity)},_addTile:function(h,x){var M=this._getTilePos(h),k=this._tileCoordsToKey(h),U=this.createTile(this._wrapCoords(h),u(this._tileReady,this,h));this._initTile(U),this.createTile.length<2&&It(u(this._tileReady,this,h,null,U)),Hi(U,M),this._tiles[k]={el:U,coords:h,current:!0},x.appendChild(U),this.fire("tileloadstart",{tile:U,coords:h})},_tileReady:function(h,x,M){x&&this.fire("tileerror",{error:x,tile:M,coords:h});var k=this._tileCoordsToKey(h);(M=this._tiles[k])&&(M.loaded=+new Date,this._map._fadeAnimated?(er(M.el,0),En(this._fadeFrame),this._fadeFrame=It(this._updateOpacity,this)):(M.active=!0,this._pruneTiles()),x||(et(M.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:M.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Nt.ielt9||!this._map._fadeAnimated?It(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var x=new bn(this._wrapX?Se(h.x,this._wrapX):h.x,this._wrapY?Se(h.y,this._wrapY):h.y);return x.z=h.z,x},_pxBoundsToTileRange:function(h){var x=this.getTileSize();return new Mn(h.min.unscaleBy(x).floor(),h.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});var tl=io.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,x){this._url=h,(x=Ct(this,x)).detectRetina&&Nt.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),"string"==typeof x.subdomains&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,x){return this._url===h&&void 0===x&&(x=!0),this._url=h,x||this.redraw(),this},createTile:function(h,x){var M=document.createElement("img");return nn(M,"load",u(this._tileOnLoad,this,x,M)),nn(M,"error",u(this._tileOnError,this,x,M)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(M.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(M.referrerPolicy=this.options.referrerPolicy),M.alt="",M.src=this.getTileUrl(h),M},getTileUrl:function(h){var x={r:Nt.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var M=this._globalTileRange.max.y-h.y;this.options.tms&&(x.y=M),x["-y"]=M}return he(this._url,ze(x,this.options))},_tileOnLoad:function(h,x){Nt.ielt9?setTimeout(u(h,this,null,x),0):h(null,x)},_tileOnError:function(h,x,M){var k=this.options.errorTileUrl;k&&x.getAttribute("src")!==k&&(x.src=k),h(M,x)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom;return this.options.zoomReverse&&(h=this.options.maxZoom-h),h+this.options.zoomOffset},_getSubdomain:function(h){var x=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var h,x;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&((x=this._tiles[h].el).onload=Ae,x.onerror=Ae,!x.complete)){x.src=Ue;var M=this._tiles[h].coords;Qi(x),delete this._tiles[h],this.fire("tileabort",{tile:x,coords:M})}},_removeTile:function(h){var x=this._tiles[h];if(x)return x.el.setAttribute("src",Ue),io.prototype._removeTile.call(this,h)},_tileReady:function(h,x,M){if(this._map&&(!M||M.getAttribute("src")!==Ue))return io.prototype._tileReady.call(this,h,x,M)}});function mr(h,x){return new tl(h,x)}var nl=tl.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,x){this._url=h;var M=ze({},this.defaultWmsParams);for(var k in x)k in this.options||(M[k]=x[k]);var U=(x=Ct(this,x)).detectRetina&&Nt.retina?2:1,X=this.getTileSize();M.width=X.x*U,M.height=X.y*U,this.wmsParams=M},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version),this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=this._crs.code,tl.prototype.onAdd.call(this,h)},getTileUrl:function(h){var x=this._tileCoordsToNwSe(h),M=this._crs,k=ni(M.project(x[0]),M.project(x[1])),U=k.min,X=k.max,xe=(this._wmsVersion>=1.3&&this._crs===Sh?[U.y,U.x,X.y,X.x]:[U.x,U.y,X.x,X.y]).join(","),je=tl.prototype.getTileUrl.call(this,h);return je+Lt(this.wmsParams,je,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+xe},setParams:function(h,x){return ze(this.wmsParams,h),x||this.redraw(),this}});tl.WMS=nl,mr.wms=function Zc(h,x){return new nl(h,x)};var Ho=Uo.extend({options:{padding:.1},initialize:function(h){Ct(this,h),Me(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),et(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,x){var M=this._map.getZoomScale(x,this._zoom),k=this._map.getSize().multiplyBy(.5+this.options.padding),U=this._map.project(this._center,x),X=k.multiplyBy(-M).add(U).subtract(this._map._getNewPixelOrigin(h,x));Nt.any3d?ts(this._container,X,M):Hi(this._container,X)},_reset:function(){for(var h in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,x=this._map.getSize(),M=this._map.containerPointToLayerPoint(x.multiplyBy(-h)).round();this._bounds=new Mn(M,M.add(x.multiplyBy(1+2*h)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),kn=Ho.extend({options:{tolerance:0},getEvents:function(){var h=Ho.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ho.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");nn(h,"mousemove",this._onMouseMove,this),nn(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),nn(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){En(this._redrawRequest),delete this._ctx,Qi(this._container),ii(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var x in this._redrawBounds=null,this._layers)this._layers[x]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Ho.prototype._update.call(this);var h=this._bounds,x=this._container,M=h.getSize(),k=Nt.retina?2:1;Hi(x,h.min),x.width=k*M.x,x.height=k*M.y,x.style.width=M.x+"px",x.style.height=M.y+"px",Nt.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){Ho.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[Me(h)]=h;var x=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var x=h._order,M=x.next,k=x.prev;M?M.prev=k:this._drawLast=k,k?k.next=M:this._drawFirst=M,delete h._order,delete this._layers[Me(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if("string"==typeof h.options.dashArray){var k,U,x=h.options.dashArray.split(/[, ]+/),M=[];for(U=0;U<x.length;U++){if(k=Number(x[U]),isNaN(k))return;M.push(k)}h.options._dashArray=M}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||It(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var x=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Mn,this._redrawBounds.extend(h._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(h._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var x=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,x=this._redrawBounds;if(this._ctx.save(),x){var M=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,M.x,M.y),this._ctx.clip()}this._drawing=!0;for(var k=this._drawFirst;k;k=k.next)h=k.layer,(!x||h._pxBounds&&h._pxBounds.intersects(x))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,x){if(this._drawing){var M,k,U,X,xe=h._parts,je=xe.length,Le=this._ctx;if(je){for(Le.beginPath(),M=0;M<je;M++){for(k=0,U=xe[M].length;k<U;k++)Le[k?"lineTo":"moveTo"]((X=xe[M][k]).x,X.y);x&&Le.closePath()}this._fillStroke(Le,h)}}},_updateCircle:function(h){if(this._drawing&&!h._empty()){var x=h._point,M=this._ctx,k=Math.max(Math.round(h._radius),1),U=(Math.max(Math.round(h._radiusY),1)||k)/k;1!==U&&(M.save(),M.scale(1,U)),M.beginPath(),M.arc(x.x,x.y/U,k,0,2*Math.PI,!1),1!==U&&M.restore(),this._fillStroke(M,h)}},_fillStroke:function(h,x){var M=x.options;M.fill&&(h.globalAlpha=M.fillOpacity,h.fillStyle=M.fillColor||M.color,h.fill(M.fillRule||"evenodd")),M.stroke&&0!==M.weight&&(h.setLineDash&&h.setLineDash(x.options&&x.options._dashArray||[]),h.globalAlpha=M.opacity,h.lineWidth=M.weight,h.strokeStyle=M.color,h.lineCap=M.lineCap,h.lineJoin=M.lineJoin,h.stroke())},_onClick:function(h){for(var M,k,x=this._map.mouseEventToLayerPoint(h),U=this._drawFirst;U;U=U.next)(M=U.layer).options.interactive&&M._containsPoint(x)&&("click"!==h.type&&"preclick"!==h.type||!this._map._draggableMoved(M))&&(k=M);this._fireEvent(!!k&&[k],h)},_onMouseMove:function(h){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var x=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,x)}},_handleMouseOut:function(h){var x=this._hoveredLayer;x&&(gn(this._container,"leaflet-interactive"),this._fireEvent([x],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,x){if(!this._mouseHoverThrottled){for(var M,k,U=this._drawFirst;U;U=U.next)(M=U.layer).options.interactive&&M._containsPoint(x)&&(k=M);k!==this._hoveredLayer&&(this._handleMouseOut(h),k&&(et(this._container,"leaflet-interactive"),this._fireEvent([k],h,"mouseover"),this._hoveredLayer=k)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],h),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,x,M){this._map._fireDOMEvent(x,M||x.type,h)},_bringToFront:function(h){var x=h._order;if(x){var M=x.next,k=x.prev;if(!M)return;M.prev=k,k?k.next=M:M&&(this._drawFirst=M),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(h)}},_bringToBack:function(h){var x=h._order;if(x){var M=x.next,k=x.prev;if(!k)return;k.next=M,M?M.prev=k:k&&(this._drawLast=k),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(h)}}});function kl(h){return Nt.canvas?new kn(h):null}var il=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),An={_initContainer:function(){this._container=Ln("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ho.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var x=h._container=il("shape");et(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",h._path=il("path"),x.appendChild(h._path),this._updateStyle(h),this._layers[Me(h)]=h},_addPath:function(h){var x=h._container;this._container.appendChild(x),h.options.interactive&&h.addInteractiveTarget(x)},_removePath:function(h){var x=h._container;Qi(x),h.removeInteractiveTarget(x),delete this._layers[Me(h)]},_updateStyle:function(h){var x=h._stroke,M=h._fill,k=h.options,U=h._container;U.stroked=!!k.stroke,U.filled=!!k.fill,k.stroke?(x||(x=h._stroke=il("stroke")),U.appendChild(x),x.weight=k.weight+"px",x.color=k.color,x.opacity=k.opacity,x.dashStyle=k.dashArray?Ye(k.dashArray)?k.dashArray.join(" "):k.dashArray.replace(/( *, *)/g," "):"",x.endcap=k.lineCap.replace("butt","flat"),x.joinstyle=k.lineJoin):x&&(U.removeChild(x),h._stroke=null),k.fill?(M||(M=h._fill=il("fill")),U.appendChild(M),M.color=k.fillColor||k.color,M.opacity=k.fillOpacity):M&&(U.removeChild(M),h._fill=null)},_updateCircle:function(h){var x=h._point.round(),M=Math.round(h._radius),k=Math.round(h._radiusY||M);this._setPath(h,h._empty()?"M0 0":"AL "+x.x+","+x.y+" "+M+","+k+" 0,23592600")},_setPath:function(h,x){h._path.v=x},_bringToFront:function(h){Ns(h._container)},_bringToBack:function(h){Wa(h._container)}},gr=Nt.vml?il:ho,ei=Ho.extend({_initContainer:function(){this._container=gr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=gr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Qi(this._container),ii(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Ho.prototype._update.call(this);var h=this._bounds,x=h.getSize(),M=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,M.setAttribute("width",x.x),M.setAttribute("height",x.y)),Hi(M,h.min),M.setAttribute("viewBox",[h.min.x,h.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(h){var x=h._path=gr("path");h.options.className&&et(x,h.options.className),h.options.interactive&&et(x,"leaflet-interactive"),this._updateStyle(h),this._layers[Me(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){Qi(h._path),h.removeInteractiveTarget(h._path),delete this._layers[Me(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var x=h._path,M=h.options;x&&(M.stroke?(x.setAttribute("stroke",M.color),x.setAttribute("stroke-opacity",M.opacity),x.setAttribute("stroke-width",M.weight),x.setAttribute("stroke-linecap",M.lineCap),x.setAttribute("stroke-linejoin",M.lineJoin),M.dashArray?x.setAttribute("stroke-dasharray",M.dashArray):x.removeAttribute("stroke-dasharray"),M.dashOffset?x.setAttribute("stroke-dashoffset",M.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),M.fill?(x.setAttribute("fill",M.fillColor||M.color),x.setAttribute("fill-opacity",M.fillOpacity),x.setAttribute("fill-rule",M.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(h,x){this._setPath(h,ec(h._parts,x))},_updateCircle:function(h){var x=h._point,M=Math.max(Math.round(h._radius),1),U="a"+M+","+(Math.max(Math.round(h._radiusY),1)||M)+" 0 1,0 ",X=h._empty()?"M0 0":"M"+(x.x-M)+","+x.y+U+2*M+",0 "+U+2*-M+",0 ";this._setPath(h,X)},_setPath:function(h,x){h._path.setAttribute("d",x)},_bringToFront:function(h){Ns(h._path)},_bringToBack:function(h){Wa(h._path)}});function xr(h){return Nt.svg||Nt.vml?new ei(h):null}Nt.vml&&ei.include(An),Bt.include({getRenderer:function(h){var x=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(h){if("overlayPane"===h||void 0===h)return!1;var x=this._paneRenderers[h];return void 0===x&&(x=this._createRenderer({pane:h}),this._paneRenderers[h]=x),x},_createRenderer:function(h){return this.options.preferCanvas&&kl(h)||xr(h)}});var ir=Qn.extend({initialize:function(h,x){Qn.prototype.initialize.call(this,this._boundsToLatLngs(h),x)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return[(h=Ai(h)).getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});ei.create=gr,ei.pointsToPath=ec,Po.geometryToLayer=Hs,Po.coordsToLatLng=$o,Po.coordsToLatLngs=ms,Po.latLngToCoords=qc,Po.latLngsToCoords=el,Po.getFeature=Gs,Po.asFeature=qs,Bt.mergeOptions({boxZoom:!0});var Zr=Gr.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){nn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ii(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Qi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||1!==h.which&&1!==h.button)return!1;this._clearDeferredResetState(),this._resetState(),di(),yi(),this._startPoint=this._map.mouseEventToContainerPoint(h),nn(document,{contextmenu:wa,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=Ln("div","leaflet-zoom-box",this._container),et(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var x=new Mn(this._point,this._startPoint),M=x.getSize();Hi(this._box,x.min),this._box.style.width=M.x+"px",this._box.style.height=M.y+"px"},_finish:function(){this._moved&&(Qi(this._box),gn(this._container,"leaflet-crosshair")),tr(),Sn(),ii(document,{contextmenu:wa,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if((1===h.which||1===h.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var x=new ji(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(h){27===h.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Bt.addInitHook("addHandler","boxZoom",Zr),Bt.mergeOptions({doubleClickZoom:!0});var Ia=Gr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var x=this._map,M=x.getZoom(),k=x.options.zoomDelta,U=h.originalEvent.shiftKey?M-k:M+k;"center"===x.options.doubleClickZoom?x.setZoom(U):x.setZoomAround(h.containerPoint,U)}});Bt.addInitHook("addHandler","doubleClickZoom",Ia),Bt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Aa=Gr.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new jn(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}et(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){gn(this._map._container,"leaflet-grab"),gn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=Ai(this._map.options.maxBounds);this._offsetLimit=ni(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var x=this._lastTime=+new Date,M=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(M),this._times.push(x),this._prunePositions(x)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,x){return h-(h-x)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var h=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;h.x<x.min.x&&(h.x=this._viscousLimit(h.x,x.min.x)),h.y<x.min.y&&(h.y=this._viscousLimit(h.y,x.min.y)),h.x>x.max.x&&(h.x=this._viscousLimit(h.x,x.max.x)),h.y>x.max.y&&(h.y=this._viscousLimit(h.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,x=Math.round(h/2),M=this._initialWorldOffset,k=this._draggable._newPos.x,U=(k-x+M)%h+x-M,X=(k+x+M)%h-x-M,xe=Math.abs(U+M)<Math.abs(X+M)?U:X;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=xe},_onDragEnd:function(h){var x=this._map,M=x.options,k=!M.inertia||h.noInertia||this._times.length<2;if(x.fire("dragend",h),k)x.fire("moveend");else{this._prunePositions(+new Date);var U=this._lastPos.subtract(this._positions[0]),xe=M.easeLinearity,je=U.multiplyBy(xe/((this._lastTime-this._times[0])/1e3)),Le=je.distanceTo([0,0]),bt=Math.min(M.inertiaMaxSpeed,Le),tn=je.multiplyBy(bt/Le),yn=bt/(M.inertiaDeceleration*xe),_n=tn.multiplyBy(-yn/2).round();_n.x||_n.y?(_n=x._limitOffset(_n,x.options.maxBounds),It(function(){x.panBy(_n,{duration:yn,easeLinearity:xe,noMoveStart:!0,animate:!0})})):x.fire("moveend")}}});Bt.addInitHook("addHandler","dragging",Aa),Bt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ol=Gr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),nn(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ii(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,x=document.documentElement,M=h.scrollTop||x.scrollTop,k=h.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(k,M)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var k,U,x=this._panKeys={},M=this.keyCodes;for(k=0,U=M.left.length;k<U;k++)x[M.left[k]]=[-1*h,0];for(k=0,U=M.right.length;k<U;k++)x[M.right[k]]=[h,0];for(k=0,U=M.down.length;k<U;k++)x[M.down[k]]=[0,h];for(k=0,U=M.up.length;k<U;k++)x[M.up[k]]=[0,-1*h]},_setZoomDelta:function(h){var k,U,x=this._zoomKeys={},M=this.keyCodes;for(k=0,U=M.zoomIn.length;k<U;k++)x[M.zoomIn[k]]=h;for(k=0,U=M.zoomOut.length;k<U;k++)x[M.zoomOut[k]]=-h},_addHooks:function(){nn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ii(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var k,x=h.keyCode,M=this._map;if(x in this._panKeys){if(!M._panAnim||!M._panAnim._inProgress)if(k=this._panKeys[x],h.shiftKey&&(k=un(k).multiplyBy(3)),M.options.maxBounds&&(k=M._limitOffset(un(k),M.options.maxBounds)),M.options.worldCopyJump){var U=M.wrapLatLng(M.unproject(M.project(M.getCenter()).add(k)));M.panTo(U)}else M.panBy(k)}else if(x in this._zoomKeys)M.setZoom(M.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[x]);else{if(27!==x||!M._popup||!M._popup.options.closeOnEscapeKey)return;M.closePopup()}wa(h)}}});Bt.addInitHook("addHandler","keyboard",ol),Bt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ol=Gr.extend({addHooks:function(){nn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ii(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var x=Uc(h),M=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var k=Math.max(M-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),k),wa(h)},_performZoom:function(){var h=this._map,x=h.getZoom(),M=this._map.options.zoomSnap||0;h._stop();var U=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,X=M?Math.ceil(U/M)*M:U,xe=h._limitZoom(x+(this._delta>0?X:-X))-x;this._delta=0,this._startTime=null,xe&&("center"===h.options.scrollWheelZoom?h.setZoom(x+xe):h.setZoomAround(this._lastMousePos,x+xe))}});Bt.addInitHook("addHandler","scrollWheelZoom",Ol);Bt.mergeOptions({tapHold:Nt.touchNative&&Nt.safari&&Nt.mobile,tapTolerance:15});var Gi=Gr.extend({addHooks:function(){nn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ii(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),1===h.touches.length){var x=h.touches[0];this._startPos=this._newPos=new bn(x.clientX,x.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(nn(document,"touchend",vi),nn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),600),nn(document,"touchend touchcancel contextmenu",this._cancel,this),nn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){ii(document,"touchend",vi),ii(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),ii(document,"touchend touchcancel contextmenu",this._cancel,this),ii(document,"touchmove",this._onMove,this)},_onMove:function(h){var x=h.touches[0];this._newPos=new bn(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,x){var M=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});M._simulated=!0,x.target.dispatchEvent(M)}});Bt.addInitHook("addHandler","tapHold",Gi),Bt.mergeOptions({touchZoom:Nt.touch,bounceAtZoomLimits:!0});var Xt=Gr.extend({addHooks:function(){et(this._map._container,"leaflet-touch-zoom"),nn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){gn(this._map._container,"leaflet-touch-zoom"),ii(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var x=this._map;if(h.touches&&2===h.touches.length&&!x._animatingZoom&&!this._zooming){var M=x.mouseEventToContainerPoint(h.touches[0]),k=x.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),"center"!==x.options.touchZoom&&(this._pinchStartLatLng=x.containerPointToLatLng(M.add(k)._divideBy(2))),this._startDist=M.distanceTo(k),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),nn(document,"touchmove",this._onTouchMove,this),nn(document,"touchend touchcancel",this._onTouchEnd,this),vi(h)}},_onTouchMove:function(h){if(h.touches&&2===h.touches.length&&this._zooming){var x=this._map,M=x.mouseEventToContainerPoint(h.touches[0]),k=x.mouseEventToContainerPoint(h.touches[1]),U=M.distanceTo(k)/this._startDist;if(this._zoom=x.getScaleZoom(U,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&U<1||this._zoom>x.getMaxZoom()&&U>1)&&(this._zoom=x._limitZoom(this._zoom)),"center"===x.options.touchZoom){if(this._center=this._startLatLng,1===U)return}else{var X=M._add(k)._divideBy(2)._subtract(this._centerPoint);if(1===U&&0===X.x&&0===X.y)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(X),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),En(this._animRequest);var xe=u(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=It(xe,this,!0),vi(h)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,En(this._animRequest),ii(document,"touchmove",this._onTouchMove,this),ii(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Bt.addInitHook("addHandler","touchZoom",Xt),Bt.BoxZoom=Zr,Bt.DoubleClickZoom=Ia,Bt.Drag=Aa,Bt.Keyboard=ol,Bt.ScrollWheelZoom=Ol,Bt.TapHold=Gi,Bt.TouchZoom=Xt,_e.Bounds=Mn,_e.Browser=Nt,_e.CRS=$r,_e.Canvas=kn,_e.Circle=xo,_e.CircleMarker=Pl,_e.Class=Ui,_e.Control=no,_e.DivIcon=_s,_e.DivOverlay=ss,_e.DomEvent=Th,_e.DomUtil=an,_e.Draggable=jn,_e.Evented=Cn,_e.FeatureGroup=zr,_e.GeoJSON=Po,_e.GridLayer=io,_e.Handler=Gr,_e.Icon=rn,_e.ImageOverlay=gs,_e.LatLng=ri,_e.LatLngBounds=ji,_e.Layer=Uo,_e.LayerGroup=Ao,_e.LineUtil=Rd,_e.Map=Bt,_e.Marker=is,_e.Mixin=ci,_e.Path=jo,_e.Point=bn,_e.PolyUtil=$c,_e.Polygon=Qn,_e.Polyline=pr,_e.Popup=Sa,_e.PosAnimation=Fr,_e.Projection=fs,_e.Rectangle=ir,_e.Renderer=Ho,_e.SVG=ei,_e.SVGOverlay=Ih,_e.TileLayer=tl,_e.Tooltip=cc,_e.Transformation=Jo,_e.Util=Ii,_e.VideoOverlay=Ou,_e.bind=u,_e.bounds=ni,_e.canvas=kl,_e.circle=function Rl(h,x,M){return new xo(h,x,M)},_e.circleMarker=function ps(h,x){return new Pl(h,x)},_e.control=Vo,_e.divIcon=function uc(h){return new _s(h)},_e.extend=ze,_e.featureGroup=function(h,x){return new zr(h,x)},_e.geoJSON=Zs,_e.geoJson=ku,_e.gridLayer=function hc(h){return new io(h)},_e.icon=function Lu(h){return new rn(h)},_e.imageOverlay=function(h,x,M){return new gs(h,x,M)},_e.latLng=Tn,_e.latLngBounds=Ai,_e.layerGroup=function(h,x){return new Ao(h,x)},_e.map=function Dh(h,x){return new Bt(h,x)},_e.marker=function Ja(h,x){return new is(h,x)},_e.point=un,_e.polygon=function Gc(h,x){return new Qn(h,x)},_e.polyline=function rs(h,x){return new pr(h,x)},_e.popup=function(h,x){return new Sa(h,x)},_e.rectangle=function rl(h,x){return new ir(h,x)},_e.setOptions=Ct,_e.stamp=Me,_e.svg=xr,_e.svgOverlay=function os(h,x,M){return new Ih(h,x,M)},_e.tileLayer=mr,_e.tooltip=function(h,x){return new cc(h,x)},_e.transformation=Nn,_e.version="1.9.4",_e.videoOverlay=function Od(h,x,M){return new Ou(h,x,M)};var ct=window.L;_e.noConflict=function(){return window.L=ct,this},window.L=_e}($t)},220:Ht=>{var ze=/^\s+|\s+$/g,Te=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,Q=/^0o[0-7]+$/i,Me=parseInt,Pe="object"==typeof global&&global&&global.Object===Object&&global,Se="object"==typeof self&&self&&self.Object===Object&&self,Ae=Pe||Se||Function("return this")(),Zt=Object.prototype.toString,Ft=Math.max,Ct=Math.min,Lt=function(){return Ae.Date.now()};function he(Re){var it=typeof Re;return!!Re&&("object"==it||"function"==it)}function Ue(Re){if("number"==typeof Re)return Re;if(function _t(Re){return"symbol"==typeof Re||function Ye(Re){return!!Re&&"object"==typeof Re}(Re)&&"[object Symbol]"==Zt.call(Re)}(Re))return NaN;if(he(Re)){var it="function"==typeof Re.valueOf?Re.valueOf():Re;Re=he(it)?it+"":it}if("string"!=typeof Re)return 0===Re?Re:+Re;Re=Re.replace(ze,"");var Oe=u.test(Re);return Oe||Q.test(Re)?Me(Re.slice(2),Oe?2:8):Te.test(Re)?NaN:+Re}Ht.exports=function At(Re,it,Oe){var Pt,Gt,It,En,Ii,Ui,jr=0,yr=!1,Cn=!1,bn=!0;if("function"!=typeof Re)throw new TypeError("Expected a function");function Ji(li){var ui=Pt,sn=Gt;return Pt=Gt=void 0,jr=li,En=Re.apply(sn,ui)}function ni(li){var ui=li-Ui;return void 0===Ui||ui>=it||ui<0||Cn&&li-jr>=It}function ji(){var li=Lt();if(ni(li))return Ai(li);Ii=setTimeout(ji,function Mn(li){var Jo=it-(li-Ui);return Cn?Ct(Jo,It-(li-jr)):Jo}(li))}function Ai(li){return Ii=void 0,bn&&Pt?Ji(li):(Pt=Gt=void 0,En)}function $r(){var li=Lt(),ui=ni(li);if(Pt=arguments,Gt=this,Ui=li,ui){if(void 0===Ii)return function un(li){return jr=li,Ii=setTimeout(ji,it),yr?Ji(li):En}(Ui);if(Cn)return Ii=setTimeout(ji,it),Ji(Ui)}return void 0===Ii&&(Ii=setTimeout(ji,it)),En}return it=Ue(it)||0,he(Oe)&&(yr=!!Oe.leading,It=(Cn="maxWait"in Oe)?Ft(Ue(Oe.maxWait)||0,it):It,bn="trailing"in Oe?!!Oe.trailing:bn),$r.cancel=function ri(){void 0!==Ii&&clearTimeout(Ii),jr=0,Pt=Ui=Gt=Ii=void 0},$r.flush=function Tn(){return void 0===Ii?En:Ai(Lt())},$r}},574:function(Ht){Ht.exports=function(){"use strict";var $t,_e,dt;function ze(u,Q){if($t)if(_e){var Me="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+$t+")(sharedChunk); ("+_e+")(sharedChunk); self.onerror = null;",Pe={};$t(Pe),dt=Q(Pe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(dt.workerUrl=window.URL.createObjectURL(new Blob([Me],{type:"text/javascript"})))}else _e=Q;else $t=Q}return ze(0,function(u){var Q=typeof self<"u"?self:{},Me="2.15.0";let Pe;const Se={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Pe){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Pe=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{Pe=o}}return Pe},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Se.API_URL)return null;try{const o=new URL(Se.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ae={supported:!1,testSupport:function(o){!Ft&&Zt&&(Ct?Lt(o):pt=o)}};let pt,Zt,Ft=!1,Ct=!1;function Lt(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Zt),o.isContextLost())return;Ae.supported=!0}catch{}o.deleteTexture(i),Ft=!0}Q.document&&(Zt=Q.document.createElement("img"),Zt.onload=function(){pt&&Lt(pt),pt=null,Ct=!0},Zt.onerror=function(){Ft=!0,pt=null},Zt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const At="01";function he(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Ye=_t;function _t(o,i,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=s,this.p2y=c}_t.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(void 0===i&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var p=this.sampleCurveX(s)-o;if(Math.abs(p)<i)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=p/g}var v=0,w=1;for(s=o,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-o)<i));c++)o>p?v=s:w=s,s=.5*(w-v)+v;return s},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var Ue=he(Ye),Re=it;function it(o,i){this.x=o,this.y=i}it.prototype={clone:function(){return new it(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,s=o.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),s=Math.sin(o),c=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,i){var s=Math.cos(o),c=Math.sin(o),p=i.y+c*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-c*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},it.convert=function(o){return o instanceof it?o:Array.isArray(o)?new it(o[0],o[1]):o};var Oe=he(Re);const Pt=Math.PI/180,Gt=180/Math.PI;function It(o){return o*Pt}function En(o){return o*Gt}const Ii=[[0,0],[1,0],[1,1],[0,1]];function Ui(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,s=i*o;return 4*(o<.5?s:3*(o-i)+s-.75)}function jr(o,i,s,c){const p=new Ue(o,i,s,c);return function(g){return p.solve(g)}}const yr=jr(.25,.1,.25,1);function Cn(o,i,s){return Math.min(s,Math.max(i,o))}function bn(o,i,s){return(s=Cn((s-o)/(i-o),0,1))*s*(3-2*s)}function Ji(o,i,s){const c=s-i,p=((o-i)%c+c)%c+i;return p===i?s:p}function un(o,i,s){if(!o.length)return s(null,[]);let c=o.length;const p=new Array(o.length);let g=null;o.forEach((v,w)=>{i(v,(T,S)=>{T&&(g=T),p[w]=S,0==--c&&s(g,p)})})}function Mn(o){const i=[];for(const s in o)i.push(o[s]);return i}function ni(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}let ji=1;function Ai(){return ji++}function ri(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Tn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function $r(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function li(o,i){o.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function ui(o,i){return-1!==o.indexOf(i,o.length-i.length)}function sn(o,i,s){const c={};for(const p in o)c[p]=i.call(s||this,o[p],p,o);return c}function Jo(o,i,s){const c={};for(const p in o)i.call(s||this,o[p],p,o)&&(c[p]=o[p]);return c}function Nn(o){return Array.isArray(o)?o.map(Nn):"object"==typeof o&&o?sn(o,Nn):o}const Ps={};function Zi(o){Ps[o]||(typeof console<"u"&&console.warn(o),Ps[o]=!0)}function ho(o,i,s){return(s.y-o.y)*(i.x-o.x)>(i.y-o.y)*(s.x-o.x)}function ec(o){let i=0;for(let s,c,p=0,g=o.length,v=g-1;p<g;v=p++)s=o[p],c=o[v],i+=(c.x-s.x)*(s.y+c.y);return i}function Qo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Jr(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,g)=>{const v=p||g;return i[c]=!v||v.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let zc=null;function xl(o){if(null==zc){const i=o.navigator?o.navigator.userAgent:null;zc=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return zc}function bl(o){try{const i=Q[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function da(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}const Ha="mapbox-tiles";let Qr,Rs,tc=500,Bc=50;function fa(){try{return Q.caches}catch{}}function pa(){fa()&&!Qr&&(Qr=Q.caches.open(Ha))}function Ga(o){const i=o.indexOf("?");if(i<0)return o;const c=function(p){const g=p.indexOf("?");return g>0?p.slice(g+1).split("&"):[]}(o).filter(p=>{const g=p.split("=");return"language"===g[0]||"worldview"===g[0]});return c.length?`${o.slice(0,i)}?${c.join("&")}`:o.slice(0,i)}let wl=1/0;const qa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(qa);class eo extends Error{constructor(i,s,c){401===s&&Fe(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ds=Qo()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Q.location.protocol?Q.parent:Q).location.href,ma=function(o,i){if(!(/^file:/.test(s=o.url)||/^file:/.test(ds())&&!/^\w+:/.test(s))){if(Q.fetch&&Q.Request&&Q.AbortController&&Q.Request.prototype.hasOwnProperty("signal"))return function(c,p){const g=new Q.AbortController,v=new Q.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:ds(),referrerPolicy:c.referrerPolicy,signal:g.signal});let w=!1,T=!1;const S=(P=v.url).indexOf("sku=")>0&&Fe(P);var P;"json"===c.type&&v.headers.set("Accept","application/json");const N=(V,j,q)=>{if(T)return;if(V&&"SecurityError"!==V.message&&Zi(V.toString()),j&&q)return F(j);const J=Date.now();Q.fetch(v).then(se=>{if(se.ok){const pe=S?se.clone():null;return F(se,pe,J)}return p(new eo(se.statusText,se.status,c.url))}).catch(se=>{"AbortError"!==se.name&&p(new Error(`${se.message} ${c.url}`))})},F=(V,j,q)=>{("arrayBuffer"===c.type?V.arrayBuffer():"json"===c.type?V.json():V.text()).then(J=>{T||(j&&q&&function(se,pe,ae){if(pa(),!Qr)return;const de={status:pe.status,statusText:pe.statusText,headers:new Q.Headers};pe.headers.forEach(($e,Ve)=>de.headers.set(Ve,$e));const ge=Jr(pe.headers.get("Cache-Control")||"");if(ge["no-store"])return;ge["max-age"]&&de.headers.set("Expires",new Date(ae+1e3*ge["max-age"]).toUTCString());const me=de.headers.get("Expires");me&&(new Date(me).getTime()-ae<42e4||function($e,Ve){if(void 0===Rs)try{new Response(new ReadableStream),Rs=!0}catch{Rs=!1}Rs?Ve($e.body):$e.blob().then(Ve)}(pe,$e=>{const Ve=new Q.Response($e,de);pa(),Qr&&Qr.then(tt=>tt.put(Ga(se.url),Ve)).catch(tt=>Zi(tt.message))}))}(v,j,q),w=!0,p(null,J,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(J=>{T||p(new Error(J.message))})};return S?function(V,j){if(pa(),!Qr)return j(null);const q=Ga(V.url);Qr.then(J=>{J.match(q).then(se=>{const pe=function(ae){if(!ae)return!1;const de=new Date(ae.headers.get("Expires")||0),ge=Jr(ae.headers.get("Cache-Control")||"");return de>Date.now()&&!ge["no-cache"]}(se);J.delete(q),pe&&J.put(q,se.clone()),j(null,se,pe)}).catch(j)}).catch(j)}(v,N):N(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(o,i);if(Qo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var s;return function(c,p){const g=new Q.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(g.responseType="arraybuffer");for(const v in c.headers)g.setRequestHeader(v,c.headers[v]);return"json"===c.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===c.credentials,g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let v=g.response;if("json"===c.type)try{v=JSON.parse(g.response)}catch(w){return p(w)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new eo(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,i)},Za=function(o,i){return ma(ni(o,{type:"arrayBuffer"}),i)};function ga(o){const i=Q.document.createElement("a");return i.href=o,i.protocol===Q.document.location.protocol&&i.host===Q.document.location.host}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Z,Y;Z=[],Y=0;const ue=function(o,i){if(Ae.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Y>=Se.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Z.push(g),g}Y++;let s=!1;const c=()=>{if(!s)for(s=!0,Y--;Z.length&&Y<Se.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Z.shift(),{requestParameters:v,callback:w,cancelled:T}=g;T||(g.cancel=ue(v,w).cancel)}},p=Za(o,(g,v,w,T)=>{c(),g?i(g):v&&(Q.createImageBitmap?function(S,P){const N=new Q.Blob([new Uint8Array(S)],{type:"image/png"});Q.createImageBitmap(N).then(F=>{P(null,F)}).catch(F=>{P(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(S,P)=>i(S,P,w,T)):function(S,P){const N=new Q.Image,F=Q.URL;N.onload=()=>{P(null,N),F.revokeObjectURL(N.src),N.onload=null,Q.requestAnimationFrame(()=>{N.src=fe})},N.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Q.Blob([new Uint8Array(S)],{type:"image/png"});N.src=S.byteLength?F.createObjectURL(V):fe}(v,(S,P)=>i(S,P,w,T)))});return{cancel:()=>{p.cancel(),c()}}},ye="NO_ACCESS_TOKEN";function De(o){return 0===o.indexOf("mapbox:")}function Fe(o){return Se.API_URL_REGEX.test(o)}function Ne(o){return Se.API_CDN_URL_REGEX.test(o)}function Ce(o){return Se.API_STYLE_REGEX.test(o)&&!We(o)}function We(o){return Se.API_SPRITE_REGEX.test(o)}const Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ot(o){const i=o.match(Mt);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function xt(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}const Rn="mapbox.eventData";function Hn(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Q.atob(i[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Fn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=Hn(Se.ACCESS_TOKEN);let c="";return c=s&&s.u?Q.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(+("0x"+g)))):Se.ACCESS_TOKEN||"",i?`${Rn}.${i}:${c}`:`${Rn}:${c}`}fetchEventData(){const i=bl("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const p=Q.localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));const g=Q.localStorage.getItem(c);g&&(this.anonId=g)}catch{Zi("Unable to read from LocalStorage")}}saveEventData(){const i=bl("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{Q.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Q.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{Zi("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,c,p){if(!Se.EVENTS_URL)return;const g=Ot(Se.EVENTS_URL);g.params.push(`access_token=${p||Se.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(i).toISOString()},w=s?ni(v,s):v,T={url:xt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var P;this.pendingRequest=(P=S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(p)},ma(ni(T,{method:"POST"}),P))}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const Dn=new class extends Fn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){Se.EVENTS_URL&&Se.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>De(s)||Fe(s))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Hn(Se.ACCESS_TOKEN),s=i?i.u:Se.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;$r(this.anonId)||(this.anonId=ri(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;c=c||w>=1||w<-1||g.getDate()!==v.getDate()}else c=!0;c?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Me,skuId:At,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=s)},o):this.processRequests()}},Nt=Dn.postTurnstileEvent.bind(Dn),Ni=new class extends Fn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,s,c){this.skuToken=i,this.errorCb=c,Se.EVENTS_URL&&(s||Se.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(ye)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),$r(this.anonId)||(this.anonId=ri()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Me,skuId:At,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o))}},lr=Ni.postMapLoadEvent.bind(Ni),wi=new class extends Fn{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){Se.EVENTS_URL&&(o||Se.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:s}=this.queue.shift(),c=function(p){const g=Q.performance.getEntriesByType("resource"),v=Q.performance.getEntriesByType("mark"),w=function(F){const V={};if(F)for(const j in F)if("other"!==j)for(const q of F[j]){const J=`${j}ResolveRangeMin`,se=`${j}ResolveRangeMax`,pe=`${j}RequestCount`,ae=`${j}RequestCachedCount`;V[J]=Math.min(V[J]||1/0,q.startTime),V[se]=Math.max(V[se]||-1/0,q.responseEnd);const de=ge=>{void 0===V[ge]&&(V[ge]=0),++V[ge]};void 0!==q.transferSize&&0===q.transferSize&&de(ae),de(pe)}return V}(function(F,V){const j={};if(F)for(const q of F){const J=V(q);void 0===j[J]&&(j[J]=[]),j[J].push(q)}return j}(g,Ch)),T=Q.devicePixelRatio,S=Q.navigator.connection||Q.navigator.mozConnection||Q.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},N=(F,V,j)=>{null!=j&&F.push({name:V,value:j.toString()})};for(const F in w)N(P.counters,F,w[F]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(N(P.counters,"interactionRangeMin",p.interactionRange[0]),N(P.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const F of Object.keys(_a)){const V=_a[F],j=v.find(q=>q.name===V);j&&N(P.counters,V,j.startTime)}return N(P.counters,"visibilityHidden",p.visibilityHidden),N(P.attributes,"style",function(F){if(F)for(const V of F){const j=V.name.split("?")[0];if(Ce(j)){const q=j.split("/").slice(-2);if(2===q.length)return`mapbox://styles/${q[0]}/${q[1]}`}}}(g)),N(P.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),N(P.attributes,"fogEnabled",p.fogEnabled?"true":"false"),N(P.attributes,"projection",p.projection),N(P.attributes,"zoom",p.zoom),N(P.metadata,"devicePixelRatio",T),N(P.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),N(P.metadata,"navigatorUserAgent",Q.navigator.userAgent),N(P.metadata,"screenWidth",Q.screen.width),N(P.metadata,"screenHeight",Q.screen.height),N(P.metadata,"windowWidth",Q.innerWidth),N(P.metadata,"windowHeight",Q.innerHeight),N(P.metadata,"mapWidth",p.width/T),N(P.metadata,"mapHeight",p.height/T),N(P.metadata,"webglRenderer",p.renderer),N(P.metadata,"webglVendor",p.vendor),N(P.metadata,"sdkVersion",Me),N(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(s);for(const p of c.metadata);for(const p of c.counters);for(const p of c.attributes);this.postEvent(i,c,()=>{},o)}},vr=wi.postPerformanceEvent.bind(wi),zo=new class extends Fn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,s,c){if(!Se.API_URL||!Se.SESSION_PATH)return;const p=Ot(Se.API_URL+Se.SESSION_PATH);p.params.push(`sku=${i||""}`),p.params.push(`access_token=${c||Se.ACCESS_TOKEN||""}`);const g={url:xt(p),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(c)},ma(ni(g,{method:"GET"}),w))}getSessionAPI(o,i,s,c){this.skuToken=i,this.errorCb=c,Se.SESSION_PATH&&Se.API_URL&&(s||Se.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(ye)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o)}},Ir=zo.getSessionAPI.bind(zo),wr=new Set,_a={create:"create",load:"load",fullLoad:"fullLoad"},Pd={mark(o){Q.performance.mark(o)},measure(o,i,s){Q.performance.measure(o,i,s)}};function Ch(o){const i=o.name.split("?")[0];return Ne(i)&&i.includes("mapbox-gl.js")?"javascript":Ne(i)&&i.includes("mapbox-gl.css")?"css":Se.API_FONTS_REGEX.test(i)?"fontRange":We(i)?"sprite":Ce(i)?"style":Se.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const Xn=Q.performance;function Du(o){const i=o?o.url.toString():void 0;return Xn.getEntriesByName(i)}let fr,ya,to,Ls;const ks={now:()=>void 0!==to?to:Q.performance.now(),setNow(o){to=o},restoreNow(){to=void 0},frame(o){const i=Q.requestAnimationFrame(o);return{cancel:()=>Q.cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:s,height:c}=o;Ls||(Ls=Q.document.createElement("canvas"));const p=Ls.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(s>Ls.width||c>Ls.height)&&(Ls.width=s,Ls.height=c),p.clearRect(-i,-i,s+2*i,c+2*i),p.drawImage(o,0,0,s,c),p.getImageData(-i,-i,s+2*i,c+2*i)},resolveURL:o=>(fr||(fr=Q.document.createElement("a")),fr.href=o,fr.href),get devicePixelRatio(){return Q.devicePixelRatio},get prefersReducedMotion(){return!!Q.matchMedia&&(null==ya&&(ya=Q.matchMedia("(prefers-reduced-motion: reduce)")),ya.matches)}};function Mu(o,i,s){s[o]&&-1!==s[o].indexOf(i)||(s[o]=s[o]||[],s[o].push(i))}function nc(o,i,s){if(s&&s[o]){const c=s[o].indexOf(i);-1!==c&&s[o].splice(c,1)}}class va{constructor(i,s={}){ni(this,s),this.type=i}}class fo extends va{constructor(i,s={}){super("error",ni({error:i},s))}}class Os{on(i,s){return this._listeners=this._listeners||{},Mu(i,s,this._listeners),this}off(i,s){return nc(i,s,this._listeners),nc(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Mu(i,s,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,s){"string"==typeof i&&(i=new va(i,s||{}));const c=i.type;if(this.listens(c)){i.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of g)nc(c,w,this._oneTimeListeners),w.call(this,i);const v=this._eventedParent;v&&(ni(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(i))}else i instanceof fo&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}var Je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function es(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}function Wi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ln(o){if(Array.isArray(o))return o.map(Ln);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const s in o)i[s]=Ln(o[s]);return i}return Wi(o)}class Qi extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}var Do=Qi;class Ns{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(i){return new Ns(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Wa=Ns;const xa={kind:"null"},et={kind:"number"},gn={kind:"string"},fn={kind:"boolean"},dn={kind:"color"},er={kind:"object"},Gn={kind:"value"},$i={kind:"collator"},ts={kind:"formatted"},Hi={kind:"resolvedImage"};function Un(o,i){return{kind:"array",itemType:o,N:i}}function di(o){if("array"===o.kind){const i=di(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const tr=[xa,et,gn,fn,dn,ts,er,Un(Gn),Hi];function Mo(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!Mo(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const s of tr)if(!Mo(s,i))return null}return`Expected ${di(o)} but found ${di(i)} instead.`}function Fs(o,i){return i.some(s=>s.kind===o.kind)}function yi(o,i){return i.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}var Sn,Xa={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function zs(o){return(o=Math.round(o))<0?0:o>255?255:o}function El(o){return zs("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function ba(o){return(i="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function Et(o,i,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(i-o)*s*6:2*s<1?i:3*s<2?o+(i-o)*(2/3-s)*6:o}try{Sn={}.parseCSSColor=function(o){var i,s=o.replace(/ /g,"").toLowerCase();if(s in Xa)return Xa[s].slice();if("#"===s[0])return 4===s.length?(i=parseInt(s.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===s.length&&(i=parseInt(s.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var c=s.indexOf("("),p=s.indexOf(")");if(-1!==c&&p+1===s.length){var g=s.substr(0,c),v=s.substr(c+1,p-(c+1)).split(","),w=1;switch(g){case"rgba":if(4!==v.length)return null;w=ba(v.pop());case"rgb":return 3!==v.length?null:[El(v[0]),El(v[1]),El(v[2]),w];case"hsla":if(4!==v.length)return null;w=ba(v.pop());case"hsl":if(3!==v.length)return null;var T=(parseFloat(v[0])%360+360)%360/360,S=ba(v[1]),P=ba(v[2]),N=P<=.5?P*(S+1):P+S-P*S,F=2*P-N;return[zs(255*Et(F,N,T+1/3)),zs(255*Et(F,N,T)),zs(255*Et(F,N,T-1/3)),w];default:return null}}return null}}catch{}class Ar{constructor(i,s,c,p=1){this.r=i,this.g=s,this.b=c,this.a=p}static parse(i){if(!i)return;if(i instanceof Ar)return i;if("string"!=typeof i)return;const s=Sn(i);return s?new Ar(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[i,s,c,p]=this.toArray();return`rgba(${Math.round(i)},${Math.round(s)},${Math.round(c)},${p})`}toArray(){const{r:i,g:s,b:c,a:p}=this;return 0===p?[0,0,0,0]:[255*i/p,255*s/p,255*c/p,p]}toArray01(){const{r:i,g:s,b:c,a:p}=this;return 0===p?[0,0,0,0]:[i/p,s/p,c/p,p]}toArray01PremultipliedAlpha(){const{r:i,g:s,b:c,a:p}=this;return[i,s,c,p]}}Ar.black=new Ar(0,0,0,1),Ar.white=new Ar(1,1,1,1),Ar.transparent=new Ar(0,0,0,0),Ar.red=new Ar(1,0,0,1),Ar.blue=new Ar(0,0,1,1);var an=Ar;class nn{constructor(i,s,c){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bo{constructor(i,s,c,p,g){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=c,this.fontStack=p,this.textColor=g}}class ii{constructor(i){this.sections=i}static fromString(i){return new ii([new Bo(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof ii?i:ii.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){i.push(["image",s.image.name]);continue}i.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),i.push(c)}return i}}class So{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new So({name:i,available:!1}):null}serialize(){return["image",this.name]}}function Cl(o,i,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,i,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,i,s,c]:[o,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pr(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof an||o instanceof nn||o instanceof ii||o instanceof So)return!0;if(Array.isArray(o)){for(const i of o)if(!Pr(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!Pr(o[i]))return!1;return!0}return!1}function nr(o){if(null===o)return xa;if("string"==typeof o)return gn;if("boolean"==typeof o)return fn;if("number"==typeof o)return et;if(o instanceof an)return dn;if(o instanceof nn)return $i;if(o instanceof ii)return ts;if(o instanceof So)return Hi;if(Array.isArray(o)){const i=o.length;let s;for(const c of o){const p=nr(c);if(s){if(s===p)continue;s=Gn;break}s=p}return Un(s||Gn,i)}return er}function ns(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof an||o instanceof ii||o instanceof So?o.toString():JSON.stringify(o)}class Vc{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(2!==i.length)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Pr(i[1]))return s.error("invalid value");const c=i[1];let p=nr(c);const g=s.expectedType;return"array"!==p.kind||0!==p.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(p=g),new Vc(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof an?["rgba"].concat(this.value.toArray()):this.value instanceof ii?this.value.serialize():this.value}}var Hr=Vc,vi=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const wa={string:gn,number:et,boolean:fn,object:er};class Su{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let c,p=1;const g=i[0];if("array"===g){let w,T;if(i.length>2){const S=i[1];if("string"!=typeof S||!(S in wa)||"object"===S)return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=wa[S],p++}else w=Gn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=i[2],p++}c=Un(w,T)}else c=wa[g];const v=[];for(;p<i.length;p++){const w=s.parse(i[p],p,Gn);if(!w)return null;v.push(w)}return new Su(c,v)}evaluate(i){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(i);if(!Mo(this.type,nr(c)))return c;if(s===this.args.length-1)throw new vi(`Expected value to be of type ${di(this.type)}, but found ${di(nr(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const p=i.N;("number"==typeof p||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(c=>c.serialize()))}}var Bs=Su;class Ea{constructor(i){this.type=ts,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=i.length-1;++v){const w=i[v];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=s.parse(w["font-scale"],1,et),!T))return null;let S=null;if(w["text-font"]&&(S=s.parse(w["text-font"],1,Un(gn)),!S))return null;let P=null;if(w["text-color"]&&(P=s.parse(w["text-color"],1,dn),!P))return null;const N=p[p.length-1];N.scale=T,N.font=S,N.textColor=P}else{const T=s.parse(i[v],1,Gn);if(!T)return null;const S=T.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new Ea(p)}evaluate(i){return new ii(this.sections.map(s=>{const c=s.content.evaluate(i);return nr(c)===Hi?new Bo("",c,null,null,null):new Bo(ns(c),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),i.push(c)}return i}}class Uc{constructor(i){this.type=Hi,this.input=i}static parse(i,s){if(2!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,gn);return c?new Uc(c):s.error("No image name provided.")}evaluate(i){const s=this.input.evaluate(i),c=So.fromString(s);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(s)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Iu={"to-boolean":fn,"to-color":dn,"to-number":et,"to-string":gn};class Th{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return s.error("Expected one argument.");const p=Iu[c],g=[];for(let v=1;v<i.length;v++){const w=s.parse(i[v],v,Gn);if(!w)return null;g.push(w)}return new Th(p,g)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let s,c;for(const p of this.args){if(s=p.evaluate(i),c=null,s instanceof an)return s;if("string"==typeof s){const g=i.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Cl(s[0],s[1],s[2],s[3]),!c))return new an(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new vi(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(i),null===s)return 0;const p=Number(s);if(!isNaN(p))return p}throw new vi(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?ii.fromString(ns(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?So.fromString(ns(this.args[0].evaluate(i))):ns(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ea([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Uc(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Fr=Th;const Bt=["Unknown","Point","LineString","Polygon"];var Dh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Bt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-o[0])+this.featureDistanceData.bearing[1]*(c*i-o[1])}return 0}parseColor(o){let i=this._parseColorCache[o];return i||(i=this._parseColorCache[o]=an.parse(o)),i}};class no{constructor(i,s,c,p){this.name=i,this.type=s,this._evaluate=c,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const c=i[0],p=no.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=v.filter(([S])=>!Array.isArray(S)||S.length===i.length-1);let T=null;for(const[S,P]of w){T=new Ma(s.registry,s.path,null,s.scope);const N=[];let F=!1;for(let V=1;V<i.length;V++){const j=i[V],q=Array.isArray(S)?S[V-1]:S.type,J=T.parse(j,1+N.length,q);if(!J){F=!0;break}N.push(J)}if(!F)if(Array.isArray(S)&&S.length!==N.length)T.error(`Expected ${S.length} arguments, but found ${N.length} instead.`);else{for(let V=0;V<N.length;V++){const j=Array.isArray(S)?S[V]:S.type,q=N[V];T.concat(V+1).checkSubtype(j,q.type)}if(0===T.errors.length)return new no(c,g,P,N)}}if(1===w.length)s.errors.push(...T.errors);else{const S=(w.length?w:v).map(([N])=>{return F=N,Array.isArray(F)?`(${F.map(di).join(", ")})`:`(${di(F.type)}...)`;var F}).join(" | "),P=[];for(let N=1;N<i.length;N++){const F=s.parse(i[N],1+P.length);if(!F)return null;P.push(di(F.type))}s.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(i,s){no.definitions=s;for(const c in s)i[c]=no}}var Vo=no;class on{constructor(i,s,c){this.type=$i,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(2!==i.length)return s.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,fn);if(!p)return null;const g=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,fn);if(!g)return null;let v=null;return c.locale&&(v=s.parse(c.locale,1,gn),!v)?null:new on(p,g,v)}evaluate(i){return new nn(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Ca=8192;function Rr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Vs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Tl(o,i){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(s*p*Ca),Math.round(c*p*Ca)]}function Au(o,i,s){const c=o[0]-i[0],p=o[1]-i[1],g=o[0]-s[0],v=o[1]-s[1];return c*v-g*p==0&&c*g<=0&&p*v<=0}function jc(o,i){let s=!1;for(let v=0,w=i.length;v<w;v++){const T=i[v];for(let S=0,P=T.length;S<P-1;S++){if(Au(o,T[S],T[S+1]))return!1;(p=T[S])[1]>(c=o)[1]!=(g=T[S+1])[1]>c[1]&&c[0]<(g[0]-p[0])*(c[1]-p[1])/(g[1]-p[1])+p[0]&&(s=!s)}}var c,p,g;return s}function Ta(o,i){for(let s=0;s<i.length;s++)if(jc(o,i[s]))return!0;return!1}function Dl(o,i,s,c){const p=c[0]-s[0],g=c[1]-s[1],v=(o[0]-s[0])*g-p*(o[1]-s[1]),w=(i[0]-s[0])*g-p*(i[1]-s[1]);return v>0&&w<0||v<0&&w>0}function Gr(o,i,s){for(const S of s)for(let P=0;P<S.length-1;++P)if((w=[(v=S[P+1])[0]-(g=S[P])[0],v[1]-g[1]])[0]*(T=[(p=i)[0]-(c=o)[0],p[1]-c[1]])[1]-w[1]*T[0]!=0&&Dl(c,p,g,v)&&Dl(g,v,c,p))return!0;var c,p,g,v,w,T;return!1}function ci(o,i){for(let s=0;s<o.length;++s)if(!jc(o[s],i))return!1;for(let s=0;s<o.length-1;++s)if(Gr(o[s],o[s+1],i))return!1;return!0}function Mh(o,i){for(let s=0;s<i.length;s++)if(ci(o,i[s]))return!0;return!1}function jn(o,i,s){const c=[];for(let p=0;p<o.length;p++){const g=[];for(let v=0;v<o[p].length;v++){const w=Tl(o[p][v],s);Rr(i,w),g.push(w)}c.push(g)}return c}function ic(o,i,s){const c=[];for(let p=0;p<o.length;p++){const g=jn(o[p],i,s);c.push(g)}return c}function rc(o,i,s,c){if(o[0]<s[0]||o[0]>s[2]){const p=.5*c;let g=o[0]-s[0]>p?-c:s[0]-o[0]>p?c:0;0===g&&(g=o[0]-s[2]>p?-c:s[2]-o[0]>p?c:0),o[0]+=g}Rr(i,o)}function qr(o,i,s,c){const p=Math.pow(2,c.z)*Ca,g=[c.x*Ca,c.y*Ca],v=[];if(!o)return v;for(const w of o)for(const T of w){const S=[T.x+g[0],T.y+g[1]];rc(S,i,s,p),v.push(S)}return v}function $c(o,i,s,c){const p=Math.pow(2,c.z)*Ca,g=[c.x*Ca,c.y*Ca],v=[];if(!o)return v;for(const T of o){const S=[];for(const P of T){const N=[P.x+g[0],P.y+g[1]];Rr(i,N),S.push(N)}v.push(S)}if(i[2]-i[0]<=p/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of v)for(const S of T)rc(S,i,s,p)}var w;return v}class Ml{constructor(i,s){this.type=fn,this.geojson=i,this.geometries=s}static parse(i,s){if(2!==i.length)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Pr(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let p=0;p<c.features.length;++p){const g=c.features[p].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Ml(c,c.features[p].geometry)}else if("Feature"===c.type){const p=c.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Ml(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new Ml(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if("Polygon"===c.type){const w=jn(c.coordinates,g,v),T=qr(s.geometry(),p,g,v);if(!Vs(p,g))return!1;for(const S of T)if(!jc(S,w))return!1}if("MultiPolygon"===c.type){const w=ic(c.coordinates,g,v),T=qr(s.geometry(),p,g,v);if(!Vs(p,g))return!1;for(const S of T)if(!Ta(S,w))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if("Polygon"===c.type){const w=jn(c.coordinates,g,v),T=$c(s.geometry(),p,g,v);if(!Vs(p,g))return!1;for(const S of T)if(!ci(S,w))return!1}if("MultiPolygon"===c.type){const w=ic(c.coordinates,g,v),T=$c(s.geometry(),p,g,v);if(!Vs(p,g))return!1;for(const S of T)if(!Mh(S,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var bi=Ml;function oc(o){if(o instanceof Vo&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof bi)return!1;let i=!0;return o.eachChild(s=>{i&&!oc(s)&&(i=!1)}),i}function Da(o){if(o instanceof Vo&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(s=>{i&&!Da(s)&&(i=!1)}),i}function qt(o,i){if(o instanceof Vo&&i.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!qt(c,i)&&(s=!1)}),s}class Sl{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(2!==i.length||"string"!=typeof i[1])return s.error("'var' expression requires exactly one string literal argument.");const c=i[1];return s.scope.has(c)?new Sl(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var sc=Sl;class Ya{constructor(i,s=[],c,p=new Wa,g=[]){this.registry=i,this.path=s,this.key=s.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=c}parse(i,s,c,p,g={}){return s?this.concat(s,c,p)._parse(i,g):this._parse(i,g)}_parse(i,s){function c(p,g,v){return"assert"===v?new Bs(g,[p]):"coerce"===v?new Fr(g,[p]):p}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(i,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,T=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else v=c(v,w,s.typeAnnotation||"coerce");else v=c(v,w,s.typeAnnotation||"assert")}if(!(v instanceof Hr)&&"resolvedImage"!==v.type.kind&&Us(v)){const w=new Dh;try{v=new Hr(v.type,v.evaluate(w))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,c){const p="number"==typeof i?this.path.concat(i):this.path,g=c?this.scope.concat(c):this.scope;return new Ya(this.registry,p,s||null,g,this.errors)}error(i,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Do(c,i))}checkSubtype(i,s){const c=Mo(i,s);return c&&this.error(c),c}}var Ma=Ya;function Us(o){if(o instanceof sc)return Us(o.boundExpression);if(o instanceof Vo&&"error"===o.name||o instanceof on||o instanceof bi)return!1;const i=o instanceof Fr||o instanceof Bs;let s=!0;return o.eachChild(c=>{s=i?s&&Us(c):s&&c instanceof Hr}),!!s&&oc(o)&&qt(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Il(o,i){const s=o.length-1;let c,p,g=0,v=s,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),c=o[w],p=o[w+1],c<=i){if(w===s||i<p)return w;g=w+1}else{if(!(c>i))throw new vi("Input is not a number.");v=w-1}return 0}class Ka{constructor(i,s,c){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[p,g]of c)this.labels.push(p),this.outputs.push(g)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(i[1],1,et);if(!c)return null;const p=[];let g=null;s.expectedType&&"value"!==s.expectedType.kind&&(g=s.expectedType);for(let v=1;v<i.length;v+=2){const w=1===v?-1/0:i[v],T=i[v+1],S=v,P=v+1;if("number"!=typeof w)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const N=s.parse(T,P,g);if(!N)return null;g=g||N.type,p.push([w,N])}return new Ka(g,c,p)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=s[0])return c[0].evaluate(i);const g=s.length;return p>=s[g-1]?c[g-1].evaluate(i):c[Il(s,p)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}var Io=Ka;function oi(o,i,s){return o*(1-s)+i*s}var ac=Object.freeze({__proto__:null,array:function(o,i,s){return o.map((c,p)=>oi(c,i[p],s))},color:function(o,i,s){return new an(oi(o.r,i.r,s),oi(o.g,i.g,s),oi(o.b,i.b,s),oi(o.a,i.a,s))},number:oi});const Al=4/29,fs=6/29,Pu=3*fs*fs,Sh=fs*fs*fs,Ld=Math.PI/180,Uo=180/Math.PI;function Ao(o){return o>Sh?Math.pow(o,1/3):o/Pu+Al}function Ru(o){return o>fs?o*o*o:Pu*(o-Al)}function zr(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Hc(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function rn(o){const i=Hc(o.r),s=Hc(o.g),c=Hc(o.b),p=Ao((.4124564*i+.3575761*s+.1804375*c)/.95047),g=Ao((.2126729*i+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-Ao((.0193339*i+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function Lu(o){let i=(o.l+16)/116,s=isNaN(o.a)?i:i+o.a/500,c=isNaN(o.b)?i:i-o.b/200;return i=1*Ru(i),s=.95047*Ru(s),c=1.08883*Ru(c),new an(zr(3.2404542*s-1.5371385*i-.4985314*c),zr(-.969266*s+1.8760108*i+.041556*c),zr(.0556434*s-.2040259*i+1.0572252*c),o.alpha)}function Qt(o,i,s){const c=i-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const $s={forward:rn,reverse:Lu,interpolate:function(o,i,s){return{l:oi(o.l,i.l,s),a:oi(o.a,i.a,s),b:oi(o.b,i.b,s),alpha:oi(o.alpha,i.alpha,s)}}},is={forward:function(o){const{l:i,a:s,b:c}=rn(o),p=Math.atan2(c,s)*Uo;return{h:p<0?p+360:p,c:Math.sqrt(s*s+c*c),l:i,alpha:o.a}},reverse:function(o){const i=o.h*Ld,s=o.c;return Lu({l:o.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:o.alpha})},interpolate:function(o,i,s){return{h:Qt(o.h,i.h,s),c:oi(o.c,i.c,s),l:oi(o.l,i.l,s),alpha:oi(o.alpha,i.alpha,s)}}};var Ja=Object.freeze({__proto__:null,hcl:is,lab:$s});class jo{constructor(i,s,c,p,g){this.type=i,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(i,s,c,p){let g=0;if("exponential"===i.name)g=Pl(s,i.base,c,p);else if("linear"===i.name)g=Pl(s,1,c,p);else if("cubic-bezier"===i.name){const v=i.controlPoints;g=new Ue(v[0],v[1],v[2],v[3]).solve(Pl(s,1,c,p))}return g}static parse(i,s){let[c,p,g,...v]=i;if(!Array.isArray(p)||0===p.length)return s.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const S=p[1];if("number"!=typeof S)return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if("cubic-bezier"!==p[0])return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(4!==S.length||S.some(P=>"number"!=typeof P||P<0||P>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,et),!g)return null;const w=[];let T=null;"interpolate-hcl"===c||"interpolate-lab"===c?T=dn:s.expectedType&&"value"!==s.expectedType.kind&&(T=s.expectedType);for(let S=0;S<v.length;S+=2){const P=v[S],N=v[S+1],F=S+3,V=S+4;if("number"!=typeof P)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=P)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const j=s.parse(N,V,T);if(!j)return null;T=T||j.type,w.push([P,j])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new jo(T,c,p,g,w):s.error(`Type ${di(T)} is not interpolatable.`)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=s[0])return c[0].evaluate(i);const g=s.length;if(p>=s[g-1])return c[g-1].evaluate(i);const v=Il(s,p),w=jo.interpolationFactor(this.interpolation,p,s[v],s[v+1]),T=c[v].evaluate(i),S=c[v+1].evaluate(i);return"interpolate"===this.operator?ac[this.type.kind.toLowerCase()](T,S,w):"interpolate-hcl"===this.operator?is.reverse(is.interpolate(is.forward(T),is.forward(S),w)):$s.reverse($s.interpolate($s.forward(T),$s.forward(S),w))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Pl(o,i,s,c){const p=c-s,g=o-s;return 0===p?0:1===i?g/p:(Math.pow(i,g)-1)/(Math.pow(i,p)-1)}var ps=jo;class xo{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&"value"!==p.kind&&(c=p);const g=[];for(const w of i.slice(1)){const T=s.parse(w,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,g.push(T)}const v=p&&g.some(w=>Mo(p,w.type));return new xo(v?Gn:c,g)}evaluate(i){let s,c=null,p=0;for(const g of this.args){if(p++,c=g.evaluate(i),c&&c instanceof So&&!c.available&&(s||(s=c),c=null,p===this.args.length))return s;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Rl=xo;class pr{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let g=1;g<i.length-1;g+=2){const v=i[g];if("string"!=typeof v)return s.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=s.parse(i[g+1],g+1);if(!w)return null;c.push([v,w])}const p=s.parse(i[i.length-1],i.length-1,s.expectedType,c);return p?new pr(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,c]of this.bindings)i.push(s,c.serialize());return i.push(this.result.serialize()),i}}var rs=pr;class Qn{constructor(i,s,c){this.type=i,this.index=s,this.input=c}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,et),p=s.parse(i[2],2,Un(s.expectedType||Gn));return c&&p?new Qn(p.type.itemType,c,p):null}evaluate(i){const s=this.index.evaluate(i),c=this.input.evaluate(i);if(s<0)throw new vi(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new vi(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new vi(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gc=Qn;class Po{constructor(i,s){this.type=fn,this.needle=i,this.haystack=s}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Gn),p=s.parse(i[2],2,Gn);return c&&p?Fs(c.type,[fn,gn,et,xa,Gn])?new Po(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(c.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!yi(s,["boolean","string","number","null"]))throw new vi(`Expected first argument to be of type boolean, string, number or null, but found ${di(nr(s))} instead.`);if(!yi(c,["string","array"]))throw new vi(`Expected second argument to be of type array or string, but found ${di(nr(c))} instead.`);return c.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Hs=Po;class Qa{constructor(i,s,c){this.type=et,this.needle=i,this.haystack=s,this.fromIndex=c}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Gn),p=s.parse(i[2],2,Gn);if(!c||!p)return null;if(!Fs(c.type,[fn,gn,et,xa,Gn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(c.type)} instead`);if(4===i.length){const g=s.parse(i[3],3,et);return g?new Qa(c,p,g):null}return new Qa(c,p)}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!yi(s,["boolean","string","number","null"]))throw new vi(`Expected first argument to be of type boolean, string, number or null, but found ${di(nr(s))} instead.`);if(!yi(c,["string","array"]))throw new vi(`Expected second argument to be of type array or string, but found ${di(nr(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var $o=Qa;class ms{constructor(i,s,c,p,g,v){this.inputType=i,this.type=s,this.input=c,this.cases=p,this.outputs=g,this.otherwise=v}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);const g={},v=[];for(let S=2;S<i.length-1;S+=2){let P=i[S];const N=i[S+1];Array.isArray(P)||(P=[P]);const F=s.concat(S);if(0===P.length)return F.error("Expected at least one branch label.");for(const j of P){if("number"!=typeof j&&"string"!=typeof j)return F.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return F.error("Numeric branch labels must be integer values.");if(c){if(F.checkSubtype(c,nr(j)))return null}else c=nr(j);if(void 0!==g[String(j)])return F.error("Branch labels must be unique.");g[String(j)]=v.length}const V=s.parse(N,S,p);if(!V)return null;p=p||V.type,v.push(V)}const w=s.parse(i[1],1,Gn);if(!w)return null;const T=s.parse(i[i.length-1],i.length-1,p);return T?"value"!==w.type.kind&&s.concat(1).checkSubtype(c,w.type)?null:new ms(c,p,w,g,v,T):null}evaluate(i){const s=this.input.evaluate(i);return(nr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],p={};for(const v of s){const w=p[this.cases[v]];void 0===w?(p[this.cases[v]]=c.length,c.push([this.cases[v],[v]])):c[w][1].push(v)}const g=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of c)i.push(1===w.length?g(w[0]):w.map(g)),i.push(this.outputs[v].serialize());return i.push(this.otherwise.serialize()),i}}var qc=ms;class el{constructor(i,s,c){this.type=i,this.branches=s,this.otherwise=c}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const p=[];for(let v=1;v<i.length-1;v+=2){const w=s.parse(i[v],v,fn);if(!w)return null;const T=s.parse(i[v+1],v+1,c);if(!T)return null;p.push([w,T]),c=c||T.type}const g=s.parse(i[i.length-1],i.length-1,c);return g?new el(c,p,g):null}evaluate(i){for(const[s,c]of this.branches)if(s.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,c]of this.branches)i(s),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Gs=el;class qs{constructor(i,s,c,p){this.type=i,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Gn),p=s.parse(i[2],2,et);if(!c||!p)return null;if(!Fs(c.type,[Un(Gn),gn,Gn]))return s.error(`Expected first argument to be of type array or string, but found ${di(c.type)} instead`);if(4===i.length){const g=s.parse(i[3],3,et);return g?new qs(c.type,c,p,g):null}return new qs(c.type,c,p)}evaluate(i){const s=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!yi(s,["string","array"]))throw new vi(`Expected first argument to be of type array or string, but found ${di(nr(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return s.slice(c,p)}return s.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var lc=qs;function Zs(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function ku(o,i,s,c){return 0===c.compare(i,s)}function gs(o,i,s){const c="=="!==o&&"!="!==o;return class u2{constructor(g,v,w){this.type=fn,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}static parse(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");const w=g[0];let T=v.parse(g[1],1,Gn);if(!T)return null;if(!Zs(w,T.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${di(T.type)}'.`);let S=v.parse(g[2],2,Gn);if(!S)return null;if(!Zs(w,S.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${di(S.type)}'.`);if(T.type.kind!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return v.error(`Cannot compare types '${di(T.type)}' and '${di(S.type)}'.`);c&&("value"===T.type.kind&&"value"!==S.type.kind?T=new Bs(S.type,[T]):"value"!==T.type.kind&&"value"===S.type.kind&&(S=new Bs(T.type,[S])));let P=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(g[3],3,$i),!P)return null}return new u2(T,S,P)}evaluate(g){const v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const T=nr(v),S=nr(w);if(T.kind!==S.kind||"string"!==T.kind&&"number"!==T.kind)throw new vi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=nr(v),S=nr(w);if("string"!==T.kind||"string"!==S.kind)return i(g,v,w)}return this.collator?s(g,v,w,this.collator.evaluate(g)):i(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(v=>{g.push(v.serialize())}),g}}}const kd=gs("==",function(o,i,s){return i===s},ku),Ou=gs("!=",function(o,i,s){return i!==s},function(o,i,s,c){return!ku(0,i,s,c)}),Od=gs("<",function(o,i,s){return i<s},function(o,i,s,c){return c.compare(i,s)<0}),Ih=gs(">",function(o,i,s){return i>s},function(o,i,s,c){return c.compare(i,s)>0}),os=gs("<=",function(o,i,s){return i<=s},function(o,i,s,c){return c.compare(i,s)<=0}),ss=gs(">=",function(o,i,s){return i>=s},function(o,i,s,c){return c.compare(i,s)>=0});class Sa{constructor(i,s,c,p,g,v){this.type=gn,this.number=i,this.locale=s,this.currency=c,this.unit=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,s){if(3!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,et);if(!c)return null;const p=i[2];if("object"!=typeof p||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=s.parse(p.locale,1,gn),!g))return null;let v=null;if(p.currency&&(v=s.parse(p.currency,1,gn),!v))return null;let w=null;if(p.unit&&(w=s.parse(p.unit,1,gn),!w))return null;let T=null;if(p["min-fraction-digits"]&&(T=s.parse(p["min-fraction-digits"],1,et),!T))return null;let S=null;return p["max-fraction-digits"]&&(S=s.parse(p["max-fraction-digits"],1,et),!S)?null:new Sa(c,g,v,w,T,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Ll{constructor(i){this.type=et,this.input=i}static parse(i,s){if(2!==i.length)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=s.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${di(c.type)} instead.`):new Ll(c):null}evaluate(i){const s=this.input.evaluate(i);if("string"==typeof s||Array.isArray(s))return s.length;throw new vi(`Expected value to be of type string or array, but found ${di(nr(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}const cc={"==":kd,"!=":Ou,">":Ih,"<":Od,">=":ss,"<=":os,array:Bs,at:Gc,boolean:Bs,case:Gs,coalesce:Rl,collator:on,format:Ea,image:Uc,in:Hs,"index-of":$o,interpolate:ps,"interpolate-hcl":ps,"interpolate-lab":ps,length:Ll,let:rs,literal:Hr,match:qc,number:Bs,"number-format":Sa,object:Bs,slice:lc,step:Io,string:Bs,"to-boolean":Fr,"to-color":Fr,"to-number":Fr,"to-string":Fr,var:sc,within:bi};function Ah(o,[i,s,c,p]){i=i.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const g=p?p.evaluate(o):1,v=Cl(i,s,c,g);if(v)throw new vi(v);return new an(i/255*g,s/255*g,c/255*g,g)}function _s(o,i){return o in i}function uc(o,i){const s=i[o];return void 0===s?null:s}function io(o){return{type:o}}Vo.register(cc,{error:[{kind:"error"},[gn],(o,[i])=>{throw new vi(i.evaluate(o))}],typeof:[gn,[Gn],(o,[i])=>di(nr(i.evaluate(o)))],"to-rgba":[Un(et,4),[dn],(o,[i])=>i.evaluate(o).toArray()],rgb:[dn,[et,et,et],Ah],rgba:[dn,[et,et,et,et],Ah],has:{type:fn,overloads:[[[gn],(o,[i])=>_s(i.evaluate(o),o.properties())],[[gn,er],(o,[i,s])=>_s(i.evaluate(o),s.evaluate(o))]]},get:{type:Gn,overloads:[[[gn],(o,[i])=>uc(i.evaluate(o),o.properties())],[[gn,er],(o,[i,s])=>uc(i.evaluate(o),s.evaluate(o))]]},"feature-state":[Gn,[gn],(o,[i])=>uc(i.evaluate(o),o.featureState||{})],properties:[er,[],o=>o.properties()],"geometry-type":[gn,[],o=>o.geometryType()],id:[Gn,[],o=>o.id()],zoom:[et,[],o=>o.globals.zoom],pitch:[et,[],o=>o.globals.pitch||0],"distance-from-center":[et,[],o=>o.distanceFromCenter()],"heatmap-density":[et,[],o=>o.globals.heatmapDensity||0],"line-progress":[et,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[et,[],o=>o.globals.skyRadialProgress||0],accumulated:[Gn,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[et,io(et),(o,i)=>{let s=0;for(const c of i)s+=c.evaluate(o);return s}],"*":[et,io(et),(o,i)=>{let s=1;for(const c of i)s*=c.evaluate(o);return s}],"-":{type:et,overloads:[[[et,et],(o,[i,s])=>i.evaluate(o)-s.evaluate(o)],[[et],(o,[i])=>-i.evaluate(o)]]},"/":[et,[et,et],(o,[i,s])=>i.evaluate(o)/s.evaluate(o)],"%":[et,[et,et],(o,[i,s])=>i.evaluate(o)%s.evaluate(o)],ln2:[et,[],()=>Math.LN2],pi:[et,[],()=>Math.PI],e:[et,[],()=>Math.E],"^":[et,[et,et],(o,[i,s])=>Math.pow(i.evaluate(o),s.evaluate(o))],sqrt:[et,[et],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[et,[et],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[et,[et],(o,[i])=>Math.log(i.evaluate(o))],log2:[et,[et],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[et,[et],(o,[i])=>Math.sin(i.evaluate(o))],cos:[et,[et],(o,[i])=>Math.cos(i.evaluate(o))],tan:[et,[et],(o,[i])=>Math.tan(i.evaluate(o))],asin:[et,[et],(o,[i])=>Math.asin(i.evaluate(o))],acos:[et,[et],(o,[i])=>Math.acos(i.evaluate(o))],atan:[et,[et],(o,[i])=>Math.atan(i.evaluate(o))],min:[et,io(et),(o,i)=>Math.min(...i.map(s=>s.evaluate(o)))],max:[et,io(et),(o,i)=>Math.max(...i.map(s=>s.evaluate(o)))],abs:[et,[et],(o,[i])=>Math.abs(i.evaluate(o))],round:[et,[et],(o,[i])=>{const s=i.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[et,[et],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[et,[et],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[fn,[gn,Gn],(o,[i,s])=>o.properties()[i.value]===s.value],"filter-id-==":[fn,[Gn],(o,[i])=>o.id()===i.value],"filter-type-==":[fn,[gn],(o,[i])=>o.geometryType()===i.value],"filter-<":[fn,[gn,Gn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[fn,[Gn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<c}],"filter->":[fn,[gn,Gn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[fn,[Gn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>c}],"filter-<=":[fn,[gn,Gn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[fn,[Gn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<=c}],"filter->=":[fn,[gn,Gn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[fn,[Gn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>=c}],"filter-has":[fn,[Gn],(o,[i])=>i.value in o.properties()],"filter-has-id":[fn,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[fn,[Un(gn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[fn,[Un(Gn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[fn,[gn,Un(Gn)],(o,[i,s])=>s.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[fn,[gn,Un(Gn)],(o,[i,s])=>function(c,p,g,v){for(;g<=v;){const w=g+v>>1;if(p[w]===c)return!0;p[w]>c?v=w-1:g=w+1}return!1}(o.properties()[i.value],s.value,0,s.value.length-1)],all:{type:fn,overloads:[[[fn,fn],(o,[i,s])=>i.evaluate(o)&&s.evaluate(o)],[io(fn),(o,i)=>{for(const s of i)if(!s.evaluate(o))return!1;return!0}]]},any:{type:fn,overloads:[[[fn,fn],(o,[i,s])=>i.evaluate(o)||s.evaluate(o)],[io(fn),(o,i)=>{for(const s of i)if(s.evaluate(o))return!0;return!1}]]},"!":[fn,[fn],(o,[i])=>!i.evaluate(o)],"is-supported-script":[fn,[gn],(o,[i])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(i.evaluate(o))}],upcase:[gn,[gn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[gn,[gn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[gn,io(Gn),(o,i)=>i.map(s=>ns(s.evaluate(o))).join("")],"resolved-locale":[gn,[$i],(o,[i])=>i.evaluate(o).resolvedLocale()]});var hc=cc;function tl(o){return{result:"success",value:o}}function mr(o){return{result:"error",value:o}}function nl(o){return"data-driven"===o["property-type"]}function Zc(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Ho(o){return!!o.expression&&o.expression.interpolated}function kn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function kl(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function il(o){return o}function An(o,i){const s="color"===i.type,c=o.stops&&"object"==typeof o.stops[0][0],p=c||!(c||void 0!==o.property),g=o.type||(Ho(i)?"exponential":"interval");if(s&&((o=es({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],an.parse(S[1])])),o.default=an.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!Ja[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let v,w,T;if("exponential"===g)v=ir;else if("interval"===g)v=xr;else if("categorical"===g){v=ei,w=Object.create(null);for(const S of o.stops)w[S[0]]=S[1];T=typeof o.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);v=rl}if(c){const S={},P=[];for(let V=0;V<o.stops.length;V++){const j=o.stops[V],q=j[0].zoom;void 0===S[q]&&(S[q]={zoom:q,type:o.type,property:o.property,default:o.default,stops:[]},P.push(q)),S[q].stops.push([j[0].value,j[1]])}const N=[];for(const V of P)N.push([S[V].zoom,An(S[V],i)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:ps.interpolationFactor.bind(void 0,F),zoomStops:N.map(V=>V[0]),evaluate:({zoom:V},j)=>ir({stops:N,base:o.base},i,V).evaluate(V,j)}}if(p){const S="exponential"===g?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ps.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(o,i,P,w,T)}}return{kind:"source",evaluate(S,P){const N=P&&P.properties?P.properties[o.property]:void 0;return void 0===N?gr(o.default,i.default):v(o,i,N,w,T)}}}function gr(o,i,s){return void 0!==o?o:void 0!==i?i:void 0!==s?s:void 0}function ei(o,i,s,c,p){return gr(typeof s===p?c[s]:void 0,o.default,i.default)}function xr(o,i,s){if("number"!==kn(s))return gr(o.default,i.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const p=Il(o.stops.map(g=>g[0]),s);return o.stops[p][1]}function ir(o,i,s){const c=void 0!==o.base?o.base:1;if("number"!==kn(s))return gr(o.default,i.default);const p=o.stops.length;if(1===p||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[p-1][0])return o.stops[p-1][1];const g=Il(o.stops.map(P=>P[0]),s),v=function(P,N,F,V){const j=V-F,q=P-F;return 0===j?0:1===N?q/j:(Math.pow(N,q)-1)/(Math.pow(N,j)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),w=o.stops[g][1],T=o.stops[g+1][1];let S=ac[i.type]||il;if(o.colorSpace&&"rgb"!==o.colorSpace){const P=Ja[o.colorSpace];S=(N,F)=>P.reverse(P.interpolate(P.forward(N),P.forward(F),v))}return"function"==typeof w.evaluate?{evaluate(...P){const N=w.evaluate.apply(void 0,P),F=T.evaluate.apply(void 0,P);if(void 0!==N&&void 0!==F)return S(N,F,v)}}:S(w,T,v)}function rl(o,i,s){return"color"===i.type?s=an.parse(s):"formatted"===i.type?s=ii.fromString(s.toString()):"resolvedImage"===i.type?s=So.fromString(s.toString()):kn(s)===i.type||"enum"===i.type&&i.values[s]||(s=void 0),gr(s,o.default,i.default)}class Zr{constructor(i,s){var c;this.expression=i,this._warningHistory={},this._evaluator=new Dh,this._defaultValue=s?"color"===(c=s).type&&(kl(c.default)||Array.isArray(c.default))?new an(0,0,0,0):"color"===c.type?an.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(i,s,c,p,g,v,w,T){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,c,p,g,v,w,T){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new vi(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Ia(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in hc}function Aa(o,i){const s=new Ma(hc,[],i?function(p){const g={color:dn,string:gn,number:et,enum:gn,boolean:fn,formatted:ts,resolvedImage:Hi};return"array"===p.type?Un(g[p.value]||Gn,p.length):g[p.type]}(i):void 0),c=s.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?tl(new Zr(c,i)):mr(s.errors)}class ol{constructor(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent="constant"!==i&&!Da(s.expression)}evaluateWithoutErrorHandling(i,s,c,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,p,g,v)}evaluate(i,s,c,p,g,v){return this._styleExpression.evaluate(i,s,c,p,g,v)}}class Ol{constructor(i,s,c,p){this.kind=i,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==i&&!Da(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,s,c,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,p,g,v)}evaluate(i,s,c,p,g,v){return this._styleExpression.evaluate(i,s,c,p,g,v)}interpolationFactor(i,s,c){return this.interpolationType?ps.interpolationFactor(this.interpolationType,i,s,c):0}}function dc(o,i){if("error"===(o=Aa(o,i)).result)return o;const s=o.value.expression,c=oc(s);if(!c&&!nl(i))return mr([new Do("","data expressions not supported")]);const p=qt(s,["zoom","pitch","distance-from-center"]);if(!p&&!Zc(i))return mr([new Do("","zoom expressions not supported")]);const g=Xt(s);return g||p?g instanceof Do?mr([g]):g instanceof ps&&!Ho(i)?mr([new Do("",'"interpolate" expressions cannot be used with this property')]):tl(g?new Ol(c?"camera":"composite",o.value,g.labels,g instanceof ps?g.interpolation:void 0):new ol(c?"constant":"source",o.value)):mr([new Do("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Gi{constructor(i,s){this._parameters=i,this._specification=s,es(this,An(this._parameters,this._specification))}static deserialize(i){return new Gi(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Xt(o){let i=null;if(o instanceof rs)i=Xt(o.result);else if(o instanceof Rl){for(const s of o.args)if(i=Xt(s),i)break}else(o instanceof Io||o instanceof ps)&&o.input instanceof Vo&&"zoom"===o.input.name&&(i=o);return i instanceof Do||o.eachChild(s=>{const c=Xt(s);c instanceof Do?i=c:!i&&c?i=new Do("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new Do("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class ct{constructor(i,s,c,p){this.message=(i?`${i}: `:"")+c,p&&(this.identifier=p),null!=s&&s.__line__&&(this.line=s.__line__)}}function h(o){const i=o.key,s=o.value,c=o.valueSpec||{},p=o.objectElementValidators||{},g=o.style,v=o.styleSpec;let w=[];const T=kn(s);if("object"!==T)return[new ct(i,s,`object expected, ${T} found`)];for(const S in s){const P=S.split(".")[0];let N;p[P]?N=p[P]:c[P]?N=ro:p["*"]?N=p["*"]:c["*"]&&(N=ro),N?w=w.concat(N({key:(i&&`${i}.`)+S,value:s[S],valueSpec:c[P]||c["*"],style:g,styleSpec:v,object:s,objectKey:S},s)):w.push(new ct(i,s[S],`unknown property "${S}"`))}for(const S in c)p[S]||c[S].required&&void 0===c[S].default&&void 0===s[S]&&w.push(new ct(i,s,`missing required property "${S}"`));return w}function x(o){const i=o.value,s=o.valueSpec,c=o.style,p=o.styleSpec,g=o.key,v=o.arrayElementValidator||ro;if("array"!==kn(i))return[new ct(g,i,`array expected, ${kn(i)} found`)];if(s.length&&i.length!==s.length)return[new ct(g,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new ct(g,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let w={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};p.$version<7&&(w.function=s.function),"object"===kn(s.value)&&(w=s.value);let T=[];for(let S=0;S<i.length;S++)T=T.concat(v({array:i,arrayIndex:S,value:i[S],valueSpec:w,style:c,styleSpec:p,key:`${g}[${S}]`}));return T}function M(o){const i=o.key,s=o.value,c=o.valueSpec;let p=kn(s);if("number"===p&&s!=s&&(p="NaN"),"number"!==p)return[new ct(i,s,`number expected, ${p} found`)];if("minimum"in c){let g=c.minimum;if("array"===kn(c.minimum)&&(g=c.minimum[o.arrayIndex]),s<g)return[new ct(i,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if("array"===kn(c.maximum)&&(g=c.maximum[o.arrayIndex]),s>g)return[new ct(i,s,`${s} is greater than the maximum value ${g}`)]}return[]}function k(o){const i=o.valueSpec,s=Wi(o.value.type);let c,p,g,v={};const w="categorical"!==s&&void 0===o.value.property,T=!w,S="array"===kn(o.value.stops)&&"array"===kn(o.value.stops[0])&&"object"===kn(o.value.stops[0][0]),P=h({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(V){if("identity"===s)return[new ct(V.key,V.value,'identity function may not have a "stops" property')];let j=[];const q=V.value;return j=j.concat(x({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),"array"===kn(q)&&0===q.length&&j.push(new ct(V.key,q,"array must have at least one stop")),j},default:function(V){return ro({key:V.key,value:V.value,valueSpec:i,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===s&&w&&P.push(new ct(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||P.push(new ct(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!Ho(o.valueSpec)&&P.push(new ct(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(T&&!nl(o.valueSpec)?P.push(new ct(o.key,o.value,"property functions not supported")):w&&!Zc(o.valueSpec)&&P.push(new ct(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!S||void 0!==o.value.property||P.push(new ct(o.key,o.value,'"property" property is required')),P;function N(V){let j=[];const q=V.value,J=V.key;if("array"!==kn(q))return[new ct(J,q,`array expected, ${kn(q)} found`)];if(2!==q.length)return[new ct(J,q,`array length 2 expected, length ${q.length} found`)];if(S){if("object"!==kn(q[0]))return[new ct(J,q,`object expected, ${kn(q[0])} found`)];if(void 0===q[0].zoom)return[new ct(J,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new ct(J,q,"object stop key must have value")];const se=Wi(q[0].zoom);if("number"!=typeof se)return[new ct(J,q[0].zoom,"stop zoom values must be numbers")];if(g&&g>se)return[new ct(J,q[0].zoom,"stop zoom values must appear in ascending order")];se!==g&&(g=se,p=void 0,v={}),j=j.concat(h({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:M,value:F}}))}else j=j.concat(F({key:`${J}[0]`,value:q[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},q));return Ia(Ln(q[1]))?j.concat([new ct(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(ro({key:`${J}[1]`,value:q[1],valueSpec:i,style:V.style,styleSpec:V.styleSpec}))}function F(V,j){const q=kn(V.value),J=Wi(V.value),se=null!==V.value?V.value:j;if(c){if(q!==c)return[new ct(V.key,se,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new ct(V.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==s){let pe=`number expected, ${q} found`;return nl(i)&&void 0===s&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(V.key,se,pe)]}return"categorical"!==s||"number"!==q||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==s&&"number"===q&&"number"==typeof J&&"number"==typeof p&&void 0!==p&&J<p?[new ct(V.key,se,"stop domain values must appear in ascending order")]:(p=J,"categorical"===s&&J in v?[new ct(V.key,se,"stop domain values must be unique")]:(v[J]=!0,[])):[new ct(V.key,se,`integer expected, found ${String(J)}`)]}}function U(o){const i=("property"===o.expressionContext?dc:Aa)(Ln(o.value),o.valueSpec);if("error"===i.result)return i.value.map(c=>new ct(`${o.key}${c.key}`,o.value,c.message));const s=i.value.expression||i.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new ct(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Da(s))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return X(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!qt(s,["zoom","feature-state"]))return[new ct(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!oc(s))return[new ct(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function X(o,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const p of i.valueSpec.expression.parameters)s.delete(p);if(0===s.size)return[];const c=[];return o instanceof Vo&&s.has(o.name)?[new ct(i.key,i.value,`["${o.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(o.eachChild(p=>{c.push(...X(p,i))}),c)}function xe(o){const i=o.key,s=o.value,c=o.valueSpec,p=[];return Array.isArray(c.values)?-1===c.values.indexOf(Wi(s))&&p.push(new ct(i,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Wi(s))&&p.push(new ct(i,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function je(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!je(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Le(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};je(o)||(o=qi(o));const s=o;let c=!0;try{c=function(S){if(!yn(S))return S;let P=Ln(S);return tn(P),P=bt(P),P}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const p=Je[`filter_${i}`],g=Aa(c,p);let v=null;if("error"===g.result)throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));v=(S,P,N)=>g.value.evaluate(S,P,{},N);let w=null,T=null;if(c!==s){const S=Aa(s,p);if("error"===S.result)throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,N,F,V,j)=>S.value.evaluate(P,N,{},F,void 0,void 0,V,j),T=!oc(S.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:rr(c),needFeature:!!T}}function bt(o){if(!Array.isArray(o))return o;const i=function(s){if(_n.has(s[0]))for(let c=1;c<s.length;c++)if(yn(s[c]))return!0;return s}(o);return!0===i?i:i.map(s=>bt(s))}function tn(o){let i=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)i=i||yn(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){i=i||yn(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){i=i||yn(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}i&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)tn(o[c])}function yn(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let s=1;s<o.length;s++)if(yn(o[s]))return!0;return!1}const _n=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lr(o,i){return o<i?-1:o>i?1:0}function rr(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let i=1;i<o.length;i++)if(rr(o[i]))return!0;return!1}function qi(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?Er(o[1],o[2],"=="):"!="===i?Go(Er(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Er(o[1],o[2],i):"any"===i?(s=o.slice(1),["any"].concat(s.map(qi))):"all"===i?["all"].concat(o.slice(1).map(qi)):"none"===i?["all"].concat(o.slice(1).map(qi).map(Go)):"in"===i?Ws(o[1],o.slice(2)):"!in"===i?Go(Ws(o[1],o.slice(2))):"has"===i?ys(o[1]):"!has"===i?Go(ys(o[1])):"within"!==i||o;var s}function Er(o,i,s){switch(o){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,o,i]}}function Ws(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Lr)]]:["filter-in-small",o,["literal",i]]}}function ys(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Go(o){return["!",o]}function Xs(o){return je(Ln(o.value))?U(es({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):vs(o)}function vs(o){const i=o.value,s=o.key;if("array"!==kn(i))return[new ct(s,i,`array expected, ${kn(i)} found`)];const c=o.styleSpec;let p,g=[];if(i.length<1)return[new ct(s,i,"filter array must have at least 1 element")];switch(g=g.concat(xe({key:`${s}[0]`,value:i[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Wi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Wi(i[1])&&g.push(new ct(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&g.push(new ct(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=kn(i[1]),"string"!==p&&g.push(new ct(`${s}[1]`,i[1],`string expected, ${p} found`)));for(let v=2;v<i.length;v++)p=kn(i[v]),"$type"===Wi(i[1])?g=g.concat(xe({key:`${s}[${v}]`,value:i[v],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&g.push(new ct(`${s}[${v}]`,i[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<i.length;v++)g=g.concat(vs({key:`${s}[${v}]`,value:i[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=kn(i[1]),2!==i.length?g.push(new ct(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==p&&g.push(new ct(`${s}[1]`,i[1],`string expected, ${p} found`));break;case"within":p=kn(i[1]),2!==i.length?g.push(new ct(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==p&&g.push(new ct(`${s}[1]`,i[1],`object expected, ${p} found`))}return g}function ti(o,i){const s=o.key,c=o.style,p=o.styleSpec,g=o.value,v=o.objectKey,w=p[`${i}_${o.layerType}`];if(!w)return[];const T=v.match(/^(.*)-transition$/);if("paint"===i&&T&&w[T[1]]&&w[T[1]].transition)return ro({key:s,value:g,valueSpec:p.transition,style:c,styleSpec:p});const S=o.valueSpec||w[v];if(!S)return[new ct(s,g,`unknown property "${v}"`)];let P;if("string"===kn(g)&&nl(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(g))){const F=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new ct(s,g,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${F}.`)]}const N=[];return"symbol"===o.layerType&&("text-field"===v&&c&&!c.glyphs&&N.push(new ct(s,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&kl(Ln(g))&&"identity"===Wi(g.type)&&N.push(new ct(s,g,'"text-font" does not support identity functions'))),N.concat(ro({key:o.key,value:g,valueSpec:S,style:c,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:v}))}function Ph(o){return ti(o,"paint")}function or(o){return ti(o,"layout")}function Nl(o){let i=[];const s=o.value,c=o.key,p=o.style,g=o.styleSpec;s.type||s.ref||i.push(new ct(c,s,'either "type" or "ref" is required'));let v=Wi(s.type);const w=Wi(s.ref);if(s.id){const T=Wi(s.id);for(let S=0;S<o.arrayIndex;S++){const P=p.layers[S];Wi(P.id)===T&&i.push(new ct(c,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(S=>{S in s&&i.push(new ct(c,s[S],`"${S}" is prohibited for ref layers`))}),p.layers.forEach(S=>{Wi(S.id)===w&&(T=S)}),T?T.ref?i.push(new ct(c,s.ref,"ref cannot reference another ref layer")):v=Wi(T.type):"string"==typeof w&&i.push(new ct(c,s.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(s.source){const T=p.sources&&p.sources[s.source],S=T&&Wi(T.type);T?"vector"===S&&"raster"===v?i.push(new ct(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===S&&"raster"!==v?i.push(new ct(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==S||s["source-layer"]?"raster-dem"===S&&"hillshade"!==v?i.push(new ct(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||"geojson"===S&&T.lineMetrics||i.push(new ct(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ct(c,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new ct(c,s.source,`source "${s.source}" not found`))}else i.push(new ct(c,s,'missing required property "source"'));return i=i.concat(h({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ro({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:T=>Xs(es({layerType:v},T)),layout:T=>h({layer:s,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>or(es({layerType:v},S))}}),paint:T=>h({layer:s,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>Ph(es({layerType:v},S))}})}})),i}function Wr(o){const i=o.value,s=o.key,c=kn(i);return"string"!==c?[new ct(s,i,`string expected, ${c} found`)]:[]}const fc={promoteId:function({key:o,value:i}){if("string"===kn(i))return Wr({key:o,value:i});{const s=[];for(const c in i)s.push(...Wr({key:`${o}.${c}`,value:i[c]}));return s}}};function sl(o){const i=o.value,s=o.key,c=o.styleSpec,p=o.style;if(!i.type)return[new ct(s,i,'"type" is required')];const g=Wi(i.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=h({key:s,value:i,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:fc}),v;case"geojson":if(v=h({key:s,value:i,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:fc}),i.cluster)for(const w in i.clusterProperties){const[T,S]=i.clusterProperties[w],P="string"==typeof T?[T,["accumulated"],["get",w]]:T;v.push(...U({key:`${s}.${w}.map`,value:S,expressionContext:"cluster-map"})),v.push(...U({key:`${s}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return h({key:s,value:i,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return h({key:s,value:i,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new ct(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xe({key:`${s}.type`,value:i.type,valueSpec:{values:al(c)},style:p,styleSpec:c})}}function al(o){return o.source.reduce((i,s)=>{const c=o[s];return"enum"===c.type.type&&(i=i.concat(Object.keys(c.type.values))),i},[])}function kr(o){const i=o.value,s=o.styleSpec,c=s.light,p=o.style;let g=[];const v=kn(i);if(void 0===i)return g;if("object"!==v)return g=g.concat([new ct("light",i,`object expected, ${v} found`)]),g;for(const w in i){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&c[T[1]]&&c[T[1]].transition?ro({key:w,value:i[w],valueSpec:s.transition,style:p,styleSpec:s}):c[w]?ro({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:s}):[new ct(w,i[w],`unknown property "${w}"`)])}return g}function Rh(o){const i=o.value,s=o.key,c=o.style,p=o.styleSpec,g=p.terrain;let v=[];const w=kn(i);if(void 0===i)return v;if("object"!==w)return v=v.concat([new ct("terrain",i,`object expected, ${w} found`)]),v;for(const T in i){const S=T.match(/^(.*)-transition$/);v=v.concat(S&&g[S[1]]&&g[S[1]].transition?ro({key:T,value:i[T],valueSpec:p.transition,style:c,styleSpec:p}):g[T]?ro({key:T,value:i[T],valueSpec:g[T],style:c,styleSpec:p}):[new ct(T,i[T],`unknown property "${T}"`)])}if(i.source){const T=c.sources&&c.sources[i.source],S=T&&Wi(T.type);T?"raster-dem"!==S&&v.push(new ct(s,i.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):v.push(new ct(s,i.source,`source "${i.source}" not found`))}else v.push(new ct(s,i,'terrain is missing required property "source"'));return v}function Ro(o){const i=o.value,s=o.style,c=o.styleSpec,p=c.fog;let g=[];const v=kn(i);if(void 0===i)return g;if("object"!==v)return g=g.concat([new ct("fog",i,`object expected, ${v} found`)]),g;for(const w in i){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&p[T[1]]&&p[T[1]].transition?ro({key:w,value:i[w],valueSpec:c.transition,style:s,styleSpec:c}):p[w]?ro({key:w,value:i[w],valueSpec:p[w],style:s,styleSpec:c}):[new ct(w,i[w],`unknown property "${w}"`)])}return g}const bo={"*":()=>[],array:x,boolean:function(o){const i=o.value,s=o.key,c=kn(i);return"boolean"!==c?[new ct(s,i,`boolean expected, ${c} found`)]:[]},number:M,color:function(o){const i=o.key,s=o.value,c=kn(s);return"string"!==c?[new ct(i,s,`color expected, ${c} found`)]:null===Sn(s)?[new ct(i,s,`color expected, "${s}" found`)]:[]},enum:xe,filter:Xs,function:k,layer:Nl,object:h,source:sl,light:kr,terrain:Rh,fog:Ro,string:Wr,formatted:function(o){return 0===Wr(o).length?[]:U(o)},resolvedImage:function(o){return 0===Wr(o).length?[]:U(o)},projection:function(o){const i=o.value,s=o.styleSpec,c=s.projection,p=o.style;let g=[];const v=kn(i);if("object"===v)for(const w in i)g=g.concat(ro({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:s}));else"string"!==v&&(g=g.concat([new ct("projection",i,`object or string expected, ${v} found`)]));return g}};function ro(o){const i=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&kl(Wi(i))?k(o):s.expression&&Ia(Ln(i))?U(o):s.type&&bo[s.type]?bo[s.type](o):h(es({},o,{valueSpec:s.type?c[s.type]:s}))}function pc(o){const i=o.value,s=o.key,c=Wr(o);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new ct(s,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new ct(s,i,'"glyphs" url must include a "{range}" token'))),c}function Nu(o,i=Je){return xs(ro({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:pc,"*":()=>[]}}))}const Ys=o=>xs(Ph(o)),Nd=o=>xs(or(o));function xs(o){return o.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function Qf(o,i){let s=!1;if(i&&i.length)for(const c of i)o.fire(new fo(new Error(c.message))),s=!0;return s}var xy=Pa,Ks=3;function Pa(o,i,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var p=new Int32Array(this.arrayBuffer);o=p[0],this.d=(i=p[1])+2*(s=p[2]);for(var g=0;g<this.d*this.d;g++){var v=p[Ks+g],w=p[Ks+g+1];c.push(v===w?null:p.subarray(v,w))}var T=p[Ks+c.length+1];this.keys=p.subarray(p[Ks+c.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=i+2*s;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=s,this.scale=i/o,this.uid=0;var P=s/i*o;this.min=-P,this.max=o+P}Pa.prototype.insert=function(o,i,s,c,p){this._forEachCell(i,s,c,p,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)},Pa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Pa.prototype._insertCell=function(o,i,s,c,p,g){this.cells[p].push(g)},Pa.prototype.query=function(o,i,s,c,p){var g=this.min,v=this.max;if(o<=g&&i<=g&&v<=s&&v<=c&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(o,i,s,c,this._queryCell,w,{},p),w},Pa.prototype._queryCell=function(o,i,s,c,p,g,v,w){var T=this.cells[p];if(null!==T)for(var S=this.keys,P=this.bboxes,N=0;N<T.length;N++){var F=T[N];if(void 0===v[F]){var V=4*F;(w?w(P[V+0],P[V+1],P[V+2],P[V+3]):o<=P[V+2]&&i<=P[V+3]&&s>=P[V+0]&&c>=P[V+1])?(v[F]=!0,g.push(S[F])):v[F]=!1}}},Pa.prototype._forEachCell=function(o,i,s,c,p,g,v,w){for(var T=this._convertToCellCoord(o),S=this._convertToCellCoord(i),P=this._convertToCellCoord(s),N=this._convertToCellCoord(c),F=T;F<=P;F++)for(var V=S;V<=N;V++){var j=this.d*V+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&p.call(this,o,i,s,c,j,g,v,w))return}},Pa.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Pa.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Pa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=Ks+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var p=new Int32Array(i+s+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=i,v=0;v<o.length;v++){var w=o[v];p[Ks+v]=g,p.set(w,g),g+=w.length}return p[Ks+o.length]=g,p.set(this.keys,g),p[Ks+o.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};var Wc=he(xy);const Fd={};function Kt(o,i,s={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writeable:!1}),Fd[i]={klass:o,omit:s.omit||[]}}Kt(Object,"Object"),Wc.serialize=function(o,i){const s=o.toArrayBuffer();return i&&i.push(s),{buffer:s}},Wc.deserialize=function(o){return new Wc(o.buffer)},Object.defineProperty(Wc,"name",{value:"Grid"}),Kt(Wc,"Grid"),Kt(an,"Color"),Kt(Error,"Error"),Kt(eo,"AJAXError"),Kt(So,"ResolvedImage"),Kt(Gi,"StylePropertyFunction"),Kt(Zr,"StyleExpression",{omit:["_evaluator"]}),Kt(Ol,"ZoomDependentExpression"),Kt(ol,"ZoomConstantExpression"),Kt(Vo,"CompoundExpression",{omit:["_evaluate"]});for(const o in hc)Fd[hc[o]._classRegistryKey]||Kt(hc[o],`Expression${o}`);function ep(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function tp(o){return Q.ImageBitmap&&o instanceof Q.ImageBitmap}function Fu(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(ep(o)||tp(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return i&&i.push(s.buffer),s}if(o instanceof Q.ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(Fu(c,i));return s}if("object"==typeof o){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=s.serialize?s.serialize(o,i):{};if(!s.serialize){for(const g in o)o.hasOwnProperty(g)&&(Fd[c].omit.indexOf(g)>=0||(p[g]=Fu(o[g],i)));o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof o)}function Xc(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||ep(o)||tp(o)||ArrayBuffer.isView(o)||o instanceof Q.ImageData)return o;if(Array.isArray(o))return o.map(Xc);if("object"==typeof o){const i=o.$name||"Object",{klass:s}=Fd[i];if(!s)throw new Error(`can't deserialize unregistered class ${i}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const p of Object.keys(o))"$name"!==p&&(c[p]=Xc(o[p]));return c}throw new Error("can't deserialize object of type "+typeof o)}const jt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function np(o){for(const i of o)if(ip(i.charCodeAt(0)))return!0;return!1}function by(o){for(const i of o)if(!Ym(i.charCodeAt(0)))return!1;return!0}function Ym(o){return!(jt.Arabic(o)||jt["Arabic Supplement"](o)||jt["Arabic Extended-A"](o)||jt["Arabic Presentation Forms-A"](o)||jt["Arabic Presentation Forms-B"](o))}function ip(o){return!(746!==o&&747!==o&&(o<4352||!(jt["Bopomofo Extended"](o)||jt.Bopomofo(o)||jt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||jt["CJK Compatibility Ideographs"](o)||jt["CJK Compatibility"](o)||jt["CJK Radicals Supplement"](o)||jt["CJK Strokes"](o)||!(!jt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||jt["CJK Unified Ideographs Extension A"](o)||jt["CJK Unified Ideographs"](o)||jt["Enclosed CJK Letters and Months"](o)||jt["Hangul Compatibility Jamo"](o)||jt["Hangul Jamo Extended-A"](o)||jt["Hangul Jamo Extended-B"](o)||jt["Hangul Jamo"](o)||jt["Hangul Syllables"](o)||jt.Hiragana(o)||jt["Ideographic Description Characters"](o)||jt.Kanbun(o)||jt["Kangxi Radicals"](o)||jt["Katakana Phonetic Extensions"](o)||jt.Katakana(o)&&12540!==o||!(!jt["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!jt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||jt["Unified Canadian Aboriginal Syllabics"](o)||jt["Unified Canadian Aboriginal Syllabics Extended"](o)||jt["Vertical Forms"](o)||jt["Yijing Hexagram Symbols"](o)||jt["Yi Syllables"](o)||jt["Yi Radicals"](o))))}function zd(o){return!(ip(o)||(i=o,jt["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||jt["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||jt["Letterlike Symbols"](i)||jt["Number Forms"](i)||jt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||jt["Control Pictures"](i)&&9251!==i||jt["Optical Character Recognition"](i)||jt["Enclosed Alphanumerics"](i)||jt["Geometric Shapes"](i)||jt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||jt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||jt["CJK Symbols and Punctuation"](i)||jt.Katakana(i)||jt["Private Use Area"](i)||jt["CJK Compatibility Forms"](i)||jt["Small Form Variants"](i)||jt["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Bd(o){return o>=1424&&o<=2303||jt["Arabic Presentation Forms-A"](o)||jt["Arabic Presentation Forms-B"](o)}function wy(o,i){return!(!i&&Bd(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||jt.Khmer(o))}function Ey(o){for(const i of o)if(Bd(i.charCodeAt(0)))return!0;return!1}const rp="deferred",ll="loading",Ra="loaded";let zu=null,m="unavailable",a=null;const d=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(m="error"),zu&&zu(o)};function _(){b.fire(new va("pluginStateChange",{pluginStatus:m,pluginURL:a}))}const b=new Os,E=function(){return m},I=function(){if(m!==rp||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=ll,_(),a&&Za({url:a},o=>{o?d(o):(m=Ra,_())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===Ra||null!=A.applyArabicShaping,isLoading:()=>m===ll,setState(o){m=o.pluginStatus,a=o.pluginURL},isParsed:()=>null!=A.applyArabicShaping&&null!=A.processBidirectionalText&&null!=A.processStyledBidirectionalText,getPluginURL:()=>a};class R{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(s,c){for(const p of s)if(!wy(p.charCodeAt(0),c))return!1;return!0}(i,A.isLoaded())}}class B{constructor(i,s){this.property=i,this.value=s,this.expression=function(c,p){if(kl(c))return new Gi(c,p);if(Ia(c)){const g=dc(c,p);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=c;return"string"==typeof c&&"color"===p.type&&(g=an.parse(c)),{kind:"constant",evaluate:()=>g}}}(void 0===s?i.specification.default:s,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,s,c){return this.property.possiblyEvaluate(this,i,s,c)}}class z{constructor(i){this.property=i,this.value=new B(i,void 0)}transitioned(i,s){return new K(this.property,this.value,s,ni({},i.transition,this.transition),i.now)}untransitioned(){return new K(this.property,this.value,null,{},0)}}class H{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Nn(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new z(this._values[i].property)),this._values[i].value=new B(this._values[i].property,null===s?void 0:Nn(s))}getTransition(i){return Nn(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new z(this._values[i].property)),this._values[i].transition=Nn(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c);const p=this.getTransition(s);void 0!==p&&(i[`${s}-transition`]=p)}return i}transitioned(i,s){const c=new te(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(i,s._values[p]);return c}untransitioned(){const i=new te(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class K{constructor(i,s,c,p,g){const v=p.delay||0,w=p.duration||0;g=g||0,this.property=i,this.value=s,this.begin=g+v,this.end=this.begin+w,i.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(i,s,c){const p=i.now||0,g=this.value.possiblyEvaluate(i,s,c),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(i,s,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(i,s,c),g,Ui(w))}}return g}}class te{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,c){const p=new re(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,s,c);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ie{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Nn(this._values[i].value)}setValue(i,s){this._values[i]=new B(this._values[i].property,null===s?void 0:Nn(s))}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c)}return i}possiblyEvaluate(i,s,c){const p=new re(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,s,c);return p}}class ne{constructor(i,s,c){this.property=i,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,s,c,p){return this.property.evaluate(this.value,this.parameters,i,s,c,p)}}class re{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class G{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,c){const p=ac[this.specification.type];return p?p(i,s,c):i}}class ee{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,c,p){return new ne(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(s,null,{},c,p)}:i.expression,s)}interpolate(i,s,c){if("constant"!==i.value.kind||"constant"!==s.value.kind)return i;if(void 0===i.value.value||void 0===s.value.value)return new ne(this,{kind:"constant",value:void 0},i.parameters);const p=ac[this.specification.type];return p?new ne(this,{kind:"constant",value:p(i.value.value,s.value.value,c)},i.parameters):i}evaluate(i,s,c,p,g,v){return"constant"===i.kind?i.value:i.evaluate(s,c,p,g,v)}}class le{constructor(i){this.specification=i}possiblyEvaluate(i,s,c,p){return!!i.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class ce{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new R(0,{});for(const c in i){const p=i[c];p.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new B(p,void 0),v=this.defaultTransitionablePropertyValues[c]=new z(p);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(s)}}}function be(o,i){return 256*(o=Cn(Math.floor(o),0,255))+Cn(Math.floor(i),0,255)}Kt(ee,"DataDrivenProperty"),Kt(G,"DataConstantProperty"),Kt(le,"ColorRampProperty");const Ee={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class we{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ke{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ie(o,i=1){let s=0,c=0;return{members:o.map(p=>{const g=Ee[p.type].BYTES_PER_ELEMENT,v=s=Ge(s,Math.max(i,g)),w=p.components||1;return c=Math.max(c,g),s+=g*w,{name:p.name,type:p.type,components:w,offset:v}}),size:Ge(s,Math.max(c,i)),alignment:i}}function Ge(o,i){return Math.ceil(o/i)*i}class vt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.int16[p+0]=s,this.int16[p+1]=c,i}}vt.prototype.bytesPerElement=4,Kt(vt,"StructArrayLayout2i4");class Be extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=p,i}}Be.prototype.bytesPerElement=6,Kt(Be,"StructArrayLayout3i6");class st extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=p,this.int16[v+3]=g,i}}st.prototype.bytesPerElement=8,Kt(st,"StructArrayLayout4i8");class Xe extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,c,p,g,v,w)}emplace(i,s,c,p,g,v,w,T){const S=6*i,P=12*i,N=3*i;return this.int16[S+0]=s,this.int16[S+1]=c,this.uint8[P+4]=p,this.uint8[P+5]=g,this.uint8[P+6]=v,this.uint8[P+7]=w,this.float32[N+2]=T,i}}Xe.prototype.bytesPerElement=12,Kt(Xe,"StructArrayLayout2i4ub1f12");class gt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,this.float32[v+3]=g,i}}gt.prototype.bytesPerElement=16,Kt(gt,"StructArrayLayout4f16");class He extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=6*i,T=3*i;return this.uint16[w+0]=s,this.uint16[w+1]=c,this.uint16[w+2]=p,this.uint16[w+3]=g,this.float32[T+2]=v,i}}He.prototype.bytesPerElement=12,Kt(He,"StructArrayLayout4ui1f12");class rt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=p,this.uint16[v+3]=g,i}}rt.prototype.bytesPerElement=8,Kt(rt,"StructArrayLayout4ui8");class wt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,p,g,v)}emplace(i,s,c,p,g,v,w){const T=6*i;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=g,this.int16[T+4]=v,this.int16[T+5]=w,i}}wt.prototype.bytesPerElement=12,Kt(wt,"StructArrayLayout6i12");class ut extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F){const V=this.length;return this.resize(V+1),this.emplace(V,i,s,c,p,g,v,w,T,S,P,N,F)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V){const j=12*i;return this.int16[j+0]=s,this.int16[j+1]=c,this.int16[j+2]=p,this.int16[j+3]=g,this.uint16[j+4]=v,this.uint16[j+5]=w,this.uint16[j+6]=T,this.uint16[j+7]=S,this.int16[j+8]=P,this.int16[j+9]=N,this.int16[j+10]=F,this.int16[j+11]=V,i}}ut.prototype.bytesPerElement=24,Kt(ut,"StructArrayLayout4i4ui4i24");class Tt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,p,g,v)}emplace(i,s,c,p,g,v,w){const T=10*i,S=5*i;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.float32[S+2]=g,this.float32[S+3]=v,this.float32[S+4]=w,i}}Tt.prototype.bytesPerElement=20,Kt(Tt,"StructArrayLayout3i3f20");class ln extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}ln.prototype.bytesPerElement=4,Kt(ln,"StructArrayLayout1ul4");class Pn extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V){const j=this.length;return this.resize(j+1),this.emplace(j,i,s,c,p,g,v,w,T,S,P,N,F,V)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=20*i,J=10*i;return this.int16[q+0]=s,this.int16[q+1]=c,this.int16[q+2]=p,this.int16[q+3]=g,this.int16[q+4]=v,this.float32[J+3]=w,this.float32[J+4]=T,this.float32[J+5]=S,this.float32[J+6]=P,this.int16[q+14]=N,this.uint32[J+8]=F,this.uint16[q+18]=V,this.uint16[q+19]=j,i}}Pn.prototype.bytesPerElement=40,Kt(Pn,"StructArrayLayout5i4f1i1ul2ui40");class Jt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,c,p,g,v,w)}emplace(i,s,c,p,g,v,w,T){const S=8*i;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+4]=g,this.int16[S+5]=v,this.int16[S+6]=w,this.int16[S+7]=T,i}}Jt.prototype.bytesPerElement=16,Kt(Jt,"StructArrayLayout3i2i2i16");class vn extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=4*i,T=8*i;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[T+6]=g,this.int16[T+7]=v,i}}vn.prototype.bytesPerElement=16,Kt(vn,"StructArrayLayout2f1f2i16");class Kn extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=12*i,w=3*i;return this.uint8[v+0]=s,this.uint8[v+1]=c,this.float32[w+1]=p,this.float32[w+2]=g,i}}Kn.prototype.bytesPerElement=12,Kt(Kn,"StructArrayLayout2ub2f12");class Yn extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=p,i}}Yn.prototype.bytesPerElement=12,Kt(Yn,"StructArrayLayout3f12");class Wt extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=p,i}}Wt.prototype.bytesPerElement=6,Kt(Wt,"StructArrayLayout3ui6");class xi extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge){const me=this.length;return this.resize(me+1),this.emplace(me,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me){const $e=30*i,Ve=15*i,tt=60*i;return this.int16[$e+0]=s,this.int16[$e+1]=c,this.int16[$e+2]=p,this.float32[Ve+2]=g,this.float32[Ve+3]=v,this.uint16[$e+8]=w,this.uint16[$e+9]=T,this.uint32[Ve+5]=S,this.uint32[Ve+6]=P,this.uint32[Ve+7]=N,this.uint16[$e+16]=F,this.uint16[$e+17]=V,this.uint16[$e+18]=j,this.float32[Ve+10]=q,this.float32[Ve+11]=J,this.uint8[tt+48]=se,this.uint8[tt+49]=pe,this.uint8[tt+50]=ae,this.uint32[Ve+13]=de,this.int16[$e+28]=ge,this.uint8[tt+58]=me,i}}xi.prototype.bytesPerElement=60,Kt(xi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Pi extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me,$e,Ve,tt,yt,Ze,at,ot,ft){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me,$e,Ve,tt,yt,Ze,at,ot,ft)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me,$e,Ve,tt,yt,Ze,at,ot,ft,Dt){const Qe=38*i,Vt=19*i;return this.int16[Qe+0]=s,this.int16[Qe+1]=c,this.int16[Qe+2]=p,this.float32[Vt+2]=g,this.float32[Vt+3]=v,this.int16[Qe+8]=w,this.int16[Qe+9]=T,this.int16[Qe+10]=S,this.int16[Qe+11]=P,this.int16[Qe+12]=N,this.int16[Qe+13]=F,this.uint16[Qe+14]=V,this.uint16[Qe+15]=j,this.uint16[Qe+16]=q,this.uint16[Qe+17]=J,this.uint16[Qe+18]=se,this.uint16[Qe+19]=pe,this.uint16[Qe+20]=ae,this.uint16[Qe+21]=de,this.uint16[Qe+22]=ge,this.uint16[Qe+23]=me,this.uint16[Qe+24]=$e,this.uint16[Qe+25]=Ve,this.uint16[Qe+26]=tt,this.uint16[Qe+27]=yt,this.uint16[Qe+28]=Ze,this.uint32[Vt+15]=at,this.float32[Vt+16]=ot,this.float32[Vt+17]=ft,this.float32[Vt+18]=Dt,i}}Pi.prototype.bytesPerElement=76,Kt(Pi,"StructArrayLayout3i2f6i15ui1ul3f76");class Ri extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}Ri.prototype.bytesPerElement=4,Kt(Ri,"StructArrayLayout1f4");class Ei extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=5*i;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.float32[w+3]=g,this.float32[w+4]=v,i}}Ei.prototype.bytesPerElement=20,Kt(Ei,"StructArrayLayout5f20");class po extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=6*i;return this.uint32[3*i+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=p,this.uint16[v+4]=g,i}}po.prototype.bytesPerElement=12,Kt(po,"StructArrayLayout1ul3ui12");class oo extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.uint16[p+0]=s,this.uint16[p+1]=c,i}}oo.prototype.bytesPerElement=4,Kt(oo,"StructArrayLayout2ui4");class qo extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}qo.prototype.bytesPerElement=2,Kt(qo,"StructArrayLayout1ui2");class La extends ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.float32[p+0]=s,this.float32[p+1]=c,i}}La.prototype.bytesPerElement=8,Kt(La,"StructArrayLayout2f8");class fi extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}fi.prototype.size=40;class Ci extends Pn{get(i){return new fi(this,i)}}Kt(Ci,"CollisionBoxArray");class hi extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}hi.prototype.size=60;class Wn extends xi{get(i){return new hi(this,i)}}Kt(Wn,"PlacedSymbolArray");class mo extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}mo.prototype.size=76;class Li extends Pi{get(i){return new mo(this,i)}}Kt(Li,"SymbolInstanceArray");class Xi extends Ri{getoffsetX(i){return this.float32[1*i+0]}}Kt(Xi,"GlyphOffsetArray");class Lh extends vt{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Kt(Lh,"SymbolLineVertexArray");class Fl extends we{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fl.prototype.size=12;class ka extends po{get(i){return new Fl(this,i)}}Kt(ka,"FeatureIndexArray");class Or extends oo{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Kt(Or,"FillExtrusionCentroidArray");const zl=Ie([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mc=Ie([{name:"a_dash",components:4,type:"Uint16"}]);var kh={exports:{}},Km=function(o,i){var s,c,p,g,v,w,T,S;for(c=o.length-(s=3&o.length),p=i,v=3432918353,w=461845907,S=0;S<c;)T=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,p=27492+(65535&(g=5*(65535&(p=(p^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&o.charCodeAt(S+2))<<16;case 2:T^=(255&o.charCodeAt(S+1))<<8;case 1:p^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(S)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return p^=o.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},Ty=function(o,i){for(var s,c=o.length,p=i^c,g=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:p^=(255&o.charCodeAt(g+2))<<16;case 2:p^=(255&o.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&o.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};kh.exports=Km,kh.exports.murmur3=Km,kh.exports.murmur2=Ty;var op=he(kh.exports);class sp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,s,c,p){this.ids.push(qn(i)),this.positions.push(s,c,p)}getPositions(i){const s=qn(i);let c=0,p=this.ids.length-1;for(;c<p;){const v=c+p>>1;this.ids[v]>=s?p=v:c=v+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(i,s){const c=new Float64Array(i.ids),p=new Uint32Array(i.positions);return ap(c,p,0,c.length-1),s&&s.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(i){const s=new sp;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s}}function qn(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:op(String(o))}function ap(o,i,s,c){for(;s<c;){const p=o[s+c>>1];let g=s-1,v=c+1;for(;;){do{g++}while(o[g]<p);do{v--}while(o[v]>p);if(g>=v)break;Jm(o,g,v),Jm(i,3*g,3*v),Jm(i,3*g+1,3*v+1),Jm(i,3*g+2,3*v+2)}v-s<c-v?(ap(o,i,s,v),s=v+1):(ap(o,i,v+1,c),c=v)}}function Jm(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}Kt(sp,"FeaturePositionMap");class gc{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}}class lp extends gc{constructor(i){super(i),this.current=0}set(i,s,c){this.fetchUniformLocation(i,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Dy extends gc{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Qm extends gc{constructor(i){super(i),this.current=an.transparent}set(i,s,c){this.fetchUniformLocation(i,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Nh=new Float32Array(16),Ax=new Float32Array(9),Px=new Float32Array(4);function eg(o){return[be(255*o.r,255*o.g),be(255*o.b,255*o.a)]}class Vd{constructor(i,s,c){this.value=i,this.uniformNames=s.map(p=>`u_${p}`),this.type=c}setUniform(i,s,c,p,g){s.set(i,g,p.constantOr(this.value))}getBinding(i,s){return"color"===this.type?new Qm(i):new lp(i)}}class Fh{constructor(i,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,s,c,p,g){const v="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;v&&s.set(i,g,v)}getBinding(i,s){return"u_pattern"===s||"u_dash"===s?new Dy(i):new lp(i)}}class mt{constructor(i,s,c,p){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,s,c,p,g,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new R(0),s,{},g,p,v);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,s,c,p,g){const v=this.expression.evaluate({zoom:0},c,p,void 0,g);this._setPaintValue(i,s,v)}_setPaintValue(i,s,c){if("color"===this.type){const p=eg(c);for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=i;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(i,s,c,p,g,v){this.expression=i,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,s,c,p,g,v){const w=this.expression.evaluate(new R(this.zoom),s,{},g,p,v),T=this.expression.evaluate(new R(this.zoom+1),s,{},g,p,v),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,w,T)}updatePaintArray(i,s,c,p,g){const v=this.expression.evaluate({zoom:this.zoom},c,p,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,g);this._setPaintValue(i,s,v,w)}_setPaintValue(i,s,c,p){if("color"===this.type){const g=eg(c),v=eg(p);for(let w=i;w<s;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,c,p,g){const v=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,w=Cn(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);s.set(i,g,w)}getBinding(i,s){return new lp(i)}}class Yc{constructor(i,s,c,p,g){this.expression=i,this.layerId=g,this.paintVertexAttributes=("array"===c?mc:zl).members;for(let v=0;v<s.length;++v);this.paintVertexArray=new p}populatePaintArray(i,s,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(p,i,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(i,s,c,p,g,v){this._setPaintValues(i,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(i,s,c,p){if(!p||!c)return;const g=p[c];if(!g)return;const{tl:v,br:w,pixelRatio:T}=g;for(let S=i;S<s;S++)this.paintVertexArray.emplace(S,v[0],v[1],w[0],w[1],T)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kc{constructor(i,s,c=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const g in i.paint._values){if(!c(g))continue;const v=i.paint.get(g);if(!(v instanceof ne&&nl(v.property.specification)))continue;const w=Ud(g,i.type),T=v.value,S=v.property.specification.type,P=!!v.property.useIntegerZoom,N="line-dasharray"===g||g.endsWith("pattern"),F="line-dasharray"===g&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==T.kind||F)if("source"===T.kind||F||N){const V=cp(g,S,"source");this.binders[g]=N?new Yc(T,w,S,V,i.id):new mt(T,w,S,V),p.push(`/a_${g}`)}else{const V=cp(g,S,"composite");this.binders[g]=new Jn(T,w,S,P,s,V),p.push(`/z_${g}`)}else this.binders[g]=N?new Fh(T.value,w):new Vd(T.value,w,S),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof mt||s instanceof Jn?s.maxValue:0}populatePaintArrays(i,s,c,p,g,v){for(const w in this.binders){const T=this.binders[w];(T instanceof mt||T instanceof Jn||T instanceof Yc)&&T.populatePaintArray(i,s,c,p,g,v)}}setConstantPatternPositions(i){for(const s in this.binders){const c=this.binders[s];c instanceof Fh&&c.setConstantPatternPositions(i)}}updatePaintArrays(i,s,c,p,g,v){let w=!1;for(const T in i){const S=s.getPositions(T);for(const P of S){const N=c.feature(P.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof mt||V instanceof Jn||V instanceof Yc)&&!0===V.expression.isStateDependent){const j=p.paint.get(F);V.expression=j.value,V.updatePaintArray(P.start,P.end,N,i[T],g,v),w=!0}}}}return w}defines(){const i=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Vd||c instanceof Fh)&&i.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof mt||c instanceof Jn||c instanceof Yc)for(let p=0;p<c.paintVertexAttributes.length;p++)i.push(c.paintVertexAttributes[p].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Vd||c instanceof Fh||c instanceof Jn)for(const p of c.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Vd||p instanceof Fh||p instanceof Jn)for(const g of p.uniformNames)s.push({name:g,property:c,binding:p.getBinding(i,g)})}return s}setUniforms(i,s,c,p,g){for(const{name:v,property:w,binding:T}of c)this.binders[w].setUniform(i,T,g,p.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof mt||s instanceof Jn||s instanceof Yc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(i){for(const s in this.binders){const c=this.binders[s];(c instanceof mt||c instanceof Jn||c instanceof Yc)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof mt||s instanceof Jn||s instanceof Yc)&&s.destroy()}}}class Nr{constructor(i,s,c=(()=>!0)){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new Kc(p,s,c);this.needsUpload=!1,this._featureMap=new sp,this._bufferOffset=0}populatePaintArrays(i,s,c,p,g,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,s,p,g,v,w);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,c,p,g){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,s,v,p,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const My={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ud(o,i){return My[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const Bl={"line-pattern":{source:He,composite:He},"fill-pattern":{source:He,composite:He},"fill-extrusion-pattern":{source:He,composite:He},"line-dasharray":{source:rt,composite:rt}},tg={color:{source:La,composite:gt},number:{source:Ri,composite:La}};function cp(o,i,s){const c=Bl[o];return c&&c[s]||tg[i][s]}Kt(Vd,"ConstantBinder"),Kt(Fh,"PatternConstantBinder"),Kt(mt,"SourceExpressionBinder"),Kt(Yc,"PatternCompositeBinder"),Kt(Jn,"CompositeExpressionBinder"),Kt(Kc,"ProgramConfiguration",{omit:["_buffers"]}),Kt(Nr,"ProgramConfigurationSet");const Sy="-transition";class Vl extends Os{constructor(i,s){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),s.layout&&(this._unevaluatedLayout=new ie(s.layout)),s.paint)){this._transitionablePaint=new H(s.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new re(s.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s,c={}){null!=s&&this._validate(Nd,`layers.${this.id}.layout.${i}`,i,s,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,s):this.visibility=s)}getPaintProperty(i){return ui(i,Sy)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s,c={}){if(null!=s&&this._validate(Ys,`layers.${this.id}.paint.${i}`,i,s,c))return!1;if(ui(i,Sy))return this._transitionablePaint.setTransition(i.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[i],g=p.value.isDataDriven(),v=p.value;this._transitionablePaint.setValue(i,s),this._handleSpecialPaintPropertyUpdate(i);const w=this._transitionablePaint._values[i].value,T=w.isDataDriven(),S=ui(i,"pattern")||"line-dasharray"===i;return T||g||S||this._handleOverridablePaintPropertyUpdate(i,v,w)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,s,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Jo(i,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(i,s,c,p,g={}){return(!g||!1!==g.validate)&&Qf(this,i.call(Nu,{key:s,layerType:this.type,objectKey:c,value:p,styleSpec:Je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof ne&&nl(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Le(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Iy=Ie([{name:"a_pos",components:2,type:"Int16"}],4),as=Ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Fi{constructor(i=[]){this.segments=i}prepareSegment(i,s,c,p){let g=this.segments[this.segments.length-1];return i>Fi.MAX_VERTEX_ARRAY_LENGTH&&Zi(`Max vertices per segment is ${Fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>Fi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==p&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,c,p){return new Fi([{vertexOffset:i,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}Fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Kt(Fi,"SegmentVector");var pn=8192;class Js{constructor(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof pi?new pi(i.lng,i.lat):pi.convert(i),this}setSouthWest(i){return this._sw=i instanceof pi?new pi(i.lng,i.lat):pi.convert(i),this}extend(i){const s=this._sw,c=this._ne;let p,g;if(i instanceof pi)p=i,g=i;else{if(!(i instanceof Js))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Js.convert(i)):this.extend(pi.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(pi.convert(i)):this;if(p=i._sw,g=i._ne,!p||!g)return this}return s||c?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new pi(p.lng,p.lat),this._ne=new pi(g.lng,g.lat)),this}getCenter(){return new pi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pi(this.getWest(),this.getNorth())}getSouthEast(){return new pi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:c}=pi.convert(i);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(i){return!i||i instanceof Js?i:new Js(i)}}var Oa=1e-6,ws=typeof Float32Array<"u"?Float32Array:Array;function ng(){var o=new ws(9);return ws!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Ay(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=s[0],V=s[1],j=s[2],q=s[3],J=s[4],se=s[5],pe=s[6],ae=s[7],de=s[8];return o[0]=F*c+V*v+j*S,o[1]=F*p+V*w+j*P,o[2]=F*g+V*T+j*N,o[3]=q*c+J*v+se*S,o[4]=q*p+J*w+se*P,o[5]=q*g+J*T+se*N,o[6]=pe*c+ae*v+de*S,o[7]=pe*p+ae*w+de*P,o[8]=pe*g+ae*T+de*N,o}function cl(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function jd(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=i[4],w=i[5],T=i[6],S=i[7],P=i[8],N=i[9],F=i[10],V=i[11],j=i[12],q=i[13],J=i[14],se=i[15],pe=s*w-c*v,ae=s*T-p*v,de=s*S-g*v,ge=c*T-p*w,me=c*S-g*w,$e=p*S-g*T,Ve=P*q-N*j,tt=P*J-F*j,yt=P*se-V*j,Ze=N*J-F*q,at=N*se-V*q,ot=F*se-V*J,ft=pe*ot-ae*at+de*Ze+ge*yt-me*tt+$e*Ve;return ft?(o[0]=(w*ot-T*at+S*Ze)*(ft=1/ft),o[1]=(p*at-c*ot-g*Ze)*ft,o[2]=(q*$e-J*me+se*ge)*ft,o[3]=(F*me-N*$e-V*ge)*ft,o[4]=(T*yt-v*ot-S*tt)*ft,o[5]=(s*ot-p*yt+g*tt)*ft,o[6]=(J*de-j*$e-se*ae)*ft,o[7]=(P*$e-F*de+V*ae)*ft,o[8]=(v*at-w*yt+S*Ve)*ft,o[9]=(c*yt-s*at-g*Ve)*ft,o[10]=(j*me-q*de+se*pe)*ft,o[11]=(N*de-P*me-V*pe)*ft,o[12]=(w*tt-v*Ze-T*Ve)*ft,o[13]=(s*Ze-c*tt+p*Ve)*ft,o[14]=(q*ae-j*ge-J*pe)*ft,o[15]=(P*ge-N*ae+F*pe)*ft,o):null}function _c(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=i[9],V=i[10],j=i[11],q=i[12],J=i[13],se=i[14],pe=i[15],ae=s[0],de=s[1],ge=s[2],me=s[3];return o[0]=ae*c+de*w+ge*N+me*q,o[1]=ae*p+de*T+ge*F+me*J,o[2]=ae*g+de*S+ge*V+me*se,o[3]=ae*v+de*P+ge*j+me*pe,o[4]=(ae=s[4])*c+(de=s[5])*w+(ge=s[6])*N+(me=s[7])*q,o[5]=ae*p+de*T+ge*F+me*J,o[6]=ae*g+de*S+ge*V+me*se,o[7]=ae*v+de*P+ge*j+me*pe,o[8]=(ae=s[8])*c+(de=s[9])*w+(ge=s[10])*N+(me=s[11])*q,o[9]=ae*p+de*T+ge*F+me*J,o[10]=ae*g+de*S+ge*V+me*se,o[11]=ae*v+de*P+ge*j+me*pe,o[12]=(ae=s[12])*c+(de=s[13])*w+(ge=s[14])*N+(me=s[15])*q,o[13]=ae*p+de*T+ge*F+me*J,o[14]=ae*g+de*S+ge*V+me*se,o[15]=ae*v+de*P+ge*j+me*pe,o}function zh(o,i,s){var c,p,g,v,w,T,S,P,N,F,V,j,q=s[0],J=s[1],se=s[2];return i===o?(o[12]=i[0]*q+i[4]*J+i[8]*se+i[12],o[13]=i[1]*q+i[5]*J+i[9]*se+i[13],o[14]=i[2]*q+i[6]*J+i[10]*se+i[14],o[15]=i[3]*q+i[7]*J+i[11]*se+i[15]):(p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=i[9],V=i[10],j=i[11],o[0]=c=i[0],o[1]=p,o[2]=g,o[3]=v,o[4]=w,o[5]=T,o[6]=S,o[7]=P,o[8]=N,o[9]=F,o[10]=V,o[11]=j,o[12]=c*q+w*J+N*se+i[12],o[13]=p*q+T*J+F*se+i[13],o[14]=g*q+S*J+V*se+i[14],o[15]=v*q+P*J+j*se+i[15]),o}function yc(o,i,s){var c=s[0],p=s[1],g=s[2];return o[0]=i[0]*c,o[1]=i[1]*c,o[2]=i[2]*c,o[3]=i[3]*c,o[4]=i[4]*p,o[5]=i[5]*p,o[6]=i[6]*p,o[7]=i[7]*p,o[8]=i[8]*g,o[9]=i[9]*g,o[10]=i[10]*g,o[11]=i[11]*g,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o}function ig(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[4],v=i[5],w=i[6],T=i[7],S=i[8],P=i[9],N=i[10],F=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=g*p+S*c,o[5]=v*p+P*c,o[6]=w*p+N*c,o[7]=T*p+F*c,o[8]=S*p-g*c,o[9]=P*p-v*c,o[10]=N*p-w*c,o[11]=F*p-T*c,o}function $d(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[0],v=i[1],w=i[2],T=i[3],S=i[8],P=i[9],N=i[10],F=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*p-S*c,o[1]=v*p-P*c,o[2]=w*p-N*c,o[3]=T*p-F*c,o[8]=g*c+S*p,o[9]=v*c+P*p,o[10]=w*c+N*p,o[11]=T*c+F*p,o}function up(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function rg(o,i,s){var c,p,g,v=s[0],w=s[1],T=s[2],S=Math.hypot(v,w,T);return S<Oa?null:(v*=S=1/S,w*=S,T*=S,c=Math.sin(i),p=Math.cos(i),o[0]=v*v*(g=1-p)+p,o[1]=w*v*g+T*c,o[2]=T*v*g-w*c,o[3]=0,o[4]=v*w*g-T*c,o[5]=w*w*g+p,o[6]=T*w*g+v*c,o[7]=0,o[8]=v*T*g+w*c,o[9]=w*T*g-v*c,o[10]=T*T*g+p,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Py=_c;function hp(){var o=new ws(3);return ws!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function og(o){var i=new ws(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i}function Bu(o){return Math.hypot(o[0],o[1],o[2])}function Bh(o,i,s){var c=new ws(3);return c[0]=o,c[1]=i,c[2]=s,c}function vc(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o}function Lo(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o}function Jc(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o[2]=i[2]*s[2],o}function cr(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o[2]=Math.min(i[2],s[2]),o}function Hd(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o[2]=Math.max(i[2],s[2]),o}function Qs(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o}function Gd(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o}function Zo(o,i){var s=i[0],c=i[1],p=i[2],g=s*s+c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o}function ea(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}function dp(o,i,s){var c=i[0],p=i[1],g=i[2],v=s[0],w=s[1],T=s[2];return o[0]=p*T-g*w,o[1]=g*v-c*T,o[2]=c*w-p*v,o}function ur(o,i,s){var c=i[0],p=i[1],g=i[2],v=s[3]*c+s[7]*p+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*p+s[8]*g+s[12])/(v=v||1),o[1]=(s[1]*c+s[5]*p+s[9]*g+s[13])/v,o[2]=(s[2]*c+s[6]*p+s[10]*g+s[14])/v,o}function xc(o,i,s){var c=s[0],p=s[1],g=s[2],v=i[0],w=i[1],T=i[2],S=p*T-g*w,P=g*v-c*T,N=c*w-p*v,F=p*N-g*P,V=g*S-c*N,j=c*P-p*S,q=2*s[3];return P*=q,N*=q,V*=2,j*=2,o[0]=v+(S*=q)+(F*=2),o[1]=w+P+V,o[2]=T+N+j,o}var qd,Es=Lo,fp=Jc,pp=Bu;function mp(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o}function sg(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=s*s+c*c+p*p+g*g;return v>0&&(v=1/Math.sqrt(v)),o[0]=s*v,o[1]=c*v,o[2]=p*v,o[3]=g*v,o}function Qc(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3];return o[0]=s[0]*c+s[4]*p+s[8]*g+s[12]*v,o[1]=s[1]*c+s[5]*p+s[9]*g+s[13]*v,o[2]=s[2]*c+s[6]*p+s[10]*g+s[14]*v,o[3]=s[3]*c+s[7]*p+s[11]*g+s[15]*v,o}function Ry(){var o=new ws(4);return ws!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Vu(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Vh(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T+v*w,o[1]=p*T+g*w,o[2]=g*T-p*w,o[3]=v*T-c*w,o}function Ly(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T-g*w,o[1]=p*T+v*w,o[2]=g*T+c*w,o[3]=v*T-p*w,o}hp(),qd=new ws(4),ws!=Float32Array&&(qd[0]=0,qd[1]=0,qd[2]=0,qd[3]=0);var ME=sg;hp(),Bh(1,0,0),Bh(0,1,0),Ry(),Ry(),ng();const ag=Ie([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rx}=ag,ky=Ie([{name:"a_pos_3",components:3,type:"Int16"}]);var Zd=Ie([{name:"a_pos",type:"Int16",components:2}]);class Oy{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,c){const p=ea(s,this.dir);if(Math.abs(p)<1e-6)return!1;const g=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/p;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,s,c){if(q=(V=this.pos)[0],J=V[1],se=V[2],pe=(j=i)[0],ae=j[1],de=j[2],Math.abs(q-pe)<=Oa*Math.max(1,Math.abs(q),Math.abs(pe))&&Math.abs(J-ae)<=Oa*Math.max(1,Math.abs(J),Math.abs(ae))&&Math.abs(se-de)<=Oa*Math.max(1,Math.abs(se),Math.abs(de))||0===s)return c[0]=c[1]=c[2]=0,!1;var V,j,q,J,se,pe,ae,de;const[p,g,v]=this.dir,w=this.pos[0]-i[0],T=this.pos[1]-i[1],S=this.pos[2]-i[2],P=p*p+g*g+v*v,N=2*(w*p+T*g+S*v),F=N*N-4*P*(w*w+T*T+S*S-s*s);if(F<0){const V=Math.max(-N/2,0),j=w+p*V,q=T+g*V,J=S+v*V,se=Math.hypot(j,q,J);return c[0]=j*s/se,c[1]=q*s/se,c[2]=J*s/se,!1}{const V=(-N-Math.sqrt(F))/(2*P);if(V<0){const j=Math.hypot(w,T,S);return c[0]=w*s/j,c[1]=T*s/j,c[2]=S*s/j,!1}return c[0]=w+p*V,c[1]=T+g*V,c[2]=S+v*V,!0}}}class Ny{constructor(i,s,c,p,g){this.TL=i,this.TR=s,this.BR=c,this.BL=p,this.horizon=g}static fromInvProjectionMatrix(i,s,c){const p=[-1,1,1],g=[1,1,1],v=[1,-1,1],w=[-1,-1,1],T=ur(p,p,i),S=ur(g,g,i),P=ur(v,v,i),N=ur(w,w,i);return new Ny(T,S,P,N,s/c)}}class Wd{constructor(i,s){this.points=i,this.planes=s}static fromInvProjectionMatrix(i,s,c,p){const g=Math.pow(2,c),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const S=Qc([],T,i),P=1/S[3]/s*g;return(N=S)[0]=(F=S)[0]*(V=[P,P,p?1/S[3]:P,P])[0],N[1]=F[1]*V[1],N[2]=F[2]*V[2],N[3]=F[3]*V[3],N;var N,F,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const S=Zo([],dp([],Es([],v[T[0]],v[T[1]]),Es([],v[T[2]],v[T[1]]))),P=-ea(S,v[T[1]]);return S.concat(P)});return new Wd(v,w)}}class so{static fromPoints(i){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of i)cr(s,s,p),Hd(c,c,p);return new so(s,c)}static applyTransform(i,s){const c=i.getCorners();for(let p=0;p<c.length;++p)ur(c[p],c[p],s);return so.fromPoints(c)}constructor(i,s){this.min=i,this.max=s,this.center=Qs([],vc([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],c=og(this.min),p=og(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new so(c,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){const s=this.getCorners();let c=!0;for(let p=0;p<i.planes.length;p++){const g=i.planes[p];let v=0;for(let w=0;w<s.length;w++)v+=ea(g,s[w])+g[3]>=0;if(0===v)return 0;v!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<i.points.length;w++){const T=i.points[w][p]-this.min[p];g=Math.min(g,T),v=Math.max(v,T)}if(v<0||g>this.max[p]-this.min[p])return 0}return 1}}const lg=5,Uh=6,Na=pn/Math.PI/2,gp=16383,$h=[64,32,16],ta=-Na,Fa=Na,Ul=[new so([ta,ta,ta],[Fa,Fa,Fa]),new so([ta,ta,ta],[0,0,Fa]),new so([0,ta,ta],[Fa,0,Fa]),new so([ta,0,ta],[0,Fa,Fa]),new so([0,0,ta],[Fa,Fa,Fa])];function _p(o){return o*Na/eu}function Xd(o,i,s,c=!0){const p=Qs([],o._camera.position,o.worldSize),g=[i,s,1,1];Qc(g,g,o.pixelMatrixInverse),mp(g,g,1/g[3]);const v=Zo([],Es([],g,p)),w=o.globeMatrix,T=[w[12],w[13],w[14]],S=Es([],T,p),P=Bu(S),N=Zo([],S),F=o.worldSize/(2*Math.PI),V=ea(N,v),j=Math.asin(F/P);if(j<Math.acos(V)){if(!c)return null;const yt=[],Ze=[];Qs(yt,v,P/V),Zo(Ze,Es(Ze,yt,S)),Zo(v,vc(v,S,Qs(v,Ze,Math.tan(j)*P)))}const q=[];new Oy(p,v).closestPointOnSphere(T,F,q);const J=Zo([],da(w,0)),se=Zo([],da(w,1)),pe=Zo([],da(w,2)),ae=ea(J,q),de=ea(se,q),ge=ea(pe,q),me=En(Math.asin(-de/F));let $e=En(Math.atan2(ae,ge));$e=o.center.lng+function(yt,Ze){const at=(Ze-yt+180)%360-180;return at<-180?at+360:at}(o.center.lng,$e);const Ve=za($e),tt=Cn(ls(me),0,1);return new Kd(Ve,tt)}class cg{constructor(i,s,c){this.a=Es([],i,c),this.b=Es([],s,c),this.center=c;const p=Zo([],this.a),g=Zo([],this.b);this.angle=Math.acos(ea(p,g))}}function yp(o,i){if(0===o.angle)return null;let s;return s=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,p,g,v){const w=Math.sin(g);return c*(Math.sin((1-v)*g)/w)+p*(Math.sin(v*g)/w)}(o.a[i],o.b[i],o.angle,Cn(s,0,1))+o.center[i]}function na(o){if(o.z<=1)return Ul[o.z+2*o.y+o.x];const i=vp(Yd(o));return so.fromPoints(i)}function bc(o,i,s){return Qs(o,o,1-s),Gd(o,o,i,s)}function Fy(o,i){const s=ao(i.zoom);if(0===s)return na(o);const c=Yd(o),p=vp(c),g=za(c.getWest())*i.worldSize,v=za(c.getEast())*i.worldSize,w=ls(c.getNorth())*i.worldSize,T=ls(c.getSouth())*i.worldSize,S=[g,w,0],P=[v,w,0],N=[g,T,0],F=[v,T,0],V=jd([],i.globeMatrix);return ur(S,S,V),ur(P,P,V),ur(N,N,V),ur(F,F,V),p[0]=bc(p[0],N,s),p[1]=bc(p[1],F,s),p[2]=bc(p[2],P,s),p[3]=bc(p[3],S,s),so.fromPoints(p)}function ug(o,i,s){for(const c of o)ur(c,c,i),Qs(c,c,s)}function Yd({x:o,y:i,z:s}){const c=1/(1<<s),p=new pi(ra(o*c),ko((i+1)*c)),g=new pi(ra((o+1)*c),ko(i*c));return new Js(p,g)}function vp(o){const i=It(o.getNorth()),s=It(o.getSouth()),c=Math.cos(i),p=Math.cos(s),g=Math.sin(i),v=Math.sin(s),w=o.getWest(),T=o.getEast();return[Hh(p,v,w),Hh(p,v,T),Hh(c,g,T),Hh(c,g,w)]}function Hh(o,i,s,c=Na){return s=It(s),[o*Math.sin(s)*c,-i*c,o*Math.cos(s)*c]}function wc(o,i,s){return Hh(Math.cos(It(o)),Math.sin(It(o)),i,s)}function ul(o,i,s,c){const p=1<<s.z,g=(o/pn+s.x)/p;return wc(ko((i/pn+s.y)/p),ra(g),c)}function xp({min:o,max:i}){return gp/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const hg=new Float64Array(16);function Gh(o){const i=xp(o),s=up(hg,[i,i,i]);return zh(s,s,((c=[])[0]=-(p=o.min)[0],c[1]=-p[1],c[2]=-p[2],c));var c,p}function Uu(o){const i=(c=o.min,(s=hg)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;const p=1/xp(o);return yc(i,i,[p,p,p])}function By(o,i,s,c,p){const g=function(T){const S=pn/(2*Math.PI);return T/(2*Math.PI)/S}(s),v=[o,i,-s/(2*Math.PI)],w=cl(new Float64Array(16));return zh(w,w,v),yc(w,w,[g,g,g]),ig(w,w,It(-p)),$d(w,w,It(-c)),w}function ao(o){return bn(lg,Uh,o)}function Vy(o,i){const s=wc(i.lat,i.lng);return v=(p=Lo([],function(j){const q=wc(j._center.lat,j._center.lng);let J=dp([],Bh(0,1,0),q);const se=rg([],-j.angle,q);J=ur(J,J,se),rg(se,-j._pitch,J);const pe=Zo([],q);return Qs(pe,pe,_p(j.cameraToCenterDistance/j.pixelsPerMeter)),ur(pe,pe,se),vc([],q,pe)}(o),s))[0],w=p[1],T=p[2],S=(g=s)[0],P=g[1],N=g[2],V=(F=Math.sqrt(v*v+w*w+T*T)*Math.sqrt(S*S+P*P+N*N))&&ea(p,g)/F,Math.acos(Math.min(Math.max(V,-1),1));var p,g,v,w,T,S,P,N,F,V}function go(o,i){return Vy(o,i)>Math.PI/2*1.01}const bp=It(85),Lx=Math.cos(bp),Uy=Math.sin(bp),eu=6371008.8,ju=2*Math.PI*eu;class ia{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ia(Ji(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,c=this.lat*s,p=i.lat*s,g=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((i.lng-this.lng)*s);return eu*Math.acos(Math.min(g,1))}toBounds(i=0){const s=360*i/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Js(new ia(this.lng-c,this.lat-s),new ia(this.lng+c,this.lat+s))}toEcef(i){const s=_p(i);return wc(this.lat,this.lng,Na+s)}static convert(i){if(i instanceof ia)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new ia(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new ia(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var pi=ia;function wp(o){return ju*Math.cos(o*Math.PI/180)}function za(o){return(180+o)/360}function ls(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function jl(o,i){return o/wp(i)}function ra(o){return 360*o-180}function ko(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function kx(o,i){return o*wp(ko(i))}const Oo=85.051129;function Ox(o){return 1/Math.cos(o*Math.PI/180)}class Kd{constructor(i,s,c=0){this.x=+i,this.y=+s,this.z=+c}static fromLngLat(i,s=0){const c=pi.convert(i);return new Kd(za(c.lng),ls(c.lat),jl(s,c.lat))}toLngLat(){return new pi(ra(this.x),ko(this.y))}toAltitude(){return kx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ju*Ox(ko(this.y))}}function jy(o,i,s,c,p,g,v,w,T){const S=(i+c)/2,P=(s+p)/2,N=new Oe(S,P);w(N),function(F,V,j,q,J,se){const pe=j-J,ae=q-se;return Math.abs((q-V)*pe-(j-F)*ae)/Math.hypot(pe,ae)}(N.x,N.y,g.x,g.y,v.x,v.y)>=T?(jy(o,i,s,S,P,g,N,w,T),jy(o,S,P,c,p,N,v,w,T)):o.push(v)}function $u(o,i,s){let c=o[0],p=c.x,g=c.y;i(c);const v=[c];for(let w=1;w<o.length;w++){const T=o[w],{x:S,y:P}=T;i(T),jy(v,p,g,S,P,c,T,i,s),p=S,g=P,c=T}return v}function dg(o,i,s,c){if(c(i,s)){const p=i.add(s)._mult(.5);dg(o,i,p,c),dg(o,p,s,c)}else o.push(s)}function Nx(o,i){let s=o[0];const c=[s];for(let p=1;p<o.length;p++){const g=o[p];dg(c,s,g,i),s=g}return c}const Xr=Math.pow(2,14)-1,$y=-Xr-1;function Jd(o,i){const s=Math.round(o.x*i),c=Math.round(o.y*i);return o.x=Cn(s,$y,Xr),o.y=Cn(c,$y,Xr),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&Zi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ec(o,i,s){const c=o.loadGeometry(),p=o.extent,g=pn/p;if(i&&s&&s.projection.isReprojectedInTileSpace){const v=1<<i.z,{scale:w,x:T,y:S,projection:P}=s,N=F=>{const V=ra((i.x+F.x/p)/v),j=ko((i.y+F.y/p)/v),q=P.project(V,j);F.x=(q.x*w-T)*p,F.y=(q.y*w-S)*p};for(let F=0;F<c.length;F++)if(1!==o.type)c[F]=$u(c[F],N,1);else{const V=[];for(const j of c[F])j.x<0||j.x>=p||j.y<0||j.y>=p||(N(j),V.push(j));c[F]=V}}for(const v of c)for(const w of v)Jd(w,g);return c}function wo(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Ec(o):[]}}function Cc(o,i,s,c,p){o.emplaceBack(2*i+(c+1)/2,2*s+(p+1)/2)}function Qd(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class qh{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new vt,this.indexArray=new Wt,this.segments=new Fi,this.programConfigurations=new Nr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,p){const g=this.layers[0],v=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:N,sourceLayerIndex:F}of i){const V=this.layers[0]._featureFilter.needGeometry,j=wo(S,V);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),j,c))continue;const q=w?w.evaluate(j,{},c):void 0,J={id:P,properties:S.properties,type:S.type,sourceLayerIndex:F,index:N,geometry:V?j.geometry:Ec(S,c,p),patterns:{},sortKey:q};v.push(J)}w&&v.sort((S,P)=>S.sortKey-P.sortKey);let T=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new wt,T=p.projection);for(const S of v){const{geometry:P,index:N,sourceLayerIndex:F}=S,V=i[N].feature;this.addFeature(S,P,N,s.availableImages,c,T),s.featureIndex.insert(V,P,N,F,this.index)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Iy.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,as.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,s,c,p,g,v){for(const w of s)for(const T of w){const S=T.x,P=T.y;if(S<0||S>=pn||P<0||P>=pn)continue;if(v){const V=v.projectTilePoint(S,P,g),j=v.upVector(g,S,P),q=this.globeExtVertexArray;Qd(q,V,j),Qd(q,V,j),Qd(q,V,j),Qd(q,V,j)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),F=N.vertexLength;Cc(this.layoutVertexArray,S,P,-1,-1),Cc(this.layoutVertexArray,S,P,1,-1),Cc(this.layoutVertexArray,S,P,1,1),Cc(this.layoutVertexArray,S,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},p,g)}}function Zh(o,i){for(let s=0;s<o.length;s++)if(tu(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(tu(o,i[s]))return!0;return!!Hy(o,i)}function Fx(o,i,s){return!!tu(o,i)||!!ef(i,o,s)}function zx(o,i){if(1===o.length)return Vx(i,o[0]);for(let s=0;s<i.length;s++){const c=i[s];for(let p=0;p<c.length;p++)if(tu(o,c[p]))return!0}for(let s=0;s<o.length;s++)if(Vx(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(Hy(o,i[s]))return!0;return!1}function Bx(o,i,s){if(o.length>1){if(Hy(o,i))return!0;for(let c=0;c<i.length;c++)if(ef(i[c],o,s))return!0}for(let c=0;c<o.length;c++)if(ef(o[c],i,s))return!0;return!1}function Hy(o,i){if(0===o.length||0===i.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],p=o[s+1];for(let g=0;g<i.length-1;g++)if(oa(c,p,i[g],i[g+1]))return!0}return!1}function oa(o,i,s,c){return ho(o,s,c)!==ho(i,s,c)&&ho(o,i,s)!==ho(o,i,c)}function ef(o,i,s){const c=s*s;if(1===i.length)return o.distSqr(i[0])<c;for(let p=1;p<i.length;p++)if(Hu(o,i[p-1],i[p])<c)return!0;return!1}function Hu(o,i,s){const c=i.distSqr(s);if(0===c)return o.distSqr(i);const p=((o.x-i.x)*(s.x-i.x)+(o.y-i.y)*(s.y-i.y))/c;return o.distSqr(p<0?i:p>1?s:s.sub(i)._mult(p)._add(i))}function Vx(o,i){let s,c,p,g=!1;for(let v=0;v<o.length;v++){s=o[v];for(let w=0,T=s.length-1;w<s.length;T=w++)c=s[w],p=s[T],c.y>i.y!=p.y>i.y&&i.x<(p.x-c.x)*(i.y-c.y)/(p.y-c.y)+c.x&&(g=!g)}return g}function tu(o,i){let s=!1;for(let c=0,p=o.length-1;c<o.length;p=c++){const g=o[c],v=o[p];g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(s=!s)}return s}function Gy(o,i,s,c,p){for(const v of o)if(i<=v.x&&s<=v.y&&c>=v.x&&p>=v.y)return!0;const g=[new Oe(i,s),new Oe(i,p),new Oe(c,p),new Oe(c,s)];if(o.length>2)for(const v of g)if(tu(o,v))return!0;for(let v=0;v<o.length-1;v++)if(Ux(o[v],o[v+1],g))return!0;return!1}function Ux(o,i,s){const c=s[0],p=s[2];if(o.x<c.x&&i.x<c.x||o.x>p.x&&i.x>p.x||o.y<c.y&&i.y<c.y||o.y>p.y&&i.y>p.y)return!1;const g=ho(o,i,s[0]);return g!==ho(o,i,s[1])||g!==ho(o,i,s[2])||g!==ho(o,i,s[3])}function Wh(o,i,s){const c=i.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(i.id).getMaxValue(o)}function Ep(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function qy(o,i,s,c,p){if(!i[0]&&!i[1])return o;const g=Oe.convert(i)._mult(p);"viewport"===s&&g._rotate(-c);const v=[];for(let w=0;w<o.length;w++)v.push(o[w].sub(g));return v}function Zy(o,i,s,c){const p=Oe.convert(o)._mult(c);return"viewport"===i&&p._rotate(-s),p}Kt(qh,"CircleBucket",{omit:["layers"]});const fg=new ce({"circle-sort-key":new ee(Je.layout_circle["circle-sort-key"])});var Cp={paint:new ce({"circle-radius":new ee(Je.paint_circle["circle-radius"]),"circle-color":new ee(Je.paint_circle["circle-color"]),"circle-blur":new ee(Je.paint_circle["circle-blur"]),"circle-opacity":new ee(Je.paint_circle["circle-opacity"]),"circle-translate":new G(Je.paint_circle["circle-translate"]),"circle-translate-anchor":new G(Je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new G(Je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new G(Je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(Je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(Je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(Je.paint_circle["circle-stroke-opacity"])}),layout:fg};function Wy(o,i,s,c,p,g,v,w,T){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(T*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,P=s.projection.upVectorScale(S,s.center.lat,s.worldSize).metersToTile;for(const N of i)for(const F of N){const V=F.add(w),j=p&&s.elevation?s.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,q=s.projection.projectTilePoint(V.x,V.y,S);if(j>0){const ae=s.projection.upVector(S,V.x,V.y);q.x+=ae[0]*P*j,q.y+=ae[1]*P*j,q.z+=ae[2]*P*j}const J=g?V:Tp(q.x,q.y,q.z,c),se=g?o.tilespaceRays.map(ae=>jx(ae,j)):o.queryGeometry.screenGeometry,pe=Qc([],[q.x,q.y,q.z,1],c);if(!v&&g?T*=pe[3]/s.cameraToCenterDistance:v&&!g&&(T*=s.cameraToCenterDistance/pe[3]),g){const ae=ko((F.y/pn+S.y)/(1<<S.z));T/=s.projection.pixelsPerMeter(ae,1)/jl(1,ae)}if(Fx(se,J,T))return!0}return!1}function Tp(o,i,s,c){const p=Qc([],[o,i,s,1],c);return new Oe(p[0]/p[3],p[1]/p[3])}const Xy=Bh(0,0,0),Dp=Bh(0,0,1);function jx(o,i){const s=hp();return Xy[2]=i,o.intersectsPlane(Xy,Dp,s),new Oe(s[0],s[1])}class pg extends qh{}function Mp(o,{width:i,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*s*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*s*c);return o.width=i,o.height=s,o.data=p,o}function tf(o,i,s){const{width:c,height:p}=i;c===o.width&&p===o.height||(Sp(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,p)},s),o.width=c,o.height=p,o.data=i.data)}function Sp(o,i,s,c,p,g){if(0===p.width||0===p.height)return i;if(p.width>o.width||p.height>o.height||s.x>o.width-p.width||s.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||c.x>i.width-p.width||c.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,w=i.data;for(let T=0;T<p.height;T++){const S=((s.y+T)*o.width+s.x)*g,P=((c.y+T)*i.width+c.x)*g;for(let N=0;N<p.width*g;N++)w[P+N]=v[S+N]}return i}Kt(pg,"HeatmapBucket",{omit:["layers"]});class Tc{constructor(i,s){Mp(this,i,1,s)}resize(i){tf(this,new Tc(i),1)}clone(){return new Tc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,p,g){Sp(i,s,c,p,g,1)}}class Cs{constructor(i,s){Mp(this,i,4,s)}resize(i){tf(this,new Cs(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,p,g){Sp(i,s,c,p,g,4)}}Kt(Tc,"AlphaImage"),Kt(Cs,"RGBAImage");var Xh={paint:new ce({"heatmap-radius":new ee(Je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(Je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new G(Je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new le(Je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new G(Je.paint_heatmap["heatmap-opacity"])})};function Gu(o){const i={},s=o.resolution||256,c=o.clips?o.clips.length:1,p=o.image||new Cs({width:s,height:c}),g=(v,w,T)=>{i[o.evaluationKey]=T;const S=o.expression.evaluate(i);p.data[v+w+0]=Math.floor(255*S.r/S.a),p.data[v+w+1]=Math.floor(255*S.g/S.a),p.data[v+w+2]=Math.floor(255*S.b/S.a),p.data[v+w+3]=Math.floor(255*S.a)};if(o.clips)for(let v=0,w=0;v<c;++v,w+=4*s)for(let T=0,S=0;T<s;T++,S+=4){const P=T/(s-1),{start:N,end:F}=o.clips[v];g(w,S,N*(1-P)+F*P)}else for(let v=0,w=0;v<s;v++,w+=4)g(0,w,v/(s-1));return p}var $x={paint:new ce({"hillshade-illumination-direction":new G(Je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new G(Je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new G(Je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new G(Je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new G(Je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new G(Je.paint_hillshade["hillshade-accent-color"])})};const SE=Ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yy}=SE;var mg={exports:{}};function gg(o,i,s){s=s||2;var c,p,g,v,w,T,S,P=i&&i.length,N=P?i[0]*s:o.length,F=Ky(o,0,N,s,!0),V=[];if(!F||F.next===F.prev)return V;if(P&&(F=function(q,J,se,pe){var ae,de,ge,me=[];for(ae=0,de=J.length;ae<de;ae++)(ge=Ky(q,J[ae]*pe,ae<de-1?J[ae+1]*pe:q.length,pe,!1))===ge.next&&(ge.steiner=!0),me.push(Gx(ge));for(me.sort(IE),ae=0;ae<me.length;ae++)se=ev(me[ae],se);return se}(o,i,F,s)),o.length>80*s){c=g=o[0],p=v=o[1];for(var j=s;j<N;j+=s)(w=o[j])<c&&(c=w),(T=o[j+1])<p&&(p=T),w>g&&(g=w),T>v&&(v=T);S=0!==(S=Math.max(g-c,v-p))?32767/S:0}return nf(F,V,s,c,p,S,0),V}function Ky(o,i,s,c,p){var g,v;if(p===Pp(o,i,s,c)>0)for(g=i;g<s;g+=c)v=tv(g,o[g],o[g+1],v);else for(g=s-c;g>=i;g-=c)v=tv(g,o[g],o[g+1],v);return v&&Yh(v,v.next)&&(iu(v),v=v.next),v}function qu(o,i){if(!o)return o;i||(i=o);var s,c=o;do{if(s=!1,c.steiner||!Yh(c,c.next)&&0!==Br(c.prev,c,c.next))c=c.next;else{if(iu(c),(c=i=c.prev)===c.next)break;s=!0}}while(s||c!==i);return i}function nf(o,i,s,c,p,g,v){if(o){!v&&g&&function(P,N,F,V){var j=P;do{0===j.z&&(j.z=_g(j.x,j.y,N,F,V)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function(q){var J,se,pe,ae,de,ge,me,$e,Ve=1;do{for(se=q,q=null,de=null,ge=0;se;){for(ge++,pe=se,me=0,J=0;J<Ve&&(me++,pe=pe.nextZ);J++);for($e=Ve;me>0||$e>0&&pe;)0!==me&&(0===$e||!pe||se.z<=pe.z)?(ae=se,se=se.nextZ,me--):(ae=pe,pe=pe.nextZ,$e--),de?de.nextZ=ae:q=ae,ae.prevZ=de,de=ae;se=pe}de.nextZ=null,Ve*=2}while(ge>1)}(j)}(o,c,p,g);for(var w,T,S=o;o.prev!==o.next;)if(w=o.prev,T=o.next,g?Jy(o,c,p,g):Ip(o))i.push(w.i/s|0),i.push(o.i/s|0),i.push(T.i/s|0),iu(o),o=T.next,S=T.next;else if((o=T)===S){v?1===v?nf(o=Hx(qu(o),i,s),i,s,c,p,g,2):2===v&&Qy(o,i,s,c,p,g):nf(qu(o),i,s,c,p,g,1);break}}}function Ip(o){var i=o.prev,s=o,c=o.next;if(Br(i,s,c)>=0)return!1;for(var p=i.x,g=s.x,v=c.x,w=i.y,T=s.y,S=c.y,P=p<g?p<v?p:v:g<v?g:v,N=w<T?w<S?w:S:T<S?T:S,F=p>g?p>v?p:v:g>v?g:v,V=w>T?w>S?w:S:T>S?T:S,j=c.next;j!==i;){if(j.x>=P&&j.x<=F&&j.y>=N&&j.y<=V&&nu(p,w,g,T,v,S,j.x,j.y)&&Br(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Jy(o,i,s,c){var p=o.prev,g=o,v=o.next;if(Br(p,g,v)>=0)return!1;for(var w=p.x,T=g.x,S=v.x,P=p.y,N=g.y,F=v.y,V=w<T?w<S?w:S:T<S?T:S,j=P<N?P<F?P:F:N<F?N:F,q=w>T?w>S?w:S:T>S?T:S,J=P>N?P>F?P:F:N>F?N:F,se=_g(V,j,i,s,c),pe=_g(q,J,i,s,c),ae=o.prevZ,de=o.nextZ;ae&&ae.z>=se&&de&&de.z<=pe;){if(ae.x>=V&&ae.x<=q&&ae.y>=j&&ae.y<=J&&ae!==p&&ae!==v&&nu(w,P,T,N,S,F,ae.x,ae.y)&&Br(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=V&&de.x<=q&&de.y>=j&&de.y<=J&&de!==p&&de!==v&&nu(w,P,T,N,S,F,de.x,de.y)&&Br(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=se;){if(ae.x>=V&&ae.x<=q&&ae.y>=j&&ae.y<=J&&ae!==p&&ae!==v&&nu(w,P,T,N,S,F,ae.x,ae.y)&&Br(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=pe;){if(de.x>=V&&de.x<=q&&de.y>=j&&de.y<=J&&de!==p&&de!==v&&nu(w,P,T,N,S,F,de.x,de.y)&&Br(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Hx(o,i,s){var c=o;do{var p=c.prev,g=c.next.next;!Yh(p,g)&&qx(p,c,c.next,g)&&Ap(p,g)&&Ap(g,p)&&(i.push(p.i/s|0),i.push(c.i/s|0),i.push(g.i/s|0),iu(c),iu(c.next),c=o=g),c=c.next}while(c!==o);return qu(c)}function Qy(o,i,s,c,p,g){var v=o;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&PE(v,w)){var T=Zx(v,w);return v=qu(v,v.next),T=qu(T,T.next),nf(v,i,s,c,p,g,0),void nf(T,i,s,c,p,g,0)}w=w.next}v=v.next}while(v!==o)}function IE(o,i){return o.x-i.x}function ev(o,i){var s=function(p,g){var v,w=g,T=p.x,S=p.y,P=-1/0;do{if(S<=w.y&&S>=w.next.y&&w.next.y!==w.y){var N=w.x+(S-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(N<=T&&N>P&&(P=N,v=w.x<w.next.x?w:w.next,N===T))return v}w=w.next}while(w!==g);if(!v)return null;var F,V=v,j=v.x,q=v.y,J=1/0;w=v;do{T>=w.x&&w.x>=j&&T!==w.x&&nu(S<q?T:P,S,j,q,S<q?P:T,S,w.x,w.y)&&(F=Math.abs(S-w.y)/(T-w.x),Ap(w,p)&&(F<J||F===J&&(w.x>v.x||w.x===v.x&&AE(v,w)))&&(v=w,J=F)),w=w.next}while(w!==V);return v}(o,i);if(!s)return i;var c=Zx(s,o);return qu(c,c.next),qu(s,s.next)}function AE(o,i){return Br(o.prev,o,i.prev)<0&&Br(i.next,o,o.next)<0}function _g(o,i,s,c,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-c)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Gx(o){var i=o,s=o;do{(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next}while(i!==o);return s}function nu(o,i,s,c,p,g,v,w){return(p-v)*(i-w)>=(o-v)*(g-w)&&(o-v)*(c-w)>=(s-v)*(i-w)&&(s-v)*(g-w)>=(p-v)*(c-w)}function PE(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(s,c){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&qx(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(o,i)&&(Ap(o,i)&&Ap(i,o)&&function(s,c){var p=s,g=!1,v=(s.x+c.x)/2,w=(s.y+c.y)/2;do{p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next}while(p!==s);return g}(o,i)&&(Br(o.prev,o,i.prev)||Br(o,i.prev,i))||Yh(o,i)&&Br(o.prev,o,o.next)>0&&Br(i.prev,i,i.next)>0)}function Br(o,i,s){return(i.y-o.y)*(s.x-i.x)-(i.x-o.x)*(s.y-i.y)}function Yh(o,i){return o.x===i.x&&o.y===i.y}function qx(o,i,s,c){var p=vg(Br(o,i,s)),g=vg(Br(o,i,c)),v=vg(Br(s,c,o)),w=vg(Br(s,c,i));return p!==g&&v!==w||!(0!==p||!yg(o,s,i))||!(0!==g||!yg(o,c,i))||!(0!==v||!yg(s,o,c))||!(0!==w||!yg(s,i,c))}function yg(o,i,s){return i.x<=Math.max(o.x,s.x)&&i.x>=Math.min(o.x,s.x)&&i.y<=Math.max(o.y,s.y)&&i.y>=Math.min(o.y,s.y)}function vg(o){return o>0?1:o<0?-1:0}function Ap(o,i){return Br(o.prev,o,o.next)<0?Br(o,i,o.next)>=0&&Br(o,o.prev,i)>=0:Br(o,i,o.prev)<0||Br(o,o.next,i)<0}function Zx(o,i){var s=new Kh(o.i,o.x,o.y),c=new Kh(i.i,i.x,i.y),p=o.next,g=i.prev;return o.next=i,i.prev=o,s.next=p,p.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function tv(o,i,s,c){var p=new Kh(o,i,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function iu(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Kh(o,i,s){this.i=o,this.x=i,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pp(o,i,s,c){for(var p=0,g=i,v=s-c;g<s;g+=c)p+=(o[v]-o[g])*(o[g+1]+o[v+1]),v=g;return p}mg.exports=gg,mg.exports.default=gg,gg.deviation=function(o,i,s,c){var p=i&&i.length,g=Math.abs(Pp(o,0,p?i[0]*s:o.length,s));if(p)for(var v=0,w=i.length;v<w;v++)g-=Math.abs(Pp(o,i[v]*s,v<w-1?i[v+1]*s:o.length,s));var T=0;for(v=0;v<c.length;v+=3){var S=c[v]*s,P=c[v+1]*s,N=c[v+2]*s;T+=Math.abs((o[S]-o[N])*(o[P+1]-o[S+1])-(o[S]-o[P])*(o[N+1]-o[S+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},gg.flatten=function(o){for(var i=o[0][0].length,s={vertices:[],holes:[],dimensions:i},c=0,p=0;p<o.length;p++){for(var g=0;g<o[p].length;g++)for(var v=0;v<i;v++)s.vertices.push(o[p][g][v]);p>0&&s.holes.push(c+=o[p-1].length)}return s};var Rp=he(mg.exports);function nv(o,i,s,c,p){Zu(o,i,s||0,c||o.length-1,p||iv)}function Zu(o,i,s,c,p){for(;c>s;){if(c-s>600){var g=c-s+1,v=i-s+1,w=Math.log(g),T=.5*Math.exp(2*w/3),S=.5*Math.sqrt(w*T*(g-T)/g)*(v-g/2<0?-1:1);Zu(o,i,Math.max(s,Math.floor(i-v*T/g+S)),Math.min(c,Math.floor(i+(g-v)*T/g+S)),p)}var P=o[i],N=s,F=c;for(Jh(o,s,i),p(o[c],P)>0&&Jh(o,s,c);N<F;){for(Jh(o,N,F),N++,F--;p(o[N],P)<0;)N++;for(;p(o[F],P)>0;)F--}0===p(o[s],P)?Jh(o,s,F):Jh(o,++F,c),F<=i&&(s=F+1),i<=F&&(c=F-1)}}function Jh(o,i,s){var c=o[i];o[i]=o[s],o[s]=c}function iv(o,i){return o<i?-1:o>i?1:0}function Qh(o,i){const s=o.length;if(s<=1)return[o];const c=[];let p,g;for(let v=0;v<s;v++){const w=ec(o[v]);0!==w&&(o[v].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(p&&c.push(p),p=[o[v]]):p.push(o[v]))}if(p&&c.push(p),i>1)for(let v=0;v<c.length;v++)c[v].length<=i||(nv(c[v],i,1,c[v].length-1,Lp),c[v]=c[v].slice(0,i));return c}function Lp(o,i){return i.area-o.area}function $l(o,i,s){const c=s.patternDependencies;let p=!1;for(const g of i){const v=g.paint.get(`${o}-pattern`);v.isConstant()||(p=!0);const w=v.constantOr(null);w&&(p=!0,c[w]=!0)}return p}function xg(o,i,s,c,p){const g=p.patternDependencies;for(const v of i){const w=v.paint.get(`${o}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:c},s,{},p.availableImages);T=T&&T.name?T.name:T,g[T]=!0,s.patterns[v.id]=T}}return s}class kp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vt,this.indexArray=new Wt,this.indexArray2=new oo,this.programConfigurations=new Nr(i.layers,i.zoom),this.segments=new Fi,this.segments2=new Fi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection}populate(i,s,c,p){this.hasPattern=$l("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:T,index:S,sourceLayerIndex:P}of i){const N=this.layers[0]._featureFilter.needGeometry,F=wo(w,N);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),F,c))continue;const V=g?g.evaluate(F,{},c,s.availableImages):void 0,j={id:T,properties:w.properties,type:w.type,sourceLayerIndex:P,index:S,geometry:N?F.geometry:Ec(w,c,p),patterns:{},sortKey:V};v.push(j)}g&&v.sort((w,T)=>w.sortKey-T.sortKey);for(const w of v){const{geometry:T,index:S,sourceLayerIndex:P}=w;if(this.hasPattern){const N=xg("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(w,T,S,c,{},s.availableImages);s.featureIndex.insert(i[S].feature,T,S,P,this.index)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}addFeatures(i,s,c,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Yy),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,s,c,p,g,v=[]){for(const w of Qh(s,500)){let T=0;for(const j of w)T+=j.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=S.vertexLength,N=[],F=[];for(const j of w){if(0===j.length)continue;j!==w[0]&&F.push(N.length/2);const q=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(J+j.length-1,J),N.push(j[0].x),N.push(j[0].y);for(let se=1;se<j.length;se++)this.layoutVertexArray.emplaceBack(j[se].x,j[se].y),this.indexArray2.emplaceBack(J+se-1,J+se),N.push(j[se].x),N.push(j[se].y);q.vertexLength+=j.length,q.primitiveLength+=j.length}const V=Rp(N,F);for(let j=0;j<V.length;j+=3)this.indexArray.emplaceBack(P+V[j],P+V[j+1],P+V[j+2]);S.vertexLength+=T,S.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}}Kt(kp,"FillBucket",{omit:["layers","patternFeatures"]});const Wx=new ce({"fill-sort-key":new ee(Je.layout_fill["fill-sort-key"])});var rv={paint:new ce({"fill-antialias":new G(Je.paint_fill["fill-antialias"]),"fill-opacity":new ee(Je.paint_fill["fill-opacity"]),"fill-color":new ee(Je.paint_fill["fill-color"]),"fill-outline-color":new ee(Je.paint_fill["fill-outline-color"]),"fill-translate":new G(Je.paint_fill["fill-translate"]),"fill-translate-anchor":new G(Je.paint_fill["fill-translate-anchor"]),"fill-pattern":new ee(Je.paint_fill["fill-pattern"])}),layout:Wx};const bg=Ie([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Xx=Ie([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Yx=Ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Kx}=bg;var rf={},Jx=Re,ov=_o;function _o(o,i,s,c,p){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=p,o.readFields(wg,this,i)}function wg(o,i,s){1==o?i.id=s.readVarint():2==o?function(c,p){for(var g=c.readVarint()+c.pos;c.pos<g;){var v=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[v]=w}}(s,i):3==o?i.type=s.readVarint():4==o&&(i._geometry=s.pos)}function sv(o){for(var i,s,c=0,p=0,g=o.length,v=g-1;p<g;v=p++)c+=((s=o[v]).x-(i=o[p]).x)*(i.y+s.y);return c}_o.types=["Unknown","Point","LineString","Polygon"],_o.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,s=o.readVarint()+o.pos,c=1,p=0,g=0,v=0,w=[];o.pos<s;){if(p<=0){var T=o.readVarint();c=7&T,p=T>>3}if(p--,1===c||2===c)g+=o.readSVarint(),v+=o.readSVarint(),1===c&&(i&&w.push(i),i=[]),i.push(new Jx(g,v));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&w.push(i),w},_o.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,s=1,c=0,p=0,g=0,v=1/0,w=-1/0,T=1/0,S=-1/0;o.pos<i;){if(c<=0){var P=o.readVarint();s=7&P,c=P>>3}if(c--,1===s||2===s)(p+=o.readSVarint())<v&&(v=p),p>w&&(w=p),(g+=o.readSVarint())<T&&(T=g),g>S&&(S=g);else if(7!==s)throw new Error("unknown command "+s)}return[v,T,w,S]},_o.prototype.toGeoJSON=function(o,i,s){var c,p,g=this.extent*Math.pow(2,s),v=this.extent*o,w=this.extent*i,T=this.loadGeometry(),S=_o.types[this.type];function P(V){for(var j=0;j<V.length;j++){var q=V[j];V[j]=[360*(q.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(c=0;c<T.length;c++)N[c]=T[c][0];P(T=N);break;case 2:for(c=0;c<T.length;c++)P(T[c]);break;case 3:for(T=function(V){var j=V.length;if(j<=1)return[V];for(var q,J,se=[],pe=0;pe<j;pe++){var ae=sv(V[pe]);0!==ae&&(void 0===J&&(J=ae<0),J===ae<0?(q&&se.push(q),q=[V[pe]]):q.push(V[pe]))}return q&&se.push(q),se}(T),c=0;c<T.length;c++)for(p=0;p<T[c].length;p++)P(T[c][p])}1===T.length?T=T[0]:S="Multi"+S;var F={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(F.id=this.id),F};var Eg=ov,No=ed;function ed(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(av,this,i),this.length=this._features.length}function av(o,i,s){15===o?i.version=s.readVarint():1===o?i.name=s.readString():5===o?i.extent=s.readVarint():2===o?i._features.push(s.pos):3===o?i._keys.push(s.readString()):4===o&&i._values.push(function(c){for(var p=null,g=c.readVarint()+c.pos;c.pos<g;){var v=c.readVarint()>>3;p=1===v?c.readString():2===v?c.readFloat():3===v?c.readDouble():4===v?c.readVarint64():5===v?c.readVarint():6===v?c.readSVarint():7===v?c.readBoolean():null}return p}(s))}ed.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new Eg(this._pbf,i,this.extent,this._keys,this._values)};var lv=No;function Qx(o,i,s){if(3===o){var c=new lv(s,s.readVarint()+s.pos);c.length&&(i[c.name]=c)}}var Op=rf.VectorTile=function(o,i){this.layers=o.readFields(Qx,{},i)},Np=rf.VectorTileFeature=ov;function sf(o,i,s,c){const p=[],g=0===c?(v,w,T,S,P,N)=>{v.push(new Oe(N,T+(N-w)/(S-w)*(P-T)))}:(v,w,T,S,P,N)=>{v.push(new Oe(w+(N-T)/(P-T)*(S-w),N))};for(const v of o){const w=[];for(const T of v){if(T.length<=2)continue;const S=[];for(let F=0;F<T.length-1;F++){const V=T[F].x,j=T[F].y,q=T[F+1].x,J=T[F+1].y,se=0===c?V:j,pe=0===c?q:J;se<i?pe>i&&g(S,V,j,q,J,i):se>s?pe<s&&g(S,V,j,q,J,s):S.push(T[F]),pe<i&&se>=i&&g(S,V,j,q,J,i),pe>s&&se<=s&&g(S,V,j,q,J,s)}let P=T[T.length-1];const N=0===c?P.x:P.y;N>=i&&N<=s&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),w.push(S))}w.length&&p.push(w)}return p}rf.VectorTileLayer=No;const eb=Np.types,cv=Math.pow(2,13);function af(o,i,s,c,p,g,v,w){o.emplaceBack((i<<1)+v,(s<<1)+g,(Math.floor(c*cv)<<1)+p,Math.round(w))}function lf(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Fp{constructor(){this.acc=new Oe(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Oe(i.x,i.y),this.max=new Oe(i.x,i.y))}append(i,s){this.currentPolyCount.edges++,this.acc._add(i);const c=this.min,p=this.max;i.x<c.x?c.x=i.x:i.x>p.x&&(p.x=i.x),i.y<c.y?c.y=i.y:i.y>p.y&&(p.y=i.y),((0===i.x||i.x===pn)&&i.x===s.x)!=((0===i.y||i.y===pn)&&i.y===s.y)&&this.processBorderOverlap(i,s),s.x<0!=i.x<0&&this.addBorderIntersection(0,oi(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>pn!=i.x>pn&&this.addBorderIntersection(1,oi(s.y,i.y,(pn-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,oi(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>pn!=i.y>pn&&this.addBorderIntersection(3,oi(s.x,i.x,(pn-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==i?this.acc.div(i)._round():new Oe(0,0)}span(){return new Oe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0)}}class Wu{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new st,this.centroidVertexArray=new Or,this.indexArray=new Wt,this.programConfigurations=new Nr(i.layers,i.zoom),this.segments=new Fi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=i.enableTerrain}populate(i,s,c,p){this.features=[],this.hasPattern=$l("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const v=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*v/(v*v+1)/pn/(1<<g.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:v,index:w,sourceLayerIndex:T}of i){const S=this.layers[0]._featureFilter.needGeometry,P=wo(g,S);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),P,c))continue;const N={id:v,sourceLayerIndex:T,index:w,geometry:S?P.geometry:Ec(g,c,p),properties:g.properties,type:g.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(xg("fill-extrusion",this.layers,N,this.zoom,s)):this.addFeature(N,N.geometry,w,c,{},s.availableImages,p),s.featureIndex.insert(g,N.geometry,w,T,this.index,F)}this.sortBorders()}addFeatures(i,s,c,p,g){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,s,c,p,g)}this.sortBorders()}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Kx),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Yx.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Xx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,c,p,g,v,w){const T=[new Oe(0,0),new Oe(pn,pn)],S=w.projection,P="globe"===S.name,N=this.enableTerrain&&!P?new Fp:null,F="Polygon"===eb[i.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new wt);const V=Qh(s,500);for(let se=V.length-1;se>=0;se--){const pe=V[se];(0===pe.length||(j=pe[0]).every(ae=>ae.x<=0)||j.every(ae=>ae.x>=pn)||j.every(ae=>ae.y<=0)||j.every(ae=>ae.y>=pn))&&V.splice(se,1)}var j;let q;if(P)q=Xu(V,T,p);else{q=[];for(const se of V)q.push({polygon:se,bounds:T})}const J=F?this.edgeRadius:0;for(const{polygon:se,bounds:pe}of q){let ae=0,de=0;for(const me of se)F&&!me[0].equals(me[me.length-1])&&me.push(me[0]),de+=F?me.length-1:me.length;const ge=this.segments.prepareSegment((F?5:4)*de,this.layoutVertexArray,this.indexArray);if(F){const me=[],$e=[];ae=ge.vertexLength;for(const tt of se){let yt,Ze;tt.length&&tt!==se[0]&&$e.push(me.length/2),yt=tt[1].sub(tt[0])._perp()._unit();for(let at=1;at<tt.length;at++){const ot=tt[at],ft=tt[at===tt.length-1?1:at+1];let{x:Dt,y:Qe}=ot;if(J){Ze=ft.sub(ot)._perp()._unit();const Vt=yt.add(Ze)._unit(),en=J*Math.min(4,1/(yt.x*Vt.x+yt.y*Vt.y));Dt+=en*Vt.x,Qe+=en*Vt.y,yt=Ze}af(this.layoutVertexArray,Dt,Qe,0,0,1,1,0),ge.vertexLength++,me.push(ot.x,ot.y),P&&lf(this.layoutVertexExtArray,S.projectTilePoint(Dt,Qe,p),S.upVector(p,Dt,Qe))}}const Ve=Rp(me,$e);for(let tt=0;tt<Ve.length;tt+=3)this.indexArray.emplaceBack(ae+Ve[tt],ae+Ve[tt+2],ae+Ve[tt+1]),ge.primitiveLength++}for(const me of se){N&&me.length&&N.startRing(me[0]);let $e,Ve,tt,yt=me.length>4&&Cg(me[me.length-2],me[0],me[1]),Ze=J?cf(me[me.length-2],me[0],me[1],J):0;Ve=me[1].sub(me[0])._perp()._unit();let at=!0;for(let ot=1,ft=0;ot<me.length;ot++){let Dt=me[ot-1],Qe=me[ot];const Vt=me[ot===me.length-1?1:ot+1];if(N&&F&&N.currentPolyCount.top++,dv(Qe,Dt,pe)){J&&(Ve=Vt.sub(Qe)._perp()._unit(),at=!at);continue}N&&N.append(Qe,Dt);const en=Qe.sub(Dt)._perp(),Ut=en.x/(Math.abs(en.x)+Math.abs(en.y)),zn=en.y>0?1:0,St=Dt.dist(Qe);if(ft+St>32768&&(ft=0),J){tt=Vt.sub(Qe)._perp()._unit();let $n=hv(Dt,Qe,Vt,uv(Ve,tt),J);isNaN($n)&&($n=0);const wn=Qe.sub(Dt)._unit();Dt=Dt.add(wn.mult(Ze))._round(),Qe=Qe.add(wn.mult(-$n))._round(),Ze=$n,Ve=tt}const mn=ge.vertexLength,Bn=me.length>4&&Cg(Dt,Qe,Vt);let mi=Tg(ft,yt,at);if(af(this.layoutVertexArray,Dt.x,Dt.y,Ut,zn,0,0,mi),af(this.layoutVertexArray,Dt.x,Dt.y,Ut,zn,0,1,mi),ft+=St,mi=Tg(ft,Bn,!at),yt=Bn,af(this.layoutVertexArray,Qe.x,Qe.y,Ut,zn,0,0,mi),af(this.layoutVertexArray,Qe.x,Qe.y,Ut,zn,0,1,mi),ge.vertexLength+=4,this.indexArray.emplaceBack(mn+0,mn+1,mn+2),this.indexArray.emplaceBack(mn+1,mn+3,mn+2),ge.primitiveLength+=2,J){const $n=ae+(1===ot?me.length-2:ot-2),wn=1===ot?ae:$n+1;if(this.indexArray.emplaceBack(mn+1,$n,mn+3),this.indexArray.emplaceBack($n,wn,mn+3),ge.primitiveLength+=2,void 0===$e&&($e=mn),!dv(Vt,me[ot],pe)){const Bi=ot===me.length-1?$e:ge.vertexLength;this.indexArray.emplaceBack(mn+2,mn+3,Bi),this.indexArray.emplaceBack(mn+3,Bi+1,Bi),this.indexArray.emplaceBack(mn+3,wn,Bi+1),ge.primitiveLength+=3}at=!at}if(P){const $n=this.layoutVertexExtArray,wn=S.projectTilePoint(Dt.x,Dt.y,p),Bi=S.projectTilePoint(Qe.x,Qe.y,p),Zn=S.upVector(p,Dt.x,Dt.y),On=S.upVector(p,Qe.x,Qe.y);lf($n,wn,Zn),lf($n,wn,Zn),lf($n,Bi,On),lf($n,Bi,On)}}F&&(ae+=me.length-1)}}if(N&&N.polyCount.length>0){if(N.borders){N.vertexArrayOffset=this.centroidVertexArray.length;const se=N.borders,pe=this.featuresOnBorder.push(N)-1;for(let ae=0;ae<4;ae++)se[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(pe)}this.encodeCentroid(N.borders?void 0:N.centroid(),N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((s,c)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,s,c=!0){let p,g;if(i)if(0!==i.y){const w=s.span()._mult(this.tileToMeter);p=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else p=Math.ceil(7*(i.x+450)),g=0;else p=0,g=+c;let v=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const w of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(v++,p,g);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(v++,0,g),this.centroidVertexArray.emplace(v++,p,g)}}}function uv(o,i){const s=o.add(i)._unit();return o.x*s.x+o.y*s.y}function cf(o,i,s,c){const p=i.sub(o)._perp()._unit(),g=s.sub(i)._perp()._unit();return hv(o,i,s,uv(p,g),c)}function hv(o,i,s,c,p){const g=Math.sqrt(1-c*c);return Math.min(o.dist(i)/3,i.dist(s)/3,p*g/c)}function dv(o,i,s){return o.x<s[0].x&&i.x<s[0].x||o.x>s[1].x&&i.x>s[1].x||o.y<s[0].y&&i.y<s[0].y||o.y>s[1].y&&i.y>s[1].y}function Cg(o,i,s){if(o.x<0||o.x>=pn||i.x<0||i.x>=pn||s.x<0||s.x>=pn)return!1;const c=s.sub(i),p=c.perp(),g=o.sub(i);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&p.x*g.x+p.y*g.y<0}function Tg(o,i,s){const c=i?2|o:-3&o;return s?1|c:-2&c}function Dg(){const o=Math.PI/32,i=Math.tan(o),s=eu;return s*Math.sqrt(1+2*i*i)-s}function Xu(o,i,s){const c=1<<s.z,p=ra(s.x/c),g=ra((s.x+1)/c),v=ko(s.y/c),w=ko((s.y+1)/c);return function(T,S,P,N,F=0,V){const j=[];if(!T.length||!P||!N)return j;const q=(me,$e)=>{for(const Ve of me)j.push({polygon:Ve,bounds:$e})},J=Math.ceil(Math.log2(P)),se=Math.ceil(Math.log2(N)),pe=J-se,ae=[];for(let me=0;me<Math.abs(pe);me++)ae.push(pe>0?0:1);for(let me=0;me<Math.min(J,se);me++)ae.push(0),ae.push(1);let de=T;if(de=sf(de,S[0].y-F,S[1].y+F,1),de=sf(de,S[0].x-F,S[1].x+F,0),!de.length)return j;const ge=[];for(ae.length?ge.push({polygons:de,bounds:S,depth:0}):q(de,S);ge.length;){const me=ge.pop(),$e=me.depth,Ve=ae[$e],tt=me.bounds[0],yt=me.bounds[1],Ze=0===Ve?tt.x:tt.y,at=0===Ve?yt.x:yt.y,ot=V?V(Ve,Ze,at):.5*(Ze+at),ft=sf(me.polygons,Ze-F,ot+F,Ve),Dt=sf(me.polygons,ot-F,at+F,Ve);if(ft.length){const Qe=[tt,new Oe(0===Ve?ot:yt.x,1===Ve?ot:yt.y)];ae.length>$e+1?ge.push({polygons:ft,bounds:Qe,depth:$e+1}):q(ft,Qe)}if(Dt.length){const Qe=[new Oe(0===Ve?ot:tt.x,1===Ve?ot:tt.y),yt];ae.length>$e+1?ge.push({polygons:Dt,bounds:Qe,depth:$e+1}):q(Dt,Qe)}}return j}(o,i,Math.ceil((g-p)/11.25),Math.ceil((v-w)/11.25),1,(T,S,P)=>{if(0===T)return.5*(S+P);{const N=ko((s.y+S/pn)/c);return(ls(.5*(ko((s.y+P/pn)/c)+N))*c-s.y)*pn}})}Kt(Wu,"FillExtrusionBucket",{omit:["layers","features"]}),Kt(Fp,"PartMetadata");const zp=new ce({"fill-extrusion-edge-radius":new G(Je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var fv={paint:new ce({"fill-extrusion-opacity":new G(Je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(Je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new G(Je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new G(Je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ee(Je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(Je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(Je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new G(Je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new G(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new G(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new G(Je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:zp};function Bp(o,i,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class Yu{constructor(i,s,c){this.z=i,this.x=s,this.y=c,this.key=uf(0,i,i,s,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,s){const c=(v=this.y,w=this.z,T=Bp(256*(g=this.x),256*(v=Math.pow(2,w)-v-1),w),S=Bp(256*(g+1),256*(v+1),w),T[0]+","+T[1]+","+S[0]+","+S[1]),p=function(g,v,w){let T,S="";for(let P=g;P>0;P--)T=1<<P-1,S+=(v&T?1:0)+(w&T?2:0);return S}(this.z,this.x,this.y);var g,v,w,T,S;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pv{constructor(i,s){this.wrap=i,this.canonical=s,this.key=uf(i,s.z,s.z,s.x,s.y)}}class Wo{constructor(i,s,c,p,g){this.overscaledZ=i,this.wrap=s,this.canonical=new Yu(c,+p,+g),this.key=0===s&&i===c?this.canonical.key:uf(s,i,c,p,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new Wo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wo(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return uf(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return uf(this.wrap*+s,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new Wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Wo(s,this.wrap,s,c,p),new Wo(s,this.wrap,s,c+1,p),new Wo(s,this.wrap,s,c,p+1),new Wo(s,this.wrap,s,c+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Wo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uf(o,i,s,c,p){const g=1<<Math.min(s,22);let v=g*(p%g)+c%g;return o&&s<22&&(v+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*v+s)+(i-s)}Kt(Yu,"CanonicalTileID"),Kt(Wo,"OverscaledTileID",{omit:["projMatrix"]});class td extends Oe{constructor(i,s,c){super(i,s),this.z=c}}function hf(o,i){return o.x*i.x+o.y*i.y}function mv(o,i){if(1===o.length){let s=0;const c=i[s++];let p;for(;!p||c.equals(p);)if(p=i[s++],!p)return 1/0;for(;s<i.length;s++){const g=i[s],v=o[0],w=p.sub(c),T=g.sub(c),S=v.sub(c),P=hf(w,w),N=hf(w,T),F=hf(T,T),V=hf(S,w),j=hf(S,T),q=P*F-N*N,J=(F*V-N*j)/q,se=(P*j-N*V)/q,pe=c.z*(1-J-se)+p.z*J+g.z*se;if(isFinite(pe))return pe}return 1/0}{let s=1/0;for(const c of i)s=Math.min(s,c.z);return s}}function Mg(o,i,s,c,p,g,v,w){const T=v*p.getElevationAt(o,i,!0,!0),S=0!==g[0],P=S?0===g[1]?v*(g[0]/7-450):v*function(N,F,V){const j=Math.floor(F[0]/8),q=Math.floor(F[1]/8),J=10*(F[0]-8*j),se=10*(F[1]-8*q),pe=N.getElevationAt(j,q,!0,!0),ae=N.getMeterToDEM(V),de=Math.floor(.5*(J*ae-1)),ge=Math.floor(.5*(se*ae-1)),me=N.tileCoordToPixel(j,q),$e=2*de+1,Ve=2*ge+1,tt=(en=$e,Ut=Ve,[(Dt=N).getElevationAtPixel(Qe=me.x-de,Vt=me.y-ge,!0),Dt.getElevationAtPixel(Qe+Ut,Vt,!0),Dt.getElevationAtPixel(Qe,Vt+Ut,!0),Dt.getElevationAtPixel(Qe+en,Vt+Ut,!0)]),yt=Math.abs(tt[0]-tt[1]),Ze=Math.abs(tt[2]-tt[3]),at=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),ot=Math.min(.25,.5*ae*(yt+Ze)/$e),ft=Math.min(.25,.5*ae*at/Ve);var Dt,Qe,Vt,en,Ut;return pe+Math.max(ot*J,ft*se)}(p,g,w):T;return{base:T+(0===s)?-1:s,top:S?Math.max(P+c,T+s+2):T+c}}const Vp=Ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Sg}=Vp,Ig=Ie([{name:"a_packed",components:4,type:"Float32"}]),{members:tb}=Ig,nb=Np.types,Ag=Math.cos(Math.PI/180*37.5);class df{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Xe,this.layoutVertexArray2=new gt,this.indexArray=new Wt,this.programConfigurations=new Nr(i.layers,i.zoom),this.segments=new Fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,p){this.hasPattern=$l("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:P,id:N,index:F,sourceLayerIndex:V}of i){const j=this.layers[0]._featureFilter.needGeometry,q=wo(P,j);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),q,c))continue;const J=g?g.evaluate(q,{},c):void 0,se={id:N,properties:P.properties,type:P.type,sourceLayerIndex:V,index:F,geometry:j?q.geometry:Ec(P,c,p),patterns:{},sortKey:J};v.push(se)}g&&v.sort((P,N)=>P.sortKey-N.sortKey);const{lineAtlas:w,featureIndex:T}=s,S=this.addConstantDashes(w);for(const P of v){const{geometry:N,index:F,sourceLayerIndex:V}=P;if(S&&this.addFeatureDashes(P,w),this.hasPattern){const j=xg("line",this.layers,P,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(P,N,F,c,w.positions,s.availableImages);T.insert(i[F].feature,N,F,V,this.index)}}addConstantDashes(i){let s=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==g.kind)s=!0;else{const v=g.value,w=p.value;if(!w)continue;i.addDash(w,v)}}return s}addFeatureDashes(i,s){const c=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===v.kind)continue;let w,T;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:c},i);T="constant"===v.kind?v.value:v.evaluate({zoom:c},i),s.addDash(w,T),i.patterns[p.id]=s.getKey(w,T)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}addFeatures(i,s,c,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,tb)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Sg),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,c,p,g,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),S=w.get("line-cap").evaluate(i,{}),P=w.get("line-miter-limit"),N=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const F of s)this.addLine(F,i,T,S,P,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}addLine(i,s,c,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<i.length-1;se++)this.totalDistance+=i[se].dist(i[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===nb[s.type];let T=i.length;for(;T>=2&&i[T-1].equals(i[T-2]);)T--;let S=0;for(;S<T-1&&i[S].equals(i[S+1]);)S++;if(T<(w?3:2))return;"bevel"===c&&(g=1.05);const P=this.overscaling<=16?15*pn/(512*this.overscaling):0,N=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let F,V,j,q,J;this.e1=this.e2=-1,w&&(F=i[T-2],J=i[S].sub(F)._unit()._perp());for(let se=S;se<T;se++){if(j=se===T-1?w?i[S+1]:void 0:i[se+1],j&&i[se].equals(j))continue;J&&(q=J),F&&(V=F),F=i[se],J=j?j.sub(F)._unit()._perp():q,q=q||J;let pe=q.add(J);0===pe.x&&0===pe.y||pe._unit();const ae=q.x*J.x+q.y*J.y,de=pe.x*J.x+pe.y*J.y,ge=0!==de?1/de:1/0,me=2*Math.sqrt(2-2*de),$e=de<Ag&&V&&j,Ve=q.x*J.y-q.y*J.x>0;if($e&&se>S){const Ze=F.dist(V);if(Ze>2*P){const at=F.sub(F.sub(V)._mult(P/Ze)._round());this.updateDistance(V,at),this.addCurrentVertex(at,q,0,0,N),V=at}}const tt=V&&j;let yt=tt?c:w?"butt":p;if(tt&&"round"===yt&&(ge<v?yt="miter":ge<=2&&(yt="fakeround")),"miter"===yt&&ge>g&&(yt="bevel"),"bevel"===yt&&(ge>2&&(yt="flipbevel"),ge<g&&(yt="miter")),V&&this.updateDistance(V,F),"miter"===yt)pe._mult(ge),this.addCurrentVertex(F,pe,0,0,N);else if("flipbevel"===yt){if(ge>100)pe=J.mult(-1);else{const Ze=ge*q.add(J).mag()/q.sub(J).mag();pe._perp()._mult(Ze*(Ve?-1:1))}this.addCurrentVertex(F,pe,0,0,N),this.addCurrentVertex(F,pe.mult(-1),0,0,N)}else if("bevel"===yt||"fakeround"===yt){const Ze=-Math.sqrt(ge*ge-1),at=Ve?Ze:0,ot=Ve?0:Ze;if(V&&this.addCurrentVertex(F,q,at,ot,N),"fakeround"===yt){const ft=Math.round(180*me/Math.PI/20);for(let Dt=1;Dt<ft;Dt++){let Qe=Dt/ft;if(.5!==Qe){const en=Qe-.5;Qe+=Qe*en*(Qe-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*en*en+(.848013+ae*(.215638*ae-1.06021)))}const Vt=J.sub(q)._mult(Qe)._add(q)._unit()._mult(Ve?-1:1);this.addHalfVertex(F,Vt.x,Vt.y,!1,Ve,0,N)}}j&&this.addCurrentVertex(F,J,-at,-ot,N)}else if("butt"===yt)this.addCurrentVertex(F,pe,0,0,N);else if("square"===yt){const Ze=V?1:-1;V||this.addCurrentVertex(F,pe,Ze,Ze,N),this.addCurrentVertex(F,pe,0,0,N),V&&this.addCurrentVertex(F,pe,Ze,Ze,N)}else"round"===yt&&(V&&(this.addCurrentVertex(F,q,0,0,N),this.addCurrentVertex(F,q,1,1,N,!0)),j&&(this.addCurrentVertex(F,J,-1,-1,N,!0),this.addCurrentVertex(F,J,0,0,N)));if($e&&se<T-1){const Ze=F.dist(j);if(Ze>2*P){const at=F.add(j.sub(F)._mult(P/Ze)._round());this.updateDistance(F,at),this.addCurrentVertex(at,J,0,0,N),F=at}}}}addCurrentVertex(i,s,c,p,g,v=!1){const w=s.y*p-s.x,T=-s.y-s.x*p;this.addHalfVertex(i,s.x+s.y*c,s.y-s.x*c,v,!1,c,g),this.addHalfVertex(i,w,T,v,!0,-p,g)}addHalfVertex({x:i,y:s},c,p,g,v,w,T){this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(s<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),T.primitiveLength++),v?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,s){this.distance+=i.dist(s),this.updateScaledDistance()}}Kt(df,"LineBucket",{omit:["layers","patternFeatures"]});const Ku=new ce({"line-cap":new ee(Je.layout_line["line-cap"]),"line-join":new ee(Je.layout_line["line-join"]),"line-miter-limit":new G(Je.layout_line["line-miter-limit"]),"line-round-limit":new G(Je.layout_line["line-round-limit"]),"line-sort-key":new ee(Je.layout_line["line-sort-key"])});var Pg={paint:new ce({"line-opacity":new ee(Je.paint_line["line-opacity"]),"line-color":new ee(Je.paint_line["line-color"]),"line-translate":new G(Je.paint_line["line-translate"]),"line-translate-anchor":new G(Je.paint_line["line-translate-anchor"]),"line-width":new ee(Je.paint_line["line-width"]),"line-gap-width":new ee(Je.paint_line["line-gap-width"]),"line-offset":new ee(Je.paint_line["line-offset"]),"line-blur":new ee(Je.paint_line["line-blur"]),"line-dasharray":new ee(Je.paint_line["line-dasharray"]),"line-pattern":new ee(Je.paint_line["line-pattern"]),"line-gradient":new le(Je.paint_line["line-gradient"]),"line-trim-offset":new G(Je.paint_line["line-trim-offset"])}),layout:Ku};const Rg=new class extends ee{possiblyEvaluate(o,i){return i=new R(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,s,c){return i=ni({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,s,c)}}(Pg.paint.properties["line-width"].specification);function gv(o,i){return i>0?i+2*o:o}Rg.useIntegerZoom=!0;const RE=Ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Up=Ie([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ib=Ie([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _v=Ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),yv=Ie([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Lg=Ie([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kg=Ie([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ie([{name:"triangle",components:3,type:"Uint16"}]),Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ie([{type:"Float32",name:"offsetX"}]),Ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var lo=24;const Ts=128;function Ju(o,i){const{expression:s}=i;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new R(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let v=g;for(;v<c.length&&c[v]<o+1;)v++;v=Math.min(c.length-1,v);const w=c[g],T=c[v];return"composite"===s.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:T,minSize:s.evaluate(new R(w)),maxSize:s.evaluate(new R(T)),interpolationType:p}}}function ff(o,{uSize:i,uSizeT:s},{lowerSize:c,upperSize:p}){return"source"===o.kind?c/Ts:"composite"===o.kind?oi(c/Ts,p/Ts,s):i}function ru(o,i){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:p,minZoom:g,maxZoom:v}=o,w=p?Cn(ps.interpolationFactor(p,i,g,v),0,1):0;"camera"===o.kind?c=oi(o.minSize,o.maxSize,w):s=w}return{uSizeT:s,uSize:c}}var jp=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ts,evaluateSizeForFeature:ff,evaluateSizeForZoom:ru,getSizeData:Ju});function vv(o,i,s){return o.sections.forEach(c=>{c.text=function(p,g,v){const w=g.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?p=p.toLocaleUpperCase():"lowercase"===w&&(p=p.toLocaleLowerCase()),A.applyArabicShaping&&(p=A.applyArabicShaping(p)),p}(c.text,i,s)}),o}const Qu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function pf(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function rb(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Og=zi,xv=function(o,i,s,c,p){var g,v,w=8*p-c-1,T=(1<<w)-1,S=T>>1,P=-7,N=s?p-1:0,F=s?-1:1,V=o[i+N];for(N+=F,g=V&(1<<-P)-1,V>>=-P,P+=w;P>0;g=256*g+o[i+N],N+=F,P-=8);for(v=g&(1<<-P)-1,g>>=-P,P+=c;P>0;v=256*v+o[i+N],N+=F,P-=8);if(0===g)g=1-S;else{if(g===T)return v?NaN:1/0*(V?-1:1);v+=Math.pow(2,c),g-=S}return(V?-1:1)*v*Math.pow(2,g-c)},bv=function(o,i,s,c,p,g){var v,w,T,S=8*g-p-1,P=(1<<S)-1,N=P>>1,F=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,V=c?0:g-1,j=c?1:-1,q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,v=P):(v=Math.floor(Math.log(i)/Math.LN2),i*(T=Math.pow(2,-v))<1&&(v--,T*=2),(i+=v+N>=1?F/T:F*Math.pow(2,1-N))*T>=2&&(v++,T/=2),v+N>=P?(w=0,v=P):v+N>=1?(w=(i*T-1)*Math.pow(2,p),v+=N):(w=i*Math.pow(2,N-1)*Math.pow(2,p),v=0));p>=8;o[s+V]=255&w,V+=j,w/=256,p-=8);for(v=v<<p|w,S+=p;S>0;o[s+V]=255&v,V+=j,v/=256,S-=8);o[s+V-j]|=128*q};function zi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}zi.Varint=0,zi.Fixed64=1,zi.Bytes=2,zi.Fixed32=5;var $p=4294967296,Ng=1/$p,mf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function hl(o){return o.type===zi.Bytes?o.readVarint()+o.pos:o.pos+1}function wv(o,i,s){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(c);for(var p=s.pos-1;p>=o;p--)s.buf[p+c]=s.buf[p]}function ob(o,i){for(var s=0;s<o.length;s++)i.writeVarint(o[s])}function LE(o,i){for(var s=0;s<o.length;s++)i.writeSVarint(o[s])}function sb(o,i){for(var s=0;s<o.length;s++)i.writeFloat(o[s])}function Fg(o,i){for(var s=0;s<o.length;s++)i.writeDouble(o[s])}function ab(o,i){for(var s=0;s<o.length;s++)i.writeBoolean(o[s])}function nd(o,i){for(var s=0;s<o.length;s++)i.writeFixed32(o[s])}function Hp(o,i){for(var s=0;s<o.length;s++)i.writeSFixed32(o[s])}function zg(o,i){for(var s=0;s<o.length;s++)i.writeFixed64(o[s])}function Ev(o,i){for(var s=0;s<o.length;s++)i.writeSFixed64(o[s])}function gf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function eh(o,i,s){o[s]=i,o[s+1]=i>>>8,o[s+2]=i>>>16,o[s+3]=i>>>24}function Bg(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}zi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),p=c>>3,g=this.pos;this.type=7&c,o(p,i,this),this.pos===g&&this.skip(c)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=gf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Bg(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=gf(this.buf,this.pos)+gf(this.buf,this.pos+4)*$p;return this.pos+=8,o},readSFixed64:function(){var o=gf(this.buf,this.pos)+Bg(this.buf,this.pos+4)*$p;return this.pos+=8,o},readFloat:function(){var o=xv(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=xv(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,s,c=this.buf;return i=127&(s=c[this.pos++]),s<128?i:(i|=(127&(s=c[this.pos++]))<<7,s<128?i:(i|=(127&(s=c[this.pos++]))<<14,s<128?i:(i|=(127&(s=c[this.pos++]))<<21,s<128?i:function(p,g,v){var w,T,S=v.buf;if(w=(112&(T=S[v.pos++]))>>4,T<128||(w|=(127&(T=S[v.pos++]))<<3,T<128)||(w|=(127&(T=S[v.pos++]))<<10,T<128)||(w|=(127&(T=S[v.pos++]))<<17,T<128)||(w|=(127&(T=S[v.pos++]))<<24,T<128)||(w|=(1&(T=S[v.pos++]))<<31,T<128))return function dl(o,i,s){return s?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(p,w,g);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&mf?mf.decode(this.buf.subarray(i,o)):function(s,c,p){for(var g="",v=c;v<p;){var w,T,S,P=s[v],N=null,F=P>239?4:P>223?3:P>191?2:1;if(v+F>p)break;1===F?P<128&&(N=P):2===F?128==(192&(w=s[v+1]))&&(N=(31&P)<<6|63&w)<=127&&(N=null):3===F?(T=s[v+2],128==(192&(w=s[v+1]))&&128==(192&T)&&((N=(15&P)<<12|(63&w)<<6|63&T)<=2047||N>=55296&&N<=57343)&&(N=null)):4===F&&(T=s[v+2],S=s[v+3],128==(192&(w=s[v+1]))&&128==(192&T)&&128==(192&S)&&((N=(15&P)<<18|(63&w)<<12|(63&T)<<6|63&S)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,F=1):N>65535&&(N-=65536,g+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),g+=String.fromCharCode(N),v+=F}return g}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==zi.Bytes)return o.push(this.readVarint(i));var s=hl(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==zi.Bytes)return o.push(this.readSVarint());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==zi.Bytes)return o.push(this.readBoolean());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==zi.Bytes)return o.push(this.readFloat());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==zi.Bytes)return o.push(this.readDouble());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==zi.Bytes)return o.push(this.readFixed32());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==zi.Bytes)return o.push(this.readSFixed32());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==zi.Bytes)return o.push(this.readFixed64());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==zi.Bytes)return o.push(this.readSFixed64());var i=hl(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===zi.Varint)for(;this.buf[this.pos++]>127;);else if(i===zi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===zi.Fixed32)this.pos+=4;else{if(i!==zi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),eh(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),eh(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),eh(this.buf,-1&o,this.pos),eh(this.buf,Math.floor(o*Ng),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),eh(this.buf,-1&o,this.pos),eh(this.buf,Math.floor(o*Ng),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,s){var c,p,g,w;if(i>=0?(c=i%4294967296|0,p=i/4294967296|0):(p=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,p=p+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),g=c,(w=s).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(c,p,g){for(var v,w,T=0;T<p.length;T++){if((v=p.charCodeAt(T))>55295&&v<57344){if(!w){v>56319||T+1===p.length?(c[g++]=239,c[g++]=191,c[g++]=189):w=v;continue}if(v<56320){c[g++]=239,c[g++]=191,c[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(c[g++]=239,c[g++]=191,c[g++]=189,w=null);v<128?c[g++]=v:(v<2048?c[g++]=v>>6|192:(v<65536?c[g++]=v>>12|224:(c[g++]=v>>18|240,c[g++]=v>>12&63|128),c[g++]=v>>6&63|128),c[g++]=63&v|128)}return g}(this.buf,o,this.pos);var s=this.pos-i;s>=128&&wv(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),bv(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),bv(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var s=0;s<i;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,i){this.pos++;var s=this.pos;o(i,this);var c=this.pos-s;c>=128&&wv(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,i,s){this.writeTag(o,zi.Bytes),this.writeRawMessage(i,s)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,ob,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,LE,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,ab,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,sb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,Fg,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,nd,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,Hp,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,zg,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,Ev,i)},writeBytesField:function(o,i){this.writeTag(o,zi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,zi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,zi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,zi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,zi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,zi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,zi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,zi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,zi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,zi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var Gp=he(Og);const Vg=3;function lb(o,i,s){i.glyphs=[],1===o&&s.readMessage(cb,i)}function cb(o,i,s){if(3===o){const{id:c,bitmap:p,width:g,height:v,left:w,top:T,advance:S}=s.readMessage(ub,{});i.glyphs.push({id:c,bitmap:new Tc({width:g+2*Vg,height:v+2*Vg},p),metrics:{width:g,height:v,left:w,top:T,advance:S}})}else 4===o?i.ascender=s.readSVarint():5===o&&(i.descender=s.readSVarint())}function ub(o,i,s){1===o?i.id=s.readVarint():2===o?i.bitmap=s.readBytes():3===o?i.width=s.readVarint():4===o?i.height=s.readVarint():5===o?i.left=s.readSVarint():6===o?i.top=s.readSVarint():7===o&&(i.advance=s.readVarint())}const Dc=Vg;function th(o){let i=0,s=0;for(const v of o)i+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,w)=>w.h-v.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let p=0,g=0;for(const v of o)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===T.w&&v.h===T.h){const S=c.pop();w<c.length&&(c[w]=S)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(c.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:p,h:g,fill:i/(p*g)||0}}const cs=1;class Cv{constructor(i,{pixelRatio:s,version:c,stretchX:p,stretchY:g,content:v}){this.paddedRect=i,this.pixelRatio=s,this.stretchX=p,this.stretchY=g,this.content=v,this.version=c}get tl(){return[this.paddedRect.x+cs,this.paddedRect.y+cs]}get br(){return[this.paddedRect.x+this.paddedRect.w-cs,this.paddedRect.y+this.paddedRect.h-cs]}get displaySize(){return[(this.paddedRect.w-2*cs)/this.pixelRatio,(this.paddedRect.h-2*cs)/this.pixelRatio]}}class hb{constructor(i,s){const c={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,c,g),this.addImages(s,p,g);const{w:v,h:w}=th(g),T=new Cs({width:v||1,height:w||1});for(const S in i){const P=i[S],N=c[S].paddedRect;Cs.copy(P.data,T,{x:0,y:0},{x:N.x+cs,y:N.y+cs},P.data)}for(const S in s){const P=s[S],N=p[S].paddedRect,F=N.x+cs,V=N.y+cs,j=P.data.width,q=P.data.height;Cs.copy(P.data,T,{x:0,y:0},{x:F,y:V},P.data),Cs.copy(P.data,T,{x:0,y:q-1},{x:F,y:V-1},{width:j,height:1}),Cs.copy(P.data,T,{x:0,y:0},{x:F,y:V+q},{width:j,height:1}),Cs.copy(P.data,T,{x:j-1,y:0},{x:F-1,y:V},{width:1,height:q}),Cs.copy(P.data,T,{x:0,y:0},{x:F+j,y:V},{width:1,height:q})}this.image=T,this.iconPositions=c,this.patternPositions=p}addImages(i,s,c){for(const p in i){const g=i[p],v={x:0,y:0,w:g.data.width+2*cs,h:g.data.height+2*cs};c.push(v),s[p]=new Cv(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>i.hasImage(c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),s)}patchUpdatedImage(i,s,c){if(!i||!s||i.version===s.version)return;i.version=s.version;const[p,g]=i.tl;c.update(s.data,void 0,{x:p,y:g})}}Kt(Cv,"ImagePosition"),Kt(hb,"ImageAtlas");const Ba={horizontal:1,vertical:2,horizontalOnly:3},db=-17;class qp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,s){const c=new qp;return c.scale=i||1,c.fontStack=s,c}static forImage(i){const s=new qp;return s.imageName=i,s}}class nh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s){const c=new nh;for(let p=0;p<i.sections.length;p++){const g=i.sections[p];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(s,c){let p="";for(let g=0;g<s.length;g++){const v=s.charCodeAt(g+1)||null,w=s.charCodeAt(g-1)||null;p+=!c&&(v&&zd(v)&&!Qu[s[g+1]]||w&&zd(w)&&!Qu[s[g-1]])||!Qu[s[g]]?s[g]:Qu[s[g]]}return p}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&Zp[this.text.charCodeAt(c)];c++)i++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&Zp[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const c=new nh;return c.text=this.text.substring(i,s),c.sectionIndex=this.sectionIndex.slice(i,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(qp.forText(i.scale,i.fontStack||s));const c=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(c)}addImageSection(i){const s=i.image?i.image.name:"";if(0===s.length)return void Zi("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(qp.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ug(o,i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=nh.fromFeature(o,p);N===Ba.vertical&&q.verticalizePunctuation(F);let J=[];const se=function(me,$e,Ve,tt,yt,Ze){if(!me)return[];const at=[],ot=function(Vt,en,Ut,zn,St,mn){let Bn=0;for(let mi=0;mi<Vt.length();mi++){const $n=Vt.getSection(mi);Bn+=Tv(Vt.getCharCode(mi),$n,zn,St,en,mn)}return Bn/Math.max(1,Math.ceil(Bn/Ut))}(me,$e,Ve,tt,yt,Ze),ft=me.text.indexOf("\u200b")>=0;let Dt=0;for(let Vt=0;Vt<me.length();Vt++){const en=me.getSection(Vt),Ut=me.getCharCode(Vt);if(Zp[Ut]||(Dt+=Tv(Ut,en,tt,yt,$e,Ze)),Vt<me.length()-1){const zn=!((Qe=Ut)<11904||!(jt["Bopomofo Extended"](Qe)||jt.Bopomofo(Qe)||jt["CJK Compatibility Forms"](Qe)||jt["CJK Compatibility Ideographs"](Qe)||jt["CJK Compatibility"](Qe)||jt["CJK Radicals Supplement"](Qe)||jt["CJK Strokes"](Qe)||jt["CJK Symbols and Punctuation"](Qe)||jt["CJK Unified Ideographs Extension A"](Qe)||jt["CJK Unified Ideographs"](Qe)||jt["Enclosed CJK Letters and Months"](Qe)||jt["Halfwidth and Fullwidth Forms"](Qe)||jt.Hiragana(Qe)||jt["Ideographic Description Characters"](Qe)||jt["Kangxi Radicals"](Qe)||jt["Katakana Phonetic Extensions"](Qe)||jt.Katakana(Qe)||jt["Vertical Forms"](Qe)||jt["Yi Radicals"](Qe)||jt["Yi Syllables"](Qe)));(fb[Ut]||zn||en.imageName)&&at.push(id(Vt+1,Dt,ot,at,Mc(Ut,me.getCharCode(Vt+1),zn&&ft),!1))}}var Qe;return jg(id(me.length(),Dt,ot,at,0,!0))}(q,S,g,i,c,V),{processBidirectionalText:pe,processStyledBidirectionalText:ae}=A;if(pe&&1===q.sections.length){const me=pe(q.toString(),se);for(const $e of me){const Ve=new nh;Ve.text=$e,Ve.sections=q.sections;for(let tt=0;tt<$e.length;tt++)Ve.sectionIndex.push(0);J.push(Ve)}}else if(ae){const me=ae(q.text,q.sectionIndex,se);for(const $e of me){const Ve=new nh;Ve.text=$e[0],Ve.sectionIndex=$e[1],Ve.sections=q.sections,J.push(Ve)}}else J=function(me,$e){const Ve=[],tt=me.text;let yt=0;for(const Ze of $e)Ve.push(me.substring(yt,Ze)),yt=Ze;return yt<tt.length&&Ve.push(me.substring(yt,tt.length)),Ve}(q,se);const de=[],ge={positionedLines:de,text:q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,$e,Ve,tt,yt,Ze,at,ot,ft,Dt,Qe,Vt){let en=0,Ut=0,zn=0;const St="right"===ot?1:"left"===ot?0:.5;let mn=!1;for(const Zn of yt){const On=Zn.getSections();for(const Ti of On){if(Ti.imageName)continue;const ki=$e[Ti.fontStack];if(ki&&(mn=void 0!==ki.ascender&&void 0!==ki.descender,!mn))break}if(!mn)break}let Bn=0;for(const Zn of yt){Zn.trim();const On=Zn.getMaxScale(),Ti=(On-1)*lo,ki={positionedGlyphs:[],lineOffset:0};me.positionedLines[Bn]=ki;const Vi=ki.positionedGlyphs;let Di=0;if(!Zn.length()){Ut+=Ze,++Bn;continue}let sr=0,hn=0;for(let Mi=0;Mi<Zn.length();Mi++){const nt=Zn.getSection(Mi),Cr=Zn.getSectionIndex(Mi),_r=Zn.getCharCode(Mi);let si=nt.scale,ar=null,Si=null,co=null,Tr=lo,Yr=0;const Vr=!(ft===Ba.horizontal||!Qe&&!ip(_r)||Qe&&(Zp[_r]||(mi=_r,jt.Arabic(mi)||jt["Arabic Supplement"](mi)||jt["Arabic Extended-A"](mi)||jt["Arabic Presentation Forms-A"](mi)||jt["Arabic Presentation Forms-B"](mi))));if(nt.imageName){const Eo=tt[nt.imageName];if(!Eo)continue;co=nt.imageName,me.iconsInText=me.iconsInText||!0,Si=Eo.paddedRect;const Kr=Eo.displaySize;si=si*lo/Vt,ar={width:Kr[0],height:Kr[1],left:cs,top:-Dc,advance:Vr?Kr[1]:Kr[0],localGlyph:!1},Yr=mn?-ar.height*si:db+On*lo-Kr[1]*si,Tr=ar.advance;const aa=(Vr?Kr[0]:Kr[1])*si-lo*On;aa>0&&aa>Di&&(Di=aa)}else{const Eo=Ve[nt.fontStack];if(!Eo)continue;Eo[_r]&&(Si=Eo[_r]);const Kr=$e[nt.fontStack];if(!Kr)continue;const aa=Kr.glyphs[_r];if(!aa)continue;if(ar=aa.metrics,Tr=8203!==_r?lo:0,mn){const md=void 0!==Kr.ascender?Math.abs(Kr.ascender):0,kf=void 0!==Kr.descender?Math.abs(Kr.descender):0,Of=(md+kf)*si;sr<Of&&(sr=Of,hn=(md-kf)/2*si),Yr=-md*si}else Yr=db+(On-si)*lo}Vr?(me.verticalizable=!0,Vi.push({glyph:_r,imageName:co,x:en,y:Ut+Yr,vertical:Vr,scale:si,localGlyph:ar.localGlyph,fontStack:nt.fontStack,sectionIndex:Cr,metrics:ar,rect:Si}),en+=Tr*si+Dt):(Vi.push({glyph:_r,imageName:co,x:en,y:Ut+Yr,vertical:Vr,scale:si,localGlyph:ar.localGlyph,fontStack:nt.fontStack,sectionIndex:Cr,metrics:ar,rect:Si}),en+=ar.advance*si+Dt)}0!==Vi.length&&(zn=Math.max(en-Dt,zn),mn?$g(Vi,St,Di,hn,Ze*On/2):$g(Vi,St,Di,0,Ze/2)),en=0;const Yt=Ze*On+Di;ki.lineOffset=Math.max(Di,Ti),Ut+=Yt,++Bn}var mi;const $n=Ut,{horizontalAlign:wn,verticalAlign:Bi}=Xp(at);(function(Zn,On,Ti,ki,Vi,Di){const sr=(On-Ti)*Vi,hn=-Di*ki;for(const Yt of Zn)for(const Mi of Yt.positionedGlyphs)Mi.x+=sr,Mi.y+=hn})(me.positionedLines,St,wn,Bi,zn,$n),me.top+=-Bi*$n,me.bottom=me.top+$n,me.left+=-wn*zn,me.right=me.left+zn,me.hasBaseline=mn}(ge,i,s,c,J,v,w,T,N,S,F,j),!function(me){for(const $e of me)if(0!==$e.positionedGlyphs.length)return!1;return!0}(de)&&ge}const Zp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Tv(o,i,s,c,p,g){if(i.imageName){const v=c[i.imageName];return v?v.displaySize[0]*i.scale*lo/g+p:0}{const v=s[i.fontStack],w=v&&v.glyphs[o];return w?w.metrics.advance*i.scale+p:0}}function Wp(o,i,s,c){const p=Math.pow(o-i,2);return c?o<i?p/2:2*p:p+Math.abs(s)*s}function Mc(o,i,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==i&&65289!==i||(c+=50),c}function id(o,i,s,c,p,g){let v=null,w=Wp(i,s,p,g);for(const T of c){const S=Wp(i-T.x,s,p,g)+T.badness;S<=w&&(v=T,w=S)}return{index:o,x:i,priorBreak:v,badness:w}}function jg(o){return o?jg(o.priorBreak).concat(o.index):[]}function Xp(o){let i=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function $g(o,i,s,c,p){if(!(i||s||c||p))return;const g=o.length-1,v=o[g],w=(v.x+v.metrics.advance*v.scale)*i;for(let T=0;T<=g;T++)o[T].x-=w,o[T].y+=s+c+p}function kE(o,i,s){const{horizontalAlign:c,verticalAlign:p}=Xp(s),g=i[0]-o.displaySize[0]*c,v=i[1]-o.displaySize[1]*p;return{image:o,top:v,bottom:v+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function pb(o,i,s,c,p,g){const v=o.image;let w;if(v.content){const J=v.content,se=v.pixelRatio||1;w=[J[0]/se,J[1]/se,v.displaySize[0]-J[2]/se,v.displaySize[1]-J[3]/se]}const T=i.left*g,S=i.right*g;let P,N,F,V;"width"===s||"both"===s?(V=p[0]+T-c[3],N=p[0]+S+c[1]):(V=p[0]+(T+S-v.displaySize[0])/2,N=V+v.displaySize[0]);const j=i.top*g,q=i.bottom*g;return"height"===s||"both"===s?(P=p[1]+j-c[0],F=p[1]+q+c[2]):(P=p[1]+(j+q-v.displaySize[1])/2,F=P+v.displaySize[1]),{image:v,top:P,right:N,bottom:F,left:V,collisionPadding:w}}class ou extends Oe{constructor(i,s,c,p,g){super(i,s),this.angle=p,this.z=c,void 0!==g&&(this.segment=g)}clone(){return new ou(this.x,this.y,this.z,this.angle,this.segment)}}function Yp(o,i,s,c,p){if(void 0===i.segment)return!0;let g=i,v=i.segment+1,w=0;for(;w>-s/2;){if(v--,v<0)return!1;w-=o[v].dist(g),g=o[v]}w+=o[v].dist(o[v+1]),v++;const T=[];let S=0;for(;w<s/2;){const P=o[v],N=o[v+1];if(!N)return!1;let F=o[v-1].angleTo(P)-P.angleTo(N);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:F}),S+=F;w-T[0].distance>c;)S-=T.shift().angleDelta;if(S>p)return!1;v++,w+=P.dist(N)}return!0}function Kp(o){let i=0;for(let s=0;s<o.length-1;s++)i+=o[s].dist(o[s+1]);return i}function mb(o,i,s){return o?.6*i*s:0}function gb(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Dv(o,i,s,c,p,g){const v=mb(s,p,g),w=gb(s,c)*g;let T=0;const S=Kp(o)/2;for(let P=0;P<o.length-1;P++){const N=o[P],F=o[P+1],V=N.dist(F);if(T+V>S){const j=(S-T)/V,q=oi(N.x,F.x,j),J=oi(N.y,F.y,j),se=new ou(q,J,0,F.angleTo(N),P);return!v||Yp(o,se,w,v,i)?se:void 0}T+=V}}function _b(o,i,s,c,p,g,v,w,T){const S=mb(c,g,v),P=gb(c,p),N=P*v,F=0===o[0].x||o[0].x===T||0===o[0].y||o[0].y===T;return i-N<i/4&&(i=N+i/4),Mv(o,F?i/2*w%i:(P/2+2*g)*v*w%i,i,S,s,N,F,!1,T)}function Mv(o,i,s,c,p,g,v,w,T){const S=g/2,P=Kp(o);let N=0,F=i-s,V=[];for(let j=0;j<o.length-1;j++){const q=o[j],J=o[j+1],se=q.dist(J),pe=J.angleTo(q);for(;F+s<N+se;){F+=s;const ae=(F-N)/se,de=oi(q.x,J.x,ae),ge=oi(q.y,J.y,ae);if(de>=0&&de<T&&ge>=0&&ge<T&&F-S>=0&&F+S<=P){const me=new ou(de,ge,0,pe,j);me._round(),c&&!Yp(o,me,g,c,p)||V.push(me)}}N+=se}return w||V.length||v||(V=Mv(o,N/2,s,c,p,g,v,!0,T)),V}function Sv(o,i,s,c,p){const g=[];for(let v=0;v<o.length;v++){const w=o[v];let T;for(let S=0;S<w.length-1;S++){let P=w[S],N=w[S+1];P.x<i&&N.x<i||(P.x<i?P=new Oe(i,P.y+(i-P.x)/(N.x-P.x)*(N.y-P.y))._round():N.x<i&&(N=new Oe(i,P.y+(i-P.x)/(N.x-P.x)*(N.y-P.y))._round()),P.y<s&&N.y<s||(P.y<s?P=new Oe(P.x+(s-P.y)/(N.y-P.y)*(N.x-P.x),s)._round():N.y<s&&(N=new Oe(P.x+(s-P.y)/(N.y-P.y)*(N.x-P.x),s)._round()),P.x>=c&&N.x>=c||(P.x>=c?P=new Oe(c,P.y+(c-P.x)/(N.x-P.x)*(N.y-P.y))._round():N.x>=c&&(N=new Oe(c,P.y+(c-P.x)/(N.x-P.x)*(N.y-P.y))._round()),P.y>=p&&N.y>=p||(P.y>=p?P=new Oe(P.x+(p-P.y)/(N.y-P.y)*(N.x-P.x),p)._round():N.y>=p&&(N=new Oe(P.x+(p-P.y)/(N.y-P.y)*(N.x-P.x),p)._round()),T&&P.equals(T[T.length-1])||(T=[P],g.push(T)),T.push(N)))))}}return g}Kt(ou,"Anchor");const _f=1e20;function Hg(o,i,s,c,p,g,v,w,T){for(let S=i;S<i+c;S++)yf(o,s*g+S,g,p,v,w,T);for(let S=s;S<s+p;S++)yf(o,S*g+i,1,c,v,w,T)}function yf(o,i,s,c,p,g,v){g[0]=0,v[0]=-_f,v[1]=_f,p[0]=o[i];for(let w=1,T=0,S=0;w<c;w++){p[w]=o[i+w*s];const P=w*w;do{const N=g[T];S=(p[w]-p[N]+P-N*N)/(w-N)/2}while(S<=v[T]&&--T>-1);T++,g[T]=w,v[T]=S,v[T+1]=_f}for(let w=0,T=0;w<c;w++){for(;v[T+1]<w;)T++;const S=g[T],P=w-S;o[i+w*s]=p[S]+P*P}}const fl=2,vf={none:0,ideographs:1,all:2};class rd{constructor(i,s,c){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,s){const c=[];for(const p in i)for(const g of i[p])c.push({stack:p,id:g});un(c,({stack:p,id:g},v)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(void 0!==T)return void v(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(w,p,g),T)return w.glyphs[g]=T,void v(null,{stack:p,id:g,glyph:T});const S=Math.floor(g/256);if(256*S>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[S])return void v(null,{stack:p,id:g,glyph:T});let P=w.requests[S];P||(P=w.requests[S]=[],rd.loadGlyphRange(p,S,this.url,this.requestManager,(N,F)=>{if(F){w.ascender=F.ascender,w.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=F.glyphs[+V]);w.ranges[S]=!0}for(const V of P)V(N,F);delete w.requests[S]})),P.push((N,F)=>{N?v(N):F&&v(null,{stack:p,id:g,glyph:F.glyphs[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const v={};for(const{stack:w,id:T,glyph:S}of g)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[T]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;s(null,v)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==vf.none&&(this.localGlyphMode===vf.all?!!this.localFontFamily:!!this.localFontFamily&&(jt["CJK Unified Ideographs"](i)||jt["Hangul Syllables"](i)||jt.Hiragana(i)||jt.Katakana(i)||jt["CJK Symbols and Punctuation"](i)))}_tinySDF(i,s,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=i.tinySDF;if(!g){let q="400";/bold/i.test(s)?q="900":/medium/i.test(s)?q="500":/light/i.test(s)&&(q="200"),g=i.tinySDF=new rd.TinySDF({fontFamily:p,fontWeight:q,fontSize:24*fl,buffer:3*fl,radius:8*fl}),g.fontWeight=q}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const v=String.fromCharCode(c),{data:w,width:T,height:S,glyphWidth:P,glyphHeight:N,glyphLeft:F,glyphTop:V,glyphAdvance:j}=g.draw(v);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Tc({width:T,height:S},w),metrics:{width:P/fl,height:N/fl,left:F/fl,top:V/fl-27,advance:j/fl,localGlyph:!0}}}}rd.loadGlyphRange=function(o,i,s,c,p){const g=256*i,v=g+255,w=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${v}`),qa.Glyphs);Za(w,(T,S)=>{if(T)p(T);else if(S){const P={},N=new Gp(S).readFields(lb,{});for(const F of N.glyphs)P[F.id]=F;p(null,{glyphs:P,ascender:N.ascender,descender:N.descender})}})},rd.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=s;const w=this.size=o+4*i,T=this._createCanvas(w),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${v} ${g} ${o}px ${p}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(o),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),T=Math.min(this.size-this.buffer,v+Math.ceil(c)),S=w+2*this.buffer,P=T+2*this.buffer,N=Math.max(S*P,0),F=new Uint8ClampedArray(N),V={data:F,width:S,height:P,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:i};if(0===w||0===T)return V;const{ctx:j,buffer:q,gridInner:J,gridOuter:se}=this;j.clearRect(q,q,w,T),j.fillText(o,q,q+v);const pe=j.getImageData(q,q,w,T);se.fill(_f,0,N),J.fill(0,0,N);for(let ae=0;ae<T;ae++)for(let de=0;de<w;de++){const ge=pe.data[4*(ae*w+de)+3]/255;if(0===ge)continue;const me=(ae+q)*S+de+q;if(1===ge)se[me]=0,J[me]=_f;else{const $e=.5-ge;se[me]=$e>0?$e*$e:0,J[me]=$e<0?$e*$e:0}}Hg(se,0,0,S,P,S,this.f,this.v,this.z),Hg(J,q,q,w,T,S,this.f,this.v,this.z);for(let ae=0;ae<N;ae++){const de=Math.sqrt(se[ae])-Math.sqrt(J[ae]);F[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return V}};const pl=cs;function Iv(o,i,s,c){const p=[],g=o.image,v=g.pixelRatio,w=g.paddedRect.w-2*pl,T=g.paddedRect.h-2*pl,S=o.right-o.left,P=o.bottom-o.top,N=g.stretchX||[[0,w]],F=g.stretchY||[[0,T]],V=(Ze,at)=>Ze+at[1]-at[0],j=N.reduce(V,0),q=F.reduce(V,0),J=w-j,se=T-q;let pe=0,ae=j,de=0,ge=q,me=0,$e=J,Ve=0,tt=se;if(g.content&&c){const Ze=g.content;pe=Jp(N,0,Ze[0]),de=Jp(F,0,Ze[1]),ae=Jp(N,Ze[0],Ze[2]),ge=Jp(F,Ze[1],Ze[3]),me=Ze[0]-pe,Ve=Ze[1]-de,$e=Ze[2]-Ze[0]-ae,tt=Ze[3]-Ze[1]-ge}const yt=(Ze,at,ot,ft)=>{const Dt=xf(Ze.stretch-pe,ae,S,o.left),Qe=em(Ze.fixed-me,$e,Ze.stretch,j),Vt=xf(at.stretch-de,ge,P,o.top),en=em(at.fixed-Ve,tt,at.stretch,q),Ut=xf(ot.stretch-pe,ae,S,o.left),zn=em(ot.fixed-me,$e,ot.stretch,j),St=xf(ft.stretch-de,ge,P,o.top),mn=em(ft.fixed-Ve,tt,ft.stretch,q),Bn=new Oe(Dt,Vt),mi=new Oe(Ut,Vt),$n=new Oe(Ut,St),wn=new Oe(Dt,St),Bi=new Oe(Qe/v,en/v),Zn=new Oe(zn/v,mn/v),On=i*Math.PI/180;if(On){const Vi=Math.sin(On),Di=Math.cos(On),sr=[Di,-Vi,Vi,Di];Bn._matMult(sr),mi._matMult(sr),wn._matMult(sr),$n._matMult(sr)}const Ti=Ze.stretch+Ze.fixed,ki=at.stretch+at.fixed;return{tl:Bn,tr:mi,bl:wn,br:$n,tex:{x:g.paddedRect.x+pl+Ti,y:g.paddedRect.y+pl+ki,w:ot.stretch+ot.fixed-Ti,h:ft.stretch+ft.fixed-ki},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bi,pixelOffsetBR:Zn,minFontScaleX:$e/v/S,minFontScaleY:tt/v/P,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const Ze=Qp(N,J,j),at=Qp(F,se,q);for(let ot=0;ot<Ze.length-1;ot++){const ft=Ze[ot],Dt=Ze[ot+1];for(let Qe=0;Qe<at.length-1;Qe++)p.push(yt(ft,at[Qe],Dt,at[Qe+1]))}}else p.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return p}function Jp(o,i,s){let c=0;for(const p of o)c+=Math.max(i,Math.min(s,p[1]))-Math.max(i,Math.min(s,p[0]));return c}function Qp(o,i,s){const c=[{fixed:-pl,stretch:0}];for(const[p,g]of o){const v=c[c.length-1];c.push({fixed:p-v.stretch,stretch:v.stretch}),c.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return c.push({fixed:i+pl,stretch:s}),c}function xf(o,i,s,c){return o/i*s+c}function em(o,i,s,c){return o-i*s/c}function yb(o,i,s,c){const p=i+o.positionedLines[c].lineOffset;return 0===c?s+p/2:s+(p+(i+o.positionedLines[c-1].lineOffset))/2}class vb{constructor(i=[],s=xb){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:c}=this,p=s[i];for(;i>0;){const g=i-1>>1,v=s[g];if(c(p,v)>=0)break;s[i]=v,i=g}s[i]=p}_down(i){const{data:s,compare:c}=this,p=this.length>>1,g=s[i];for(;i<p;){let v=1+(i<<1),w=s[v];const T=v+1;if(T<this.length&&c(s[T],w)<0&&(v=T,w=s[T]),c(w,g)>=0)break;s[i]=w,i=v}s[i]=g}}function xb(o,i){return o<i?-1:o>i?1:0}function Av(o,i=1,s=!1){let c=1/0,p=1/0,g=-1/0,v=-1/0;const w=o[0];for(let V=0;V<w.length;V++){const j=w[V];(!V||j.x<c)&&(c=j.x),(!V||j.y<p)&&(p=j.y),(!V||j.x>g)&&(g=j.x),(!V||j.y>v)&&(v=j.y)}const T=Math.min(g-c,v-p);let S=T/2;const P=new vb([],OE);if(0===T)return new Oe(c,p);for(let V=c;V<g;V+=T)for(let j=p;j<v;j+=T)P.push(new bf(V+S,j+S,S,o));let N=function(V){let j=0,q=0,J=0;const se=V[0];for(let pe=0,ae=se.length,de=ae-1;pe<ae;de=pe++){const ge=se[pe],me=se[de],$e=ge.x*me.y-me.x*ge.y;q+=(ge.x+me.x)*$e,J+=(ge.y+me.y)*$e,j+=3*$e}return new bf(q/j,J/j,0,V)}(o),F=P.length;for(;P.length;){const V=P.pop();(V.d>N.d||!N.d)&&(N=V,s&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-N.d<=i||(S=V.h/2,P.push(new bf(V.p.x-S,V.p.y-S,S,o)),P.push(new bf(V.p.x+S,V.p.y-S,S,o)),P.push(new bf(V.p.x-S,V.p.y+S,S,o)),P.push(new bf(V.p.x+S,V.p.y+S,S,o)),F+=4)}return s&&(console.log(`num probes: ${F}`),console.log(`best distance: ${N.d}`)),N.p}function OE(o,i){return i.max-o.max}class bf{constructor(i,s,c,p){this.p=new Oe(i,s),this.h=c,this.d=function(g,v){let w=!1,T=1/0;for(let S=0;S<v.length;S++){const P=v[S];for(let N=0,F=P.length,V=F-1;N<F;V=N++){const j=P[N],q=P[V];j.y>g.y!=q.y>g.y&&g.x<(q.x-j.x)*(g.y-j.y)/(q.y-j.y)+j.x&&(w=!w),T=Math.min(T,Hu(g,j,q))}}return(w?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Hl=7,ih=Number.POSITIVE_INFINITY,Pv=Math.sqrt(2);function Gg(o,[i,s]){let c=0,p=0;if(s===ih){i<0&&(i=0);const g=i/Pv;switch(o){case"top-right":case"top-left":p=g-Hl;break;case"bottom-right":case"bottom-left":p=-g+Hl;break;case"bottom":p=-i+Hl;break;case"top":p=i-Hl}switch(o){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=i;break;case"right":c=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),o){case"top-right":case"top-left":case"top":p=s-Hl;break;case"bottom-right":case"bottom-left":case"bottom":p=-s+Hl}switch(o){case"top-right":case"bottom-right":case"right":c=-i;break;case"top-left":case"bottom-left":case"left":c=i}}return[c,p]}function qg(o,i,s,c,p,g,v,w,T,S){o.createArrays(),o.tilePixelRatio=pn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const P=o.layers[0].layout,N=o.layers[0]._unevaluatedLayout._values,F={};if("composite"===o.textSizeData.kind){const{minZoom:q,maxZoom:J}=o.textSizeData;F.compositeTextSizes=[N["text-size"].possiblyEvaluate(new R(q),w),N["text-size"].possiblyEvaluate(new R(J),w)]}if("composite"===o.iconSizeData.kind){const{minZoom:q,maxZoom:J}=o.iconSizeData;F.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new R(q),w),N["icon-size"].possiblyEvaluate(new R(J),w)]}F.layoutTextSize=N["text-size"].possiblyEvaluate(new R(T+1),w),F.layoutIconSize=N["icon-size"].possiblyEvaluate(new R(T+1),w),F.textMaxSize=N["text-size"].possiblyEvaluate(new R(18),w);const V="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),j=P.get("text-size");for(const q of o.features){const J=P.get("text-font").evaluate(q,{},w).join(","),se=j.evaluate(q,{},w),pe=F.layoutTextSize.evaluate(q,{},w),ae=(F.layoutIconSize.evaluate(q,{},w),{horizontal:{},vertical:void 0}),de=q.text;let ge,me=[0,0];if(de){const tt=de.toString(),yt=P.get("text-letter-spacing").evaluate(q,{},w)*lo,Ze=P.get("text-line-height").evaluate(q,{},w)*lo,at=by(tt)?yt:0,ot=P.get("text-anchor").evaluate(q,{},w),ft=P.get("text-variable-anchor");if(!ft){const Ut=P.get("text-radial-offset").evaluate(q,{},w);me=Ut?Gg(ot,[Ut*lo,ih]):P.get("text-offset").evaluate(q,{},w).map(zn=>zn*lo)}let Dt=V?"center":P.get("text-justify").evaluate(q,{},w);const Qe="point"===P.get("symbol-placement"),Vt=Qe?P.get("text-max-width").evaluate(q,{},w)*lo:1/0,en=Ut=>{o.allowVerticalPlacement&&np(tt)&&(ae.vertical=Ug(de,i,s,p,J,Vt,Ze,ot,Ut,at,me,Ba.vertical,!0,pe,se))};if(!V&&ft){const Ut="auto"===Dt?ft.map(St=>wf(St)):[Dt];let zn=!1;for(let St=0;St<Ut.length;St++){const mn=Ut[St];if(!ae.horizontal[mn])if(zn)ae.horizontal[mn]=ae.horizontal[0];else{const Bn=Ug(de,i,s,p,J,Vt,Ze,"center",mn,at,me,Ba.horizontal,!1,pe,se);Bn&&(ae.horizontal[mn]=Bn,zn=1===Bn.positionedLines.length)}}en("left")}else{if("auto"===Dt&&(Dt=wf(ot)),Qe||P.get("text-writing-mode").indexOf("horizontal")>=0||!np(tt)){const Ut=Ug(de,i,s,p,J,Vt,Ze,ot,Dt,at,me,Ba.horizontal,!1,pe,se);Ut&&(ae.horizontal[Dt]=Ut)}en(Qe?"left":Dt)}}let $e=!1;if(q.icon&&q.icon.name){const tt=c[q.icon.name];tt&&(ge=kE(p[q.icon.name],P.get("icon-offset").evaluate(q,{},w),P.get("icon-anchor").evaluate(q,{},w)),$e=tt.sdf,void 0===o.sdfIcons?o.sdfIcons=tt.sdf:o.sdfIcons!==tt.sdf&&Zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==o.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Ve=wb(ae.horizontal)||ae.vertical;o.iconsInText||(o.iconsInText=!!Ve&&Ve.iconsInText),(Ve||ge)&&bb(o,q,ae,ge,c,F,pe,0,me,$e,v,w,S)}g&&o.generateCollisionDebugBuffers(T,o.collisionBoxArray)}function wf(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bb(o,i,s,c,p,g,v,w,T,S,P,N,F){let V=g.textMaxSize.evaluate(i,{},N);void 0===V&&(V=v);const j=o.layers[0].layout,q=j.get("icon-offset").evaluate(i,{},N),J=wb(s.horizontal)||s.vertical,se="globe"===F.name,pe=lo,ae=v/pe,de=o.tilePixelRatio*V/pe,ge=(ot=o.overscaling,o.zoom>18&&ot>2&&(ot>>=1),Math.max(pn/(512*ot),1)*j.get("symbol-spacing")),me=j.get("text-padding")*o.tilePixelRatio,$e=j.get("icon-padding")*o.tilePixelRatio,Ve=It(j.get("text-max-angle")),tt="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),yt="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ze=j.get("symbol-placement"),at=ge/2;var ot;const ft=j.get("icon-text-fit");let Dt;c&&"none"!==ft&&(o.allowVerticalPlacement&&s.vertical&&(Dt=pb(c,s.vertical,ft,j.get("icon-text-fit-padding"),q,ae)),J&&(c=pb(c,J,ft,j.get("icon-text-fit-padding"),q,ae)));const Qe=(Vt,en,Ut)=>{if(en.x<0||en.x>=pn||en.y<0||en.y>=pn)return;let zn=null;if(se){const{x:St,y:mn,z:Bn}=F.projectTilePoint(en.x,en.y,Ut);zn={anchor:new ou(St,mn,Bn,0,void 0),up:F.upVector(Ut,en.x,en.y)}}!function(St,mn,Bn,mi,$n,wn,Bi,Zn,On,Ti,ki,Vi,Di,sr,hn,Yt,Mi,nt,Cr,_r,si,ar,Si,co,Tr){const Yr=St.addToLineVertexArray(mn,mi);let Vr,Eo,Kr,aa,md,kf,Of,m_=0,Hv=0,Gv=0,qv=0,g_=-1,hm=-1;const _l={};let Zv=op("");const dh=Bn?Bn.anchor:mn;let us=0,__=0;if(void 0===On._unevaluatedLayout.getValue("text-radial-offset")?[us,__]=On.layout.get("text-offset").evaluate(si,{},Tr).map(hs=>hs*lo):(us=On.layout.get("text-radial-offset").evaluate(si,{},Tr)*lo,__=ih),St.allowVerticalPlacement&&$n.vertical){const hs=$n.vertical;if(hn)kf=Zg(hs),Zn&&(Of=Zg(Zn));else{const Ms=On.layout.get("text-rotate").evaluate(si,{},Tr)+90;Kr=sd(Ti,dh,mn,ki,Vi,Di,hs,sr,Ms,Yt),Zn&&(aa=sd(Ti,dh,mn,ki,Vi,Di,Zn,nt,Ms))}}if(wn){const hs=On.layout.get("icon-rotate").evaluate(si,{},Tr),Ms="none"!==On.layout.get("icon-text-fit"),Nf=Iv(wn,hs,Si,Ms),v_=Zn?Iv(Zn,hs,Si,Ms):void 0;Eo=sd(Ti,dh,mn,ki,Vi,Di,wn,nt,hs),m_=4*Nf.length;const x_=St.iconSizeData;let fh=null;"source"===x_.kind?(fh=[Ts*On.layout.get("icon-size").evaluate(si,{},Tr)],fh[0]>Sc&&Zi(`${St.layerIds[0]}: Value for "icon-size" is >= ${od}. Reduce your "icon-size".`)):"composite"===x_.kind&&(fh=[Ts*ar.compositeIconSizes[0].evaluate(si,{},Tr),Ts*ar.compositeIconSizes[1].evaluate(si,{},Tr)],(fh[0]>Sc||fh[1]>Sc)&&Zi(`${St.layerIds[0]}: Value for "icon-size" is >= ${od}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Nf,fh,_r,Cr,si,!1,Bn,mn,Yr.lineStartIndex,Yr.lineLength,-1,co,Tr),g_=St.icon.placedSymbolArray.length-1,v_&&(Hv=4*v_.length,St.addSymbols(St.icon,v_,fh,_r,Cr,si,Ba.vertical,Bn,mn,Yr.lineStartIndex,Yr.lineLength,-1,co,Tr),hm=St.icon.placedSymbolArray.length-1)}for(const hs in $n.horizontal){const Ms=$n.horizontal[hs];Vr||(Zv=op(Ms.text),hn?md=Zg(Ms):Vr=sd(Ti,dh,mn,ki,Vi,Di,Ms,sr,On.layout.get("text-rotate").evaluate(si,{},Tr),Yt));const Nf=1===Ms.positionedLines.length;if(Gv+=Ef(St,Bn,mn,Ms,Bi,On,hn,si,Yt,Yr,$n.vertical?Ba.horizontal:Ba.horizontalOnly,Nf?Object.keys($n.horizontal):[hs],_l,g_,ar,co,Tr),Nf)break}$n.vertical&&(qv+=Ef(St,Bn,mn,$n.vertical,Bi,On,hn,si,Yt,Yr,Ba.vertical,["vertical"],_l,hm,ar,co,Tr));let fu=-1;const Wv=(hs,Ms)=>hs?Math.max(hs,Ms):Ms;fu=Wv(md,fu),fu=Wv(kf,fu),fu=Wv(Of,fu);const y_=fu>-1?1:0;St.glyphOffsetArray.length>=uu.MAX_GLYPHS&&Zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==si.sortKey&&St.addToSortKeyRanges(St.symbolInstances.length,si.sortKey),St.symbolInstances.emplaceBack(dh.x,dh.y,dh.z,mn.x,mn.y,_l.right>=0?_l.right:-1,_l.center>=0?_l.center:-1,_l.left>=0?_l.left:-1,_l.vertical>=0?_l.vertical:-1,g_,hm,Zv,void 0!==Vr?Vr:St.collisionBoxArray.length,void 0!==Vr?Vr+1:St.collisionBoxArray.length,void 0!==Kr?Kr:St.collisionBoxArray.length,void 0!==Kr?Kr+1:St.collisionBoxArray.length,void 0!==Eo?Eo:St.collisionBoxArray.length,void 0!==Eo?Eo+1:St.collisionBoxArray.length,aa||St.collisionBoxArray.length,aa?aa+1:St.collisionBoxArray.length,ki,Gv,qv,m_,Hv,y_,0,us,__,fu)}(o,en,zn,Vt,s,c,p,Dt,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,me,tt,T,0,$e,yt,q,i,g,S,P,N)};if("line"===Ze)for(const Vt of Sv(i.geometry,0,0,pn,pn)){const en=_b(Vt,ge,Ve,s.vertical||J,c,pe,de,o.overscaling,pn);for(const Ut of en)J&&Wg(o,J.text,at,Ut)||Qe(Vt,Ut,N)}else if("line-center"===Ze){for(const Vt of i.geometry)if(Vt.length>1){const en=Dv(Vt,Ve,s.vertical||J,c,pe,de);en&&Qe(Vt,en,N)}}else if("Polygon"===i.type)for(const Vt of Qh(i.geometry,0)){const en=Av(Vt,16);Qe(Vt[0],new ou(en.x,en.y,0,0,void 0),N)}else if("LineString"===i.type)for(const Vt of i.geometry)Qe(Vt,new ou(Vt[0].x,Vt[0].y,0,0,void 0),N);else if("Point"===i.type)for(const Vt of i.geometry)for(const en of Vt)Qe([en],new ou(en.x,en.y,0,0,void 0),N)}const od=255,Sc=od*Ts;function Ef(o,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J){const se=function(de,ge,me,$e,Ve,tt,yt,Ze){const at=[];if(0===ge.positionedLines.length)return at;const ot=$e.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,ft=function(Ut){const zn=Ut[0],St=Ut[1],mn=zn*St;return mn>0?[zn,-St]:mn<0?[-zn,St]:0===zn?[St,zn]:[St,-zn]}(me);let Dt=Math.abs(ge.top-ge.bottom);for(const Ut of ge.positionedLines)Dt-=Ut.lineOffset;const Qe=ge.positionedLines.length,Vt=Dt/Qe;let en=ge.top-me[1];for(let Ut=0;Ut<Qe;++Ut){const zn=ge.positionedLines[Ut];en=yb(ge,Vt,en,Ut);for(const St of zn.positionedGlyphs){if(!St.rect)continue;const mn=St.rect||{};let Bn=Dc+1,mi=!0,$n=1,wn=0;if(St.imageName){const Si=yt[St.imageName];if(!Si)continue;if(Si.sdf){Zi("SDF images are not supported in formatted text and will be ignored.");continue}mi=!1,$n=Si.pixelRatio,Bn=cs/$n}const Bi=(Ve||Ze)&&St.vertical,Zn=St.metrics.advance*St.scale/2,On=St.metrics,Ti=St.rect;if(null===Ti)continue;Ze&&ge.verticalizable&&(wn=St.imageName?Zn-St.metrics.width*St.scale/2:0);const ki=Ve?[St.x+Zn,St.y]:[0,0];let Vi=[0,0],Di=[0,0],sr=!1;Ve||(Bi?(Di=[St.x+Zn+ft[0],St.y+ft[1]-wn],sr=!0):Vi=[St.x+Zn+me[0],St.y+me[1]-wn]);const hn=Ti.w*St.scale/($n*(St.localGlyph?fl:1)),Yt=Ti.h*St.scale/($n*(St.localGlyph?fl:1));let Mi,nt,Cr,_r;if(Bi){const Si=St.y-en,co=new Oe(-Zn,Zn-Si),Tr=-Math.PI/2,Yr=new Oe(...Di);Mi=new Oe(-Zn+Vi[0],Vi[1]),Mi._rotateAround(Tr,co)._add(Yr),Mi.x+=-Si+Zn,Mi.y-=(On.left-Bn)*St.scale;const Vr=St.imageName?On.advance*St.scale:lo*St.scale,Eo=String.fromCharCode(St.glyph);pf(Eo)?Mi.x+=(1-Bn)*St.scale:rb(Eo)?Mi.x+=Vr-On.height*St.scale+(-Bn-1)*St.scale:Mi.x+=St.imageName||On.width+2*Bn===Ti.w&&On.height+2*Bn===Ti.h?(Vr-Yt)/2:(Vr-(On.height+2*Bn)*St.scale)/2,nt=new Oe(Mi.x,Mi.y-hn),Cr=new Oe(Mi.x+Yt,Mi.y),_r=new Oe(Mi.x+Yt,Mi.y-hn)}else{const Si=(On.left-Bn)*St.scale-Zn+Vi[0],co=(-On.top-Bn)*St.scale+Vi[1],Tr=Si+hn,Yr=co+Yt;Mi=new Oe(Si,co),nt=new Oe(Tr,co),Cr=new Oe(Si,Yr),_r=new Oe(Tr,Yr)}if(ot){let Si;Si=Ve?new Oe(0,0):sr?new Oe(ft[0],ft[1]):new Oe(me[0],me[1]),Mi._rotateAround(ot,Si),nt._rotateAround(ot,Si),Cr._rotateAround(ot,Si),_r._rotateAround(ot,Si)}const si=new Oe(0,0),ar=new Oe(0,0);at.push({tl:Mi,tr:nt,bl:Cr,br:_r,tex:mn,writingMode:ge.writingMode,glyphOffset:ki,sectionIndex:St.sectionIndex,isSDF:mi,pixelOffsetTL:si,pixelOffsetBR:ar,minFontScaleX:0,minFontScaleY:0})}}return at}(0,c,T,g,v,w,p,o.allowVerticalPlacement),pe=o.textSizeData;let ae=null;"source"===pe.kind?(ae=[Ts*g.layout.get("text-size").evaluate(w,{},J)],ae[0]>Sc&&Zi(`${o.layerIds[0]}: Value for "text-size" is >= ${od}. Reduce your "text-size".`)):"composite"===pe.kind&&(ae=[Ts*j.compositeTextSizes[0].evaluate(w,{},J),Ts*j.compositeTextSizes[1].evaluate(w,{},J)],(ae[0]>Sc||ae[1]>Sc)&&Zi(`${o.layerIds[0]}: Value for "text-size" is >= ${od}. Reduce your "text-size".`)),o.addSymbols(o.text,se,ae,T,v,w,P,i,s,S.lineStartIndex,S.lineLength,V,q,J);for(const de of N)F[de]=o.text.placedSymbolArray.length-1;return 4*se.length}function wb(o){for(const i in o)return o[i];return null}function sd(o,i,s,c,p,g,v,w,T,S){let P=v.top,N=v.bottom,F=v.left,V=v.right;const j=v.collisionPadding;if(j&&(F-=j[0],P-=j[1],V+=j[2],N+=j[3]),T){const q=new Oe(F,P),J=new Oe(V,P),se=new Oe(F,N),pe=new Oe(V,N),ae=It(T);let de=new Oe(0,0);S&&(de=new Oe(S[0],S[1])),q._rotateAround(ae,de),J._rotateAround(ae,de),se._rotateAround(ae,de),pe._rotateAround(ae,de),F=Math.min(q.x,J.x,se.x,pe.x),V=Math.max(q.x,J.x,se.x,pe.x),P=Math.min(q.y,J.y,se.y,pe.y),N=Math.max(q.y,J.y,se.y,pe.y)}return o.emplaceBack(i.x,i.y,i.z,s.x,s.y,F,P,V,N,w,c,p,g),o.length-1}function Zg(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function Wg(o,i,s,c){const p=o.compareText;if(i in p){const g=p[i];for(let v=g.length-1;v>=0;v--)if(c.dist(g[v])<s)return!0}else p[i]=[];return p[i].push(c),!1}function Xg(o,i){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,p=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),g=Math.sin(s)*p/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),v=Math.sin(o._pitch)*g+p;return Math.min(1.01*v,p*(1/o._horizonShift))}function su(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const s=Math.pow(2,-o.z),c=o.x*s,p=(o.x+1)*s,g=o.y*s,v=(o.y+1)*s,w=ra(c),T=ra(p),S=ko(g),P=ko(v),N=i.project(w,S),F=i.project(T,S),V=i.project(T,P),j=i.project(w,P);let q=Math.min(N.x,F.x,V.x,j.x),J=Math.min(N.y,F.y,V.y,j.y),se=Math.max(N.x,F.x,V.x,j.x),pe=Math.max(N.y,F.y,V.y,j.y);const ae=s/16;function de(me,$e,Ve,tt,yt,Ze){const at=(Ve+yt)/2,ot=(tt+Ze)/2,ft=i.project(ra(at),ko(ot)),Dt=Math.max(0,q-ft.x,J-ft.y,ft.x-se,ft.y-pe);q=Math.min(q,ft.x),se=Math.max(se,ft.x),J=Math.min(J,ft.y),pe=Math.max(pe,ft.y),Dt>ae&&(de(me,ft,Ve,tt,at,ot),de(ft,$e,at,ot,yt,Ze))}de(N,F,c,g,p,g),de(F,V,p,g,p,v),de(V,j,p,v,c,v),de(j,N,c,v,c,g),q-=ae,J-=ae,se+=ae,pe+=ae;const ge=1/Math.max(se-q,pe-J);return{scale:ge,x:q*ge,y:J*ge,x2:se*ge,y2:pe*ge,projection:i}}const rh=cl(new Float32Array(16));class au{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new pi(0,0)}projectTilePoint(i,s,c){return{x:i,y:s,z:0}}locationPoint(i,s,c=!0){return i._coordinatePoint(i.locationCoordinate(s),c)}pixelsPerMeter(i,s){return jl(1,i)*s}pixelSpaceConversion(i,s,c){return 1}farthestPixelDistance(i){return Xg(i,i.pixelsPerMeter)}pointCoordinate(i,s,c,p){const g=i.horizonLineFromTop(!1),v=new Oe(s,Math.max(g,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(v,p))}pointCoordinate3D(i,s,c){const p=new Oe(s,c);if(i.elevation)return i.elevation.pointCoordinate(p);{const g=this.pointCoordinate(i,p.x,p.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,s){if(i.elevation)return!this.pointCoordinate3D(i,s.x,s.y);const c=i.horizonLineFromTop();return s.y<c}createInversionMatrix(i,s){return rh}createTileMatrix(i,s,c){let p,g,v;const w=c.canonical,T=cl(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=su(w,this);p=1,g=S.x+c.wrap*S.scale,v=S.y,yc(T,T,[p/S.scale,p/S.scale,i.pixelsPerMeter/s])}else p=s/i.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*c.wrap)*p,v=w.y*p;return zh(T,T,[g,v,0]),yc(T,T,[p/pn,p/pn,1]),T}upVector(i,s,c){return[0,0,1]}upVectorScale(i,s,c){return{metersToTile:1}}}class Yg extends au{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,c]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(It(s));this.n=(p+Math.sin(It(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:c,c:p,r0:g}=this,v=It(i-this.center[0]),w=It(s),T=Math.sqrt(p-2*c*Math.sin(w))/c;return{x:T*Math.sin(v*c),y:T*Math.cos(v*c)-g,z:0}}unproject(i,s){const{n:c,c:p,r0:g}=this,v=g+s;let w=Math.atan2(i,Math.abs(v))*Math.sign(v);v*c<0&&(w-=Math.PI*Math.sign(i)*Math.sign(v));const T=It(this.center[0])*c;w=Ji(w,-Math.PI-T,Math.PI-T);const S=Cn(En(w/c)+this.center[0],-180,180),P=Math.asin(Cn((p-(i*i+v*v)*c*c)/(2*c),-1,1)),N=Cn(En(P),-Oo,Oo);return new pi(S,N)}}const lu=1.340264,Cf=-.081106,oh=893e-6,cu=.003796,Xo=Math.sqrt(3)/2;class ad extends au{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(Xo*Math.sin(s)),p=c*c,g=p*p*p;return{x:.5*(i*Math.cos(c)/(Xo*(lu+3*Cf*p+g*(7*oh+9*cu*p)))/Math.PI+.5),y:1-.5*(c*(lu+Cf*p+g*(oh+cu*p))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=c*c,g=p*p*p;for(let P,N,F,V=0;V<12&&(N=c*(lu+Cf*p+g*(oh+cu*p))-s,F=lu+3*Cf*p+g*(7*oh+9*cu*p),P=N/F,c=Cn(c-P,-Math.PI/3,Math.PI/3),p=c*c,g=p*p*p,!(Math.abs(P)<1e-12));++V);const v=Xo*i*(lu+3*Cf*p+g*(7*oh+9*cu*p))/Math.cos(c),w=Math.asin(Math.sin(c)/Xo),T=Cn(180*v/Math.PI,-180,180),S=Cn(180*w/Math.PI,-Oo,Oo);return new pi(T,S)}}class Kg extends au{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const c=360*(i-.5),p=Cn(360*(.5-s),-Oo,Oo);return new pi(c,p)}}const ld=Math.PI/2;function tm(o){return Math.tan((ld+o)/2)}class Rv extends au{constructor(i){super(i),this.center=i.center||[0,30];const[s,c]=this.parallels=i.parallels||[30,30];let p=It(s),g=It(c);this.southernCenter=p+g<0,this.southernCenter&&(p=-p,g=-g);const v=Math.cos(p),w=tm(p);this.n=p===g?Math.sin(p):Math.log(v/Math.cos(g))/Math.log(tm(g)/w),this.f=v*Math.pow(tm(p),this.n)/this.n}project(i,s){s=It(s),this.southernCenter&&(s=-s),i=It(i-this.center[0]);const c=1e-6,{n:p,f:g}=this;g>0?s<-ld+c&&(s=-ld+c):s>ld-c&&(s=ld-c);const v=g/Math.pow(tm(s),p);let w=v*Math.sin(p*i),T=g-v*Math.cos(p*i);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:p}=this,g=p-s,v=Math.sign(g),w=Math.sign(c)*Math.sqrt(i*i+g*g);let T=Math.atan2(i,Math.abs(g))*v;g*c<0&&(T-=Math.PI*Math.sign(i)*v);const S=Cn(En(T/c)+this.center[0],-180,180),P=Cn(En(2*Math.atan(Math.pow(p/w,1/c))-ld),-Oo,Oo);return new pi(S,this.southernCenter?-P:P)}}class sh extends au{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:za(i),y:ls(s),z:0}}unproject(i,s){const c=ra(i),p=ko(s);return new pi(c,p)}}const Lv=It(Oo);class Eb extends au{project(i,s){const c=(s=It(s))*s,p=c*c;return{x:.5*((i=It(i))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=25,g=0,v=c*c;do{v=c*c;const S=v*v;g=(c*(1.007226+v*(.015085+S*(.028874*v-.044475-.005916*S)))-s)/(1.007226+v*(.045255+S*(.259866*v-.311325-.005916*11*S))),c=Cn(c-g,-Lv,Lv)}while(Math.abs(g)>1e-6&&--p>0);v=c*c;const w=Cn(En(i/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),T=En(c);return new pi(w,T)}}const kv=It(Oo);class Jg extends au{project(i,s){s=It(s),i=It(i);const c=Math.cos(s),p=2/Math.PI,g=Math.acos(c*Math.cos(i/2)),v=Math.sin(g)/g,w=.5*(i*p+2*c*Math.sin(i/2)/v)||0,T=.5*(s+Math.sin(s)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,s){let c=i=(2*i-.5)*Math.PI,p=s=(2*(1-s)-1)*Math.PI,g=25;const v=1e-6;let w=0,T=0;do{const S=Math.cos(p),P=Math.sin(p),N=2*P*S,F=P*P,V=S*S,j=Math.cos(c/2),q=Math.sin(c/2),J=2*j*q,se=q*q,pe=1-V*j*j,ae=pe?1/pe:0,de=pe?Math.acos(S*j)*Math.sqrt(1/pe):0,ge=.5*(2*de*S*q+2*c/Math.PI)-i,me=.5*(de*P+p)-s,$e=.5*ae*(V*se+de*S*j*F)+1/Math.PI,Ve=ae*(J*N/4-de*P*q),tt=.125*ae*(N*q-de*P*V*J),yt=.5*ae*(F*j+de*se*S)+.5,Ze=Ve*tt-yt*$e;w=(me*Ve-ge*yt)/Ze,T=(ge*tt-me*$e)/Ze,c=Cn(c-w,-Math.PI,Math.PI),p=Cn(p-T,-kv,kv)}while((Math.abs(w)>v||Math.abs(T)>v)&&--g>0);return new pi(En(c),En(p))}}class Tf extends au{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(It(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:c,cosPhi:p}=this;return{x:It(i)*p*c+.5,y:-Math.sin(It(s))/p*c+.5,z:0}}unproject(i,s){const{scale:c,cosPhi:p}=this,g=-(s-.5)/c,v=Cn(En((i-.5)/c)/p,-180,180),w=Math.asin(Cn(g*p,-1,1)),T=Cn(En(w),-Oo,Oo);return new pi(v,T)}}class Cb extends sh{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,c){const p=ul(i,s,c);return ur(p,p,Gh(na(c))),{x:p[0],y:p[1],z:p[2]}}locationPoint(i,s){const c=wc(s.lat,s.lng),p=Zo([],c),g=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude;Gd(c,c,p,jl(1,0)*pn*g);const v=cl(new Float64Array(16));return _c(v,i.pixelMatrix,i.globeMatrix),ur(c,c,v),new Oe(c[0],c[1])}pixelsPerMeter(i,s){return jl(1,0)*s}pixelSpaceConversion(i,s,c){const p=jl(1,i)*s,g=oi(jl(1,45)*s,p,c);return this.pixelsPerMeter(i,s)/g}createTileMatrix(i,s,c){const p=Uu(na(c.canonical));return _c(new Float64Array(16),i.globeMatrix,p)}createInversionMatrix(i,s){const{center:c}=i,p=Gh(na(s));return $d(p,p,It(c.lng)),ig(p,p,It(c.lat)),yc(p,p,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(i,s,c,p){return Xd(i,s,c,!0)||new Kd(0,0)}pointCoordinate3D(i,s,c){const p=this.pointCoordinate(i,s,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(i,s){return!Xd(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(p,g){const v=p.cameraToCenterDistance,w=p._centerAltitude*g,T=p._camera,S=p._camera.forward(),P=vc([],Qs([],S,-v),[0,0,w]),N=p.worldSize/(2*Math.PI),F=[0,0,-N],V=p.width/p.height,j=Math.tan(p.fovAboveCenter),q=Qs([],T.up(),j),J=Qs([],T.right(),j*V),se=Zo([],vc([],vc([],S,q),J)),pe=[];let ae;if(new Oy(P,se).closestPointOnSphere(F,N,pe)){const de=vc([],pe,F),ge=Es([],de,P);ae=Math.cos(p.fovAboveCenter)*Bu(ge)}else{const de=Es([],P,F),ge=Es([],F,P);Zo(ge,ge);const me=Bu(de)-N;ae=Math.sqrt(me*(me+2*N));const $e=Math.acos(ae/(N+me))-Math.acos(ea(S,ge));ae*=Math.cos($e)}return 1.01*ae}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=ao(i.zoom);if(c>0){const p=Xg(i,jl(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),v=Math.max(i.width,i.height)/i.worldSize*Math.PI;return oi(s,p+g*(1-Math.cos(v)),Math.pow(c,10))}return s}upVector(i,s,c){return ul(s,c,i,1)}upVectorScale(i){return{metersToTile:_p(xp(na(i)))}}}function Qg(o){const i=o.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new sh(o);case"equirectangular":return new Kg(o);case"naturalEarth":return new Eb(o);case"equalEarth":return new ad(o);case"winkelTripel":return new Jg(o);case"albers":return s?new Tf(o):new Yg(o);case"lambertConformalConic":return s?new Tf(o):new Rv(o);case"globe":return new Cb(o)}throw new Error(`Invalid projection name: ${o.name}`)}const ah=Np.types,NE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function e_(o,i,s,c,p,g,v,w,T,S,P,N,F){const V=w?Math.min(Sc,Math.round(w[0])):0,j=w?Math.min(Sc,Math.round(w[1])):0;o.emplaceBack(i,s,Math.round(32*c),Math.round(32*p),g,v,(V<<1)+(T?1:0),j,16*S,16*P,256*N,256*F)}function Df(o,i,s,c,p,g,v){o.emplaceBack(i,s,c,p,g,v)}function nm(o,i,s,c,p){o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p)}function FE(o){for(const i of o.sections)if(Ey(i.text))return!0;return!1}class Ov{constructor(i){this.layoutVertexArray=new ut,this.indexArray=new Wt,this.programConfigurations=i,this.segments=new Fi,this.dynamicLayoutVertexArray=new gt,this.opacityVertexArray=new ln,this.placedSymbolArray=new Wn,this.globeExtVertexArray=new Tt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,s,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,RE.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,ib.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,NE,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Up.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Kt(Ov,"SymbolBuffers");class cd{constructor(i,s,c){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Fi,this.collisionVertexArray=new Kn,this.collisionVertexArrayExt=new Yn}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,_v.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,yv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Kt(cd,"CollisionBuffers");class uu{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(v=>v.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cl([]),this.placementViewportMatrix=cl([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ju(this.zoom,s["text-size"]),this.iconSizeData=Ju(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(v=>Ba[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Ov(new Nr(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Ov(new Nr(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Xi,this.lineVertexArray=new Lh,this.symbolInstances=new Li}calculateGlyphDependencies(i,s,c,p,g){for(let v=0;v<i.length;v++)if(s[i.charCodeAt(v)]=!0,p&&g){const w=Qu[i.charAt(v)];w&&(s[w.charCodeAt(0)]=!0)}}populate(i,s,c,p){const g=this.layers[0],v=g.layout,w="globe"===this.projection.name,T=v.get("text-font"),S=v.get("text-field"),P=v.get("icon-image"),N=("constant"!==S.value.kind||S.value.value instanceof ii&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),F="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,V=v.get("symbol-sort-key");if(this.features=[],!N&&!F)return;const j=s.iconDependencies,q=s.glyphDependencies,J=s.availableImages,se=new R(this.zoom);for(const{feature:pe,id:ae,index:de,sourceLayerIndex:ge}of i){const me=g._featureFilter.needGeometry,$e=wo(pe,me);if(!g._featureFilter.filter(se,$e,c))continue;if(me||($e.geometry=Ec(pe,c,p)),w&&1!==pe.type&&c.z<=5){const Ze=$e.geometry,at=.98078528056,ot=(ft,Dt)=>ea(ul(ft.x,ft.y,c,1),ul(Dt.x,Dt.y,c,1))<at;for(let ft=0;ft<Ze.length;ft++)Ze[ft]=Nx(Ze[ft],ot)}let Ve,tt;if(N){const Ze=g.getValueAndResolveTokens("text-field",$e,c,J),at=ii.factory(Ze);FE(at)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===E()||this.hasRTLText&&A.isParsed())&&(Ve=vv(at,g,$e))}if(F){const Ze=g.getValueAndResolveTokens("icon-image",$e,c,J);tt=Ze instanceof So?Ze:So.fromString(Ze)}if(!Ve&&!tt)continue;const yt=this.sortFeaturesByKey?V.evaluate($e,{},c):void 0;if(this.features.push({id:ae,text:Ve,icon:tt,index:de,sourceLayerIndex:ge,geometry:$e.geometry,properties:pe.properties,type:ah[pe.type],sortKey:yt}),tt&&(j[tt.name]=!0),Ve){const Ze=T.evaluate($e,{},c).join(","),at="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ba.vertical)>=0;for(const ot of Ve.sections)if(ot.image)j[ot.image.name]=!0;else{const ft=np(Ve.toString()),Dt=ot.fontStack||Ze,Qe=q[Dt]=q[Dt]||{};this.calculateGlyphDependencies(ot.text,Qe,at,this.allowVerticalPlacement,ft)}}}"line"===v.get("symbol-placement")&&(this.features=function(pe){const ae={},de={},ge=[];let me=0;function $e(Ze){ge.push(pe[Ze]),me++}function Ve(Ze,at,ot){const ft=de[Ze];return delete de[Ze],de[at]=ft,ge[ft].geometry[0].pop(),ge[ft].geometry[0]=ge[ft].geometry[0].concat(ot[0]),ft}function tt(Ze,at,ot){const ft=ae[at];return delete ae[at],ae[Ze]=ft,ge[ft].geometry[0].shift(),ge[ft].geometry[0]=ot[0].concat(ge[ft].geometry[0]),ft}function yt(Ze,at,ot){const ft=ot?at[0][at[0].length-1]:at[0][0];return`${Ze}:${ft.x}:${ft.y}`}for(let Ze=0;Ze<pe.length;Ze++){const at=pe[Ze],ot=at.geometry,ft=at.text?at.text.toString():null;if(!ft){$e(Ze);continue}const Dt=yt(ft,ot),Qe=yt(ft,ot,!0);if(Dt in de&&Qe in ae&&de[Dt]!==ae[Qe]){const Vt=tt(Dt,Qe,ot),en=Ve(Dt,Qe,ge[Vt].geometry);delete ae[Dt],delete de[Qe],de[yt(ft,ge[en].geometry,!0)]=en,ge[Vt].geometry=null}else Dt in de?Ve(Dt,Qe,ot):Qe in ae?tt(Dt,Qe,ot):($e(Ze),ae[Dt]=me-1,de[Qe]=me-1)}return ge.filter(Ze=>Ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ae)=>pe.sortKey-ae.sortKey)}update(i,s,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,c,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Qg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const c=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:p,y:g}of s)this.lineVertexArray.emplaceBack(p,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=i.indexArray,J=i.layoutVertexArray,se=i.globeExtVertexArray,pe=i.segments.prepareSegment(4*s.length,J,q,this.canOverlap?v.sortKey:void 0),ae=this.glyphOffsetArray.length,de=pe.vertexLength,ge=this.allowVerticalPlacement&&w===Ba.vertical?Math.PI/2:0,me=v.text&&v.text.sections;for(let Ve=0;Ve<s.length;Ve++){const{tl:tt,tr:yt,bl:Ze,br:at,tex:ot,pixelOffsetTL:ft,pixelOffsetBR:Dt,minFontScaleX:Qe,minFontScaleY:Vt,glyphOffset:en,isSDF:Ut,sectionIndex:zn}=s[Ve],St=pe.vertexLength,mn=en[1];if(e_(J,S.x,S.y,tt.x,mn+tt.y,ot.x,ot.y,c,Ut,ft.x,ft.y,Qe,Vt),e_(J,S.x,S.y,yt.x,mn+yt.y,ot.x+ot.w,ot.y,c,Ut,Dt.x,ft.y,Qe,Vt),e_(J,S.x,S.y,Ze.x,mn+Ze.y,ot.x,ot.y+ot.h,c,Ut,ft.x,Dt.y,Qe,Vt),e_(J,S.x,S.y,at.x,mn+at.y,ot.x+ot.w,ot.y+ot.h,c,Ut,Dt.x,Dt.y,Qe,Vt),T){const{x:Bn,y:mi,z:$n}=T.anchor,[wn,Bi,Zn]=T.up;Df(se,Bn,mi,$n,wn,Bi,Zn),Df(se,Bn,mi,$n,wn,Bi,Zn),Df(se,Bn,mi,$n,wn,Bi,Zn),Df(se,Bn,mi,$n,wn,Bi,Zn),nm(i.dynamicLayoutVertexArray,Bn,mi,$n,ge)}else nm(i.dynamicLayoutVertexArray,S.x,S.y,S.z,ge);q.emplaceBack(St,St+1,St+2),q.emplaceBack(St+1,St+2,St+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(en[0]),Ve!==s.length-1&&zn===s[Ve+1].sectionIndex||i.programConfigurations.populatePaintArrays(J.length,v,v.index,{},V,j,me&&me[zn])}const $e=T?T.anchor:S;i.placedSymbolArray.emplaceBack($e.x,$e.y,$e.z,S.x,S.y,ae,this.glyphOffsetArray.length-ae,de,P,N,S.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,F,0)}_commitLayoutVertex(i,s,c,p,g,v,w){i.emplaceBack(s,c,p,g,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,s,c,p,g,v,w){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=T.vertexLength,P=w.tileAnchorX,N=w.tileAnchorY;for(let V=0;V<4;V++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(s,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Oe(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Oe(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Oe(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Oe(i.x1,i.y2)),T.vertexLength+=4;const F=c.indexArray;F.emplaceBack(S,S+1),F.emplaceBack(S+1,S+2),F.emplaceBack(S+2,S+3),F.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceTextSize(i,v,s,w);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceIconSize(i,s,v.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}generateCollisionDebugBuffers(i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cd(Jt,Lg.members,oo),this.iconCollisionBox=new cd(Jt,Lg.members,oo);const c=ru(this.iconSizeData,i),p=ru(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,i,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,i,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,i,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,i,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(i,s,c,p){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:p),v=ff(this.textSizeData,i,g)/lo;return this.tilePixelRatio*v}getSymbolInstanceIconSize(i,s,c){const p=this.icon.placedSymbolArray.get(c),g=ff(this.iconSizeData,i,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,s,c){i.emplaceBack(s,-c,-c),i.emplaceBack(s,c,-c),i.emplaceBack(s,c,c),i.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceTextSize(i,v,s,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding)}}_updateIconDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceIconSize(i,s,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding)}}updateCollisionDebugBuffers(i,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=ru(this.iconSizeData,i),p=ru(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,i,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(p,i,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(c,i,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,i,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,c,p,g,v,w,T,S){const P={};if(s<c){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(s);P.textBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.textFeatureIndex=ge}if(p<g){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(p);P.verticalTextBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.verticalTextFeatureIndex=ge}if(v<w){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(v);P.iconBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.iconFeatureIndex=ge}if(T<S){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(T);P.verticalIconBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.verticalIconFeatureIndex=ge}return P}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,s){const c=i.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<p;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(i),c=Math.cos(i),p=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const T=this.symbolInstances.get(w);p.push(0|Math.round(s*T.tileAnchorX+c*T.tileAnchorY)),g.push(T.featureIndex)}return v.sort((w,T)=>p[w]-p[T]||g[T]-g[w]),v}addToSortKeyRanges(i,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&v!==g&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Kt(uu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),uu.MAX_GLYPHS=65535,uu.addDynamicAttributes=nm;const t_=new ce({"symbol-placement":new G(Je.layout_symbol["symbol-placement"]),"symbol-spacing":new G(Je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new G(Je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(Je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new G(Je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new G(Je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new G(Je.layout_symbol["icon-ignore-placement"]),"icon-optional":new G(Je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new G(Je.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(Je.layout_symbol["icon-size"]),"icon-text-fit":new G(Je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new G(Je.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(Je.layout_symbol["icon-image"]),"icon-rotate":new ee(Je.layout_symbol["icon-rotate"]),"icon-padding":new G(Je.layout_symbol["icon-padding"]),"icon-keep-upright":new G(Je.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(Je.layout_symbol["icon-offset"]),"icon-anchor":new ee(Je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new G(Je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new G(Je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new G(Je.layout_symbol["text-rotation-alignment"]),"text-field":new ee(Je.layout_symbol["text-field"]),"text-font":new ee(Je.layout_symbol["text-font"]),"text-size":new ee(Je.layout_symbol["text-size"]),"text-max-width":new ee(Je.layout_symbol["text-max-width"]),"text-line-height":new ee(Je.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(Je.layout_symbol["text-letter-spacing"]),"text-justify":new ee(Je.layout_symbol["text-justify"]),"text-radial-offset":new ee(Je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new G(Je.layout_symbol["text-variable-anchor"]),"text-anchor":new ee(Je.layout_symbol["text-anchor"]),"text-max-angle":new G(Je.layout_symbol["text-max-angle"]),"text-writing-mode":new G(Je.layout_symbol["text-writing-mode"]),"text-rotate":new ee(Je.layout_symbol["text-rotate"]),"text-padding":new G(Je.layout_symbol["text-padding"]),"text-keep-upright":new G(Je.layout_symbol["text-keep-upright"]),"text-transform":new ee(Je.layout_symbol["text-transform"]),"text-offset":new ee(Je.layout_symbol["text-offset"]),"text-allow-overlap":new G(Je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new G(Je.layout_symbol["text-ignore-placement"]),"text-optional":new G(Je.layout_symbol["text-optional"])});var Mf={paint:new ce({"icon-opacity":new ee(Je.paint_symbol["icon-opacity"]),"icon-color":new ee(Je.paint_symbol["icon-color"]),"icon-halo-color":new ee(Je.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(Je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(Je.paint_symbol["icon-halo-blur"]),"icon-translate":new G(Je.paint_symbol["icon-translate"]),"icon-translate-anchor":new G(Je.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(Je.paint_symbol["text-opacity"]),"text-color":new ee(Je.paint_symbol["text-color"],{runtimeType:dn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ee(Je.paint_symbol["text-halo-color"]),"text-halo-width":new ee(Je.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(Je.paint_symbol["text-halo-blur"]),"text-translate":new G(Je.paint_symbol["text-translate"]),"text-translate-anchor":new G(Je.paint_symbol["text-translate-anchor"])}),layout:t_};class lh{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:xa,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Kt(lh,"FormatSectionOverride",{omit:["defaultValue"]});class ud extends Vl{constructor(i){super(i,Mf)}recalculate(i,s){super.recalculate(i,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const g of c)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,s,c,p){const g=this.layout.get(i).evaluate(s,{},c,p),v=this._unevaluatedLayout._values[i];return v.isDataDriven()||Ia(v.value)||!g?g:(w=s.properties,g.replace(/{([^{}]+)}/g,(S,P)=>P in w?String(w[P]):""));var w}createBucket(i){return new uu(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Mf.paint.overridableProperties){if(!ud.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),c=new lh(s),p=new Zr(c,s.property.specification);let g=null;g="constant"===s.value.kind||"source"===s.value.kind?new ol("source",p):new Ol("composite",p,s.value.zoomStops,s.value._interpolationType),this.paint._values[i]=new ne(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&ud.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const c=i.get("text-field"),p=Mf.paint.properties[s];let g=!1;const v=w=>{for(const T of w)if(p.overrides&&p.overrides.hasOverride(T))return void(g=!0)};if("constant"===c.value.kind&&c.value.value instanceof ii)v(c.value.value.sections);else if("source"===c.value.kind){const w=S=>{g||(S instanceof Hr&&nr(S.value)===ts?v(S.value.sections):S instanceof Ea?v(S.sections):S.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramConfiguration(i){return new Kc(this,i)}}var n_={paint:new ce({"background-color":new G(Je.paint_background["background-color"]),"background-pattern":new G(Je.paint_background["background-pattern"]),"background-opacity":new G(Je.paint_background["background-opacity"])})},Sf={paint:new ce({"raster-opacity":new G(Je.paint_raster["raster-opacity"]),"raster-hue-rotate":new G(Je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new G(Je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new G(Je.paint_raster["raster-brightness-max"]),"raster-saturation":new G(Je.paint_raster["raster-saturation"]),"raster-contrast":new G(Je.paint_raster["raster-contrast"]),"raster-resampling":new G(Je.paint_raster["raster-resampling"]),"raster-fade-duration":new G(Je.paint_raster["raster-fade-duration"])})};class im extends Vl{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var hd={paint:new ce({"sky-type":new G(Je.paint_sky["sky-type"]),"sky-atmosphere-sun":new G(Je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new G(Je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new G(Je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new G(Je.paint_sky["sky-gradient-radius"]),"sky-gradient":new le(Je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new G(Je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new G(Je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new G(Je.paint_sky["sky-opacity"])})};function If(o,i,s){const c=[0,0,1],p=Vu([]);return Ly(p,p,s?-It(o)+Math.PI:It(o)),Vh(p,p,-It(i)),xc(c,c,p),Zo(c,c)}const i_={circle:class extends Vl{constructor(o){super(o,Cp)}createBucket(o){return new qh(o)}queryRadius(o){const i=o;return Wh("circle-radius",this,i)+Wh("circle-stroke-width",this,i)+Ep(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,s,c,p,g,v,w){const T=Zy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return Wy(o,c,g,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,S)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Kc(this,o)}},heatmap:class extends Vl{createBucket(o){return new pg(o)}constructor(o){super(o,Xh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Wh("heatmap-radius",this,o)}queryIntersectsFeature(o,i,s,c,p,g,v,w){const T=this.paint.get("heatmap-radius").evaluate(i,s);return Wy(o,c,g,v,w,!0,!0,new Oe(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Kc(this,o)}},hillshade:class extends Vl{constructor(o){super(o,$x)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Vl{constructor(o){super(o,rv)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Kc(this,o)}recalculate(o,i){super.recalculate(o,i);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new kp(o)}queryRadius(){return Ep(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,s,c,p,g){return!o.queryGeometry.isAboveHorizon&&zx(qy(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Vl{constructor(o){super(o,fv)}createBucket(o){return new Wu(o)}queryRadius(){return Ep(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Kc(this,o)}queryIntersectsFeature(o,i,s,c,p,g,v,w,T){const S=Zy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(i,s),N=this.paint.get("fill-extrusion-base").evaluate(i,s),F=[0,0],V=w&&g.elevation,j=g.elevation?g.elevation.exaggeration():1,q=o.tile.getBucket(this);if(V&&q instanceof Wu){const de=q.centroidVertexArray,ge=T+1;ge<de.length&&(F[0]=de.geta_centroid_pos0(ge),F[1]=de.geta_centroid_pos1(ge))}if(0===F[0]&&1===F[1])return!1;"globe"===g.projection.name&&(c=Xu([c],[new Oe(0,0),new Oe(pn,pn)],o.tileID.canonical).map(de=>de.polygon).flat());const J=V?w:null,[se,pe]=(ge=c,me=N,$e=P,Ve=S,tt=v,yt=J,Ze=F,at=j,ot=g.center.lat,"globe"===(de=g).projection.name?function(Dt,Qe,Vt,en,Ut,zn,St,mn,Bn,mi,$n){const wn=[],Bi=[],Zn=Dt.projection.upVectorScale($n,Dt.center.lat,Dt.worldSize).metersToTile,On=[0,0,0,1],Ti=[0,0,0,1],ki=(Di,sr,hn,Yt)=>{Di[0]=sr,Di[1]=hn,Di[2]=Yt,Di[3]=1},Vi=Dg();Vt>0&&(Vt+=Vi),en+=Vi;for(const Di of Qe){const sr=[],hn=[];for(const Yt of Di){const Mi=Yt.x+Ut.x,nt=Yt.y+Ut.y,Cr=Dt.projection.projectTilePoint(Mi,nt,$n),_r=Dt.projection.upVector($n,Yt.x,Yt.y);let si=Vt,ar=en;if(St){const Si=Mg(Mi,nt,Vt,en,St,mn,Bn,mi);si+=Si.base,ar+=Si.top}0!==Vt?ki(On,Cr.x+_r[0]*Zn*si,Cr.y+_r[1]*Zn*si,Cr.z+_r[2]*Zn*si):ki(On,Cr.x,Cr.y,Cr.z),ki(Ti,Cr.x+_r[0]*Zn*ar,Cr.y+_r[1]*Zn*ar,Cr.z+_r[2]*Zn*ar),ur(On,On,zn),ur(Ti,Ti,zn),sr.push(new td(On[0],On[1],On[2])),hn.push(new td(Ti[0],Ti[1],Ti[2]))}wn.push(sr),Bi.push(hn)}return[wn,Bi]}(de,ge,me,$e,Ve,tt,yt,Ze,at,ot,o.tileID.canonical):yt?function(Dt,Qe,Vt,en,Ut,zn,St,mn,Bn){const mi=[],$n=[],wn=[0,0,0,1];for(const Bi of Dt){const Zn=[],On=[];for(const Ti of Bi){const ki=Ti.x+en.x,Vi=Ti.y+en.y,Di=Mg(ki,Vi,Qe,Vt,zn,St,mn,Bn);wn[0]=ki,wn[1]=Vi,wn[2]=Di.base,wn[3]=1,Qc(wn,wn,Ut),wn[3]=Math.max(wn[3],1e-5);const sr=new td(wn[0]/wn[3],wn[1]/wn[3],wn[2]/wn[3]);wn[0]=ki,wn[1]=Vi,wn[2]=Di.top,wn[3]=1,Qc(wn,wn,Ut),wn[3]=Math.max(wn[3],1e-5);const hn=new td(wn[0]/wn[3],wn[1]/wn[3],wn[2]/wn[3]);Zn.push(sr),On.push(hn)}mi.push(Zn),$n.push(On)}return[mi,$n]}(ge,me,$e,Ve,tt,yt,Ze,at,ot):function(Dt,Qe,Vt,en,Ut){const zn=[],St=[],mn=Ut[8]*Qe,Bn=Ut[9]*Qe,mi=Ut[10]*Qe,$n=Ut[11]*Qe,wn=Ut[8]*Vt,Bi=Ut[9]*Vt,Zn=Ut[10]*Vt,On=Ut[11]*Vt;for(const Ti of Dt){const ki=[],Vi=[];for(const Di of Ti){const sr=Di.x+en.x,hn=Di.y+en.y,Yt=Ut[0]*sr+Ut[4]*hn+Ut[12],Mi=Ut[1]*sr+Ut[5]*hn+Ut[13],nt=Ut[2]*sr+Ut[6]*hn+Ut[14],Cr=Ut[3]*sr+Ut[7]*hn+Ut[15],_r=Yt+mn,si=Mi+Bn,ar=nt+mi,Si=Math.max(Cr+$n,1e-5),co=Yt+wn,Tr=Mi+Bi,Yr=nt+Zn,Vr=Math.max(Cr+On,1e-5);ki.push(new td(_r/Si,si/Si,ar/Si)),Vi.push(new td(co/Vr,Tr/Vr,Yr/Vr))}zn.push(ki),St.push(Vi)}return[zn,St]}(ge,me,$e,Ve,tt)),ae=o.queryGeometry;var de,ge,me,$e,Ve,tt,yt,Ze,at,ot;return function(de,ge,me){let $e=1/0;zx(me,ge)&&($e=mv(me,ge[0]));for(let Ve=0;Ve<ge.length;Ve++){const tt=ge[Ve],yt=de[Ve];for(let Ze=0;Ze<tt.length-1;Ze++){const at=tt[Ze],ot=[at,tt[Ze+1],yt[Ze+1],yt[Ze],at];Zh(me,ot)&&($e=Math.min($e,mv(me,ot)))}}return $e!==1/0&&$e}(se,pe,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Vl{constructor(o){super(o,Pg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Io,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=Rg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new df(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Kc(this,o)}queryRadius(o){const i=o,s=gv(Wh("line-width",this,i),Wh("line-gap-width",this,i)),c=Wh("line-offset",this,i);return s/2+Math.abs(c)+Ep(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,s,c,p,g){if(o.queryGeometry.isAboveHorizon)return!1;const v=qy(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),w=o.pixelToTileUnitsFactor/2*gv(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),T=this.paint.get("line-offset").evaluate(i,s);return T&&(c=function(S,P){const N=[],F=new Oe(0,0);for(let V=0;V<S.length;V++){const j=S[V],q=[];for(let J=0;J<j.length;J++){const se=j[J],pe=j[J+1],ae=0===J?F:se.sub(j[J-1])._unit()._perp(),de=J===j.length-1?F:pe.sub(se)._unit()._perp(),ge=ae._add(de)._unit();ge._mult(1/(ge.x*de.x+ge.y*de.y)),q.push(ge._mult(P)._add(se))}N.push(q)}return N}(c,T*o.pixelToTileUnitsFactor)),function(S,P,N){for(let F=0;F<P.length;F++){const V=P[F];if(S.length>=3)for(let j=0;j<V.length;j++)if(tu(S,V[j]))return!0;if(Bx(S,V,N))return!0}return!1}(v,c,w)}isTileClipped(){return!0}},symbol:ud,background:class extends Vl{constructor(o){super(o,n_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Vl{constructor(o){super(o,Sf)}getProgramIds(){return["raster"]}},sky:class extends Vl{constructor(o){super(o,hd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),p=!c,g=o.style.light,v=g.properties.get("position");return p&&"viewport"===g.properties.get("anchor")&&Zi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?If(v.azimuthal,90-v.polar,i):If(c[0],90-c[1],i)}const s=this.paint.get("sky-gradient-center");return If(s[0],90-s[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class hu{constructor(i,s,c,p){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(s,p)}update(i,s,c){const{width:p,height:g}=i,{context:v}=this,{gl:w}=v,{HTMLImageElement:T,HTMLCanvasElement:S,HTMLVideoElement:P,ImageData:N,ImageBitmap:F}=Q;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!s||!1!==s.premultiply)),c||this.size&&this.size[0]===p&&this.size[1]===g){const{x:V,y:j}=c||{x:0,y:0};i instanceof T||i instanceof S||i instanceof P||i instanceof N||F&&i instanceof F?w.texSubImage2D(w.TEXTURE_2D,0,V,j,w.RGBA,w.UNSIGNED_BYTE,i):w.texSubImage2D(w.TEXTURE_2D,0,V,j,p,g,w.RGBA,w.UNSIGNED_BYTE,i.data)}else this.size=[p,g],i instanceof T||i instanceof S||i instanceof P||i instanceof N||F&&i instanceof F?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,i):w.texImage2D(w.TEXTURE_2D,0,this.format,p,g,0,this.format,w.UNSIGNED_BYTE,i.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(i,s){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?i===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:i),this.filter=i),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class zE{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class r_{constructor(){this.tasks={},this.taskQueue=[],li(["process"],this),this.invoker=new zE(this.process),this.nextId=0}add(i,s){const c=this.nextId++,p=function({type:g,isSymbolTile:v,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||v?"parseTile"!==g||v?"parseTile"===g&&v?300-w:"maybePrepare"===g&&v?400-w:500:200-w:100-w}(s);if(0===p){Qo();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:s,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Qo();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<s&&(s=g.priority,i=p)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class dd{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const c=i[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const Tb=["tile","layer","source","sourceLayer","state"];class o_{constructor(i,s,c,p,g){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=c,this._y=p,this.properties=i.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const s of Tb)void 0!==this[s]&&(i[s]=this[s]);return i}}const ql=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,s=0,c=0,p=0,g=0,v=0,w=0;for(1&i?p=g=v=32:s=c=w=32;(i>>=1)>1;){const S=s+p>>1,P=c+g>>1;1&i?(p=s,g=c,s=v,c=w):(s=p,c=g,p=v,g=w),v=S,w=P}const T=4*o;ql[T+0]=s,ql[T+1]=c,ql[T+2]=p,ql[T+3]=g}const ml=new Uint16Array(2178),du=new Uint8Array(1089),rm=new Uint16Array(1089);function Db(o){return 0===o?-.03125:32===o?.03125:0}var Nv=Ie([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Af={type:2,extent:pn,loadGeometry:()=>[[new Oe(0,0),new Oe(pn+1,0),new Oe(pn+1,pn+1),new Oe(0,pn+1),new Oe(0,0)]]};class Pf{constructor(i,s,c,p,g){this.tileID=i,this.uid=Ai(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<ks.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=su(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,g){const v={};if(!g)return v;for(const w of p){const T=w.layerIds.map(S=>g.getLayer(S)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(S=>T.filter(P=>P.id===S)[0]));for(const S of T)v[S.id]=w}}return v}(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof uu){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof uu&&g.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||"deferred"!==E()||I();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Ci}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(i)}const s=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hu(i,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hu(i,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new hu(i,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,s,c,p,g,v,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:w,transform:v,params:g,tileTransform:this.tileTransform},i,s,c):{}}querySourceFeatures(i,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;const w=Le(s&&s.filter),{z:T,x:S,y:P}=this.tileID.canonical,N={z:T,x:S,y:P};for(let F=0;F<v.length;F++){const V=v.feature(F);if(w.needGeometry){const J=wo(V,!0);if(!w.filter(new R(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!w.filter(new R(this.tileID.overscaledZ),V))continue;const j=c.getId(V,g),q=new o_(V,T,S,P,j);q.tile=N,i.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const c=Jr(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),p=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const v=this.buckets[g],w=v.layers[0].sourceLayer||"_geojsonTileLayer",T=c[w],S=i[w];if(!T||!S||0===Object.keys(S).length)continue;if(v.update(S,T,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof df||v instanceof kp){const N=s.style._getSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&N&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(N.id,this.tileID)}const P=s&&s.style&&s.style.getLayer(g);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ks.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=ks.now()+i}setTexture(i,s){const c=s.context,p=c.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new hu(c,i,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(i,s){const c={};for(const p of s)c[p]=!0;this.dependencies[i]=c}hasDependency(i,s){for(const c of i){const p=this.dependencies[c];if(p)for(const g of s)if(p[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=Ec(Af,this.tileID.canonical,this.tileTransform)[0],p=new vt,g=new qo;for(let v=0;v<c.length;v++){const{x:w,y:T}=c[v];p.emplaceBack(w,T),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(p,Zd.members),this._tileDebugSegments=Fi.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=Ec(Af,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const v=function(w,T){const S=su(w,T),P=Math.pow(2,w.z);for(let J=0;J<33;J++)for(let se=0;se<33;se++){const pe=ra((w.x+(se+Db(se))/32)/P),ae=ko((w.y+(J+Db(J))/32)/P),de=T.project(pe,ae),ge=33*J+se;ml[2*ge+0]=Math.round((de.x*S.scale-S.x)*pn),ml[2*ge+1]=Math.round((de.y*S.scale-S.y)*pn)}du.fill(0),rm.fill(0);for(let J=2045;J>=0;J--){const se=4*J,pe=ql[se+0],ae=ql[se+1],de=ql[se+2],ge=ql[se+3],me=pe+de>>1,$e=ae+ge>>1,Ve=me+$e-ae,tt=$e+pe-me,yt=33*ae+pe,Ze=33*ge+de,at=33*$e+me,ot=Math.hypot((ml[2*yt+0]+ml[2*Ze+0])/2-ml[2*at+0],(ml[2*yt+1]+ml[2*Ze+1])/2-ml[2*at+1])>=16;du[at]=du[at]||(ot?1:0),J<1022&&(du[at]=du[at]||du[33*(ae+tt>>1)+(pe+Ve>>1)]||du[33*(ge+tt>>1)+(de+Ve>>1)])}const N=new st,F=new Wt;let V=0;function j(J,se){const pe=33*se+J;return 0===rm[pe]&&(N.emplaceBack(ml[2*pe+0],ml[2*pe+1],J*pn/32,se*pn/32),rm[pe]=++V),rm[pe]-1}function q(J,se,pe,ae,de,ge){const me=J+pe>>1,$e=se+ae>>1;if(Math.abs(J-de)+Math.abs(se-ge)>1&&du[33*$e+me])q(de,ge,J,se,me,$e),q(pe,ae,de,ge,me,$e);else{const Ve=j(J,se),tt=j(pe,ae),yt=j(de,ge);F.emplaceBack(Ve,tt,yt)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:N,indices:F}}(this.tileID.canonical,s);p=v.vertices,g=v.indices}else{p=new st,g=new Wt;for(const{x:w,y:T}of c)p.emplaceBack(w,T,0,0);const v=Rp(p.int16,void 0,4);for(let w=0;w<v.length;w+=3)g.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=i.createVertexBuffer(p,Nv.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(g),this._tileBoundsSegments=Fi.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(i,s){const c=s.projection;if(!c||"globe"!==c.name||s.freezeTileCoverage)return;const p=this.tileID.canonical,g=Gh(Fy(p,s)),v=ao(s.zoom);let w;v>0&&(w=jd(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,p,s,g,w,v),this._makeGlobeTileDebugTextBuffer(i,p,s,g,w,v)}_globePoint(i,s,c,p,g,v,w){let T=ul(i,s,c);if(v){const S=1<<c.z,P=za(p.center.lng),N=ls(p.center.lat),F=(c.x+.5)/S-P;let V=0;F>.5?V=-1:F<-.5&&(V=1);let j=(i/pn+c.x)/S+V,q=(s/pn+c.y)/S;j=(j-P)*p._pixelsPerMercatorPixel+P,q=(q-N)*p._pixelsPerMercatorPixel+N;const J=[j*p.worldSize,q*p.worldSize,0];ur(J,J,v),T=bc(T,J,w)}return ur(T,T,g)}_makeGlobeTileDebugBorderBuffer(i,s,c,p,g,v){const w=new vt,T=new qo,S=new Be,P=(F,V,j,q,J)=>{const se=(j-F)/(J-1),pe=(q-V)/(J-1),ae=w.length;for(let de=0;de<J;de++){const ge=F+de*se,me=V+de*pe;w.emplaceBack(ge,me);const $e=this._globePoint(ge,me,s,c,p,g,v);S.emplaceBack($e[0],$e[1],$e[2]),T.emplaceBack(ae+de)}},N=pn;P(0,0,N,0,16),P(N,0,N,N,16),P(N,N,0,N,16),P(0,N,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(T),this._tileDebugBuffer=i.createVertexBuffer(w,Zd.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(S,ky.members),this._tileDebugSegments=Fi.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(i,s,c,p,g,v){const w=pn/4,T=new vt,S=new Wt,P=new Be,N=25;S.reserve(32),T.reserve(N),P.reserve(N);const F=(V,j)=>N*V+j;for(let V=0;V<N;V++){const j=V*w;for(let q=0;q<N;q++){const J=q*w;T.emplaceBack(J,j);const se=this._globePoint(J,j,s,c,p,g,v);P.emplaceBack(se[0],se[1],se[2])}}for(let V=0;V<4;V++)for(let j=0;j<4;j++){const q=F(V,j),J=F(V,j+1),se=F(V+1,j),pe=F(V+1,j+1);S.emplaceBack(q,J,se),S.emplaceBack(se,J,pe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(S),this._tileDebugTextBuffer=i.createVertexBuffer(T,Zd.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(P,ky.members),this._tileDebugTextSegments=Fi.simpleSegment(0,0,N,32)}}class Mb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,c){const p=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},ni(this.stateChanges[i][p],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const g in this.state[i])g!==p&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][p]){this.deletedStates[i][p]={};for(const g in this.state[i][p])c[g]||(this.deletedStates[i][p][g]=null)}else for(const g in c)this.deletedStates[i]&&this.deletedStates[i][p]&&null===this.deletedStates[i][p][g]&&delete this.deletedStates[i][p][g]}removeFeatureState(i,s,c){if(null===this.deletedStates[i])return;const p=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==s)null!==this.deletedStates[i][p]&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][c]=null);else if(void 0!==s)if(this.stateChanges[i]&&this.stateChanges[i][p])for(c in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][c]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,s){const c=String(s),p=ni({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const g=this.deletedStates[i][s];if(null===g)return{};for(const v in g)delete p[v]}return p}initializeTileState(i,s){i.setFeatureState(this.state,s)}coalesceChanges(i,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),ni(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(null===this.deletedStates[p])for(const v in this.state[p])g[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(null===this.deletedStates[p][v])this.state[p][v]={};else if(this.state[p][v])for(const w of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][w];g[v]=this.state[p][v]}c[p]=c[p]||{},ni(c[p],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const p in i)i[p].setFeatureState(c,s)}}class s_{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const c=this.toIdx(i,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function om(o,i,s,c){let p=0,g=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(c[v])<1e-15){if(s[v]<o[v]||s[v]>i[v])return null}else{const w=1/c[v];let T=(o[v]-s[v])*w,S=(i[v]-s[v])*w;if(T>S){const P=T;T=S,S=P}if(T>p&&(p=T),S<g&&(g=S),p>g)return null}return p}function Rf(o,i,s,c,p,g,v,w,T,S,P){const N=c-o,F=p-i,V=g-s,j=v-o,q=w-i,J=T-s,se=P[1]*J-P[2]*q,pe=P[2]*j-P[0]*J,ae=P[0]*q-P[1]*j,de=N*se+F*pe+V*ae;if(Math.abs(de)<1e-15)return null;const ge=1/de,me=S[0]-o,$e=S[1]-i,Ve=S[2]-s,tt=(me*se+$e*pe+Ve*ae)*ge;if(tt<0||tt>1)return null;const yt=$e*V-Ve*F,Ze=Ve*N-me*V,at=me*F-$e*N,ot=(P[0]*yt+P[1]*Ze+P[2]*at)*ge;return ot<0||tt+ot>1?null:(j*yt+q*Ze+J*at)*ge}function Fv(o,i,s){return(o-i)/(s-i)}function a_(o,i,s,c,p,g,v,w,T){const S=1<<s,P=g-c,N=v-p,F=(o+1)/S*P+c,V=(i+0)/S*N+p,j=(i+1)/S*N+p;w[0]=(o+0)/S*P+c,w[1]=V,T[0]=F,T[1]=j}class zv{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const v=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,v));const S=1/T,P=(V,j,q,J,se)=>{const pe=J?1:0,ae=(V+1)*q-pe,de=j*q,ge=(j+1)*q-pe;se[0]=V*q,se[1]=de,se[2]=ae,se[3]=ge};let N=new s_(T);const F=[];for(let V=0;V<T*T;V++){P(V%T,Math.floor(V/T),S,!1,F);const j=ch(F[0],F[1],g),q=ch(F[2],F[1],g),J=ch(F[2],F[3],g),se=ch(F[0],F[3],g);N.minimums.push(Math.min(j,q,J,se)),N.maximums.push(Math.max(j,q,J,se)),N.leaves.push(1)}for(w.push(N),T/=2;T>=1;T/=2){const V=w[w.length-1];N=new s_(T);for(let j=0;j<T*T;j++){P(j%T,Math.floor(j/T),2,!0,F);const q=V.getElevation(F[0],F[1]),J=V.getElevation(F[2],F[1]),se=V.getElevation(F[2],F[3]),pe=V.getElevation(F[0],F[3]),ae=V.isLeaf(F[0],F[1]),de=V.isLeaf(F[2],F[1]),ge=V.isLeaf(F[2],F[3]),me=V.isLeaf(F[0],F[3]),$e=Math.min(q.min,J.min,se.min,pe.min),Ve=Math.max(q.max,J.max,se.max,pe.max),tt=ae&&de&&ge&&me;N.maximums.push(Ve),N.minimums.push($e),N.leaves.push(Ve-$e<=5&&tt?1:0)}w.push(N)}return w}(this.dem),c=s.length-1,p=s[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(i,s,c,p,g,v,w=1){return om([i,s,-100],[c,p,this.maximums[0]*w],g,v)}raycast(i,s,c,p,g,v,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,s,c,p,g,v,w);if(null==T)return null;const S=[],P=[],N=[],F=[],V=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:j,t:q,nodex:J,nodey:se,depth:pe}=V.pop();if(this.leaves[j]){a_(J,se,pe,i,s,c,p,N,F);const de=1<<pe,ge=(J+0)/de,me=(J+1)/de,$e=(se+0)/de,Ve=(se+1)/de,tt=ch(ge,$e,this.dem)*w,yt=ch(me,$e,this.dem)*w,Ze=ch(me,Ve,this.dem)*w,at=ch(ge,Ve,this.dem)*w,ot=Rf(N[0],N[1],tt,F[0],N[1],yt,F[0],F[1],Ze,g,v),ft=Rf(F[0],F[1],Ze,N[0],F[1],at,N[0],N[1],tt,g,v),Dt=Math.min(null!==ot?ot:Number.MAX_VALUE,null!==ft?ft:Number.MAX_VALUE);if(Dt!==Number.MAX_VALUE)return Dt;{const Qe=Gd([],g,v,q);if(l_(tt,yt,at,Ze,Fv(Qe[0],N[0],F[0]),Fv(Qe[1],N[1],F[1]))>=Qe[2])return q}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){a_((J<<1)+this._siblingOffset[de][0],(se<<1)+this._siblingOffset[de][1],pe+1,i,s,c,p,N,F),N[2]=-100,F[2]=this.maximums[this.childOffsets[j]+de]*w;const ge=om(N,F,g,v);if(null!=ge){const me=ge;S[de]=me;let $e=!1;for(let Ve=0;Ve<ae&&!$e;Ve++)me>=S[P[Ve]]&&(P.splice(Ve,0,de),$e=!0);$e||(P[ae]=de),ae++}}for(let de=0;de<ae;de++){const ge=P[de];V.push({idx:this.childOffsets[j]+ge,t:S[ge],nodex:(J<<1)+this._siblingOffset[ge][0],nodey:(se<<1)+this._siblingOffset[ge][1],depth:pe+1})}}return null}_addNode(i,s,c){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,c,p,g){if(1===i[p].isLeaf(s,c))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const v=p-1,w=i[v];let T=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const N=2*s+this._siblingOffset[P][0],F=2*c+this._siblingOffset[P][1],V=w.getElevation(N,F),j=w.isLeaf(N,F),q=this._addNode(V.min,V.max,j);j&&(T|=1<<P),S||(S=q)}for(let P=0;P<this._siblingOffset.length;P++)T&1<<P||this._construct(i,2*s+this._siblingOffset[P][0],2*c+this._siblingOffset[P][1],v,S+P)}}function l_(o,i,s,c,p,g){return oi(oi(o,s,g),oi(i,c,g),p)}function ch(o,i,s){const c=s.dim,p=Cn(o*c-.5,0,c-1),g=Cn(i*c-.5,0,c-1),v=Math.floor(p),w=Math.floor(g),T=Math.min(v+1,c-1),S=Math.min(w+1,c-1);return l_(s.get(v,w),s.get(T,w),s.get(v,S),s.get(T,S),p-v,g-w)}const Bv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function sm(o,i,s){return(256*o*256+256*i+s)/10-1e4}function Sb(o,i,s){return 256*o+i+s/256-32768}class Ic{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,c,p=!1,g=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return Zi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const v=this.dim=s.height-2,w=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let T=0;T<v;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(v,T)]=w[this._idx(v-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,v)]=w[this._idx(T,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new zv(this)}get(i,s,c=!1){c&&(i=Cn(i,-1,this.dim),s=Cn(s,-1,this.dim));const p=4*this._idx(i,s);return("terrarium"===this.encoding?Sb:sm)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(i){return Bv[i]}get unpackVector(){return Bv[this.encoding]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const c=[0,0,0,0],p=Ic.getUnpackVector(s);let g=Math.floor((i+p[3])/p[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Cs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,g=s*this.dim+this.dim,v=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:p=g-1;break;case 1:g=p+1}switch(c){case-1:v=w-1;break;case 1:w=v+1}const T=-s*this.dim,S=-c*this.dim;for(let P=v;P<w;P++)for(let N=p;N<g;N++){const F=4*this._idx(N,P),V=4*this._idx(N+T,P+S);this.pixels[F+0]=i.pixels[V+0],this.pixels[F+1]=i.pixels[V+1],this.pixels[F+2]=i.pixels[V+2],this.pixels[F+3]=i.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Kt(Ic,"DEMData"),Kt(zv,"DemMinMaxQuadTree",{omit:["dem"]});class sa{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,c){const p=i.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(void 0!==c&&(g.timeout=setTimeout(()=>{this.remove(i,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const c=i.wrapped().key,p=void 0===s?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const c in this.data)for(const p of this.data[c])i(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class fd{constructor(i,s,c){this.func=i,this.mask=s,this.range=c}}fd.ReadOnly=!1,fd.ReadWrite=!0,fd.disabled=new fd(519,fd.ReadOnly,[0,1]);class Ua{constructor(i,s,c,p,g,v){this.test=i,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=v}}Ua.disabled=new Ua({func:519,mask:0},0,0,7680,7680,7680);class Zl{constructor(i,s,c){this.blendFunction=i,this.blendColor=s,this.mask=c}}Zl.Replace=[1,0],Zl.disabled=new Zl(Zl.Replace,an.transparent,[!1,!1,!1,!1]),Zl.unblended=new Zl(Zl.Replace,an.transparent,[!0,!0,!0,!0]),Zl.alphaBlended=new Zl([1,771],an.transparent,[!0,!0,!0,!0]);class gl{constructor(i,s,c){this.enable=i,this.mode=s,this.frontFace=c}}gl.disabled=new gl(!1,1029,2305),gl.backCCW=new gl(!0,1029,2305),gl.backCW=new gl(!0,1029,2304),gl.frontCW=new gl(!0,1028,2304),gl.frontCCW=new gl(!0,1028,2305);class Ac extends Os{constructor(i,s,c){super(),this.id=i,this._onlySymbols=c,s.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new sa(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Mb,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return Mn(this._tiles).map(i=>i.tileID).sort(Ib).map(i=>i.key)}getRenderableIds(i){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&s.push(this._tiles[c]);return i?s.sort((c,p)=>{const g=c.tileID,v=p.tileID,w=new Oe(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new Oe(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Ib).map(c=>c.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,i,s)))}_tileLoaded(i,s,c,p){if(p)if(i.state="errored",404!==p.status)this._source.fire(new fo(p,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=ks.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new va("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(i.neighboringTiles&&i.neighboringTiles[g]){const v=this.getTileByID(g);c(i,v),c(v,i)}}function c(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),S=g.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+T)?v+=T:1===Math.abs(v-T)&&(v-=T)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,w),p.neighboringTiles&&p.neighboringTiles[S]&&(p.neighboringTiles[S].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,c,p){for(const g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>c)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const S=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[S.key],v&&v.hasData()&&(w=S)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){p[w.key]=w;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=i.overscaledZ-1;c>=s;c--){const p=i.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const c=Math.ceil(i.width/s)+1,p=Math.ceil(i.height/s)+1,g=Math.floor(c*p*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(i){const s=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(i,s,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(i,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Wo(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(p=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(w=>this._source.hasTile(w)))):p=[];const g=this._updateRetainedTiles(p);if(lm(this._source.type)&&0!==p.length){const w={},T={},S=Object.keys(g);for(const N of S){const F=g[N],V=this._tiles[N];if(!V||V.fadeEndTime&&V.fadeEndTime<=ks.now())continue;const j=this.findLoadedParent(F,Math.max(F.overscaledZ-Ac.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),w[j.tileID.key]=j.tileID),T[N]=F}const P=p[p.length-1].overscaledZ;for(const N in this._tiles){const F=this._tiles[N];if(g[N]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>P;){V=V.scaledTo(V.overscaledZ-1);const j=this._tiles[V.key];if(j&&j.hasData()&&T[V.key]){g[N]=F.tileID;break}}}for(const N in w)g[N]||(this._coveredTiles[N]=!0,g[N]=w[N])}for(const w in g)this._tiles[w].clearFadeHold();const v=function(w,T){const S=[];for(const P in w)P in T||S.push(P);return S}(this._tiles,g);for(const w of v){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(0===i.length)return s;const c={},p=i.reduce((S,P)=>Math.min(S,P.overscaledZ),1/0),g=i[0].overscaledZ,v=Math.max(g-Ac.maxOverzooming,this._source.minzoom),w=Math.max(g+Ac.maxUnderzooming,this._source.minzoom),T={};for(const S of i){const P=this._addTile(S);s[S.key]=S,P.hasData()||p<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,p,w,s);for(const S of i){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const F=S.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){s[F.key]=F;continue}}else{const F=S.children(this._source.maxzoom);if(s[F[0].key]&&s[F[1].key]&&s[F[2].key]&&s[F[3].key])continue}let N=P.wasRequested();for(let F=S.overscaledZ-1;F>=v;--F){const V=S.scaledTo(F);if(c[V.key]||(c[V.key]=!0,P=this.getTile(V),!P&&N&&(P=this._addTile(V)),P&&(s[V.key]=V,N=P.wasRequested(),P.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let c,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(i){let s=this._tiles[i.key];if(s)return s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const c=!!s;if(!c){const p=this.map?this.map.painter:null;s=new Pf(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,c||this._source.fire(new va("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=s.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,c){const p=[],g=this.transform;if(!g)return p;const v="globe"===g.projection.name,w=za(g.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(v){const N=S.tileID.canonical;if(0===N.z){const F=[Math.abs(Cn(w,...pd(N,-1))-w),Math.abs(Cn(w,...pd(N,1))-w)];P=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(Cn(w,...pd(N,-1))-w),Math.abs(Cn(w,...pd(N,0))-w),Math.abs(Cn(w,...pd(N,1))-w)];P=[F.indexOf(Math.min(...F))-1]}}else P=[0];for(const N of P){const F=i.containsTile(S,g,s,N);F&&p.push(F)}}return p}getVisibleCoordinates(i){const s=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(lm(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=ks.now())return!0}return!1}setFeatureState(i,s,c){this._state.updateState(i=i||"_geojsonTileLayer",s,c)}removeFeatureState(i,s,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,c)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,c){const p=this._tiles[i];p&&p.setDependencies(s,c)}reloadTilesForDependencies(i,s){for(const c in this._tiles)this._tiles[c].hasDependency(i,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(i,s))};return void this._source.on("data",w)}const c=new Map,p=Array.isArray(i)?i:[i],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of p){const T=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)c.set(S.key,S);this.usedForTerrain&&w.updateElevation(!1)}un(Array.from(c.values()),(w,T)=>{const S=new Pf(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,P=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),T(P,S)})},s)}}function Ib(o,i){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||c-s||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function lm(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function pd(o,i){const s=1<<o.z;return[o.x/s+i,(o.x+1)/s+i]}Ac.maxOverzooming=10,Ac.maxUnderzooming=3;class cm{constructor(i,s,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(i,s,c){const p=c||i.findDEMTileFor(s);if(!p||!p.dem)return;const g=p.dem,v=p.tileID,w=1<<s.canonical.z-v.canonical.z;return new cm(p,p.tileSize/pn/w,[(s.canonical.x/w-v.canonical.x)*g.dim,(s.canonical.y/w-v.canonical.y)*g.dim])}tileCoordToPixel(i,s){const c=s*this._scale+this._offset[1],p=Math.floor(i*this._scale+this._offset[0]),g=Math.floor(c);return new Oe(p,g)}getElevationAt(i,s,c,p){const g=i*this._scale+this._offset[0],v=s*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(v),S=this._dem;return p=!!p,c?oi(oi(S.get(w,T,p),S.get(w,T+1,p),v-T),oi(S.get(w+1,T,p),S.get(w+1,T+1,p),v-T),g-w):S.get(w,T,p)}getElevationAtPixel(i,s,c){return this._dem.get(i,s,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*jl(1,i)*this._dem.stride}}class Vv{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Wc(pn,16,0),this.featureIndexArray=new ka,this.promoteId=s}insert(i,s,c,p,g,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,g,v);const T=this.grid;for(let S=0;S<s.length;S++){const P=s[S],N=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){const V=P[F];N[0]=Math.min(N[0],V.x),N[1]=Math.min(N[1],V.y),N[2]=Math.max(N[2],V.x),N[3]=Math.max(N[3],V.y)}N[0]<pn&&N[1]<pn&&N[2]>=0&&N[3]>=0&&T.insert(w,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Op(new Gp(this.rawTileData)).layers,this.sourceLayerCoder=new dd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s,c,p){this.loadVTLayers();const g=i.params||{},v=Le(g.filter),w=i.tileResult,T=i.transform,S=w.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(j,q,J,se)=>Gy(w.bufferedTilespaceGeometry,j,q,J,se));P.sort(Ab);let N=null;T.elevation&&P.length>0&&(N=cm.create(T.elevation,this.tileID));const F={};let V;for(let j=0;j<P.length;j++){const q=P[j];if(q===V)continue;V=q;const J=this.featureIndexArray.get(q);let se=null;this.loadMatchingFeature(F,J,v,g.layers,g.availableImages,s,c,p,(pe,ae,de,ge=0)=>(se||(se=Ec(pe,this.tileID.canonical,i.tileTransform)),ae.queryIntersectsFeature(w,pe,de,se,this.z,i.transform,i.pixelPosMatrix,N,ge)))}return F}loadMatchingFeature(i,s,c,p,g,v,w,T,S){const{featureIndex:P,bucketIndex:N,sourceLayerIndex:F,layoutVertexArrayOffset:V}=s,j=this.bucketLayerIDs[N];if(p&&!function(pe,ae){for(let de=0;de<pe.length;de++)if(ae.indexOf(pe[de])>=0)return!0;return!1}(p,j))return;const q=this.sourceLayerCoder.decode(F),J=this.vtLayers[q].feature(P);if(c.needGeometry){const pe=wo(J,!0);if(!c.filter(new R(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!c.filter(new R(this.tileID.overscaledZ),J))return;const se=this.getId(J,q);for(let pe=0;pe<j.length;pe++){const ae=j[pe];if(p&&p.indexOf(ae)<0)continue;const de=v[ae];if(!de)continue;let ge={};void 0!==se&&T&&(ge=T.getState(de.sourceLayer||"_geojsonTileLayer",se));const me=ni({},w[ae]);me.paint=u_(me.paint,de.paint,J,ge,g),me.layout=u_(me.layout,de.layout,J,ge,g);const $e=!S||S(J,de,ge,V);if(!$e)continue;const Ve=new o_(J,this.z,this.x,this.y,se);Ve.layer=me;let tt=i[ae];void 0===tt&&(tt=i[ae]=[]),tt.push({featureIndex:P,feature:Ve,intersectionZ:$e})}}lookupSymbolFeatures(i,s,c,p,g,v,w,T){const S={};this.loadVTLayers();const P=Le(g);for(const N of i)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:p,featureIndex:N,layoutVertexArrayOffset:0},P,v,w,T,s);return S}loadFeature(i){const{featureIndex:s,sourceLayerIndex:c}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),g=this.vtFeatures[p];if(g[s])return g[s];const v=this.vtLayers[p].feature(s);return g[s]=v,v}hasLayer(i){for(const s of this.bucketLayerIDs)for(const c of s)if(i===c)return!0;return!1}getId(i,s){let c=i.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[s];null!=p&&(c=i.properties[p]),"boolean"==typeof c&&(c=Number(c))}return c}}function u_(o,i,s,c,p){return sn(o,(g,v)=>{const w=i instanceof re?i.get(v):null;return w&&w.evaluate?w.evaluate(s,c,p):w})}function Ab(o,i){return i-o}Kt(Vv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class h_{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new Tc({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const c=this.getKey(i,s);return this.positions[c]}trim(){const i=this.width,s=this.height=Tn(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,c){const p=[];let g=i.length%2==1?-i[i.length-1]*c:0,v=i[0]*c,w=!0;p.push({left:g,right:v,isDash:w,zeroLength:0===i[0]});let T=i[0];for(let S=1;S<i.length;S++){w=!w;const P=i[S];g=T*c,T+=P,v=T*c,p.push({left:g,right:v,isDash:w,zeroLength:0===P})}return p}addRoundDash(i,s,c){const p=s/2;for(let g=-c;g<=c;g++){const v=this.width*(this.nextRow+c+g);let w=0,T=i[w];for(let S=0;S<this.width;S++){S/T.right>1&&(T=i[++w]);const P=Math.abs(S-T.left),N=Math.abs(S-T.right),F=Math.min(P,N);let V;const j=g/c*(p+1);if(T.isDash){const q=p-Math.abs(j);V=Math.sqrt(F*F+q*q)}else V=p-Math.sqrt(F*F+j*j);this.image.data[v+S]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(i,s){for(let T=i.length-1;T>=0;--T){const S=i[T],P=i[T+1];S.zeroLength?i.splice(T,1):P&&P.isDash===S.isDash&&(P.left=S.left,i.splice(T,1))}const c=i[0],p=i[i.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const g=this.width*this.nextRow;let v=0,w=i[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=i[++v]);const S=Math.abs(T-w.left),P=Math.abs(T-w.right),N=Math.min(S,P);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?N:-N)+s+128))}}addDash(i,s){const c=this.getKey(i,s);if(this.positions[c])return this.positions[c];const p="round"===s,g=p?7:0,v=2*g+1;if(this.nextRow+v>this.height)return Zi("LineAtlas out of space"),null;0===i.length&&i.push(1);let w=0;for(let P=0;P<i.length;P++)i[P]<0&&(Zi("Negative value is found in line dasharray, replacing values with 0"),i[P]=0),w+=i[P];if(0!==w){const P=this.width/w,N=this.getDashRanges(i,this.width,P);p?this.addRoundDash(N,P,g):this.addRegularDash(N,"square"===s?.5*P:0)}const T=this.nextRow+g;this.nextRow+=v;const S={tl:[T,g],br:[w,0]};return this.positions[c]=S,S}}Kt(h_,"LineAtlas");const Uv=1*fl;class jv{constructor(i){const s={},c=[];for(const w in i){const T=i[w],S=s[w]={};for(const P in T.glyphs){const N=T.glyphs[+P];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const F=N.metrics.localGlyph?Uv:1,V={x:0,y:0,w:N.bitmap.width+2*F,h:N.bitmap.height+2*F};c.push(V),S[P]=V}}const{w:p,h:g}=th(c),v=new Tc({width:p||1,height:g||1});for(const w in i){const T=i[w];for(const S in T.glyphs){const P=T.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const N=s[w][S],F=P.metrics.localGlyph?Uv:1;Tc.copy(P.bitmap,v,{x:0,y:0},{x:N.x+F,y:N.y+F},P.bitmap)}}this.image=v,this.positions=s}}Kt(jv,"GlyphAtlas");class BE{constructor(i){this.tileID=new Wo(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=su(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,s,c,p,g){this.status="parsing",this.data=i,this.collisionBoxArray=new Ci;const v=new dd(Object.keys(i.layers).sort()),w=new Vv(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},S=new h_(256,256),P={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},N=s.familiesBySource[this.source];for(const ge in N){const me=i.layers[ge];if(!me)continue;let $e=!1,Ve=!1;for(const Ze of N[ge])"symbol"===Ze[0].type?$e=!0:Ve=!0;if(!0===this.isSymbolTile&&!$e||!1===this.isSymbolTile&&!Ve)continue;1===me.version&&Zi(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const tt=v.encode(ge),yt=[];for(let Ze=0;Ze<me.length;Ze++){const at=me.feature(Ze),ot=w.getId(at,ge);yt.push({feature:at,id:ot,index:Ze,sourceLayerIndex:tt})}for(const Ze of N[ge]){const at=Ze[0];void 0!==this.isSymbolTile&&"symbol"===at.type!==this.isSymbolTile||at.minzoom&&this.zoom<Math.floor(at.minzoom)||at.maxzoom&&this.zoom>=at.maxzoom||"none"!==at.visibility&&(um(Ze,this.zoom,c),(T[at.id]=at.createBucket({index:w.bucketLayerIDs.length,layers:Ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(yt,P,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(Ze.map(ot=>ot.id)))}}let F,V,j,q;S.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=()=>{if(F)return g(F);if(V&&j&&q){const ge=new jv(V),me=new hb(j,q);for(const $e in T){const Ve=T[$e];Ve instanceof uu?(um(Ve.layers,this.zoom,c),qg(Ve,V,ge.positions,j,me.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Ve.hasPattern&&(Ve instanceof df||Ve instanceof kp||Ve instanceof Wu)&&(um(Ve.layers,this.zoom,c),Ve.addFeatures(P,this.tileID.canonical,me.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:Mn(T).filter($e=>!$e.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:S,imageAtlas:me,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?ge.positions:null})}},pe=sn(P.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(pe).length?p.send("getGlyphs",{uid:this.uid,stacks:pe},(ge,me)=>{F||(F=ge,V=me,se())},void 0,!1,J):V={};const ae=Object.keys(P.iconDependencies);ae.length?p.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ge,me)=>{F||(F=ge,j=me,se())},void 0,!1,J):j={};const de=Object.keys(P.patternDependencies);de.length?p.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(ge,me)=>{F||(F=ge,q=me,se())},void 0,!1,J):q={},se()}}function um(o,i,s){const c=new R(i);for(const p of o)p.recalculate(c,s)}class d_{constructor(i){this.entries={},this.scheduler=i}request(i,s,c,p){const g=this.entries[i]=this.entries[i]||{callbacks:[]};if(g.result){const[v,w]=g.result;return this.scheduler?this.scheduler.add(()=>{p(v,w)},s):p(v,w),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((v,w)=>{g.result=[v,w];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(v,w)},s):T(v,w);setTimeout(()=>delete this.entries[i],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(v=>v!==p),g.callbacks.length||(g.cancel(),delete this.entries[i]))}}}function Ds(o,i,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},p=>{const g=Za(o.request,(v,w,T,S)=>{v?p(v):w&&p(null,{vectorTile:s?void 0:new Op(new Gp(w)),rawData:w,cacheControl:T,expires:S})});return()=>{g.cancel(),p()}},i)}const f_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $v{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(i,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(1!==p)throw new Error(`Got v${p} data when expected v1.`);const g=f_[15&c];if(!g)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new $v(w,v,g,i)}constructor(i,s=64,c=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const g=f_.indexOf(this.ArrayType),v=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=i,this.coords[this._pos++]=s,c}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Lf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:w}=this,T=[0,g.length-1,0],S=[];for(;T.length;){const P=T.pop()||0,N=T.pop()||0,F=T.pop()||0;if(N-F<=w){for(let J=F;J<=N;J++){const se=v[2*J],pe=v[2*J+1];se>=i&&se<=c&&pe>=s&&pe<=p&&S.push(g[J])}continue}const V=F+N>>1,j=v[2*V],q=v[2*V+1];j>=i&&j<=c&&q>=s&&q<=p&&S.push(g[V]),(0===P?i<=j:s<=q)&&(T.push(F),T.push(V-1),T.push(1-P)),(0===P?c>=j:p>=q)&&(T.push(V+1),T.push(N),T.push(1-P))}return S}within(i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],T=[],S=c*c;for(;w.length;){const P=w.pop()||0,N=w.pop()||0,F=w.pop()||0;if(N-F<=v){for(let J=F;J<=N;J++)Pb(g[2*J],g[2*J+1],i,s)<=S&&T.push(p[J]);continue}const V=F+N>>1,j=g[2*V],q=g[2*V+1];Pb(j,q,i,s)<=S&&T.push(p[V]),(0===P?i-c<=j:s-c<=q)&&(w.push(F),w.push(V-1),w.push(1-P)),(0===P?i+c>=j:s+c>=q)&&(w.push(V+1),w.push(N),w.push(1-P))}return T}}function Lf(o,i,s,c,p,g){if(p-c<=s)return;const v=c+p>>1;Wl(o,i,v,c,p,g),Lf(o,i,s,c,v-1,1-g),Lf(o,i,s,v+1,p,1-g)}function Wl(o,i,s,c,p,g){for(;p>c;){if(p-c>600){const S=p-c+1,P=s-c+1,N=Math.log(S),F=.5*Math.exp(2*N/3),V=.5*Math.sqrt(N*F*(S-F)/S)*(P-S/2<0?-1:1);Wl(o,i,s,Math.max(c,Math.floor(s-P*F/S+V)),Math.min(p,Math.floor(s+(S-P)*F/S+V)),g)}const v=i[2*s+g];let w=c,T=p;for(hh(o,i,c,s),i[2*p+g]>v&&hh(o,i,c,p);w<T;){for(hh(o,i,w,T),w++,T--;i[2*w+g]<v;)w++;for(;i[2*T+g]>v;)T--}i[2*c+g]===v?hh(o,i,c,T):(T++,hh(o,i,T,p)),T<=s&&(c=T+1),s<=T&&(p=T-1)}}function hh(o,i,s,c){p_(o,s,c),p_(i,2*s,2*c),p_(i,2*s+1,2*c+1)}function p_(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}function Pb(o,i,s,c){const p=o-s,g=i-c;return p*p+g*g}u.ARRAY_TYPE=ws,u.AUTH_ERR_MSG=ye,u.Aabb=so,u.Actor=class{constructor(o,i,s){this.target=o,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},li(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qo()?o:Q,this.scheduler=new r_}send(o,i,s,c,p=!1,g){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[v]=s);const w=xl(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:o,hasCallback:!!s,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:Fu(i,w)},w),{cancel:()=>{s&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const i=o.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(i.mustQueue||Qo()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,i),c&&c.metadata||{type:"message"})}else this.processTask(s,i)}processTask(o,i){if("<response>"===i.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(i.error?s(Xc(i.error)):s(null,Xc(i.data)))}else{const s=xl(this.globalScope)?void 0:[],c=i.hasCallback?(g,v)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?Fu(g):null,data:Fu(v,s)},s)}:g=>{},p=Xc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,c);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],p.source)[g[1]](p,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=Yu,u.Color=an,u.ColorMode=Zl,u.CullFaceMode=gl,u.DEMData=Ic,u.DataConstantProperty=G,u.DedupedRequest=d_,u.DepthMode=fd,u.EXTENT=pn,u.Elevation=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const s=i.getSource().maxzoom,c=1<<s,p=Math.floor(o.x),g=Math.floor((o.x-p)*c),v=Math.floor(o.y*c),w=this.findDEMTileFor(new Wo(s,p,s,g,v));return!(!w||!w.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,s=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const c=this._source();if(!c||o.y<0||o.y>1)return i;const p=c.getSource().maxzoom,g=1<<p,v=Math.floor(o.x),w=o.x-v,T=new Wo(p,v,p,Math.floor(w*g),Math.floor(o.y*g)),S=this.findDEMTileFor(T);if(!S||!S.dem)return i;const P=S.dem,N=1<<S.tileID.canonical.z,F=(w*N-S.tileID.canonical.x)*P.dim,V=(o.y*N-S.tileID.canonical.y)*P.dim,j=Math.floor(F),q=Math.floor(V);return(s?this.exaggeration():1)*oi(oi(P.get(j,q),P.get(j,q+1),V-q),oi(P.get(j+1,q),P.get(j+1,q+1),V-q),F-j)}getAtTileOffset(o,i,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new Kd(o.wrap+(o.canonical.x+i/pn)/c,(o.canonical.y+s/pn)/c))}getAtTileOffsetFunc(o,i,s,c){return p=>{const g=this.getAtTileOffset(o,p.x,p.y),v=c.upVector(o.canonical,p.x,p.y);return Qs(v,v,g*c.upVectorScale(o.canonical,i,s).metersToTile),v}}getForTilePoints(o,i,s,c){if(this.isUsingMockSource())return!1;const p=cm.create(this,o,c);return!!p&&(i.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const s=i.dem.tree,c=i.tileID,p=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/p-c.canonical.x,v=o.canonical.y/p-c.canonical.y,w=0;for(let T=0;T<o.canonical.z-c.canonical.z&&!s.leaves[w];T++){g*=2,v*=2;const S=2*Math.floor(v)+Math.floor(g);w=s.childOffsets[w]+S,g%=1,v%=1}return{min:this.exaggeration()*s.minimums[w],max:this.exaggeration()*s.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=fo,u.EvaluationParameters=R,u.Event=va,u.Evented=Os,u.FillExtrusionBucket=Wu,u.Frustum=Wd,u.FrustumCorners=Ny,u.GLOBE_RADIUS=Na,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=Uh,u.GLOBE_ZOOM_THRESHOLD_MIN=lg,u.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,i){const s=new vt,c=new Wt,p=[],g=o+1+2,v=i[0]+1,w=i[0]+1+(1+i.length),T=(S,P,N)=>{let F=S===g-1?S-2:0===S?S:S-1;return F+=N?24575:0,[F,P]};for(let S=0;S<g;++S)s.emplaceBack(...T(S,0,!0));for(let S=0;S<v;++S)for(let P=0;P<g;++P)s.emplaceBack(...T(P,S,(0===P||P===g-1)&&!0));for(let S=0;S<i.length;++S){const P=i[S];for(let N=0;N<g;++N)s.emplaceBack(...T(N,P,!0))}for(let S=0;S<i.length;++S){const P=c.length,N=i[S]+1+2,F=new Wt;for(let q=0;q<N-1;q++){const J=q===N-2,se=J?g*(w-i.length+S-q):g;for(let pe=0;pe<g-1;pe++){const ae=q*g+pe;0===q||J||0===pe||pe===g-2?(F.emplaceBack(ae+1,ae,ae+se),F.emplaceBack(ae+se,ae+se+1,ae+1)):(c.emplaceBack(ae+1,ae,ae+se),c.emplaceBack(ae+se,ae+se+1,ae+1))}}const V=Fi.simpleSegment(0,P,s.length,c.length-P);for(let q=0;q<F.uint16.length;q+=3)c.emplaceBack(F.uint16[q],F.uint16[q+1],F.uint16[q+2]);const j=Fi.simpleSegment(0,P,s.length,c.length-P);p.push({withoutSkirts:V,withSkirts:j})}return{vertices:s,indices:c,segments:p}}_createGrid(o){const i=this._fillGridMeshWithLods(64,$h);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,Zd.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new Wt;for(let p=0;p<=64;p++)i.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const s=new Ei,c=new Ei;this._poleSegments=[];for(let p=0,g=0;p<lg;p++){const v=360/(1<<p);s.emplaceBack(0,-Na,0,.5,0),c.emplaceBack(0,-Na,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,S=oi(0,v,T),[P,N,F]=Hh(Lx,Uy,S,Na);s.emplaceBack(P,N,F,T,0),c.emplaceBack(P,N,F,T,1)}this._poleSegments.push(Fi.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,Rx,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Rx,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,i){if(!this._wireframeSegments){const s=new oo,c=64,p=c+1+2,g=1;this._wireframeSegments=[];for(let v=0,w=0;v<$h.length;v++){const T=$h[v];for(let P=g;P<T+g;P++)for(let N=g;N<c+g;N++){const F=P*p+N;s.emplaceBack(F,F+1),s.emplaceBack(F,F+p),s.emplaceBack(F,F+p+1)}const S=T*c*3;this._wireframeSegments.push(Fi.simpleSegment(0,w,(T+1)*p,S)),w+=S}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},u.GlyphManager=rd,u.ImagePosition=Cv,u.KDBush=$v,u.LivePerformanceUtils=Pd,u.LngLat=pi,u.LngLatBounds=Js,u.LocalGlyphMode=vf,u.MAX_MERCATOR_LATITUDE=Oo,u.MercatorCoordinate=Kd,u.ONE_EM=lo,u.OverscaledTileID=Wo,u.PerformanceMarkers=_a,u.Point=Oe,u.Properties=ce,u.RGBAImage=Cs,u.Ray=Oy,u.RequestManager=class{constructor(o,i,s){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let s=0;s<10;s++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",At,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!De(o))return o;const s=Ot(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!De(o))return o;const s=Ot(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeSourceURL(o,i,s,c){if(!De(o))return o;const p=Ot(o);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),s&&p.params.push(`language=${s}`),c&&p.params.push(`worldview=${c}`),this._makeAPIURL(p,this._customAccessToken||i)}normalizeSpriteURL(o,i,s,c){const p=Ot(o);return De(o)?(p.path=`/styles/v1${p.path}/sprite${i}${s}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${i}${s}`,xt(p))}normalizeTileURL(o,i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!De(o))return o;const c=Ot(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||s&&"raster"!==c.authority&&512===s?"@2x":""}${Ae.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${Se.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Se.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(g){for(const v of g){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(c.params)||Se.ACCESS_TOKEN;return Se.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(o,i){const s=Ot(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Se.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Se.TILE_URL_VERSION}/`,"")}`;let p=s.params;return i&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(o,i){const s=!!i&&De(i),c=[];for(const p of o.tiles||[])Fe(p)?c.push(this.canonicalizeTileURL(p,s)):c.push(p);return c}_makeAPIURL(o,i){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=Ot(Se.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const p=o.params.indexOf("secure");p>=0&&o.params.splice(p,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!Se.REQUIRE_ACCESS_TOKEN)return xt(o);if(i=i||Se.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(p=>-1===p.indexOf("access_token")),o.params.push(`access_token=${i||""}`),xt(o)}},u.ResourceType=qa,u.SegmentVector=Fi,u.SourceCache=Ac,u.StencilMode=Ua,u.StructArrayLayout1ui2=qo,u.StructArrayLayout2f1f2i16=vn,u.StructArrayLayout2i4=vt,u.StructArrayLayout2ui4=oo,u.StructArrayLayout3f12=Yn,u.StructArrayLayout3ui6=Wt,u.StructArrayLayout4i8=st,u.StructArrayLayout5f20=Ei,u.Texture=hu,u.Tile=Pf,u.Transitionable=H,u.Uniform1f=lp,u.Uniform1i=class extends gc{constructor(o){super(o),this.current=0}set(o,i,s){this.fetchUniformLocation(o,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},u.Uniform2f=class extends gc{constructor(o){super(o),this.current=[0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},u.Uniform3f=class extends gc{constructor(o){super(o),this.current=[0,0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},u.Uniform4f=Dy,u.UniformColor=Qm,u.UniformMatrix2f=class extends gc{constructor(o){super(o),this.current=Px}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},u.UniformMatrix3f=class extends gc{constructor(o){super(o),this.current=Ax}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},u.UniformMatrix4f=class extends gc{constructor(o){super(o),this.current=Nh}set(o,i,s){if(this.fetchUniformLocation(o,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},u.UnwrappedTileID=pv,u.ValidationError=ct,u.VectorTileFeature=Np,u.VectorTileWorkerSource=class extends Os{constructor(o,i,s,c,p){super(),this.actor=o,this.layerIndex=i,this.availableImages=s,this.loadVectorData=p||Ds,this.loading={},this.loaded={},this.deduped=new d_(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,i){const s=o.uid,c=o&&o.request,p=c&&c.collectResourceTiming,g=this.loading[s]=new BE(o);g.abort=this.loadVectorData(o,(v,w)=>{const T=!this.loading[s];if(delete this.loading[s],T||v||!w)return g.status="done",T||(this.loaded[s]=g),i(v);const S=w.rawData,P={};w.expires&&(P.expires=w.expires),w.cacheControl&&(P.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new Op(new Gp(S));const N=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,V)=>{if(F||!V)return i(F);const j={};if(p){const q=Du(c);q.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(q)))}i(null,ni({rawTileData:S.slice(0)},V,P,j))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,i){const s=this.loaded,c=o.uid,p=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=su(o.tileID.canonical,o.projection);const v=(w,T)=>{const S=g.reloadCallback;S&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,S)),i(w,T)};"parsing"===g.status?g.reloadCallback=v:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(o,i){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),i()}removeTile(o,i){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],i()}},u.WritingMode=Ba,u.ZoomDependentExpression=Ol,u.add=vc,u.addDynamicAttributes=nm,u.adjoint=function(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=i[4],w=i[5],T=i[6],S=i[7],P=i[8];return o[0]=v*P-w*S,o[1]=p*S-c*P,o[2]=c*w-p*v,o[3]=w*T-g*P,o[4]=s*P-p*T,o[5]=p*g-s*w,o[6]=g*S-v*T,o[7]=c*T-s*S,o[8]=s*v-c*g,o},u.asyncAll=un,u.bezier=jr,u.bindAll=li,u.boundsAttributes=Nv,u.bufferConvexPolygon=function(o,i){const s=[];for(let c=0;c<o.length;c++){const p=Ji(c-1,-1,o.length-1),g=Ji(c+1,-1,o.length-1),v=o[c],w=o[g],T=o[p].sub(v).unit(),S=w.sub(v).unit(),P=S.angleWithSep(T.x,T.y),N=T.add(S).unit().mult(-1*i/Math.sin(P/2));s.push(v.add(N))}return s},u.cacheEntryPossiblyAdded=function(o){wl++,wl>Bc&&(o.getActor().send("enforceCacheSizeLimit",tc),wl=0)},u.calculateGlobeLabelMatrix=function(o,i){const{x:s,y:c}=o.point,p=By(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return _c(p,p,Uu(na(i)))},u.calculateGlobeMatrix=function(o){const{x:i,y:s}=o.point,{lng:c,lat:p}=o._center;return By(i,s,o.worldSize,c,p)},u.calculateGlobeMercatorMatrix=function(o){const i=o.pixelsPerMeter,s=i/jl(1,o.center.lat),c=cl(new Float64Array(16));return zh(c,c,[o.point.x,o.point.y,0]),yc(c,c,[s,s,i]),Float32Array.from(c)},u.circumferenceAtLatitude=wp,u.clamp=Cn,u.clearTileCache=function(o){if(!fa())return;const i=Q.caches.delete(Ha);o&&i.catch(o).then(()=>o())},u.clipLine=Sv,u.clone=function(o){var i=new ws(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},u.clone$1=Nn,u.collisionCircleLayout=kg,u.config=Se,u.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},u.create=function(){var o=new ws(16);return ws!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},u.create$1=ng,u.createExpression=Aa,u.createLayout=Ie,u.createStyleLayer=function(o){return"custom"===o.type?new im(o):new i_[o.type](o)},u.cross=dp,u.degToRad=It,u.distance=function(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])},u.div=function(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o[2]=i[2]/s[2],o},u.dot=ea,u.earthRadius=eu,u.ease=yr,u.easeCubicInOut=Ui,u.ecefToLatLng=function([o,i,s]){const c=Math.hypot(o,i,s),p=Math.atan2(o,s),g=.5*Math.PI-Math.acos(-i/c);return new pi(En(p),En(g))},u.emitValidationErrors=Qf,u.endsWith=ui,u.enforceCacheSizeLimit=function(o){pa(),Qr&&Qr.then(i=>{i.keys().then(s=>{for(let c=0;c<s.length-o;c++)i.delete(s[c])})})},u.evaluateSizeForFeature=ff,u.evaluateSizeForZoom=ru,u.evaluateVariableOffset=Gg,u.evented=b,u.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},u.exactEquals$1=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},u.exported=ks,u.exported$1=Ae,u.extend=ni,u.extend$1=es,u.fillExtrusionHeightLift=Dg,u.filterObject=Jo,u.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},u.fromQuat=function(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=s+s,w=c+c,T=p+p,S=s*v,P=c*v,N=c*w,F=p*v,V=p*w,j=p*T,q=g*v,J=g*w,se=g*T;return o[0]=1-N-j,o[1]=P+se,o[2]=F-J,o[3]=0,o[4]=P-se,o[5]=1-S-j,o[6]=V+q,o[7]=0,o[8]=F+J,o[9]=V-q,o[10]=1-S-N,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},u.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},u.fromScaling=up,u.furthestTileCorner=function(o){const i=Math.round((o+45+360)%360/90)%4;return Ii[i]},u.getAABBPointSquareDist=function(o,i,s){let c=0;for(let p=0;p<2;++p){const g=s?s[p]:0;o[p]>g&&(c+=(o[p]-g)*(o[p]-g)),i[p]<g&&(c+=(g-i[p])*(g-i[p]))}return c},u.getAnchorAlignment=Xp,u.getAnchorJustification=wf,u.getBounds=function(o){let i=1/0,s=1/0,c=-1/0,p=-1/0;for(const g of o)i=Math.min(i,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),p=Math.max(p,g.y);return{min:new Oe(i,s),max:new Oe(c,p)}},u.getColumn=da,u.getDefaultExportFromCjs=he,u.getGridMatrix=function(o,i,s,c){const p=i.getNorth(),g=i.getSouth(),v=i.getWest(),w=i.getEast(),T=1<<o.z,S=w-v,P=p-g,N=S/64,F=-P/$h[s],V=[0,N,0,F,0,0,p,v,0];if(o.z>0){const j=180/c;Ay(V,V,[j/S+1,0,0,0,j/P+1,0,-.5*j/N,.5*j/F,1])}return V[2]=T,V[5]=o.x,V[8]=o.y,V},u.getImage=ue,u.getJSON=function(o,i){return ma(ni(o,{type:"json"}),i)},u.getLatitudinalLod=function(o){const i=Oo-5;o=Cn(o,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(It(o))),3);return Math.round(s*($h.length-1))},u.getMapSessionAPI=Ir,u.getPerformanceMeasurement=Du,u.getProjection=Qg,u.getRTLTextPluginStatus=E,u.getReferrer=ds,u.getTilePoint=function(o,{x:i,y:s},c=0){return new Oe(((i-c)*o.scale-o.x)*pn,(s*o.scale-o.y)*pn)},u.getTileVec3=function(o,i,s=0){return Bh(((i.x-s)*o.scale-o.x)*pn,(i.y*o.scale-o.y)*pn,kx(i.z,i.y))},u.getVideo=function(o,i){const s=Q.document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let c=0;c<o.length;c++){const p=Q.document.createElement("source");ga(o[c])||(s.crossOrigin="Anonymous"),p.src=o[c],s.appendChild(p)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(o){const i=[0,0,0],s=cl(new Float64Array(16));return _c(s,o.pixelMatrix,o.globeMatrix),ur(i,i,s),new Oe(i[0],i[1])},u.globeDenormalizeECEF=Uu,u.globeECEFOrigin=function(o,i){const s=[0,0,0];return ur(s,s,Gh(na(i.canonical))),ur(s,s,o),s},u.globeMetersToEcef=_p,u.globeNormalizeECEF=Gh,u.globePixelsToTileUnits=function(o,i){return pn/(512*Math.pow(2,o))*xp(na(i))},u.globePoleMatrixForTile=function(o,i,s){const c=cl(new Float64Array(16)),p=(i/(1<<o)-.5)*Math.PI*2;return $d(c,s.globeMatrix,p),Float32Array.from(c)},u.globeTileBounds=na,u.globeTiltAtLngLat=Vy,u.globeToMercatorTransition=ao,u.globeUseCustomAntiAliasing=function(o,i,s){const c=ao(s.zoom),p=o.style.map._antialias,g=!!i.extStandardDerivatives,v=i.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===c&&!p&&!v&&g},u.identity=cl,u.identity$1=Vu,u.invert=jd,u.isFullscreen=function(){return!!Q.document.fullscreenElement||!!Q.document.webkitFullscreenElement},u.isLngLatBehindGlobe=go,u.isMapAuthenticated=function(o){return wr.has(o)},u.isMapboxURL=De,u.isSafariWithAntialiasingBug=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!xl(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=ko,u.latLngToECEF=wc,u.len=pp,u.length=Bu,u.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},u.lngFromMercatorX=ra,u.loadVectorTile=Ds,u.makeRequest=ma,u.mapValue=function(o,i,s,c,p){return Cn((o-i)/(s-i)*(p-c)+c,c,p)},u.mercatorScale=Ox,u.mercatorXfromLng=za,u.mercatorYfromLat=ls,u.mercatorZfromAltitude=jl,u.mul=Py,u.mul$1=fp,u.multiply=_c,u.multiply$1=Ay,u.multiply$2=Jc,u.nextPowerOfTwo=Tn,u.normalize=Zo,u.normalize$1=ME,u.normalize$2=sg,u.number=oi,u.ortho=function(o,i,s,c,p,g,v){var w=1/(i-s),T=1/(c-p),S=1/(g-v);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(i+s)*w,o[13]=(p+c)*T,o[14]=(v+g)*S,o[15]=1,o},u.pbf=Og,u.perspective=function(o,i,s,c,p){var g,v=1/Math.tan(i/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=p&&p!==1/0?(o[10]=(p+c)*(g=1/(c-p)),o[14]=2*p*c*g):(o[10]=-1,o[14]=-2*c),o},u.pick=function(o,i){const s={};for(let c=0;c<i.length;c++){const p=i[c];p in o&&(s[p]=o[p])}return s},u.plugin=A,u.pointGeometry=Re,u.polesInViewport=function(o){const i=cl(new Float64Array(16));_c(i,o.pixelMatrix,o.globeMatrix);const s=[0,ta,0],c=[0,Fa,0];return ur(s,s,i),ur(c,c,i),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!go(o,new pi(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!go(o,new pi(o.center.lat,-90))]},u.polygonContainsPoint=tu,u.polygonIntersectsBox=Gy,u.polygonIntersectsPolygon=Zh,u.polygonizeBounds=function(o,i,s=0,c=!0){const p=new Oe(s,s),g=o.sub(p),v=i.add(p),w=[g,new Oe(v.x,g.y),v,new Oe(g.x,v.y)];return c&&w.push(g.clone()),w},u.posAttributes=Zd,u.postMapLoadEvent=lr,u.postPerformanceEvent=vr,u.postTurnstileEvent=Nt,u.potpack=th,u.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},u.radToDeg=En,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:a}),b.on("pluginStateChange",o),o},u.removeAuthState=function(o){wr.delete(o)},u.renderColorRamp=Gu,u.resample=$u,u.rotateX=ig,u.rotateX$1=Vh,u.rotateY=$d,u.rotateY$1=Ly,u.rotateZ=function(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[0],v=i[1],w=i[2],T=i[3],S=i[4],P=i[5],N=i[6],F=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*p+S*c,o[1]=v*p+P*c,o[2]=w*p+N*c,o[3]=T*p+F*c,o[4]=S*p-g*c,o[5]=P*p-v*c,o[6]=N*p-w*c,o[7]=F*p-T*c,o},u.rotateZ$1=function(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T+p*w,o[1]=p*T-c*w,o[2]=g*T+v*w,o[3]=v*T-g*w,o},u.scale=yc,u.scale$1=mp,u.scale$2=Qs,u.scaleAndAdd=Gd,u.set=function(o,i,s,c){return o[0]=i,o[1]=s,o[2]=c,o},u.setCacheLimits=function(o,i){tc=o,Bc=i},u.setColumn=function(o,i,s){o[4*i+0]=s[0],o[4*i+1]=s[1],o[4*i+2]=s[2],o[4*i+3]=s[3]},u.setRTLTextPlugin=function(o,i,s=!1){if(m===rp||m===ll||m===Ra)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=ks.resolveURL(o),m=rp,zu=i,_(),s||I()},u.smoothstep=bn,u.spec=Je,u.squaredLength=function(o){var i=o[0],s=o[1],c=o[2];return i*i+s*s+c*c},u.storeAuthState=function(o,i){i?wr.add(o):wr.delete(o)},u.sub=Es,u.subtract=Lo,u.symbolSize=jp,u.tileAABB=function(o,i,s,c,p,g,v,w,T){if("globe"===T.name)return function zy(o,i,s){const c=i/o.worldSize,p=o.globeMatrix;if(s.z<=1){const Ve=na(s).getCorners();return ug(Ve,p,c),so.fromPoints(Ve)}const g=Yd(s),v=vp(g);ug(v,p,c);const w=Number.MAX_VALUE,T=[-w,-w,-w],S=[w,w,w];if(g.contains(o.center)){for(const yt of v)cr(S,S,yt),Hd(T,T,yt);T[2]=0;const Ve=o.point,tt=[Ve.x*c,Ve.y*c,0];return cr(S,S,tt),Hd(T,T,tt),new so(S,T)}const P=[p[12]*c,p[13]*c,p[14]*c],N=g.getCenter(),F=Cn(o.center.lat,-Oo,Oo),V=Cn(N.lat,-Oo,Oo),j=za(o.center.lng),q=ls(F);let J=j-za(N.lng);const se=q-ls(V);J>.5?J-=1:J<-.5&&(J+=1);let pe=0;Math.abs(J)>Math.abs(se)?pe=J>=0?1:3:(pe=se>=0?0:2,Gd(P,P,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(It(se>=0?g.getSouth():g.getNorth()))*Na));const ae=v[pe],de=v[(pe+1)%4],ge=new cg(ae,de,P),me=[yp(ge,0)||ae[0],yp(ge,1)||ae[1],yp(ge,2)||ae[2]],$e=ao(o.zoom);if($e>0){const Ve=function({x:yt,y:Ze,z:at},ot,ft,Dt,Qe){const Vt=1/(1<<at);let en=yt*Vt,Ut=en+Vt,zn=Ze*Vt,St=zn+Vt,mn=0;const Bn=(en+Ut)/2-Dt;return Bn>.5?mn=-1:Bn<-.5&&(mn=1),en=((en+mn)*ot-(Dt*=ot))*ft+Dt,Ut=((Ut+mn)*ot-Dt)*ft+Dt,zn=(zn*ot-(Qe*=ot))*ft+Qe,St=(St*ot-Qe)*ft+Qe,[[en,St,0],[Ut,St,0],[Ut,zn,0],[en,zn,0]]}(s,i,o._pixelsPerMercatorPixel,j,q);for(let yt=0;yt<v.length;yt++)bc(v[yt],Ve[yt],$e);const tt=vc([],Ve[pe],Ve[(pe+1)%4]);Qs(tt,tt,.5),bc(me,tt,$e)}for(const Ve of v)cr(S,S,Ve),Hd(T,T,Ve);return S[2]=Math.min(ae[2],de[2]),cr(S,S,me),Hd(T,T,me),new so(S,T)}(o,i,new Yu(s,c,p));const S=su({z:s,x:c,y:p},T);return new so([(g+S.x/S.scale)*i,i*(S.y/S.scale),v],[(g+S.x2/S.scale)*i,i*(S.y2/S.scale),w])},u.tileCornersToBounds=Yd,u.tileTransform=su,u.transformMat3=function(o,i,s){var c=i[0],p=i[1],g=i[2];return o[0]=c*s[0]+p*s[3]+g*s[6],o[1]=c*s[1]+p*s[4]+g*s[7],o[2]=c*s[2]+p*s[5]+g*s[8],o},u.transformMat4=ur,u.transformMat4$1=Qc,u.transformQuat=xc,u.transitionTileAABBinECEF=Fy,u.translate=zh,u.transpose=function(o,i){if(o===i){var s=i[1],c=i[2],p=i[5];o[1]=i[3],o[2]=i[6],o[3]=s,o[5]=i[7],o[6]=c,o[7]=p}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},u.triggerPluginCompletionEvent=d,u.uniqueId=Ai,u.updateGlobeVertexNormal=function(o,i,s,c,p){const g=5*i+2;o.float32[g+0]=s,o.float32[g+1]=c,o.float32[g+2]=p},u.validateCustomStyleLayer=function(o){const i=[],s=o.id;return void 0===s&&i.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},u.validateFilter=o=>xs(Xs(o)),u.validateFog=o=>xs(Ro(o)),u.validateLayer=o=>xs(Nl(o)),u.validateLight=o=>xs(kr(o)),u.validateSource=o=>xs(sl(o)),u.validateStyle=Nu,u.validateTerrain=o=>xs(Rh(o)),u.values=Mn,u.vectorTile=rf,u.version=Me,u.warnOnce=Zi,u.window=Q,u.wrap=Ji}),ze(0,function(u){function Q(fe){if("number"==typeof fe||"boolean"==typeof fe||"string"==typeof fe||null==fe)return JSON.stringify(fe);if(Array.isArray(fe)){let Y="[";for(const ue of fe)Y+=`${Q(ue)},`;return`${Y}]`}let Z="{";for(const Y of Object.keys(fe).sort())Z+=`${Y}:${Q(fe[Y])},`;return`${Z}}`}function Me(fe){let Z="";for(const Y of u.refProperties)Z+=`/${Q(fe[Y])}`;return Z}class Pe{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Y){for(const ye of Z)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=u.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of Y)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ue=function(ye,De){const Fe={};for(let Ce=0;Ce<ye.length;Ce++){const We=De&&De[ye[Ce].id]||Me(ye[Ce]);De&&(De[ye[Ce].id]=We);let Mt=Fe[We];Mt||(Mt=Fe[We]=[]),Mt.push(ye[Ce])}const Ne=[];for(const Ce in Fe)Ne.push(Fe[Ce]);return Ne}(u.values(this._layerConfigs),this.keyCache);for(const ye of ue){const De=ye.map(Ot=>this._layers[Ot.id]),Fe=De[0];if("none"===Fe.visibility)continue;const Ne=Fe.source||"";let Ce=this.familiesBySource[Ne];Ce||(Ce=this.familiesBySource[Ne]={});const We=Fe.sourceLayer||"_geojsonTileLayer";let Mt=Ce[We];Mt||(Mt=Ce[We]=[]),Mt.push(De)}}}class Se{loadTile(Z,Y){const{uid:ue,encoding:ye,rawImageData:De,padding:Fe,buildQuadTree:Ne}=Z,Ce=u.window.ImageBitmap&&De instanceof u.window.ImageBitmap?this.getImageData(De,Fe):De;Y(null,new u.DEMData(ue,Ce,ye,Fe<1,Ne))}getImageData(Z,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ue=this.offscreenCanvasContext.getImageData(-Y,-Y,Z.width+2*Y,Z.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}function Ae(fe,Z){if(0!==fe.length){pt(fe[0],Z);for(var Y=1;Y<fe.length;Y++)pt(fe[Y],!Z)}}function pt(fe,Z){for(var Y=0,ue=0,ye=0,De=fe.length,Fe=De-1;ye<De;Fe=ye++){var Ne=(fe[ye][0]-fe[Fe][0])*(fe[Fe][1]+fe[ye][1]),Ce=Y+Ne;ue+=Math.abs(Y)>=Math.abs(Ne)?Y-Ce+Ne:Ne-Ce+Y,Y=Ce}Y+ue>=0!=!!Z&&fe.reverse()}var Zt=u.getDefaultExportFromCjs(function fe(Z,Y){var ue,ye=Z&&Z.type;if("FeatureCollection"===ye)for(ue=0;ue<Z.features.length;ue++)fe(Z.features[ue],Y);else if("GeometryCollection"===ye)for(ue=0;ue<Z.geometries.length;ue++)fe(Z.geometries[ue],Y);else if("Feature"===ye)fe(Z.geometry,Y);else if("Polygon"===ye)Ae(Z.coordinates,Y);else if("MultiPolygon"===ye)for(ue=0;ue<Z.coordinates.length;ue++)Ae(Z.coordinates[ue],Y);return Z});const Ft=u.VectorTileFeature.prototype.toGeoJSON;var Ct={exports:{}},Lt=u.pointGeometry,At=u.vectorTile.VectorTileFeature,he=Ye;function Ye(fe,Z){this.options=Z||{},this.features=fe,this.length=fe.length}function _t(fe,Z){this.id="number"==typeof fe.id?fe.id:void 0,this.type=fe.type,this.rawGeometry=1===fe.type?[fe.geometry]:fe.geometry,this.properties=fe.tags,this.extent=Z||4096}Ye.prototype.feature=function(fe){return new _t(this.features[fe],this.options.extent)},_t.prototype.loadGeometry=function(){var fe=this.rawGeometry;this.geometry=[];for(var Z=0;Z<fe.length;Z++){for(var Y=fe[Z],ue=[],ye=0;ye<Y.length;ye++)ue.push(new Lt(Y[ye][0],Y[ye][1]));this.geometry.push(ue)}return this.geometry},_t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var fe=this.geometry,Z=1/0,Y=-1/0,ue=1/0,ye=-1/0,De=0;De<fe.length;De++)for(var Fe=fe[De],Ne=0;Ne<Fe.length;Ne++){var Ce=Fe[Ne];Z=Math.min(Z,Ce.x),Y=Math.max(Y,Ce.x),ue=Math.min(ue,Ce.y),ye=Math.max(ye,Ce.y)}return[Z,ue,Y,ye]},_t.prototype.toGeoJSON=At.prototype.toGeoJSON;var Ue=u.pbf,Re=he;function it(fe){var Z=new Ue;return function(Y,ue){for(var ye in Y.layers)ue.writeMessage(3,Oe,Y.layers[ye])}(fe,Z),Z.finish()}function Oe(fe,Z){var Y;Z.writeVarintField(15,fe.version||1),Z.writeStringField(1,fe.name||""),Z.writeVarintField(5,fe.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<fe.length;Y++)ue.feature=fe.feature(Y),Z.writeMessage(2,Pt,ue);var ye=ue.keys;for(Y=0;Y<ye.length;Y++)Z.writeStringField(3,ye[Y]);var De=ue.values;for(Y=0;Y<De.length;Y++)Z.writeMessage(4,Ui,De[Y])}function Pt(fe,Z){var Y=fe.feature;void 0!==Y.id&&Z.writeVarintField(1,Y.id),Z.writeMessage(2,Gt,fe),Z.writeVarintField(3,Y.type),Z.writeMessage(4,Ii,Y)}function Gt(fe,Z){var Y=fe.feature,ue=fe.keys,ye=fe.values,De=fe.keycache,Fe=fe.valuecache;for(var Ne in Y.properties){var Ce=Y.properties[Ne],We=De[Ne];if(null!==Ce){void 0===We&&(ue.push(Ne),De[Ne]=We=ue.length-1),Z.writeVarint(We);var Mt=typeof Ce;"string"!==Mt&&"boolean"!==Mt&&"number"!==Mt&&(Ce=JSON.stringify(Ce));var Ot=Mt+":"+Ce,xt=Fe[Ot];void 0===xt&&(ye.push(Ce),Fe[Ot]=xt=ye.length-1),Z.writeVarint(xt)}}}function It(fe,Z){return(Z<<3)+(7&fe)}function En(fe){return fe<<1^fe>>31}function Ii(fe,Z){for(var Y=fe.loadGeometry(),ue=fe.type,ye=0,De=0,Fe=Y.length,Ne=0;Ne<Fe;Ne++){var Ce=Y[Ne],We=1;1===ue&&(We=Ce.length),Z.writeVarint(It(1,We));for(var Mt=3===ue?Ce.length-1:Ce.length,Ot=0;Ot<Mt;Ot++){1===Ot&&1!==ue&&Z.writeVarint(It(2,Mt-1));var xt=Ce[Ot].x-ye,Rn=Ce[Ot].y-De;Z.writeVarint(En(xt)),Z.writeVarint(En(Rn)),ye+=xt,De+=Rn}3===ue&&Z.writeVarint(It(7,1))}}function Ui(fe,Z){var Y=typeof fe;"string"===Y?Z.writeStringField(1,fe):"boolean"===Y?Z.writeBooleanField(7,fe):"number"===Y&&(fe%1!=0?Z.writeDoubleField(3,fe):fe<0?Z.writeSVarintField(6,fe):Z.writeVarintField(5,fe))}Ct.exports=it,Ct.exports.fromVectorTileJs=it,Ct.exports.fromGeojsonVt=function(fe,Z){Z=Z||{};var Y={};for(var ue in fe)Y[ue]=new Re(fe[ue].features,Z),Y[ue].name=ue,Y[ue].version=Z.version,Y[ue].extent=Z.extent;return it({layers:Y})},Ct.exports.GeoJSONWrapper=Re;var jr=u.getDefaultExportFromCjs(Ct.exports);const yr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},Cn=Math.fround||(bn=new Float32Array(1),fe=>(bn[0]=+fe,bn[0]));var bn;const Ji=3,un=5,Mn=6;class ni{constructor(Z){this.options=Object.assign(Object.create(yr),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Y,minZoom:ue,maxZoom:ye}=this.options;Y&&console.time("total time");const De=`prepare ${Z.length} points`;Y&&console.time(De),this.points=Z;const Fe=[];for(let Ce=0;Ce<Z.length;Ce++){const We=Z[Ce];if(!We.geometry)continue;const[Mt,Ot]=We.geometry.coordinates,xt=Cn(ri(Mt)),Rn=Cn(Tn(Ot));Fe.push(xt,Rn,1/0,Ce,-1,1),this.options.reduce&&Fe.push(0)}let Ne=this.trees[ye+1]=this._createTree(Fe);Y&&console.timeEnd(De);for(let Ce=ye;Ce>=ue;Ce--){const We=+Date.now();Ne=this.trees[Ce]=this._createTree(this._cluster(Ne,Ce)),Y&&console.log("z%d: %d clusters in %dms",Ce,Ne.numItems,+Date.now()-We)}return Y&&console.timeEnd("total time"),this}getClusters(Z,Y){let ue=((Z[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,Z[1]));let De=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ue=-180,De=180;else if(ue>De){const Ot=this.getClusters([ue,ye,180,Fe],Y),xt=this.getClusters([-180,ye,De,Fe],Y);return Ot.concat(xt)}const Ne=this.trees[this._limitZoom(Y)],Ce=Ne.range(ri(ue),Tn(Fe),ri(De),Tn(ye)),We=Ne.data,Mt=[];for(const Ot of Ce){const xt=this.stride*Ot;Mt.push(We[xt+un]>1?ji(We,xt,this.clusterProps):this.points[We[xt+Ji]])}return Mt}getChildren(Z){const Y=this._getOriginId(Z),ue=this._getOriginZoom(Z),ye="No cluster with the specified id.",De=this.trees[ue];if(!De)throw new Error(ye);const Fe=De.data;if(Y*this.stride>=Fe.length)throw new Error(ye);const Ne=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),Ce=De.within(Fe[Y*this.stride],Fe[Y*this.stride+1],Ne),We=[];for(const Mt of Ce){const Ot=Mt*this.stride;Fe[Ot+4]===Z&&We.push(Fe[Ot+un]>1?ji(Fe,Ot,this.clusterProps):this.points[Fe[Ot+Ji]])}if(0===We.length)throw new Error(ye);return We}getLeaves(Z,Y,ue){const ye=[];return this._appendLeaves(ye,Z,Y=Y||10,ue=ue||0,0),ye}getTile(Z,Y,ue){const ye=this.trees[this._limitZoom(Z)],De=Math.pow(2,Z),{extent:Fe,radius:Ne}=this.options,Ce=Ne/Fe,We=(ue-Ce)/De,Mt=(ue+1+Ce)/De,Ot={features:[]};return this._addTileFeatures(ye.range((Y-Ce)/De,We,(Y+1+Ce)/De,Mt),ye.data,Y,ue,De,Ot),0===Y&&this._addTileFeatures(ye.range(1-Ce/De,We,1,Mt),ye.data,De,ue,De,Ot),Y===De-1&&this._addTileFeatures(ye.range(0,We,Ce/De,Mt),ye.data,-1,ue,De,Ot),Ot.features.length?Ot:null}getClusterExpansionZoom(Z){let Y=this._getOriginZoom(Z)-1;for(;Y<=this.options.maxZoom;){const ue=this.getChildren(Z);if(Y++,1!==ue.length)break;Z=ue[0].properties.cluster_id}return Y}_appendLeaves(Z,Y,ue,ye,De){const Fe=this.getChildren(Y);for(const Ne of Fe){const Ce=Ne.properties;if(Ce&&Ce.cluster?De+Ce.point_count<=ye?De+=Ce.point_count:De=this._appendLeaves(Z,Ce.cluster_id,ue,ye,De):De<ye?De++:Z.push(Ne),Z.length===ue)break}return De}_createTree(Z){const Y=new u.KDBush(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<Z.length;ue+=this.stride)Y.add(Z[ue],Z[ue+1]);return Y.finish(),Y.data=Z,Y}_addTileFeatures(Z,Y,ue,ye,De,Fe){for(const Ne of Z){const Ce=Ne*this.stride,We=Y[Ce+un]>1;let Mt,Ot,xt;if(We)Mt=Ai(Y,Ce,this.clusterProps),Ot=Y[Ce],xt=Y[Ce+1];else{const Fn=this.points[Y[Ce+Ji]];Mt=Fn.properties;const[Dn,Nt]=Fn.geometry.coordinates;Ot=ri(Dn),xt=Tn(Nt)}const Rn={type:1,geometry:[[Math.round(this.options.extent*(Ot*De-ue)),Math.round(this.options.extent*(xt*De-ye))]],tags:Mt};let Hn;Hn=We||this.options.generateId?Y[Ce+Ji]:this.points[Y[Ce+Ji]].id,void 0!==Hn&&(Rn.id=Hn),Fe.features.push(Rn)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Y){const{radius:ue,extent:ye,reduce:De,minPoints:Fe}=this.options,Ne=ue/(ye*Math.pow(2,Y)),Ce=Z.data,We=[],Mt=this.stride;for(let Ot=0;Ot<Ce.length;Ot+=Mt){if(Ce[Ot+2]<=Y)continue;Ce[Ot+2]=Y;const xt=Ce[Ot],Rn=Ce[Ot+1],Hn=Z.within(Ce[Ot],Ce[Ot+1],Ne),Fn=Ce[Ot+un];let Dn=Fn;for(const Nt of Hn){const Ni=Nt*Mt;Ce[Ni+2]>Y&&(Dn+=Ce[Ni+un])}if(Dn>Fn&&Dn>=Fe){let Nt,Ni=xt*Fn,lr=Rn*Fn,wi=-1;const vr=((Ot/Mt|0)<<5)+(Y+1)+this.points.length;for(const zo of Hn){const Ir=zo*Mt;if(Ce[Ir+2]<=Y)continue;Ce[Ir+2]=Y;const wr=Ce[Ir+un];Ni+=Ce[Ir]*wr,lr+=Ce[Ir+1]*wr,Ce[Ir+4]=vr,De&&(Nt||(Nt=this._map(Ce,Ot,!0),wi=this.clusterProps.length,this.clusterProps.push(Nt)),De(Nt,this._map(Ce,Ir)))}Ce[Ot+4]=vr,We.push(Ni/Dn,lr/Dn,1/0,vr,-1,Dn),De&&We.push(wi)}else{for(let Nt=0;Nt<Mt;Nt++)We.push(Ce[Ot+Nt]);if(Dn>1)for(const Nt of Hn){const Ni=Nt*Mt;if(!(Ce[Ni+2]<=Y)){Ce[Ni+2]=Y;for(let lr=0;lr<Mt;lr++)We.push(Ce[Ni+lr])}}}}return We}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Y,ue){if(Z[Y+un]>1){const Fe=this.clusterProps[Z[Y+Mn]];return ue?Object.assign({},Fe):Fe}const ye=this.points[Z[Y+Ji]].properties,De=this.options.map(ye);return ue&&De===ye?Object.assign({},De):De}}function ji(fe,Z,Y){return{type:"Feature",id:fe[Z+Ji],properties:Ai(fe,Z,Y),geometry:{type:"Point",coordinates:[(ue=fe[Z],360*(ue-.5)),$r(fe[Z+1])]}};var ue}function Ai(fe,Z,Y){const ue=fe[Z+un],ye=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,De=fe[Z+Mn],Fe=-1===De?{}:Object.assign({},Y[De]);return Object.assign(Fe,{cluster:!0,cluster_id:fe[Z+Ji],point_count:ue,point_count_abbreviated:ye})}function ri(fe){return fe/360+.5}function Tn(fe){const Z=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function $r(fe){const Z=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function li(fe,Z,Y,ue){for(var ye,De=ue,Fe=Y-Z>>1,Ne=Y-Z,Ce=fe[Z],We=fe[Z+1],Mt=fe[Y],Ot=fe[Y+1],xt=Z+3;xt<Y;xt+=3){var Rn=ui(fe[xt],fe[xt+1],Ce,We,Mt,Ot);if(Rn>De)ye=xt,De=Rn;else if(Rn===De){var Hn=Math.abs(xt-Fe);Hn<Ne&&(ye=xt,Ne=Hn)}}De>ue&&(ye-Z>3&&li(fe,Z,ye,ue),fe[ye+2]=De,Y-ye>3&&li(fe,ye,Y,ue))}function ui(fe,Z,Y,ue,ye,De){var Fe=ye-Y,Ne=De-ue;if(0!==Fe||0!==Ne){var Ce=((fe-Y)*Fe+(Z-ue)*Ne)/(Fe*Fe+Ne*Ne);Ce>1?(Y=ye,ue=De):Ce>0&&(Y+=Fe*Ce,ue+=Ne*Ce)}return(Fe=fe-Y)*Fe+(Ne=Z-ue)*Ne}function sn(fe,Z,Y,ue){var ye={id:void 0===fe?null:fe,type:Z,geometry:Y,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Fe=De.geometry,Ne=De.type;if("Point"===Ne||"MultiPoint"===Ne||"LineString"===Ne)Jo(De,Fe);else if("Polygon"===Ne||"MultiLineString"===Ne)for(var Ce=0;Ce<Fe.length;Ce++)Jo(De,Fe[Ce]);else if("MultiPolygon"===Ne)for(Ce=0;Ce<Fe.length;Ce++)for(var We=0;We<Fe[Ce].length;We++)Jo(De,Fe[Ce][We])}(ye),ye}function Jo(fe,Z){for(var Y=0;Y<Z.length;Y+=3)fe.minX=Math.min(fe.minX,Z[Y]),fe.minY=Math.min(fe.minY,Z[Y+1]),fe.maxX=Math.max(fe.maxX,Z[Y]),fe.maxY=Math.max(fe.maxY,Z[Y+1])}function Nn(fe,Z,Y,ue){if(Z.geometry){var ye=Z.geometry.coordinates,De=Z.geometry.type,Fe=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),Ne=[],Ce=Z.id;if(Y.promoteId?Ce=Z.properties[Y.promoteId]:Y.generateId&&(Ce=ue||0),"Point"===De)Ps(ye,Ne);else if("MultiPoint"===De)for(var We=0;We<ye.length;We++)Ps(ye[We],Ne);else if("LineString"===De)Zi(ye,Ne,Fe,!1);else if("MultiLineString"===De){if(Y.lineMetrics){for(We=0;We<ye.length;We++)Zi(ye[We],Ne=[],Fe,!1),fe.push(sn(Ce,"LineString",Ne,Z.properties));return}ho(ye,Ne,Fe,!1)}else if("Polygon"===De)ho(ye,Ne,Fe,!0);else{if("MultiPolygon"!==De){if("GeometryCollection"===De){for(We=0;We<Z.geometry.geometries.length;We++)Nn(fe,{id:Ce,geometry:Z.geometry.geometries[We],properties:Z.properties},Y,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(We=0;We<ye.length;We++){var Mt=[];ho(ye[We],Mt,Fe,!0),Ne.push(Mt)}}fe.push(sn(Ce,De,Ne,Z.properties))}}function Ps(fe,Z){Z.push(ec(fe[0])),Z.push(Qo(fe[1])),Z.push(0)}function Zi(fe,Z,Y,ue){for(var ye,De,Fe=0,Ne=0;Ne<fe.length;Ne++){var Ce=ec(fe[Ne][0]),We=Qo(fe[Ne][1]);Z.push(Ce),Z.push(We),Z.push(0),Ne>0&&(Fe+=ue?(ye*We-Ce*De)/2:Math.sqrt(Math.pow(Ce-ye,2)+Math.pow(We-De,2))),ye=Ce,De=We}var Mt=Z.length-3;Z[2]=1,li(Z,0,Mt,Y),Z[Mt+2]=1,Z.size=Math.abs(Fe),Z.start=0,Z.end=Z.size}function ho(fe,Z,Y,ue){for(var ye=0;ye<fe.length;ye++){var De=[];Zi(fe[ye],De,Y,ue),Z.push(De)}}function ec(fe){return fe/360+.5}function Qo(fe){var Z=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function Jr(fe,Z,Y,ue,ye,De,Fe,Ne){if(ue/=Z,De>=(Y/=Z)&&Fe<ue)return fe;if(Fe<Y||De>=ue)return null;for(var Ce=[],We=0;We<fe.length;We++){var Mt=fe[We],Ot=Mt.geometry,xt=Mt.type,Rn=0===ye?Mt.minX:Mt.minY,Hn=0===ye?Mt.maxX:Mt.maxY;if(Rn>=Y&&Hn<ue)Ce.push(Mt);else if(!(Hn<Y||Rn>=ue)){var Fn=[];if("Point"===xt||"MultiPoint"===xt)zc(Ot,Fn,Y,ue,ye);else if("LineString"===xt)xl(Ot,Fn,Y,ue,ye,!1,Ne.lineMetrics);else if("MultiLineString"===xt)da(Ot,Fn,Y,ue,ye,!1);else if("Polygon"===xt)da(Ot,Fn,Y,ue,ye,!0);else if("MultiPolygon"===xt)for(var Dn=0;Dn<Ot.length;Dn++){var Nt=[];da(Ot[Dn],Nt,Y,ue,ye,!0),Nt.length&&Fn.push(Nt)}if(Fn.length){if(Ne.lineMetrics&&"LineString"===xt){for(Dn=0;Dn<Fn.length;Dn++)Ce.push(sn(Mt.id,xt,Fn[Dn],Mt.tags));continue}"LineString"!==xt&&"MultiLineString"!==xt||(1===Fn.length?(xt="LineString",Fn=Fn[0]):xt="MultiLineString"),"Point"!==xt&&"MultiPoint"!==xt||(xt=3===Fn.length?"Point":"MultiPoint"),Ce.push(sn(Mt.id,xt,Fn,Mt.tags))}}}return Ce.length?Ce:null}function zc(fe,Z,Y,ue,ye){for(var De=0;De<fe.length;De+=3){var Fe=fe[De+ye];Fe>=Y&&Fe<=ue&&(Z.push(fe[De]),Z.push(fe[De+1]),Z.push(fe[De+2]))}}function xl(fe,Z,Y,ue,ye,De,Fe){for(var Ne,Ce,We=bl(fe),Mt=0===ye?tc:Bc,Ot=fe.start,xt=0;xt<fe.length-3;xt+=3){var Rn=fe[xt],Hn=fe[xt+1],Fn=fe[xt+2],Dn=fe[xt+3],Nt=fe[xt+4],Ni=0===ye?Rn:Hn,lr=0===ye?Dn:Nt,wi=!1;Fe&&(Ne=Math.sqrt(Math.pow(Rn-Dn,2)+Math.pow(Hn-Nt,2))),Ni<Y?lr>Y&&(Ce=Mt(We,Rn,Hn,Dn,Nt,Y),Fe&&(We.start=Ot+Ne*Ce)):Ni>ue?lr<ue&&(Ce=Mt(We,Rn,Hn,Dn,Nt,ue),Fe&&(We.start=Ot+Ne*Ce)):Ha(We,Rn,Hn,Fn),lr<Y&&Ni>=Y&&(Ce=Mt(We,Rn,Hn,Dn,Nt,Y),wi=!0),lr>ue&&Ni<=ue&&(Ce=Mt(We,Rn,Hn,Dn,Nt,ue),wi=!0),!De&&wi&&(Fe&&(We.end=Ot+Ne*Ce),Z.push(We),We=bl(fe)),Fe&&(Ot+=Ne)}var vr=fe.length-3;Rn=fe[vr],Hn=fe[vr+1],Fn=fe[vr+2],(Ni=0===ye?Rn:Hn)>=Y&&Ni<=ue&&Ha(We,Rn,Hn,Fn),vr=We.length-3,De&&vr>=3&&(We[vr]!==We[0]||We[vr+1]!==We[1])&&Ha(We,We[0],We[1],We[2]),We.length&&Z.push(We)}function bl(fe){var Z=[];return Z.size=fe.size,Z.start=fe.start,Z.end=fe.end,Z}function da(fe,Z,Y,ue,ye,De){for(var Fe=0;Fe<fe.length;Fe++)xl(fe[Fe],Z,Y,ue,ye,De,!1)}function Ha(fe,Z,Y,ue){fe.push(Z),fe.push(Y),fe.push(ue)}function tc(fe,Z,Y,ue,ye,De){var Fe=(De-Z)/(ue-Z);return fe.push(De),fe.push(Y+(ye-Y)*Fe),fe.push(1),Fe}function Bc(fe,Z,Y,ue,ye,De){var Fe=(De-Y)/(ye-Y);return fe.push(Z+(ue-Z)*Fe),fe.push(De),fe.push(1),Fe}function Qr(fe,Z){for(var Y=[],ue=0;ue<fe.length;ue++){var ye,De=fe[ue],Fe=De.type;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)ye=Rs(De.geometry,Z);else if("MultiLineString"===Fe||"Polygon"===Fe){ye=[];for(var Ne=0;Ne<De.geometry.length;Ne++)ye.push(Rs(De.geometry[Ne],Z))}else if("MultiPolygon"===Fe)for(ye=[],Ne=0;Ne<De.geometry.length;Ne++){for(var Ce=[],We=0;We<De.geometry[Ne].length;We++)Ce.push(Rs(De.geometry[Ne][We],Z));ye.push(Ce)}Y.push(sn(De.id,Fe,ye,De.tags))}return Y}function Rs(fe,Z){var Y=[];Y.size=fe.size,void 0!==fe.start&&(Y.start=fe.start,Y.end=fe.end);for(var ue=0;ue<fe.length;ue+=3)Y.push(fe[ue]+Z,fe[ue+1],fe[ue+2]);return Y}function fa(fe,Z){if(fe.transformed)return fe;var Y,ue,ye,De=1<<fe.z,Fe=fe.x,Ne=fe.y;for(Y=0;Y<fe.features.length;Y++){var Ce=fe.features[Y],We=Ce.geometry,Mt=Ce.type;if(Ce.geometry=[],1===Mt)for(ue=0;ue<We.length;ue+=2)Ce.geometry.push(pa(We[ue],We[ue+1],Z,De,Fe,Ne));else for(ue=0;ue<We.length;ue++){var Ot=[];for(ye=0;ye<We[ue].length;ye+=2)Ot.push(pa(We[ue][ye],We[ue][ye+1],Z,De,Fe,Ne));Ce.geometry.push(Ot)}}return fe.transformed=!0,fe}function pa(fe,Z,Y,ue,ye,De){return[Math.round(Y*(fe*ue-ye)),Math.round(Y*(Z*ue-De))]}function Ga(fe,Z,Y,ue,ye){for(var De=Z===ye.maxZoom?0:ye.tolerance/((1<<Z)*ye.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ue,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ne=0;Ne<fe.length;Ne++){Fe.numFeatures++,wl(Fe,fe[Ne],De,ye);var Ce=fe[Ne].minX,We=fe[Ne].minY,Mt=fe[Ne].maxX,Ot=fe[Ne].maxY;Ce<Fe.minX&&(Fe.minX=Ce),We<Fe.minY&&(Fe.minY=We),Mt>Fe.maxX&&(Fe.maxX=Mt),Ot>Fe.maxY&&(Fe.maxY=Ot)}return Fe}function wl(fe,Z,Y,ue){var ye=Z.geometry,De=Z.type,Fe=[];if("Point"===De||"MultiPoint"===De)for(var Ne=0;Ne<ye.length;Ne+=3)Fe.push(ye[Ne]),Fe.push(ye[Ne+1]),fe.numPoints++,fe.numSimplified++;else if("LineString"===De)qa(Fe,ye,fe,Y,!1,!1);else if("MultiLineString"===De||"Polygon"===De)for(Ne=0;Ne<ye.length;Ne++)qa(Fe,ye[Ne],fe,Y,"Polygon"===De,0===Ne);else if("MultiPolygon"===De)for(var Ce=0;Ce<ye.length;Ce++){var We=ye[Ce];for(Ne=0;Ne<We.length;Ne++)qa(Fe,We[Ne],fe,Y,!0,0===Ne)}if(Fe.length){var Mt=Z.tags||null;if("LineString"===De&&ue.lineMetrics){for(var Ot in Mt={},Z.tags)Mt[Ot]=Z.tags[Ot];Mt.mapbox_clip_start=ye.start/ye.size,Mt.mapbox_clip_end=ye.end/ye.size}var xt={geometry:Fe,type:"Polygon"===De||"MultiPolygon"===De?3:"LineString"===De||"MultiLineString"===De?2:1,tags:Mt};null!==Z.id&&(xt.id=Z.id),fe.features.push(xt)}}function qa(fe,Z,Y,ue,ye,De){var Fe=ue*ue;if(ue>0&&Z.size<(ye?Fe:ue))Y.numPoints+=Z.length/3;else{for(var Ne=[],Ce=0;Ce<Z.length;Ce+=3)(0===ue||Z[Ce+2]>Fe)&&(Y.numSimplified++,Ne.push(Z[Ce]),Ne.push(Z[Ce+1])),Y.numPoints++;ye&&function(We,Mt){for(var Ot=0,xt=0,Rn=We.length,Hn=Rn-2;xt<Rn;Hn=xt,xt+=2)Ot+=(We[xt]-We[Hn])*(We[xt+1]+We[Hn+1]);if(Ot>0===Mt)for(xt=0,Rn=We.length;xt<Rn/2;xt+=2){var Fn=We[xt],Dn=We[xt+1];We[xt]=We[Rn-2-xt],We[xt+1]=We[Rn-1-xt],We[Rn-2-xt]=Fn,We[Rn-1-xt]=Dn}}(Ne,De),fe.push(Ne)}}function eo(fe,Z){var Y=(Z=this.options=function(ye,De){for(var Fe in De)ye[Fe]=De[Fe];return ye}(Object.create(this.options),Z)).debug;if(Y&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye,De,Fe,Ne,Ce,We,ue=function(ye,De){var Fe=[];if("FeatureCollection"===ye.type)for(var Ne=0;Ne<ye.features.length;Ne++)Nn(Fe,ye.features[Ne],De,Ne);else Nn(Fe,"Feature"===ye.type?ye:{geometry:ye},De);return Fe}(fe,Z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=ye=ue,Ce=Jr(ye,1,-1-(Fe=(De=Z).buffer/De.extent),Fe,0,-1,2,De),We=Jr(ye,1,1-Fe,2+Fe,0,-1,2,De),(Ce||We)&&(Ne=Jr(ye,1,-Fe,1+Fe,0,-1,2,De)||[],Ce&&(Ne=Qr(Ce,1).concat(Ne)),We&&(Ne=Ne.concat(Qr(We,-1)))),(ue=Ne).length&&this.splitTile(ue,0,0,0),Y&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ds(fe,Z,Y){return 32*((1<<fe)*Y+Z)+fe}function ma(fe,Z){const Y=fe.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ue=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ue)return Z(null,null);const ye=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(Ne){this._feature=Ne,this.extent=u.EXTENT,this.type=Ne.type,this.properties=Ne.tags,"id"in Ne&&!isNaN(Ne.id)&&(this.id=parseInt(Ne.id,10))}loadGeometry(){if(1===this._feature.type){const Ne=[];for(const Ce of this._feature.geometry)Ne.push([new u.Point(Ce[0],Ce[1])]);return Ne}{const Ne=[];for(const Ce of this._feature.geometry){const We=[];for(const Mt of Ce)We.push(new u.Point(Mt[0],Mt[1]));Ne.push(We)}return Ne}}toGeoJSON(Ne,Ce,We){return Ft.call(this,Ne,Ce,We)}}(this._features[Fe])}}(ue.features);let De=jr(ye);0===De.byteOffset&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),Z(null,{vectorTile:ye,rawData:De.buffer})}eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eo.prototype.splitTile=function(fe,Z,Y,ue,ye,De,Fe){for(var Ne=[fe,Z,Y,ue],Ce=this.options,We=Ce.debug;Ne.length;){ue=Ne.pop(),Y=Ne.pop(),Z=Ne.pop(),fe=Ne.pop();var Mt=1<<Z,Ot=ds(Z,Y,ue),xt=this.tiles[Ot];if(!xt&&(We>1&&console.time("creation"),xt=this.tiles[Ot]=Ga(fe,Z,Y,ue,Ce),this.tileCoords.push({z:Z,x:Y,y:ue}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Y,ue,xt.numFeatures,xt.numPoints,xt.numSimplified),console.timeEnd("creation"));var Rn="z"+Z;this.stats[Rn]=(this.stats[Rn]||0)+1,this.total++}if(xt.source=fe,ye){if(Z===Ce.maxZoom||Z===ye)continue;var Hn=1<<ye-Z;if(Y!==Math.floor(De/Hn)||ue!==Math.floor(Fe/Hn))continue}else if(Z===Ce.indexMaxZoom||xt.numPoints<=Ce.indexMaxPoints)continue;if(xt.source=null,0!==fe.length){We>1&&console.time("clipping");var Fn,Dn,Nt,Ni,lr,wi,vr=.5*Ce.buffer/Ce.extent,zo=.5-vr,Ir=.5+vr,wr=1+vr;Fn=Dn=Nt=Ni=null,lr=Jr(fe,Mt,Y-vr,Y+Ir,0,xt.minX,xt.maxX,Ce),wi=Jr(fe,Mt,Y+zo,Y+wr,0,xt.minX,xt.maxX,Ce),fe=null,lr&&(Fn=Jr(lr,Mt,ue-vr,ue+Ir,1,xt.minY,xt.maxY,Ce),Dn=Jr(lr,Mt,ue+zo,ue+wr,1,xt.minY,xt.maxY,Ce),lr=null),wi&&(Nt=Jr(wi,Mt,ue-vr,ue+Ir,1,xt.minY,xt.maxY,Ce),Ni=Jr(wi,Mt,ue+zo,ue+wr,1,xt.minY,xt.maxY,Ce),wi=null),We>1&&console.timeEnd("clipping"),Ne.push(Fn||[],Z+1,2*Y,2*ue),Ne.push(Dn||[],Z+1,2*Y,2*ue+1),Ne.push(Nt||[],Z+1,2*Y+1,2*ue),Ne.push(Ni||[],Z+1,2*Y+1,2*ue+1)}}},eo.prototype.getTile=function(fe,Z,Y){var ue=this.options,ye=ue.extent,De=ue.debug;if(fe<0||fe>24)return null;var Fe=1<<fe,Ne=ds(fe,Z=(Z%Fe+Fe)%Fe,Y);if(this.tiles[Ne])return fa(this.tiles[Ne],ye);De>1&&console.log("drilling down to z%d-%d-%d",fe,Z,Y);for(var Ce,We=fe,Mt=Z,Ot=Y;!Ce&&We>0;)We--,Mt=Math.floor(Mt/2),Ot=Math.floor(Ot/2),Ce=this.tiles[ds(We,Mt,Ot)];return Ce&&Ce.source?(De>1&&console.log("found parent tile z%d-%d-%d",We,Mt,Ot),De>1&&console.time("drilling down"),this.splitTile(Ce.source,We,Mt,Ot,fe,Z,Y),De>1&&console.timeEnd("drilling down"),this.tiles[Ne]?fa(this.tiles[Ne],ye):null):null};class Za extends u.VectorTileWorkerSource{constructor(Z,Y,ue,ye,De){super(Z,Y,ue,ye,ma),De&&(this.loadGeoJSON=De)}loadData(Z,Y){const ue=Z&&Z.request,ye=ue&&ue.collectResourceTiming;this.loadGeoJSON(Z,(De,Fe)=>{if(De||!Fe)return Y(De);if("object"!=typeof Fe)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Zt(Fe,!0);try{if(Z.filter){const Ce=u.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ce.result)throw new Error(Ce.value.map(Mt=>`${Mt.key}: ${Mt.message}`).join(", "));Fe={type:"FeatureCollection",features:Fe.features.filter(Mt=>Ce.value.evaluate({zoom:0},Mt))}}this._geoJSONIndex=Z.cluster?new ni(function({superclusterOptions:Ce,clusterProperties:We}){if(!We||!Ce)return Ce;const Mt={},Ot={},xt={accumulated:null,zoom:0},Rn={properties:null},Hn=Object.keys(We);for(const Fn of Hn){const[Dn,Nt]=We[Fn],Ni=u.createExpression(Nt),lr=u.createExpression("string"==typeof Dn?[Dn,["accumulated"],["get",Fn]]:Dn);Mt[Fn]=Ni.value,Ot[Fn]=lr.value}return Ce.map=Fn=>{Rn.properties=Fn;const Dn={};for(const Nt of Hn)Dn[Nt]=Mt[Nt].evaluate(xt,Rn);return Dn},Ce.reduce=(Fn,Dn)=>{Rn.properties=Dn;for(const Nt of Hn)xt.accumulated=Fn[Nt],Fn[Nt]=Ot[Nt].evaluate(xt,Rn)},Ce}(Z)).load(Fe.features):new eo(Ce=Fe,Z.geojsonVtOptions)}catch(Ce){return Y(Ce)}this.loaded={};const Ne={};if(ye){const Ce=u.getPerformanceMeasurement(ue);Ce&&(Ne.resourceTiming={},Ne.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ce)))}Y(null,Ne)}var Ce})}reloadTile(Z,Y){const ue=this.loaded;return ue&&ue[Z.uid]?super.reloadTile(Z,Y):this.loadTile(Z,Y)}loadGeoJSON(Z,Y){if(Z.request)u.getJSON(Z.request,Y);else{if("string"!=typeof Z.data)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(Z.data))}catch{return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ue){Y(ue)}}getClusterChildren(Z,Y){try{Y(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ue){Y(ue)}}getClusterLeaves(Z,Y){try{Y(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ue){Y(ue)}}}class ga{constructor(Z){this.self=Z,this.actor=new u.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Za},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,ue)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ue},this.self.registerRTLTextPlugin=Y=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=Y.applyArabicShaping,u.plugin.processBidirectionalText=Y.processBidirectionalText,u.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(Z,Y,ue){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],ue()}checkIfReady(Z,Y,ue){ue()}setReferrer(Z,Y){this.referrer=Y}spriteLoaded(Z,Y){this.isSpriteLoaded[Z]=Y;for(const ue in this.workerSources[Z]){const ye=this.workerSources[Z][ue];for(const De in ye)ye[De]instanceof u.VectorTileWorkerSource&&(ye[De].isSpriteLoaded=Y,ye[De].fire(new u.Event("isSpriteLoaded")))}}setImages(Z,Y,ue){this.availableImages[Z]=Y;for(const ye in this.workerSources[Z]){const De=this.workerSources[Z][ye];for(const Fe in De)De[Fe].availableImages=Y}ue()}enableTerrain(Z,Y,ue){this.terrain=Y,ue()}setProjection(Z,Y){this.projections[Z]=u.getProjection(Y)}setLayers(Z,Y,ue){this.getLayerIndex(Z).replace(Y),ue()}updateLayers(Z,Y,ue){this.getLayerIndex(Z).update(Y.layers,Y.removedIds),ue()}loadTile(Z,Y,ue){const ye=this.enableTerrain?u.extend({enableTerrain:this.terrain},Y):Y;ye.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Y.type,Y.source).loadTile(ye,ue)}loadDEMTile(Z,Y,ue){const ye=this.enableTerrain?u.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(Z,Y.source).loadTile(ye,ue)}reloadTile(Z,Y,ue){const ye=this.enableTerrain?u.extend({enableTerrain:this.terrain},Y):Y;ye.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Y.type,Y.source).reloadTile(ye,ue)}abortTile(Z,Y,ue){this.getWorkerSource(Z,Y.type,Y.source).abortTile(Y,ue)}removeTile(Z,Y,ue){this.getWorkerSource(Z,Y.type,Y.source).removeTile(Y,ue)}removeSource(Z,Y,ue){if(!this.workerSources[Z]||!this.workerSources[Z][Y.type]||!this.workerSources[Z][Y.type][Y.source])return;const ye=this.workerSources[Z][Y.type][Y.source];delete this.workerSources[Z][Y.type][Y.source],void 0!==ye.removeSource?ye.removeSource(Y,ue):ue()}loadWorkerSource(Z,Y,ue){try{this.self.importScripts(Y.url),ue()}catch(ye){ue(ye.toString())}}syncRTLPluginState(Z,Y,ue){try{u.plugin.setState(Y);const ye=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=ye){this.self.importScripts(ye);const De=u.plugin.isParsed();ue(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),De)}}catch(ye){ue(ye.toString())}}getAvailableImages(Z){let Y=this.availableImages[Z];return Y||(Y=[]),Y}getLayerIndex(Z){let Y=this.layerIndexes[Z];return Y||(Y=this.layerIndexes[Z]=new Pe),Y}getWorkerSource(Z,Y,ue){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Y]||(this.workerSources[Z][Y]={}),this.workerSources[Z][Y][ue]||(this.workerSources[Z][Y][ue]=new this.workerSourceTypes[Y]({send:(De,Fe,Ne,Ce,We,Mt)=>{this.actor.send(De,Fe,Ne,Z,We,Mt)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][Y][ue]}getDEMWorkerSource(Z,Y){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Y]||(this.demWorkerSources[Z][Y]=new Se),this.demWorkerSources[Z][Y]}enforceCacheSizeLimit(Z,Y){u.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(Z,Y,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ga(self)),ga}),ze(0,function(u){function Q(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let d=0;d<m.length;d++)if(!Q(m[d],a[d]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==a){if("object"!=typeof a||Object.keys(m).length!==Object.keys(a).length)return!1;for(const d in m)if(!Q(m[d],a[d]))return!1;return!0}return m===a}var Me=Pe;function Pe(m){return a=m,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,E=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(E);try{b=new Worker(I),_=!0}catch{_=!1}return b&&b.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===_.width}()||(void 0===Se[d=a&&a.failIfMajorPerformanceCaveat]&&(Se[d]=function(_){var b,I,A,R,E=(I=_,A=document.createElement("canvas"),(R=Object.create(Pe.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,A.getContext("webgl",R)||A.getContext("experimental-webgl",R));if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),!0===E.getShaderParameter(b,E.COMPILE_STATUS))}(d)),!Se[d]||document.documentMode));var a,d}var Se={};function Ae(m,a,d){const _=u.window.document.createElement(m);return void 0!==a&&(_.className=a),d&&d.appendChild(_),_}function pt(m,a,d){const _=u.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(a))_.setAttributeNS(null,b,a[b]);return d&&d.appendChild(_),_}Pe.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Zt=u.window.document&&u.window.document.documentElement.style,Ft=Zt&&void 0!==Zt.userSelect?"userSelect":"WebkitUserSelect";let Ct;function Lt(){Zt&&Ft&&(Ct=Zt[Ft],Zt[Ft]="none")}function At(){Zt&&Ft&&(Zt[Ft]=Ct)}function he(m){m.preventDefault(),m.stopPropagation(),u.window.removeEventListener("click",he,!0)}function Ye(){u.window.addEventListener("click",he,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",he,!0)},0)}function _t(m,a){const d=m.getBoundingClientRect();return it(m,d,a)}function Ue(m,a){const d=m.getBoundingClientRect(),_=[];for(let b=0;b<a.length;b++)_.push(it(m,d,a[b]));return _}function Re(m){return void 0!==u.window.InstallTrigger&&2===m.button&&m.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function it(m,a,d){const _=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new u.Point((d.clientX-a.left)*_,(d.clientY-a.top)*_)}function Oe(m,a){var d=a[0],_=a[1],b=a[2],E=a[3],I=d*E-b*_;return I?(m[0]=E*(I=1/I),m[1]=-_*I,m[2]=-b*I,m[3]=d*I,m):null}function Pt(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class Gt extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,d){this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,d){if(!a)return!0;let _=0;for(const b of a){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(a,d){return!(a&&(4!==a.length||a[0]<0||d.data.width<a[0]||a[1]<0||d.data.height<a[1]||a[2]<0||d.data.width<a[2]||a[3]<0||d.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,d){d.version=this.images[a].version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,d){let _=!0;if(!this.isLoaded())for(const b of a)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(a,d):this.requestors.push({ids:a,callback:d})}_notify(a,d){const _={};for(const b of a){this.images[b]||this.fire(new u.Event("styleimagemissing",{id:b}));const E=this.images[b];E?_[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!(!E.userImage||!E.userImage.render)}:u.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],_=this.getImage(a);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},E=new u.ImagePosition(b,_);this.patterns[a]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(a,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const E in this.patterns)a.push(this.patterns[E].bin);const{w:d,h:_}=u.potpack(a),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(const E in this.patterns){const{bin:I}=this.patterns[E],A=I.x+1,R=I.y+1,B=this.images[E].data,z=B.width,H=B.height;u.RGBAImage.copy(B,b,{x:0,y:0},{x:A,y:R},{width:z,height:H}),u.RGBAImage.copy(B,b,{x:0,y:H-1},{x:A,y:R-1},{width:z,height:1}),u.RGBAImage.copy(B,b,{x:0,y:0},{x:A,y:R+H},{width:z,height:1}),u.RGBAImage.copy(B,b,{x:z-1,y:0},{x:A-1,y:R},{width:1,height:H}),u.RGBAImage.copy(B,b,{x:0,y:0},{x:A+z,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];Pt(_)&&this.updateImage(d,_)}}}const It=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(m,a){return function([d,_,b]){const E=u.degToRad(_+90),I=u.degToRad(b);return{x:d*Math.cos(E)*Math.sin(I),y:d*Math.sin(E)*Math.sin(I),z:d*Math.cos(I),azimuthal:_,polar:b}}(m.expression.evaluate(a))}interpolate(m,a,d){return{x:u.number(m.x,a.x,d),y:u.number(m.y,a.y,d),z:u.number(m.z,a.z,d),azimuthal:u.number(m.azimuthal,a.azimuthal,d),polar:u.number(m.polar,a.polar,d)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)});class En extends u.Evented{constructor(a){super(),this._transitionable=new u.Transitionable(It),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,d={}){if(!this._validate(u.validateLight,a,d))for(const _ in a){const b=a[_];u.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||!1!==_.validate)&&u.emitValidationErrors(this,a.call(u.validateStyle,u.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const Ii=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)});let Ui=class extends u.Evented{constructor(m,a){super(),this._transitionable=new u.Transitionable(Ii),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(m){for(const a in m){const d=m[a];u.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),d):this._transitionable.setValue(a,d)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function jr(m,a,d,_){const b=u.smoothstep(45,65,d),[E,I]=yr(m,_),A=u.length(a);let R=1-Math.min(1,Math.exp((A-E)/(I-E)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*b*m.alpha}function yr(m,a){const d=.5/Math.tan(.5*a);return[m.range[0]+d,m.range[1]+d]}const Cn=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])});class bn extends u.Evented{constructor(a,d){super(),this._transitionable=new u.Transitionable(Cn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const a=this._transform,d="globe"===a.projection.name,_=u.globeToMercatorTransition(a.zoom),b=this.properties.get("range"),E=[.5,3];return{range:d?[u.number(E[0],b[0],_),u.number(E[1],b[1],_)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,d={}){if(!this._validate(u.validateFog,a,d)){for(const _ of Object.keys(u.spec.fog))a&&void 0===a[_]&&(a[_]=u.spec.fog[_].default);for(const _ in a){const b=a[_];u.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,a))*d.a}getOpacityAtLatLng(a,d){return this._transform.projection.supportsFog?function(_,b,E){const I=u.MercatorCoordinate.fromLngLat(b),A=E.elevation?E.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,A];return u.transformMat4(R,R,E.mercatorFogMatrix),jr(_,R,E.pitch,E._fov)}(this.state,a,d):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?yr(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||!1!==_.validate)&&u.emitValidationErrors(this,a.call(u.validateStyle,u.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class Ji{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const E=new Ji.Actor(_[b],d,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,d,_){u.asyncAll(this.actors,(b,E)=>{b.send(a,d,E)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function un(m,a,d){return a*(u.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}Ji.Actor=u.Actor;class Mn{constructor(a,d,_,b){this.screenBounds=a,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(a,d){let _,b;if(a instanceof u.Point||"number"==typeof a[0]){const E=u.Point.convert(a);_=[E],b=d.isPointAboveHorizon(E)}else{const E=u.Point.convert(a[0]),I=u.Point.convert(a[1]);_=[E,I],b=u.polygonizeBounds(E,I).every(A=>d.isPointAboveHorizon(A))}return new Mn(_,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],b=u.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),u.bufferConvexPolygon(b,a)}bufferedCameraGeometryGlobe(a){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],b=u.polygonizeBounds(d,_,a),E=this.cameraPoint.clone();switch(3*((E.y>d.y)+(E.y>_.y))+((E.x>d.x)+(E.x>_.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(a,d,_,b=0){const E=a.queryPadding/d._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(E,d):this._bufferedScreenMercator(E,d);let A=a.tileID.wrap+(I.unwrapped?b:0);const R=I.polygon.map(re=>u.getTilePoint(a.tileTransform,re,A));if(!u.polygonIntersectsBox(R,0,0,u.EXTENT,u.EXTENT))return;A=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const B=this.screenGeometryMercator.polygon.map(re=>u.getTileVec3(a.tileTransform,re,A)),z=B.map(re=>new u.Point(re[0],re[1])),H=d.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),K=u.getTileVec3(a.tileTransform,H,A),te=B.map(re=>{const G=u.sub(re,re,K);return u.normalize(G,G),new u.Ray(K,G)}),ie=un(a,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:te,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ne=u.getBounds(R),ne.min.x=u.clamp(ne.min.x,0,u.EXTENT),ne.min.y=u.clamp(ne.min.y,0,u.EXTENT),ne.max.x=u.clamp(ne.max.x,0,u.EXTENT),ne.max.y=u.clamp(ne.max.y,0,u.EXTENT),ne),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:ie};var ne}_bufferedScreenMercator(a,d){const _=Ai(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),d):{polygon:this.bufferedScreenGeometry(a).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(a,d){const _=Ai(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),d):{polygon:this.bufferedCameraGeometry(a).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[_]=b,b}}_projectAndResample(a,d){const _=function(E,I){const A=u.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-u.GLOBE_RADIUS,0,1],B=[0,u.GLOBE_RADIUS,0,1],z=[0,0,0,1];u.transformMat4$1(R,R,A),u.transformMat4$1(B,B,A),u.transformMat4$1(z,z,A);const H=new u.Point(R[0]/R[3],R[1]/R[3]),K=new u.Point(B[0]/B[3],B[1]/B[3]),te=u.polygonContainsPoint(E,H)&&R[3]<z[3],ie=u.polygonContainsPoint(E,K)&&B[3]<z[3];if(!te&&!ie)return null;const ne=function(we,ke,Ie){for(let Ge=1;Ge<we.length;Ge++){const vt=ji(ke.pointCoordinate3D(we[Ge-1]).x),Be=ji(ke.pointCoordinate3D(we[Ge]).x);if(Ie<0){if(vt<Be)return{idx:Ge,t:-vt/(Be-1-vt)}}else if(Be<vt)return{idx:Ge,t:(1-vt)/(Be+1-vt)}}return null}(E,I,te?-1:1);if(!ne)return null;const{idx:re,t:G}=ne;let ee=re>1?ni(E.slice(0,re),I):[],le=re<E.length?ni(E.slice(re),I):[];ee=ee.map(we=>new u.Point(ji(we.x),we.y)),le=le.map(we=>new u.Point(ji(we.x),we.y));const ce=[...ee];0===ce.length&&ce.push(le[le.length-1]);const be=u.number(ce[ce.length-1].y,(0===le.length?ee[0]:le[0]).y,G);let Ee;return Ee=te?[new u.Point(0,be),new u.Point(0,0),new u.Point(1,0),new u.Point(1,be)]:[new u.Point(1,be),new u.Point(1,1),new u.Point(0,1),new u.Point(0,be)],ce.push(...Ee),0===le.length?ce.push(ee[0]):ce.push(...le),{polygon:ce.map(we=>new u.MercatorCoordinate(we.x,we.y)),unwrapped:!1}}(a,d);if(_)return _;const b=function(E,I){let A=!1,R=-1/0,B=0;for(let H=0;H<E.length-1;H++)E[H].x>R&&(R=E[H].x,B=H);for(let H=0;H<E.length-1;H++){const K=(B+H)%(E.length-1),te=E[K],ie=E[K+1];Math.abs(te.x-ie.x)>.5&&(te.x<ie.x?(te.x+=1,0===K&&(E[E.length-1].x+=1)):(ie.x+=1,K+1===E.length-1&&(E[0].x+=1)),A=!0)}const z=u.mercatorXfromLng(I.center.lng);return A&&z<Math.abs(z-1)&&E.forEach(H=>{H.x-=1}),{polygon:E,unwrapped:A}}(ni(a,d).map(E=>new u.Point(ji(E.x),E.y)),d);return{polygon:b.polygon.map(E=>new u.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function ni(m,a){return u.resample(m,d=>{const _=a.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function ji(m){return m<0?1+m%1:m%1}function Ai(m){return 100*m|0}function ri(m,a,d,_,b){const E=function(I,A){if(I)return b(I);if(A){m.url&&A.tiles&&m.tiles&&delete m.tiles;const R=u.pick(u.extend(A,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(R.vectorLayers=A.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=a.canonicalizeTileset(R,m.url),b(null,R)}};return m.url?u.getJSON(a.transformRequest(a.normalizeSourceURL(m.url,null,d,_),u.ResourceType.Source),E):u.exported.frame(()=>E(null,m))}class Tn{constructor(a,d,_){this.bounds=u.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),_=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*d),I=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*d);return a.x>=_&&a.x<E&&a.y>=b&&a.y<I}}class $r{constructor(a,d,_){this.context=a;const b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const li={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ui{constructor(a,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=a;const E=a.gl;this.buffer=E.createBuffer(),a.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let _=0;_<this.attributes.length;_++){const b=d.attributes[this.attributes[_].name];void 0!==b&&a.enableVertexAttribArray(b)}}setVertexAttribPointers(a,d,_){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],I=d.attributes[E.name];void 0!==I&&a.vertexAttribPointer(I,E.components,a[li[E.type]],!1,this.itemSize,E.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jo extends sn{getDefault(){return u.Color.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Nn extends sn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ps extends sn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Zi extends sn{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ho extends sn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class ec extends sn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Qo extends sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Jr extends sn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class zc extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class xl extends sn{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class bl extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class da extends sn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ha extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class tc extends sn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Bc extends sn{getDefault(){return u.Color.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Qr extends sn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Rs extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class fa extends sn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class pa extends sn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Ga,wl=class extends sn{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class qa extends sn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class eo extends sn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ds extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class ma extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Za extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ga extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class fe extends sn{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Z extends sn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Y extends sn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ue extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ye extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class De extends sn{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class Fe extends De{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ne extends De{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ce extends Ne{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class We{constructor(a,d,_,b){this.context=a,this.width=d,this.height=_;const E=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Fe(a,E),b&&(this.depthAttachment=new Ne(a,E))}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class Mt{constructor(a,d=!1){if(this.gl=a,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const _=a;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(a),deleteVertexArrayOES:_.deleteVertexArray.bind(a),bindVertexArrayOES:_.bindVertexArray.bind(a)}}this.clearColor=new Jo(this),this.clearDepth=new Nn(this),this.clearStencil=new Ps(this),this.colorMask=new Zi(this),this.depthMask=new ho(this),this.stencilMask=new ec(this),this.stencilFunc=new Qo(this),this.stencilOp=new Jr(this),this.stencilTest=new zc(this),this.depthRange=new xl(this),this.depthTest=new bl(this),this.depthFunc=new da(this),this.blend=new Ha(this),this.blendFunc=new tc(this),this.blendColor=new Bc(this),this.blendEquation=new Qr(this),this.cullFace=new Rs(this),this.cullFaceSide=new fa(this),this.frontFace=new pa(this),this.program=new wl(this),this.activeTexture=new qa(this),this.viewport=new eo(this),this.bindFramebuffer=new ds(this),this.bindRenderbuffer=new ma(this),this.bindTexture=new Za(this),this.bindVertexBuffer=new ga(this),this.bindElementBuffer=new fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Z(this),this.pixelStoreUnpack=new Y(this),this.pixelStoreUnpackPremultiplyAlpha=new ue(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new $r(this,a,d)}createVertexBuffer(a,d,_){return new ui(this,a,d,_)}createRenderbuffer(a,d,_){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,a,d,_),this.bindRenderbuffer.set(null),E}createFramebuffer(a,d,_){return new We(this,a,d,_)}clear({color:a,depth:d,stencil:_}){const b=this.gl;let E=0;a&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(E)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){Q(a.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ot extends u.Evented{constructor(a,d,_,b){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(d,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(a){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=ri(this._options,this.map._requestManager,d,_,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new u.ErrorEvent(b))):E&&(u.extend(this,E),E.bounds&&(this.tileBounds=new Tn(E.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(b)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(a,d){const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(_,u.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,a.actor&&"expired"!==a.state)"loading"===a.state?a.reloadCallback=d:a.request=a.actor.send("reloadTile",b,E.bind(this));else if(a.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const I=u.loadVectorTile.call({deduped:this._deduped},b,(A,R)=>{A||!R?E.call(this,A):(b.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},a.actor&&a.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);a.request={cancel:I}}function E(I,A){return delete a.request,a.aborted?d(null):I&&404!==I.status?d(I):(A&&A.resourceTiming&&(a.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&a.setExpiryData(A),a.loadVectorData(A,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xt extends u.Evented{constructor(a,d,_,b){super(),this.id=a,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},d),u.extend(this,u.pick(d,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ri(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new u.ErrorEvent(d)):_&&(u.extend(this,_),_.bounds&&(this.tileBounds=new Tn(_.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(_.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(d)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,d){const _=u.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=u.getImage(this.map._requestManager.transformRequest(b,u.ResourceType.Tile),(E,I,A,R)=>(delete a.request,a.aborted?(a.state="unloaded",d(null)):E?(a.state="errored",d(E)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:A,expires:R}),a.setTexture(I,this.map.painter),a.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(a,d,_){a.setTexture(d,_)}static unloadTileData(a,d){a.texture&&d.saveTileTexture(a.texture)}abortTile(a,d){a.request&&(a.request.cancel(),delete a.request),d()}unloadTile(a,d){a.texture&&this.map.painter.saveTileTexture(a.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Rn(m,a,d,_,b,E,I,A){const R=[m,d,b,a,_,E,1,1,1],B=[I,A,1],z=u.adjoint([],R),[H,K,te]=u.transformMat3(B,B,u.transpose(z,z));return u.multiply$1(R,[H,0,0,0,K,0,0,0,te],R)}class Hn extends u.Evented{constructor(a,d,_,b){super(),this.id=a,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d,this._dirty=!1}load(a,d){this._loaded=d||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(_,b)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new u.ErrorEvent(_));else if(b){const{HTMLImageElement:E}=u.window;this.image=b instanceof E?u.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const d=a.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,E=1/0,I=-1/0,A=-1/0;for(const H of _)b=Math.min(b,H.x),E=Math.min(E,H.y),I=Math.max(I,H.x),A=Math.max(A,H.y);const R=Math.max(I-b,A-E),B=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,B);return new u.CanonicalTileID(B,Math.floor((b+I)/2*z),Math.floor((E+A)/2*z))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const R in this.tiles){const B=this.tiles[R];"loaded"!==B.state&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const d=u.tileTransform(this.tileID,this.map.transform.projection),[_,b,E,I]=this.coordinates.map(R=>{const B=d.projection.project(R[0],R[1]);return u.getTilePoint(d,B)._round()});this.perspectiveTransform=function(R,B,z,H,K,te,ie,ne,re,G){const ee=Rn(0,0,R,0,0,B,R,B),le=Rn(z,H,K,te,ie,ne,re,G);return u.multiply$1(le,u.adjoint(ee,ee),le),[le[6]/le[8]*R/u.EXTENT,le[7]/le[8]*B/u.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,I.x,I.y,E.x,E.y);const A=this._boundsArray=new u.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(b.x,b.y,u.EXTENT,0),A.emplaceBack(I.x,I.y,0,u.EXTENT),A.emplaceBack(E.x,E.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(A,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,d=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,d){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},d(null)):(a.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Fn={vector:Ot,raster:xt,"raster-dem":class extends xt{constructor(m,a,d,_){super(m,a,d,_),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,E){b&&(m.state="errored",a(b)),E&&(m.dem=E,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=u.getImage(this.map._requestManager.transformRequest(d,u.ResourceType.Tile),function(b,E,I,A){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(b)m.state="errored",a(b);else if(E){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:I,expires:A});const R=u.window.ImageBitmap&&E instanceof u.window.ImageBitmap&&(null==Ga&&(Ga=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),Ga),B=1-(E.width-u.prevPowerOfTwo(E.width))/2;B<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=R?E:u.exported.getImageData(E,B),H={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:B};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",H,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const a=m.canonical,d=Math.pow(2,a.z),_=(a.x-1+d)%d,b=0===a.x?m.wrap-1:m.wrap,E=(a.x+1+d)%d,I=a.x+1===d?m.wrap+1:m.wrap,A={};return A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y).key]={backfilled:!1},a.y>0&&(A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y-1).key]={backfilled:!1}),a.y+1<d&&(A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y+1).key]={backfilled:!1}),A}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends u.Evented{constructor(m,a,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=a.data,this._options=u.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const b=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*b,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*b,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*b,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},a),this}getClusterLeaves(m,a,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:a,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=u.extend({},this.workerOptions),a=this._data;"string"==typeof a?(m.request=this.map._requestManager.transformRequest(u.exported.resolveURL(a),u.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new u.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new u.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,a){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?a(null):_?a(_):(m.loadVectorData(b,this.map.painter,"reloadTile"===d),a(null))),void 0,"loadTile"===d)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Hn{constructor(m,a,d,_){super(m,a,d,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,u.ResourceType.Source).url);u.getVideo(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new u.ErrorEvent(a)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(m,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Hn,canvas:class extends Hn{constructor(m,a,d,_){super(m,a,d,_),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends u.Evented{constructor(m,a,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Tn(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:a,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:d,y:_,z:b}=m.tileID.canonical,E=new u.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:b},{signal:E.signal})).then(function(I){return delete m.request,m.aborted?(m.state="unloaded",a(null)):void 0===I?(m.state="errored",a(null)):null===I?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):(A=I)instanceof u.window.ImageData||A instanceof u.window.HTMLCanvasElement||A instanceof u.window.ImageBitmap||A instanceof u.window.HTMLImageElement?(this.loadTileData(m,I),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(I=>{20!==I.code&&(m.state="errored",a(I))}),m.request.cancel=()=>E.abort()}loadTileData(m,a){xt.loadTileData(m,a,this._map.painter)}unloadTileData(m){xt.unloadTileData(m,this._map.painter)}unloadTile(m,a){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:d,y:_,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:b})}a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Dn=function(m,a,d,_){const b=new Fn[a.type](m,a,d,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Nt(m,a){const d=u.identity([]);return u.scale(d,d,[.5*m.width,.5*-m.height,1]),u.translate(d,d,[1,-1,0]),u.multiply(d,d,m.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(d)}function Ni(m,a,d,_,b,E,I,A=!1){const R=m.tilesIn(_,I,A);R.sort(wi);const B=[];for(const H of R)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(a,d,m._state,H,b,E,Nt(m.transform,H.tile.tileID),A)});const z=function(H){const K={},te={};for(const ie of H){const ne=ie.queryResults,re=ie.wrappedTileID,G=te[re]=te[re]||{};for(const ee in ne){const le=ne[ee],ce=G[ee]=G[ee]||{},be=K[ee]=K[ee]||[];for(const Ee of le)ce[Ee.featureIndex]||(ce[Ee.featureIndex]=!0,be.push(Ee))}}return K}(B);for(const H in z)z[H].forEach(K=>{const te=K.feature,ie=te.layer;ie&&"background"!==ie.type&&"sky"!==ie.type&&(te.source=ie.source,ie["source-layer"]&&(te.sourceLayer=ie["source-layer"]),te.state=void 0!==te.id?m.getFeatureState(ie["source-layer"],te.id):{})});return z}function lr(m,a){const d=m.getRenderableIds().map(E=>m.getTileByID(E)),_=[],b={};for(let E=0;E<d.length;E++){const I=d[E],A=I.tileID.canonical.key;b[A]||(b[A]=!0,I.querySourceFeatures(_,a))}return _}function wi(m,a){const d=m.tileID,_=a.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function vr(){return null!=zu.workerClass?new zu.workerClass:new u.window.Worker(zu.workerUrl)}const zo="mapboxgl_preloaded_worker_pool";class Ir{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Ir.workerCount;)this.workers.push(new vr);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zo]}numActive(){return Object.keys(this.active).length}}let wr;function _a(){return wr||(wr=new Ir),wr}function Pd(m,a){const d={};for(const _ in m)"ref"!==_&&(d[_]=m[_]);return u.refProperties.forEach(_=>{_ in a&&(d[_]=a[_])}),d}function Ch(m){m=m.slice();const a=Object.create(null);for(let d=0;d<m.length;d++)a[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=Pd(m[d],a[m[d].ref]));return m}Ir.workerCount=2;const Xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Du(m,a,d){d.push({command:Xn.addSource,args:[m,a[m]]})}function fr(m,a,d){a.push({command:Xn.removeSource,args:[m]}),d[m]=!0}function ya(m,a,d,_){fr(m,d,_),Du(m,a,d)}function to(m,a,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&"data"!==_&&!Q(m[d][_],a[d][_]))return!1;for(_ in a[d])if(a[d].hasOwnProperty(_)&&"data"!==_&&!Q(m[d][_],a[d][_]))return!1;return!0}function Ls(m,a,d,_,b,E){let I;for(I in a=a||{},m=m||{})m.hasOwnProperty(I)&&(Q(m[I],a[I])||d.push({command:E,args:[_,I,a[I],b]}));for(I in a)a.hasOwnProperty(I)&&!m.hasOwnProperty(I)&&(Q(m[I],a[I])||d.push({command:E,args:[_,I,a[I],b]}))}function ks(m){return m.id}function Mu(m,a){return m[a.id]=a,m}class nc{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=u.clamp(a,0,1);let d=1,_=this._distances[d];const b=a*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];const E=d-1,I=this._distances[E],A=_-I,R=A>0?(b-I)/A:0;return this.points[E].mult(1-R).add(this.points[d].mult(R))}}class va{constructor(a,d,_){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(d/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,_,b,E){this._forEachCell(d,_,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(a,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(a,d,_,b,E,I){this.boxCells[E].push(I)}_insertCircleCell(a,d,_,b,E,I){this.circleCells[E].push(I)}_query(a,d,_,b,E,I){if(_<0||a>this.width||b<0||d>this.height)return!E&&[];const A=[];if(a<=0&&d<=0&&this.width<=_&&this.height<=b){if(E)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],z=this.circles[3*R+1],H=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:B-H,y1:z-H,x2:B+H,y2:z+H})}return I?A.filter(I):A}return this._forEachCell(a,d,_,b,this._queryCell,A,{hitTest:E,seenUids:{box:{},circle:{}}},I),E?A.length>0:A}_queryCircle(a,d,_,b,E){const I=a-_,A=a+_,R=d-_,B=d+_;if(A<0||I>this.width||B<0||R>this.height)return!b&&[];const z=[];return this._forEachCell(I,R,A,B,this._queryCellCircle,z,{hitTest:b,circle:{x:a,y:d,radius:_},seenUids:{box:{},circle:{}}},E),b?z.length>0:z}query(a,d,_,b,E){return this._query(a,d,_,b,!1,E)}hitTest(a,d,_,b,E){return this._query(a,d,_,b,!0,E)}hitTestCircle(a,d,_,b){return this._queryCircle(a,d,_,!0,b)}_queryCell(a,d,_,b,E,I,A,R){const B=A.seenUids,z=this.boxCells[E];if(null!==z){const K=this.bboxes;for(const te of z)if(!B.box[te]){B.box[te]=!0;const ie=4*te;if(a<=K[ie+2]&&d<=K[ie+3]&&_>=K[ie+0]&&b>=K[ie+1]&&(!R||R(this.boxKeys[te]))){if(A.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[te],x1:K[ie],y1:K[ie+1],x2:K[ie+2],y2:K[ie+3]})}}}const H=this.circleCells[E];if(null!==H){const K=this.circles;for(const te of H)if(!B.circle[te]){B.circle[te]=!0;const ie=3*te;if(this._circleAndRectCollide(K[ie],K[ie+1],K[ie+2],a,d,_,b)&&(!R||R(this.circleKeys[te]))){if(A.hitTest)return I.push(!0),!0;{const ne=K[ie],re=K[ie+1],G=K[ie+2];I.push({key:this.circleKeys[te],x1:ne-G,y1:re-G,x2:ne+G,y2:re+G})}}}}}_queryCellCircle(a,d,_,b,E,I,A,R){const B=A.circle,z=A.seenUids,H=this.boxCells[E];if(null!==H){const te=this.bboxes;for(const ie of H)if(!z.box[ie]){z.box[ie]=!0;const ne=4*ie;if(this._circleAndRectCollide(B.x,B.y,B.radius,te[ne+0],te[ne+1],te[ne+2],te[ne+3])&&(!R||R(this.boxKeys[ie])))return I.push(!0),!0}}const K=this.circleCells[E];if(null!==K){const te=this.circles;for(const ie of K)if(!z.circle[ie]){z.circle[ie]=!0;const ne=3*ie;if(this._circlesCollide(te[ne],te[ne+1],te[ne+2],B.x,B.y,B.radius)&&(!R||R(this.circleKeys[ie])))return I.push(!0),!0}}}_forEachCell(a,d,_,b,E,I,A,R){const B=this._convertToXCellCoord(a),z=this._convertToYCellCoord(d),H=this._convertToXCellCoord(_),K=this._convertToYCellCoord(b);for(let te=B;te<=H;te++)for(let ie=z;ie<=K;ie++)if(E.call(this,a,d,_,b,this.xCellCount*ie+te,I,A,R))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,_,b,E,I){const A=b-a,R=E-d,B=_+I;return B*B>A*A+R*R}_circleAndRectCollide(a,d,_,b,E,I,A){const R=(I-b)/2,B=Math.abs(a-(b+R));if(B>R+_)return!1;const z=(A-E)/2,H=Math.abs(d-(E+z));if(H>z+_)return!1;if(B<=R||H<=z)return!0;const K=B-R,te=H-z;return K*K+te*te<=_*_}}const fo={unknown:0,flipRequired:1,flipNotRequired:2},Os=Math.tan(85*Math.PI/180);function Je(m,a,d,_,b,E,I){const A=u.create();if(d)if("globe"===E.name){const R=u.calculateGlobeLabelMatrix(b,a);u.multiply(A,A,R)}else{const R=Oe([],I);A[0]=R[0],A[1]=R[1],A[4]=R[2],A[5]=R[3],_||u.rotateZ(A,A,b.angle)}else u.multiply(A,b.labelPlaneMatrix,m);return A}function es(m,a,d,_,b,E,I){const A=Je(m,a,d,_,b,E,I);return"globe"===E.name&&d||(A[2]=A[6]=A[10]=A[14]=0),A}function Wi(m,a,d,_,b,E,I){if(d){if("globe"===E.name){const A=Je(m,a,d,_,b,E,I);return u.invert(A,A),u.multiply(A,m,A),A}{const A=u.clone(m),R=u.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],u.multiply(A,A,R),_||u.rotateZ(A,A,-b.angle),A}}return b.glCoordMatrix}function Ln(m,a,d,_){const b=[m,a,d,1];d?u.transformMat4$1(b,b,_):Gn(b,b,_);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function Qi(m,a){return Math.min(.5+m/a*.5,1.5)}function Do(m,a){const d=m[0]/m[3],_=m[1]/m[3];return d>=-a[0]&&d<=a[0]&&_>=-a[1]&&_<=a[1]}function Ns(m,a,d,_,b,E,I,A,R,B){const z=d.transform,H=_?m.textSizeData:m.iconSizeData,K=u.evaluateSizeForZoom(H,d.transform.zoom),te="globe"===z.projection.name,ie=[256/d.width*2+1,256/d.height*2+1],ne=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ne.clear();let re=null;te&&(re=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const G=m.lineVertexArray,ee=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,le=d.transform.width/d.transform.height;let ce,be=!1;for(let Ee=0;Ee<ee.length;Ee++){const we=ee.get(Ee),{numGlyphs:ke,writingMode:Ie}=we;if(Ie!==u.WritingMode.vertical||be||ce===u.WritingMode.horizontal||(be=!0),ce=Ie,(we.hidden||Ie===u.WritingMode.vertical)&&!be){er(ke,ne);continue}be=!1;const Ge=new u.Point(we.tileAnchorX,we.tileAnchorY);let{x:vt,y:Be,z:st}=z.projection.projectTilePoint(Ge.x,Ge.y,B.canonical);if(R){const[Pn,Jt,vn]=R(Ge);vt+=Pn,Be+=Jt,st+=vn}const Xe=[vt,Be,st,1];if(u.transformMat4$1(Xe,Xe,a),!Do(Xe,ie)){er(ke,ne);continue}const gt=Qi(d.transform.cameraToCenterDistance,Xe[3]),He=u.evaluateSizeForFeature(H,K,we),rt=I?He/gt:He*gt,wt=Ln(vt,Be,st,b);if(wt[3]<=0){er(ke,ne);continue}let ut={};const Tt=I?null:R,ln=et(we,rt,!1,A,a,b,E,m.glyphOffsetArray,G,ne,re,wt,Ge,ut,le,Tt,z.projection,B,I);be=ln.useVertical,Tt&&ln.needsFlipping&&(ut={}),(ln.notEnoughRoom||be||ln.needsFlipping&&et(we,rt,!0,A,a,b,E,m.glyphOffsetArray,G,ne,re,wt,Ge,ut,le,Tt,z.projection,B,I).notEnoughRoom)&&er(ke,ne)}_?(m.text.dynamicLayoutVertexBuffer.updateData(ne),re&&m.text.globeExtVertexBuffer.updateData(re)):(m.icon.dynamicLayoutVertexBuffer.updateData(ne),re&&m.icon.globeExtVertexBuffer.updateData(re))}function Wa(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const{lineStartIndex:re,glyphStartIndex:G,segment:ee}=A,le=G+A.numGlyphs,ce=re+A.lineLength,be=a.getoffsetX(G),Ee=a.getoffsetX(le-1),we=dn(m*be,d,_,b,E,I,ee,re,ce,R,B,z,H,K,!0,te,ie,ne);if(!we)return null;const ke=dn(m*Ee,d,_,b,E,I,ee,re,ce,R,B,z,H,K,!0,te,ie,ne);return ke?{first:we,last:ke}:null}function xa(m,a,d,_){return m===u.WritingMode.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:m===u.WritingMode.vertical?_>0?{needsFlipping:!0}:null:a!==fo.unknown&&(0===(b=d)||Math.abs(_/b)>Os)?a===fo.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null;var b}function et(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G,ee){const le=a/24,ce=m.lineOffsetX*le,be=m.lineOffsetY*le,{lineStartIndex:Ee,glyphStartIndex:we,numGlyphs:ke,segment:Ie,writingMode:Ge,flipState:vt}=m,Be=Ee+m.lineLength,st=Xe=>{if(z){const[wt,ut,Tt]=Xe.up,ln=B.length;u.updateGlobeVertexNormal(z,ln+0,wt,ut,Tt),u.updateGlobeVertexNormal(z,ln+1,wt,ut,Tt),u.updateGlobeVertexNormal(z,ln+2,wt,ut,Tt),u.updateGlobeVertexNormal(z,ln+3,wt,ut,Tt)}const[gt,He,rt]=Xe.point;u.addDynamicAttributes(B,gt,He,rt,Xe.angle)};if(ke>1){const Xe=Wa(le,A,ce,be,d,H,K,m,R,E,te,ne,!1,re,G,ee);if(!Xe)return{notEnoughRoom:!0};if(_&&!d){let[gt,He,rt]=Xe.first.point,[wt,ut,Tt]=Xe.last.point;[gt,He]=Ln(gt,He,rt,I),[wt,ut]=Ln(wt,ut,Tt,I);const ln=xa(Ge,vt,(wt-gt)*ie,ut-He);if(m.flipState=ln&&ln.needsFlipping?fo.flipRequired:fo.flipNotRequired,ln)return ln}st(Xe.first);for(let gt=we+1;gt<we+ke-1;gt++){const He=dn(le*A.getoffsetX(gt),ce,be,d,H,K,Ie,Ee,Be,R,E,te,ne,!1,!1,re,G,ee);if(!He)return B.length-=4*(gt-we),{notEnoughRoom:!0};st(He)}st(Xe.last)}else{if(_&&!d){const gt=Ln(K.x,K.y,0,b),He=Ee+Ie+1,rt=new u.Point(R.getx(He),R.gety(He)),wt=Ln(rt.x,rt.y,0,b),ut=wt[3]>0?wt:fn(K,rt,gt,1,b,void 0,re,G.canonical),Tt=xa(Ge,vt,(ut[0]-gt[0])*ie,ut[1]-gt[1]);if(m.flipState=Tt&&Tt.needsFlipping?fo.flipRequired:fo.flipNotRequired,Tt)return Tt}const Xe=dn(le*A.getoffsetX(we),ce,be,d,H,K,Ie,Ee,Be,R,E,te,ne,!1,!1,re,G,ee);if(!Xe)return{notEnoughRoom:!0};st(Xe)}return{}}function gn(m,a,d,_,b){const{x:E,y:I,z:A}=_.projectTilePoint(m.x,m.y,a);if(!b)return Ln(E,I,A,d);const[R,B,z]=b(m);return Ln(E+R,I+B,A+z,d)}function fn(m,a,d,_,b,E,I,A){const R=gn(m.sub(a)._unit()._add(m),A,b,I,E);return u.sub(R,d,R),u.normalize(R,R),u.scaleAndAdd(R,d,R,_)}function dn(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G){const ee=_?m-a:m+a;let le=ee>0?1:-1,ce=0;_&&(le*=-1,ce=Math.PI),le<0&&(ce+=Math.PI);let be=A+I+(le>0?0:1)|0,Ee=b,we=b,ke=0,Ie=0;const Ge=Math.abs(ee),vt=[],Be=[];let st=E,Xe=st;const gt=()=>fn(Xe,st,we,Ge-ke+1,z,K,ne,re.canonical);for(;ke+Ie<=Ge;){if(be+=le,be<A||be>=R)return null;if(we=Ee,Xe=st,vt.push(we),te&&Be.push(Xe),st=new u.Point(B.getx(be),B.gety(be)),Ee=H[be],!Ee){const vn=gn(st,re.canonical,z,ne,K);Ee=vn[3]>0?H[be]=vn:gt()}ke+=Ie,Ie=u.distance(we,Ee)}ie&&K&&(H[be]&&(Ee=gt(),Ie=u.distance(we,Ee)),H[be]=Ee);const He=(Ge-ke)/Ie,rt=st.sub(Xe)._mult(He)._add(Xe),wt=u.sub([],Ee,we),ut=u.scaleAndAdd([],we,wt,He);let Tt=[0,0,1],ln=wt[0],Pn=wt[1];if(G&&(Tt=ne.upVector(re.canonical,rt.x,rt.y),0!==Tt[0]||0!==Tt[1]||1!==Tt[2])){const vn=[Tt[2],0,-Tt[0]],Kn=u.cross([],Tt,vn);u.normalize(vn,vn),u.normalize(Kn,Kn),ln=u.dot(wt,vn),Pn=u.dot(wt,Kn)}if(d){const vn=u.cross([],Tt,wt);u.normalize(vn,vn),u.scaleAndAdd(ut,ut,vn,d*le)}const Jt=ce+Math.atan2(Pn,ln);return vt.push(ut),te&&Be.push(rt),{point:ut,angle:Jt,path:vt,tilePath:Be,up:Tt}}function er(m,a){const d=a.length,_=d+4*m;a.resize(_),a.float32.fill(-1/0,4*d,4*_)}function Gn(m,a,d){const _=a[0],b=a[1];return m[0]=d[0]*_+d[4]*b+d[12],m[1]=d[1]*_+d[5]*b+d[13],m[3]=d[3]*_+d[7]*b+d[15],m}const $i=100;class ts{constructor(a,d,_=new va(a.width+200,a.height+200,25),b=new va(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+$i,this.screenBottomBoundary=a.height+$i,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=d}placeCollisionBox(a,d,_,b,E,I,A,R){let B=_.projectedAnchorX,z=_.projectedAnchorY,H=_.projectedAnchorZ;const K=_.elevation,te=_.tileID,ie=a.getProjection();if(K&&te){const[Ee,we,ke]=ie.upVector(te.canonical,_.tileAnchorX,_.tileAnchorY),Ie=ie.upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Ee*K*Ie,z+=we*K*Ie,H+=ke*K*Ie}const ne=this.projectAndGetPerspectiveRatio(A,B,z,H,_.tileID,"globe"===ie.name||!!K||this.transform.pitch>0,ie),re=I*ne.perspectiveRatio,G=(_.x1*d+b.x-_.padding)*re+ne.point.x,ee=(_.y1*d+b.y-_.padding)*re+ne.point.y,le=(_.x2*d+b.x+_.padding)*re+ne.point.x,ce=(_.y2*d+b.y+_.padding)*re+ne.point.y,be=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(G,ee,le,ce)||!E&&this.grid.hitTest(G,ee,le,ce,R)||be?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[G,ee,le,ce],offscreen:this.isOffscreen(G,ee,le,ce),occluded:!1}}placeCollisionCircles(a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const re=[],G=this.transform.elevation,ee=a.getProjection(),le=G?G.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,ee):null,ce=new u.Point(_.tileAnchorX,_.tileAnchorY);let{x:be,y:Ee,z:we}=ee.projectTilePoint(ce.x,ce.y,ne.canonical);if(le){const[rt,wt,ut]=le(ce);be+=rt,Ee+=wt,we+=ut}const ke="globe"===ee.name,Ie=this.projectAndGetPerspectiveRatio(A,be,Ee,we,ne,ke||!!G||this.transform.pitch>0,ee),{perspectiveRatio:Ge}=Ie,vt=(H?I/Ge:I*Ge)/u.ONE_EM,Be=Ln(be,Ee,we,R),st=Ie.signedDistanceFromCamera>0?Wa(vt,E,_.lineOffsetX*vt,_.lineOffsetY*vt,!1,Be,ce,_,b,R,{},G&&!H?le:null,H&&!!G,ee,ne,H):null;let Xe=!1,gt=!1,He=!0;if(st&&!Ie.occluded){const rt=.5*te*Ge+ie,wt=new u.Point(-100,-100),ut=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),Tt=new nc,{first:ln,last:Pn}=st,Jt=ln.path.length;let vn=[];for(let Wt=Jt-1;Wt>=1;Wt--)vn.push(ln.path[Wt]);for(let Wt=1;Wt<Pn.path.length;Wt++)vn.push(Pn.path[Wt]);const Kn=2.5*rt;B&&(vn=vn.map(([Wt,xi,Pi],Ri)=>(le&&!ke&&(Pi=le(Ri<Jt-1?ln.tilePath[Jt-1-Ri]:Pn.tilePath[Ri-Jt+2])[2]),Ln(Wt,xi,Pi,B))),vn.some(Wt=>Wt[3]<=0)&&(vn=[]));let Yn=[];if(vn.length>0){let Wt=1/0,xi=-1/0,Pi=1/0,Ri=-1/0;for(const Ei of vn)Wt=Math.min(Wt,Ei[0]),Pi=Math.min(Pi,Ei[1]),xi=Math.max(xi,Ei[0]),Ri=Math.max(Ri,Ei[1]);xi>=wt.x&&Wt<=ut.x&&Ri>=wt.y&&Pi<=ut.y&&(Yn=[vn.map(Ei=>new u.Point(Ei[0],Ei[1]))],(Wt<wt.x||xi>ut.x||Pi<wt.y||Ri>ut.y)&&(Yn=u.clipLine(Yn,wt.x,wt.y,ut.x,ut.y)))}for(const Wt of Yn){Tt.reset(Wt,.25*rt);let xi=0;xi=Tt.length<=.5*rt?1:Math.ceil(Tt.paddedLength/Kn)+1;for(let Pi=0;Pi<xi;Pi++){const Ri=Pi/Math.max(xi-1,1),Ei=Tt.lerp(Ri),po=Ei.x+$i,oo=Ei.y+$i;re.push(po,oo,rt,0);const qo=po-rt,La=oo-rt,fi=po+rt,Ci=oo+rt;if(He=He&&this.isOffscreen(qo,La,fi,Ci),gt=gt||this.isInsideGrid(qo,La,fi,Ci),!d&&this.grid.hitTestCircle(po,oo,rt,K)&&(Xe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Xe,occluded:!1}}}}return{circles:!z&&Xe||!gt?[]:re,offscreen:He,collisionDetected:Xe,occluded:Ie.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,b=1/0,E=-1/0,I=-1/0;for(const z of a){const H=new u.Point(z.x+$i,z.y+$i);_=Math.min(_,H.x),b=Math.min(b,H.y),E=Math.max(E,H.x),I=Math.max(I,H.y),d.push(H)}const A=this.grid.query(_,b,E,I).concat(this.ignoredGrid.query(_,b,E,I)),R={},B={};for(const z of A){const H=z.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const K=[new u.Point(z.x1,z.y1),new u.Point(z.x2,z.y1),new u.Point(z.x2,z.y2),new u.Point(z.x1,z.y2)];u.polygonIntersectsPolygon(d,K)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===B[H.bucketInstanceId]&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(a,d,_,b,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:E},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,_,b,E){const I=d?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:b,collisionGroupID:E};for(let R=0;R<a.length;R+=4)I.insertCircle(A,a[R],a[R+1],a[R+2])}projectAndGetPerspectiveRatio(a,d,_,b,E,I,A){const R=[d,_,b,1];let B=!1;b||this.transform.pitch>0?(u.transformMat4$1(R,R,a),this.fogState&&E&&"globe"!==A.name&&(B=function(K,te,ie,ne,re,G){const ee=G.calculateFogTileMatrix(re),le=[te,ie,ne];return u.transformMat4(le,le,ee),jr(K,le,G.pitch,G._fov)}(this.fogState,d,_,b,E.toUnwrapped(),this.transform)>.9)):Gn(R,R,a);const z=R[3];return{point:new u.Point((R[0]/z+1)/2*this.transform.width+$i,(-R[1]/z+1)/2*this.transform.height+$i),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:I&&R[2]>z||B}}isOffscreen(a,d,_,b){return _<$i||a>=this.screenRightBoundary||b<$i||d>this.screenBottomBoundary}isInsideGrid(a,d,_,b){return _>=0&&a<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=u.identity([]);return u.translate(a,a,[-100,-100,0]),a}}function Hi(m,a,d){const _=a.createTileMatrix(m,m.worldSize,d.toUnwrapped());return u.multiply(new Float32Array(16),m.projMatrix,_)}function Un(m,a,d){if(a.projection.name===d.projection.name)return m.projMatrix;const _=d.clone();return _.setProjection(a.projection),Hi(_,a.getProjection(),m)}function di(m,a,d){return a.name===d.projection.name?m.projMatrix:Hi(d,a,m)}class tr{constructor(a,d,_,b){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Mo{constructor(a,d,_,b,E,I=!1){this.text=new tr(a?a.text:null,d,_,E),this.icon=new tr(a?a.icon:null,d,b,E),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fs{constructor(a,d,_,b=!1){this.text=a,this.icon=d,this.skipFade=_,this.clipped=b}}class yi{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Sn{constructor(a,d,_,b,E){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=E}}class Xa{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[a]}}function zs(m,a,d,_,b){const{horizontalAlign:E,verticalAlign:I}=u.getAnchorAlignment(m),A=-(E-.5)*a,R=-(I-.5)*d,B=u.evaluateVariableOffset(m,_);return new u.Point(A+B[0]*b,R+B[1]*b)}function El(m,a,d,_,b){const E=new u.Point(m,a);return d&&E._rotate(_?b:-b),E}class ba{constructor(a,d,_,b,E){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new ts(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Xa(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,_,b){const E=_.getBucket(d),I=_.latestFeatureIndex;if(!E||!I||d.id!==E.layerIds[0])return;const A=E.layers[0].layout,R=_.collisionBoxArray,B=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/u.EXTENT,H=_.tileID.toUnwrapped();this.transform.setProjection(E.projection);const K=(te=_.tileID,ie=E.getProjection(),ne=this.transform,ie.name===this.projection?ne.calculateProjMatrix(te.toUnwrapped()):Hi(ne,ie,te));var te,ie,ne;const re="map"===A.get("text-pitch-alignment"),G="map"===A.get("text-rotation-alignment");d.compileFilter();const ee=d.dynamicFilter(),le=d.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(_),be=es(K,_.tileID.canonical,re,G,this.transform,E.getProjection(),ce);let Ee=null;if(re){const Ie=Wi(K,_.tileID.canonical,re,G,this.transform,E.getProjection(),ce);Ee=u.multiply([],this.transform.labelPlaneMatrix,Ie)}let we=null;ee&&_.latestFeatureIndex&&(we={unwrappedTileID:H,dynamicFilter:ee,dynamicFilterNeedsFeature:le,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new Sn(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,_.tileID);const ke={bucket:E,layout:A,posMatrix:K,textLabelPlaneMatrix:be,labelToScreenMatrix:Ee,clippingData:we,scale:B,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const Ie of E.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:vt,symbolInstanceEnd:Be}=Ie;a.push({sortKey:Ge,symbolInstanceStart:vt,symbolInstanceEnd:Be,parameters:ke})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G,ee){const{textOffset0:le,textOffset1:ce,crossTileID:be}=K,Ee=[le,ce],we=zs(a,_,b,Ee,E),ke=this.collisionIndex.placeCollisionBox(ie,E,d,El(we.x,we.y,I,A,this.transform.angle),H,R,B,z.predicate);if(re){const Ie=ie.getSymbolInstanceIconSize(ee,this.transform.zoom,K.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ie,Ie,re,El(we.x,we.y,I,A,this.transform.angle),H,R,B,z.predicate).box.length)return}if(ke.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ie=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Ee,width:_,height:b,anchor:a,textScale:E,prevAnchor:Ie},this.markUsedJustification(ie,a,K,ne),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ne,K),this.placedOrientations[be]=ne),{shift:we,placedGlyphBoxes:ke}}}placeLayerBucketPart(a,d,_,b){const{bucket:E,layout:I,posMatrix:A,textLabelPlaneMatrix:R,labelToScreenMatrix:B,clippingData:z,textPixelRatio:H,holdingForFade:K,collisionBoxArray:te,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ne,collisionGroup:re}=a.parameters,G=I.get("text-optional"),ee=I.get("icon-optional"),le=I.get("text-allow-overlap"),ce=I.get("icon-allow-overlap"),be="map"===I.get("text-rotation-alignment"),Ee="map"===I.get("text-pitch-alignment"),we="none"!==I.get("icon-text-fit"),ke="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(E.projection);let Ie=le&&(ce||!E.hasIconData()||ee),Ge=ce&&(le||!E.hasTextData()||G);!E.collisionArrays&&te&&E.deserializeCollisionBoxes(te),_&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,te);const vt=(Be,st,Xe)=>{const{crossTileID:gt,numVerticalGlyphVertices:He}=Be;if(z){const fi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ci=null;if(z.dynamicFilterNeedsFeature){const hi=this.retainedQueryData[E.bucketInstanceId];Ci=z.featureIndex.loadFeature({featureIndex:Be.featureIndex,bucketIndex:hi.bucketIndex,sourceLayerIndex:hi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(fi,Ci,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new u.Point(Be.tileAnchorX,Be.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[gt]=new Fs(!1,!1,!1,!0),void d.add(gt)}if(d.has(gt))return;if(K)return void(this.placements[gt]=new Fs(!1,!1,!1));let rt=!1,wt=!1,ut=!0,Tt=!1,ln=!1,Pn=null,Jt={box:null,offscreen:null,occluded:null},vn={box:null,offscreen:null,occluded:null},Kn=null,Yn=null,Wt=null,xi=0,Pi=0,Ri=0;Xe.textFeatureIndex?xi=Xe.textFeatureIndex:Be.useRuntimeCollisionCircles&&(xi=Be.featureIndex),Xe.verticalTextFeatureIndex&&(Pi=Xe.verticalTextFeatureIndex);const Ei=fi=>{fi.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Ci=this.transform.elevation;(Ci||fi.elevation)&&(fi.elevation=Ci?Ci.getAtTileOffset(fi.tileID,fi.tileAnchorX,fi.tileAnchorY):0)},po=Xe.textBox;if(po){Ei(po);const fi=hi=>{let Wn=u.WritingMode.horizontal;if(E.allowVerticalPlacement&&!hi&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[gt];mo&&(this.placedOrientations[gt]=mo,Wn=mo,this.markUsedOrientation(E,Wn,Be))}return Wn},Ci=(hi,Wn)=>{if(E.allowVerticalPlacement&&He>0&&Xe.verticalTextBox){for(const mo of E.writingModes)if(mo===u.WritingMode.vertical?(Jt=Wn(),vn=Jt):Jt=hi(),Jt&&Jt.box&&Jt.box.length)break}else Jt=hi()};if(I.get("text-variable-anchor")){let hi=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[gt]){const Li=this.prevPlacement.variableOffsets[gt];hi.indexOf(Li.anchor)>0&&(hi=hi.filter(Xi=>Xi!==Li.anchor),hi.unshift(Li.anchor))}const Wn=(Li,Xi,Lh)=>{const Fl=E.getSymbolInstanceTextSize(ie,Be,this.transform.zoom,st),ka=(Li.x2-Li.x1)*Fl+2*Li.padding,Or=(Li.y2-Li.y1)*Fl+2*Li.padding,zl=we&&!ce?Xi:null;zl&&Ei(zl);let mc={box:[],offscreen:!1,occluded:!1};const kh=le?2*hi.length:hi.length;for(let bs=0;bs<kh;++bs){const Oh=this.attemptAnchorPlacement(hi[bs%hi.length],Li,ka,Or,Fl,be,Ee,H,A,re,bs>=hi.length,Be,st,E,Lh,zl,ie,ne);if(Oh&&(mc=Oh.placedGlyphBoxes,mc&&mc.box&&mc.box.length)){rt=!0,Pn=Oh.shift;break}}return mc};Ci(()=>Wn(po,Xe.iconBox,u.WritingMode.horizontal),()=>{const Li=Xe.verticalTextBox;return Li&&Ei(Li),E.allowVerticalPlacement&&!(Jt&&Jt.box&&Jt.box.length)&&He>0&&Li?Wn(Li,Xe.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Jt&&(rt=Jt.box,ut=Jt.offscreen,Tt=Jt.occluded);const mo=fi(!(!Jt||!Jt.box));if(!rt&&this.prevPlacement){const Li=this.prevPlacement.variableOffsets[gt];Li&&(this.variableOffsets[gt]=Li,this.markUsedJustification(E,Li.anchor,Be,mo))}}else{const hi=(Wn,mo)=>{const Li=E.getSymbolInstanceTextSize(ie,Be,this.transform.zoom,st),Xi=this.collisionIndex.placeCollisionBox(E,Li,Wn,new u.Point(0,0),le,H,A,re.predicate);return Xi&&Xi.box&&Xi.box.length&&(this.markUsedOrientation(E,mo,Be),this.placedOrientations[gt]=mo),Xi};Ci(()=>hi(po,u.WritingMode.horizontal),()=>{const Wn=Xe.verticalTextBox;return E.allowVerticalPlacement&&He>0&&Wn?(Ei(Wn),hi(Wn,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),fi(!!(Jt&&Jt.box&&Jt.box.length))}}if(Kn=Jt,rt=Kn&&Kn.box&&Kn.box.length>0,ut=Kn&&Kn.offscreen,Tt=Kn&&Kn.occluded,Be.useRuntimeCollisionCircles){const fi=E.text.placedSymbolArray.get(Be.centerJustifiedTextSymbolIndex>=0?Be.centerJustifiedTextSymbolIndex:Be.verticalPlacedTextSymbolIndex),Ci=u.evaluateSizeForFeature(E.textSizeData,ie,fi),hi=I.get("text-padding");Yn=this.collisionIndex.placeCollisionCircles(E,le,fi,E.lineVertexArray,E.glyphOffsetArray,Ci,A,R,B,_,Ee,re.predicate,Be.collisionCircleDiameter*Ci/u.ONE_EM,hi,this.retainedQueryData[E.bucketInstanceId].tileID),rt=le||Yn.circles.length>0&&!Yn.collisionDetected,ut=ut&&Yn.offscreen,Tt=Yn.occluded}if(Xe.iconFeatureIndex&&(Ri=Xe.iconFeatureIndex),Xe.iconBox){const fi=Ci=>{Ei(Ci);const hi=we&&Pn?El(Pn.x,Pn.y,be,Ee,this.transform.angle):new u.Point(0,0),Wn=E.getSymbolInstanceIconSize(ne,this.transform.zoom,Be.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Wn,Ci,hi,ce,H,A,re.predicate)};vn&&vn.box&&vn.box.length&&Xe.verticalIconBox?(Wt=fi(Xe.verticalIconBox),wt=Wt.box.length>0):(Wt=fi(Xe.iconBox),wt=Wt.box.length>0),ut=ut&&Wt.offscreen,ln=Wt.occluded}const oo=G||0===Be.numHorizontalGlyphVertices&&0===He,qo=ee||0===Be.numIconVertices;if(oo||qo?qo?oo||(wt=wt&&rt):rt=wt&&rt:wt=rt=wt&&rt,rt&&Kn&&Kn.box&&this.collisionIndex.insertCollisionBox(Kn.box,I.get("text-ignore-placement"),E.bucketInstanceId,vn&&vn.box&&Pi?Pi:xi,re.ID),wt&&Wt&&this.collisionIndex.insertCollisionBox(Wt.box,I.get("icon-ignore-placement"),E.bucketInstanceId,Ri,re.ID),Yn&&(rt&&this.collisionIndex.insertCollisionCircles(Yn.circles,I.get("text-ignore-placement"),E.bucketInstanceId,xi,re.ID),_)){const fi=E.bucketInstanceId;let Ci=this.collisionCircleArrays[fi];void 0===Ci&&(Ci=this.collisionCircleArrays[fi]=new yi);for(let hi=0;hi<Yn.circles.length;hi+=4)Ci.circles.push(Yn.circles[hi+0]),Ci.circles.push(Yn.circles[hi+1]),Ci.circles.push(Yn.circles[hi+2]),Ci.circles.push(Yn.collisionDetected?1:0)}const La="globe"!==E.projection.name;Ie=Ie&&(La||!Tt),Ge=Ge&&(La||!ln),this.placements[gt]=new Fs(rt||Ie,wt||Ge,ut||E.justReloaded),d.add(gt)};if(ke){const Be=E.getSortedSymbolIndexes(this.transform.angle);for(let st=Be.length-1;st>=0;--st){const Xe=Be[st];vt(E.symbolInstances.get(Xe),Xe,E.collisionArrays[Xe])}}else for(let Be=a.symbolInstanceStart;Be<a.symbolInstanceEnd;Be++)vt(E.symbolInstances.get(Be),Be,E.collisionArrays[Be]);if(_&&E.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[E.bucketInstanceId];u.invert(Be.invProjMatrix,A),Be.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(a,d,_,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R,crossTileID:B}=_,z=u.getAnchorJustification(d),H=b===u.WritingMode.vertical?R:"left"===z?E:"center"===z?I:"right"===z?A:-1;E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:B),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:B),A>=0&&(a.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:B),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=H>=0&&R!==H?0:B)}markUsedOrientation(a,d,_){const b=d===u.WritingMode.horizontal||d===u.WritingMode.horizontalOnly?d:0,E=d===u.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:B}=_,z=a.text.placedSymbolArray;I>=0&&(z.get(I).placedOrientation=b),A>=0&&(z.get(A).placedOrientation=b),R>=0&&(z.get(R).placedOrientation=b),B>=0&&(z.get(B).placedOrientation=E)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(a):1,E=d?d.opacities:{},I=d?d.variableOffsets:{},A=d?d.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],z=E[R];z?(this.opacities[R]=new Mo(z,b,B.text,B.icon,null,B.clipped),_=_||B.text!==z.text.placed||B.icon!==z.icon.placed):(this.opacities[R]=new Mo(null,b,B.text,B.icon,B.skipFade,B.clipped),_=_||B.text||B.icon)}for(const R in E){const B=E[R];if(!this.opacities[R]){const z=new Mo(B,b,!1,!1);z.isHidden()||(this.opacities[R]=z,_=_||B.text.placed||B.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);_?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const _=new Set;for(const b of d){const E=b.getBucket(a);E&&b.latestFeatureIndex&&a.id===E.layerIds[0]&&this.updateBucketOpacities(E,_,b.collisionBoxArray)}}updateBucketOpacities(a,d,_){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const b=a.layers[0].layout,E=!!a.layers[0].dynamicFilter(),I=new Mo(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),B=b.get("text-variable-anchor"),z="map"===b.get("text-rotation-alignment"),H="map"===b.get("text-pitch-alignment"),K="none"!==b.get("icon-text-fit"),te=new Mo(null,0,A&&(R||!a.hasIconData()||b.get("icon-optional")),R&&(A||!a.hasTextData()||b.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const ie=(re,G,ee)=>{for(let le=0;le<G/4;le++)re.opacityVertexArray.emplaceBack(ee)};let ne=0;for(let re=0;re<a.symbolInstances.length;re++){const G=a.symbolInstances.get(re),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:le,crossTileID:ce,numIconVertices:be}=G,Ee=d.has(ce);let we=this.opacities[ce];Ee?we=I:we||(we=te,this.opacities[ce]=we),d.add(ce);const ke=ee>0||le>0,Ie=be>0,Ge=this.placedOrientations[ce],vt=Ge===u.WritingMode.vertical,Be=Ge===u.WritingMode.horizontal||Ge===u.WritingMode.horizontalOnly;if(!ke&&!Ie||we.isHidden()||ne++,ke){const st=Pr(we.text);ie(a.text,ee,vt?nr:st),ie(a.text,le,Be?nr:st);const Xe=we.text.isHidden(),{leftJustifiedTextSymbolIndex:gt,centerJustifiedTextSymbolIndex:He,rightJustifiedTextSymbolIndex:rt,verticalPlacedTextSymbolIndex:wt}=G,ut=a.text.placedSymbolArray,Tt=Xe||vt?1:0;gt>=0&&(ut.get(gt).hidden=Tt),He>=0&&(ut.get(He).hidden=Tt),rt>=0&&(ut.get(rt).hidden=Tt),wt>=0&&(ut.get(wt).hidden=Xe||Be?1:0);const ln=this.variableOffsets[ce];ln&&this.markUsedJustification(a,ln.anchor,G,Ge);const Pn=this.placedOrientations[ce];Pn&&(this.markUsedJustification(a,"left",G,Pn),this.markUsedOrientation(a,Pn,G))}if(Ie){const st=Pr(we.icon),{placedIconSymbolIndex:Xe,verticalPlacedIconSymbolIndex:gt}=G,He=a.icon.placedSymbolArray,rt=we.icon.isHidden()?1:0;Xe>=0&&(ie(a.icon,be,vt?nr:st),He.get(Xe).hidden=rt),gt>=0&&(ie(a.icon,G.numVerticalIconVertices,Be?nr:st),He.get(gt).hidden=rt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const st=a.collisionArrays[re];if(st){let Xe=new u.Point(0,0),gt=!0;if(st.textBox||st.verticalTextBox){if(B){const rt=this.variableOffsets[ce];rt?(Xe=zs(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textScale),z&&Xe._rotate(H?this.transform.angle:-this.transform.angle)):gt=!1}E&&(gt=!we.clipped),st.textBox&&Et(a.textCollisionBox.collisionVertexArray,we.text.placed,!gt||vt,Xe.x,Xe.y),st.verticalTextBox&&Et(a.textCollisionBox.collisionVertexArray,we.text.placed,!gt||Be,Xe.x,Xe.y)}const He=gt&&!(Be||!st.verticalIconBox);st.iconBox&&Et(a.iconCollisionBox.collisionVertexArray,we.icon.placed,He,K?Xe.x:0,K?Xe.y:0),st.verticalIconBox&&Et(a.iconCollisionBox.collisionVertexArray,we.icon.placed,!He,K?Xe.x:0,K?Xe.y:0)}}}if(a.fullyClipped=0===ne,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=re.invProjMatrix,a.placementViewportMatrix=re.viewportMatrix,a.collisionCircleArray=re.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function Et(m,a,d,_,b){m.emplaceBack(a?1:0,d?1:0,_||0,b||0),m.emplaceBack(a?1:0,d?1:0,_||0,b||0),m.emplaceBack(a?1:0,d?1:0,_||0,b||0),m.emplaceBack(a?1:0,d?1:0,_||0,b||0)}const Ar=Math.pow(2,25),an=Math.pow(2,24),nn=Math.pow(2,17),Bo=Math.pow(2,16),ii=Math.pow(2,9),So=Math.pow(2,8),Cl=Math.pow(2,1);function Pr(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const a=m.placed?1:0,d=Math.floor(127*m.opacity);return d*Ar+a*an+d*nn+a*Bo+d*ii+a*So+d*Cl+a}const nr=0;class ns{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,d,_,b,E){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(I,b,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(d.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class Vc{constructor(a,d,_,b,E,I,A,R){this.placement=new ba(a,E,I,A,R),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(a,d,_){const b=u.exported.now(),E=()=>{const I=u.exported.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=d[a[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ns(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Hr=512/u.EXTENT/2;class vi{constructor(a,d,_){this.tileID=a,this.bucketInstanceId=_,this.index=new u.KDBush(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=a.canonical.x*u.EXTENT,E=a.canonical.y*u.EXTENT;for(let I=0;I<d.length;I++){const{key:A,crossTileID:R,tileAnchorX:B,tileAnchorY:z}=d.get(I),H=Math.floor((b+B)*Hr),K=Math.floor((E+z)*Hr);this.index.add(H,K),this.keys.push(A),this.crossTileIDs.push(R)}this.index.finish()}findMatches(a,d,_){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=Hr/Math.pow(2,d.canonical.z-this.tileID.canonical.z),I=d.canonical.x*u.EXTENT,A=d.canonical.y*u.EXTENT;for(let R=0;R<a.length;R++){const B=a.get(R);if(B.crossTileID)continue;const{key:z,tileAnchorX:H,tileAnchorY:K}=B,te=Math.floor((I+H)*E),ie=Math.floor((A+K)*E),ne=this.index.range(te-b,ie-b,te+b,ie+b);for(const re of ne){const G=this.crossTileIDs[re];if(this.keys[re]===z&&!_.has(G)){_.add(G),B.crossTileID=G;break}}}}}class wa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Su{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(0!==d)for(const _ in this.indexes){const b=this.indexes[_],E={};for(const I in b){const A=b[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),E[A.tileID.key]=A}this.indexes[_]=E}this.lng=a}addBucket(a,d,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const b=this.usedCrossTileIDs[a.overscaledZ];for(const E in this.indexes){const I=this.indexes[E];if(Number(E)>a.overscaledZ)for(const A in I){const R=I[A];R.tileID.isChildOf(a)&&R.findMatches(d.symbolInstances,a,b)}else{const A=I[a.scaledTo(Number(E)).key];A&&A.findMatches(d.symbolInstances,a,b)}}for(let E=0;E<d.symbolInstances.length;E++){const I=d.symbolInstances.get(E);I.crossTileID||(I.crossTileID=_.generate(),b.add(I.crossTileID))}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new vi(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const _ of d.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let d=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const E in b)a[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[E]),delete b[E],d=!0)}return d}}class Bs{constructor(){this.layerIndexes={},this.crossTileIDs=new wa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,_,b){let E=this.layerIndexes[a.id];void 0===E&&(E=this.layerIndexes[a.id]=new Su);let I=!1;const A={};"globe"!==b.name&&E.handleWrapJump(_);for(const R of d){const B=R.getBucket(a);B&&a.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(R.tileID,B,this.crossTileIDs)&&(I=!0),A[B.bucketInstanceId]=!0)}return E.removeStaleBuckets(A)&&(I=!0),I}pruneUnusedLayers(a){const d={};a.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const Ea=(m,a)=>u.emitValidationErrors(m,a&&a.filter(d=>"source.canvas"!==d.identifier)),Uc=u.pick(Xn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Iu=u.pick(Xn,["setCenter","setZoom","setBearing","setPitch"]),Th={version:8,layers:[],sources:{}},Fr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bt extends u.Evented{constructor(a,d={}){super(),this.map=a,this.dispatcher=new Ji(_a(),this),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(a._requestManager,d.localFontFamily?u.LocalGlyphMode.all:d.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new Bs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const _=this;this._rtlTextPluginCallback=Bt.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,I)=>{if(u.triggerPluginCompletionEvent(E),I&&I.every(A=>A))for(const A in _._sourceCaches){const R=_._sourceCaches[A],B=R.getSource().type;"vector"!==B&&"geojson"!==B||R.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===E.id&&this._validateLayer(A)}})}loadURL(a,d={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!u.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,d.accessToken);const b=this.map._requestManager.transformRequest(a,u.ResourceType.Style);this._request=u.getJSON(b,(E,I)=>{this._request=null,E?this.fire(new u.ErrorEvent(E)):I&&this._load(I,_)})}loadJSON(a,d={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(a,!1!==d.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Th,!1)}_updateLayerCount(a,d){const _=d?1:-1;a.is3D()&&(this._num3DLayers+=_),"circle"===a.type&&(this._numCircleLayers+=_),"symbol"===a.type&&(this._numSymbolLayers+=_)}_load(a,d){if(d&&Ea(this,u.validateStyle(a)))return;this._loaded=!0,this.stylesheet=u.clone$1(a),this._updateMapProjection();for(const b in a.sources)this.addSource(b,a.sources[b],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const _=Ch(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of _){const E=u.createStyleLayer(b);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new En(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(d,_,b){let E,I,A;const R=u.exported.devicePixelRatio>1?"@2x":"";let B=u.getJSON(_.transformRequest(_.normalizeSpriteURL(d,R,".json"),u.ResourceType.SpriteJSON),(K,te)=>{B=null,A||(A=K,E=te,H())}),z=u.getImage(_.transformRequest(_.normalizeSpriteURL(d,R,".png"),u.ResourceType.SpriteImage),(K,te)=>{z=null,A||(A=K,I=te,H())});function H(){if(A)b(A);else if(E&&I){const K=u.exported.getImageData(I),te={};for(const ie in E){const{width:ne,height:re,x:G,y:ee,sdf:le,pixelRatio:ce,stretchX:be,stretchY:Ee,content:we}=E[ie],ke=new u.RGBAImage({width:ne,height:re});u.RGBAImage.copy(K,ke,{x:G,y:ee},{x:0,y:0},{width:ne,height:re}),te[ie]={data:ke,pixelRatio:ce,sdf:le,stretchX:be,stretchY:Ee,content:we}}b(null,te)}}return{cancel(){B&&(B.cancel(),B=null),z&&(z.cancel(),z=null)}}}(a,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new u.ErrorEvent(d));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(a){const d=this.getSource(a.source);if(!d)return;const _=a.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const d=[];for(const _ of a){const b=this._layers[_];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&("function"==typeof a.isLayerDraped?a.isLayerDraped():Fr[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const I in this._updatedSources){const A=this._updatedSources[I];"reload"===A?this._reloadSource(I):"clear"===A&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const E=this._sourceCaches[b];_[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];if(E.recalculate(a,this._availableImages),!E.isHidden(a.zoom)){const A=this._getLayerSourceCache(E);A&&(A.used=!0)}const I=this.map.painter;if(I){const A=E.getProgramIds();if(!A)continue;const R=E.getProgramConfiguration(a.zoom);for(const B of A)I.useProgram(B,R)}}for(const b in _){const E=this._sourceCaches[b];_[b]!==E.used&&E.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Ea(this,u.validateStyle(a)))return!1;(a=u.clone$1(a)).layers=Ch(a.layers);const d=function(b,E){if(!b)return[{command:Xn.setStyle,args:[E]}];let I=[];try{if(!Q(b.version,E.version))return[{command:Xn.setStyle,args:[E]}];Q(b.center,E.center)||I.push({command:Xn.setCenter,args:[E.center]}),Q(b.zoom,E.zoom)||I.push({command:Xn.setZoom,args:[E.zoom]}),Q(b.bearing,E.bearing)||I.push({command:Xn.setBearing,args:[E.bearing]}),Q(b.pitch,E.pitch)||I.push({command:Xn.setPitch,args:[E.pitch]}),Q(b.sprite,E.sprite)||I.push({command:Xn.setSprite,args:[E.sprite]}),Q(b.glyphs,E.glyphs)||I.push({command:Xn.setGlyphs,args:[E.glyphs]}),Q(b.transition,E.transition)||I.push({command:Xn.setTransition,args:[E.transition]}),Q(b.light,E.light)||I.push({command:Xn.setLight,args:[E.light]}),Q(b.fog,E.fog)||I.push({command:Xn.setFog,args:[E.fog]}),Q(b.projection,E.projection)||I.push({command:Xn.setProjection,args:[E.projection]});const A={},R=[];!function(H,K,te,ie){let ne;for(ne in K=K||{},H=H||{})H.hasOwnProperty(ne)&&(K.hasOwnProperty(ne)||fr(ne,te,ie));for(ne in K){if(!K.hasOwnProperty(ne))continue;const re=K[ne];H.hasOwnProperty(ne)?Q(H[ne],re)||("geojson"===H[ne].type&&"geojson"===re.type&&to(H,K,ne)?te.push({command:Xn.setGeoJSONSourceData,args:[ne,re.data]}):ya(ne,K,te,ie)):Du(ne,K,te)}}(b.sources,E.sources,R,A);const B=[];b.layers&&b.layers.forEach(H=>{H.source&&A[H.source]?I.push({command:Xn.removeLayer,args:[H.id]}):B.push(H)});let z=b.terrain;z&&A[z.source]&&(I.push({command:Xn.setTerrain,args:[void 0]}),z=void 0),I=I.concat(R),Q(z,E.terrain)||I.push({command:Xn.setTerrain,args:[E.terrain]}),function(H,K,te){K=K||[];const ie=(H=H||[]).map(ks),ne=K.map(ks),re=H.reduce(Mu,{}),G=K.reduce(Mu,{}),ee=ie.slice(),le=Object.create(null);let ce,be,Ee,we,ke,Ie,Ge;for(ce=0,be=0;ce<ie.length;ce++)Ee=ie[ce],G.hasOwnProperty(Ee)?be++:(te.push({command:Xn.removeLayer,args:[Ee]}),ee.splice(ee.indexOf(Ee,be),1));for(ce=0,be=0;ce<ne.length;ce++)Ee=ne[ne.length-1-ce],ee[ee.length-1-ce]!==Ee&&(re.hasOwnProperty(Ee)?(te.push({command:Xn.removeLayer,args:[Ee]}),ee.splice(ee.lastIndexOf(Ee,ee.length-be),1)):be++,Ie=ee[ee.length-ce],te.push({command:Xn.addLayer,args:[G[Ee],Ie]}),ee.splice(ee.length-ce,0,Ee),le[Ee]=!0);for(ce=0;ce<ne.length;ce++)if(Ee=ne[ce],we=re[Ee],ke=G[Ee],!le[Ee]&&!Q(we,ke))if(Q(we.source,ke.source)&&Q(we["source-layer"],ke["source-layer"])&&Q(we.type,ke.type)){for(Ge in Ls(we.layout,ke.layout,te,Ee,null,Xn.setLayoutProperty),Ls(we.paint,ke.paint,te,Ee,null,Xn.setPaintProperty),Q(we.filter,ke.filter)||te.push({command:Xn.setFilter,args:[Ee,ke.filter]}),Q(we.minzoom,ke.minzoom)&&Q(we.maxzoom,ke.maxzoom)||te.push({command:Xn.setLayerZoomRange,args:[Ee,ke.minzoom,ke.maxzoom]}),we)we.hasOwnProperty(Ge)&&"layout"!==Ge&&"paint"!==Ge&&"filter"!==Ge&&"metadata"!==Ge&&"minzoom"!==Ge&&"maxzoom"!==Ge&&(0===Ge.indexOf("paint.")?Ls(we[Ge],ke[Ge],te,Ee,Ge.slice(6),Xn.setPaintProperty):Q(we[Ge],ke[Ge])||te.push({command:Xn.setLayerProperty,args:[Ee,Ge,ke[Ge]]}));for(Ge in ke)ke.hasOwnProperty(Ge)&&!we.hasOwnProperty(Ge)&&"layout"!==Ge&&"paint"!==Ge&&"filter"!==Ge&&"metadata"!==Ge&&"minzoom"!==Ge&&"maxzoom"!==Ge&&(0===Ge.indexOf("paint.")?Ls(we[Ge],ke[Ge],te,Ee,Ge.slice(6),Xn.setPaintProperty):Q(we[Ge],ke[Ge])||te.push({command:Xn.setLayerProperty,args:[Ee,Ge,ke[Ge]]}))}else te.push({command:Xn.removeLayer,args:[Ee]}),Ie=ee[ee.lastIndexOf(Ee)+1],te.push({command:Xn.addLayer,args:[ke,Ie]})}(B,E.layers,I)}catch(A){console.warn("Unable to compute style diff:",A),I=[{command:Xn.setStyle,args:[E]}]}return I}(this.serialize(),a).filter(b=>!(b.command in Iu));if(0===d.length)return!1;const _=d.filter(b=>!(b.command in Uc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&"setProjection"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,d){return this.getImage(a)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,d),this._afterImageUpdated(a),this)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(u.validateSource,`sources.${a}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=Dn(a,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:b.serialize(),sourceId:a}));const E=I=>{const A=(I?"symbol:":"other:")+a,R=this._sourceCaches[A]=new u.SourceCache(A,b,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=R,R.style=this,R.onAdd(this.map)};E(!1),"vector"!==d.type&&"geojson"!==d.type||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const d=this.getSource(a);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===a)return this.fire(new u.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new u.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(a);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,d){this._checkLoaded(),this.getSource(a).setData(d),this._changed=!0}getSource(a){const d=this._getSourceCache(a);return d&&d.getSource()}_getSources(){const a=[];for(const d in this._otherSourceCaches){const _=this._getSourceCache(d);_&&a.push(_.getSource())}return a}addLayer(a,d,_={}){this._checkLoaded();const b=a.id;if(this.getLayer(b))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if("custom"===a.type){if(Ea(this,u.validateCustomStyleLayer(a)))return;E=u.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(b,a.source),a=u.clone$1(a),a=u.extend(a,{source:b})),this._validate(u.validateLayer,`layers.${b}`,a,{arrayIndex:-1},_))return;E=u.createStyleLayer(a),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const I=d?this._order.indexOf(d):this._order.length;if(d&&-1===I)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=E;const A=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&A&&"custom"!==E.type){const R=this._removedLayers[b];delete this._removedLayers[b],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",A.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const _=this._order.indexOf(a);this._order.splice(_,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new u.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const d in this._layers)if(this._layers[d].type===a)return!0;return!1}setLayerZoomRange(a,d,_){this._checkLoaded();const b=this.getLayer(a);b?b.minzoom===d&&b.maxzoom===_||(null!=d&&(b.minzoom=d),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,d,_={}){this._checkLoaded();const b=this.getLayer(a);if(b){if(!Q(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(u.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=u.clone$1(d),this._updateLayer(b)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const d=this.getLayer(a);return d&&u.clone$1(d.filter)}setLayoutProperty(a,d,_,b={}){this._checkLoaded();const E=this.getLayer(a);E?Q(E.getLayoutProperty(d),_)||(E.setLayoutProperty(d,_,b),this._updateLayer(E)):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,d){const _=this.getLayer(a);if(_)return _.getLayoutProperty(d);this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,d,_,b={}){this._checkLoaded();const E=this.getLayer(a);E?Q(E.getPaintProperty(d),_)||(E.setPaintProperty(d,_,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,d){const _=this.getLayer(a);return _&&_.getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const _=a.source,b=a.sourceLayer,E=this.getSource(_);if(!E)return void this.fire(new u.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=E.type;if("geojson"===I&&b)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!b)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const R of A)R.setFeatureState(b,a.id,d)}removeFeatureState(a,d){this._checkLoaded();const _=a.source,b=this.getSource(_);if(!b)return void this.fire(new u.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const E=b.type,I="vector"===E?a.sourceLayer:void 0;if("vector"===E&&!I)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const R of A)R.removeFeatureState(I,a.id,d)}getFeatureState(a){this._checkLoaded();const d=a.source,_=a.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||_)return void 0===a.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,a.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();a[_.id]||(a[_.id]=_.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(a){this._updatedLayers[a.id]=!0;const d=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[a.source]="reload",d.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const d=I=>"fill-extrusion"===this._layers[I].type,_={},b=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(d(A)){_[A]=I;for(const R of a){const B=R[A];if(B)for(const z of B)b.push(z)}}}b.sort((I,A)=>A.intersectionZ-I.intersectionZ);const E=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(d(A))for(let R=b.length-1;R>=0;R--){const B=b[R].feature;if(_[B.layer.id]<I)break;E.push(B),b.pop()}else for(const R of a){const B=R[A];if(B)for(const z of B)E.push(z.feature)}}return E}queryRenderedFeatures(a,d,_){d&&d.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const B=this._layers[R];if(!B)return this.fire(new u.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const E=[];d.availableImages=this._availableImages;const I=d&&d.layers?d.layers.some(R=>{const B=this.getLayer(R);return B&&B.is3D()}):this.has3DLayers(),A=Mn.createFromScreenPoints(a,_);for(const R in this._sourceCaches){const B=this._sourceCaches[R].getSource().id;d.layers&&!b[B]||E.push(Ni(this._sourceCaches[R],this._layers,this._serializedLayers,A,d,_,I,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(R,B,z,H,K,te,ie){const ne={},re=te.queryRenderedSymbols(H),G=[];for(const ee of Object.keys(re).map(Number))G.push(ie[ee]);G.sort(wi);for(const ee of G){const le=ee.featureIndex.lookupSymbolFeatures(re[ee.bucketInstanceId],B,ee.bucketIndex,ee.sourceLayerIndex,K.filter,K.layers,K.availableImages,R);for(const ce in le){const be=ne[ce]=ne[ce]||[],Ee=le[ce];Ee.sort((we,ke)=>{const Ie=ee.featureSortOrder;if(Ie){const Ge=Ie.indexOf(we.featureIndex);return Ie.indexOf(ke.featureIndex)-Ge}return ke.featureIndex-we.featureIndex});for(const we of Ee)be.push(we)}}for(const ee in ne)ne[ee].forEach(le=>{const ce=le.feature,be=z(R[ee]);if(!be)return;const Ee=be.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=Ee});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(a,d){d&&d.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(a);let b=[];for(const E of _)b=b.concat(lr(E,d));return b}addSourceType(a,d,_){return Bt.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(Bt.setSourceType(a,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(a,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const I in a)if(!Q(a[I],_[I])){b=!0;break}if(!b)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,d=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=a;if(1===d){if("object"==typeof _.source){const b="terrain-dem-src";this.addSource(b,_.source),_=u.clone$1(_),_=u.extend(_,{source:b})}if(this._validate(u.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,d)}else{const b=this.terrain,E=b.get();for(const I of Object.keys(u.spec.terrain))!_.hasOwnProperty(I)&&u.spec.terrain[I].default&&(_[I]=u.spec.terrain[I].default);for(const I in _)if(!Q(_[I],E[I])){b.set(_),this.stylesheet.terrain=_;const A=this._setTransitionParameters({duration:0});b.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const d=this.fog=new bn(a,this.map.transform);this.stylesheet.fog=a;const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();0===Object.keys(a).length&&d.set(a);for(const b in a)if(!Q(a[b],_[b])){d.set(a),this.stylesheet.fog=a;const E=this._setTransitionParameters({duration:0});d.updateTransitions(E);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:u.exported.now(),transition:u.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...d)}_createTerrain(a,d){const _=this.terrain=new Ui(a,d);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});_.updateTransitions(b)}_force3DLayerUpdate(){for(const a in this._layers){const d=this._layers[a];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const d=this._layers[a];"symbol"===d.type&&this._updateLayer(d)}}_validate(a,d,_,b,E={}){return(!E||!1!==E.validate)&&Ea(this,a.call(u.validateStyle,u.extend({key:d,style:this.serialize(),value:_,styleSpec:u.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const d=this._getSourceCaches(a);for(const _ of d)_.clearTiles()}_reloadSource(a){const d=this._getSourceCaches(a);for(const _ of d)_.resume(),_.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const d in this._sourceCaches)this._sourceCaches[d].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const d=this._sourceCaches[a];d.resume(),d.reload()}}_updatePlacement(a,d,_,b,E=!1){let I=!1,A=!1;const R={};for(const B of this._order){const z=this._layers[B];if("symbol"!==z.type)continue;if(!R[z.source]){const K=this._getLayerSourceCache(z);if(!K)continue;R[z.source]=K.getRenderableIds(!0).map(te=>K.getTileByID(te)).sort((te,ie)=>ie.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ie.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,R[z.source],a.center.lng,a.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),a.zoom))&&(this.pauseablePlacement=new Vc(a,this._order,E,d,_,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const B of this._order){const z=this._layers[B];"symbol"===z.type&&this.placement.updateLayerOpacities(z,R[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const b=E=>{E&&E.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(a,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(a,d,_){return u.makeRequest(d,_)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const d=[];return this._otherSourceCaches[a]&&d.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&d.push(this._symbolSourceCaches[a]),d}_isSourceCacheLoaded(a){const d=this._getSourceCaches(a);return 0===d.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bt.getSourceType=function(m){return Fn[m]},Bt.setSourceType=function(m,a){Fn[m]=a},Bt.registerForPluginStateChange=u.registerForPluginStateChange;var Dh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",no="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Vo="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",on="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ca="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Rr={},Vs={};const Tl=[];Gr(Dh,Tl),Gr(Vo,Tl),Gr(on,Tl),Gr(Ca,Tl),Rr=ci("",Vo),Vs=ci(Ca,on);const Au=ci("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),jc=Dh,Ta="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Dl={background:ci("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ci("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ci("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ci("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ci("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ci("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ci("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ci("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ci("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ci("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ci("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ci("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ci("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ci("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ci("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ci("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ci("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ci("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ci("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",no),skyboxGradient:ci("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",no),skyboxCapture:ci("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ci("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Gr(m,a){const d=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of d)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=_.split(" ");for(const E of b)a.includes(E)||a.push(E)}}function ci(m,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...Tl];return Gr(m,E),Gr(a,E),{fragmentSource:m=m.replace(d,(I,A,R,B,z)=>(b[z]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = u_${z};\n#endif\n`)),vertexSource:a=a.replace(d,(I,A,R,B,z)=>{const H="float"===B?"vec2":"vec4",K=z.match(/color/)?"color":H;return b[z]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`}),staticAttributes:_,usedDefines:E}}class Mh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,d,_,b,E,I,A){this.context=a;let R=this.boundPaintVertexBuffers.length!==b.length;for(let z=0;!R&&z<b.length;z++)this.boundPaintVertexBuffers[z]!==b[z]&&(R=!0);let B=this.boundDynamicVertexBuffers.length!==A.length;for(let z=0;!B&&z<A.length;z++)this.boundDynamicVertexBuffers[z]!==A[z]&&(B=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||R||B||this.boundIndexBuffer!==E||this.boundVertexOffset!==I)this.freshBind(d,_,b,E,I,A);else{a.bindVertexArrayOES.set(this.vao);for(const z of A)z&&z.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(a,d,_,b,E,I){let A;const R=a.numAttributes,B=this.context,z=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=I;else{A=B.currentNumAttributes||0;for(let H=R;H<A;H++)z.disableVertexAttribArray(H)}d.enableAttributes(z,a),d.bind(),d.setVertexAttribPointers(z,a,E);for(const H of _)H.enableAttributes(z,a),H.bind(),H.setVertexAttribPointers(z,a,E);for(const H of I)H&&(H.enableAttributes(z,a),H.bind(),H.setVertexAttribPointers(z,a,E));b&&b.bind(),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function jn(m,a){const d=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new u.MercatorCoordinate(0,_/d).toLngLat().lat,new u.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function ic(m,a,d,_,b,E,I){const A=m.context,R=A.gl,B=d.fbo;if(!B)return;m.prepareDrawTile();const z=m.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,B.colorAttachment.get());const H=((ne,re,G,ee)=>{const le=G.paint.get("hillshade-shadow-color"),ce=G.paint.get("hillshade-highlight-color"),be=G.paint.get("hillshade-accent-color");let Ee=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(Ee-=ne.transform.angle);const we=!ne.options.moving;return{u_matrix:ee||ne.transform.calculateProjMatrix(re.tileID.toUnwrapped(),we),u_image:0,u_latrange:jn(0,re.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Ee],u_shadow:le,u_highlight:ce,u_accent:be}})(m,d,_,m.terrain?a.projMatrix:null);m.prepareDrawProgram(A,z,a.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:te,tileBoundsSegments:ie}=m.getTileBoundsBuffers(d);z.draw(A,R.TRIANGLES,b,E,I,u.CullFaceMode.disabled,H,_.id,K,te,ie)}function rc(m,a,d){if(!a.needsDEMTextureUpload)return;const _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(d.stride);const E=d.getPixels();a.demTexture?a.demTexture.update(E,{premultiply:!1}):a.demTexture=new u.Texture(_,E,b.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function qr(m,a,d,_,b,E){const I=m.context,A=I.gl;if(!a.dem)return;const R=a.dem;if(I.activeTexture.set(A.TEXTURE1),rc(m,a,R),!a.demTexture)return;a.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const B=R.dim;I.activeTexture.set(A.TEXTURE0);let z=a.fbo;if(!z){const ie=new u.Texture(I,{width:B,height:B,data:null},A.RGBA);ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),z=a.fbo=I.createFramebuffer(B,B,!0),z.colorAttachment.set(ie.texture)}I.bindFramebuffer.set(z.framebuffer),I.viewport.set([0,0,B,B]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:te}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,b,E,u.CullFaceMode.disabled,((ie,ne)=>{const re=ne.stride,G=u.create();return u.ortho(G,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(G,G,[0,-u.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[re,re],u_zoom:ie.overscaledZ,u_unpack:ne.unpackVector}})(a.tileID,R),d.id,H,K,te),a.needsHillshadePrepare=!1}const $c=m=>({u_matrix:new u.UniformMatrix4f(m),u_image0:new u.Uniform1i(m),u_skirt_height:new u.Uniform1f(m)}),Ml=(m,a)=>({u_matrix:m,u_image0:0,u_skirt_height:a}),bi=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:I,u_frustum_tr:A,u_frustum_br:R,u_frustum_bl:B,u_globe_pos:z,u_globe_radius:H,u_viewport:K,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:te});function oc(m,a){return null!=m&&null!=a&&!(!m.hasData()||!a.hasData())&&null!=m.demTexture&&null!=a.demTexture&&m.tileID.key!==a.tileID.key}const Da=new class{constructor(){this.operations={}}newMorphing(m,a,d,_,b){if(m in this.operations){const E=this.operations[m];E.to.tileID.key!==d.tileID.key&&(E.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:b,from:a,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const d=this.operations[a];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},qt={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Sl(m){return 6*Math.pow(1.5,22-m)}function sc(m,a){const d=1<<m.z;return!a&&(0===m.x||m.x===d-1)||0===m.y||m.y===d-1}const Ya=m=>({u_matrix:m});function Ma(m,a,d,_,b){if(b>0){const E=u.exported.now(),I=(E-m.timeAdded)/b,A=a?(E-a.timeAdded)/b:-1,R=d.getSource(),B=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),z=!a||Math.abs(a.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),H=z&&m.refreshedUponExpiration?1:u.clamp(z?I:1-A,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Us extends u.SourceCache{constructor(a){const d={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new Ji(_a(),null),b=Dn("mock-dem",d,_,a.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,d){a.state="loaded",d(null)}}class Il extends u.SourceCache{constructor(a){const d=Dn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new Ji(_a(),null),a.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,d,_){if(a.freezeTileCoverage)return;this.transform=a;const b=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,I)=>{if(E[I.key]="",!this._tiles[I.key]){const A=new u.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);A.state="loaded",this._tiles[I.key]=A}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(a){const d=this.proxyCachedFBO[a];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ka extends u.OverscaledTileID{constructor(a,d,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Io extends u.Elevation{constructor(a,d){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,E]=function(R){const B=new u.StructArrayLayout2i4,z=new u.StructArrayLayout3ui6,H=131;B.reserve(17161),z.reserve(33800);const K=u.EXTENT/128,te=u.EXTENT+K/2,ie=te+K;for(let re=-K;re<ie;re+=K)for(let G=-K;G<ie;G+=K){const ee=G<0||G>te||re<0||re>te?24575:0,le=u.clamp(Math.round(G),0,u.EXTENT),ce=u.clamp(Math.round(re),0,u.EXTENT);B.emplaceBack(le+ee,ce)}const ne=(re,G)=>{const ee=G*H+re;z.emplaceBack(ee+1,ee,ee+H),z.emplaceBack(ee+H,ee+H+1,ee+1)};for(let re=1;re<129;re++)for(let G=1;G<129;G++)ne(G,re);return[0,129].forEach(re=>{for(let G=0;G<130;G++)ne(G,re),ne(re,G)}),[B,z,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(_,u.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(b),this.gridSegments=u.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,_.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Il(d.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const A=I.gl;this._overlapStencilMode=new u.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Us(d.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,d,_){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const b=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const E=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(d,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(R=>{const B=d.getTileByID(R).tileID;return B.projMatrix=_.calculateProjMatrix(B.toUnwrapped()),B});(function(R,B){const z=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new u.Point(z.x,z.y);R.sort((K,te)=>{if(te.overscaledZ-K.overscaledZ)return te.overscaledZ-K.overscaledZ;const ie=new u.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ne=new u.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),re=H.mult(1<<K.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(ie)-re.distSqr(ne)})})(b,this.painter),this._previousZoom=_.zoom;const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const B=I[R];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,a[R],E),B.usedForTerrain))continue;const z=a[R];B.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[d.id]=b.map(R=>new Ka(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const B=this.terrainTileForTile[R.key];if(!B)continue;const z=B.tileID.key;z in A||(this._visibleDemTiles.push(B),A[z]=z)}}_assignTerrainTiles(a){this._initializing||a.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,d=a.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(a.activeTexture.set(d.TEXTURE1),rc(this.painter,b,E))}}_prepareDemTileUniforms(a,d,_,b){if(!d||null==d.demTexture)return!1;const E=a.tileID.canonical,I=Math.pow(2,d.tileID.canonical.z-E.z),A=b||"";return _[`u_dem_tl${A}`]=[E.x*I%1,E.y*I%1],_[`u_dem_scale${A}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,d=a.gl;if(!this._emptyDepthBufferTexture){const _=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(a,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const E=b.dem.tree.minimums[0];return E>0&&a++,_+E},0);return a?d/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,d=a.gl;a.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new u.Texture(a,b,d.RGBA,{premultiply:!1}),E}setupElevationDraw(a,d,_){const b=this.painter.context,E=b.gl,I=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let R=null,B=null,z=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,K=_.morphing.dstDemTile;z=_.morphing.phase,H&&K&&(this._prepareDemTileUniforms(a,H,I,"_prev")&&(B=H),this._prepareDemTileUniforms(a,K,I)&&(R=K))}if(B&&R?(b.activeTexture.set(E.TEXTURE2),R.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),B.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),I.u_dem_lerp=z):(R=this.terrainTileForTile[a.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(a,R,I)?R.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const H=(1<<R.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=H}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,I),"globe"===this.painter.transform.projection.name){const H=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,H)}}globeUniformValues(a,d,_){const b=a.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,u.EXTENT,0),u_tile_br_up:b.upVector(d,u.EXTENT,u.EXTENT),u_tile_bl_up:b.upVector(d,0,u.EXTENT),u_tile_up_scale:_?u.globeMetersToEcef(1):b.upVectorScale(d,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const d=this.painter,_=this.painter.context;0!==a.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,I,A,R){if("globe"===b.transform.projection.name)!function(B,z,H,K,te){const ie=B.context,ne=ie.gl;let re,G;const ee=B.options.showTerrainWireframe?2:0,le=B.transform,ce=u.globeUseCustomAntiAliasing(B,ie,le),be=(gt,He)=>{if(G===gt)return;const rt=[qt[gt],"PROJECTION_GLOBE_VIEW"];ce&&rt.push("CUSTOM_ANTIALIASING"),He&&rt.push(qt[ee]),re=B.useProgram("globeRaster",null,rt),G=gt},Ee=B.colorModeForRenderPass(),we=new u.DepthMode(ne.LEQUAL,u.DepthMode.ReadWrite,B.depthRangeFor3D);Da.update(te);const ke=u.calculateGlobeMercatorMatrix(le),Ie=[u.mercatorXfromLng(le.center.lng),u.mercatorYfromLat(le.center.lat)],Ge=ee?[!1,!0]:[!1],vt=B.globeSharedBuffers,Be=[le.width*u.exported.devicePixelRatio,le.height*u.exported.devicePixelRatio],st=Float32Array.from(le.globeMatrix),Xe={useDenormalizedUpVectorScale:!0};if(Ge.forEach(gt=>{const He=B.transform,rt=Sl(He.zoom)*z.exaggeration();G=-1;const wt=gt?ne.LINES:ne.TRIANGLES;for(const ut of K){const Tt=H.getTile(ut),ln=u.StencilMode.disabled,Pn=z.prevTerrainTileForTile[ut.key],Jt=z.terrainTileForTile[ut.key];oc(Pn,Jt)&&Da.newMorphing(ut.key,Pn,Jt,te,250),ie.activeTexture.set(ne.TEXTURE0),Tt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const vn=Da.getMorphValuesForProxy(ut.key),Kn=vn?1:0;vn&&u.extend$1(Xe,{morphing:{srcDemTile:vn.from,dstDemTile:vn.to,phase:u.easeCubicInOut(vn.phase)}});const Yn=u.tileCornersToBounds(ut.canonical),Wt=u.getLatitudinalLod(Yn.getCenter().lat),xi=u.getGridMatrix(ut.canonical,Yn,Wt,He.worldSize/He._pixelsPerMercatorPixel),Pi=u.globeNormalizeECEF(u.globeTileBounds(ut.canonical)),Ri=bi(He.projMatrix,st,ke,Pi,u.globeToMercatorTransition(He.zoom),Ie,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,Be,rt,xi);if(be(Kn,gt),z.setupElevationDraw(Tt,re,Xe),B.prepareDrawProgram(ie,re,ut.toUnwrapped()),vt){const[Ei,po,oo]=gt?vt.getWirefameBuffers(B.context,Wt):vt.getGridBuffers(Wt,0!==rt);re.draw(ie,wt,we,ln,Ee,u.CullFaceMode.backCCW,Ri,"globe_raster",Ei,po,oo)}}}),vt){const gt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&gt.push("CUSTOM_ANTIALIASING"),re=B.useProgram("globeRaster",null,gt);for(const He of K){const{x:rt,y:wt,z:ut}=He.canonical,Tt=0===wt,ln=wt===(1<<ut)-1,[Pn,Jt,vn,Kn]=vt.getPoleBuffers(ut);if(Kn&&(Tt||ln)){const Yn=H.getTile(He);ie.activeTexture.set(ne.TEXTURE0),Yn.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Wt=u.globePoleMatrixForTile(ut,rt,le);const xi=u.globeNormalizeECEF(u.globeTileBounds(He.canonical)),Pi=(Ri,Ei)=>Ri.draw(ie,ne.TRIANGLES,we,u.StencilMode.disabled,Ee,u.CullFaceMode.disabled,bi(le.projMatrix,Wt,Wt,xi,0,Ie,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Be,0),"globe_pole_raster",Ei,vn,Kn);z.setupElevationDraw(Yn,re,Xe),B.prepareDrawProgram(ie,re,He.toUnwrapped()),Tt&&Pi(re,Pn),ln&&(Wt=u.scale(u.create(),Wt,[1,-1,1]),Pi(re,Jt))}}}}(b,E,I,A,R);else{const B=b.context,z=B.gl;let H,K;const te=b.options.showTerrainWireframe?2:0,ie=(le,ce)=>{if(K===le)return;const be=[qt[le]];ce&&be.push(qt[te]),H=b.useProgram("terrainRaster",null,be),K=le},ne=b.colorModeForRenderPass(),re=new u.DepthMode(z.LEQUAL,u.DepthMode.ReadWrite,b.depthRangeFor3D);Da.update(R);const G=b.transform,ee=Sl(G.zoom)*E.exaggeration();(te?[!1,!0]:[!1]).forEach(le=>{K=-1;const ce=le?z.LINES:z.TRIANGLES,[be,Ee]=le?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const we of A){const ke=I.getTile(we),Ie=u.StencilMode.disabled,Ge=E.prevTerrainTileForTile[we.key],vt=E.terrainTileForTile[we.key];oc(Ge,vt)&&Da.newMorphing(we.key,Ge,vt,R,250),B.activeTexture.set(z.TEXTURE0),ke.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Be=Da.getMorphValuesForProxy(we.key),st=Be?1:0;let Xe;Be&&(Xe={morphing:{srcDemTile:Be.from,dstDemTile:Be.to,phase:u.easeCubicInOut(Be.phase)}});const gt=Ml(we.projMatrix,sc(we.canonical,G.renderWorldCopies)?ee/10:ee);ie(st,le),E.setupElevationDraw(ke,H,Xe),b.prepareDrawProgram(B,H,we.toUnwrapped()),H.draw(B,ce,re,Ie,ne,u.CullFaceMode.backCCW,gt,"terrain_raster",E.gridBuffer,be,Ee)}})}}(d,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],I=this._drapedRenderBatches.shift(),A=[],R=d.style.order;let B=0;for(const z of E){const H=b.getTileByID(z.proxyTileKey),K=b.proxyCachedFBO[z.key]?b.proxyCachedFBO[z.key][a]:void 0,te=void 0!==K?b.renderCache[K]:this.pool[B++],ie=void 0!==K;if(H.texture=te.tex,ie&&!te.dirty){A.push(H.tileID);continue}let ne;_.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(_.clear({color:u.Color.transparent,stencil:0}),te.dirty=!1);for(let re=I.start;re<=I.end;++re){const G=d.style._layers[R[re]];if(G.isHidden(d.transform.zoom))continue;const ee=d.style._getLayerSourceCache(G),le=ee?this.proxyToSource[z.key][ee.id]:[z];if(!le)continue;const ce=le;_.viewport.set([0,0,te.fb.width,te.fb.height]),ne!==(ee?ee.id:null)&&(this._setupStencil(te,le,G,ee),ne=ee?ee.id:null),d.renderLayer(d,ee,G,ce)}this.renderedToTile?(te.dirty=!0,A.push(H.tileID)):ie||--B,5===B&&(B=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const d=a.order.length;if(0===d)return{efficiency:100};let _,b=0,E=0,I=!1;for(let A=0;A<d;++A){const R=a._layers[a.order[A]];this._style.isLayerDraped(R)?(I&&++b,++E):I||(I=!0,_=R.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{a=Math.min(a,d.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,d,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const I=E.tileID,A=1<<I.overscaledZ,{x:R,y:B}=I.canonical,z=R/A,H=(R+1)/A,K=B/A,te=(B+1)/A;return{minx:z,miny:K,maxx:H,maxy:te,t:E.dem.tree.raycastRoot(z,K,H,te,a,d,_),tile:E}});b.sort((E,I)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const E of b){if(null==E.t)return null;const I=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,a,d,_);if(null!=I)return I}return null}_createFBO(){const a=this.painter.context,d=a.gl,_=this.drapeBufferSize;a.activeTexture.set(d.TEXTURE0);const b=new u.Texture(a,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const E=a.createFramebuffer(_[0],_[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new Ce(a,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const d=this._style._layers[a],_=d.isHidden(this.painter.transform.zoom);return"custom"===d.type?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const _ of this._style._getSources())if(_ instanceof Ot){a=!0;break}if(!a)return;const d={};for(let _=0;_<this._style.order.length;++_){const b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(E&&!d[E.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof u.ZoomDependentExpression){d[E.id]=!0;for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][E.id];if(A)for(const R of A)this._clearRenderCacheForTile(E.id,R)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof xt){a=!0;break}if(!a)return;const d={};for(let _=0;_<this._style.order.length;++_){const b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(!E||d[E.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const I=b.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][E.id];if(R)for(const B of R){const z=Ma(E.getTile(B),E.findLoadedParent(B,0),E,this.painter.transform,I);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(E.id,B)}}}}_setupDrapedRenderBatches(){const a=this._style.order,d=a.length;if(0===d)return;const _=[];let b,E=0,I=this._style._layers[a[E]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++E<d;)I=this._style._layers[a[E]];for(;E<d;++E){const A=this._style._layers[a[E]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===b&&(b=E):void 0!==b&&(_.push({start:b,end:E-1}),b=void 0))}void 0!==b&&_.push({start:b,end:E-1}),this._drapedRenderBatches=_}_setupRenderCache(a){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const I=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let A=0;A<I.length;++A){const R=Object.values(I[A]);d.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const A=_[I];if(d.getTileByID(A.key),void 0!==d.proxyCachedFBO[A.key]){const R=a[A.key],B=this.proxyToSource[A.key];let z=0;for(const H in B){const K=B[H],te=R[H];if(!te||te.length!==K.length||K.some((ie,ne)=>ie!==te[ne]||b[H]&&b[H].hasOwnProperty(ie.key))){z=-1;break}++z}for(const H in d.proxyCachedFBO[A.key])d.renderCache[d.proxyCachedFBO[A.key][H]].dirty=z<0||z!==Object.values(R).length}}const E=[...this._drapedRenderBatches];E.sort((I,A)=>A.end-A.start-(I.end-I.start));for(const I of E)for(const A of _){if(d.proxyCachedFBO[A.key])continue;let R=d.renderCachePool.pop();void 0===R&&d.renderCache.length<50&&(R=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==R&&(d.proxyCachedFBO[A.key]={},d.proxyCachedFBO[A.key][I.start]=R,d.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(a,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,I=E.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=d.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(a,d){const _=this.painter,b=this.painter.context,E=b.gl;_._tileClippingMaskIDs={},b.setColorMode(u.ColorMode.disabled),b.setDepthMode(u.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const A of a){const R=_._tileClippingMaskIDs[A.key]=--d;I.draw(b,E.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:E.ALWAYS,mask:0},R,255,E.KEEP,E.KEEP,E.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Ya(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const d=this.painter.transform;if(a.x<0||a.x>d.width||a.y<0||a.y>d.height)return null;const _=[a.x,a.y,1,1];u.transformMat4$1(_,_,d.pixelMatrixInverse),u.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const b=d._camera.position,E=u.mercatorZfromAltitude(1,d.center.lat),I=[b[0],b[1],b[2]/E,0],A=u.subtract([],_.slice(0,3),I);u.normalize(A,A);const R=this.raycast(I,A,this._exaggeration);return null!==R&&R?(u.scaleAndAdd(I,I,A,R),I[3]=I[2],I[2]*=E,I):null}drawDepth(){const a=this.painter,d=a.context,_=this.proxySourceCache,b=Math.ceil(a.width),E=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=d.gl,A=d.createFramebuffer(b,E,!0);d.activeTexture.set(I.TEXTURE0);const R=new u.Texture(d,{width:b,height:E,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),A.colorAttachment.set(R.texture);const B=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,E);A.depthAttachment.set(B),this._depthFBO=A,this._depthTexture=R}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,E]),function(I,A,R,B){if("globe"===I.transform.projection.name)return;const z=I.context,H=z.gl;z.clear({depth:1});const K=I.useProgram("terrainDepth"),te=new u.DepthMode(H.LESS,u.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ie of B){const ne=R.getTile(ie),re=Ml(ie.projMatrix,0);A.setupElevationDraw(ne,K),K.draw(z,H.TRIANGLES,te,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,re,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,d,_){if(a.getSource()instanceof Hn)return this._setupProxiedCoordsForImageSource(a,d,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords;for(let A=0;A<E.length;A++){const R=E[A],B=this._findTileCoveringTileID(R,a);if(B){const z=this._createProxiedId(R,B,_[R.key]&&_[R.key][a.id]);b.push(z),this.proxyToSource[R.key][a.id]=[z]}}let I=!1;for(let A=0;A<d.length;A++){const R=a.getTile(d[A]);if(!R||!R.hasData())continue;const B=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[B.tileID.key][a.id],H=this._createProxiedId(B.tileID,R,_[B.tileID.key]&&_[B.tileID.key][a.id]);z?z.splice(z.length-1,0,H):this.proxyToSource[B.tileID.key][a.id]=[H],b.push(H),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,d,_){if(!a.getSource().loaded())return;const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords,I=a.getSource(),A=new u.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((z,H)=>(z.min.x=Math.min(z.min.x,H.x-A.x),z.min.y=Math.min(z.min.y,H.y-A.y),z.max.x=Math.max(z.max.x,H.x-A.x),z.max.y=Math.max(z.max.y,H.y-A.y),z),{min:new u.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(z,H)=>{const K=z.wrap+z.canonical.x/(1<<z.canonical.z),te=z.canonical.y/(1<<z.canonical.z),ie=u.EXTENT/(1<<z.canonical.z),ne=H.wrap+H.canonical.x/(1<<H.canonical.z),re=H.canonical.y/(1<<H.canonical.z);return K+ie<ne+R.min.x||K>ne+R.max.x||te+ie<re+R.min.y||te>re+R.max.y};for(let z=0;z<E.length;z++){const H=E[z];for(let K=0;K<d.length;K++){const te=a.getTile(d[K]);if(!te||!te.hasData()||B(H,te.tileID))continue;const ie=this._createProxiedId(H,te,_[H.key]&&_[H.key][a.id]),ne=this.proxyToSource[H.key][a.id];ne?ne.push(ie):this.proxyToSource[H.key][a.id]=[ie],b.push(ie)}}}_createProxiedId(a,d,_){let b=this.orthoMatrix;if(_){const E=_.find(I=>I.key===d.tileID.key);if(E)return E}if(d.tileID.key!==a.key){const E=a.canonical.z-d.tileID.canonical.z;let I,A,R;b=u.create();const B=d.tileID.wrap-a.wrap<<a.overscaledZ;E>0?(I=u.EXTENT>>E,A=I*((d.tileID.canonical.x<<E)-a.canonical.x+B),R=I*((d.tileID.canonical.y<<E)-a.canonical.y)):(I=u.EXTENT<<-E,A=u.EXTENT*(d.tileID.canonical.x-(a.canonical.x+B<<-E)),R=u.EXTENT*(d.tileID.canonical.y-(a.canonical.y<<-E))),u.ortho(b,0,I,0,I,0,1),u.translate(b,b,[A,R,0])}return new Ka(d.tileID,a.key,b)}_findTileCoveringTileID(a,d){let _=d.getTile(a);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[d.id],E=b[a.key];if(_=E?d.getTileByID(E):null,_&&_.hasData()||null===E)return _;let I=_?_.tileID:a,A=I.overscaledZ;const R=d.getSource().minzoom,B=[];if(!E){const H=d.getSource().maxzoom;if(a.canonical.z>=H){const K=a.canonical.z-H;d.getSource().reparseOverscaled?(A=Math.max(a.canonical.z+2,d.transform.tileZoom),I=new u.OverscaledTileID(A,a.wrap,H,a.canonical.x>>K,a.canonical.y>>K)):0!==K&&(A=H,I=new u.OverscaledTileID(A,a.wrap,H,a.canonical.x>>K,a.canonical.y>>K))}I.key!==a.key&&(B.push(I.key),_=d.getTile(I))}const z=H=>{B.forEach(K=>{b[K]=H}),B.length=0};for(A-=1;A>=R&&(!_||!_.hasData());A--){_&&z(_.tileID.key);const H=I.calculateScaledKey(A);if(_=d.getTileByID(H),_&&_.hasData())break;const K=b[H];if(null===K)break;void 0===K?B.push(H):_=d.getTileByID(K)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,d){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(d){let _=0;const b=new u.StructArrayLayout2ui4,E=131;for(let I=1;I<129;I++){for(let A=1;A<129;A++)_=I*E+A,b.emplaceBack(_,_+1),b.emplaceBack(_,_+E),b.emplaceBack(_+1,_+E),128===I&&b.emplaceBack(_+E,_+E+1);b.emplaceBack(_+1,_+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class oi{static cacheKey(a,d,_,b){let E=`${d}${b?b.cacheKey:""}`;for(const I of _)a.usedDefines.includes(I)&&(E+=`/${I}`);return E}constructor(a,d,_,b,E,I){const A=a.gl;this.program=A.createProgram();const R=function(G){const ee=[];for(let le=0;le<G.length;le++){if(null===G[le])continue;const ce=G[le].split(" ");ee.push(ce.pop())}return ee}(_.staticAttributes),B=b?b.getBinderAttributes():[],z=R.concat(B);let H=b?b.defines():[];H=H.concat(I.map(G=>`#define ${G}`));const K=a.isWebGL2?"#version 300 es\n":"",te=K+H.concat(a.extStandardDerivatives&&0===K.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Ta):Ta,Ta,jc,Au.fragmentSource,Vs.fragmentSource,_.fragmentSource).join("\n"),ie=K+H.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",jc,Au.vertexSource,Vs.vertexSource,Rr.vertexSource,_.vertexSource).join("\n"),ne=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ne,te),A.compileShader(ne),A.attachShader(this.program,ne);const re=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(re,ie),A.compileShader(re),A.attachShader(this.program,re),this.attributes={},this.numAttributes=z.length;for(let G=0;G<this.numAttributes;G++)z[G]&&(A.bindAttribLocation(this.program,G,z[G]),this.attributes[z[G]]=G);A.linkProgram(this.program),A.deleteShader(re),A.deleteShader(ne),this.fixedUniforms=E(a),this.binderUniforms=b?b.getUniforms(a):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(G=a),u_dem_prev:new u.Uniform1i(G),u_dem_unpack:new u.Uniform4f(G),u_dem_tl:new u.Uniform2f(G),u_dem_scale:new u.Uniform1f(G),u_dem_tl_prev:new u.Uniform2f(G),u_dem_scale_prev:new u.Uniform1f(G),u_dem_size:new u.Uniform1f(G),u_dem_lerp:new u.Uniform1f(G),u_exaggeration:new u.Uniform1f(G),u_depth:new u.Uniform1i(G),u_depth_size_inv:new u.Uniform2f(G),u_meter_to_dem:new u.Uniform1f(G),u_label_plane_matrix_inv:new u.UniformMatrix4f(G)}),I.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new u.Uniform3f(G),u_tile_tr_up:new u.Uniform3f(G),u_tile_br_up:new u.Uniform3f(G),u_tile_bl_up:new u.Uniform3f(G),u_tile_up_scale:new u.Uniform1f(G)}))(a)),I.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new u.UniformMatrix4f(G),u_fog_range:new u.Uniform2f(G),u_fog_color:new u.Uniform4f(G),u_fog_horizon_blend:new u.Uniform1f(G),u_fog_temporal_offset:new u.Uniform1f(G),u_frustum_tl:new u.Uniform3f(G),u_frustum_tr:new u.Uniform3f(G),u_frustum_br:new u.Uniform3f(G),u_frustum_bl:new u.Uniform3f(G),u_globe_pos:new u.Uniform3f(G),u_globe_radius:new u.Uniform1f(G),u_globe_transition:new u.Uniform1f(G),u_is_globe:new u.Uniform1i(G),u_viewport:new u.Uniform2f(G)}))(a))}var G}setTerrainUniformValues(a,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in d)_[b]&&_[b].set(this.program,b,d[b])}}setGlobeUniformValues(a,d){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in d)_[b]&&_[b].set(this.program,b,d[b])}}setFogUniformValues(a,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in d)_[b].set(this.program,b,d[b])}}draw(a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const re=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(b),a.setColorMode(E),a.setCullFace(I);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,A[ee]);ie&&ie.setUniforms(this.program,a,this.binderUniforms,K,{zoom:te});const G={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[d];for(const ee of H.get()){const le=ee.vaos||(ee.vaos={});(le[R]||(le[R]=new Mh)).bind(a,this,B,ie?ie.getPaintVertexBuffers():[],z,ee.vertexOffset,ne||[]),re.drawElements(d,ee.primitiveLength*G,re.UNSIGNED_SHORT,ee.primitiveOffset*G*2)}}}function ac(m,a){const d=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,m.transform.tileZoom)/d,b=_*(a.tileID.canonical.x+a.tileID.wrap*d),E=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/un(a,1,m.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Rd=u.create(),js=(m,a,d,_,b,E,I,A,R,B,z)=>{const H=a.style.light,K=H.properties.get("position"),te=[K.x,K.y,K.z],ie=u.create$1();"viewport"===H.properties.get("anchor")&&(u.fromRotation(ie,-a.transform.angle),u.transformMat3(te,te,ie));const ne=H.properties.get("color"),re=a.transform,G={u_matrix:m,u_lightpos:te,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return"globe"===re.projection.name&&(G.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=z,G.u_merc_center=B,G.u_up_dir=re.projection.upVector(new u.CanonicalTileID(0,0,0),B[0]*u.EXTENT,B[1]*u.EXTENT),G.u_height_lift=A),G},Al=(m,a,d,_,b,E,I,A,R,B,z,H)=>{const K=js(m,a,d,_,b,E,I,R,B,z,H),te={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return u.extend(K,ac(a,A),te)},fs=m=>({u_matrix:m}),Pu=(m,a,d)=>u.extend(fs(m),ac(a,d)),Sh=(m,a)=>({u_matrix:m,u_world:a}),Ld=(m,a,d,_)=>u.extend(Pu(m,a,d),{u_world:_}),Uo=u.create(),Ao=(m,a,d,_,b,E)=>{const I=m.transform,A="globe"===I.projection.name;let R;if("map"===E.paint.get("circle-pitch-alignment"))if(A){const z=u.globePixelsToTileUnits(I.zoom,a.canonical)*I._pixelsPerMercatorPixel;R=Float32Array.from([z,0,0,z])}else R=I.calculatePixelsToTileUnitsMatrix(d);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:m.translatePosMatrix(a.projMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Uo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){B.u_inv_rot_matrix=_,B.u_merc_center=b,B.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],B.u_zoom_transition=u.globeToMercatorTransition(I.zoom);const z=b[0]*u.EXTENT,H=b[1]*u.EXTENT;B.u_up_dir=I.projection.upVector(new u.CanonicalTileID(0,0,0),z,H)}return B},Ru=m=>{const a=[];return"map"===m.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},zr=(m,a,d,_)=>{const b=u.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/b,a.pixelsToGLUnits[1]/b]}},Hc=(m,a,d=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:d}),rn=u.create(),Lu=(m,a,d,_,b,E,I)=>{const A=m.transform,R="globe"===A.projection.name,B=R?u.globePixelsToTileUnits(A.zoom,a.canonical)*A._pixelsPerMercatorPixel:un(d,1,E),z={u_matrix:a.projMatrix,u_extrude_scale:B,u_intensity:I,u_inv_rot_matrix:rn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){z.u_inv_rot_matrix=_,z.u_merc_center=b,z.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],z.u_zoom_transition=u.globeToMercatorTransition(A.zoom);const H=b[0]*u.EXTENT,K=b[1]*u.EXTENT;z.u_up_dir=A.projection.upVector(new u.CanonicalTileID(0,0,0),H,K)}return z},Qt=(m,a,d,_,b,E,I)=>{const A=m.transform,R=A.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:Ja(m,a,d,_),u_pixels_to_tile_units:R,u_device_pixel_ratio:E,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:jo(d)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:is(a,m.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},$s=(m,a,d,_,b)=>{const E=m.transform;return{u_matrix:Ja(m,a,d,_),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:is(a,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function is(m,a){return 1/un(m,1,a.tileZoom)}function Ja(m,a,d,_){return m.translatePosMatrix(_||a.tileID.projMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function jo(m){const a=m.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const Pl=(m,a,d,_,b,E)=>{return{u_matrix:m,u_tl_parent:a,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(I=b.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:ps(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var I,A};function ps(m){m*=Math.PI/180;const a=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const xo=u.create(),Rl=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne)=>{const re=b.transform,G={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:re.width/re.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+_,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xo,u_up_vector:[0,-1,0]};return"globe"===ne.name&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=H,G.u_inv_rot_matrix=te,G.u_merc_center=K,G.u_camera_forward=re._camera.forward(),G.u_ecef_origin=u.globeECEFOrigin(re.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(re.globeMatrix),G.u_up_vector=ie),G},pr=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re)=>u.extend(Rl(m,a,d,_,b,E,I,A,R,B,H,K,te,ie,ne,re),{u_gamma_scale:_?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+z}),rs=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne)=>u.extend(pr(m,a,d,_,b,E,I,A,!0,R,!0,z,H,K,te,ie,ne),{u_texsize_icon:B,u_texture_icon:1}),Qn=(m,a,d)=>({u_matrix:m,u_opacity:a,u_color:d}),Gc=(m,a,d,_,b)=>u.extend(function(E,I,A){const R=I.imageManager.getPattern(E.toString()),{width:B,height:z}=I.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),K=A.tileSize*Math.pow(2,I.transform.tileZoom)/H,te=K*(A.tileID.canonical.x+A.tileID.wrap*H),ie=K*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[B,z],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/un(A,1,I.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}}(_,d,b),{u_matrix:m,u_opacity:a}),Po={fillExtrusion:m=>({u_matrix:new u.UniformMatrix4f(m),u_lightpos:new u.Uniform3f(m),u_lightintensity:new u.Uniform1f(m),u_lightcolor:new u.Uniform3f(m),u_vertical_gradient:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_edge_radius:new u.Uniform1f(m),u_ao:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_up_dir:new u.Uniform3f(m),u_height_lift:new u.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_lightpos:new u.Uniform3f(m),u_lightintensity:new u.Uniform1f(m),u_lightcolor:new u.Uniform3f(m),u_vertical_gradient:new u.Uniform1f(m),u_height_factor:new u.Uniform1f(m),u_edge_radius:new u.Uniform1f(m),u_ao:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_up_dir:new u.Uniform3f(m),u_height_lift:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m)}),fill:m=>({u_matrix:new u.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),fillOutline:m=>({u_matrix:new u.UniformMatrix4f(m),u_world:new u.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_world:new u.Uniform2f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new u.Uniform1f(m),u_extrude_scale:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_up_dir:new u.Uniform3f(m)}),collisionBox:m=>({u_matrix:new u.UniformMatrix4f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_extrude_scale:new u.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new u.UniformMatrix4f(m),u_inv_matrix:new u.UniformMatrix4f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_viewport_size:new u.Uniform2f(m)}),debug:m=>({u_color:new u.UniformColor(m),u_matrix:new u.UniformMatrix4f(m),u_overlay:new u.Uniform1i(m),u_overlay_scale:new u.Uniform1f(m)}),clippingMask:m=>({u_matrix:new u.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new u.Uniform1f(m),u_intensity:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_up_dir:new u.Uniform3f(m)}),heatmapTexture:m=>({u_image:new u.Uniform1i(m),u_color_ramp:new u.Uniform1i(m),u_opacity:new u.Uniform1f(m)}),hillshade:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_latrange:new u.Uniform2f(m),u_light:new u.Uniform2f(m),u_shadow:new u.UniformColor(m),u_highlight:new u.UniformColor(m),u_accent:new u.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_dimension:new u.Uniform2f(m),u_zoom:new u.Uniform1f(m),u_unpack:new u.Uniform4f(m)}),line:m=>({u_matrix:new u.UniformMatrix4f(m),u_pixels_to_tile_units:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_units_to_pixels:new u.Uniform2f(m),u_dash_image:new u.Uniform1i(m),u_gradient_image:new u.Uniform1i(m),u_image_height:new u.Uniform1f(m),u_texsize:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_alpha_discard_threshold:new u.Uniform1f(m),u_trim_offset:new u.Uniform2f(m)}),linePattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_texsize:new u.Uniform2f(m),u_pixels_to_tile_units:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_units_to_pixels:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_alpha_discard_threshold:new u.Uniform1f(m)}),raster:m=>({u_matrix:new u.UniformMatrix4f(m),u_tl_parent:new u.Uniform2f(m),u_scale_parent:new u.Uniform1f(m),u_fade_t:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_image0:new u.Uniform1i(m),u_image1:new u.Uniform1i(m),u_brightness_low:new u.Uniform1f(m),u_brightness_high:new u.Uniform1f(m),u_saturation_factor:new u.Uniform1f(m),u_contrast_factor:new u.Uniform1f(m),u_spin_weights:new u.Uniform3f(m),u_perspective_transform:new u.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_camera_forward:new u.Uniform3f(m),u_tile_matrix:new u.UniformMatrix4f(m),u_up_vector:new u.Uniform3f(m),u_ecef_origin:new u.Uniform3f(m),u_texture:new u.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_texture:new u.Uniform1i(m),u_gamma_scale:new u.Uniform1f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_camera_forward:new u.Uniform3f(m),u_tile_matrix:new u.UniformMatrix4f(m),u_up_vector:new u.Uniform3f(m),u_ecef_origin:new u.Uniform3f(m),u_is_halo:new u.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_texsize_icon:new u.Uniform2f(m),u_texture:new u.Uniform1i(m),u_texture_icon:new u.Uniform1i(m),u_gamma_scale:new u.Uniform1f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_is_halo:new u.Uniform1i(m)}),background:m=>({u_matrix:new u.UniformMatrix4f(m),u_opacity:new u.Uniform1f(m),u_color:new u.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_opacity:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_pattern_tl:new u.Uniform2f(m),u_pattern_br:new u.Uniform2f(m),u_texsize:new u.Uniform2f(m),u_pattern_size:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),terrainRaster:$c,terrainDepth:$c,skybox:m=>({u_matrix:new u.UniformMatrix4f(m),u_sun_direction:new u.Uniform3f(m),u_cubemap:new u.Uniform1i(m),u_opacity:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new u.UniformMatrix4f(m),u_color_ramp:new u.Uniform1i(m),u_center_direction:new u.Uniform3f(m),u_radius:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new u.UniformMatrix3f(m),u_sun_direction:new u.Uniform3f(m),u_sun_intensity:new u.Uniform1f(m),u_color_tint_r:new u.Uniform4f(m),u_color_tint_m:new u.Uniform4f(m),u_luminance:new u.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new u.UniformMatrix4f(m),u_globe_matrix:new u.UniformMatrix4f(m),u_normalize_matrix:new u.UniformMatrix4f(m),u_merc_matrix:new u.UniformMatrix4f(m),u_zoom_transition:new u.Uniform1f(m),u_merc_center:new u.Uniform2f(m),u_image0:new u.Uniform1i(m),u_grid_matrix:new u.UniformMatrix3f(m),u_skirt_height:new u.Uniform1f(m),u_frustum_tl:new u.Uniform3f(m),u_frustum_tr:new u.Uniform3f(m),u_frustum_br:new u.Uniform3f(m),u_frustum_bl:new u.Uniform3f(m),u_globe_pos:new u.Uniform3f(m),u_globe_radius:new u.Uniform1f(m),u_viewport:new u.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new u.Uniform3f(m),u_frustum_tr:new u.Uniform3f(m),u_frustum_br:new u.Uniform3f(m),u_frustum_bl:new u.Uniform3f(m),u_horizon:new u.Uniform1f(m),u_transition:new u.Uniform1f(m),u_fadeout_range:new u.Uniform1f(m),u_color:new u.Uniform4f(m),u_high_color:new u.Uniform4f(m),u_space_color:new u.Uniform4f(m),u_star_intensity:new u.Uniform1f(m),u_star_density:new u.Uniform1f(m),u_star_size:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m),u_horizon_angle:new u.Uniform1f(m),u_rotation_matrix:new u.UniformMatrix4f(m)})};let Hs;function Qa(m,a,d,_,b,E,I){const A=m.context,R=A.gl,B=m.transform,z=m.useProgram("collisionBox"),H=[];let K=0,te=0;for(let ce=0;ce<_.length;ce++){const be=_[ce],Ee=a.getTile(be),we=Ee.getBucket(d);if(!we)continue;const ke=Un(be,we,B);let Ie=ke;0===b[0]&&0===b[1]||(Ie=m.translatePosMatrix(ke,Ee,b,E));const Ge=I?we.textCollisionBox:we.iconCollisionBox,vt=we.collisionCircleArray;if(vt.length>0){const Be=u.create(),st=Ie;u.mul(Be,we.placementInvProjMatrix,B.glCoordMatrix),u.mul(Be,Be,we.placementViewportMatrix),H.push({circleArray:vt,circleOffset:te,transform:st,invTransform:Be,projection:we.getProjection()}),K+=vt.length/4,te=K}Ge&&(m.terrain&&m.terrain.setupElevationDraw(Ee,z),z.draw(A,R.LINES,u.DepthMode.disabled,u.StencilMode.disabled,m.colorModeForRenderPass(),u.CullFaceMode.disabled,zr(Ie,B,Ee,we.getProjection()),d.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,B.zoom,null,[Ge.collisionVertexBuffer,Ge.collisionVertexBufferExt]))}if(!I||!H.length)return;const ie=m.useProgram("collisionCircle"),ne=new u.StructArrayLayout2f1f2i16;ne.resize(4*K),ne._trim();let re=0;for(const ce of H)for(let be=0;be<ce.circleArray.length/4;be++){const Ee=4*be,we=ce.circleArray[Ee+0],ke=ce.circleArray[Ee+1],Ie=ce.circleArray[Ee+2],Ge=ce.circleArray[Ee+3];ne.emplace(re++,we,ke,Ie,Ge,0),ne.emplace(re++,we,ke,Ie,Ge,1),ne.emplace(re++,we,ke,Ie,Ge,2),ne.emplace(re++,we,ke,Ie,Ge,3)}(!Hs||Hs.length<2*K)&&(Hs=function(ce){const be=2*ce,Ee=new u.StructArrayLayout3ui6;Ee.resize(be),Ee._trim();for(let we=0;we<be;we++){const ke=6*we;Ee.uint16[ke+0]=4*we+0,Ee.uint16[ke+1]=4*we+1,Ee.uint16[ke+2]=4*we+2,Ee.uint16[ke+3]=4*we+2,Ee.uint16[ke+4]=4*we+3,Ee.uint16[ke+5]=4*we+0}return Ee}(K));const G=A.createIndexBuffer(Hs,!0),ee=A.createVertexBuffer(ne,u.collisionCircleLayout.members,!0);for(const ce of H){const be={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(le=B).getCameraToCenterDistance(ce.projection),u_viewport_size:[le.width,le.height]};ie.draw(A,R.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,m.colorModeForRenderPass(),u.CullFaceMode.disabled,be,d.id,ee,G,u.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,B.zoom)}var le;ee.destroy(),G.destroy()}const $o=u.create();function ms({width:m,height:a,anchor:d,textOffset:_,textScale:b},E){const{horizontalAlign:I,verticalAlign:A}=u.getAnchorAlignment(d),R=-(I-.5)*m,B=-(A-.5)*a,z=u.evaluateVariableOffset(d,_);return new u.Point((R/b+z[0])*E,(B/b+z[1])*E)}function qc(m,a,d,_,b,E,I,A,R,B,z){const H=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,te=m.icon.dynamicLayoutVertexArray,ie={},ne=m.getProjection(),re=di(A,ne,E),G=E.elevation,ee=ne.upVectorScale(A.canonical,E.center.lat,E.worldSize).metersToTile;K.clear();for(let le=0;le<H.length;le++){const ce=H.get(le),{tileAnchorX:be,tileAnchorY:Ee,numGlyphs:we}=ce,ke=ce.hidden||!ce.crossTileID||m.allowVerticalPlacement&&!ce.placedOrientation?null:_[ce.crossTileID];if(ke){let Ie=0,Ge=0,vt=0;if(G){const Tt=G?G.getAtTileOffset(A,be,Ee):0,[ln,Pn,Jt]=ne.upVector(A.canonical,be,Ee);Ie=Tt*ln*ee,Ge=Tt*Pn*ee,vt=Tt*Jt*ee}let[Be,st,Xe,gt]=Ln(ce.projectedAnchorX+Ie,ce.projectedAnchorY+Ge,ce.projectedAnchorZ+vt,d?re:I);const He=Qi(E.getCameraToCenterDistance(ne),gt);let rt=b.evaluateSizeForFeature(m.textSizeData,B,ce)*He/u.ONE_EM;d&&(rt*=m.tilePixelRatio/R);const wt=ms(ke,rt);d?(({x:Be,y:st,z:Xe}=ne.projectTilePoint(be+wt.x,Ee+wt.y,A.canonical)),[Be,st,Xe]=Ln(Be+Ie,st+Ge,Xe+vt,I)):(a&&wt._rotate(-E.angle),Be+=wt.x,st+=wt.y,Xe=0);const ut=m.allowVerticalPlacement&&ce.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let Tt=0;Tt<we;Tt++)u.addDynamicAttributes(K,Be,st,Xe,ut);z&&ce.associatedIconIndex>=0&&(ie[ce.associatedIconIndex]={x:Be,y:st,z:Xe,angle:ut})}else er(we,K)}if(z){te.clear();const le=m.icon.placedSymbolArray;for(let ce=0;ce<le.length;ce++){const be=le.get(ce),{numGlyphs:Ee}=be,we=ie[ce];if(be.hidden||!we)er(Ee,te);else{const{x:ke,y:Ie,z:Ge,angle:vt}=we;for(let Be=0;Be<Ee;Be++)u.addDynamicAttributes(te,ke,Ie,Ge,vt)}}m.icon.dynamicLayoutVertexBuffer.updateData(te)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function el(m,a,d){return d.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Gs(m,a,d,_,b,E,I,A,R,B,z,H){const K=m.context,te=K.gl,ie=m.transform,ne="map"===A,re="map"===R,G=ne&&"point"!==d.layout.get("symbol-placement"),ee=ne&&!re&&!G,le=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let ce=!1;const be=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),Ee=[u.mercatorXfromLng(ie.center.lng),u.mercatorYfromLat(ie.center.lat)],we=d.layout.get("text-variable-anchor"),ke="globe"===ie.projection.name,Ie=[],Ge=[0,-1,0];let vt=Ge;!ke&&!ie.mercatorFromTransition||ne||(vt=function(Be){const st=Be._camera.getWorldToCamera(Be.worldSize,1),Xe=u.multiply([],st,Be.globeMatrix);u.invert(Xe,Xe);const gt=[0,0,0],He=[0,1,0,0];return u.transformMat4$1(He,He,Xe),gt[0]=He[0],gt[1]=He[1],gt[2]=He[2],u.normalize(gt,gt),gt}(ie));for(const Be of _){const st=a.getTile(Be),Xe=st.getBucket(d);if(!Xe||"mercator"===Xe.projection.name&&ke)continue;const gt=b?Xe.text:Xe.icon;if(!gt||Xe.fullyClipped||!gt.segments.get().length)continue;const He=gt.programConfigurations.get(d.id),rt=b||Xe.sdfIcons,wt=b?Xe.textSizeData:Xe.iconSizeData,ut=re||0!==ie.pitch,Tt=u.evaluateSizeForZoom(wt,ie.zoom);let ln,Pn,Jt,vn,Kn=[0,0],Yn=null;if(b)Pn=st.glyphAtlasTexture,Jt=te.LINEAR,ln=st.glyphAtlasTexture.size,Xe.iconsInText&&(Kn=st.imageAtlasTexture.size,Yn=st.imageAtlasTexture,vn=ut||m.options.rotating||m.options.zooming||"composite"===wt.kind||"camera"===wt.kind?te.LINEAR:te.NEAREST);else{const Or=1!==d.layout.get("icon-size").constantOr(0)||Xe.iconsNeedLinear;Pn=st.imageAtlasTexture,Jt=rt||m.options.rotating||m.options.zooming||Or||ut?te.LINEAR:te.NEAREST,ln=st.imageAtlasTexture.size}const Wt="globe"===Xe.projection.name,xi=Wt?vt:Ge,Pi=Wt?u.globeToMercatorTransition(ie.zoom):0,Ri=di(Be,Xe.getProjection(),ie),Ei=ie.calculatePixelsToTileUnitsMatrix(st),po=Je(Ri,st.tileID.canonical,re,ne,ie,Xe.getProjection(),Ei),oo=m.terrain&&re&&G?u.invert(u.create(),po):$o,qo=Wi(Ri,st.tileID.canonical,re,ne,ie,Xe.getProjection(),Ei),La=we&&Xe.hasTextData(),fi="none"!==d.layout.get("icon-text-fit")&&La&&Xe.hasIconData();if(G){const Or=ie.elevation,zl=Or?Or.getAtTileOffsetFunc(Be,ie.center.lat,ie.worldSize,Xe.getProjection()):null,mc=es(Ri,st.tileID.canonical,re,ne,ie,Xe.getProjection(),Ei);Ns(Xe,Ri,m,b,mc,qo,re,B,zl,Be)}const Ci=G||b&&we||fi,hi=m.translatePosMatrix(Ri,st,E,I),Wn=Ci?$o:po,mo=m.translatePosMatrix(qo,st,E,I,!0),Li=Xe.getProjection().createInversionMatrix(ie,Be.canonical),Xi=[];m.terrainRenderModeElevated()&&re&&Xi.push("PITCH_WITH_MAP_TERRAIN"),Wt&&Xi.push("PROJECTION_GLOBE_VIEW"),Ci&&Xi.push("PROJECTED_POS_ON_VIEWPORT");const Lh=rt&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let Fl;Fl=rt?Xe.iconsInText?rs(wt.kind,Tt,ee,re,m,hi,Wn,mo,ln,Kn,Be,Pi,Ee,Li,xi,Xe.getProjection()):pr(wt.kind,Tt,ee,re,m,hi,Wn,mo,b,ln,!0,Be,Pi,Ee,Li,xi,Xe.getProjection()):Rl(wt.kind,Tt,ee,re,m,hi,Wn,mo,b,ln,Be,Pi,Ee,Li,xi,Xe.getProjection());const ka={program:m.useProgram(el(rt,b,Xe),He,Xi),buffers:gt,uniformValues:Fl,atlasTexture:Pn,atlasTextureIcon:Yn,atlasInterpolation:Jt,atlasInterpolationIcon:vn,isSDF:rt,hasHalo:Lh,tile:st,labelPlaneMatrixInv:oo};if(le&&Xe.canOverlap){ce=!0;const Or=gt.segments.get();for(const zl of Or)Ie.push({segments:new u.SegmentVector([zl]),sortKey:zl.sortKey,state:ka})}else Ie.push({segments:gt.segments,sortKey:0,state:ka})}ce&&Ie.sort((Be,st)=>Be.sortKey-st.sortKey);for(const Be of Ie){const st=Be.state;if(m.terrain&&m.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:!ke,labelPlaneMatrixInv:st.labelPlaneMatrixInv}),K.activeTexture.set(te.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,te.CLAMP_TO_EDGE),st.atlasTextureIcon&&(K.activeTexture.set(te.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),st.isSDF){const Xe=st.uniformValues;st.hasHalo&&(Xe.u_is_halo=1,qs(st.buffers,Be.segments,d,m,st.program,be,z,H,Xe)),Xe.u_is_halo=0}qs(st.buffers,Be.segments,d,m,st.program,be,z,H,st.uniformValues)}}function qs(m,a,d,_,b,E,I,A,R){const B=_.context,z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];b.draw(B,B.gl.TRIANGLES,E,I,A,u.CullFaceMode.disabled,R,d.id,m.layoutVertexBuffer,m.indexBuffer,a,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),z)}function lc(m,a,d,_,b,E,I){const A=m.context.gl,R=d.paint.get("fill-pattern"),B=R&&R.constantOr(1);let z,H,K,te,ie;I?(H=B&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=A.LINES):(H=B?"fillPattern":"fill",z=A.TRIANGLES);for(const ne of _){const re=a.getTile(ne);if(B&&!re.patternsLoaded())continue;const G=re.getBucket(d);if(!G)continue;m.prepareDrawTile();const ee=G.programConfigurations.get(d.id),le=m.useProgram(H,ee);B&&(m.context.activeTexture.set(A.TEXTURE0),re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ee.updatePaintBuffers());const ce=R.constantOr(null);if(ce&&re.imageAtlas){const Ee=re.imageAtlas.patternPositions[ce.toString()];Ee&&ee.setConstantPatternPositions(Ee)}const be=m.translatePosMatrix(ne.projMatrix,re,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(I){te=G.indexBuffer2,ie=G.segments2;const Ee=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];K="fillOutlinePattern"===H&&B?Ld(be,m,re,Ee):Sh(be,Ee)}else te=G.indexBuffer,ie=G.segments,K=B?Pu(be,m,re):fs(be);m.prepareDrawProgram(m.context,le,ne.toUnwrapped()),le.draw(m.context,z,b,m.stencilModeForClipping(ne),E,u.CullFaceMode.disabled,K,d.id,G.layoutVertexBuffer,te,ie,d.paint,m.transform.zoom,ee)}}function Zs(m,a,d,_,b,E,I){const A=m.context,R=A.gl,B=m.transform,z=d.paint.get("fill-extrusion-pattern"),H=z.constantOr(1),K=d.paint.get("fill-extrusion-opacity"),te=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],ie=d.layout.get("fill-extrusion-edge-radius"),ne=ie>0&&!d.paint.get("fill-extrusion-rounded-roof"),re=ne?0:ie,G="globe"===B.projection.name?u.fillExtrusionHeightLift():0,ee="globe"===B.projection.name,le=ee?u.globeToMercatorTransition(B.zoom):0,ce=[u.mercatorXfromLng(B.center.lng),u.mercatorYfromLat(B.center.lat)],be=[];ee&&be.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&be.push("FAUX_AO"),ne&&be.push("ZERO_ROOF_RADIUS");for(const Ee of _){const we=a.getTile(Ee),ke=we.getBucket(d);if(!ke||ke.projection.name!==B.projection.name)continue;const Ie=ke.programConfigurations.get(d.id),Ge=m.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Ie,be);if(m.terrain){const rt=m.terrain;if(m.style.terrainSetForDrapingOnly())rt.setupElevationDraw(we,Ge,{useMeterToDem:!0});else{if(!ke.enableTerrain)continue;if(rt.setupElevationDraw(we,Ge,{useMeterToDem:!0}),ku(A,a,Ee,ke,d,rt),!ke.centroidVertexBuffer){const wt=Ge.attributes.a_centroid_pos;void 0!==wt&&R.vertexAttrib2f(wt,0,0)}}}H&&(m.context.activeTexture.set(R.TEXTURE0),we.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ie.updatePaintBuffers());const vt=z.constantOr(null);if(vt&&we.imageAtlas){const rt=we.imageAtlas.patternPositions[vt.toString()];rt&&Ie.setConstantPatternPositions(rt)}const Be=m.translatePosMatrix(Ee.projMatrix,we,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),st=B.projection.createInversionMatrix(B,Ee.canonical),Xe=d.paint.get("fill-extrusion-vertical-gradient"),gt=H?Al(Be,m,Xe,K,te,re,Ee,we,G,le,ce,st):js(Be,m,Xe,K,te,re,Ee,G,le,ce,st);m.prepareDrawProgram(A,Ge,Ee.toUnwrapped());const He=[];m.terrain&&He.push(ke.centroidVertexBuffer),ee&&He.push(ke.layoutVertexExtBuffer),Ge.draw(A,A.gl.TRIANGLES,b,E,I,u.CullFaceMode.backCCW,gt,d.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,d.paint,m.transform.zoom,Ie,He)}}function ku(m,a,d,_,b,E){const I=[G=>{let ee=G.canonical.x-1,le=G.wrap;return ee<0&&(ee=(1<<G.canonical.z)-1,le--),new u.OverscaledTileID(G.overscaledZ,le,G.canonical.z,ee,G.canonical.y)},G=>{let ee=G.canonical.x+1,le=G.wrap;return ee===1<<G.canonical.z&&(ee=0,le++),new u.OverscaledTileID(G.overscaledZ,le,G.canonical.z,ee,G.canonical.y)},G=>new u.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new u.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],A=G=>{const ee=a.getSource().minzoom,le=be=>{const Ee=a.getTileByID(be);if(Ee&&Ee.hasData())return Ee.getBucket(b)},ce=[0,-1,1];for(const be of ce){if(G.overscaledZ+be<ee)continue;const Ee=le(G.calculateScaledKey(G.overscaledZ+be));if(Ee)return Ee}},R=[0,0,0],B=(G,ee)=>(R[0]=Math.min(G.min.y,ee.min.y),R[1]=Math.max(G.max.y,ee.max.y),R[2]=u.EXTENT-ee.min.x>G.max.x?ee.min.x-u.EXTENT:G.max.x,R),z=(G,ee)=>(R[0]=Math.min(G.min.x,ee.min.x),R[1]=Math.max(G.max.x,ee.max.x),R[2]=u.EXTENT-ee.min.y>G.max.y?ee.min.y-u.EXTENT:G.max.y,R),H=[(G,ee)=>B(G,ee),(G,ee)=>B(ee,G),(G,ee)=>z(G,ee),(G,ee)=>z(ee,G)],K=new u.Point(0,0);let te,ie,ne;const re=(G,ee,le,ce,be)=>{const Ee=[[ce?le:G,ce?G:le,0],[ce?le:ee,ce?ee:le,0]],we=be<0?u.EXTENT+be:be,ke=[ce?we:(G+ee)/2,ce?(G+ee)/2:we,0];return 0===le&&be<0||0!==le&&be>0?E.getForTilePoints(ne,[ke],!0,ie):Ee.push(ke),E.getForTilePoints(d,Ee,!0,te),Math.max(Ee[0][2],Ee[1][2],ke[2])/E.exaggeration()};for(let G=0;G<4;G++){const ee=(G<2?1:5)-G,le=_.borders[G];if(0===le.length)continue;const ce=ne=I[G](d),be=A(ce);if(!(be&&be instanceof u.FillExtrusionBucket&&be.enableTerrain)||_.borderDoneWithNeighborZ[G]===be.canonical.z&&be.borderDoneWithNeighborZ[ee]===_.canonical.z||(ie=E.findDEMTileFor(ce),!ie||!ie.dem))continue;if(!te){const Ie=E.findDEMTileFor(d);if(!Ie||!Ie.dem)return;te=Ie}const Ee=be.borders[ee];let we=0;const ke=be.borderDoneWithNeighborZ[ee]!==_.canonical.z;if(_.canonical.z===be.canonical.z){for(let Ie=0;Ie<le.length;Ie++){const Ge=_.featuresOnBorder[le[Ie]],vt=Ge.borders[G];let Be;for(;we<Ee.length&&(Be=be.featuresOnBorder[Ee[we]],!(Be.borders[ee][1]>vt[0]+3));)ke&&be.encodeCentroid(void 0,Be,!1),we++;if(Be&&we<Ee.length){const st=we;let Xe=0;for(;!(Be.borders[ee][0]>vt[1]-3)&&(Xe++,++we!==Ee.length);)Be=be.featuresOnBorder[Ee[we]];if(Be=be.featuresOnBorder[Ee[st]],Ge.intersectsCount()>1||Be.intersectsCount()>1||1!==Xe){1!==Xe&&(we=st),_.encodeCentroid(void 0,Ge,!1),ke&&be.encodeCentroid(void 0,Be,!1);continue}const gt=H[G](Ge,Be),He=G%2?u.EXTENT-1:0;K.x=re(gt[0],Math.min(u.EXTENT-1,gt[1]),He,G<2,gt[2]),K.y=0,_.encodeCentroid(K,Ge,!1),ke&&be.encodeCentroid(K,Be,!1)}else _.encodeCentroid(void 0,Ge,!1)}_.borderDoneWithNeighborZ[G]=be.canonical.z,_.needsCentroidUpdate=!0,ke&&(be.borderDoneWithNeighborZ[ee]=_.canonical.z,be.needsCentroidUpdate=!0)}else{for(const Ie of le)_.encodeCentroid(void 0,_.featuresOnBorder[Ie],!1);if(ke){for(const Ie of Ee)be.encodeCentroid(void 0,be.featuresOnBorder[Ie],!1);be.borderDoneWithNeighborZ[ee]=_.canonical.z,be.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[G]=be.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const gs=new u.Color(1,0,0,1),kd=new u.Color(0,1,0,1),Ou=new u.Color(0,0,1,1),Od=new u.Color(1,0,1,1),Ih=new u.Color(0,1,1,1);function os(m,a,d){const _=m.context,b=m.transform,E=_.gl,I="globe"===b.projection.name,A=I?["PROJECTION_GLOBE_VIEW"]:null;let R=d.projMatrix;if(I&&u.globeToMercatorTransition(b.zoom)>0){const Ge=u.transitionTileAABBinECEF(d.canonical,b),vt=u.globeDenormalizeECEF(Ge);R=u.multiply(new Float32Array(16),b.globeMatrix,vt),u.multiply(R,b.projMatrix,R)}const B=m.useProgram("debug",null,A),z=a.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(z,B);const H=u.DepthMode.disabled,K=u.StencilMode.disabled,te=m.colorModeForRenderPass();_.activeTexture.set(E.TEXTURE0),m.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),I?z._makeGlobeTileDebugBuffers(m.context,b):z._makeDebugTileBoundsBuffers(m.context,b.projection);const ne=z._tileDebugBuffer||m.debugBuffer,re=z._tileDebugIndexBuffer||m.debugIndexBuffer,G=z._tileDebugSegments||m.debugSegments;B.draw(_,E.LINE_STRIP,H,K,te,u.CullFaceMode.disabled,Hc(R,u.Color.red),"$debug",ne,re,G,null,null,null,[z._globeTileDebugBorderBuffer]);const ee=z.latestRawTileData,le=Math.floor((ee&&ee.byteLength||0)/1024),ce=a.getTile(d).tileSize,be=512/Math.min(ce,512)*(d.overscaledZ/b.zoom)*.5;let Ee=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ee+=` => ${d.overscaledZ}`),Ee+=` ${le}kb`,function(Ge,vt){Ge.initDebugOverlayCanvas();const Be=Ge.debugOverlayCanvas,st=Ge.context.gl,Xe=Ge.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Be.width,Be.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(vt,5,5),Xe.strokeText(vt,5,5),Ge.debugOverlayTexture.update(Be),Ge.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(m,Ee);const we=z._tileDebugTextBuffer||m.debugBuffer,ke=z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ie=z._tileDebugTextSegments||m.debugSegments;B.draw(_,E.TRIANGLES,H,K,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,Hc(R,u.Color.transparent,be),"$debug",we,ke,Ie,null,null,null,[z._globeTileDebugTextBuffer])}function ss(m,a,d,_){Ll(m,0,a+d/2,m.transform.width,d,_)}function Sa(m,a,d,_){Ll(m,a-d/2,0,d,m.transform.height,_)}function Ll(m,a,d,_,b,E){const I=m.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(a*u.exported.devicePixelRatio,d*u.exported.devicePixelRatio,_*u.exported.devicePixelRatio,b*u.exported.devicePixelRatio),I.clear({color:E}),A.disable(A.SCISSOR_TEST)}const cc=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ah}=cc;function _s(m,a,d,_){m.emplaceBack(a,d,_)}class uc{constructor(a){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,_s(this.vertexArray,-1,-1,1),_s(this.vertexArray,1,-1,1),_s(this.vertexArray,-1,1,1),_s(this.vertexArray,1,1,1),_s(this.vertexArray,-1,-1,-1),_s(this.vertexArray,1,-1,-1),_s(this.vertexArray,-1,1,-1),_s(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Ah),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function io(m,a,d,_,b,E){const I=m.gl,A=a.paint.get("sky-atmosphere-color"),R=a.paint.get("sky-atmosphere-halo-color"),B=a.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:u.fromMat4(u.create$1(),_),u_sun_direction:b,u_sun_intensity:B,u_color_tint_r:[(ie=A).r,ie.g,ie.b,ie.a],u_color_tint_m:[(ne=R).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var ie,ne;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+E,a.skyboxTexture,0),d.draw(m,I.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,z,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const hc=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class tl{constructor(a){const d=new u.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const _=new u.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(d,hc.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const mr={symbol:function(m,a,d,_,b){if("translucent"!==m.renderPass)return;const E=u.StencilMode.disabled,I=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(A,R,B,z,H,K,te){const ie=R.transform,ne="map"===H,re="map"===K;for(const G of A){const ee=z.getTile(G),le=ee.getBucket(B);if(!le||!le.text||!le.text.segments.get().length)continue;const ce=u.evaluateSizeForZoom(le.textSizeData,ie.zoom),be=di(G,le.getProjection(),ie),Ee=ie.calculatePixelsToTileUnitsMatrix(ee),we=Je(be,ee.tileID.canonical,re,ne,ie,le.getProjection(),Ee),ke="none"!==B.layout.get("icon-text-fit")&&le.hasIconData();if(ce){const Ie=Math.pow(2,ie.zoom-ee.tileID.overscaledZ);qc(le,ne,re,te,u.symbolSize,ie,we,G,Ie,ce,ke)}}}(_,m,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&Gs(m,a,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),E,I),0!==d.paint.get("text-opacity").constantOr(1)&&Gs(m,a,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),E,I),a.map.showCollisionBoxes&&(Qa(m,a,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Qa(m,a,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("circle-opacity"),E=d.paint.get("circle-stroke-width"),I=d.paint.get("circle-stroke-opacity"),A=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===E.constantOr(1)||0===I.constantOr(1)))return;const R=m.context,B=R.gl,z=m.transform,H=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),K=u.StencilMode.disabled,te=m.colorModeForRenderPass(),ie="globe"===z.projection.name,ne=[u.mercatorXfromLng(z.center.lng),u.mercatorYfromLat(z.center.lat)],re=[];for(let ee=0;ee<_.length;ee++){const le=_[ee],ce=a.getTile(le),be=ce.getBucket(d);if(!be||be.projection.name!==z.projection.name)continue;const Ee=be.programConfigurations.get(d.id),we=Ru(d);ie&&we.push("PROJECTION_GLOBE_VIEW");const ke=m.useProgram("circle",Ee,we),Ie=be.layoutVertexBuffer,Ge=be.globeExtVertexBuffer,vt=be.indexBuffer,Be=z.projection.createInversionMatrix(z,le.canonical),st={programConfiguration:Ee,program:ke,layoutVertexBuffer:Ie,globeExtVertexBuffer:Ge,indexBuffer:vt,uniformValues:Ao(m,le,ce,Be,ne,d),tile:ce};if(A){const Xe=be.segments.get();for(const gt of Xe)re.push({segments:new u.SegmentVector([gt]),sortKey:gt.sortKey,state:st})}else re.push({segments:be.segments,sortKey:0,state:st})}A&&re.sort((ee,le)=>ee.sortKey-le.sortKey);const G={useDepthForOcclusion:!ie};for(const ee of re){const{programConfiguration:le,program:ce,layoutVertexBuffer:be,globeExtVertexBuffer:Ee,indexBuffer:we,uniformValues:ke,tile:Ie}=ee.state,Ge=ee.segments;m.terrain&&m.terrain.setupElevationDraw(Ie,ce,G),m.prepareDrawProgram(R,ce,Ie.tileID.toUnwrapped()),ce.draw(R,B.TRIANGLES,H,K,te,u.CullFaceMode.disabled,ke,d.id,be,we,Ge,d.paint,z.zoom,le,[Ee])}},heatmap:function(m,a,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const b=m.context,E=b.gl,I=u.StencilMode.disabled,A=new u.ColorMode([E.ONE,E.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(te,ie,ne,re){const G=te.gl,ee=ie.width*re,le=ie.height*re;te.activeTexture.set(G.TEXTURE1),te.viewport.set([0,0,ee,le]);let ce=ne.heatmapFbo;if(!ce||ce&&(ce.width!==ee||ce.height!==le)){ce&&ce.destroy();const be=G.createTexture();G.bindTexture(G.TEXTURE_2D,be),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ce=ne.heatmapFbo=te.createFramebuffer(ee,le,!1),function(Ee,we,ke,Ie,Ge,vt){const Be=Ee.gl;Be.texImage2D(Be.TEXTURE_2D,0,Ee.isWebGL2&&Ee.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Ge,vt,0,Be.RGBA,Ee.extRenderToTextureHalfFloat?Ee.isWebGL2?Be.HALF_FLOAT:Ee.extTextureHalfFloat.HALF_FLOAT_OES:Be.UNSIGNED_BYTE,null),Ie.colorAttachment.set(ke)}(te,0,be,ce,ee,le)}else G.bindTexture(G.TEXTURE_2D,ce.colorAttachment.get()),te.bindFramebuffer.set(ce.framebuffer)})(b,m,d,"globe"===m.transform.projection.name?.5:.25),b.clear({color:u.Color.transparent});const R=m.transform,B="globe"===R.projection.name,z=B?["PROJECTION_GLOBE_VIEW"]:null,H=B?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,K=[u.mercatorXfromLng(R.center.lng),u.mercatorYfromLat(R.center.lat)];for(let te=0;te<_.length;te++){const ie=_[te];if(a.hasRenderableParent(ie))continue;const ne=a.getTile(ie),re=ne.getBucket(d);if(!re||re.projection.name!==R.projection.name)continue;const G=re.programConfigurations.get(d.id),ee=m.useProgram("heatmap",G,z),{zoom:le}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ne,ee),m.prepareDrawProgram(b,ee,ie.toUnwrapped());const ce=R.projection.createInversionMatrix(R,ie.canonical);ee.draw(b,E.TRIANGLES,u.DepthMode.disabled,I,A,H,Lu(m,ie,ne,ce,K,le,d.paint.get("heatmap-intensity")),d.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,d.paint,m.transform.zoom,G,B?[re.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,E){const I=b.context,A=I.gl,R=E.heatmapFbo;if(!R)return;I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(A.TEXTURE1);let B=E.colorRampTexture;B||(B=E.colorRampTexture=new u.Texture(I,E.colorRamp,A.RGBA)),B.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(I,A.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,b.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(m,d))},line:function(m,a,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("line-opacity"),E=d.paint.get("line-width");if(0===b.constantOr(1)||0===E.constantOr(1))return;const I=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),A=m.colorModeForRenderPass(),R=m.terrain&&m.terrain.renderingToTexture?1:u.exported.devicePixelRatio,B=d.paint.get("line-dasharray"),z=B.constantOr(1),H=d.layout.get("line-cap"),K=d.paint.get("line-pattern"),te=K.constantOr(1),ie=d.paint.get("line-gradient"),ne=te?"linePattern":"line",re=m.context,G=re.gl,ee=(ce=>{const be=[];jo(ce)&&be.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&be.push("RENDER_LINE_GRADIENT");const Ee=ce.paint.get("line-trim-offset");0===Ee[0]&&0===Ee[1]||be.push("RENDER_LINE_TRIM_OFFSET");const we=ce.paint.get("line-pattern").constantOr(1),ke=1!==ce.paint.get("line-opacity").constantOr(1);return!we&&ke&&be.push("RENDER_LINE_ALPHA_DISCARD"),be})(d);let le=ee.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ce of _){const be=a.getTile(ce);if(te&&!be.patternsLoaded())continue;const Ee=be.getBucket(d);if(!Ee)continue;m.prepareDrawTile();const we=Ee.programConfigurations.get(d.id),ke=m.useProgram(ne,we,ee),Ie=K.constantOr(null);if(Ie&&be.imageAtlas){const rt=be.imageAtlas.patternPositions[Ie.toString()];rt&&we.setConstantPatternPositions(rt)}const Ge=B.constantOr(null),vt=H.constantOr(null);if(!te&&Ge&&vt&&be.lineAtlas){const rt=be.lineAtlas.getDash(Ge,vt);rt&&we.setConstantPatternPositions(rt)}let[Be,st]=d.paint.get("line-trim-offset");("round"===vt||"square"===vt)&&Be!==st&&(0===Be&&(Be-=1),1===st&&(st+=1));const Xe=m.terrain?ce.projMatrix:null,gt=te?$s(m,be,d,Xe,R):Qt(m,be,d,Xe,Ee.lineClipsArray.length,R,[Be,st]);if(ie){const rt=Ee.gradients[d.id];let wt=rt.texture;if(d.gradientVersion!==rt.version){let ut=256;if(d.stepInterpolant){const Tt=a.getSource().maxzoom,ln=ce.canonical.z===Tt?Math.ceil(1<<m.transform.maxZoom-ce.canonical.z):1;ut=u.clamp(u.nextPowerOfTwo(Ee.maxLineLength/u.EXTENT*1024*ln),256,re.maxTextureSize)}rt.gradient=u.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:rt.gradient||void 0,clips:Ee.lineClipsArray}),rt.texture?rt.texture.update(rt.gradient):rt.texture=new u.Texture(re,rt.gradient,G.RGBA),rt.version=d.gradientVersion,wt=rt.texture}re.activeTexture.set(G.TEXTURE1),wt.bind(d.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}z&&(re.activeTexture.set(G.TEXTURE0),be.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),we.updatePaintBuffers()),te&&(re.activeTexture.set(G.TEXTURE0),be.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),we.updatePaintBuffers()),m.prepareDrawProgram(re,ke,ce.toUnwrapped());const He=rt=>{ke.draw(re,G.TRIANGLES,I,rt,A,u.CullFaceMode.disabled,gt,d.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,d.paint,m.transform.zoom,we,[Ee.layoutVertexBuffer2])};if(le){const rt=m.stencilModeForClipping(ce).ref;0===rt&&m.terrain&&re.clear({stencil:0});const wt={func:G.EQUAL,mask:255};gt.u_alpha_discard_threshold=.8,He(new u.StencilMode(wt,rt,255,G.KEEP,G.KEEP,G.INVERT)),gt.u_alpha_discard_threshold=0,He(new u.StencilMode(wt,rt,255,G.KEEP,G.KEEP,G.KEEP))}else He(m.stencilModeForClipping(ce))}le&&(m.resetStencilClippingMasks(),m.terrain&&re.clear({stencil:0}))},fill:function(m,a,d,_){const b=d.paint.get("fill-color"),E=d.paint.get("fill-opacity");if(0===E.constantOr(1))return;const I=m.colorModeForRenderPass(),A=d.paint.get("fill-pattern"),R=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===b.constantOr(u.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(m.renderPass===R){const B=m.depthModeForSublayer(1,"opaque"===m.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);lc(m,a,d,_,B,I,!1)}if("translucent"===m.renderPass&&d.paint.get("fill-antialias")){const B=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);lc(m,a,d,_,B,I,!0)}},"fill-extrusion":function(m,a,d,_){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===m.renderPass){const E=new u.DepthMode(m.context.gl.LEQUAL,u.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Zs(m,a,d,_,E,u.StencilMode.disabled,u.ColorMode.disabled),Zs(m,a,d,_,E,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const I=m.colorModeForRenderPass();Zs(m,a,d,_,E,u.StencilMode.disabled,I)}}},hillshade:function(m,a,d,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const b=m.context,E=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),A=m.terrain&&m.terrain.renderingToTexture,[R,B]="translucent"!==m.renderPass||A?[{},_]:m.stencilConfigForOverlap(_);for(const z of B){const H=a.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===m.renderPass)qr(m,H,d,E,u.StencilMode.disabled,I);else if("translucent"===m.renderPass){const K=A&&m.terrain?m.terrain.stencilModeForRTTOverlap(z):R[z.overscaledZ];ic(m,z,H,d,E,K,I)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,d,_,b,E){if("translucent"!==m.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const I=m.context,A=I.gl,R=a.getSource(),B=m.useProgram("raster"),z=m.colorModeForRenderPass(),H=m.terrain&&m.terrain.renderingToTexture,[K,te]=R instanceof Hn||H?[{},_]:m.stencilConfigForOverlap(_),ie=te[te.length-1].overscaledZ,ne=!m.options.moving;for(const re of te){const G=H?u.DepthMode.disabled:m.depthModeForSublayer(re.overscaledZ-ie,1===d.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,A.LESS),ee=re.toUnwrapped(),le=a.getTile(re);if(H&&(!le||!le.hasData()))continue;const ce=H?re.projMatrix:m.transform.calculateProjMatrix(ee,ne),be=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(re):K[re.overscaledZ],Ee=E?0:d.paint.get("raster-fade-duration");le.registerFadeDuration(Ee);const we=a.findLoadedParent(re,0),ke=Ma(le,we,a,m.transform,Ee);let Ie,Ge;m.terrain&&m.terrain.prepareDrawTile();const vt="nearest"===d.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),le.texture.bind(vt,A.CLAMP_TO_EDGE),I.activeTexture.set(A.TEXTURE1),we?(we.texture.bind(vt,A.CLAMP_TO_EDGE),Ie=Math.pow(2,we.tileID.overscaledZ-le.tileID.overscaledZ),Ge=[le.tileID.canonical.x*Ie%1,le.tileID.canonical.y*Ie%1]):le.texture.bind(vt,A.CLAMP_TO_EDGE),le.texture.useMipmap&&I.extTextureFilterAnisotropic&&m.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Be=Pl(ce,Ge||[0,0],Ie||1,ke,d,R instanceof Hn?R.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(I,B,ee),R instanceof Hn)R.boundsBuffer&&R.boundsSegments&&B.draw(I,A.TRIANGLES,G,u.StencilMode.disabled,z,u.CullFaceMode.disabled,Be,d.id,R.boundsBuffer,m.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:st,tileBoundsIndexBuffer:Xe,tileBoundsSegments:gt}=m.getTileBoundsBuffers(le);B.draw(I,A.TRIANGLES,G,be,z,u.CullFaceMode.disabled,Be,d.id,st,Xe,gt)}}m.resetStencilClippingMasks()},background:function(m,a,d,_){const b=d.paint.get("background-color"),E=d.paint.get("background-opacity");if(0===E)return;const I=m.context,A=I.gl,R=m.transform,B=R.tileSize,z=d.paint.get("background-pattern");if(m.isPatternMissing(z))return;const H=!z&&1===b.a&&1===E&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const K=u.StencilMode.disabled,te=m.depthModeForSublayer(0,"opaque"===H?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),ie=m.colorModeForRenderPass(),ne=m.useProgram(z?"backgroundPattern":"background");let re,G=_;G||(re=m.getBackgroundTiles(),G=Object.values(re).map(ee=>ee.tileID)),z&&(I.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));for(const ee of G){const le=ee.toUnwrapped(),ce=_?ee.projMatrix:m.transform.calculateProjMatrix(le);m.prepareDrawTile();const be=a?a.getTile(ee):re?re[ee.key]:new u.Tile(ee,B,R.zoom,m),Ee=z?Gc(ce,E,m,z,{tileID:ee,tileSize:B}):Qn(ce,E,b);m.prepareDrawProgram(I,ne,le);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:ke,tileBoundsSegments:Ie}=m.getTileBoundsBuffers(be);ne.draw(I,A.TRIANGLES,te,K,ie,u.CullFaceMode.disabled,Ee,d.id,we,ke,Ie)}},sky:function(m,a,d){const _=m.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:u.smoothstep(7,8,_.zoom),E=d.paint.get("sky-opacity")*b;if(0===E)return;const I=m.context,A=d.paint.get("sky-type"),R=new u.DepthMode(I.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),B=m.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===m.renderPass?d.needsSkyboxCapture(m)&&(function(z,H,K,te){const ie=z.context,ne=ie.gl;let re=H.skyboxFbo;if(!re){re=H.skyboxFbo=ie.createFramebuffer(32,32,!1),H.skyboxGeometry=new uc(ie),H.skyboxTexture=ie.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,H.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ce=0;ce<6;++ce)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(re.framebuffer),ie.viewport.set([0,0,32,32]);const G=H.getCenter(z,!0),ee=z.useProgram("skyboxCapture"),le=new Float64Array(16);u.identity(le),u.rotateY(le,le,.5*-Math.PI),io(ie,H,ee,le,G,0),u.identity(le),u.rotateY(le,le,.5*Math.PI),io(ie,H,ee,le,G,1),u.identity(le),u.rotateX(le,le,.5*-Math.PI),io(ie,H,ee,le,G,2),u.identity(le),u.rotateX(le,le,.5*Math.PI),io(ie,H,ee,le,G,3),u.identity(le),io(ie,H,ee,le,G,4),u.identity(le),u.rotateY(le,le,Math.PI),io(ie,H,ee,le,G,5),ie.viewport.set([0,0,z.width,z.height])}(m,d),d.markSkyboxValid(m)):"sky"===m.renderPass&&function(z,H,K,te,ie){const ne=z.context,re=ne.gl,G=z.transform,ee=z.useProgram("skybox");ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,H.skyboxTexture);const le={u_matrix:G.skyboxMatrix,u_sun_direction:H.getCenter(z,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:ie};z.prepareDrawProgram(ne,ee),ee.draw(ne,re.TRIANGLES,K,u.StencilMode.disabled,z.colorModeForRenderPass(),u.CullFaceMode.backCW,le,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,d,R,E,B):"gradient"===A&&"sky"===m.renderPass&&function(z,H,K,te,ie){const ne=z.context,re=ne.gl,G=z.transform,ee=z.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new uc(ne)),ne.activeTexture.set(re.TEXTURE0);let le=H.colorRampTexture;le||(le=H.colorRampTexture=new u.Texture(ne,H.colorRamp,re.RGBA)),le.bind(re.LINEAR,re.CLAMP_TO_EDGE);const ce=(be=G.skyboxMatrix,Ee=H.getCenter(z,!1),we=H.paint.get("sky-gradient-radius"),ke=te,Ie=ie,{u_matrix:be,u_color_ramp:0,u_center_direction:Ee,u_radius:u.degToRad(we),u_opacity:ke,u_temporal_offset:Ie});var be,Ee,we,ke,Ie;z.prepareDrawProgram(ne,ee),ee.draw(ne,re.TRIANGLES,K,u.StencilMode.disabled,z.colorModeForRenderPass(),u.CullFaceMode.backCW,ce,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,d,R,E,B)},debug:function(m,a,d){for(let _=0;_<d.length;_++)os(m,a,d[_])},custom:function(m,a,d,_){const b=m.context,E=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&d.isLayerDraped()){if("offscreen"===m.renderPass){const I=E.prerender;if(I){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const A=m.transform.pointMerc;I.call(E,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(m.transform.zoom),[A.x,A.y],m.transform.pixelsPerMeterRatio)}else I.call(E,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const A=E.renderToTile;if(A){const R=_[0].canonical,B=new u.MercatorCoordinate(R.x+_[0].wrap*(1<<R.z),R.y,R.z);b.setDepthMode(u.DepthMode.disabled),b.setStencilMode(u.StencilMode.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),A.call(E,b.gl,B),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(u.StencilMode.disabled);const I="3d"===E.renderingMode?new u.DepthMode(m.context.gl.LEQUAL,u.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,u.DepthMode.ReadOnly);if(b.setDepthMode(I),"globe"===m.transform.projection.name){const A=m.transform.pointMerc;E.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(m.transform.zoom),[A.x,A.y],m.transform.pixelsPerMeterRatio)}else E.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else u.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class nl{constructor(a,d,_=!1){this.context=new Mt(a,_),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,d){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Io(this,a));const b=this._terrain;this.transform.elevation=_?b:null,b.update(a,this.transform,d)}_updateFog(a){const d=a.fog;if(!d||"globe"===this.transform.projection.name||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const E=_+.78*(b-_);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,d){if(this.width=a*u.exported.devicePixelRatio,this.height=d*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const a=this.context,d=new u.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(u.EXTENT,0),d.emplaceBack(0,u.EXTENT),d.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(d,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const _=new u.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(u.EXTENT,0),_.emplaceBack(0,u.EXTENT),_.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=a.createVertexBuffer(_,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const b=new u.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(b,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const E=new u.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(u.EXTENT,0,u.EXTENT,0),E.emplaceBack(0,u.EXTENT,0,u.EXTENT),E.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(E,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const I=new u.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const A=new u.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])A.emplaceBack(B);this.debugIndexBuffer=a.createIndexBuffer(A),this.emptyTexture=new u.Texture(a,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=u.create();const R=this.context.gl;this.stencilClearMode=new u.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new tl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,d.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,Ya(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,d,_){if(!d||this.currentStencilSource===d.id||!a.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){A=!0;break}if(!A)return}this.currentStencilSource=d.id;const b=this.context,E=b.gl;this.nextStencilID+_.length>256&&this.clearStencil(),b.setColorMode(u.ColorMode.disabled),b.setDepthMode(u.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of _){const R=d.getTile(A),B=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:K}=this.getTileBoundsBuffers(R);I.draw(b,E.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:E.ALWAYS,mask:0},B,255,E.KEEP,E.KEEP,E.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Ya(A.projMatrix),"$clipping",z,H,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new u.StencilMode({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const d=this.context.gl;return new u.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,_=a.sort((I,A)=>A.overscaledZ-I.overscaledZ),b=_[_.length-1].overscaledZ,E=_[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const I={};for(let A=0;A<E;A++)I[A+b]=new u.StencilMode({func:d.GEQUAL,mask:255},A+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[I,_]}return[{[b]:u.StencilMode.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([a.CONSTANT_COLOR,a.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(a,d,_){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new u.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const B in b){const z=b[B];z.used&&z.prepare(this.context)}const E={},I={},A={};for(const B in b){const z=b[B];E[B]=z.getVisibleCoordinates(),I[B]=E[B].slice().reverse(),A[B]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const B of _){const z=this.style._layers[B],H=a._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const K=H?I[H.id]:void 0;("custom"===z.type||z.isSky()||K&&K.length)&&this.renderLayer(this,H,z,K)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);if(B.isSky())continue;const H=z?I[z.id]:void 0;this._renderTileClippingMasks(B,z,H),this.renderLayer(this,z,B,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,z){const H=B.context,K=H.gl,te=B.transform,ie=new u.DepthMode(K.LEQUAL,u.DepthMode.ReadOnly,[0,1]),ne=B.useProgram("globeAtmosphere",null,"globe"===te.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),re=u.globeToMercatorTransition(te.zoom),G=z.properties.get("color").toArray01(),ee=z.properties.get("high-color").toArray01(),le=z.properties.get("space-color").toArray01PremultipliedAlpha(),ce=u.identity$1([]);u.rotateY$1(ce,ce,-u.degToRad(te._center.lng)),u.rotateX$1(ce,ce,u.degToRad(te._center.lat)),u.rotateZ$1(ce,ce,te.angle),u.rotateX$1(ce,ce,-te._pitch);const be=u.fromQuat(new Float32Array(16),ce),Ee=u.mapValue(z.properties.get("star-intensity"),0,1,0,.25),ke=u.mapValue(z.properties.get("horizon-blend"),0,1,5e-4,.25),Ie=u.globeUseCustomAntiAliasing(B,H,te)&&5e-4===ke?te.worldSize/(2*Math.PI*1.025)-1:te.globeRadius,Ge=B.frameCounter/1e3%1,vt=u.length(te.globeCenterInViewSpace),Be=Math.sqrt(Math.pow(vt,2)-Math.pow(Ie,2)),st=Math.acos(Be/vt),Xe={u_frustum_tl:te.frustumCorners.TL,u_frustum_tr:te.frustumCorners.TR,u_frustum_br:te.frustumCorners.BR,u_frustum_bl:te.frustumCorners.BL,u_horizon:te.frustumCorners.horizon,u_transition:re,u_fadeout_range:ke,u_color:G,u_high_color:ee,u_space_color:le,u_star_intensity:Ee,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ge,u_horizon_angle:st,u_rotation_matrix:be};B.prepareDrawProgram(H,ne);const gt=B.atmosphereBuffer;gt&&ne.draw(H,K.TRIANGLES,ie,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,Xe,"skybox",gt.vertexBuffer,gt.indexBuffer,gt.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,z,B,z?I[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=z?("symbol"===B.type?A:I)[z.id]:void 0;this._renderTileClippingMasks(B,z,z?E[z.id]:void 0),this.renderLayer(this,z,B,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;u.values(this.style._layers).forEach(z=>{const H=a._getLayerSourceCache(z);H&&!z.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<H.getSource().maxzoom)&&(B=H)}),B&&this.options.showTileBoundaries&&mr.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const z=B.transform.padding;ss(B,B.transform.height-(z.top||0),3,gs),ss(B,z.bottom||0,3,kd),Sa(B,z.left||0,3,Ou),Sa(B,B.transform.width-(z.right||0),3,Od);const H=B.transform.centerPoint;var K,te,ie,ne;Ll(K=B,(te=H.x)-1,(ie=B.transform.height-H.y)-10,2,20,ne=Ih),Ll(K,te-10,ie-1,20,2,ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,d,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(_.type)||a.terrain&&"custom"===_.type)&&mr[_.type](a,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[a.id];_||(_=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,d=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),a.beginQueryEXT(a.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const d={};for(const _ in a){const b=a[_],E=this.context.extTimerQuery,I=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),d[_]=I}return d}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let _=0;for(const b of a)_+=d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(b);return _}translatePosMatrix(a,d,_,b,E){if(!_[0]&&!_[1])return a;const I=E?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(I){const B=Math.sin(I),z=Math.cos(I);_=[_[0]*z-_[1]*B,_[0]*B+_[1]*z]}const A=[E?_[0]:un(d,_[0],this.transform.zoom),E?_[1]:un(d,_[1],this.transform.zoom),0],R=new Float32Array(16);return u.translate(R,a,A),R}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){return null===a||void 0!==a&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),d&&b.push("ZERO_EXAGGERATION"),_&&!a&&0!==_.getOpacity(this.transform.pitch)&&b.push("FOG"),a&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(a,d,_){this.cache=this.cache||{};const b=_||[],E=this.currentGlobalDefines().concat(b),I=oi.cacheKey(Dl[a],a,E,d);return this.cache[I]||(this.cache[I]=new oi(this.context,a,Dl[a],d,Po[a],E)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),I=((A,R,B,z,H,K,te,ie,ne,re,G)=>{const ee=A.transform,le=R.properties.get("color").toArray01();le[3]=z;const ce=A.frameCounter/1e3%1;return{u_fog_matrix:B?ee.calculateFogTileMatrix(B):A.identityMat,u_fog_range:R.getFovAdjustedRange(ee._fov),u_fog_color:le,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:H,u_frustum_tr:K,u_frustum_br:te,u_frustum_bl:ie,u_globe_pos:ne,u_globe_radius:re,u_viewport:G,u_globe_transition:u.globeToMercatorTransition(ee.zoom),u_is_globe:+("globe"===ee.projection.name)}})(this,b,_,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);d.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,d=a.createTexture();return a.bindTexture(a.TEXTURE_2D,d),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)d[b.key]=a[b.key]||new u.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Zc{constructor(a=0,d=0,_=0,b=0){if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=_,this.right=b}interpolate(a,d,_){return null!=d.top&&null!=a.top&&(this.top=u.number(a.top,d.top,_)),null!=d.bottom&&null!=a.bottom&&(this.bottom=u.number(a.bottom,d.bottom,_)),null!=d.left&&null!=a.left&&(this.left=u.number(a.left,d.left,_)),null!=d.right&&null!=a.right&&(this.right=u.number(a.right,d.right,_)),this}getCenter(a,d){const _=u.clamp((this.left+a-this.right)/2,0,a),b=u.clamp((this.top+d-this.bottom)/2,0,d);return new u.Point(_,b)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Zc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ho(m,a){const d=u.getColumn(m,3);u.fromQuat(m,a),u.setColumn(m,3,d)}function kn(m,a){const d=u.identity$1([]);return u.rotateZ$1(d,d,-a),u.rotateX$1(d,d,-m),d}function kl(m,a){const d=[m[0],m[1],0],_=[a[0],a[1],0];if(u.length(d)>=1e-15){const I=u.normalize([],d);u.scale$2(_,I,u.dot(_,I)),a[0]=_[0],a[1]=_[1]}const b=u.cross([],a,m);if(u.len(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return kn(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),E)}class il{constructor(a,d){this.position=a,this.orientation=d}get position(){return this._position}set position(a){if(a){const d=a instanceof u.MercatorCoordinate?a:new u.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(d.x=u.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(a,d){if(this.orientation=null,!this.position)return;const _=this.position,b=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(a)):0,E=u.MercatorCoordinate.fromLngLat(a,b),I=[E.x-_.x,E.y-_.y,E.z-_.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=kl(I,d)}setPitchBearing(a,d){this.orientation=kn(u.degToRad(a),u.degToRad(-d))}}class An{constructor(a,d){this._transform=u.identity([]),this.orientation=d,this.position=a}get mercatorPosition(){const a=this.position;return new u.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=u.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var d;a&&u.setColumn(this._transform,3,[(d=a)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||u.identity$1([]),a&&Ho(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,d){this._orientation=kn(a,d),Ho(this._transform,this._orientation)}forward(){const a=u.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=u.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=u.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,d){const _=new Float64Array(16);return u.invert(_,this.getWorldToCamera(a,d)),_}getWorldToCameraPosition(a,d,_){const b=this.position;u.scale$2(b,b,-a);const E=new Float64Array(16);return u.fromScaling(E,[_,_,_]),u.translate(E,E,b),E[10]*=d,E}getWorldToCamera(a,d){const _=new Float64Array(16),b=new Float64Array(4),E=this.position;return u.conjugate(b,this._orientation),u.scale$2(E,E,-a),u.fromQuat(_,b),u.translate(_,_,E),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(a,d,_,b){const E=new Float64Array(16);return u.perspective(E,a,d,_,b),E}getDistanceToElevation(a,d=!1){const _=0===a?0:u.mercatorZfromAltitude(a,d?u.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(_-this.position[2])/b[2]}clone(){return new An([...this.position],[...this.orientation])}}function gr(m,a){const d=xr(m.projection,m.zoom,m.width,m.height),_=function(E,I,A,R,B){const z=new u.LngLat(A.lng-180*ir,A.lat),H=new u.LngLat(A.lng+180*ir,A.lat),K=E.project(z.lng,z.lat),te=E.project(H.lng,H.lat),ie=-Math.atan2(te.y-K.y,te.x-K.x),ne=u.MercatorCoordinate.fromLngLat(A);ne.y=u.clamp(ne.y,-1+ir,1-ir);const re=ne.toLngLat(),G=E.project(re.lng,re.lat),ee=u.MercatorCoordinate.fromLngLat(re);ee.x+=ir;const le=ee.toLngLat(),ce=E.project(le.lng,le.lat),be=Zr(ce.x-G.x,ce.y-G.y,ie),Ee=u.MercatorCoordinate.fromLngLat(re);Ee.y+=ir;const we=Ee.toLngLat(),ke=E.project(we.lng,we.lat),Ie=Zr(ke.x-G.x,ke.y-G.y,ie),Ge=Math.abs(be.x)/Math.abs(Ie.y),vt=u.identity([]);u.rotateZ(vt,vt,-ie*(1-(B?0:R)));const Be=u.identity([]);return u.scale(Be,Be,[1,1-(1-Ge)*R,1]),Be[4]=-Ie.x/Ie.y*R,u.rotateZ(Be,Be,ie),u.multiply(Be,vt,Be),Be}(m.projection,0,m.center,d,a),b=ei(m);return u.scale(_,_,[b,b,1]),_}function ei(m){const a=m.projection,d=xr(m.projection,m.zoom,m.width,m.height),_=rl(a,m.center),b=rl(a,u.LngLat.convert(a.center));return Math.pow(2,_*d+(1-d)*b)}function xr(m,a,d,_,b=1/0){const E=m.range;if(!E)return 0;const I=Math.min(b,Math.max(d,_)),A=Math.log(I/1024)/Math.LN2;return u.smoothstep(E[0]+A,E[1]+A,a)}const ir=1/4e4;function rl(m,a){const d=u.clamp(a.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),_=new u.LngLat(a.lng-180*ir,d),b=new u.LngLat(a.lng+180*ir,d),E=m.project(_.lng,d),I=m.project(b.lng,d),A=u.MercatorCoordinate.fromLngLat(_),R=u.MercatorCoordinate.fromLngLat(b),B=I.x-E.x,z=I.y-E.y,H=R.x-A.x,K=R.y-A.y,te=Math.sqrt((H*H+K*K)/(B*B+z*z));return Math.log(te)/Math.LN2}function Zr(m,a,d){const _=Math.cos(d),b=Math.sin(d);return{x:m*_-a*b,y:m*b+a*_}}class Ia{constructor(a,d,_,b,E,I,A){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=b??60,this.setProjection(I),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new An,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new Ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,d=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const _=!Q(d,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const d=a!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.Point(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const d=-a*Math.PI/180;var _,b,E,I,A,R,B,z,H,K;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,I=this.angle,A=(E=this.rotationMatrix)[0],R=E[1],B=E[2],z=E[3],H=Math.sin(I),K=Math.cos(I),b[0]=A*K+B*H,b[1]=R*K+z*H,b[2]=A*-H+B*K,b[3]=R*-H+z*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=u.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=u.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,E=0;for(let I=0;I<d.length;I++){const A=new u.Point(d[I][0]*this.width,_+d[I][1]*(this.height-_)),R=a.pointCoordinate(A);if(!R)continue;const B=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);b+=R[3]*B,E+=B}return 0===E?NaN:b/E}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(a),E=this._mercatorZfromZoom(this._maxZoom),I=Math.max(b-_,E);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[d.x,d.y,d.z]:[a.x,a.y,a.z];const b=u.length(u.sub([],this._camera.position,_));return u.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let d=!1;if(a.orientation&&!u.exactEquals(a.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];u.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,d=new il;return d.position=new u.MercatorCoordinate(a[0],a[1],a[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(a){if(!u.length$1(a))return!1;u.normalize$1(a,a);const d=u.transformQuat([],[0,0,-1],a),_=u.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;const b=kl(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(a){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;a[2]=u.clamp(a[2],b/_,b/d),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,_){this._unmodified=!1,this._edgeInsets.interpolate(a,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new u.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new u.Point(0,0)),b=this.pointCoordinate(new u.Point(this.width,0)),E=this.pointCoordinate(new u.Point(this.width,this.height)),I=this.pointCoordinate(new u.Point(0,this.height)),A=Math.floor(Math.min(_.x,b.x,E.x,I.x)),R=Math.floor(Math.max(_.x,b.x,E.x,I.x)),B=1;for(let z=A-B;z<=R+B;z++)0!==z&&d.push(new u.UnwrappedTileID(z,a))}return d}coveringTiles(a){let d=this.coveringZoomLevel(a);const _=d,b=this.elevation&&!a.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==a.minzoom&&d<a.minzoom)return[];void 0!==a.maxzoom&&d>a.maxzoom&&(d=a.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,R=1<<d,B=[R*I.x,R*I.y,0],z="globe"===this.projection.name,H=!z,K=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,H),te=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=R*u.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),re=[R*te.x,R*te.y,ne*(H?1:ie)],G=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,le=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=a.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?ei(this):1,Ee=He=>{const wt=new u.MercatorCoordinate(He.x+25e-6,He.y,He.z),ut=new u.MercatorCoordinate(He.x,He.y+25e-6,He.z),Tt=He.toLngLat(),ln=wt.toLngLat(),Pn=ut.toLngLat(),Jt=this.locationCoordinate(Tt),vn=this.locationCoordinate(ln),Kn=this.locationCoordinate(Pn),Yn=Math.hypot(vn.x-Jt.x,vn.y-Jt.y),Wt=Math.hypot(Kn.x-Jt.x,Kn.y-Jt.y);return Math.sqrt(Yn*Wt)*be/25e-6},we=He=>{const rt=le,wt=ce;return{aabb:u.tileAABB(this,R,0,0,0,He,wt,rt,this.projection),zoom:0,x:0,y:0,minZ:wt,maxZ:rt,wrap:He,fullyVisible:!1}},ke=[];let Ie=[];const Ge=d,vt=a.reparseOverscaled?_:d,Be=He=>He*He,st=Be((ne-this._centerAltitude)*ie),Xe=He=>{if(!this._elevation||!He.tileID||!E)return;const rt=this._elevation.getMinMaxForTile(He.tileID),wt=He.aabb;rt?(wt.min[2]=rt.min,wt.max[2]=rt.max,wt.center[2]=(wt.min[2]+wt.max[2])/2):(He.shouldSplit=gt(He),He.shouldSplit||(wt.min[2]=wt.max[2]=wt.center[2]=this._centerAltitude))},gt=He=>{if(He.zoom<ee)return!0;if(He.zoom===Ge)return!1;if(null!=He.shouldSplit)return He.shouldSplit;const rt=He.aabb.distanceX(re),wt=He.aabb.distanceY(re);let ut=st,Tt=1;if(z){ut=Be(He.aabb.distanceZ(re));const Jt=Math.pow(2,He.zoom),vn=u.latFromMercatorY((He.y+1)/Jt),Kn=u.latFromMercatorY(He.y/Jt),Yn=Math.min(Math.max(A,vn),Kn),Wt=u.circumferenceAtLatitude(Yn)/u.circumferenceAtLatitude(A);if(Tt=Yn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Wt/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&He.zoom===Ge-1&&Wt>=.9)return!0}else if(b&&(ut=Be(He.aabb.distanceZ(re)*ie)),this.projection.isReprojectedInTileSpace&&_<=5){const Jt=Math.pow(2,He.zoom),vn=Ee(new u.MercatorCoordinate((He.x+.5)/Jt,(He.y+.5)/Jt));Tt=vn>.85?1:vn}const ln=rt*rt+wt*wt+ut;return ln<Be((1<<Ge-He.zoom)*G*Tt*((Jt,vn)=>{if(vn*Be(.707)<Jt)return 1;const Kn=Math.sqrt(vn/Jt);return Kn/(1.4144271570014144+(Math.pow(1.1,Kn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ut,st),ln))};if(this.renderWorldCopies)for(let He=1;He<=3;He++)ke.push(we(-He)),ke.push(we(He));for(ke.push(we(0));ke.length>0;){const He=ke.pop(),rt=He.x,wt=He.y;let ut=He.fullyVisible;if(!ut){const Tt=He.aabb.intersects(K);if(0===Tt)continue;ut=2===Tt}if(He.zoom!==Ge&&gt(He))for(let Tt=0;Tt<4;Tt++){const ln=(rt<<1)+Tt%2,Pn=(wt<<1)+(Tt>>1),Jt={aabb:E?He.aabb.quadrant(Tt):u.tileAABB(this,R,He.zoom+1,ln,Pn,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:ln,y:Pn,wrap:He.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};b&&!z&&(Jt.tileID=new u.OverscaledTileID(He.zoom+1===Ge?vt:He.zoom+1,He.wrap,He.zoom+1,ln,Pn),Xe(Jt)),ke.push(Jt)}else{const Tt=He.zoom===Ge?vt:He.zoom;if(a.minzoom&&a.minzoom>Tt)continue;const ln=B[0]-(.5+rt+(He.wrap<<He.zoom))*(1<<d-He.zoom),Pn=B[1]-.5-wt,Jt=He.tileID?He.tileID:new u.OverscaledTileID(Tt,He.wrap,He.zoom,rt,wt);Ie.push({tileID:Jt,distanceSq:ln*ln+Pn*Pn})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,rt=this.horizonLineFromTop();Ie=Ie.filter(wt=>{const ut=[0,0,0,1],Tt=[u.EXTENT,u.EXTENT,0,1],ln=this.calculateFogTileMatrix(wt.tileID.toUnwrapped());u.transformMat4$1(ut,ut,ln),u.transformMat4$1(Tt,Tt,ln);const Pn=u.getAABBPointSquareDist(ut,Tt);if(0===Pn)return!0;let Jt=!1;const vn=this._elevation;if(vn&&Pn>He&&0!==rt){const Kn=this.calculateProjMatrix(wt.tileID.toUnwrapped());let Yn;a.isTerrainDEM||(Yn=vn.getMinMaxForTile(wt.tileID)),Yn||(Yn={min:ce,max:le});const Wt=u.furthestTileCorner(this.rotation),xi=[Wt[0]*u.EXTENT,Wt[1]*u.EXTENT,Yn.max];u.transformMat4(xi,xi,Kn),Jt=(1-xi[1])*this.height*.5<rt}return Pn<He||Jt})}return Ie.sort((He,rt)=>He.distanceSq-rt.distanceSq).map(He=>He.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=u.clamp(a.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),_=this.projection.project(a.lng,d);return new u.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/u.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,d){let _,b;const E=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(d.x-E.x)/A,b=(d.y-E.y)/A}else{const A=this.pointCoordinate(d),R=this.pointCoordinate(E);_=A.x-R.x,b=A.y-R.y}const I=this.locationCoordinate(a);this.setLocation(new u.MercatorCoordinate(I.x-_,I.y-b))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,d){const _=d?u.mercatorZfromAltitude(d,a.lat):void 0,b=this.projection.project(a.lng,a.lat);return new u.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,d){const _=d??this._centerAltitude,b=[a.x,a.y,0,1],E=[a.x,a.y,1,1];u.transformMat4$1(b,b,this.pixelMatrixInverse),u.transformMat4$1(E,E,this.pixelMatrixInverse);const I=E[3];u.scale$1(b,b,1/b[3]),u.scale$1(E,E,1/I);const A=b[2],R=E[2];return{p0:b,p1:E,t:A===R?0:(_-A)/(R-A)}}screenPointToMercatorRay(a){const d=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return u.transformMat4$1(d,d,this.pixelMatrixInverse),u.transformMat4$1(_,_,this.pixelMatrixInverse),u.scale$1(d,d,1/d[3]),u.scale$1(_,_,1/_[3]),d[2]=u.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=u.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,u.scale$1(d,d,1/this.worldSize),u.scale$1(_,_,1/this.worldSize),new u.Ray([d[0],d[1],d[2]],u.normalize([],u.sub([],_,d)))}rayIntersectionCoordinate(a){const{p0:d,p1:_,t:b}=a,E=u.mercatorZfromAltitude(d[2],this._center.lat),I=u.mercatorZfromAltitude(_[2],this._center.lat);return new u.MercatorCoordinate(u.number(d[0],_[0],b)/this.worldSize,u.number(d[1],_[1],b)/this.worldSize,u.number(E,I,b))}pointCoordinate(a,d=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,d)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let d=this.projection.pointCoordinate3D(this,a.x,a.y);if(d)return new u.MercatorCoordinate(d[0],d[1],d[2]);let _=0,b=this.horizonLineFromTop();if(a.y>b)return this.pointCoordinate(a);const E=.02*b,I=a.clone();for(let A=0;A<10&&b-_>E;A++){I.y=u.number(_,b,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(b=I.y,d=R):_=I.y}return d?new u.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const d=this.pointCoordinate(a);return d.y>=0&&d.y<=1}_coordinatePoint(a,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,b=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return u.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new u.Point(b[0]/b[3],b[1]/b[3]):new u.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new u.Point(d,a)),I=this.pointLocation3D(new u.Point(b,a)),A=this.pointLocation3D(new u.Point(b,_)),R=this.pointLocation3D(new u.Point(d,_));let B=Math.min(E.lng,I.lng,A.lng,R.lng),z=Math.max(E.lng,I.lng,A.lng,R.lng),H=Math.min(E.lat,I.lat,A.lat,R.lat),K=Math.max(E.lat,I.lat,A.lat,R.lat);const te=Math.pow(2,-this.zoom)/16*270,ie="globe"===this.projection.name?1:4,ne=(re,G,ee,le,ce)=>{const be=(re+ee)/2,Ee=(G+le)/2,we=new u.Point(be,Ee),{lng:ke,lat:Ie}=this.pointLocation3D(we),Ge=Math.max(0,B-ke,H-Ie,ke-z,Ie-K);B=Math.min(B,ke),z=Math.max(z,ke),H=Math.min(H,Ie),K=Math.max(K,Ie),(ce<ie||Ge>te)&&(ne(re,G,be,Ee,ce+1),ne(be,Ee,ee,le,ce+1))};if(ne(d,a,b,a,1),ne(b,a,b,_,1),ne(b,_,d,_,1),ne(d,_,d,a,1),"globe"===this.projection.name){const[re,G]=u.polesInViewport(this);re?(K=90,z=180,B=-180):G&&(H=-90,z=180,B=-180)}return new u.LngLatBounds(new u.LngLat(B,H),new u.LngLat(z,K))}_getBoundsRectangular(a,d){const{top:_,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=new u.Point(b,_),R=new u.Point(I,_),B=new u.Point(I,E),z=new u.Point(b,E);let H=this.pointCoordinate(A,a),K=this.pointCoordinate(R,a);const te=this.pointCoordinate(B,d),ie=this.pointCoordinate(z,d),ne=(re,G)=>(G.y-re.y)/(G.x-re.x);return H.y>1&&K.y>=0?H=new u.MercatorCoordinate((1-ie.y)/ne(ie,H)+ie.x,1):H.y<0&&K.y<=1&&(H=new u.MercatorCoordinate(-ie.y/ne(ie,H)+ie.x,0)),K.y>1&&H.y>=0?K=new u.MercatorCoordinate((1-te.y)/ne(te,K)+te.x,1):K.y<0&&H.y<=1&&(K=new u.MercatorCoordinate(-te.y/ne(te,K)+te.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(te))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=a.visibleDemTiles.reduce((_,b)=>{if(b.dem){const E=b.dem.tree;_.min=Math.min(_.min,E.minimums[0]),_.max=Math.max(_.max,E.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*a.exaggeration(),d.max*a.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,d){return this.projection.createTileMatrix(this,d,a)}calculateDistanceTileData(a){const d=a.key,_=this._distanceTileDataCache;if(_[d])return _[d];const b=a.canonical,E=1/this.height,I=this.cameraWorldSize,A=I/this.zoomScale(b.z),R=(b.x+Math.pow(2,b.z)*a.wrap)*A,B=b.y*A,z=this.point;z.x*=I/this.worldSize,z.y*=I/this.worldSize;const H=this.angle,K=Math.sin(-H),te=-Math.cos(-H);return _[d]={bearing:[K,te],center:[(z.x-R)*E,(z.y-B)*E],scale:A/u.EXTENT*E},_[d]}calculateFogTileMatrix(a){const d=a.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return u.multiply(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(a,d=!1){const _=a.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const E=this.calculatePosMatrix(a,this.worldSize);return u.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,E),b[_]=new Float32Array(E),b[_]}calculatePixelsToTileUnitsMatrix(a){const d=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const b=function(E,I){const{scale:A}=E.tileTransform,R=A*u.EXTENT/(E.tileSize*Math.pow(2,I.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return B=new Float32Array(4),K=(z=I.inverseAdjustmentMatrix)[1],te=z[2],ie=z[3],re=(H=[R,R])[1],B[0]=z[0]*(ne=H[0]),B[1]=K*ne,B[2]=te*re,B[3]=ie*re,B;var B,z,H,K,te,ie,ne,re}(a,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const a=1/this.worldSize,d=u.fromScaling([],[a,a,a]);return u.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const d=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=this._camera.forward(),E=u.mercatorZfromAltitude(1,this._center.lat);_[2]/=E,b[2]/=E,u.normalize(b,b);const I=a.raycast(_,b,a.exaggeration());if(I){const A=u.scaleAndAdd([],_,b,I),R=new u.MercatorCoordinate(A[0],A[1],u.mercatorZfromAltitude(A[2],u.latFromMercatorY(A[1]))),B=(R.z+u.length([R.x-_[0],R.y-_[1],R.z-_[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const d=this._elevation,_=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(_),E=d.getAtPointOrZero(new u.MercatorCoordinate(...b)),I=this.pixelsPerMeter/this.worldSize*E,A=this._minimumHeightOverTerrain(),R=b[2]-I;if(R<=A)if(R<0||a){const B=this.locationCoordinate(this._center,this._centerAltitude),z=[b[0],b[1],B.z-b[2]],H=u.length(z);z[2]-=(A-R)/this._pixelsPerMercatorPixel;const K=u.length(z);if(0===K)return;u.scale$2(z,z,H/K*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],B.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const K=this.center;return K.lat=u.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(K.lng=u.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const d=this._unmodified,{x:_,y:b}=this.point;let E=0,I=_,A=b;const R=this.width/2,B=this.height/2,z=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(b-B<z&&(A=z+B),b+B>H&&(A=H-B),H-z<this.height&&(E=Math.max(E,this.height/(H-z)),A=(H+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,ie=this.worldSize/2-(K+te)/2;I=(_+ie+this.worldSize)%this.worldSize-ie,I-R<K&&(I=K+R),I+R>te&&(I=te-R),te-K<this.width&&(E=Math.max(E,this.width/(te-K)),I=(te+K)/2)}I===_&&A===b||(this.center=this.unproject(new u.Point(I,A))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const _=xr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b="meters"===this.projection.zAxisUnit?d:1,E=this._camera.getWorldToCamera(this.worldSize,b),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-a.x/this.width,I[9]=2*a.y/this.height;let A=u.mul([],I,E);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),we=u.identity([]);u.translate(we,we,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),u.multiply(we,we,gr(this)),u.translate(we,we,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),u.multiply(A,A,we),this.inverseAdjustmentMatrix=function(ke){const Ie=gr(ke,!0);return Oe([],[Ie[0],Ie[1],Ie[4],Ie[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],A,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=A,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const R=u.invert([],I);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);u.identity(B),u.scale(B,B,[1,-1,1]),u.rotateX(B,B,this._pitch),u.rotateZ(B,B,this.angle);const z=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-a.x/this.width,z[9]=2*(a.y+H)/this.height,this.skyboxMatrix=u.multiply(B,z,B);const K=this.point,te=K.x,ie=K.y,ne=this.width%2/2,re=this.height%2/2,G=Math.cos(this.angle),ee=Math.sin(this.angle),le=te-Math.round(te)+G*ne+ee*re,ce=ie-Math.round(ie)+G*re+ee*ne,be=new Float64Array(A);if(u.translate(be,be,[le>.5?le-1:le,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=be,A=u.create(),u.scale(A,A,[this.width/2,-this.height/2,1]),u.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=u.create(),u.scale(A,A,[1,-1,1]),u.translate(A,A,[-1,-1,0]),u.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=u.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(Ee,Ee,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[a,a,d];u.scale$2(E,E,b),u.scale$2(_,_,-1),u.multiply$2(_,_,E);const I=u.create();u.translate(I,I,_),u.scale(I,I,E),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,d,b)}_computeCameraPosition(a){const d=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-a/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*E,b.y/this.worldSize-_[1]*E,a/this.worldSize*this._centerAltitude-_[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],b=a[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((d-_)/b,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,a,E),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),E=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),A=Math.max((a[2]-E)/Math.cos(_),I),R=this._zoomFromMercatorZ(A);u.scaleAndAdd(a,a,d,A),this._pitch=u.clamp(_,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(b,-Math.PI,Math.PI),this._setZoom(u.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let d=0,_=u.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;_-d>1e-6&&_>d;){const I=d+.5*(_-d),A=this.tileSize*Math.pow(2,I),R=this.getCameraToCenterDistance(this.projection,I,A),B=this.scaleZoom(R/(a*this.tileSize)),z=Math.abs(I-B);z<E&&(E=z,b=I),I<B?d=I:_=I}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,d){const _=Math.min(a.x,d.x),b=Math.max(a.x,d.x),E=Math.min(a.y,d.y),I=Math.max(a.y,d.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new u.Point(_,E),new u.Point(b,I),new u.Point(_,I),new u.Point(b,E)],R=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const z of A){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const K=this.rayIntersectionCoordinate(H);if(K.x<R||K.y<0||K.x>B||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.Point(0,0),new u.Point(this.width,this.height))}zoomDeltaToMovement(a,d){const _=u.length(u.sub([],this._camera.position,a)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const a=function([d,_,b],E){const I=[d,_,b,1];u.transformMat4$1(I,I,E);const A=I[3]=Math.max(I[3],1e-6);return I[0]/=A,I[1]/=A,I[2]/=A,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,a))}}getCameraToCenterDistance(a,d=this.zoom,_=this.worldSize){const b=xr(a,d,this.width,this.height,1024),E=a.pixelSpaceConversion(this.center.lat,_,b);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(a,a,this.globeMatrix),a}}function Aa(m,a){let d=!1,_=null;const b=()=>{_=null,d&&(m(),_=setTimeout(b,a),d=!1)};return()=>(d=!0,_||b(),_)}class ol{constructor(a){this._hashName=a&&encodeURIComponent(a),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Aa(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,u.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const d=Ol(a);if(this._hashName){const _=this._hashName;let b=!1;const E=u.window.location.hash.slice(1).split("&").map(I=>{const A=I.split("=")[0];return A===_?(b=!0,`${A}=${d}`):I}).filter(I=>I);return b||E.push(`${_}=${d}`),`#${E.join("&")}`}return`#${d}`}_getCurrentHash(){const a=u.window.location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(d[3]||0):a.getBearing();return a.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,a)}}function Ol(m,a){const d=m.getCenter(),_=Math.round(100*m.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),I=Math.round(d.lng*E)/E,A=Math.round(d.lat*E)/E,R=m.getBearing(),B=m.getPitch();let z=a?`/${I}/${A}/${_}`:`${_}/${A}/${I}`;return(R||B)&&(z+="/"+Math.round(10*R)/10),B&&(z+=`/${Math.round(B)}`),z}const dc={linearity:.3,easing:u.bezier(0,0,.3,1)},Gi=u.extend({deceleration:2500,maxSpeed:1400},dc),Xt=u.extend({deceleration:20,maxSpeed:1400},dc),ct=u.extend({deceleration:1e3,maxSpeed:360},dc),h=u.extend({deceleration:1e3,maxSpeed:90},dc);class x{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=u.exported.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const E=k(d.pan.mag(),_,u.extend({},Gi,a||{}));b.offset=d.pan.mult(E.amount/d.pan.mag()),b.center=this._map.transform.center,M(b,E)}if(d.zoom){const E=k(d.zoom,_,Xt);b.zoom=this._map.transform.zoom+E.amount,M(b,E)}if(d.bearing){const E=k(d.bearing,_,ct);b.bearing=this._map.transform.bearing+u.clamp(E.amount,-179,179),M(b,E)}if(d.pitch){const E=k(d.pitch,_,h);b.pitch=this._map.transform.pitch+E.amount,M(b,E)}if(b.zoom||b.bearing){const E=void 0===d.pinchAround?d.around:d.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function M(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function k(m,a,d){const{maxSpeed:_,linearity:b,deceleration:E}=d,I=u.clamp(m*b/(a/1e3),-_,_),A=Math.abs(I)/(E*b);return{easing:d.easing,duration:1e3*A,amount:I*(A/2)}}class U extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_,b={}){const E=_t(d.getCanvasContainer(),_),I=d.unproject(E);super(a,u.extend({point:E,lngLat:I,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class X extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){const b="touchend"===a?_.changedTouches:_.touches,E=Ue(d.getCanvasContainer(),b),I=E.map(R=>d.unproject(R)),A=E.reduce((R,B,z,H)=>R.add(B.div(H.length)),new u.Point(0,0));super(a,{points:E,point:A,lngLats:I,lngLat:d.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class xe extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class je{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new xe(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new U(a.type,this._map,a))}mouseup(a){this._map.fire(new U(a.type,this._map,a))}preclick(a){const d=u.extend({},a);d.type="preclick",this._map.fire(new U(d.type,this._map,d))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(a),this._map.fire(new U(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new U(a.type,this._map,a))}mouseover(a){this._map.fire(new U(a.type,this._map,a))}mouseout(a){this._map.fire(new U(a.type,this._map,a))}touchstart(a){return this._firePreventable(new X(a.type,this._map,a))}touchmove(a){this._map.fire(new X(a.type,this._map,a))}touchend(a){this._map.fire(new X(a.type,this._map,a))}touchcancel(a){this._map.fire(new X(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Le{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new U(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new U("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new U(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bt{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&0===a.button&&(Lt(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const _=d,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(_)||!this._box&&_.dist(b)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const I=Math.min(b.x,_.x),A=Math.max(b.x,_.x),R=Math.min(b.y,_.y),B=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=A-I+"px",this._box.style.height=B-R+"px")})}mouseupWindow(a,d){if(!this._active)return;const _=this._startPos,b=d;if(_&&0===a.button){if(this.reset(),Ye(),_.x!==b.x||_.y!==b.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:E=>E.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),At(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new u.Event(a,{originalEvent:d}))}}function tn(m,a){const d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=a[_];return d}class yn{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const E=new u.Point(0,0);for(const I of b)E._add(I);return E.div(b.length)}(d),this.touches=tn(_,d)))}touchmove(a,d,_){if(this.aborted||!this.centroid)return;const b=tn(_,d);for(const E in this.touches){const I=b[E];(!I||I.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(a,d,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class _n{constructor(a){this.singleTap=new yn(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,d,_){this.singleTap.touchstart(a,d,_)}touchmove(a,d,_){this.singleTap.touchmove(a,d,_)}touchend(a,d,_){const b=this.singleTap.touchend(a,d,_);if(b){const E=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(E&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Lr{constructor(){this._zoomIn=new _n({numTouches:1,numTaps:2}),this._zoomOut=new _n({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,_){this._zoomIn.touchstart(a,d,_),this._zoomOut.touchstart(a,d,_)}touchmove(a,d,_){this._zoomIn.touchmove(a,d,_),this._zoomOut.touchmove(a,d,_)}touchend(a,d,_){const b=this._zoomIn.touchend(a,d,_),E=this._zoomOut.touchend(a,d,_);return b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(b)},{originalEvent:a})}):E?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(E)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rr={0:1,2:2};class qi{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,d){return!1}_move(a,d){return{}}mousedown(a,d){if(this._lastPoint)return;const _=Re(a);this._correctButton(a,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(a,d){const _=this._lastPoint;if(_)if(a.preventDefault(),null!=this._eventButton&&function(b,E){const I=rr[E];return void 0===b.buttons||(b.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(a){this._lastPoint&&Re(a)===this._eventButton&&(this._moved&&Ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Er extends qi{mousedown(a,d){super.mousedown(a,d),this._lastPoint&&(this._active=!0)}_correctButton(a,d){return 0===d&&!a.ctrlKey}_move(a,d){return{around:d,panDelta:d.sub(a)}}}class Ws extends qi{_correctButton(a,d){return 0===d&&a.ctrlKey||2===d}_move(a,d){const _=.8*(d.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class ys extends qi{_correctButton(a,d){return 0===d&&a.ctrlKey||2===d}_move(a,d){const _=-.5*(d.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class Go{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.Point(0,0)}touchstart(a,d,_){return this._calculateTransform(a,d,_)}touchmove(a,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,d,_)}}touchend(a,d,_){this._calculateTransform(a,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,_){_.length>0&&(this._active=!0);const b=tn(_,d),E=new u.Point(0,0),I=new u.Point(0,0);let A=0;for(const B in b){const z=b[B],H=this._touches[B];H&&(E._add(z),I._add(z.sub(H)),A++,b[B]=z)}if(this._touches=b,A<this._minTouches||!I.mag())return;const R=I.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(A),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Xs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,d,_){return{}}touchstart(a,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,_){const b=this._firstTwoTouches;if(!b)return;a.preventDefault();const[E,I]=b,A=vs(_,d,E),R=vs(_,d,I);if(!A||!R)return;const B=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],B,a)}touchend(a,d,_){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,I=vs(_,d,b),A=vs(_,d,E);I&&A||(this._active&&Ye(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function vs(m,a,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return a[_]}function ti(m,a){return Math.log(m/a)/Math.LN2}class Ph extends Xs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(ti(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ti(this._distance,_),pinchAround:d}}}function or(m,a){return 180*m.angleWith(a)/Math.PI}class Nl extends Xs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d){const _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:or(this._vector,_),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const b=or(a,_);return Math.abs(b)<d}}function Wr(m){return Math.abs(m.y)>Math.abs(m.x)}class fc extends Xs{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Wr(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,_){const b=this._lastPoints;if(!b)return;const E=a[0].sub(b[0]),I=a[1].sub(b[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(E,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(E.y+I.y)/2*-.5})}gestureBeginsVertically(a,d,_){if(void 0!==this._valid)return this._valid;const b=a.mag()>=2,E=d.mag()>=2;if(!b&&!E)return;if(!b||!E)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=a.y>0==d.y>0;return Wr(a)&&Wr(d)&&I}}const sl={panStep:100,bearingStep:15,pitchStep:10};class al{constructor(){const a=sl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,_=0,b=0,E=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),E=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),E=1);break;case 38:a.shiftKey?b=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?b=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:kr,zoom:d?Math.round(R)+d*(a.shiftKey?2:1):R,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-I*this._panStep],center:A.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kr(m){return m*(2-m)}const Rh=4.000244140625;class Ro{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=a.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=u.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%Rh==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=_t(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Rh?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==B&&(B=1/B);const z=d(),H=Math.pow(2,z),K="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(K*B))),"wheel"===this._type&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,E=this._easing;let I,A=!1;if("wheel"===this._type&&b&&E){const R=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),B=E(R);I=u.number(b,_,B),R<1?this._frameId||(this._frameId=!0):A=!0}else I=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:I-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=u.ease;if(this._prevEase){const _=this._prevEase,b=(u.exported.now()-_.start)/_.duration,E=_.easing(b+.01)-_.easing(b),I=.27/Math.sqrt(E*E+1e-4)*.01,A=Math.sqrt(.0729-I*I);d=u.bezier(I,A,.25,1)}return this._prevEase={start:u.exported.now(),duration:a,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class bo{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ro{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,d){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pc{constructor(){this._tap=new _n({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,d,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,d,_))}touchmove(a,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=d[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,a.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(a,d,_)}touchend(a,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(a,d,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu{constructor(a,d,_){this._el=a,this._mousePan=d,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ys{constructor(a,d,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nd{constructor(a,d,_,b){this._el=a,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xs=m=>m.zoom||m.drag||m.pitch||m.rotate;class Qf extends u.Event{}class xy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,d){const _=u.sub([],d,a);this.radius=u.length(_[2]<0?u.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){u.div(a,a,this.constants),u.normalize(a,a),u.mul$1(a,a,this.constants);const d=u.scale$2([],a,this.radius);if(d[2]>0){const _=u.scale$2([],[0,0,1],u.dot(d,[0,0,1])),b=u.scale$2([],u.normalize([],[d[0],d[1],0]),this.radius),E=u.add([],d,u.scale$2([],u.sub([],u.add([],b,_),d),2));d[0]=E[0],d[1]=E[1]}return d}}function Ks(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Pa{constructor(a,d){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new x(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),u.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[b,E,I]of this._listeners)b.addEventListener(E,b===u.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,d,_]of this._listeners)a.removeEventListener(d,a===u.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new je(d,a));const b=d.boxZoom=new bt(d,a);this._add("boxZoom",b);const E=new Lr,I=new ro;d.doubleClickZoom=new bo(I,E),this._add("tapZoom",E),this._add("clickZoom",I);const A=new pc;this._add("tapDragZoom",A);const R=d.touchPitch=new fc(d);this._add("touchPitch",R);const B=new Ws(a),z=new ys(a);d.dragRotate=new Ys(a,B,z),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new Er(a),K=new Go(d,a);d.dragPan=new Nu(_,H,K),this._add("mousePan",H),this._add("touchPan",K,["touchZoom","touchRotate"]);const te=new Nl,ie=new Ph;d.touchZoomRotate=new Nd(_,ie,te,A),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Le(d));const ne=d.scrollZoom=new Ro(d,this);this._add("scrollZoom",ne,["mousePan"]);const re=d.keyboard=new al;this._add("keyboard",re);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[G]&&d[G].enable(a[G])}_add(a,d,_){this._handlers.push({handlerName:a,handler:d,allowed:_}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,d,_){for(const b in a)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const d=[];for(const _ of a)this._el.contains(_.target)&&d.push(_);return d}handleEvent(a,d){this._updatingCamera=!0;const _="renderFrame"===a.type,b=_?void 0:a,E={needsRenderFrame:!1},I={},A={},R=a.touches?this._getMapTouches(a.touches):void 0,B=R?Ue(this._el,R):_?void 0:_t(this._el,a);for(const{handlerName:K,handler:te,allowed:ie}of this._handlers){if(!te.isEnabled())continue;let ne;this._blockedByActive(A,ie,K)?te.reset():te[d||a.type]&&(ne=te[d||a.type](a,B,R),this.mergeHandlerResult(E,I,ne,K,b),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||te.isActive())&&(A[K]=te)}const z={};for(const K in this._previousActiveHandlers)A[K]||(z[K]=b);this._previousActiveHandlers=A,(Object.keys(z).length||Ks(E))&&(this._changes.push([E,I,z]),this._triggerRenderFrame()),(Object.keys(A).length||Ks(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=E;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(a,d,_,b,E){if(!_)return;u.extend(a,_);const I={handlerName:b,originalEvent:_.originalEvent||E};void 0!==_.zoomDelta&&(d.zoom=I),void 0!==_.panDelta&&(d.drag=I),void 0!==_.pitchDelta&&(d.pitch=I),void 0!==_.bearingDelta&&(d.rotate=I)}_applyChanges(){const a={},d={},_={};for(const[b,E,I]of this._changes)b.panDelta&&(a.panDelta=(a.panDelta||new u.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(a.around=b.around),void 0!==b.aroundCoord&&(a.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(a.pinchAround=b.pinchAround),b.noInertia&&(a.noInertia=b.noInertia),u.extend(d,E),u.extend(_,I);this._updateMapTransform(a,d,_),this._changes=[]}_updateMapTransform(a,d,_){const b=this._map,E=b.transform,I=ee=>[ee.x,ee.y,ee.z];if((ee=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!Ks(a)){const ee=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",ee!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!Ks(a))return void this._fireEvents(d,_,!0);let{panDelta:A,zoomDelta:R,bearingDelta:B,pitchDelta:z,around:H,aroundCoord:K,pinchAround:te}=a;E._isCameraConstrained&&(R>0&&(R=0),E._isCameraConstrained=!1),void 0!==te&&(H=te),(R||(ee=>d.drag&&!this._eventsInProgress.drag)())&&H&&(this._dragOrigin=I(E.pointCoordinate3D(H)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),H=H||b.transform.centerPoint,B&&(E.bearing+=B),z&&(E.pitch+=z),E._updateCameraState();const ie=[0,0,0];if(A)if("mercator"===E.projection.name){const ee=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H).dir),le=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H.sub(A)).dir);ie[0]=le[0]-ee[0],ie[1]=le[1]-ee[1]}else{const ee=E.pointCoordinate(H);if("globe"===E.projection.name){A=A.rotate(-E.angle);const le=E._pixelsPerMercatorPixel/E.worldSize;ie[0]=-A.x*u.mercatorScale(u.latFromMercatorY(ee.y))*le,ie[1]=-A.y*u.mercatorScale(E.center.lat)*le}else{const le=E.pointCoordinate(H.sub(A));ee&&le&&(ie[0]=le.x-ee.x,ie[1]=le.y-ee.y)}}const ne=E.zoom,re=[0,0,0];if(R){const ee=I(K||E.pointCoordinate3D(H)),le={dir:u.normalize([],u.sub([],ee,E._camera.position))};if(le.dir[2]<0){const ce=E.zoomDeltaToMovement(ee,R);u.scale$2(re,le.dir,ce)}}const G=u.add(ie,ie,re);E._translateCameraConstrained(G),R&&Math.abs(E.zoom-ne)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,_,!0)}_fireEvents(a,d,_){const b=xs(this._eventsInProgress),E=xs(a),I={};for(const z in a){const{originalEvent:H}=a[z];this._eventsInProgress[z]||(I[`${z}start`]=H),this._eventsInProgress[z]=a[z]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const z in I)this._fireEvent(z,I[z]);E&&this._fireEvent("move",E.originalEvent);for(const z in a){const{originalEvent:H}=a[z];this._fireEvent(z,H)}const A={};let R;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:K}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],R=d[H]||K,A[`${z}end`]=R)}for(const z in A)this._fireEvent(z,A[z]);const B=xs(this._eventsInProgress);if(_&&(b||E)&&!B){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:R})):(this._map.fire(new u.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new u.Event(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Qf("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Wc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fd extends u.Evented{constructor(a,d){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=!1!==d.respectPrefersReducedMotion,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,_){return a=u.Point.convert(a).mult(-1),this.panTo(this.transform.center,u.extend({offset:a},d),_)}panTo(a,d,_){return this.easeTo(u.extend({center:a},d),_)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,_){return this.easeTo(u.extend({zoom:a},d),_)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,_){return this.easeTo(u.extend({bearing:a},d),_)}resetNorth(a,d){return this.rotateTo(0,u.extend({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=u.LngLatBounds.convert(a);const _=d&&d.bearing||0,b=d&&d.pitch||0,E=a.getNorthWest(),I=a.getSouthEast();return this._cameraForBounds(this.transform,E,I,_,b,d)}_extendCameraOptions(a){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=u.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const _=a.padding;a.padding={top:_,bottom:_,right:_,left:_}}return a.padding=u.extend(d,a.padding),a}_minimumAABBFrustumDistance(a,d){const _=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return _/b>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):b/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,d,_,b,E,I){const A=a.clone(),R=this._extendCameraOptions(I);A.bearing=b,A.pitch=E;const B=u.LngLat.convert(d),z=u.LngLat.convert(_),H=.5*(B.lat+z.lat),K=.5*(B.lng+z.lng),te=u.latLngToECEF(H,K),ie=u.normalize([],te),ne=u.normalize([],u.cross([],ie,[0,1,0])),re=u.cross([],ne,ie),G=[ne[0],ne[1],ne[2],0,re[0],re[1],re[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],ee=[te,u.latLngToECEF(B.lat,B.lng),u.latLngToECEF(z.lat,B.lng),u.latLngToECEF(z.lat,z.lng),u.latLngToECEF(B.lat,z.lng),u.latLngToECEF(H,B.lng),u.latLngToECEF(H,z.lng),u.latLngToECEF(B.lat,K),u.latLngToECEF(z.lat,K)];let le=u.Aabb.fromPoints(ee.map(ut=>[u.dot(ne,ut),u.dot(re,ut),u.dot(ie,ut)]));const ce=u.transformMat4([],le.center,G);0===u.squaredLength(ce)&&u.set(ce,0,0,1),u.normalize(ce,ce),u.scale$2(ce,ce,u.GLOBE_RADIUS),A.center=u.ecefToLatLng(ce);const be=A.getWorldToCameraMatrix(),Ee=u.invert(new Float64Array(16),be);le=u.Aabb.applyTransform(le,u.multiply([],be,G)),u.transformMat4(ce,ce,be);const we=.5*(le.max[2]-le.min[2]),ke=this._minimumAABBFrustumDistance(A,le),Ie=u.scale$2([],[0,0,1],we),Ge=u.add(Ie,ce,Ie),vt=ke+(0===A.pitch?0:u.distance(ce,Ge)),Be=A.globeCenterInViewSpace,st=u.sub([],ce,[Be[0],Be[1],Be[2]]);u.normalize(st,st),u.scale$2(st,st,vt);const Xe=u.add([],ce,st);u.transformMat4(Xe,Xe,Ee);const gt=u.earthRadius/u.GLOBE_RADIUS,He=u.length(Xe),rt=u.mercatorZfromAltitude(Math.max(He*gt-u.earthRadius,Number.EPSILON),0),wt=Math.min(A.zoomFromMercatorZAdjusted(rt),R.maxZoom);return wt>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=wt,this._cameraForBounds(A,d,_,b,E,I)):{center:A.center,zoom:wt,bearing:b,pitch:E}}queryTerrainElevation(a,d){const _=this.transform.elevation;return _?(d=u.extend({},{exaggerated:!0},d),_.getAtPoint(u.MercatorCoordinate.fromLngLat(a),null,d.exaggerated)):null}_cameraForBounds(a,d,_,b,E,I){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,d,_,b,E,I);const A=a.clone(),R=this._extendCameraOptions(I),B=A.padding;A.bearing=b,A.pitch=E;const z=u.LngLat.convert(d),H=u.LngLat.convert(_),K=new u.LngLat(z.lng,H.lat),te=new u.LngLat(H.lng,z.lat),ie=A.project(z),ne=A.project(H),re=this.queryTerrainElevation(z),G=this.queryTerrainElevation(H),ee=this.queryTerrainElevation(K),le=this.queryTerrainElevation(te),ce=[[ie.x,ie.y,Math.min(re||0,G||0,ee||0,le||0)],[ne.x,ne.y,Math.max(re||0,G||0,ee||0,le||0)]];let be=u.Aabb.fromPoints(ce);const Ee=A.getWorldToCameraMatrix(),we=u.invert(new Float64Array(16),Ee);be=u.Aabb.applyTransform(be,Ee);const ke=u.sub([],be.max,be.min),Ie=B.left||0,Ge=B.right||0,vt=B.bottom||0,Be=B.top||0,{left:st,right:Xe,top:gt,bottom:He}=R.padding,rt=.5*(Ie+Ge),wt=.5*(Be+vt),ut=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Ie+Ge+st+Xe))/ke[0],(A.height-(vt+Be+He+gt))/ke[1])),R.maxZoom),Tt=A.scale/A.zoomScale(ut);be=new u.Aabb([be.min[0]-(st+rt)*Tt,be.min[1]-(He+wt)*Tt,be.min[2]],[be.max[0]+(Xe+rt)*Tt,be.max[1]+(gt+wt)*Tt,be.max[2]]);const ln=.5*ke[2],Pn=this._minimumAABBFrustumDistance(A,be),Jt=[0,0,1,0];u.transformMat4$1(Jt,Jt,Ee),u.normalize$2(Jt,Jt);const vn=u.scale$2([],Jt,Pn+ln),Kn=u.add([],be.center,vn),Yn=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new u.Point(R.offset.x,R.offset.y):u.Point.convert(R.offset)).rotate(-u.degToRad(b));be.center[0]-=Yn.x*Tt,be.center[1]+=Yn.y*Tt,u.transformMat4(be.center,be.center,we),u.transformMat4(Kn,Kn,we);const Wt=[be.center[0],be.center[1],Kn[2]*A.pixelsPerMeter];u.scale$2(Wt,Wt,1/A.worldSize);const xi=u.lngFromMercatorX(Wt[0]),Pi=u.latFromMercatorY(Wt[1]),Ri=Math.min(A._zoomFromMercatorZ(Wt[2]),R.maxZoom),Ei=new u.LngLat(xi,Pi);return A.mercatorFromTransition&&Ri<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Ri,this._cameraForBounds(A,d,_,b,E,I)):{center:Ei,zoom:Ri,bearing:b,pitch:E}}fitBounds(a,d,_){const b=this.cameraForBounds(a,d);return this._fitInternal(b,d,_)}fitScreenCoordinates(a,d,_,b,E){const I=u.Point.convert(a),A=u.Point.convert(d),R=new u.Point(Math.min(I.x,A.x),Math.min(I.y,A.y)),B=new u.Point(Math.max(I.x,A.x),Math.max(I.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,A))return this;const z=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(B),K=this.transform.pointLocation3D(new u.Point(R.x,B.y)),te=this.transform.pointLocation3D(new u.Point(B.x,R.y)),ie=[Math.min(z.lng,H.lng,K.lng,te.lng),Math.min(z.lat,H.lat,K.lat,te.lat)],ne=[Math.max(z.lng,H.lng,K.lng,te.lng),Math.max(z.lat,H.lat,K.lat,te.lat)],re=b&&b.pitch?b.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,ie,ne,_,re,b);return this._fitInternal(G,b,E)}_fitInternal(a,d,_){return a?(delete(d=u.extend(a,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(a,d){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,I=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(b=!0,_.zoom=+a.zoom),void 0!==a.center&&(_.center=u.LngLat.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(E=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(I=!0,_.pitch=+a.pitch),null==a.padding||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new u.Event("movestart",d)).fire(new u.Event("move",d)),b&&this.fire(new u.Event("zoomstart",d)).fire(new u.Event("zoom",d)).fire(new u.Event("zoomend",d)),E&&this.fire(new u.Event("rotatestart",d)).fire(new u.Event("rotate",d)).fire(new u.Event("rotateend",d)),I&&this.fire(new u.Event("pitchstart",d)).fire(new u.Event("pitch",d)).fire(new u.Event("pitchend",d)),this.fire(new u.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(Wc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return u.warnOnce(Wc),this;this.stop();const b=_.zoom,E=_.pitch,I=_.bearing;_.setFreeCameraOptions(a);const A=b!==_.zoom,R=E!==_.pitch,B=I!==_.bearing;return this.fire(new u.Event("movestart",d)).fire(new u.Event("move",d)),A&&this.fire(new u.Event("zoomstart",d)).fire(new u.Event("zoom",d)).fire(new u.Event("zoomend",d)),B&&this.fire(new u.Event("rotatestart",d)).fire(new u.Event("rotate",d)).fire(new u.Event("rotateend",d)),R&&this.fire(new u.Event("pitchstart",d)).fire(new u.Event("pitch",d)).fire(new u.Event("pitchend",d)),this.fire(new u.Event("moveend",d)),this}easeTo(a,d){this._stop(!1,a.easeId),(!1===(a=u.extend({offset:[0,0],duration:500,easing:u.ease},a)).animate||this._prefersReducedMotion(a))&&(a.duration=0);const _=this.transform,b=this.getZoom(),E=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in a?+a.zoom:b,B="bearing"in a?this._normalizeBearing(a.bearing,E):E,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,K=u.Point.convert(a.offset);let te,ie,ne;if("globe"===_.projection.name){const Ie=u.MercatorCoordinate.fromLngLat(_.center),Ge=K.rotate(-_.angle);Ie.x+=Ge.x/_.worldSize,Ie.y+=Ge.y/_.worldSize;const vt=Ie.toLngLat(),Be=u.LngLat.convert(a.center||vt);this._normalizeCenter(Be),te=_.centerPoint.add(Ge),ie=new u.Point(Ie.x,Ie.y).mult(_.worldSize),ne=new u.Point(u.mercatorXfromLng(Be.lng),u.mercatorYfromLat(Be.lat)).mult(_.worldSize).sub(ie)}else{te=_.centerPoint.add(K);const Ie=_.pointLocation(te),Ge=u.LngLat.convert(a.center||Ie);this._normalizeCenter(Ge),ie=_.project(Ie),ne=_.project(Ge).sub(ie)}const re=_.zoomScale(R-b);let G,ee;a.around&&(G=u.LngLat.convert(a.around),ee=_.locationPoint(G));const le=this._zooming||R!==b,ce=this._rotating||E!==B,be=this._pitching||z!==I,Ee=!_.isPaddingEqual(H),we=Ie=>Ge=>{if(le&&(Ie.zoom=u.number(b,R,Ge)),ce&&(Ie.bearing=u.number(E,B,Ge)),be&&(Ie.pitch=u.number(I,z,Ge)),Ee&&(Ie.interpolatePadding(A,H,Ge),te=Ie.centerPoint.add(K)),G)Ie.setLocationAtPoint(G,ee);else{const vt=Ie.zoomScale(Ie.zoom-b),Be=R>b?Math.min(2,re):Math.max(.5,re),st=Math.pow(Be,1-Ge),Xe=Ie.unproject(ie.add(ne.mult(Ge*st)).mult(vt));Ie.setLocationAtPoint(Ie.renderWorldCopies?Xe.wrap():Xe,te)}return a.preloadOnly||this._fireMoveEvents(d),Ie};if(a.preloadOnly){const Ie=this._emulate(we,a.duration,_);return this._preloadTiles(Ie),this}const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=ce,this._pitching=be,this._padding=Ee,this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,ke),this._ease(we(_),Ie=>{_.recenterOnTerrain(),this._afterEase(d,Ie)},a),this}_prepareEase(a,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new u.Event("movestart",a)),this._zooming&&!_.zooming&&this.fire(new u.Event("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new u.Event("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new u.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new u.Event("move",a)),this._zooming&&this.fire(new u.Event("zoom",a)),this._rotating&&this.fire(new u.Event("rotate",a)),this._pitching&&this.fire(new u.Event("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new u.Event("zoomend",a)),b&&this.fire(new u.Event("rotateend",a)),E&&this.fire(new u.Event("pitchend",a)),this.fire(new u.Event("moveend",a))}flyTo(a,d){if(this._prefersReducedMotion(a)){const ut=u.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,d)}this.stop(),a=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},a);const _=this.transform,b=this.getZoom(),E=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in a?u.clamp(+a.zoom,_.minZoom,_.maxZoom):b,B="bearing"in a?this._normalizeBearing(a.bearing,E):E,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,K=_.zoomScale(R-b),te=u.Point.convert(a.offset);let ie=_.centerPoint.add(te);const ne=_.pointLocation(ie),re=u.LngLat.convert(a.center||ne);this._normalizeCenter(re);const G=_.project(ne),ee=_.project(re).sub(G);let le=a.curve;const ce=Math.max(_.width,_.height),be=ce/K,Ee=ee.mag();if("minZoom"in a){const ut=u.clamp(Math.min(a.minZoom,b,R),_.minZoom,_.maxZoom),Tt=ce/_.zoomScale(ut-b);le=Math.sqrt(Tt/Ee*2)}const we=le*le;function ke(ut){const Tt=(be*be-ce*ce+(ut?-1:1)*we*we*Ee*Ee)/(2*(ut?be:ce)*we*Ee);return Math.log(Math.sqrt(Tt*Tt+1)-Tt)}function Ie(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function Ge(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const vt=ke(0);let Be=function(ut){return Ge(vt)/Ge(vt+le*ut)},st=function(ut){return ce*((Ge(vt)*(Ie(Tt=vt+le*ut)/Ge(Tt))-Ie(vt))/we)/Ee;var Tt},Xe=(ke(1)-vt)/le;if(Math.abs(Ee)<1e-6||!isFinite(Xe)){if(Math.abs(ce-be)<1e-6)return this.easeTo(a,d);const ut=be<ce?-1:1;Xe=Math.abs(Math.log(be/ce))/le,st=function(){return 0},Be=function(Tt){return Math.exp(ut*le*Tt)}}a.duration="duration"in a?+a.duration:1e3*Xe/("screenSpeed"in a?+a.screenSpeed/le:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const gt=E!==B,He=z!==I,rt=!_.isPaddingEqual(H),wt=ut=>Tt=>{const ln=Tt*Xe,Pn=1/Be(ln);ut.zoom=1===Tt?R:b+ut.scaleZoom(Pn),gt&&(ut.bearing=u.number(E,B,Tt)),He&&(ut.pitch=u.number(I,z,Tt)),rt&&(ut.interpolatePadding(A,H,Tt),ie=ut.centerPoint.add(te));const Jt=1===Tt?re:ut.unproject(G.add(ee.mult(st(ln))).mult(Pn));return ut.setLocationAtPoint(ut.renderWorldCopies?Jt.wrap():Jt,ie),ut._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(d),ut};if(a.preloadOnly){const ut=this._emulate(wt,a.duration,_);return this._preloadTiles(ut),this}return this._zooming=!0,this._rotating=gt,this._pitching=He,this._padding=rt,this._prepareEase(d,!1),this._ease(wt(_),()=>this._afterEase(d),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,d,_){!1===_.animate||0===_.duration?(a(1),d()):(this._easeStart=u.exported.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,d){a=u.wrap(a,-180,180);const _=Math.abs(a-d);return Math.abs(a-360-d)<_&&(a-=360),Math.abs(a+360-d)<_&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=a.lng-d.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&u.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,d,_){const b=Math.ceil(15*d/1e3),E=[],I=a(_.clone());for(let A=0;A<=b;A++){const R=I(A/b);E.push(R.clone())}return E}}class Kt{constructor(a={}){this.options=a,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const d=this.options&&this.options.compact;return this._map=a,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae("button","mapboxgl-ctrl-attrib-button",this._container),Ae("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const _=this._map._getUIString(`AttributionControl.${d}`);a.setAttribute("aria-label",_),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(a){const _=d.reduce((b,E,I)=>(E.value&&(b+=`${E.key}=${E.value}${I<d.length-1?"&":""}`),b),"?");a.href=`${u.config.FEEDBACK_URL}/${_}#${Ol(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const E=d[b];if(E.used){const I=E.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((b,E)=>b.length-E.length),a=a.filter((b,E)=>{for(let I=E+1;I<a.length;I++)if(a[I].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ep{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Ae("div","mapboxgl-ctrl");const d=Ae("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const d in a){const _=a[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class tp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const b of _)if(b.id===a)return void(b.cancelled=!0)}run(a=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fu(m,a,d){if(m=new u.LngLat(m.lng,m.lat),a){const _=new u.LngLat(m.lng-360,m.lat),b=new u.LngLat(m.lng+360,m.lat),E=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),I=d.locationPoint(m).distSqr(a),A=a.x<0||a.y<0||a.x>d.width||a.y>d.height;d.locationPoint(_).distSqr(a)<I&&(A||Math.abs(_.lng-d.center.lng)<E)?m=_:d.locationPoint(b).distSqr(a)<I&&(A||Math.abs(b.lng-d.center.lng)<E)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const Xc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jt extends u.Evented{constructor(a,d){if(super(),(a instanceof u.window.HTMLElement||d)&&(a=u.extend({element:a},d)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=u.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae("div");const b=41,E=27,I=pt("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),A=pt("radialGradient",{id:"shadowGradient"},pt("defs",{},I));pt("stop",{offset:"10%","stop-opacity":.4},A),pt("stop",{offset:"100%","stop-opacity":.05},A),pt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),pt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),pt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),pt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=u.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in Xc)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=u.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const d=a.code,_=a.charCode||a.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(a){const d=a.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,d=this._pos;if(!a||!d)return!1;const _=a.unproject(d),b=a.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(_)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const d=this._pos;if(!d||d.x<0||d.x>a.transform.width||d.y<0||d.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(d);let b;a._showingGlobe()&&u.isLngLatBehindGlobe(a.transform,this._lngLat)?b=0:(b=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${Xc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${d.x}px,${d.y}px)\n        `}_calculateXYTransform(){const a=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!a||"map"!==_)return"";if(!d._showingGlobe()){const R=d.getPitch();return R?`rotateX(${R}deg)`:""}const b=u.radToDeg(u.globeTiltAtLngLat(d.transform,this._lngLat)),E=a.sub(u.globeCenterToScreenPoint(d.transform)),I=Math.abs(E.x)+Math.abs(E.y);if(0===I)return"";const A=b/I;return`rotateX(${-E.y*A}deg) rotateY(${E.x*A}deg)`}_calculateZTransform(){const a=this._pos,d=this._map;if(!d||!a)return"";let _=0;const b=this.getRotationAlignment();if("map"===b)if(d._showingGlobe()){const E=d.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=d.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);_=u.radToDeg(Math.atan2(I.y,I.x))-90}else _=-d.getBearing();else if("horizon"===b){const E=u.smoothstep(4,6,d.getZoom()),I=u.globeCenterToScreenPoint(d.transform);I.y+=E*d.transform.height;const A=a.sub(I),R=u.radToDeg(Math.atan2(A.y,A.x));_=(R>90?R-270:R+90)*(1-E)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){u.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Fu(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===a?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=u.Point.convert(a),this._update(),this}_onMove(a){const d=this._map;if(!d)return;const _=this._pointerdownPos,b=this._positionDelta;if(_&&b){if(!this._isDragging){const E=this._clickTolerance||d._clickTolerance;if(a.point.dist(_)<E)return;this._isDragging=!0}this._pos=a.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(a){const d=this._map,_=this._pos;d&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const d=this._map;return d&&(a?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const np={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},by=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ym(m=new u.Point(0,0),a="bottom"){if("number"==typeof m){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new u.Point(0,m);case"top-left":return new u.Point(d,d);case"top-right":return new u.Point(-d,d);case"bottom":return new u.Point(0,-m);case"bottom-left":return new u.Point(d,-d);case"bottom-right":return new u.Point(-d,-d);case"left":return new u.Point(m,0);case"right":return new u.Point(-m,0)}return new u.Point(0,0)}return m instanceof u.Point||Array.isArray(m)?u.Point.convert(m):u.Point.convert(m[a]||[0,0])}class ip{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const d=u.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,d,_){this._start=this.getValue(d),this._end=a,this._startTime=d,this._endTime=d+_}}const zd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Bd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},wy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ey{constructor(a,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Ws({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new ys({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(a,d){this.mouseRotate.mousedown(a,d),this.mousePitch&&this.mousePitch.mousedown(a,d),Lt()}move(a,d){const _=this.map,b=this.mouseRotate.mousemoveWindow(a,d),E=b&&b.bearingDelta;if(E&&_.setBearing(_.getBearing()+E),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,d),A=I&&I.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){At(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(u.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),_t(this.element,a)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,_t(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ue(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=Ue(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const rp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ll={maxWidth:100,unit:"metric"},Ra={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zu={version:u.version,supported:Me,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends Fd{constructor(m){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(m=u.extend({},Bd,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(m.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ia(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new tp,this._domRenderTaskQueue=new tp,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},zd,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ip(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=u.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Pa(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new ol("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,u.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Kt({customAttribution:m.customAttribution})),this._logoControl=new ep,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new u.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new u.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(m,a){if(void 0===a&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[a];return-1!==a.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new u.Event("movestart",m)).fire(new u.Event("move",m)),this.fire(new u.Event("resize",m)),a&&this.fire(new u.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(u.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?u.window.navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(a=>"auto"===a?u.window.navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,a=m.projection.name;let d;"globe"===a&&m.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),d=!0):"mercator"===a&&m.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;if(a="globe"===m.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(u.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(u.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,d){if("mouseenter"===m||"mouseover"===m){let _=!1;const b=I=>{const A=a.filter(B=>this.getLayer(B)),R=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];R.length?_||(_=!0,d.call(this,new U(m,this,I.originalEvent,{features:R}))):_=!1},E=()=>{_=!1};return{layers:new Set(a),listener:d,delegates:{mousemove:b,mouseout:E}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const b=I=>{const A=a.filter(R=>this.getLayer(R));(A.length?this.queryRenderedFeatures(I.point,{layers:A}):[]).length?_=!0:_&&(_=!1,d.call(this,new U(m,this,I.originalEvent)))},E=I=>{_&&(_=!1,d.call(this,new U(m,this,I.originalEvent)))};return{layers:new Set(a),listener:d,delegates:{mousemove:b,mouseout:E}}}{const _=b=>{const E=a.filter(A=>this.getLayer(A)),I=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];I.length&&(b.features=I,d.call(this,b),delete b.features)};return{layers:new Set(a),listener:d,delegates:{[m]:_}}}}on(m,a,d){if(void 0===d)return super.on(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,a,d){if(void 0===d)return super.once(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,d);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,a,d){if(void 0===d)return super.off(m,a);a=new Set(Array.isArray(a)?a:[a]);const _=(E,I)=>{if(E.size!==I.size)return!1;for(const A of E)if(!I.has(A))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(E=>{for(let I=0;I<E.length;I++){const A=E[I];if(A.listener===d&&_(A.layers,a)){for(const R in A.delegates)this.off(R,A.delegates[R]);return E.splice(I,1),this}}})(b),this}queryRenderedFeatures(m,a){return this.style?(void 0!==a||void 0===m||m instanceof u.Point||Array.isArray(m)||(a=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(m,a){return this.style.querySourceFeatures(m,a)}isPointOnSurface(m){const{name:a}=this.transform.projection;return"globe"!==a&&"mercator"!==a&&u.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(u.Point.convert(m))}setStyle(m,a){return!1!==(a=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(null==a)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Bt(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,a){if("string"==typeof m){const d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,u.ResourceType.Style);u.getJSON(_,(b,E)=>{b?this.fire(new u.ErrorEvent(b)):E&&this._updateDiff(E,a)})}else"object"==typeof m&&this._updateDiff(m,a)}_updateDiff(m,a){try{this.style.setState(m)&&this._update(!0)}catch(d){u.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(m,a){return this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const a in m){const d=m[a]._tiles;for(const _ in d){const b=d[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(m,a,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,a,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:E,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap){const{width:A,height:R,data:B}=u.exported.getImageData(a);this.style.addImage(m,{data:new u.RGBAImage({width:A,height:R},B),pixelRatio:d,stretchX:b,stretchY:E,content:I,sdf:_,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=a,B=a;this.style.addImage(m,{data:new u.RGBAImage({width:A,height:R},new Uint8Array(B.data)),pixelRatio:d,stretchX:b,stretchY:E,content:I,sdf:_,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,a){const d=this.style.getImage(m);if(!d)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap?u.exported.getImageData(a):a,{width:b,height:E}=_;void 0!==b&&void 0!==E?b===d.data.width&&E===d.data.height?(d.data.replace(_.data,!(a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})\n                must be that same as the previous version of the image\n                (${d.data.width}, ${d.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){u.getImage(this._requestManager.transformRequest(m,u.ResourceType.Image),(d,_)=>{a(d,_ instanceof u.window.HTMLImageElement?u.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,a){return this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)}moveLayer(m,a){return this.style.moveLayer(m,a),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,a,d){return this.style.setLayerZoomRange(m,a,d),this._update(!0)}setFilter(m,a,d={}){return this.style.setFilter(m,a,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,a,d,_={}){return this.style.setPaintProperty(m,a,d,_),this._update(!0)}getPaintProperty(m,a){return this.style.getPaintProperty(m,a)}setLayoutProperty(m,a,d,_={}){return this.style.setLayoutProperty(m,a,d,_),this._update(!0)}getLayoutProperty(m,a){return this.style.getLayoutProperty(m,a)}setLight(m,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(m),this.transform):0}setFeatureState(m,a){return this.style.setFeatureState(m,a),this._update()}removeFeatureState(m,a){return this.style.removeFeatureState(m,a),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let d,_,b,E=this._container;for(;E&&(!_||!b);){const I=u.window.getComputedStyle(E).transform;I&&"none"!==I&&(d=I.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(_=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),E=E.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=b?Math.abs(a/b):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Ae("div","mapboxgl-canvas-container",m);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Ae("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=Ae("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=Ae("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const d=u.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);-1!==a&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const m=u.extend({},Me.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",m),d=a||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);d?(this._useWebGL2&&!a&&u.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),u.storeAuthState(d,!0),this.painter=new nl(d,this.transform,!!a),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(d)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;const d=this.painter.context.extTimerQuery,_=u.exported.now();if(this.listens("gpu-timing-frame")&&(a=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,B=u.exported.now(),z=new u.EvaluationParameters(A,{now:B,fadeDuration:b,pitch:R,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const A=u.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,a),setTimeout(()=>{const R=d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(a),this.fire(new u.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),u.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new u.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(E=this._updateAverageElevation(_,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const I=Math.abs(_-b);if(I>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,m,300)}else if(I>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===u.AUTH_ERR_MSG||401===m.status)){const a=this.painter.context.gl;u.storeAuthState(a,!1),this._logoControl instanceof ep&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function b(E){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,E,0);const I=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,I),I}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),a.canvasCopies.map(b),a.timeStamps)}_canvasPixelComparison(m,a,d){let _=d[1]-d[0];const b=m.length/4;for(let E=0;E<a.length;E++){const I=a[E];let A=0;for(let R=0;R<I.length;R+=4)I[R]===m[R]&&I[R+1]===m[R+1]&&I[R+2]===m[R+2]&&I[R+3]===m[R+3]&&(A+=1);_+=(d[E+2]-d[E+1])*(1-A/b)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1),u.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=u.exported.frame(a=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(a)}))}_preloadTiles(m){const a=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(a,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===u.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,a){u.setCacheLimits(m,a)}get version(){return u.version}},NavigationControl:class{constructor(m){this.options=u.extend({},wy,m),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:a}):d.resetNorth({},{originalEvent:a}))}),this._compassIcon=Ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),d=a===m.getMaxZoom(),_=a===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ey(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const d=Ae("button",m,this._container);return d.type="button",d.addEventListener("click",a),d}_setButtonTitle(m,a){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends u.Evented{constructor(m){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},rp,m),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Aa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(d=>a("denied"!==d.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),d=m.coords;return!!a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",m)),this._finish()}}_updateCamera(m){const a=new u.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),b=u.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new u.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=u.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Ae("button","mapboxgl-ctrl-geolocate",this._container),Ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kt,ScaleControl:class{constructor(m){this.options=u.extend({},ll,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,d=a._containerHeight/2,_=a._containerWidth/2-m/2,b=a.unproject([_,d]),E=a.unproject([_+m,d]),I=b.distanceTo(E);if("imperial"===this.options.unit){const A=3.2808*I;A>5280?this._setScale(m,A/5280,"mile"):this._setScale(m,A,"foot")}else"nautical"===this.options.unit?this._setScale(m,I/1852,"nautical-mile"):I>=1e3?this._setScale(m,I/1e3,"kilometer"):this._setScale(m,I,"meter")}_setScale(m,a,d){this._map._requestDomTask(()=>{const _=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let A=E/I;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(A),I*A}(a),b=_/a;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==d?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(_):`${_}&nbsp;${Ra[d]}`,this._container.style.width=m*b+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof u.window.HTMLElement?this._container=m.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(m){super(),this.options=u.extend(Object.create(np),m),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=u.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(u.window.document.createTextNode(m))}setHTML(m){const a=u.window.document.createDocumentFragment(),d=u.window.document.createElement("body");let _;for(d.innerHTML=m;_=d.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Ae("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const d=this._closeButton=Ae("button","mapboxgl-popup-close-button",a);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,d=this._container,_=this._pos;if(!a||!d||!_)return"bottom";const b=d.offsetWidth,E=d.offsetHeight,I=_.x<b/2,A=_.x>a.transform.width-b/2;if(_.y+m<E)return I?"top-left":A?"top-right":"top";if(_.y>a.transform.height-E){if(I)return"bottom-left";if(A)return"bottom-right"}return I?"left":A?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,d=this._content;if(!a||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=Ae("div","mapboxgl-popup",a.getContainer()),this._tip=Ae("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fu(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m?m:a.project(this._lngLat),E=Ym(this.options.offset),I=this._anchor=this._getAnchor(E.y),A=Ym(this.options.offset,I),R=b.add(A).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Xc[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&a._showingGlobe()){const b=u.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(by);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:jt,Style:Bt,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.Point,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:il,Evented:u.Evented,config:u.config,prewarm:function(){_a().acquire(zo)},clearPrewarmedResources:function(){const m=wr;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(zo),wr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(m){u.config.ACCESS_TOKEN=m},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(m){u.config.API_URL=m},get workerCount(){return Ir.workerCount},set workerCount(m){Ir.workerCount=m},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){u.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){u.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return zu}),dt}()},681:function(Ht){var dt;dt=function(){var $t="",_e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function dt(Me){return Me.match(_e)||[]}function Te(Me){return{language:(Me=dt(Me))[1]||$t,extlang:Me[2]||$t,script:Me[3]||$t,region:Me[4]||$t}}function u(Me,Pe,Se){Object.defineProperty(Me,Pe,{value:Se,enumerable:!0})}function Q(Me,Pe,Se){function Ae(pt){return dt(pt)[Me]||$t}u(Ae,"pattern",Pe),u(Te,Se,Ae)}return Q(1,/^[a-zA-Z]{2,3}$/,"language"),Q(2,/^[a-zA-Z]{3}$/,"extlang"),Q(3,/^[a-zA-Z]{4}$/,"script"),Q(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),u(Te,"split",function ze(Me){return dt(Me).filter(function(Pe,Se){return Pe&&Se})}),Te},Ht.exports?Ht.exports=dt():this.subtag=dt()},28:(Ht,$t,_e)=>{"use strict";var dt=_e(603);Ht.exports=dt,typeof window<"u"&&(window.Suggestions=dt)},331:Ht=>{"use strict";var $t=function(_e){return this.component=_e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,_e.el.parentNode.insertBefore(this.wrapper,_e.el.nextSibling),this};$t.prototype.show=function(){this.element.style.display="block"},$t.prototype.hide=function(){this.element.style.display="none"},$t.prototype.add=function(_e){this.items.push(_e)},$t.prototype.clear=function(){this.items=[],this.active=0},$t.prototype.isEmpty=function(){return!this.items.length},$t.prototype.isVisible=function(){return"block"===this.element.style.display},$t.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var _e=0;_e<this.items.length;_e++)this.drawItem(this.items[_e],this.active===_e);this.show()}else this.hide()},$t.prototype.drawItem=function(_e,dt){var ze=document.createElement("li"),Te=document.createElement("a");dt&&(ze.className+=" active"),Te.innerHTML=_e.string,ze.appendChild(Te),this.element.appendChild(ze),ze.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),ze.addEventListener("mouseup",function(){this.handleMouseUp.call(this,_e)}.bind(this))},$t.prototype.handleMouseUp=function(_e){this.selectingListItem=!1,this.component.value(_e.original),this.clear(),this.draw()},$t.prototype.move=function(_e){this.active=_e,this.draw()},$t.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},$t.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},$t.prototype.drawError=function(_e){var dt=document.createElement("li");dt.innerHTML=_e,this.element.appendChild(dt),this.show()},Ht.exports=$t},603:(Ht,$t,_e)=>{"use strict";var dt=_e(498),ze=_e(424),Te=_e(331),u=function(Q,Me,Pe){return this.options=dt({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Pe=Pe||{}),this.el=Q,this.data=Me||[],this.list=new Te(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(Se){this.handleKeyUp(Se.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(Se){this.handleKeyDown(Se)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(Se){this.handlePaste(Se)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};u.prototype.handleKeyUp=function(Q){40===Q||38===Q||27===Q||13===Q||9===Q||this.handleInputChange(this.el.value)},u.prototype.handleKeyDown=function(Q){switch(Q.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&Q.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},u.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},u.prototype.handlePaste=function(Q){if(Q.clipboardData)this.handleInputChange(Q.clipboardData.getData("Text"));else{var Me=this;setTimeout(function(){Me.handleInputChange(Q.target.value)},100)}},u.prototype.handleInputChange=function(Q){this.query=this.normalize(Q),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Me){for(var Pe=0;Pe<Me.length&&(this.list.add(Me[Pe]),Pe!==this.options.limit-1);Pe++);this.list.draw()}.bind(this))},u.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},u.prototype.update=function(Q){this.data=Q,this.handleKeyUp()},u.prototype.clear=function(){this.data=[],this.list.clear()},u.prototype.normalize=function(Q){return Q.toLowerCase()},u.prototype.match=function(Q,Me){return Q.indexOf(Me)>-1},u.prototype.value=function(Q){if(this.selected=Q,this.el.value=this.getItemValue(Q),document.createEvent){var Me=document.createEvent("HTMLEvents");Me.initEvent("change",!0,!1),this.el.dispatchEvent(Me)}else this.el.fireEvent("onchange")},u.prototype.getCandidates=function(Q){var Me={pre:"<strong>",post:"</strong>",extract:function(Se){return this.getItemValue(Se)}.bind(this)};Q(this.options.filter?ze.filter(this.query,this.data,Me).map(function(Se){return{original:Se.original,string:this.render(Se.original,Se.string)}}.bind(this)):this.data.map(function(Se){return{original:Se,string:this.render(Se)}}.bind(this)))},u.prototype.getItemValue=function(Q){return Q},u.prototype.render=function(Q,Me){if(Me)return Me;for(var Pe=this.getItemValue(Q.original?Q.original:Q),Se=this.normalize(Pe),Ae=Se.lastIndexOf(this.query);Ae>-1;){var pt=Ae+this.query.length;Pe=Pe.slice(0,Ae)+"<strong>"+Pe.slice(Ae,pt)+"</strong>"+Pe.slice(pt),Ae=Se.slice(0,Ae).lastIndexOf(this.query)}return Pe},u.prototype.renderError=function(Q){this.list.drawError(Q)},Ht.exports=u},498:Ht=>{Ht.exports=function _e(){for(var dt={},ze=0;ze<arguments.length;ze++){var Te=arguments[ze];for(var u in Te)$t.call(Te,u)&&(dt[u]=Te[u])}return dt};var $t=Object.prototype.hasOwnProperty},630:(Ht,$t,_e)=>{"use strict";_e.d($t,{x0:()=>u});let u=(Q=21)=>crypto.getRandomValues(new Uint8Array(Q)).reduce((Me,Pe)=>Me+((Pe&=63)<36?Pe.toString(36):Pe<62?(Pe-26).toString(36).toUpperCase():Pe>62?"-":"_"),"")}},Ht=>{Ht(Ht.s=378)}]);