(self.webpackChunkbuscaPersonaFree=self.webpackChunkbuscaPersonaFree||[]).push([[179],{406:(Zt,qt,_e)=>{"use strict";var gt=_e(564),Ve=_e(498),u="\n  ",Q={};function Me(kt){var he=Array.isArray(kt);return function($e){var ke=Le(Q.plainArray,$e);if(ke)return ke;if(he&&$e.length!==kt.length)return"an array with "+kt.length+" items";for(var at=0;at<$e.length;at++)if(ke=Le(he?kt[at]:kt,$e[at]))return[at].concat(ke)}}function Le(kt,he){if(null!=he||kt.hasOwnProperty("__required")){var Je=kt(he);if(Je)return Array.isArray(Je)?Je:[Je]}}function Ae(kt,he){var Je=kt.length,bt=kt[Je-1],$e=kt.slice(0,Je-1);return 0===$e.length&&($e=["value"]),he=Ve(he,{path:$e}),"function"==typeof bt?bt(he):Bt(he,function yt(kt){return"must be "+function Yt(kt){return/^an? /.test(kt)?kt:/^[aeiou]/i.test(kt)?"an "+kt:/^[a-z]/i.test(kt)?"a "+kt:kt}(kt)+"."}(bt))}function Bt(kt,he){return(St(kt.path)?"Item at position ":"")+kt.path.join(".")+" "+he}function St(kt){return"number"==typeof kt[kt.length-1]||"number"==typeof kt[0]}Q.assert=function(kt,he){return he=he||{},function(Je){var bt=Le(kt,Je);if(bt){var $e=Ae(bt,he);throw he.apiName&&($e=he.apiName+": "+$e),new Error($e)}}},Q.shape=function(he){var Je=function Nt(kt){return Object.keys(kt||{}).map(function(he){return{key:he,value:kt[he]}})}(he);return function($e){var ke=Le(Q.plainObject,$e);if(ke)return ke;for(var at,Ot=[],Wt=0;Wt<Je.length;Wt++)(ke=Le(Je[Wt].value,$e[at=Je[Wt].key]))&&Ot.push([at].concat(ke));return Ot.length<2?Ot[0]:function(Lt){Ot=Ot.map(function($i){return"- "+$i[0]+": "+Ae($i,Lt).split("\n").join(u)});var Cn=Lt.path.join(".");return"The following properties"+("value"===Cn?"":" of "+Cn)+" have invalid values:"+u+Ot.join(u)}}},Q.strictShape=function(he){var Je=Q.shape(he);return function($e){var ke=Je($e);if(ke)return ke;var at=Object.keys($e).reduce(function(Fe,Ot){return void 0===he[Ot]&&Fe.push(Ot),Fe},[]);return 0!==at.length?function(){return"The following keys are invalid: "+at.join(", ")}:void 0}},Q.arrayOf=function(he){return Me(he)},Q.tuple=function(){return Me(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},Q.required=function(he){function Je(bt){return null==bt?function($e){return Bt($e,St($e.path)?"cannot be undefined/null.":"is required.")}:he.apply(this,arguments)}return Je.__required=!0,Je},Q.oneOfType=function(){var he=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(bt){var $e=he.map(function(ke){return Le(ke,bt)}).filter(Boolean);if($e.length===he.length)return $e.every(function(ke){return 1===ke.length&&"string"==typeof ke[0]})?function Re(kt){return kt.length<2?kt[0]:2===kt.length?kt.join(" or "):kt.slice(0,-1).join(", ")+", or "+kt.slice(-1)}($e.map(function(ke){return ke[0]})):$e.reduce(function(ke,at){return at.length>ke.length?at:ke})}},Q.equal=function(he){return function(bt){if(bt!==he)return JSON.stringify(he)}},Q.oneOf=function(){var Je=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(bt){return Q.equal(bt)});return Q.oneOfType.apply(this,Je)},Q.range=function(he){var Je=he[0],bt=he[1];return function(ke){if(Le(Q.number,ke)||ke<Je||ke>bt)return"number between "+Je+" & "+bt+" (inclusive)"}},Q.any=function(){},Q.boolean=function(he){if("boolean"!=typeof he)return"boolean"},Q.number=function(he){if("number"!=typeof he)return"number"},Q.plainArray=function(he){if(!Array.isArray(he))return"array"},Q.plainObject=function(he){if(!gt(he))return"object"},Q.string=function(he){if("string"!=typeof he)return"string"},Q.func=function(he){if("function"!=typeof he)return"function"},Q.validate=Le,Q.processMessage=Ae,Zt.exports=Q},564:Zt=>{"use strict";var qt=Object.prototype.toString;Zt.exports=function(_e){var gt;return"[object Object]"===qt.call(_e)&&(null===(gt=Object.getPrototypeOf(_e))||gt===Object.getPrototypeOf({}))}},805:(Zt,qt,_e)=>{"use strict";var gt=_e(630).x0;function Ve(Te){this.origin=Te.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=Te.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=Te,this.send=this.send.bind(this),this.countries=Te.countries?Te.countries.split(","):null,this.types=Te.types?Te.types.split(","):null,this.bbox=Te.bbox?Te.bbox:null,this.language=Te.language?Te.language.split(","):null,this.limit=Te.limit?+Te.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(Te),this.eventQueue=new Array,this.flushInterval=Te.flushInterval||1e3,this.maxQueueSize=Te.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Ve.prototype={select:function(Te,u){var Q=this.getSelectedIndex(Te,u),Me=this.getEventPayload("search.select",u);if(Me.resultIndex=Q,Me.resultPlaceName=Te.place_name,Me.resultId=Te.id,(Q!==this.lastSentIndex||Me.queryString!==this.lastSentInput)&&-1!=Q&&(this.lastSentIndex=Q,this.lastSentInput=Me.queryString,Me.queryString))return this.push(Me)},start:function(Te){var u=this.getEventPayload("search.start",Te);if(u.queryString)return this.push(u)},keyevent:function(Te,u){if(Te.key&&!Te.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(Te.keyCode)){var Q=this.getEventPayload("search.keystroke",u);if(Q.lastAction=Te.key,Q.queryString)return this.push(Q)}},send:function(Te,u){if(!this.enableEventLogging)return u?u():void 0;var Q=this.getRequestOptions(Te);this.request(Q,function(Me){return Me?this.handleError(Me,u):u?u():void 0}.bind(this))},getRequestOptions:function(Te){return Array.isArray(Te)||(Te=[Te]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(Te)}},getEventPayload:function(Te,u){var Q;Q=u.options.proximity?"object"==typeof u.options.proximity?[u.options.proximity.longitude,u.options.proximity.latitude]:"ip"===u.options.proximity?[999,999]:u.options.proximity:null;var Me=u._map?u._map.getZoom():void 0,Le={event:Te,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:u.options.autocomplete,fuzzyMatch:u.options.fuzzyMatch,proximity:Q,limit:u.options.limit,routing:u.options.routing,worldview:u.options.worldview,mapZoom:Me,keyboardLocale:this.locale};return Le.queryString="search.select"===Te?u.inputString:"search.select"!=Te&&u._inputEl?u._inputEl.value:u.inputString,Le},request:function(Te,u){var Q=new XMLHttpRequest;for(var Me in Q.onreadystatechange=function(){if(4==this.readyState)return u(204==this.status?null:this.statusText)},Q.open(Te.method,Te.host+"/"+Te.path,!0),Te.headers)Q.setRequestHeader(Me,Te.headers[Me]);Q.send(Te.body)},handleError:function(Te,u){if(u)return u(Te)},generateSessionID:function(){return gt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(Te,u){if(u._typeahead){var Me=Te.id;return u._typeahead.data.map(function(Re){return Re.id}).indexOf(Me)}},shouldEnableLogging:function(Te){return!(!1===Te.enableEventLogging||Te.origin&&"https://api.mapbox.com"!==Te.origin||Te.localGeocoder||Te.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(Te,u){this.eventQueue.push(Te),(this.eventQueue.length>=this.maxQueueSize||u)&&this.flush()},remove:function(){this.flush()}},Zt.exports=Ve},280:Zt=>{Zt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},272:Zt=>{function qt(){}qt.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const _e={enableHighAccuracy:!0};return new Promise(function(gt,Ve){window.navigator.geolocation.getCurrentPosition(gt,Ve,_e)})}},Zt.exports=qt},904:(Zt,qt,_e)=>{"use strict";var gt=_e(28),Ve=_e(220),Te=_e(498),u=_e(16).EventEmitter,Q=_e(280),Me=_e(658),Le=_e(725),Ae=_e(805),Re=_e(251),yt=_e(681),Yt=_e(272),Bt=_e(485);function kt(he){this._eventEmitter=new u,this.options=Te({},this.options,he),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Yt}kt.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(he){return he.place_name},render:function(he){var Je=he.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Je[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Je.splice(1,Je.length).join(",")+"</div></div>"}},addTo:function(he){function Je(bt,$e){if(!document.body.contains($e))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ke=bt.onAdd();$e.appendChild(ke)}if(he._controlContainer)he.addControl(this);else if(he instanceof HTMLElement)Je(this,he);else{if("string"!=typeof he)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const bt=document.querySelectorAll(he);if(0===bt.length)throw new Error("Element ",he,"not found.");if(bt.length>1)throw new Error("Geocoder can only be added to a single html element");Je(this,bt[0])}}},onAdd:function(he){if(he&&"string"!=typeof he&&(this._map=he),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Le(Me({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Ae(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var Je=this.container=document.createElement("div");Je.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var bt=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Ve(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(Lt){this.eventManager.keyevent(Lt,this)}.bind(this));var $e=document.createElement("div");$e.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ke=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ke),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),$e.appendChild(this._clearEl),$e.appendChild(this._loadingEl),Je.appendChild(bt),Je.appendChild(this._inputEl),Je.appendChild($e),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var at=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(at),$e.appendChild(this._geolocateEl),this._showGeolocateButton()}var Fe=this._typeahead=new gt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Fe.getItemValue=this.options.getItemValue;var Ot=Fe.list.draw,Wt=this._footerNode=function Nt(){var he=document.createElement("div");return he.className="mapboxgl-ctrl-geocoder--powered-by",he.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',he}();return Fe.list.draw=function(){Ot.call(this),Wt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Wt.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(Wt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Je},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(he){this._hideLoadingIcon();const Je={geometry:{type:"Point",coordinates:[he.coords.longitude,he.coords.latitude]}};this._handleMarker(Je),this._fly(Je),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(Je),this._showClearButton(),this.fresh=!1;const bt={limit:1,language:[this.options.language],query:Je.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(Je.geometry.coordinates[0]+","+Je.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:Je})):this.geocoderService.reverseGeocode(bt).send().then(function($e){const ke=$e.body.features[0];if(ke){const at=Bt.transformFeatureToGeolocationText(ke,this.options.addressAccuracy);this._setInputValue(at),ke.user_coordinates=Je.geometry.coordinates,this._eventEmitter.emit("result",{result:ke})}else this._eventEmitter.emit("result",{result:{user_coordinates:Je.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(he){1===he.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(he,Je){var bt=document.createElementNS("http://www.w3.org/2000/svg","svg");return bt.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+he),bt.setAttribute("viewBox","0 0 18 18"),bt.setAttribute("xml:space","preserve"),bt.setAttribute("width",18),bt.setAttribute("height",18),bt.innerHTML=Je,bt},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(he){this._inputEl.value=he,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(he){var Je=(he.clipboardData||window.clipboardData).getData("text");Je.length>=this.options.minLength&&this._geocode(Je)},_onKeyDown:function(he){var Je=27,bt=9;if(he.keyCode===Je&&this.options.clearAndBlurOnEsc)return this._clear(he),this._inputEl.blur();var $e=he.target&&he.target.shadowRoot?he.target.shadowRoot.activeElement:he.target;if(!$e||!$e.value)return this.fresh=!0,he.keyCode!==bt&&this.clear(he),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!he.metaKey&&-1===[bt,Je,37,39,13,38,40].indexOf(he.keyCode)&&$e.value.length>=this.options.minLength&&this._geocode($e.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(he){this.options.clearOnBlur&&this._clearOnBlur(he),this.options.collapsed&&this._collapse()},_onChange:function(){var he=this._typeahead.selected;he&&JSON.stringify(he)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(he),this.options.marker&&this._mapboxgl&&this._handleMarker(he),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(he),this._eventEmitter.emit("result",{result:he}),this.eventManager.select(he,this))},_fly:function(he){var Je;if(he.properties&&Q[he.properties.short_code])Je=Te({},this.options.flyTo),this._map&&this._map.fitBounds(Q[he.properties.short_code].bbox,Je);else if(he.bbox){var bt=he.bbox;Je=Te({},this.options.flyTo),this._map&&this._map.fitBounds([[bt[0],bt[1]],[bt[2],bt[3]]],Je)}else Je=Te({},{zoom:this.options.zoom},this.options.flyTo),he.center?Je.center=he.center:he.geometry&&he.geometry.type&&"Point"===he.geometry.type&&he.geometry.coordinates&&(Je.center=he.geometry.coordinates),this._map&&this._map.flyTo(Je)},_requestType:function(he,Je){return he.localGeocoderOnly?1:he.reverseGeocode&&Bt.REVERSE_GEOCODE_COORD_RGX.test(Je)?2:0},_setupConfig:function(he,Je){const $e=/[\s,]+/;var ke=this,at=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(Ot,Wt){return null==ke.options[Wt]||(Ot[Wt]=["countries","types","language"].indexOf(Wt)>-1?ke.options[Wt].split($e):ke.options[Wt],"proximity"===Wt&&"number"==typeof ke.options[Wt].longitude&&"number"==typeof ke.options[Wt].latitude&&(Ot[Wt]=[ke.options[Wt].longitude,ke.options[Wt].latitude])),Ot},{});switch(he){case 2:var Fe=Je.split($e).map(function(Ot){return parseFloat(Ot,10)});ke.options.flipCoordinates||Fe.reverse(),at=Te(at,{query:Fe,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Ot){Ot in at&&delete at[Ot]});break;case 0:{const Ot=Je.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(Ot)&&(Je=Je.replace(/,/g," ")),at=Te(at,{query:Je})}}return at},_geocode:function(he){this.inputString=he,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:he});const Je=this._requestType(this.options,he),bt=this._setupConfig(Je,he);var $e;switch(Je){case 1:$e=Promise.resolve();break;case 0:$e=this.geocoderService.forwardGeocode(bt).send();break;case 2:$e=this.geocoderService.reverseGeocode(bt).send()}var ke=this.options.localGeocoder&&this.options.localGeocoder(he)||[],at=[],Fe=null;return $e.catch(function(Ot){Fe=Ot}.bind(this)).then(function(Ot){this._hideLoadingIcon();var Wt={};return Ot?"200"==Ot.statusCode&&((Wt=Ot.body).request=Ot.request,Wt.headers=Ot.headers):Wt={type:"FeatureCollection",features:[]},Wt.config=bt,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Wt.features=Wt.features?ke.concat(Wt.features):ke,this.options.externalGeocoder?(at=this.options.externalGeocoder(he,Wt.features)||Promise.resolve([])).then(function(Lt){return Wt.features=Wt.features?Lt.concat(Wt.features):Lt,Wt},function(){return Wt}):Wt}.bind(this)).then(function(Ot){if(Fe)throw Fe;this.options.filter&&Ot.features.length&&(Ot.features=Ot.features.filter(this.options.filter)),Ot.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",Ot),this._typeahead.update(Ot.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Ot))}.bind(this)).catch(function(Ot){this._hideLoadingIcon(),this._hideAttribution(),ke.length&&this.options.localGeocoder||at.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ke)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ke}),this._eventEmitter.emit("error",{error:Ot})}.bind(this)),$e},_clear:function(he){he&&he.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(he){this._clear(he),this._inputEl.focus()},_clearOnBlur:function(he){he.relatedTarget&&this._clear(he)},_onQueryResult:function(he){var Je=he.body;if(Je.features.length){var bt=Je.features[0];this._typeahead.selected=bt,this._inputEl.value=bt.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var he=this._map.getCenter().wrap();this.setProximity({longitude:he.lng,latitude:he.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(he){return this._geocode(he).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(he){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(he)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var he=this.options.language.split(",")[0],Je=yt.language(he),bt=Re.placeholder[Je];if(bt)return bt}return"Search"},setInput:function(he){return this._inputEl.value=he,this._typeahead.selected=null,this._typeahead.clear(),he.length>=this.options.minLength&&this._geocode(he),this},setProximity:function(he,Je=!0){return this.options.proximity=he,Je&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(he){return he&&"function"==typeof he&&(this._typeahead.render=he),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(he){var Je=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=he||this.options.language||Je,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(he){return this.options.zoom=he,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(he){return this.options.flyTo=he,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(he){return this.placeholder=he||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(he){return this.options.bbox=he,this},getCountries:function(){return this.options.countries},setCountries:function(he){return this.options.countries=he,this},getTypes:function(){return this.options.types},setTypes:function(he){return this.options.types=he,this},getMinLength:function(){return this.options.minLength},setMinLength:function(he){return this.options.minLength=he,this._typeahead&&(this._typeahead.options.minLength=he),this},getLimit:function(){return this.options.limit},setLimit:function(he){return this.options.limit=he,this._typeahead&&(this._typeahead.options.limit=he),this},getFilter:function(){return this.options.filter},setFilter:function(he){return this.options.filter=he,this},setOrigin:function(he){return this.options.origin=he,this.geocoderService=Le(Me({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(he){return this.options.accessToken=he,this.geocoderService=Le(Me({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(he){return this.options.autocomplete=he,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(he){return this.options.fuzzyMatch=he,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(he){return this.options.routing=he,this},getRouting:function(){return this.options.routing},setWorldview:function(he){return this.options.worldview=he,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(he){if(this._map){this._removeMarker();var bt=Te({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(bt),he.center?this.mapMarker.setLngLat(he.center).addTo(this._map):he.geometry&&he.geometry.type&&"Point"===he.geometry.type&&he.geometry.coordinates&&this.mapMarker.setLngLat(he.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(he,Je){return this._eventEmitter.on(he,Je),this},off:function(he,Je){return this._eventEmitter.removeListener(he,Je),this.eventManager.remove(),this}},Zt.exports=kt},251:Zt=>{"use strict";Zt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},485:Zt=>{function _e(Ve){const Te=Ve.address||"",u=Ve.text||"",Q=Ve.place_name||"",Le={address:Q.split(",")[0],houseNumber:Te,street:u,placeName:Q};return Ve.context.forEach(function(Ae){const Re=Ae.id.split(".")[0];Le[Re]=Ae.text}),Le}Zt.exports={transformFeatureToGeolocationText:function qt(Ve,Te){const u=_e(Ve),Q=["address","street","place","country"];if("function"==typeof Te)return Te(u);const Le=Q.indexOf(Te);return(-1===Le?Q:Q.slice(Le)).reduce(function(Ae,Re){return u[Re]?(""!==Ae&&(Ae+=", "),Ae+u[Re]):Ae},"")},getAddressInfo:_e,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},658:(Zt,qt,_e)=>{"use strict";var gt=_e(819);Zt.exports=gt},819:(Zt,qt,_e)=>{"use strict";var gt=_e(561),Ve=_e(983);function Te(Q){Ve.call(this,Q)}(Te.prototype=Object.create(Ve.prototype)).constructor=Te,Te.prototype.sendRequest=gt.browserSend,Te.prototype.abortRequest=gt.browserAbort,Zt.exports=function u(Q){return new Te(Q)}},561:(Zt,qt,_e)=>{"use strict";var gt=_e(896),Ve=_e(43),Te=_e(889),u=_e(17),Q={};function Ae(Bt){var St=Bt.total,Nt=Bt.loaded;return{total:St,transferred:Nt,percent:100*Nt/St}}function Re(Bt,St){return new Promise(function(Nt,kt){St.onprogress=function(bt){Bt.emitter.emit(Te.EVENT_PROGRESS_DOWNLOAD,Ae(bt))};var he=Bt.file;he&&(St.upload.onprogress=function(bt){Bt.emitter.emit(Te.EVENT_PROGRESS_UPLOAD,Ae(bt))}),St.onerror=function(bt){kt(bt)},St.onabort=function(){var bt=new Ve({request:Bt,type:Te.ERROR_REQUEST_ABORTED});kt(bt)},St.onload=function(){if(delete Q[Bt.id],St.status<200||St.status>=400){var bt=new Ve({request:Bt,body:St.response,statusCode:St.status});kt(bt)}else Nt(St)};var Je=Bt.body;"string"==typeof Je?St.send(Je):Je?St.send(JSON.stringify(Je)):he?St.send(he):St.send(),Q[Bt.id]=St}).then(function(Nt){return function Le(Bt,St){return new gt(Bt,{body:St.response,headers:u(St.getAllResponseHeaders()),statusCode:St.status})}(Bt,Nt)})}function yt(Bt,St){var Nt=Bt.url(St),kt=new window.XMLHttpRequest;return kt.open(Bt.method,Nt),Object.keys(Bt.headers).forEach(function(he){kt.setRequestHeader(he,Bt.headers[he])}),kt}Zt.exports={browserAbort:function Me(Bt){var St=Q[Bt.id];St&&(St.abort(),delete Q[Bt.id])},sendRequestXhr:Re,browserSend:function Yt(Bt){return Promise.resolve().then(function(){var St=yt(Bt,Bt.client.accessToken);return Re(Bt,St)})},createRequestXhr:yt}},983:(Zt,qt,_e)=>{"use strict";var gt=_e(746),Ve=_e(323),Te=_e(889);function u(Q){if(!Q||!Q.accessToken)throw new Error("Cannot create a client without an access token");gt(Q.accessToken),this.accessToken=Q.accessToken,this.origin=Q.origin||Te.API_ORIGIN}u.prototype.createRequest=function(Me){return new Ve(this,Me)},Zt.exports=u},43:(Zt,qt,_e)=>{"use strict";var gt=_e(889);Zt.exports=function Ve(Te){var Q,u=Te.type||gt.ERROR_HTTP;if(Te.body)try{Q=JSON.parse(Te.body)}catch{Q=Te.body}else Q=null;var Me=Te.message||null;Me||("string"==typeof Q?Me=Q:Q&&"string"==typeof Q.message?Me=Q.message:u===gt.ERROR_REQUEST_ABORTED&&(Me="Request aborted")),this.message=Me,this.type=u,this.statusCode=Te.statusCode||null,this.request=Te.request,this.body=Q}},323:(Zt,qt,_e)=>{"use strict";var gt=_e(746),Ve=_e(498),Te=_e(81),u=_e(51),Q=_e(889),Me=1;function Le(Ae,Re){if(!Ae)throw new Error("MapiRequest requires a client");if(!Re||!Re.path||!Re.method)throw new Error("MapiRequest requires an options object with path and method properties");var yt={};Re.body&&(yt["content-type"]="application/json");var Yt=Ve(yt,Re.headers),Bt=Object.keys(Yt).reduce(function(St,Nt){return St[Nt.toLowerCase()]=Yt[Nt],St},{});this.id=Me++,this._options=Re,this.emitter=new Te,this.client=Ae,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=Re.path,this.method=Re.method,this.origin=Re.origin||Ae.origin,this.query=Re.query||{},this.params=Re.params||{},this.body=Re.body||null,this.file=Re.file||null,this.encoding=Re.encoding||"utf8",this.sendFileAs=Re.sendFileAs||null,this.headers=Bt}Le.prototype.url=function(Re){var yt=u.prependOrigin(this.path,this.origin);yt=u.appendQueryObject(yt,this.query);var Yt=this.params,Bt=Re??this.client.accessToken;if(Bt){yt=u.appendQueryParam(yt,"access_token",Bt);var St=gt(Bt).user;Yt=Ve({ownerId:St},Yt)}return u.interpolateRouteParams(yt,Yt)},Le.prototype.send=function(){var Re=this;if(Re.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return Re.sent=!0,Re.client.sendRequest(Re).then(function(yt){return Re.response=yt,Re.emitter.emit(Q.EVENT_RESPONSE,yt),yt},function(yt){throw Re.error=yt,Re.emitter.emit(Q.EVENT_ERROR,yt),yt})},Le.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Le.prototype.eachPage=function(Re){var yt=this;function Yt(Nt){Re(null,Nt,function kt(){delete yt._nextPageRequest;var he=Nt.nextPage();he&&(yt._nextPageRequest=he,St(he))})}function Bt(Nt){Re(Nt,null,function(){})}function St(Nt){Nt.send().then(Yt,Bt)}St(this)},Le.prototype.clone=function(){return this._extend()},Le.prototype._extend=function(Re){var yt=Ve(this._options,Re);return new Le(this.client,yt)},Zt.exports=Le},896:(Zt,qt,_e)=>{"use strict";var gt=_e(295);function Ve(Te,u){this.request=Te,this.headers=u.headers,this.rawBody=u.body,this.statusCode=u.statusCode;try{this.body=JSON.parse(u.body||"{}")}catch{this.body=u.body}this.links=gt(this.headers.link)}Ve.prototype.hasNextPage=function(){return!!this.links.next},Ve.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Zt.exports=Ve},889:Zt=>{"use strict";Zt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},17:Zt=>{"use strict";Zt.exports=function _e(gt){var Ve={};return gt&&gt.trim().split(/[\r|\n]+/).forEach(function(Te){var u=function qt(gt){var Ve=gt.indexOf(":");return{name:gt.substring(0,Ve).trim().toLowerCase(),value:gt.substring(Ve+1).trim()}}(Te);Ve[u.name]=u.value}),Ve}},295:Zt=>{"use strict";Zt.exports=function gt(Ve){return Ve?Ve.split(/,\s*</).reduce(function(Te,u){var Q=function _e(Ve){var Te=Ve.match(/<?([^>]*)>(.*)/);if(!Te)return null;var u=Te[1],Q=Te[2].split(";"),Me=null,Le=Q.reduce(function(Ae,Re){var yt=function qt(Ve){var Te=Ve.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return Te?{key:Te[1],value:Te[2]}:null}(Re);return yt?"rel"===yt.key?(Me||(Me=yt.value),Ae):(Ae[yt.key]=yt.value,Ae):Ae},{});return Me?{url:u,rel:Me,params:Le}:null}(u);return Q?(Q.rel.split(/\s+/).forEach(function(Le){Te[Le]||(Te[Le]={url:Q.url,params:Q.params})}),Te):Te},{}):{}}},51:Zt=>{"use strict";function _e(Q){return Array.isArray(Q)?function qt(Q){return Q.map(encodeURIComponent).join(",")}(Q):encodeURIComponent(String(Q))}function gt(Q,Me,Le){if(!1===Le||null===Le)return Q;var Ae=/\?/.test(Q)?"&":"?",Re=encodeURIComponent(Me);return void 0!==Le&&""!==Le&&!0!==Le&&(Re+="="+_e(Le)),""+Q+Ae+Re}Zt.exports={appendQueryObject:function Ve(Q,Me){if(!Me)return Q;var Le=Q;return Object.keys(Me).forEach(function(Ae){var Re=Me[Ae];void 0!==Re&&(Array.isArray(Re)&&(Re=Re.filter(function(yt){return null!=yt}).join(",")),Le=gt(Le,Ae,Re))}),Le},appendQueryParam:gt,prependOrigin:function Te(Q,Me){if(!Me||"http"===Q.slice(0,4))return Q;var Le="/"===Q[0]?"":"/";return""+Me.replace(/\/$/,"")+Le+Q},interpolateRouteParams:function u(Q,Me){return Me?Q.replace(/\/:([a-zA-Z0-9]+)/g,function(Le,Ae){var Re=Me[Ae];if(void 0===Re)throw new Error("Unspecified route parameter "+Ae);return"/"+_e(Re)}):Q}}},81:Zt=>{"use strict";var qt=Object.prototype.hasOwnProperty,_e="~";function gt(){}function Ve(Me,Le,Ae){this.fn=Me,this.context=Le,this.once=Ae||!1}function Te(Me,Le,Ae,Re,yt){if("function"!=typeof Ae)throw new TypeError("The listener must be a function");var Yt=new Ve(Ae,Re||Me,yt),Bt=_e?_e+Le:Le;return Me._events[Bt]?Me._events[Bt].fn?Me._events[Bt]=[Me._events[Bt],Yt]:Me._events[Bt].push(Yt):(Me._events[Bt]=Yt,Me._eventsCount++),Me}function u(Me,Le){0==--Me._eventsCount?Me._events=new gt:delete Me._events[Le]}function Q(){this._events=new gt,this._eventsCount=0}Object.create&&(gt.prototype=Object.create(null),(new gt).__proto__||(_e=!1)),Q.prototype.eventNames=function(){var Ae,Re,Le=[];if(0===this._eventsCount)return Le;for(Re in Ae=this._events)qt.call(Ae,Re)&&Le.push(_e?Re.slice(1):Re);return Object.getOwnPropertySymbols?Le.concat(Object.getOwnPropertySymbols(Ae)):Le},Q.prototype.listeners=function(Le){var Re=this._events[_e?_e+Le:Le];if(!Re)return[];if(Re.fn)return[Re.fn];for(var yt=0,Yt=Re.length,Bt=new Array(Yt);yt<Yt;yt++)Bt[yt]=Re[yt].fn;return Bt},Q.prototype.listenerCount=function(Le){var Re=this._events[_e?_e+Le:Le];return Re?Re.fn?1:Re.length:0},Q.prototype.emit=function(Le,Ae,Re,yt,Yt,Bt){var St=_e?_e+Le:Le;if(!this._events[St])return!1;var he,Je,Nt=this._events[St],kt=arguments.length;if(Nt.fn){switch(Nt.once&&this.removeListener(Le,Nt.fn,void 0,!0),kt){case 1:return Nt.fn.call(Nt.context),!0;case 2:return Nt.fn.call(Nt.context,Ae),!0;case 3:return Nt.fn.call(Nt.context,Ae,Re),!0;case 4:return Nt.fn.call(Nt.context,Ae,Re,yt),!0;case 5:return Nt.fn.call(Nt.context,Ae,Re,yt,Yt),!0;case 6:return Nt.fn.call(Nt.context,Ae,Re,yt,Yt,Bt),!0}for(Je=1,he=new Array(kt-1);Je<kt;Je++)he[Je-1]=arguments[Je];Nt.fn.apply(Nt.context,he)}else{var $e,bt=Nt.length;for(Je=0;Je<bt;Je++)switch(Nt[Je].once&&this.removeListener(Le,Nt[Je].fn,void 0,!0),kt){case 1:Nt[Je].fn.call(Nt[Je].context);break;case 2:Nt[Je].fn.call(Nt[Je].context,Ae);break;case 3:Nt[Je].fn.call(Nt[Je].context,Ae,Re);break;case 4:Nt[Je].fn.call(Nt[Je].context,Ae,Re,yt);break;default:if(!he)for($e=1,he=new Array(kt-1);$e<kt;$e++)he[$e-1]=arguments[$e];Nt[Je].fn.apply(Nt[Je].context,he)}}return!0},Q.prototype.on=function(Le,Ae,Re){return Te(this,Le,Ae,Re,!1)},Q.prototype.once=function(Le,Ae,Re){return Te(this,Le,Ae,Re,!0)},Q.prototype.removeListener=function(Le,Ae,Re,yt){var Yt=_e?_e+Le:Le;if(!this._events[Yt])return this;if(!Ae)return u(this,Yt),this;var Bt=this._events[Yt];if(Bt.fn)Bt.fn===Ae&&(!yt||Bt.once)&&(!Re||Bt.context===Re)&&u(this,Yt);else{for(var St=0,Nt=[],kt=Bt.length;St<kt;St++)(Bt[St].fn!==Ae||yt&&!Bt[St].once||Re&&Bt[St].context!==Re)&&Nt.push(Bt[St]);Nt.length?this._events[Yt]=1===Nt.length?Nt[0]:Nt:u(this,Yt)}return this},Q.prototype.removeAllListeners=function(Le){var Ae;return Le?this._events[Ae=_e?_e+Le:Le]&&u(this,Ae):(this._events=new gt,this._eventsCount=0),this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.addListener=Q.prototype.on,Q.prefixed=_e,Q.EventEmitter=Q,Zt.exports=Q},725:(Zt,qt,_e)=>{"use strict";var gt=_e(498),Ve=_e(253),Te=_e(160),u=_e(193),Q=_e(981),Me={},Le=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Me.forwardGeocode=function(Ae){Ve.assertShape({query:Ve.required(Ve.string),mode:Ve.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ve.arrayOf(Ve.string),proximity:Ve.oneOf(Ve.coordinates,"ip"),types:Ve.arrayOf(Ve.oneOf(Le)),autocomplete:Ve.boolean,bbox:Ve.arrayOf(Ve.number),limit:Ve.number,language:Ve.arrayOf(Ve.string),routing:Ve.boolean,fuzzyMatch:Ve.boolean,worldview:Ve.string})(Ae),Ae.mode=Ae.mode||"mapbox.places";var Re=u(gt({country:Ae.countries},Te(Ae,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Te(Ae,["mode","query"]),query:Re})},Me.reverseGeocode=function(Ae){Ve.assertShape({query:Ve.required(Ve.coordinates),mode:Ve.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ve.arrayOf(Ve.string),types:Ve.arrayOf(Ve.oneOf(Le)),bbox:Ve.arrayOf(Ve.number),limit:Ve.number,language:Ve.arrayOf(Ve.string),reverseMode:Ve.oneOf("distance","score"),routing:Ve.boolean,worldview:Ve.string})(Ae),Ae.mode=Ae.mode||"mapbox.places";var Re=u(gt({country:Ae.countries},Te(Ae,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Te(Ae,["mode","query"]),query:Re})},Zt.exports=Q(Me)},981:(Zt,qt,_e)=>{"use strict";var gt=_e(983),Ve=_e(819);Zt.exports=function Te(u){return function(Q){var Me;Me=gt.prototype.isPrototypeOf(Q)?Q:Ve(Q);var Le=Object.create(u);return Le.client=Me,Le}}},99:Zt=>{"use strict";Zt.exports=function qt(_e,gt){return Object.keys(_e).reduce(function(Ve,Te){return Ve[Te]=gt(Te,_e[Te]),Ve},{})}},160:Zt=>{"use strict";Zt.exports=function qt(_e,gt){var Ve=function(Te,u){return-1!==gt.indexOf(Te)&&void 0!==u};return"function"==typeof gt&&(Ve=gt),Object.keys(_e).filter(function(Te){return Ve(Te,_e[Te])}).reduce(function(Te,u){return Te[u]=_e[u],Te},{})}},193:(Zt,qt,_e)=>{"use strict";var gt=_e(99);Zt.exports=function Ve(Te){return gt(Te,function(u,Q){return"boolean"==typeof Q?JSON.stringify(Q):Q})}},253:(Zt,qt,_e)=>{"use strict";var gt=_e(498),Ve=_e(406);Zt.exports=gt(Ve,{file:function Te(Le){return typeof window<"u"?Le instanceof global.Blob||Le instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Le&&void 0===Le.pipe?"Filename or Readable stream":void 0},date:function Q(Le){var Ae="date";if("boolean"==typeof Le)return Ae;try{var Re=new Date(Le);if(Re.getTime&&isNaN(Re.getTime()))return Ae}catch{return Ae}},coordinates:function Me(Le){return Ve.tuple(Ve.number,Ve.number)(Le)},assertShape:function u(Le,Ae){return Ve.assert(Ve.strictShape(Le),Ae)}})},746:(Zt,qt,_e)=>{"use strict";var gt=_e(391),Ve={};function Q(Me,Le){return Object.prototype.hasOwnProperty.call(Me,Le)}Zt.exports=function Te(Me){if(Ve[Me])return Ve[Me];var Le=Me.split("."),Ae=Le[0],Re=Le[1];if(!Re)throw new Error("Invalid token");var yt=function u(Me){try{return JSON.parse(gt.decode(Me))}catch{throw new Error("Invalid token")}}(Re),Yt={usage:Ae,user:yt.u};return Q(yt,"a")&&(Yt.authorization=yt.a),Q(yt,"exp")&&(Yt.expires=1e3*yt.exp),Q(yt,"iat")&&(Yt.created=1e3*yt.iat),Q(yt,"scopes")&&(Yt.scopes=yt.scopes),Q(yt,"client")&&(Yt.client=yt.client),Q(yt,"ll")&&(Yt.lastLogin=yt.ll),Q(yt,"iu")&&(Yt.impersonator=yt.iu),Ve[Me]=Yt,Yt}},724:(Zt,qt,_e)=>{"use strict";var gt={};_e.r(gt),_e.d(gt,{Decoder:()=>AE,Encoder:()=>pj,PacketType:()=>Fi,protocol:()=>m2});var Ve={};function Te(e){return"function"==typeof e}function u(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}_e.r(Ve),_e.d(Ve,{Manager:()=>Nx,Socket:()=>PE,connect:()=>Bd,default:()=>Bd,io:()=>Bd,protocol:()=>m2});const Q=u(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,l)=>`${l+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Me(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Le{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const f of t)f.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Te(r))try{r()}catch(f){n=f instanceof Q?f.errors:[f]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const f of l)try{yt(f)}catch(y){n=n??[],y instanceof Q?n=[...n,...y.errors]:n.push(y)}}if(n)throw new Q(n)}}add(n){var t;if(n&&n!==this)if(this.closed)yt(n);else{if(n instanceof Le){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&Me(t,n)}remove(n){const{_finalizers:t}=this;t&&Me(t,n),n instanceof Le&&n._removeParent(this)}}Le.EMPTY=(()=>{const e=new Le;return e.closed=!0,e})();const Ae=Le.EMPTY;function Re(e){return e instanceof Le||e&&"closed"in e&&Te(e.remove)&&Te(e.add)&&Te(e.unsubscribe)}function yt(e){Te(e)?e():e.unsubscribe()}const Yt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Bt={setTimeout(e,n,...t){const{delegate:r}=Bt;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Bt;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function St(e){Bt.setTimeout(()=>{const{onUnhandledError:n}=Yt;if(!n)throw e;n(e)})}function Nt(){}const kt=bt("C",void 0,void 0);function bt(e,n,t){return{kind:e,value:n,error:t}}let $e=null;function ke(e){if(Yt.useDeprecatedSynchronousErrorHandling){const n=!$e;if(n&&($e={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=$e;if($e=null,t)throw r}}else e()}class Fe extends Le{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Re(n)&&n.add(this)):this.destination=Er}static create(n,t,r){return new Cn(n,t,r)}next(n){this.isStopped?qr(function Je(e){return bt("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?qr(function he(e){return bt("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?qr(kt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ot=Function.prototype.bind;function Wt(e,n){return Ot.call(e,n)}class Lt{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){Ai(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){Ai(r)}else Ai(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){Ai(t)}}}class Cn extends Fe{constructor(n,t,r){let l;if(super(),Te(n)||!n)l={next:n??void 0,error:t??void 0,complete:r??void 0};else{let f;this&&Yt.useDeprecatedNextContext?(f=Object.create(n),f.unsubscribe=()=>this.unsubscribe(),l={next:n.next&&Wt(n.next,f),error:n.error&&Wt(n.error,f),complete:n.complete&&Wt(n.complete,f)}):l=n}this.destination=new Lt(l)}}function Ai(e){Yt.useDeprecatedSynchronousErrorHandling?function at(e){Yt.useDeprecatedSynchronousErrorHandling&&$e&&($e.errorThrown=!0,$e.error=e)}(e):St(e)}function qr(e,n){const{onStoppedNotification:t}=Yt;t&&Bt.setTimeout(()=>t(e,n))}const Er={closed:!0,next:Nt,error:function $i(e){throw e},complete:Nt},Tn="function"==typeof Symbol&&Symbol.observable||"@@observable";function wn(e){return e}function dn(e){return 0===e.length?wn:1===e.length?e[0]:function(t){return e.reduce((r,l)=>l(r),t)}}let In=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,l){const f=function Pi(e){return e&&e instanceof Fe||function Hi(e){return e&&Te(e.next)&&Te(e.error)&&Te(e.complete)}(e)&&Re(e)}(t)?t:new Cn(t,r,l);return ke(()=>{const{operator:y,source:C}=this;f.add(y?y.call(f,C):C?this._subscribe(f):this._trySubscribe(f))}),f}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=ii(r))((l,f)=>{const y=new Cn({next:C=>{try{t(C)}catch(D){f(D),y.unsubscribe()}},error:f,complete:l});this.subscribe(y)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Tn](){return this}pipe(...t){return dn(t)(this)}toPromise(t){return new(t=ii(t))((r,l)=>{let f;this.subscribe(y=>f=y,y=>l(y),()=>r(f))})}}return e.create=n=>new e(n),e})();function ii(e){var n;return null!==(n=e??Yt.Promise)&&void 0!==n?n:Promise}const oi=u(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Dn=(()=>{class e extends In{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new Zr(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new oi}next(t){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:l,observers:f}=this;return r||l?Ae:(this.currentObservers=null,f.push(t),new Le(()=>{this.currentObservers=null,Me(f,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:l,isStopped:f}=this;r?t.error(l):f&&t.complete()}asObservable(){const t=new In;return t.source=this,t}}return e.create=(n,t)=>new Zr(n,t),e})();class Zr extends Dn{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:Ae}}function ci(e){return Te(e?.lift)}function hi(e){return n=>{if(ci(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ln(e,n,t,r,l){return new ns(e,n,t,r,l)}class ns extends Fe{constructor(n,t,r,l,f,y){super(n),this.onFinalize=f,this.shouldUnsubscribe=y,this._next=t?function(C){try{t(C)}catch(D){n.error(D)}}:super._next,this._error=l?function(C){try{l(C)}catch(D){n.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(C){n.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function Ln(e,n){return hi((t,r)=>{let l=0;t.subscribe(ln(r,f=>{r.next(e.call(n,f,l++))}))})}function ro(e){return this instanceof ro?(this.v=e,this):new ro(e)}function Qa(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function ya(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(f){t[f]=e[f]&&function(y){return new Promise(function(C,D){!function l(f,y,C,D){Promise.resolve(D).then(function(O){f({value:O,done:C})},y)}(C,D,(y=e[f](y)).done,y.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Pt=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Ft(e){return Te(e?.then)}function Ct(e){return Te(e[Tn])}function kn(e){return Symbol.asyncIterator&&Te(e?.[Symbol.asyncIterator])}function Gn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Mn=function zn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function zt(e){return Te(e?.[Mn])}function zi(e){return function gs(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,r=t.apply(e,n||[]),f=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(oe){r[oe]&&(l[oe]=function(ve){return new Promise(function(We,Qe){f.push([oe,ve,We,Qe])>1||C(oe,ve)})})}function C(oe,ve){try{!function D(oe){oe.value instanceof ro?Promise.resolve(oe.value.v).then(O,$):W(f[0][2],oe)}(r[oe](ve))}catch(We){W(f[0][3],We)}}function O(oe){C("next",oe)}function $(oe){C("throw",oe)}function W(oe,ve){oe(ve),f.shift(),f.length&&C(f[0][0],f[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:l}=yield ro(t.read());if(l)return yield ro(void 0);yield yield ro(r)}}finally{t.releaseLock()}})}function fr(e){return Te(e?.getReader)}function Ei(e){if(e instanceof In)return e;if(null!=e){if(Ct(e))return function Cr(e){return new In(n=>{const t=e[Tn]();if(Te(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Pt(e))return function jo(e){return new In(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(Ft(e))return function Lr(e){return new In(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,St)})}(e);if(kn(e))return wa(e);if(zt(e))return function Mr(e){return new In(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(fr(e))return function Vd(e){return wa(zi(e))}(e)}throw Gn(e)}function wa(e){return new In(n=>{(function Ah(e,n){var t,r,l,f;return function ac(e,n,t,r){return new(t||(t=Promise))(function(f,y){function C($){try{O(r.next($))}catch(W){y(W)}}function D($){try{O(r.throw($))}catch(W){y(W)}}function O($){$.done?f($.value):function l(f){return f instanceof t?f:new t(function(y){y(f)})}($.value).then(C,D)}O((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Qa(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(y){l={error:y}}finally{try{r&&!r.done&&(f=t.return)&&(yield f.call(t))}finally{if(l)throw l.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Yn(e,n,t,r=0,l=!1){const f=n.schedule(function(){t(),l?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(f),!l)return f}function vr(e,n,t=1/0){return Te(n)?vr((r,l)=>Ln((f,y)=>n(r,f,l,y))(Ei(e(r,l))),t):("number"==typeof n&&(t=n),hi((r,l)=>function Iu(e,n,t,r,l,f,y,C){const D=[];let O=0,$=0,W=!1;const oe=()=>{W&&!D.length&&!O&&n.complete()},ve=Qe=>O<r?We(Qe):D.push(Qe),We=Qe=>{f&&n.next(Qe),O++;let mt=!1;Ei(t(Qe,$++)).subscribe(ln(n,Vt=>{l?.(Vt),f?ve(Vt):n.next(Vt)},()=>{mt=!0},void 0,()=>{if(mt)try{for(O--;D.length&&O<r;){const Vt=D.shift();y?Yn(n,y,()=>We(Vt)):We(Vt)}oe()}catch(Vt){n.error(Vt)}}))};return e.subscribe(ln(n,ve,()=>{W=!0,oe()})),()=>{C?.()}}(r,l,e,t)))}function Ea(e=1/0){return vr(wn,e)}const oo=new In(e=>e.complete());function lc(e){return e[e.length-1]}function Ca(e){return Te(lc(e))?e.pop():void 0}function _o(e){return function Au(e){return e&&Te(e.schedule)}(lc(e))?e.pop():void 0}function tt(e,n=0){return hi((t,r)=>{t.subscribe(ln(r,l=>Yn(r,e,()=>r.next(l),n),()=>Yn(r,e,()=>r.complete(),n),l=>Yn(r,e,()=>r.error(l),n)))})}function rs(e,n=0){return hi((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function Vs(e,n){if(!e)throw new Error("Iterable cannot be null");return new In(t=>{Yn(t,n,()=>{const r=e[Symbol.asyncIterator]();Yn(t,n,()=>{r.next().then(l=>{l.done?t.complete():t.next(l.value)})},0,!0)})})}function it(e,n){return n?function Ta(e,n){if(null!=e){if(Ct(e))return function Ki(e,n){return Ei(e).pipe(rs(n),tt(n))}(e,n);if(Pt(e))return function rr(e,n){return new In(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(Ft(e))return function On(e,n){return Ei(e).pipe(rs(n),tt(n))}(e,n);if(kn(e))return Vs(e,n);if(zt(e))return function Ao(e,n){return new In(t=>{let r;return Yn(t,n,()=>{r=e[Mn](),Yn(t,n,()=>{let l,f;try{({value:l,done:f}=r.next())}catch(y){return void t.error(y)}f?t.complete():t.next(l)},0,!0)}),()=>Te(r?.return)&&r.return()})}(e,n);if(fr(e))return function el(e,n){return Vs(zi(e),n)}(e,n)}throw Gn(e)}(e,n):Ei(e)}class mn extends Dn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function fn(...e){return it(e,_o(e))}function or(e={}){const{connector:n=(()=>new Dn),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:l=!0}=e;return f=>{let y,C,D,O=0,$=!1,W=!1;const oe=()=>{C?.unsubscribe(),C=void 0},ve=()=>{oe(),y=D=void 0,$=W=!1},We=()=>{const Qe=y;ve(),Qe?.unsubscribe()};return hi((Qe,mt)=>{O++,!W&&!$&&oe();const Vt=D=D??n();mt.add(()=>{O--,0===O&&!W&&!$&&(C=qn(We,l))}),Vt.subscribe(mt),!y&&O>0&&(y=new Cn({next:dt=>Vt.next(dt),error:dt=>{W=!0,oe(),C=qn(ve,t,dt),Vt.error(dt)},complete:()=>{$=!0,oe(),C=qn(ve,r),Vt.complete()}}),Ei(Qe).subscribe(y))})(f)}}function qn(e,n,...t){if(!0===n)return void e();if(!1===n)return;const r=new Cn({next:()=>{r.unsubscribe(),e()}});return Ei(n(...t)).subscribe(r)}function Gi(e,n){return hi((t,r)=>{let l=null,f=0,y=!1;const C=()=>y&&!l&&r.complete();t.subscribe(ln(r,D=>{l?.unsubscribe();let O=0;const $=f++;Ei(e(D,$)).subscribe(l=ln(r,W=>r.next(n?n(D,W,$,O++):W),()=>{l=null,C()}))},()=>{y=!0,C()}))})}function qi(e,n){return e===n}function jn(e){for(let n in e)if(e[n]===jn)return n;throw Error("Could not find renamed property on target object.")}function fi(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function sr(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(sr).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Po(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const Us=jn({__forward_ref__:jn});function vi(e){return e.__forward_ref__=vi,e.toString=function(){return sr(this())},e}function An(e){return tl(e)?e():e}function tl(e){return"function"==typeof e&&e.hasOwnProperty(Us)&&e.__forward_ref__===vi}function js(e){return e&&!!e.\u0275providers}const Da="https://g.co/ng/security#xss";class Mt extends Error{constructor(n,t){super(function kr(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function cn(e){return"string"==typeof e?e:null==e?"":String(e)}function Al(e,n){throw new Mt(-201,!1)}function Ur(e,n){null==e&&function Ut(e,n,t,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${t} ${r} ${n} <=Actual]`))}(n,e,null,"!=")}function an(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Nr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Hs(e){return Lu(e,Rl)||Lu(e,ui)}function Lu(e,n){return e.hasOwnProperty(n)?e[n]:null}function Aa(e){return e&&(e.hasOwnProperty(Xr)||e.hasOwnProperty(Lh))?e[Xr]:null}const Rl=jn({\u0275prov:jn}),Xr=jn({\u0275inj:jn}),ui=jn({ngInjectableDef:jn}),Lh=jn({ngInjectorDef:jn});var $n=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}($n||{});let cc;function Yr(e){const n=cc;return cc=e,n}function Xc(e,n,t){const r=Hs(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&$n.Optional?null:void 0!==n?n:void Al(sr(e))}const wi=globalThis;class Xt{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=an({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const qs={},Nl="__NG_DI_FLAG__",_s="ngTempTokenPath",kh=/\n/gm,Go="__source";let ko;function jr(e){const n=ko;return ko=e,n}function Yc(e,n=$n.Default){if(void 0===ko)throw new Mt(-203,!1);return null===ko?Xc(e,void 0,n):ko.get(e,n&$n.Optional?null:void 0,n)}function sn(e,n=$n.Default){return(function uc(){return cc}()||Yc)(An(e),n)}function tn(e,n=$n.Default){return sn(e,Zs(n))}function Zs(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function as(e){const n=[];for(let t=0;t<e.length;t++){const r=An(e[t]);if(Array.isArray(r)){if(0===r.length)throw new Mt(900,!1);let l,f=$n.Default;for(let y=0;y<r.length;y++){const C=r[y],D=qo(C);"number"==typeof D?-1===D?l=C.token:f|=D:l=C}n.push(sn(l,f))}else n.push(sn(r))}return n}function rl(e,n){return e[Nl]=n,e.prototype[Nl]=n,e}function qo(e){return e[Nl]}function Co(e){return{toString:e}.toString()}var zl=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(zl||{}),xr=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(xr||{});const ls={},ei=[],Kc=jn({\u0275cmp:jn}),Oo=jn({\u0275dir:jn}),Ws=jn({\u0275pipe:jn}),ol=jn({\u0275mod:jn}),Zo=jn({\u0275fac:jn}),vs=jn({__NG_ELEMENT_ID__:jn}),Jc=jn({__NG_ENV_ID__:jn});function sl(e,n,t){let r=e.length;for(;;){const l=e.indexOf(n,t);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const f=n.length;if(l+f===r||e.charCodeAt(l+f)<=32)return l}t=l+1}}function Xs(e,n,t){let r=0;for(;r<t.length;){const l=t[r];if("number"==typeof l){if(0!==l)break;r++;const f=t[r++],y=t[r++],C=t[r++];e.setAttribute(n,y,C,f)}else{const f=l,y=t[++r];pc(f)?e.setProperty(n,f,y):e.setAttribute(n,f,y),r++}}return r}function Ys(e){return 3===e||4===e||6===e}function pc(e){return 64===e.charCodeAt(0)}function Ks(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const l=n[r];"number"==typeof l?t=l:0===t||Fu(e,t,l,null,-1===t||2===t?n[++r]:null)}}return e}function Fu(e,n,t,r,l){let f=0,y=e.length;if(-1===n)y=-1;else for(;f<e.length;){const C=e[f++];if("number"==typeof C){if(C===n){y=-1;break}if(C>n){y=f-1;break}}}for(;f<e.length;){const C=e[f];if("number"==typeof C)break;if(C===t){if(null===r)return void(null!==l&&(e[f+1]=l));if(r===e[f+1])return void(e[f+2]=l)}f++,null!==r&&f++,null!==l&&f++}-1!==y&&(e.splice(y,0,n),f=y+1),e.splice(f++,0,t),null!==r&&e.splice(f++,0,r),null!==l&&e.splice(f++,0,l)}const xs="ng-template";function $d(e,n,t){let r=0,l=!0;for(;r<e.length;){let f=e[r++];if("string"==typeof f&&l){const y=e[r++];if(t&&"class"===f&&-1!==sl(y.toLowerCase(),n,0))return!0}else{if(1===f){for(;r<e.length&&"string"==typeof(f=e[r++]);)if(f.toLowerCase()===n)return!0;return!1}"number"==typeof f&&(l=!1)}}return!1}function zu(e){return 4===e.type&&e.value!==xs}function Hd(e,n,t){return n===(4!==e.type||t?e.value:xs)}function Oh(e,n,t){let r=4;const l=e.attrs||[],f=function mc(e){for(let n=0;n<e.length;n++)if(Ys(e[n]))return n;return e.length}(l);let y=!1;for(let C=0;C<n.length;C++){const D=n[C];if("number"!=typeof D){if(!y)if(4&r){if(r=2|1&r,""!==D&&!Hd(e,D,t)||""===D&&1===n.length){if(cs(r))return!1;y=!0}}else{const O=8&r?D:n[++C];if(8&r&&null!==e.attrs){if(!$d(e.attrs,O,t)){if(cs(r))return!1;y=!0}continue}const W=us(8&r?"class":D,l,zu(e),t);if(-1===W){if(cs(r))return!1;y=!0;continue}if(""!==O){let oe;oe=W>f?"":l[W+1].toLowerCase();const ve=8&r?oe:null;if(ve&&-1!==sl(ve,O,0)||2&r&&O!==oe){if(cs(r))return!1;y=!0}}}}else{if(!y&&!cs(r)&&!cs(D))return!1;if(y&&cs(D))continue;y=!1,r=D|1&r}}return cs(r)||y}function cs(e){return 0==(1&e)}function us(e,n,t,r){if(null===n)return-1;let l=0;if(r||!t){let f=!1;for(;l<n.length;){const y=n[l];if(y===e)return l;if(3===y||6===y)f=!0;else{if(1===y||2===y){let C=n[++l];for(;"string"==typeof C;)C=n[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=f?1:2}return-1}return function Nh(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function La(e,n,t=!1){for(let r=0;r<n.length;r++)if(Oh(e,n[r],t))return!0;return!1}function gc(e,n){return e?":not("+n.trim()+")":n}function ao(e){let n=e[0],t=1,r=2,l="",f=!1;for(;t<e.length;){let y=e[t];if("string"==typeof y)if(2&r){const C=e[++t];l+="["+y+(C.length>0?'="'+C+'"':"")+"]"}else 8&r?l+="."+y:4&r&&(l+=" "+y);else""!==l&&!cs(y)&&(n+=gc(f,l),l=""),r=y,f=f||!cs(r);t++}return""!==l&&(n+=gc(f,l)),n}function pr(e){return Co(()=>{const n=ka(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===zl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||xr.Emulated,styles:e.styles||ei,_:null,schemas:e.schemas||null,tView:null,id:""};Oa(t);const r=e.dependencies;return t.directiveDefs=hl(r,!1),t.pipeDefs=hl(r,!0),t.id=function yc(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const l of t)n=Math.imul(31,n)+l.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function Qc(e){return ti(e)||Tr(e)}function Wo(e){return null!==e}function Nn(e){return Co(()=>({type:e.type,bootstrap:e.bootstrap||ei,declarations:e.declarations||ei,imports:e.imports||ei,exports:e.exports||ei,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function cl(e,n){if(null==e)return ls;const t={};for(const r in e)if(e.hasOwnProperty(r)){let l=e[r],f=l;Array.isArray(l)&&(f=l[1],l=l[0]),t[l]=r,n&&(n[l]=f)}return t}function Pn(e){return Co(()=>{const n=ka(e);return Oa(n),n})}function br(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function ti(e){return e[Kc]||null}function Tr(e){return e[Oo]||null}function lr(e){return e[Ws]||null}function Kr(e,n){const t=e[ol]||null;if(!t&&!0===n)throw new Error(`Type ${sr(e)} does not have '\u0275mod' property.`);return t}function ka(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||ls,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||ei,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:cl(e.inputs,n),outputs:cl(e.outputs)}}function Oa(e){e.features?.forEach(n=>n(e))}function hl(e,n){if(!e)return null;const t=n?lr:Qc;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(Wo)}const Zi=0,Jt=1,ft=2,h=3,x=4,M=5,k=6,U=7,X=8,xe=9,He=10,Oe=11,Tt=12,rn=13,xn=14,vn=15,Fr=16,cr=17,Wi=18,Sr=19,Js=20,ws=21,Xo=22,Qs=23,Es=24,ni=25,ur=1,jl=2,Jr=7,dl=9,zr=11;function No(e){return Array.isArray(e)&&"object"==typeof e[ur]}function To(e){return Array.isArray(e)&&!0===e[ur]}function lo(e){return 0!=(4&e.flags)}function xc(e){return e.componentOffset>-1}function Bu(e){return 1==(1&e.flags)}function ea(e){return!!e.template}function Gd(e){return 0!=(512&e[ft])}function pl(e,n){return e.hasOwnProperty(Zo)?e[Zo]:null}let a=null,d=!1;function _(e){const n=a;return a=e,n}const b={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function I(e){if(!re(e)||e.dirty){if(!e.producerMustRecompute(e)&&!K(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function B(e){e.dirty=!0,function A(e){if(void 0===e.liveConsumerNode)return;const n=d;d=!0;try{for(const t of e.liveConsumerNode)t.dirty||B(t)}finally{d=n}}(e),e.consumerMarkedDirty?.(e)}function z(e){return e&&(e.nextProducerIndex=0),_(e)}function H(e,n){if(_(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(re(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)ne(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function K(e){G(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(I(t),r!==t.version))return!0}return!1}function te(e){if(G(e),re(e))for(let n=0;n<e.producerNode.length;n++)ne(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function ne(e,n){if(function ee(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),G(e),1===e.liveConsumerNode.length)for(let r=0;r<e.producerNode.length;r++)ne(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],l=e.liveConsumerNode[n];G(l),l.producerIndexOfThis[r]=n}}function re(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function G(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let Pe=null;const en=()=>{},bn=(()=>({...b,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:en}))();class Kn{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Kt(){return bi}function bi(e){return e.type.prototype.ngOnChanges&&(e.setInput=Li),Ri}function Ri(){const e=yo(this),n=e?.current;if(n){const t=e.previous;if(t===ls)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function Li(e,n,t,r){const l=this.declaredInputs[t],f=yo(e)||function co(e,n){return e[Ci]=n}(e,{previous:ls,current:null}),y=f.current||(f.current={}),C=f.previous,D=C[l];y[l]=new Kn(D&&D.currentValue,n,C===ls),e[r]=n}Kt.ngInherit=!0;const Ci="__ngSimpleChanges__";function yo(e){return e[Ci]||null}const pi=function(e,n,t){};function Xn(e){for(;Array.isArray(e);)e=e[Zi];return e}function ki(e,n){return Xn(n[e])}function Ji(e,n){return Xn(n[e.index])}function $l(e,n){return e.data[n]}function Ba(e,n){return e[n]}function Br(e,n){const t=n[e];return No(t)?t:t[Zi]}function Ts(e,n){return null==n?null:e[n]}function Uh(e){e[cr]=0}function Ly(e){1024&e[ft]||(e[ft]|=1024,ky(e,1))}function ag(e){1024&e[ft]&&(e[ft]&=-1025,ky(e,-1))}function ky(e,n){let t=e[h];if(null===t)return;t[M]+=n;let r=t;for(t=t[h];null!==t&&(1===n&&1===r[M]||-1===n&&0===r[M]);)t[M]+=n,r=t,t=t[h]}const Zn={lFrame:Vy(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function cg(){return Zn.bindingsEnabled}function vt(){return Zn.lFrame.lView}function Qn(){return Zn.lFrame.tView}function Qi(e){return Zn.lFrame.contextLView=e,e[X]}function er(e){return Zn.lFrame.contextLView=null,e}function Vr(){let e=Ny();for(;null!==e&&64===e.type;)e=e.parent;return e}function Ny(){return Zn.lFrame.currentTNode}function Gl(e,n){const t=Zn.lFrame;t.currentTNode=e,t.isParent=n}function hg(){return Zn.lFrame.isParent}function hs(){const e=Zn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function na(){return Zn.lFrame.bindingIndex++}function Va(e){const n=Zn.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function By(e,n){const t=Zn.lFrame;t.bindingIndex=t.bindingRootIndex=e,Kd(n)}function Kd(e){Zn.lFrame.currentDirectiveIndex=e}function Hh(){return Zn.lFrame.currentQueryIndex}function Cc(e){Zn.lFrame.currentQueryIndex=e}function fg(e){const n=e[Jt];return 2===n.type?n.declTNode:1===n.type?e[k]:null}function Jd(e,n,t){if(t&$n.SkipSelf){let l=n,f=e;for(;!(l=l.parent,null!==l||t&$n.Host||(l=fg(f),null===l||(f=f[xn],10&l.type))););if(null===l)return!1;n=l,e=f}const r=Zn.lFrame=pg();return r.currentTNode=n,r.lView=e,!0}function xp(e){const n=pg(),t=e[Jt];Zn.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function pg(){const e=Zn.lFrame,n=null===e?null:e.child;return null===n?Vy(e):n}function Vy(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function bp(){const e=Zn.lFrame;return Zn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const mg=bp;function ju(){const e=bp();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Fo(){return Zn.lFrame.selectedIndex}function nu(e){Zn.lFrame.selectedIndex=e}function mr(){const e=Zn.lFrame;return $l(e.tView,e.selectedIndex)}let wp=!0;function gr(){return wp}function Dc(e){wp=e}function Ms(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const f=e.data[t].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:C,ngAfterViewInit:D,ngAfterViewChecked:O,ngOnDestroy:$}=f;y&&(e.contentHooks??=[]).push(-t,y),C&&((e.contentHooks??=[]).push(t,C),(e.contentCheckHooks??=[]).push(t,C)),D&&(e.viewHooks??=[]).push(-t,D),O&&((e.viewHooks??=[]).push(t,O),(e.viewCheckHooks??=[]).push(t,O)),null!=$&&(e.destroyHooks??=[]).push(t,$)}}function Ep(e,n,t){gg(e,n,3,t)}function Cp(e,n,t,r){(3&e[ft])===t&&gg(e,n,t,r)}function Tp(e,n){let t=e[ft];(3&t)===n&&(t&=8191,t+=1,e[ft]=t)}function gg(e,n,t,r){const f=r??-1,y=n.length-1;let C=0;for(let D=void 0!==r?65535&e[cr]:0;D<y;D++)if("number"==typeof n[D+1]){if(C=n[D],null!=r&&C>=r)break}else n[D]<0&&(e[cr]+=65536),(C<f||-1==f)&&(Uy(e,t,n,D),e[cr]=(4294901760&e[cr])+D+2),D++}function iu(e,n){pi(4,e,n);const t=_(null);try{n.call(e)}finally{_(t),pi(5,e,n)}}function Uy(e,n,t,r){const l=t[r]<0,f=t[r+1],C=e[l?-t[r]:t[r]];l?e[ft]>>13<e[cr]>>16&&(3&e[ft])===n&&(e[ft]+=8192,iu(C,f)):iu(C,f)}const $u=-1;class qh{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function rf(e){return e!==$u}function uo(e){return 32767&e}function Zh(e,n){let t=function yg(e){return e>>16}(e),r=n;for(;t>0;)r=r[xn],t--;return r}let Ua=!0;function Dp(e){const n=Ua;return Ua=e,n}const Xh=255,oa=5;let ja=0;const Zl={};function sf(e,n){const t=Sp(e,n);if(-1!==t)return t;const r=n[Jt];r.firstCreatePass&&(e.injectorIndex=n.length,vg(r.data,e),vg(n,null),vg(r.blueprint,null));const l=sa(e,n),f=e.injectorIndex;if(rf(l)){const y=uo(l),C=Zh(l,n),D=C[Jt].data;for(let O=0;O<8;O++)n[f+O]=C[y+O]|D[y+O]}return n[f+8]=l,f}function vg(e,n){e.push(0,0,0,0,0,0,0,0,n)}function Sp(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function sa(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,l=n;for(;null!==l;){if(r=Yy(l),null===r)return $u;if(t++,l=l[xn],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return $u}function Mc(e,n,t){!function Mp(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(vs)&&(r=t[vs]),null==r&&(r=t[vs]=ja++);const l=r&Xh;n.data[e+(l>>oa)]|=1<<l}(e,n,t)}function xg(e,n,t){if(t&$n.Optional||void 0!==e)return e;Al()}function Zy(e,n,t,r){if(t&$n.Optional&&void 0===r&&(r=null),!(t&($n.Self|$n.Host))){const l=e[xe],f=Yr(void 0);try{return l?l.get(n,r,t&$n.Optional):Xc(n,r,t&$n.Optional)}finally{Yr(f)}}return xg(r,0,t)}function af(e,n,t,r=$n.Default,l){if(null!==e){if(2048&n[ft]&&!(r&$n.Self)){const y=function Vx(e,n,t,r,l){let f=e,y=n;for(;null!==f&&null!==y&&2048&y[ft]&&!(512&y[ft]);){const C=Ip(f,y,t,r|$n.Self,Zl);if(C!==Zl)return C;let D=f.parent;if(!D){const O=y[Js];if(O){const $=O.get(t,Zl,r);if($!==Zl)return $}D=Yy(y),y=y[xn]}f=D}return l}(e,n,t,r,Zl);if(y!==Zl)return y}const f=Ip(e,n,t,r,Zl);if(f!==Zl)return f}return Zy(n,t,r,l)}function Ip(e,n,t,r,l){const f=function Ap(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(vs)?e[vs]:void 0;return"number"==typeof n?n>=0?n&Xh:Xy:n}(t);if("function"==typeof f){if(!Jd(n,e,r))return r&$n.Host?xg(l,0,r):Zy(n,t,r,l);try{let y;if(y=f(r),null!=y||r&$n.Optional)return y;Al()}finally{mg()}}else if("number"==typeof f){let y=null,C=Sp(e,n),D=$u,O=r&$n.Host?n[vn][k]:null;for((-1===C||r&$n.SkipSelf)&&(D=-1===C?sa(e,n):n[C+8],D!==$u&&Kh(r,!1)?(y=n[Jt],C=uo(D),n=Zh(D,n)):C=-1);-1!==C;){const $=n[Jt];if(bg(f,C,$.data)){const W=Yh(C,n,t,y,r,O);if(W!==Zl)return W}D=n[C+8],D!==$u&&Kh(r,n[Jt].data[C+8]===O)&&bg(f,C,n)?(y=$,C=uo(D),n=Zh(D,n)):C=-1}}return l}function Yh(e,n,t,r,l,f){const y=n[Jt],C=y.data[e+8],$=Sc(C,y,t,null==r?xc(C)&&Ua:r!=y&&0!=(3&C.type),l&$n.Host&&f===C);return null!==$?gl(n,y,$,C):Zl}function Sc(e,n,t,r,l){const f=e.providerIndexes,y=n.data,C=1048575&f,D=e.directiveStart,$=f>>20,oe=l?C+$:e.directiveEnd;for(let ve=r?C:C+$;ve<oe;ve++){const We=y[ve];if(ve<D&&t===We||ve>=D&&We.type===t)return ve}if(l){const ve=y[D];if(ve&&ea(ve)&&ve.type===t)return D}return null}function gl(e,n,t,r){let l=e[t];const f=n.data;if(function jy(e){return e instanceof qh}(l)){const y=l;y.resolving&&function $o(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new Mt(-200,`Circular dependency in DI detected for ${e}${t}`)}(function on(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():cn(e)}(f[t]));const C=Dp(y.canSeeViewProviders);y.resolving=!0;const O=y.injectImpl?Yr(y.injectImpl):null;Jd(e,r,$n.Default);try{l=e[t]=y.factory(void 0,f,e,r),n.firstCreatePass&&t>=r.directiveStart&&function tf(e,n,t){const{ngOnChanges:r,ngOnInit:l,ngDoCheck:f}=n.type.prototype;if(r){const y=bi(n);(t.preOrderHooks??=[]).push(e,y),(t.preOrderCheckHooks??=[]).push(e,y)}l&&(t.preOrderHooks??=[]).push(0-e,l),f&&((t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f))}(t,f[t],n)}finally{null!==O&&Yr(O),Dp(C),y.resolving=!1,mg()}}return l}function bg(e,n,t){return!!(t[n+(e>>oa)]&1<<e)}function Kh(e,n){return!(e&$n.Self||e&$n.Host&&n)}class ho{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return af(this._tNode,this._lView,n,Zs(r),t)}}function Xy(){return new ho(Vr(),vt())}function xo(e){return Co(()=>{const n=e.prototype.constructor,t=n[Zo]||Pp(n),r=Object.prototype;let l=Object.getPrototypeOf(e.prototype).constructor;for(;l&&l!==r;){const f=l[Zo]||Pp(l);if(f&&f!==t)return f;l=Object.getPrototypeOf(l)}return f=>new f})}function Pp(e){return tl(e)?()=>{const n=Pp(An(e));return n&&n()}:pl(e)}function Yy(e){const n=e[Jt],t=n.type;return 2===t?n.declTNode:1===t?e[k]:null}const aa="__parameters__";function ds(e,n,t){return Co(()=>{const r=function $a(e){return function(...t){if(e){const r=e(...t);for(const l in r)this[l]=r[l]}}}(n);function l(...f){if(this instanceof l)return r.apply(this,f),this;const y=new l(...f);return C.annotation=y,C;function C(D,O,$){const W=D.hasOwnProperty(aa)?D[aa]:Object.defineProperty(D,aa,{value:[]})[aa];for(;W.length<=$;)W.push(null);return(W[$]=W[$]||[]).push(y),D}}return t&&(l.prototype=Object.create(t.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}function Ac(e,n){e.forEach(t=>Array.isArray(t)?Ac(t,n):n(t))}function uf(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Jh(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function ca(e,n,t){let r=Zu(e,n);return r>=0?e[1|r]=t:(r=~r,function qx(e,n,t,r){let l=e.length;if(l==n)e.push(t,r);else if(1===l)e.push(r,e[0]),e[0]=t;else{for(l--,e.push(e[l-1],e[l]);l>n;)e[l]=e[l-2],l--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function hf(e,n){const t=Zu(e,n);if(t>=0)return e[1|t]}function Zu(e,n){return function ou(e,n,t){let r=0,l=e.length>>t;for(;l!==r;){const f=r+(l-r>>1),y=e[f<<t];if(n===y)return f<<t;y>n?l=f:r=f+1}return~(l<<t)}(e,n,1)}const Op=rl(ds("Optional"),8),Np=rl(ds("SkipSelf"),4);function od(e){return 128==(128&e.flags)}var Xl=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Xl||{});const Pg=new Map;let nb=0;const Lg="__ngContext__";function Vo(e,n){No(n)?(e[Lg]=n[Sr],function rb(e){Pg.set(e[Sr],e)}(n)):e[Lg]=n}let Zp;function Ku(e,n){return Zp(e,n)}function yf(e){const n=e[h];return To(n)?n[h]:n}function kg(e){return Ng(e[Tt])}function Og(e){return Ng(e[x])}function Ng(e){for(;null!==e&&!To(e);)e=e[x];return e}function Ju(e,n,t,r,l){if(null!=r){let f,y=!1;To(r)?f=r:No(r)&&(y=!0,r=r[Zi]);const C=Xn(r);0===e&&null!==t?null==l?Ug(n,t,C):eh(n,t,C,l||null,!0):1===e&&null!==t?eh(n,t,C,l||null,!0):2===e?function Jp(e,n,t){const r=Kp(e,n);r&&function Tv(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,C,y):3===e&&n.destroyNode(C),null!=f&&function Iv(e,n,t,r,l){const f=t[Jr];f!==Xn(t)&&Ju(n,e,r,f,l);for(let C=zr;C<t.length;C++){const D=t[C];Ef(D[Jt],D,e,n,r,f)}}(n,e,f,t,l)}}function Qu(e,n,t){return e.createElement(n,t)}function Fg(e,n){const t=e[dl],r=t.indexOf(n);ag(n),t.splice(r,1)}function Yp(e,n){if(e.length<=zr)return;const t=zr+n,r=e[t];if(r){const l=r[Fr];null!==l&&l!==e&&Fg(l,r),n>0&&(e[t-1][x]=r[x]);const f=Jh(e,zr+n);!function Ev(e,n){Ef(e,n,n[Oe],2,null,null),n[Zi]=null,n[k]=null}(r[Jt],r);const y=f[Wi];null!==y&&y.detachView(f[Jt]),r[h]=null,r[x]=null,r[ft]&=-129}return r}function zg(e,n){if(!(256&n[ft])){const t=n[Oe];n[Qs]&&te(n[Qs]),n[Es]&&te(n[Es]),t.destroyNode&&Ef(e,n,t,3,null,null),function ad(e){let n=e[Tt];if(!n)return Bg(e[Jt],e);for(;n;){let t=null;if(No(n))t=n[Tt];else{const r=n[zr];r&&(t=r)}if(!t){for(;n&&!n[x]&&n!==e;)No(n)&&Bg(n[Jt],n),n=n[h];null===n&&(n=e),No(n)&&Bg(n[Jt],n),t=n&&n[x]}n=t}}(n)}}function Bg(e,n){if(!(256&n[ft])){n[ft]&=-129,n[ft]|=256,function cb(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const l=n[t[r]];if(!(l instanceof qh)){const f=t[r+1];if(Array.isArray(f))for(let y=0;y<f.length;y+=2){const C=l[f[y]],D=f[y+1];pi(4,C,D);try{D.call(C)}finally{pi(5,C,D)}}else{pi(4,l,f);try{f.call(l)}finally{pi(5,l,f)}}}}}(e,n),function lb(e,n){const t=e.cleanup,r=n[U];if(null!==t)for(let f=0;f<t.length-1;f+=2)if("string"==typeof t[f]){const y=t[f+3];y>=0?r[y]():r[-y].unsubscribe(),f+=2}else t[f].call(r[t[f+1]]);null!==r&&(n[U]=null);const l=n[ws];if(null!==l){n[ws]=null;for(let f=0;f<l.length;f++)(0,l[f])()}}(e,n),1===n[Jt].type&&n[Oe].destroy();const t=n[Fr];if(null!==t&&To(n[h])){t!==n[h]&&Fg(t,n);const r=n[Wi];null!==r&&r.detachView(e)}!function ob(e){Pg.delete(e[Sr])}(n)}}function Vg(e,n,t){return function bf(e,n,t){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return t[Zi];{const{componentOffset:l}=r;if(l>-1){const{encapsulation:f}=e.data[r.directiveStart+l];if(f===xr.None||f===xr.Emulated)return null}return Ji(r,t)}}(e,n.parent,t)}function eh(e,n,t,r,l){e.insertBefore(n,t,r,l)}function Ug(e,n,t){e.appendChild(n,t)}function jg(e,n,t,r,l){null!==r?eh(e,n,t,r,l):Ug(e,n,t)}function Kp(e,n){return e.parentNode(n)}let Hg,Zg,em,$g=function Mv(e,n,t){return 40&e.type?Ji(e,t):null};function Is(e,n,t,r){const l=Vg(e,r,n),f=n[Oe],C=function Dv(e,n,t){return $g(e,n,t)}(r.parent||n[k],r,n);if(null!=l)if(Array.isArray(t))for(let D=0;D<t.length;D++)jg(f,l,t[D],C,!1);else jg(f,l,t,C,!1);void 0!==Hg&&Hg(f,r,n,t,l)}function th(e,n){if(null!==n){const t=n.type;if(3&t)return Ji(n,e);if(4&t)return lu(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return th(e,r);{const l=e[n.index];return To(l)?lu(-1,l):Xn(l)}}if(32&t)return Ku(n,e)()||Xn(e[n.index]);{const r=wf(e,n);return null!==r?Array.isArray(r)?r[0]:th(yf(e[vn]),r):th(e,n.next)}}return null}function wf(e,n){return null!==n?e[vn][k].projection[n.projection]:null}function lu(e,n){const t=zr+e+1;if(t<n.length){const r=n[t],l=r[Jt].firstChild;if(null!==l)return th(r,l)}return n[Jr]}function nh(e,n,t,r,l,f,y){for(;null!=t;){const C=r[t.index],D=t.type;if(y&&0===n&&(C&&Vo(Xn(C),r),t.flags|=2),32!=(32&t.flags))if(8&D)nh(e,n,t.child,r,l,f,!1),Ju(n,e,l,C,f);else if(32&D){const O=Ku(t,r);let $;for(;$=O();)Ju(n,e,l,$,f);Ju(n,e,l,C,f)}else 16&D?Gg(e,n,r,t,l,f):Ju(n,e,l,C,f);t=y?t.projectionNext:t.next}}function Ef(e,n,t,r,l,f){nh(t,r,e.firstChild,n,l,f,!1)}function Gg(e,n,t,r,l,f){const y=t[vn],D=y[k].projection[r.projection];if(Array.isArray(D))for(let O=0;O<D.length;O++)Ju(n,e,l,D[O],f);else{let O=D;const $=y[h];od(r)&&(O.flags|=128),nh(e,n,O,$,l,f,!0)}}function Qp(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function qg(e,n,t){const{mergedAttrs:r,classes:l,styles:f}=t;null!==r&&Xs(e,n,r),null!==l&&Qp(e,n,l),null!==f&&function Vi(e,n,t){e.setAttribute(n,"style",t)}(e,n,f)}function ih(e){return function Wg(){if(void 0===em&&(em=null,wi.trustedTypes))try{em=wi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return em}()?.createScriptURL(e)||e}class Xg{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Da})`}}function Rc(e){return e instanceof Xg?e.changingThisBreaksApplicationSecurity:e}function rh(e,n){const t=function fs(e){return e instanceof Xg&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${Da})`)}return t===n}const kv=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var xl=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(xl||{});function cm(e){const n=Yl();return n?n.sanitize(xl.URL,e)||"":rh(e,"URL")?Rc(e):function rm(e){return(e=String(e)).match(kv)?e:"unsafe:"+e}(cn(e))}function If(e){const n=Yl();if(n)return ih(n.sanitize(xl.RESOURCE_URL,e)||"");if(rh(e,"ResourceURL"))return ih(Rc(e));throw new Mt(904,!1)}function Yl(){const e=vt();return e&&e[He].sanitizer}const sh=new Xt("ENVIRONMENT_INITIALIZER"),Vv=new Xt("INJECTOR",-1),t_=new Xt("INJECTOR_DEF_TYPES");class n_{get(n,t=qs){if(t===qs){const r=new Error(`NullInjectorError: No provider for ${sr(n)}!`);throw r.name="NullInjectorError",r}return t}}function Sb(...e){return{\u0275providers:hd(0,e),\u0275fromNgModule:!0}}function hd(e,...n){const t=[],r=new Set;let l;const f=y=>{t.push(y)};return Ac(n,y=>{const C=y;Rf(C,f,[],r)&&(l||=[],l.push(C))}),void 0!==l&&kc(l,f),t}function kc(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:l}=e[t];dd(l,f=>{n(f,r)})}}function Rf(e,n,t,r){if(!(e=An(e)))return!1;let l=null,f=Aa(e);const y=!f&&ti(e);if(f||y){if(y&&!y.standalone)return!1;l=e}else{const D=e.ngModule;if(f=Aa(D),!f)return!1;l=D}const C=r.has(l);if(y){if(C)return!1;if(r.add(l),y.dependencies){const D="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const O of D)Rf(O,n,t,r)}}else{if(!f)return!1;{if(null!=f.imports&&!C){let O;r.add(l);try{Ac(f.imports,$=>{Rf($,n,t,r)&&(O||=[],O.push($))})}finally{}void 0!==O&&kc(O,n)}if(!C){const O=pl(l)||(()=>new l);n({provide:l,useFactory:O,deps:ei},l),n({provide:t_,useValue:l,multi:!0},l),n({provide:sh,useValue:()=>sn(l),multi:!0},l)}const D=f.providers;if(null!=D&&!C){const O=e;dd(D,$=>{n($,O)})}}}return l!==e&&void 0!==e.providers}function dd(e,n){for(let t of e)js(t)&&(t=t.\u0275providers),Array.isArray(t)?dd(t,n):n(t)}const i_=jn({provide:String,useValue:jn});function r_(e){return null!==e&&"object"==typeof e&&i_ in e}function ah(e){return"function"==typeof e}const s_=new Xt("Set Injector scope."),du={},Lf={};let lh;function fu(){return void 0===lh&&(lh=new n_),lh}class Qo{}class fd extends Qo{get destroyed(){return this._destroyed}constructor(n,t,r,l){super(),this.parent=t,this.source=r,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,l_(n,y=>this.processProvider(y)),this.records.set(Vv,ch(void 0,this)),l.has("environment")&&this.records.set(Qo,ch(void 0,this));const f=this.records.get(s_);null!=f&&"string"==typeof f.value&&this.scopes.add(f.value),this.injectorDefTypes=new Set(this.get(t_.multi,ei,$n.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=jr(this),r=Yr(void 0);try{return n()}finally{jr(t),Yr(r)}}get(n,t=qs,r=$n.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Jc))return n[Jc](this);r=Zs(r);const f=jr(this),y=Yr(void 0);try{if(!(r&$n.SkipSelf)){let D=this.records.get(n);if(void 0===D){const O=function $v(e){return"function"==typeof e||"object"==typeof e&&e instanceof Xt}(n)&&Hs(n);D=O&&this.injectableDefInScope(O)?ch(a_(n),du):null,this.records.set(n,D)}if(null!=D)return this.hydrate(n,D)}return(r&$n.Self?fu():this.parent).get(n,t=r&$n.Optional&&t===qs?null:t)}catch(C){if("NullInjectorError"===C.name){if((C[_s]=C[_s]||[]).unshift(sr(n)),f)throw C;return function Fl(e,n,t,r){const l=e[_s];throw n[Go]&&l.unshift(n[Go]),e.message=function ys(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let l=sr(n);if(Array.isArray(n))l=n.map(sr).join(" -> ");else if("object"==typeof n){let f=[];for(let y in n)if(n.hasOwnProperty(y)){let C=n[y];f.push(y+":"+("string"==typeof C?JSON.stringify(C):sr(C)))}l=`{${f.join(", ")}}`}return`${t}${r?"("+r+")":""}[${l}]: ${e.replace(kh,"\n  ")}`}("\n"+e.message,l,t,r),e.ngTokenPath=l,e[_s]=null,e}(C,n,"R3InjectorError",this.source)}throw C}finally{Yr(y),jr(f)}}resolveInjectorInitializers(){const n=jr(this),t=Yr(void 0);try{const l=this.get(sh.multi,ei,$n.Self);for(const f of l)f()}finally{jr(n),Yr(t)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(sr(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Mt(205,!1)}processProvider(n){let t=ah(n=An(n))?n:An(n&&n.provide);const r=function hm(e){return r_(e)?ch(void 0,e.useValue):ch(Uv(e),du)}(n);if(ah(n)||!0!==n.multi)this.records.get(t);else{let l=this.records.get(t);l||(l=ch(void 0,du,!0),l.factory=()=>as(l.multi),this.records.set(t,l)),t=n,l.multi.push(n)}this.records.set(t,r)}hydrate(n,t){return t.value===du&&(t.value=Lf,t.value=t.factory()),"object"==typeof t.value&&t.value&&function Ab(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=An(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function a_(e){const n=Hs(e),t=null!==n?n.factory:pl(e);if(null!==t)return t;if(e instanceof Xt)throw new Mt(204,!1);if(e instanceof Function)return function pd(e){const n=e.length;if(n>0)throw function Qh(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(n,"?"),new Mt(204,!1);const t=function Wc(e){return e&&(e[Rl]||e[ui])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new Mt(204,!1)}function Uv(e,n,t){let r;if(ah(e)){const l=An(e);return pl(l)||a_(l)}if(r_(e))r=()=>An(e.useValue);else if(function uu(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...as(e.deps||[]));else if(function o_(e){return!(!e||!e.useExisting)}(e))r=()=>sn(An(e.useExisting));else{const l=An(e&&(e.useClass||e.provide));if(!function jv(e){return!!e.deps}(e))return pl(l)||a_(l);r=()=>new l(...as(e.deps))}return r}function ch(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function l_(e,n){for(const t of e)Array.isArray(t)?l_(t,n):t&&js(t)?l_(t.\u0275providers,n):n(t)}const kf=new Xt("AppId",{providedIn:"root",factory:()=>Pb}),Pb="ng",c_=new Xt("Platform Initializer"),uh=new Xt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Of=new Xt("CSP nonce",{providedIn:"root",factory:()=>function ld(){if(void 0!==Zg)return Zg;if(typeof document<"u")return document;throw new Mt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let m_=(e,n,t)=>null;function Jl(e,n,t=!1){return m_(e,n,t)}class qv{}class __{}class Wv{resolveComponentFactory(n){throw function Zv(e){const n=Error(`No component factory found for ${sr(e)}.`);return n.ngComponent=e,n}(n)}}let gm=(()=>{class e{static#e=this.NULL=new Wv}return e})();function Ob(){return Oc(Vr(),vt())}function Oc(e,n){return new ua(Ji(e,n))}let ua=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=Ob}return e})();function vd(e){return e instanceof ua?e.nativeElement:e}class _m{}let qa=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Ql(){const e=vt(),t=Br(Vr().index,e);return(No(t)?t:e)[Oe]}()}return e})(),v_=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>null})}return e})();class fh{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const wl=new fh("16.2.11"),Nc={};function xm(e,n=null,t=null,r){const l=w_(e,n,t,r);return l.resolveInjectorInitializers(),l}function w_(e,n=null,t=null,r,l=new Set){const f=[t||ei,Sb(e)];return r=r||("object"==typeof e?void 0:sr(e)),new fd(f,n||fu(),r||null,l)}let As=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=qs;static#t=this.NULL=new n_;static create(t,r){if(Array.isArray(t))return xm({name:""},r,t,"");{const l=t.name??"";return xm({name:l},t.parent,t.providers,l)}}static#n=this.\u0275prov=an({token:e,providedIn:"any",factory:()=>sn(Vv)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function jf(e){return e.ngOriginalError}class ec{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&jf(n);for(;t&&jf(t);)t=jf(t);return t||null}}function i(e){return n=>{setTimeout(e,void 0,n)}}const s=class o extends Dn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,r){let l=n,f=t||(()=>null),y=r;if(n&&"object"==typeof n){const D=n;l=D.next?.bind(D),f=D.error?.bind(D),y=D.complete?.bind(D)}this.__isAsync&&(f=i(f),l&&(l=i(l)),y&&(y=i(y)));const C=super.subscribe({next:l,error:f,complete:y});return n instanceof Le&&n.add(C),C}};function c(...e){}class v{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new s(!1),this.onMicrotaskEmpty=new s(!1),this.onStable=new s(!1),this.onError=new s(!1),typeof Zone>"u")throw new Mt(908,!1);Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!r&&t,l.shouldCoalesceRunChangeDetection=r,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function p(){const e="function"==typeof wi.requestAnimationFrame;let n=wi[e?"requestAnimationFrame":"setTimeout"],t=wi[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const l=t[Zone.__symbol__("OriginalDelegate")];l&&(t=l)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function P(e){const n=()=>{!function S(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(wi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,N(e),e.isCheckStableRunning=!0,T(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),N(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,l,f,y,C)=>{if(function se(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(C))return t.invokeTask(l,f,y,C);try{return F(e),t.invokeTask(l,f,y,C)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||e.shouldCoalesceRunChangeDetection)&&n(),V(e)}},onInvoke:(t,r,l,f,y,C,D)=>{try{return F(e),t.invoke(l,f,y,C,D)}finally{e.shouldCoalesceRunChangeDetection&&n(),V(e)}},onHasTask:(t,r,l,f)=>{t.hasTask(l,f),r===l&&("microTask"==f.change?(e._hasPendingMicrotasks=f.microTask,N(e),T(e)):"macroTask"==f.change&&(e.hasPendingMacrotasks=f.macroTask))},onHandleError:(t,r,l,f)=>(t.handleError(l,f),e.runOutsideAngular(()=>e.onError.emit(f)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!v.isInAngularZone())throw new Mt(909,!1)}static assertNotInAngularZone(){if(v.isInAngularZone())throw new Mt(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,l){const f=this._inner,y=f.scheduleEventTask("NgZoneEvent: "+l,n,w,c,c);try{return f.runTask(y,t,r)}finally{f.cancelTask(y)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const w={};function T(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function N(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function F(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function V(e){e._nesting--,T(e)}class j{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new s,this.onMicrotaskEmpty=new s,this.onStable=new s,this.onError=new s}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,l){return n.apply(t,r)}}const q=new Xt("",{providedIn:"root",factory:J});function J(){const e=tn(v);let n=!0;return function yn(...e){const n=_o(e),t=function Bs(e,n){return"number"==typeof lc(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?Ei(r[0]):Ea(t)(it(r,n)):oo}(new In(l=>{n=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{l.next(n),l.complete()})}),new In(l=>{let f;e.runOutsideAngular(()=>{f=e.onStable.subscribe(()=>{v.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(n=!0,l.next(!0))})})});const y=e.onUnstable.subscribe(()=>{v.assertInAngularZone(),n&&(n=!1,e.runOutsideAngular(()=>{l.next(!1)}))});return()=>{f.unsubscribe(),y.unsubscribe()}}).pipe(or()))}function me(e){return e instanceof Function?e():e}let ht=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>new e})}return e})();function ct(e){for(;e;){e[ft]|=64;const n=yf(e);if(Gd(e)&&!n)return e;e=n}return null}const nt=new Xt("",{providedIn:"root",factory:()=>!1});let Fn=null;function Di(e,n){return e[n]??hr()}function Oi(e,n){const t=hr();t.producerNode?.length&&(e[n]=Fn,t.lView=e,Fn=Mi())}const ji={...b,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{ct(e.lView)},lView:null};function Mi(){return Object.create(ji)}function hr(){return Fn??=Mi(),Fn}const pn={};function st(e){Si(Qn(),vt(),Fo()+e,!1)}function Si(e,n,t,r){if(!r)if(3==(3&n[ft])){const f=e.preOrderCheckHooks;null!==f&&Ep(n,f,t)}else{const f=e.preOrderHooks;null!==f&&Cp(n,f,0,t)}nu(t)}function et(e,n=$n.Default){const t=vt();return null===t?sn(e,n):af(Vr(),t,An(e),n)}function ai(e,n,t,r,l,f,y,C,D,O,$){const W=n.blueprint.slice();return W[Zi]=l,W[ft]=140|r,(null!==O||e&&2048&e[ft])&&(W[ft]|=2048),Uh(W),W[h]=W[xn]=e,W[X]=t,W[He]=y||e&&e[He],W[Oe]=C||e&&e[Oe],W[xe]=D||e&&e[xe]||null,W[k]=f,W[Sr]=function ib(){return nb++}(),W[Xo]=$,W[Js]=O,W[vn]=2==n.type?e[vn]:W,W}function dr(e,n,t,r,l){let f=e.data[n];if(null===f)f=function Ii(e,n,t,r,l){const f=Ny(),y=hg(),D=e.data[n]=function D_(e,n,t,r,l,f){let y=n?n.injectorIndex:-1,C=0;return function jh(){return null!==Zn.skipHydrationRootTNode}()&&(C|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:C,providerIndexes:0,value:l,attrs:f,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?f:f&&f.parent,t,n,r,l);return null===e.firstChild&&(e.firstChild=D),null!==f&&(y?null==f.child&&null!==D.parent&&(f.child=D):null===f.next&&(f.next=D,D.prev=f)),D}(e,n,t,r,l),function Ds(){return Zn.lFrame.inI18n}()&&(f.flags|=32);else if(64&f.type){f.type=t,f.value=r,f.attrs=l;const y=function Yd(){const e=Zn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();f.injectorIndex=null===y?-1:y.injectorIndex}return Gl(f,!0),f}function po(e,n,t,r){if(0===t)return-1;const l=n.length;for(let f=0;f<t;f++)n.push(r),e.blueprint.push(r),e.data.push(null);return l}function Ar(e,n,t,r,l){const f=Di(n,Qs),y=Fo(),C=2&r;try{nu(-1),C&&n.length>ni&&Si(e,n,ni,!1),pi(C?2:0,l);const O=C?f:null,$=z(O);try{null!==O&&(O.dirty=!1),t(r,l)}finally{H(O,$)}}finally{C&&null===n[Qs]&&Oi(n,Qs),nu(y),pi(C?3:1,l)}}function eo(e,n,t){if(lo(n)){const r=_(null);try{const f=n.directiveEnd;for(let y=n.directiveStart;y<f;y++){const C=e.data[y];C.contentQueries&&C.contentQueries(1,t[y],y)}}finally{_(r)}}}function Hr(e,n,t){cg()&&(function I_(e,n,t,r){const l=t.directiveStart,f=t.directiveEnd;xc(t)&&function C2(e,n,t){const r=Ji(n,e),l=to(t);let y=16;t.signals?y=4096:t.onPush&&(y=64);const C=o0(e,ai(e,l,null,y,r,n,null,e[He].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=C}(n,t,e.data[l+t.componentOffset]),e.firstCreatePass||sf(t,n),Vo(r,n);const y=t.initialInputs;for(let C=l;C<f;C++){const D=e.data[C],O=gl(n,e,C,t);Vo(O,n),null!==y&&T2(0,C-l,O,D,0,y),ea(D)&&(Br(t.index,n)[X]=gl(n,e,C,t))}}(e,n,t,Ji(t,n)),64==(64&t.flags)&&A_(e,n,t))}function Mo(e,n,t=Ji){const r=n.localNames;if(null!==r){let l=n.index+1;for(let f=0;f<r.length;f+=2){const y=r[f+1],C=-1===y?t(n,e):e[y];e[l++]=C}}}function to(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=ha(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function ha(e,n,t,r,l,f,y,C,D,O,$){const W=ni+r,oe=W+l,ve=function bd(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:pn);return t}(W,oe),We="function"==typeof O?O():O;return ve[Jt]={type:e,blueprint:ve,template:t,queries:null,viewQuery:C,declTNode:n,data:ve.slice().fill(null,W),bindingStartIndex:W,expandoStartIndex:oe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof f?f():f,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:D,consts:We,incompleteFirstPass:!1,ssrId:$}}let T_=e=>null;function bm(e,n,t,r){for(let l in e)if(e.hasOwnProperty(l)){t=null===t?{}:t;const f=e[l];null===r?El(t,n,l,f):r.hasOwnProperty(l)&&El(t,n,r[l],f)}return t}function El(e,n,t,r){e.hasOwnProperty(t)?e[t].push(n,r):e[t]=[n,r]}function ps(e,n,t,r,l,f,y,C){const D=Ji(n,t);let $,O=n.inputs;!C&&null!=O&&($=O[r])?(jb(e,t,$,r,l),xc(n)&&function M_(e,n){const t=Br(n,e);16&t[ft]||(t[ft]|=64)}(t,n.index)):3&n.type&&(r=function mh(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),l=null!=y?y(l,n.value||"",r):l,f.setProperty(D,r,l))}function S_(e,n,t,r){if(cg()){const l=null===r?null:{"":-1},f=function v2(e,n){const t=e.directiveRegistry;let r=null,l=null;if(t)for(let f=0;f<t.length;f++){const y=t[f];if(La(n,y.selectors,!1))if(r||(r=[]),ea(y))if(null!==y.findHostDirectiveDefs){const C=[];l=l||new Map,y.findHostDirectiveDefs(y,C,l),r.unshift(...C,y),Bb(e,n,C.length)}else r.unshift(y),Bb(e,n,0);else l=l||new Map,y.findHostDirectiveDefs?.(y,r,l),r.push(y)}return null===r?null:[r,l]}(e,t);let y,C;null===f?y=C=null:[y,C]=f,null!==y&&ms(e,n,t,y,l,C),l&&function x2(e,n,t){if(n){const r=e.localNames=[];for(let l=0;l<n.length;l+=2){const f=t[n[l+1]];if(null==f)throw new Mt(-301,!1);r.push(n[l],f)}}}(t,r,l)}t.mergedAttrs=Ks(t.mergedAttrs,t.attrs)}function ms(e,n,t,r,l,f){for(let O=0;O<r.length;O++)Mc(sf(t,n),e,r[O].type);!function w2(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let O=0;O<r.length;O++){const $=r[O];$.providersResolver&&$.providersResolver($)}let y=!1,C=!1,D=po(e,n,r.length,null);for(let O=0;O<r.length;O++){const $=r[O];t.mergedAttrs=Ks(t.mergedAttrs,$.hostAttrs),E2(e,t,n,D,$),b2(D,$,l),null!==$.contentQueries&&(t.flags|=4),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(t.flags|=64);const W=$.type.prototype;!y&&(W.ngOnChanges||W.ngOnInit||W.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),y=!0),!C&&(W.ngOnChanges||W.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),C=!0),D++}!function n0(e,n,t){const l=n.directiveEnd,f=e.data,y=n.attrs,C=[];let D=null,O=null;for(let $=n.directiveStart;$<l;$++){const W=f[$],oe=t?t.get(W):null,We=oe?oe.outputs:null;D=bm(W.inputs,$,D,oe?oe.inputs:null),O=bm(W.outputs,$,O,We);const Qe=null===D||null===y||zu(n)?null:D2(D,$,y);C.push(Qe)}null!==D&&(D.hasOwnProperty("class")&&(n.flags|=8),D.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=C,n.inputs=D,n.outputs=O}(e,t,f)}function A_(e,n,t){const r=t.directiveStart,l=t.directiveEnd,f=t.index,y=function ml(){return Zn.lFrame.currentDirectiveIndex}();try{nu(f);for(let C=r;C<l;C++){const D=e.data[C],O=n[C];Kd(C),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&gh(D,O)}}finally{nu(-1),Kd(y)}}function gh(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function Bb(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function b2(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;ea(n)&&(t[""]=e)}}function E2(e,n,t,r,l){e.data[r]=l;const f=l.factory||(l.factory=pl(l.type)),y=new qh(f,ea(l),et);e.blueprint[r]=y,t[r]=y,function Ps(e,n,t,r,l){const f=l.hostBindings;if(f){let y=e.hostBindingOpCodes;null===y&&(y=e.hostBindingOpCodes=[]);const C=~n.index;(function Gf(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(y)!=C&&y.push(C),y.push(t,r,f)}}(e,n,r,po(e,t,l.hostVars,pn),l)}function yu(e,n,t,r,l,f){const y=Ji(e,n);!function Vb(e,n,t,r,l,f,y){if(null==f)e.removeAttribute(n,l,t);else{const C=null==y?cn(f):y(f,r||"",l);e.setAttribute(n,l,C,t)}}(n[Oe],y,f,e.value,t,r,l)}function T2(e,n,t,r,l,f){const y=f[n];if(null!==y)for(let C=0;C<y.length;)ZE(r,t,y[C++],y[C++],y[C++])}function ZE(e,n,t,r,l){const f=_(null);try{const y=e.inputTransforms;null!==y&&y.hasOwnProperty(r)&&(l=y[r].call(n,l)),null!==e.setInput?e.setInput(n,l,t,r):n[r]=l}finally{_(f)}}function D2(e,n,t){let r=null,l=0;for(;l<t.length;){const f=t[l];if(0!==f)if(5!==f){if("number"==typeof f)break;if(e.hasOwnProperty(f)){null===r&&(r=[]);const y=e[f];for(let C=0;C<y.length;C+=2)if(y[C]===n){r.push(f,y[C+1],t[l+1]);break}}l+=2}else l+=2;else l+=4}return r}function WE(e,n,t,r){return[e,!0,!1,n,null,0,r,t,null,null,null]}function XE(e,n){const t=e.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const f=t[r+1];if(-1!==f){const y=e.data[f];Cc(t[r]),y.contentQueries(2,n[f],f)}}}function o0(e,n){return e[Tt]?e[rn][x]=n:e[Tt]=n,e[rn]=n,n}function Ub(e,n,t){Cc(0);const r=_(null);try{n(e,t)}finally{_(r)}}function YE(e){return e[U]||(e[U]=[])}function KE(e){return e.cleanup||(e.cleanup=[])}function QE(e,n){const t=e[xe],r=t?t.get(ec,null):null;r&&r.handleError(n)}function jb(e,n,t,r,l){for(let f=0;f<t.length;){const y=t[f++],C=t[f++];ZE(e.data[y],n[y],r,C,l)}}function _h(e,n,t){const r=ki(n,e);!function wv(e,n,t){e.setValue(n,t)}(e[Oe],r,t)}function M2(e,n){const t=Br(n,e),r=t[Jt];!function S2(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const l=t[Zi];null!==l&&null===t[Xo]&&(t[Xo]=Jl(l,t[xe])),$b(r,t,t[X])}function $b(e,n,t){xp(n);try{const r=e.viewQuery;null!==r&&Ub(1,r,t);const l=e.template;null!==l&&Ar(e,n,l,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&XE(e,n),e.staticViewQueries&&Ub(2,e.viewQuery,t);const f=e.components;null!==f&&function I2(e,n){for(let t=0;t<n.length;t++)M2(e,n[t])}(n,f)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[ft]&=-5,ju()}}let eC=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,r,l){const f=typeof Zone>"u"?null:Zone.current,y=function Rn(e,n,t){const r=Object.create(bn);t&&(r.consumerAllowSignalWrites=!0),r.fn=e,r.schedule=n;const l=y=>{r.cleanupFn=y};return r.ref={notify:()=>B(r),run:()=>{if(r.dirty=!1,r.hasRun&&!K(r))return;r.hasRun=!0;const y=z(r);try{r.cleanupFn(),r.cleanupFn=en,r.fn(l)}finally{H(r,y)}},cleanup:()=>r.cleanupFn()},r.ref}(t,O=>{this.all.has(O)&&this.queue.set(O,f)},l);let C;this.all.add(y),y.notify();const D=()=>{y.cleanup(),C?.(),this.all.delete(y),this.queue.delete(y)};return C=r?.onDestroy(D),{destroy:D}}flush(){if(0!==this.queue.size)for(const[t,r]of this.queue)this.queue.delete(t),r?r.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>new e})}return e})();function s0(e,n,t){let r=t?e.styles:null,l=t?e.classes:null,f=0;if(null!==n)for(let y=0;y<n.length;y++){const C=n[y];"number"==typeof C?f=C:1==f?l=Po(l,C):2==f&&(r=Po(r,C+": "+n[++y]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=l:e.classesWithoutHost=l}function P_(e,n,t,r,l=!1){for(;null!==t;){const f=n[t.index];null!==f&&r.push(Xn(f)),To(f)&&tC(f,r);const y=t.type;if(8&y)P_(e,n,t.child,r);else if(32&y){const C=Ku(t,n);let D;for(;D=C();)r.push(D)}else if(16&y){const C=wf(n,t);if(Array.isArray(C))r.push(...C);else{const D=yf(n[vn]);P_(D[Jt],D,C,r,!0)}}t=l?t.projectionNext:t.next}return r}function tC(e,n){for(let t=zr;t<e.length;t++){const r=e[t],l=r[Jt].firstChild;null!==l&&P_(r[Jt],r,l,n)}e[Jr]!==e[Zi]&&n.push(e[Jr])}function a0(e,n,t,r=!0){const l=n[He],f=l.rendererFactory,y=l.afterRenderEventManager;f.begin?.(),y?.begin();try{nC(e,n,e.template,t)}catch(D){throw r&&QE(n,D),D}finally{f.end?.(),l.effectManager?.flush(),y?.end()}}function nC(e,n,t,r){const l=n[ft];if(256!=(256&l)){n[He].effectManager?.flush(),xp(n);try{Uh(n),function gn(e){return Zn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Ar(e,n,t,2,r);const y=3==(3&l);if(y){const O=e.preOrderCheckHooks;null!==O&&Ep(n,O,null)}else{const O=e.preOrderHooks;null!==O&&Cp(n,O,0,null),Tp(n,0)}if(function R2(e){for(let n=kg(e);null!==n;n=Og(n)){if(!n[jl])continue;const t=n[dl];for(let r=0;r<t.length;r++){Ly(t[r])}}}(n),iC(n,2),null!==e.contentQueries&&XE(e,n),y){const O=e.contentCheckHooks;null!==O&&Ep(n,O)}else{const O=e.contentHooks;null!==O&&Cp(n,O,1),Tp(n,1)}!function wr(e,n){const t=e.hostBindingOpCodes;if(null===t)return;const r=Di(n,Es);try{for(let l=0;l<t.length;l++){const f=t[l];if(f<0)nu(~f);else{const y=f,C=t[++l],D=t[++l];By(C,y),r.dirty=!1;const O=z(r);try{D(2,n[y])}finally{H(r,O)}}}}finally{null===n[Es]&&Oi(n,Es),nu(-1)}}(e,n);const C=e.components;null!==C&&oC(n,C,0);const D=e.viewQuery;if(null!==D&&Ub(2,D,r),y){const O=e.viewCheckHooks;null!==O&&Ep(n,O)}else{const O=e.viewHooks;null!==O&&Cp(n,O,2),Tp(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[ft]&=-73,ag(n)}finally{ju()}}}function iC(e,n){for(let t=kg(e);null!==t;t=Og(t))for(let r=zr;r<t.length;r++)rC(t[r],n)}function L2(e,n,t){rC(Br(n,e),t)}function rC(e,n){if(!function bc(e){return 128==(128&e[ft])}(e))return;const t=e[Jt],r=e[ft];if(80&r&&0===n||1024&r||2===n)nC(t,e,t.template,e[X]);else if(e[M]>0){iC(e,1);const l=t.components;null!==l&&oC(e,l,1)}}function oC(e,n,t){for(let r=0;r<n.length;r++)L2(e,n[r],t)}class R_{get rootNodes(){const n=this._lView,t=n[Jt];return P_(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[X]}set context(n){this._lView[X]=n}get destroyed(){return 256==(256&this._lView[ft])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[h];if(To(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(Yp(n,r),Jh(t,r))}this._attachedToViewContainer=!1}zg(this._lView[Jt],this._lView)}onDestroy(n){!function mp(e,n){if(256==(256&e[ft]))throw new Mt(911,!1);null===e[ws]&&(e[ws]=[]),e[ws].push(n)}(this._lView,n)}markForCheck(){ct(this._cdRefInjectingView||this._lView)}detach(){this._lView[ft]&=-129}reattach(){this._lView[ft]|=128}detectChanges(){a0(this._lView[Jt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Mt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function vf(e,n){Ef(e,n,n[Oe],2,null,null)}(this._lView[Jt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Mt(902,!1);this._appRef=n}}class k2 extends R_{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;a0(n[Jt],n,n[X],!1)}checkNoChanges(){}get context(){return null}}class sC extends gm{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=ti(n);return new L_(t,this.ngModule)}}function aC(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class N2{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=Zs(r);const l=this.injector.get(n,Nc,r);return l!==Nc||t===Nc?l:this.parentInjector.get(n,t,r)}}class L_ extends __{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=aC(n.inputs);if(null!==t)for(const l of r)t.hasOwnProperty(l.propName)&&(l.transform=t[l.propName]);return r}get outputs(){return aC(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function _c(e){return e.map(ao).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,l){let f=(l=l||this.ngModule)instanceof Qo?l:l?.injector;f&&null!==this.componentDef.getStandaloneInjector&&(f=this.componentDef.getStandaloneInjector(f)||f);const y=f?new N2(n,f):n,C=y.get(_m,null);if(null===C)throw new Mt(407,!1);const W={rendererFactory:C,sanitizer:y.get(v_,null),effectManager:y.get(eC,null),afterRenderEventManager:y.get(ht,null)},oe=C.createRenderer(null,this.componentDef),ve=this.componentDef.selectors[0][0]||"div",We=r?function $f(e,n,t,r){const f=r.get(nt,!1)||t===xr.ShadowDom,y=e.selectRootElement(n,f);return function Hf(e){T_(e)}(y),y}(oe,r,this.componentDef.encapsulation,y):Qu(oe,ve,function O2(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(ve)),Vt=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let dt=null;null!==We&&(dt=Jl(We,y,!0));const hn=ha(0,null,null,1,0,null,null,null,null,null,null),Un=ai(null,hn,null,Vt,null,null,W,oe,y,null,dt);let yi,ts;xp(Un);try{const Su=this.componentDef;let lp,LE=null;Su.findHostDirectiveDefs?(lp=[],LE=new Map,Su.findHostDirectiveDefs(Su,lp,LE),lp.push(Su)):lp=[Su];const l4=function z2(e,n){const t=e[Jt],r=ni;return e[r]=n,dr(t,r,2,"#host",null)}(Un,We),c4=function B2(e,n,t,r,l,f,y){const C=l[Jt];!function V2(e,n,t,r){for(const l of e)n.mergedAttrs=Ks(n.mergedAttrs,l.hostAttrs);null!==n.mergedAttrs&&(s0(n,n.mergedAttrs,!0),null!==t&&qg(r,t,n))}(r,e,n,y);let D=null;null!==n&&(D=Jl(n,l[xe]));const O=f.rendererFactory.createRenderer(n,t);let $=16;t.signals?$=4096:t.onPush&&($=64);const W=ai(l,to(t),null,$,l[e.index],e,f,O,null,null,D);return C.firstCreatePass&&Bb(C,e,r.length-1),o0(l,W),l[e.index]=W}(l4,We,Su,lp,Un,W,oe);ts=$l(hn,ni),We&&function j2(e,n,t,r){if(r)Xs(e,t,["ng-version",wl.full]);else{const{attrs:l,classes:f}=function al(e){const n=[],t=[];let r=1,l=2;for(;r<e.length;){let f=e[r];if("string"==typeof f)2===l?""!==f&&n.push(f,e[++r]):8===l&&t.push(f);else{if(!cs(l))break;l=f}r++}return{attrs:n,classes:t}}(n.selectors[0]);l&&Xs(e,t,l),f&&f.length>0&&Qp(e,t,f.join(" "))}}(oe,Su,We,r),void 0!==t&&function $2(e,n,t){const r=e.projection=[];for(let l=0;l<n.length;l++){const f=t[l];r.push(null!=f?Array.from(f):null)}}(ts,this.ngContentSelectors,t),yi=function U2(e,n,t,r,l,f){const y=Vr(),C=l[Jt],D=Ji(y,l);ms(C,l,y,t,null,r);for(let $=0;$<t.length;$++)Vo(gl(l,C,y.directiveStart+$,y),l);A_(C,l,y),D&&Vo(D,l);const O=gl(l,C,y.directiveStart+y.componentOffset,y);if(e[X]=l[X]=O,null!==f)for(const $ of f)$(O,n);return eo(C,y,e),O}(c4,Su,lp,LE,Un,[H2]),$b(hn,Un,null)}finally{ju()}return new F2(this.componentType,yi,Oc(ts,Un),Un,ts)}}class F2 extends qv{constructor(n,t,r,l,f){super(),this.location=r,this._rootLView=l,this._tNode=f,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new k2(l),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let l;if(null!==r&&(l=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const f=this._rootLView;jb(f[Jt],f,l,n,t),this.previousInputValues.set(n,t),ct(Br(this._tNode.index,f))}}get injector(){return new ho(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function H2(){const e=Vr();Ms(vt()[Jt],e)}function _r(e){let n=function lC(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let l;if(ea(e))l=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Mt(903,!1);l=n.\u0275dir}if(l){if(t){r.push(l);const y=e;y.inputs=l0(e.inputs),y.inputTransforms=l0(e.inputTransforms),y.declaredInputs=l0(e.declaredInputs),y.outputs=l0(e.outputs);const C=l.hostBindings;C&&W2(e,C);const D=l.viewQuery,O=l.contentQueries;if(D&&q2(e,D),O&&Z2(e,O),fi(e.inputs,l.inputs),fi(e.declaredInputs,l.declaredInputs),fi(e.outputs,l.outputs),null!==l.inputTransforms&&(null===y.inputTransforms&&(y.inputTransforms={}),fi(y.inputTransforms,l.inputTransforms)),ea(l)&&l.data.animation){const $=e.data;$.animation=($.animation||[]).concat(l.data.animation)}}const f=l.features;if(f)for(let y=0;y<f.length;y++){const C=f[y];C&&C.ngInherit&&C(e),C===_r&&(t=!1)}}n=Object.getPrototypeOf(n)}!function G2(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const l=e[r];l.hostVars=n+=l.hostVars,l.hostAttrs=Ks(l.hostAttrs,t=Ks(t,l.hostAttrs))}}(r)}function l0(e){return e===ls?{}:e===ei?[]:e}function q2(e,n){const t=e.viewQuery;e.viewQuery=t?(r,l)=>{n(r,l),t(r,l)}:n}function Z2(e,n){const t=e.contentQueries;e.contentQueries=t?(r,l,f)=>{n(r,l,f),t(r,l,f)}:n}function W2(e,n){const t=e.hostBindings;e.hostBindings=t?(r,l)=>{n(r,l),t(r,l)}:n}function dC(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const l=n[r];Array.isArray(l)&&l[2]&&(t[r]=l[2])}e.inputTransforms=t}function c0(e){return!!Hb(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Hb(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function vu(e,n,t){return e[n]=t}function Rs(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function qf(e,n,t,r){const l=Rs(e,n,t);return Rs(e,n+1,r)||l}function xu(e,n,t,r){const l=vt();return Rs(l,na(),n)&&(Qn(),yu(mr(),l,e,n,t,r)),xu}function Em(e,n,t,r){return Rs(e,na(),t)?n+cn(t)+r:pn}function Cm(e,n,t,r,l,f){const C=qf(e,function Bi(){return Zn.lFrame.bindingIndex}(),t,l);return Va(2),C?n+cn(t)+r+cn(l)+f:pn}function _i(e,n,t,r,l,f,y,C){const D=vt(),O=Qn(),$=e+ni,W=O.firstCreatePass?function vP(e,n,t,r,l,f,y,C,D){const O=n.consts,$=dr(n,e,4,y||null,Ts(O,C));S_(n,t,$,Ts(O,D)),Ms(n,$);const W=$.tView=ha(2,$,r,l,f,n.directiveRegistry,n.pipeRegistry,null,n.schemas,O,null);return null!==n.queries&&(n.queries.template(n,$),W.queries=n.queries.embeddedTView($)),$}($,O,D,n,t,r,l,f,y):O.data[$];Gl(W,!1);const oe=TC(O,D,W,e);gr()&&Is(O,D,oe,W),Vo(oe,D),o0(D,D[$]=WE(oe,D,oe,W)),Bu(W)&&Hr(O,D,W),null!=y&&Mo(D,W,C)}let TC=function DC(e,n,t,r){return Dc(!0),n[Oe].createComment("")};function Yb(e){return Ba(function Fy(){return Zn.lFrame.contextLView}(),ni+e)}function Gt(e,n,t){const r=vt();return Rs(r,na(),n)&&ps(Qn(),mr(),r,e,n,r[Oe],t,!1),Gt}function Kb(e,n,t,r,l){const y=l?"class":"style";jb(e,t,n.inputs[y],y,r)}function Se(e,n,t,r){const l=vt(),f=Qn(),y=ni+e,C=l[Oe],D=f.firstCreatePass?function EP(e,n,t,r,l,f){const y=n.consts,D=dr(n,e,2,r,Ts(y,l));return S_(n,t,D,Ts(y,f)),null!==D.attrs&&s0(D,D.attrs,!1),null!==D.mergedAttrs&&s0(D,D.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,D),D}(y,f,l,n,t,r):f.data[y],O=MC(f,l,D,C,n,e);l[y]=O;const $=Bu(D);return Gl(D,!0),qg(C,O,D),32!=(32&D.flags)&&gr()&&Is(f,l,O,D),0===function wc(){return Zn.lFrame.elementDepthCount}()&&Vo(O,l),function yp(){Zn.lFrame.elementDepthCount++}(),$&&(Hr(f,l,D),eo(f,D,l)),null!==r&&Mo(l,D),Se}function Ie(){let e=Vr();hg()?function vp(){Zn.lFrame.isParent=!1}():(e=e.parent,Gl(e,!1));const n=e;(function Fx(e){return Zn.skipHydrationRootTNode===e})(n)&&function $h(){Zn.skipHydrationRootTNode=null}(),function Oy(){Zn.lFrame.elementDepthCount--}();const t=Qn();return t.firstCreatePass&&(Ms(t,e),lo(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function $y(e){return 0!=(8&e.flags)}(n)&&Kb(t,n,vt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function nf(e){return 0!=(16&e.flags)}(n)&&Kb(t,n,vt(),n.stylesWithoutHost,!1),Ie}function wo(e,n,t,r){return Se(e,n,t,r),Ie(),wo}let MC=(e,n,t,r,l,f)=>(Dc(!0),Qu(r,l,function ra(){return Zn.lFrame.currentNamespace}()));function Pm(){return vt()}function z_(e){return!!e&&"function"==typeof e.then}function AC(e){return!!e&&"function"==typeof e.subscribe}function Sn(e,n,t,r){const l=vt(),f=Qn(),y=Vr();return function RC(e,n,t,r,l,f,y){const C=Bu(r),O=e.firstCreatePass&&KE(e),$=n[X],W=YE(n);let oe=!0;if(3&r.type||y){const Qe=Ji(r,n),mt=y?y(Qe):Qe,Vt=W.length,dt=y?Un=>y(Xn(Un[r.index])):r.index;let hn=null;if(!y&&C&&(hn=function IP(e,n,t,r){const l=e.cleanup;if(null!=l)for(let f=0;f<l.length-1;f+=2){const y=l[f];if(y===t&&l[f+1]===r){const C=n[U],D=l[f+2];return C.length>D?C[D]:null}"string"==typeof y&&(f+=2)}return null}(e,n,l,r.index)),null!==hn)(hn.__ngLastListenerFn__||hn).__ngNextListenerFn__=f,hn.__ngLastListenerFn__=f,oe=!1;else{f=kC(r,n,$,f,!1);const Un=t.listen(mt,l,f);W.push(f,Un),O&&O.push(l,dt,Vt,Vt+1)}}else f=kC(r,n,$,f,!1);const ve=r.outputs;let We;if(oe&&null!==ve&&(We=ve[l])){const Qe=We.length;if(Qe)for(let mt=0;mt<Qe;mt+=2){const yi=n[We[mt]][We[mt+1]].subscribe(f),ts=W.length;W.push(f,yi),O&&O.push(l,r.index,ts,-(ts+1))}}}(f,l,l[Oe],y,e,n,r),Sn}function LC(e,n,t,r){try{return pi(6,n,t),!1!==t(r)}catch(l){return QE(e,l),!1}finally{pi(7,n,t)}}function kC(e,n,t,r,l){return function f(y){if(y===Function)return r;ct(e.componentOffset>-1?Br(e.index,n):n);let D=LC(n,t,r,y),O=f.__ngNextListenerFn__;for(;O;)D=LC(n,t,O,y)&&D,O=O.__ngNextListenerFn__;return l&&!1===D&&y.preventDefault(),D}}function Ni(e=1){return function Gh(e){return(Zn.lFrame.contextLView=function Tc(e,n){for(;e>0;)n=n[xn],e--;return n}(e,Zn.lFrame.contextLView))[X]}(e)}function ew(e,n,t){return tw(e,"",n,"",t),ew}function tw(e,n,t,r,l){const f=vt(),y=Em(f,n,t,r);return y!==pn&&ps(Qn(),mr(),f,e,y,f[Oe],l,!1),tw}function p0(e,n){return e<<17|n<<2}function wd(e){return e>>17&32767}function nw(e){return 2|e}function Zf(e){return(131068&e)>>2}function iw(e,n){return-131069&e|n<<2}function rw(e){return 1|e}function $C(e,n,t,r,l){const f=e[t+1],y=null===n;let C=r?wd(f):Zf(f),D=!1;for(;0!==C&&(!1===D||y);){const $=e[C+1];zP(e[C],n)&&(D=!0,e[C+1]=r?rw($):nw($)),C=r?wd($):Zf($)}D&&(e[t+1]=r?nw(f):rw(f))}function zP(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&Zu(e,n)>=0}function m0(e,n){return function Fc(e,n,t,r){const l=vt(),f=Qn(),y=Va(2);f.firstUpdatePass&&function JC(e,n,t,r){const l=e.data;if(null===l[t+1]){const f=l[Fo()],y=function KC(e,n){return n>=e.expandoStartIndex}(e,t);(function nT(e,n){return 0!=(e.flags&(n?8:16))})(f,r)&&null===n&&!y&&(n=!1),n=function ZP(e,n,t,r){const l=function Ec(e){const n=Zn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let f=r?n.residualClasses:n.residualStyles;if(null===l)0===(r?n.classBindings:n.styleBindings)&&(t=B_(t=ow(null,e,n,t,r),n.attrs,r),f=null);else{const y=n.directiveStylingLast;if(-1===y||e[y]!==l)if(t=ow(l,e,n,t,r),null===f){let D=function WP(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==Zf(r))return e[wd(r)]}(e,n,r);void 0!==D&&Array.isArray(D)&&(D=ow(null,e,n,D[1],r),D=B_(D,n.attrs,r),function XP(e,n,t,r){e[wd(t?n.classBindings:n.styleBindings)]=r}(e,n,r,D))}else f=function YP(e,n,t){let r;const l=n.directiveEnd;for(let f=1+n.directiveStylingLast;f<l;f++)r=B_(r,e[f].hostAttrs,t);return B_(r,n.attrs,t)}(e,n,r)}return void 0!==f&&(r?n.residualClasses=f:n.residualStyles=f),t}(l,f,n,r),function NP(e,n,t,r,l,f){let y=f?n.classBindings:n.styleBindings,C=wd(y),D=Zf(y);e[r]=t;let $,O=!1;if(Array.isArray(t)?($=t[1],(null===$||Zu(t,$)>0)&&(O=!0)):$=t,l)if(0!==D){const oe=wd(e[C+1]);e[r+1]=p0(oe,C),0!==oe&&(e[oe+1]=iw(e[oe+1],r)),e[C+1]=function kP(e,n){return 131071&e|n<<17}(e[C+1],r)}else e[r+1]=p0(C,0),0!==C&&(e[C+1]=iw(e[C+1],r)),C=r;else e[r+1]=p0(D,0),0===C?C=r:e[D+1]=iw(e[D+1],r),D=r;O&&(e[r+1]=nw(e[r+1])),$C(e,$,r,!0),$C(e,$,r,!1),function FP(e,n,t,r,l){const f=l?e.residualClasses:e.residualStyles;null!=f&&"string"==typeof n&&Zu(f,n)>=0&&(t[r+1]=rw(t[r+1]))}(n,$,e,r,f),y=p0(C,D),f?n.classBindings=y:n.styleBindings=y}(l,f,n,t,y,r)}}(f,e,y,r),n!==pn&&Rs(l,y,n)&&function eT(e,n,t,r,l,f,y,C){if(!(3&n.type))return;const D=e.data,O=D[C+1],$=function OP(e){return 1==(1&e)}(O)?tT(D,n,t,l,Zf(O),y):void 0;g0($)||(g0(f)||function LP(e){return 2==(2&e)}(O)&&(f=tT(D,null,t,l,C,y)),function Av(e,n,t,r,l){if(n)l?e.addClass(t,r):e.removeClass(t,r);else{let f=-1===r.indexOf("-")?void 0:Xl.DashCase;null==l?e.removeStyle(t,r,f):("string"==typeof l&&l.endsWith("!important")&&(l=l.slice(0,-10),f|=Xl.Important),e.setStyle(t,r,l,f))}}(r,y,ki(Fo(),t),l,f))}(f,f.data[Fo()],l,l[Oe],e,l[y+1]=function eR(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=sr(Rc(e)))),e}(n,t),r,y)}(e,n,null,!0),m0}function ow(e,n,t,r,l){let f=null;const y=t.directiveEnd;let C=t.directiveStylingLast;for(-1===C?C=t.directiveStart:C++;C<y&&(f=n[C],r=B_(r,f.hostAttrs,l),f!==e);)C++;return null!==e&&(t.directiveStylingLast=C),r}function B_(e,n,t){const r=t?1:2;let l=-1;if(null!==n)for(let f=0;f<n.length;f++){const y=n[f];"number"==typeof y?l=y:l===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ca(e,y,!!t||n[++f]))}return void 0===e?null:e}function tT(e,n,t,r,l,f){const y=null===n;let C;for(;l>0;){const D=e[l],O=Array.isArray(D),$=O?D[1]:D,W=null===$;let oe=t[l+1];oe===pn&&(oe=W?ei:void 0);let ve=W?hf(oe,r):$===r?oe:void 0;if(O&&!g0(ve)&&(ve=hf(D,r)),g0(ve)&&(C=ve,y))return C;const We=e[l+1];l=y?wd(We):Zf(We)}if(null!==n){let D=f?n.residualClasses:n.residualStyles;null!=D&&(C=hf(D,r))}return C}function g0(e){return void 0!==e}function rt(e,n=""){const t=vt(),r=Qn(),l=e+ni,f=r.firstCreatePass?dr(r,l,1,n,null):r.data[l],y=iT(r,t,f,n,e);t[l]=y,gr()&&Is(r,t,y,f),Gl(f,!1)}let iT=(e,n,t,r,l)=>(Dc(!0),function Wp(e,n){return e.createText(n)}(n[Oe],r));function Xi(e){return da("",e,""),Xi}function da(e,n,t){const r=vt(),l=Em(r,e,n,t);return l!==pn&&_h(r,Fo(),l),da}function sw(e,n,t,r,l){const f=vt(),y=Cm(f,e,n,t,r,l);return y!==pn&&_h(f,Fo(),y),sw}const Wf=void 0;var wR=["en",[["a","p"],["AM","PM"],Wf],[["AM","PM"],Wf,Wf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Wf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Wf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Wf,"{1} 'at' {0}",Wf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function bR(e){const t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];let Lm={};function fa(e){const n=function ER(e){return e.toLowerCase().replace(/_/g,"-")}(e);let t=ET(n);if(t)return t;const r=n.split("-")[0];if(t=ET(r),t)return t;if("en"===r)return wR;throw new Mt(701,!1)}function ET(e){return e in Lm||(Lm[e]=wi.ng&&wi.ng.common&&wi.ng.common.locales&&wi.ng.common.locales[e]),Lm[e]}var Pr=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}(Pr||{});const km="en-US";let CT=km;function cw(e,n,t,r,l){if(e=An(e),Array.isArray(e))for(let f=0;f<e.length;f++)cw(e[f],n,t,r,l);else{const f=Qn(),y=vt(),C=Vr();let D=ah(e)?e:An(e.provide);const O=Uv(e),$=1048575&C.providerIndexes,W=C.directiveStart,oe=C.providerIndexes>>20;if(ah(e)||!e.multi){const ve=new qh(O,l,et),We=hw(D,n,l?$:$+oe,W);-1===We?(Mc(sf(C,y),f,D),uw(f,e,n.length),n.push(D),C.directiveStart++,C.directiveEnd++,l&&(C.providerIndexes+=1048576),t.push(ve),y.push(ve)):(t[We]=ve,y[We]=ve)}else{const ve=hw(D,n,$+oe,W),We=hw(D,n,$,$+oe),mt=We>=0&&t[We];if(l&&!mt||!l&&!(ve>=0&&t[ve])){Mc(sf(C,y),f,D);const Vt=function bL(e,n,t,r,l){const f=new qh(e,t,et);return f.multi=[],f.index=n,f.componentProviders=0,XT(f,l,r&&!t),f}(l?xL:vL,t.length,l,r,O);!l&&mt&&(t[We].providerFactory=Vt),uw(f,e,n.length,0),n.push(D),C.directiveStart++,C.directiveEnd++,l&&(C.providerIndexes+=1048576),t.push(Vt),y.push(Vt)}else uw(f,e,ve>-1?ve:We,XT(t[l?We:ve],O,!l&&r));!l&&r&&mt&&t[We].componentProviders++}}}function uw(e,n,t,r){const l=ah(n),f=function hu(e){return!!e.useClass}(n);if(l||f){const D=(f?An(n.useClass):n).prototype.ngOnDestroy;if(D){const O=e.destroyHooks||(e.destroyHooks=[]);if(!l&&n.multi){const $=O.indexOf(t);-1===$?O.push(t,[r,D]):O[$+1].push(r,D)}else O.push(t,D)}}}function XT(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function hw(e,n,t,r){for(let l=t;l<r;l++)if(n[l]===e)return l;return-1}function vL(e,n,t,r){return dw(this.multi,[])}function xL(e,n,t,r){const l=this.multi;let f;if(this.providerFactory){const y=this.providerFactory.componentProviders,C=gl(t,t[Jt],this.providerFactory.index,r);f=C.slice(0,y),dw(l,f);for(let D=y;D<C.length;D++)f.push(C[D])}else f=[],dw(l,f);return f}function dw(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Gr(e,n=[]){return t=>{t.providersResolver=(r,l)=>function yL(e,n,t){const r=Qn();if(r.firstCreatePass){const l=ea(e);cw(t,r.data,r.blueprint,l,!0),cw(n,r.data,r.blueprint,l,!1)}}(r,l?l(e):e,n)}}class Xf{}class YT{}class fw extends Xf{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new sC(this);const l=Kr(n);this._bootstrapComponents=me(l.bootstrap),this._r3Injector=w_(n,t,[{provide:Xf,useValue:this},{provide:gm,useValue:this.componentFactoryResolver},...r],sr(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class pw extends YT{constructor(n){super(),this.moduleType=n}create(n){return new fw(this.moduleType,n,[])}}class KT extends Xf{constructor(n){super(),this.componentFactoryResolver=new sC(this),this.instance=null;const t=new fd([...n.providers,{provide:Xf,useValue:this},{provide:gm,useValue:this.componentFactoryResolver}],n.parent||fu(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function mw(e,n,t=null){return new KT({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let CL=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=hd(0,t.type),l=r.length>0?mw([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,l)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=an({token:e,providedIn:"environment",factory:()=>new e(sn(Qo))})}return e})();function JT(e){e.getStandaloneInjector=n=>n.get(CL).getOrCreateStandaloneInjector(e)}function _w(e,n,t,r){return function lD(e,n,t,r,l,f){const y=n+t;return Rs(e,y,l)?vu(e,y+1,f?r.call(f,l):r(l)):G_(e,y+1)}(vt(),hs(),e,n,t,r)}function aD(e,n,t,r,l,f){return function uD(e,n,t,r,l,f,y,C){const D=n+t;return function u0(e,n,t,r,l){const f=qf(e,n,t,r);return Rs(e,n+2,l)||f}(e,D,l,f,y)?vu(e,D+3,C?r.call(C,l,f,y):r(l,f,y)):G_(e,D+3)}(vt(),hs(),e,n,t,r,l,f)}function G_(e,n){const t=e[n];return t===pn?void 0:t}function cD(e,n,t,r,l,f,y){const C=n+t;return qf(e,C,l,f)?vu(e,C+2,y?r.call(y,l,f):r(l,f)):G_(e,C+2)}function q_(e,n){const t=Qn();let r;const l=e+ni;t.firstCreatePass?(r=function BL(e,n){if(n)for(let t=n.length-1;t>=0;t--){const r=n[t];if(e===r.name)return r}}(n,t.pipeRegistry),t.data[l]=r,r.onDestroy&&(t.destroyHooks??=[]).push(l,r.onDestroy)):r=t.data[l];const f=r.factory||(r.factory=pl(r.type)),C=Yr(et);try{const D=Dp(!1),O=f();return Dp(D),function wP(e,n,t,r){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=r}(t,vt(),l,O),O}finally{Yr(C)}}function Z_(e,n,t,r){const l=e+ni,f=vt(),y=Ba(f,l);return function W_(e,n){return e[Jt].data[n].pure}(f,l)?cD(f,hs(),n,y.transform,t,r,y):y.transform(t,r)}function HL(){return this._results[Symbol.iterator]()}class yw{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new s)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=yw.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=HL)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){const r=this;r.dirty=!1;const l=function Do(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Ic(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let l=e[r],f=n[r];if(t&&(l=t(l),f=t(f)),f!==l)return!1}return!0}(r._results,l,t))&&(r._results=l,r.length=l.length,r.last=l[this.length-1],r.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function qL(e,n,t,r=!0){const l=n[Jt];if(function xf(e,n,t,r){const l=zr+r,f=t.length;r>0&&(t[l-1][x]=n),r<f-zr?(n[x]=t[l],uf(t,zr+r,n)):(t.push(n),n[x]=null),n[h]=t;const y=n[Fr];null!==y&&t!==y&&function Cv(e,n){const t=e[dl];n[vn]!==n[h][h][vn]&&(e[jl]=!0),null===t?e[dl]=[n]:t.push(n)}(y,n);const C=n[Wi];null!==C&&C.insertView(e),n[ft]|=128}(l,n,e,t),r){const f=lu(t,e),y=n[Oe],C=Kp(y,e[Jr]);null!==C&&function Jo(e,n,t,r,l,f){r[Zi]=l,r[k]=n,Ef(e,r,t,1,l,f)}(l,e[k],y,n,C,f)}}let yh=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=XL}return e})();const ZL=yh,WL=class extends ZL{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const l=function GL(e,n,t,r){const l=n.tView,C=ai(e,l,t,4096&e[ft]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);C[Fr]=e[n.index];const O=e[Wi];return null!==O&&(C[Wi]=O.createEmbeddedView(l)),$b(l,C,t),C}(this._declarationLView,this._declarationTContainer,n,{injector:t,hydrationInfo:r});return new R_(l)}};function XL(){return b0(Vr(),vt())}function b0(e,n){return 4&e.type?new WL(n,e,Oc(e,n)):null}let Bc=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=tk}return e})();function tk(){return vD(Vr(),vt())}const nk=Bc,_D=class extends nk{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Oc(this._hostTNode,this._hostLView)}get injector(){return new ho(this._hostTNode,this._hostLView)}get parentInjector(){const n=sa(this._hostTNode,this._hostLView);if(rf(n)){const t=Zh(n,this._hostLView),r=uo(n);return new ho(t[Jt].data[r+8],t)}return new ho(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=yD(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-zr}createEmbeddedView(n,t,r){let l,f;"number"==typeof r?l=r:null!=r&&(l=r.index,f=r.injector);const C=n.createEmbeddedViewImpl(t||{},f,null);return this.insertImpl(C,l,false),C}createComponent(n,t,r,l,f){const y=n&&!function cf(e){return"function"==typeof e}(n);let C;if(y)C=t;else{const Qe=t||{};C=Qe.index,r=Qe.injector,l=Qe.projectableNodes,f=Qe.environmentInjector||Qe.ngModuleRef}const D=y?n:new L_(ti(n)),O=r||this.parentInjector;if(!f&&null==D.ngModule){const mt=(y?O:this.parentInjector).get(Qo,null);mt&&(f=mt)}ti(D.componentType??{});const ve=D.create(O,l,null,f);return this.insertImpl(ve.hostView,C,false),ve}insert(n,t){return this.insertImpl(n,t,!1)}insertImpl(n,t,r){const l=n._lView;if(function Vh(e){return To(e[h])}(l)){const D=this.indexOf(n);if(-1!==D)this.detach(D);else{const O=l[h],$=new _D(O,O[k],O[h]);$.detach($.indexOf(n))}}const y=this._adjustIndex(t),C=this._lContainer;return qL(C,l,y,!r),n.attachToViewContainerRef(),uf(vw(C),y,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=yD(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=Yp(this._lContainer,t);r&&(Jh(vw(this._lContainer),t),zg(r[Jt],r))}detach(n){const t=this._adjustIndex(n,-1),r=Yp(this._lContainer,t);return r&&null!=Jh(vw(this._lContainer),t)?new R_(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function yD(e){return e[8]}function vw(e){return e[8]||(e[8]=[])}function vD(e,n){let t;const r=n[e.index];return To(r)?t=r:(t=WE(r,n,null,e),n[e.index]=t,o0(n,t)),xD(t,n,e,r),new _D(t,e,n)}let xD=function bD(e,n,t,r){if(e[Jr])return;let l;l=8&t.type?Xn(r):function ik(e,n){const t=e[Oe],r=t.createComment(""),l=Ji(n,e);return eh(t,Kp(t,l),r,function ub(e,n){return e.nextSibling(n)}(t,l),!1),r}(n,t),e[Jr]=l};class xw{constructor(n){this.queryList=n,this.matches=null}clone(){return new xw(this.queryList)}setDirty(){this.queryList.setDirty()}}class bw{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,l=[];for(let f=0;f<r;f++){const y=t.getByIndex(f);l.push(this.queries[y.indexInDeclarationView].clone())}return new bw(l)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==SD(n,t).matches&&this.queries[t].setDirty()}}class wD{constructor(n,t,r=null){this.predicate=n,this.flags=t,this.read=r}}class ww{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const l=null!==t?t.length:0,f=this.getByIndex(r).embeddedTView(n,l);f&&(f.indexInDeclarationView=r,null!==t?t.push(f):t=[f])}return null!==t?new ww(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Ew{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new Ew(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let l=0;l<r.length;l++){const f=r[l];this.matchTNodeWithReadOption(n,t,sk(t,f)),this.matchTNodeWithReadOption(n,t,Sc(t,n,f,!1,!1))}else r===yh?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,Sc(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const l=this.metadata.read;if(null!==l)if(l===ua||l===Bc||l===yh&&4&t.type)this.addMatch(t.index,-2);else{const f=Sc(t,n,l,!1,!1);null!==f&&this.addMatch(t.index,f)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function sk(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function lk(e,n,t,r){return-1===t?function ak(e,n){return 11&e.type?Oc(e,n):4&e.type?b0(e,n):null}(n,e):-2===t?function ck(e,n,t){return t===ua?Oc(n,e):t===yh?b0(n,e):t===Bc?vD(n,e):void 0}(e,n,r):gl(e,e[Jt],t,n)}function ED(e,n,t,r){const l=n[Wi].queries[r];if(null===l.matches){const f=e.data,y=t.matches,C=[];for(let D=0;D<y.length;D+=2){const O=y[D];C.push(O<0?null:lk(n,f[O],y[D+1],t.metadata.read))}l.matches=C}return l.matches}function Cw(e,n,t,r){const l=e.queries.getByIndex(t),f=l.matches;if(null!==f){const y=ED(e,n,l,t);for(let C=0;C<f.length;C+=2){const D=f[C];if(D>0)r.push(y[C/2]);else{const O=f[C+1],$=n[-D];for(let W=zr;W<$.length;W++){const oe=$[W];oe[Fr]===oe[h]&&Cw(oe[Jt],oe,O,r)}if(null!==$[dl]){const W=$[dl];for(let oe=0;oe<W.length;oe++){const ve=W[oe];Cw(ve[Jt],ve,O,r)}}}}}return r}function Tw(e){const n=vt(),t=Qn(),r=Hh();Cc(r+1);const l=SD(t,r);if(e.dirty&&function Hl(e){return 4==(4&e[ft])}(n)===(2==(2&l.metadata.flags))){if(null===l.matches)e.reset([]);else{const f=l.crossesNgTemplate?Cw(t,n,r,[]):ED(t,n,l,r);e.reset(f,vd),e.notifyOnChanges()}return!0}return!1}function CD(e,n,t){const r=Qn();r.firstCreatePass&&(function MD(e,n,t){null===e.queries&&(e.queries=new ww),e.queries.track(new Ew(n,t))}(r,new wD(e,n,t),-1),2==(2&n)&&(r.staticViewQueries=!0)),function DD(e,n,t){const r=new yw(4==(4&t));(function t0(e,n,t,r){const l=YE(n);l.push(t),e.firstCreatePass&&KE(e).push(r,l.length-1)})(e,n,r,r.destroy),null===n[Wi]&&(n[Wi]=new bw),n[Wi].queries.push(new xw(r))}(r,vt(),n)}function SD(e,n){return e.queries.getByIndex(n)}const Rw=new Xt("Application Initializer");let Lw=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=tn(Rw,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const l of this.appInits){const f=l();if(z_(f))t.push(f);else if(AC(f)){const y=new Promise((C,D)=>{f.subscribe({complete:C,error:D})});t.push(y)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(l=>{this.reject(l)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),GD=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const vh=new Xt("LocaleId",{providedIn:"root",factory:()=>tn(vh,$n.Optional|$n.SkipSelf)||function Lk(){return typeof $localize<"u"&&$localize.locale||km}()});let C0=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new mn(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Nk{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let qD=(()=>{class e{compileModuleSync(t){return new pw(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),f=me(Kr(t).declarations).reduce((y,C)=>{const D=ti(C);return D&&y.push(new L_(D)),y},[]);return new Nk(r,f)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const YD=new Xt(""),D0=new Xt("");let zw,Nw=(()=>{class e{constructor(t,r,l){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,zw||(function rO(e){zw=e}(l),l.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{v.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,l){let f=-1;r&&r>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==f),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:f,updateCb:l})}whenStable(t,r,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,l){return[]}static#e=this.\u0275fac=function(r){return new(r||e)(sn(v),sn(Fw),sn(D0))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})(),Fw=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return zw?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),Ed=null;const KD=new Xt("AllowMultipleToken"),Bw=new Xt("PlatformDestroyListeners"),Vw=new Xt("appBootstrapListener");class QD{constructor(n,t){this.name=n,this.token=t}}function tM(e,n,t=[]){const r=`Platform: ${n}`,l=new Xt(r);return(f=[])=>{let y=Uw();if(!y||y.injector.get(KD,!1)){const C=[...t,...f,{provide:l,useValue:!0}];e?e(C):function aO(e){if(Ed&&!Ed.get(KD,!1))throw new Mt(400,!1);(function JD(){!function Et(e){Pe=e}(()=>{throw new Mt(600,!1)})})(),Ed=e;const n=e.get(iM);(function eM(e){e.get(c_,null)?.forEach(t=>t())})(e)}(function nM(e=[],n){return As.create({name:n,providers:[{provide:s_,useValue:"platform"},{provide:Bw,useValue:new Set([()=>Ed=null])},...e]})}(C,r))}return function cO(e){const n=Uw();if(!n)throw new Mt(401,!1);return n}()}}function Uw(){return Ed?.get(iM)??null}let iM=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const l=function uO(e="zone.js",n){return"noop"===e?new j:"zone.js"===e?new v(n):e}(r?.ngZone,function rM(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return l.run(()=>{const f=function EL(e,n,t){return new fw(e,n,t)}(t.moduleType,this.injector,function cM(e){return[{provide:v,useFactory:e},{provide:sh,multi:!0,useFactory:()=>{const n=tn(dO,{optional:!0});return()=>n.initialize()}},{provide:lM,useFactory:hO},{provide:q,useFactory:J}]}(()=>l)),y=f.injector.get(ec,null);return l.runOutsideAngular(()=>{const C=l.onError.subscribe({next:D=>{y.handleError(D)}});f.onDestroy(()=>{M0(this._modules,f),C.unsubscribe()})}),function oM(e,n,t){try{const r=t();return z_(r)?r.catch(l=>{throw n.runOutsideAngular(()=>e.handleError(l)),l}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(y,l,()=>{const C=f.injector.get(Lw);return C.runInitializers(),C.donePromise.then(()=>(function TT(e){Ur(e,"Expected localeId to be defined"),"string"==typeof e&&(CT=e.toLowerCase().replace(/_/g,"-"))}(f.injector.get(vh,km)||km),this._moduleDoBootstrap(f),f))})})}bootstrapModule(t,r=[]){const l=sM({},r);return function oO(e,n,t){const r=new pw(t);return Promise.resolve(r)}(0,0,t).then(f=>this.bootstrapModuleFactory(f,l))}_moduleDoBootstrap(t){const r=t.injector.get(Fm);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(l=>r.bootstrap(l));else{if(!t.instance.ngDoBootstrap)throw new Mt(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Mt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(Bw,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)(sn(As))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function sM(e,n){return Array.isArray(n)?n.reduce(sM,e):{...e,...n}}let Fm=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=tn(lM),this.zoneIsStable=tn(q),this.componentTypes=[],this.components=[],this.isStable=tn(C0).hasPendingTasks.pipe(Gi(t=>t?fn(!1):this.zoneIsStable),function os(e,n=wn){return e=e??qi,hi((t,r)=>{let l,f=!0;t.subscribe(ln(r,y=>{const C=n(y);(f||!e(l,C))&&(f=!1,l=C,r.next(y))}))})}(),or()),this._injector=tn(Qo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const l=t instanceof __;if(!this._injector.get(Lw).done)throw!l&&function ul(e){const n=ti(e)||Tr(e)||lr(e);return null!==n&&n.standalone}(t),new Mt(405,!1);let y;y=l?t:this._injector.get(gm).resolveComponentFactory(t),this.componentTypes.push(y.componentType);const C=function sO(e){return e.isBoundToModule}(y)?void 0:this._injector.get(Xf),O=y.create(As.NULL,[],r||y.selector,C),$=O.location.nativeElement,W=O.injector.get(YD,null);return W?.registerApplication($),O.onDestroy(()=>{this.detachView(O.hostView),M0(this.components,O),W?.unregisterApplication($)}),this._loadComponent(O),O}tick(){if(this._runningTick)throw new Mt(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;M0(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(Vw,[]);r.push(...this._bootstrapListeners),r.forEach(l=>l(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>M0(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Mt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function M0(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}const lM=new Xt("",{providedIn:"root",factory:()=>tn(ec).handleError.bind(void 0)});function hO(){const e=tn(v),n=tn(ec);return t=>e.runOutsideAngular(()=>n.handleError(t))}let dO=(()=>{class e{constructor(){this.zone=tn(v),this.applicationRef=tn(Fm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let S0=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=pO}return e})();function pO(e){return function mO(e,n,t){if(xc(e)&&!t){const r=Br(e.index,n);return new R_(r,r)}return 47&e.type?new R_(n[vn],n):null}(Vr(),vt(),16==(16&e))}class fM{constructor(){}supports(n){return c0(n)}create(n){return new bO(n)}}const xO=(e,n)=>n;class bO{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||xO}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,r=this._removalsHead,l=0,f=null;for(;t||r;){const y=!r||t&&t.currentIndex<mM(r,l,f)?t:r,C=mM(y,l,f),D=y.currentIndex;if(y===r)l--,r=r._nextRemoved;else if(t=t._next,null==y.previousIndex)l++;else{f||(f=[]);const O=C-l,$=D-l;if(O!=$){for(let oe=0;oe<O;oe++){const ve=oe<f.length?f[oe]:f[oe]=0,We=ve+oe;$<=We&&We<O&&(f[oe]=ve+1)}f[y.previousIndex]=$-O}}C!==D&&n(y,C,D)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!c0(n))throw new Mt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l,f,y,t=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let C=0;C<this.length;C++)f=n[C],y=this._trackByFn(C,f),null!==t&&Object.is(t.trackById,y)?(r&&(t=this._verifyReinsertion(t,f,y,C)),Object.is(t.item,f)||this._addIdentityChange(t,f)):(t=this._mismatch(t,f,y,C),r=!0),t=t._next}else l=0,function tP(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let r;for(;!(r=t.next()).done;)n(r.value)}}(n,C=>{y=this._trackByFn(l,C),null!==t&&Object.is(t.trackById,y)?(r&&(t=this._verifyReinsertion(t,C,y,l)),Object.is(t.item,C)||this._addIdentityChange(t,C)):(t=this._mismatch(t,C,y,l),r=!0),t=t._next,l++}),this.length=l;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,r,l){let f;return null===n?f=this._itTail:(f=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,f,l)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,l))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,f,l)):n=this._addAfter(new wO(t,r),f,l),n}_verifyReinsertion(n,t,r,l){let f=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==f?n=this._reinsertAfter(f,n._prev,l):n.currentIndex!=l&&(n.currentIndex=l,this._addToMoves(n,l)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const l=n._prevRemoved,f=n._nextRemoved;return null===l?this._removalsHead=f:l._nextRemoved=f,null===f?this._removalsTail=l:f._prevRemoved=l,this._insertAfter(n,t,r),this._addToMoves(n,r),n}_moveAfter(n,t,r){return this._unlink(n),this._insertAfter(n,t,r),this._addToMoves(n,r),n}_addAfter(n,t,r){return this._insertAfter(n,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,r){const l=null===t?this._itHead:t._next;return n._next=l,n._prev=t,null===l?this._itTail=n:l._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new pM),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,r=n._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pM),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class wO{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class EO{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const t=n._prevDup,r=n._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class pM{constructor(){this.map=new Map}put(n){const t=n.trackById;let r=this.map.get(t);r||(r=new EO,this.map.set(t,r)),r.add(n)}get(n,t){const l=this.map.get(n);return l?l.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function mM(e,n,t){const r=e.previousIndex;if(null===r)return r;let l=0;return t&&r<t.length&&(l=t[r]),r+n+l}class gM{constructor(){}supports(n){return n instanceof Map||Hb(n)}create(){return new CO}}class CO{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let t;for(t=this._mapHead;null!==t;t=t._next)n(t)}forEachPreviousItem(n){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)n(t)}forEachChangedItem(n){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}diff(n){if(n){if(!(n instanceof Map||Hb(n)))throw new Mt(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,l)=>{if(t&&t.key===l)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const f=this._getOrCreateRecordForKey(l,r);t=this._insertBeforeOrAppend(t,f)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,t){if(n){const r=n._prev;return t._next=n,t._prev=r,n._prev=t,r&&(r._next=t),n===this._mapHead&&(this._mapHead=t),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(n,t){if(this._records.has(n)){const l=this._records.get(n);this._maybeAddToChanges(l,t);const f=l._prev,y=l._next;return f&&(f._next=y),y&&(y._prev=f),l._next=null,l._prev=null,l}const r=new TO(n);return this._records.set(n,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,t){Object.is(t,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=t,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,t){n instanceof Map?n.forEach(t):Object.keys(n).forEach(r=>t(n[r],r))}}class TO{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function _M(){return new P0([new fM])}let P0=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:_M});constructor(t){this.factories=t}static create(t,r){if(null!=r){const l=r.factories.slice();t=t.concat(l)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||_M()),deps:[[e,new Np,new Op]]}}find(t){const r=this.factories.find(l=>l.supports(t));if(null!=r)return r;throw new Mt(901,!1)}}return e})();function yM(){return new K_([new gM])}let K_=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:yM});constructor(t){this.factories=t}static create(t,r){if(r){const l=r.factories.slice();t=t.concat(l)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||yM()),deps:[[e,new Np,new Op]]}}find(t){const r=this.factories.find(l=>l.supports(t));if(r)return r;throw new Mt(901,!1)}}return e})();const SO=tM(null,"core",[]);let IO=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Fm))};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();function zm(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let Zw=null;function Cd(){return Zw}class $O{}const Cl=new Xt("DocumentToken");let Ww=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(GO)},providedIn:"platform"})}return e})();const HO=new Xt("Location Initialized");let GO=(()=>{class e extends Ww{constructor(){super(),this._doc=tn(Cl),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Cd().getBaseHref(this._doc)}onPopState(t){const r=Cd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=Cd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,l){this._history.pushState(t,r,l)}replaceState(t,r,l){this._history.replaceState(t,r,l)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function Xw(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function MM(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function xh(e){return e&&"?"!==e[0]?"?"+e:e}let Kf=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(IM)},providedIn:"root"})}return e})();const SM=new Xt("appBaseHref");let IM=(()=>{class e extends Kf{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??tn(Cl).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Xw(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+xh(this._platformLocation.search),l=this._platformLocation.hash;return l&&t?`${r}${l}`:r}pushState(t,r,l,f){const y=this.prepareExternalUrl(l+xh(f));this._platformLocation.pushState(t,r,y)}replaceState(t,r,l,f){const y=this.prepareExternalUrl(l+xh(f));this._platformLocation.replaceState(t,r,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ww),sn(SM,8))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),qO=(()=>{class e extends Kf{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Xw(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,l,f){let y=this.prepareExternalUrl(l+xh(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(t,r,y)}replaceState(t,r,l,f){let y=this.prepareExternalUrl(l+xh(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ww),sn(SM,8))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})(),Yw=(()=>{class e{constructor(t){this._subject=new s,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function XO(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(MM(AM(r))),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+xh(r))}normalize(t){return e.stripTrailingSlash(function WO(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,AM(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",l=null){this._locationStrategy.pushState(l,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+xh(r)),l)}replaceState(t,r="",l=null){this._locationStrategy.replaceState(l,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+xh(r)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(l=>l(t,r))}subscribe(t,r,l){return this._subject.subscribe({next:t,error:r,complete:l})}static#e=this.normalizeQueryParams=xh;static#t=this.joinWithSlash=Xw;static#n=this.stripTrailingSlash=MM;static#i=this.\u0275fac=function(r){return new(r||e)(sn(Kf))};static#r=this.\u0275prov=an({token:e,factory:function(){return function ZO(){return new Yw(sn(Kf))}()},providedIn:"root"})}return e})();function AM(e){return e.replace(/\/index.html$/,"")}var ma=function(e){return e[e.Format=0]="Format",e[e.Standalone=1]="Standalone",e}(ma||{}),Dr=function(e){return e[e.Narrow=0]="Narrow",e[e.Abbreviated=1]="Abbreviated",e[e.Wide=2]="Wide",e[e.Short=3]="Short",e}(Dr||{}),Tl=function(e){return e[e.Short=0]="Short",e[e.Medium=1]="Medium",e[e.Long=2]="Long",e[e.Full=3]="Full",e}(Tl||{}),Eo=function(e){return e[e.Decimal=0]="Decimal",e[e.Group=1]="Group",e[e.List=2]="List",e[e.PercentSign=3]="PercentSign",e[e.PlusSign=4]="PlusSign",e[e.MinusSign=5]="MinusSign",e[e.Exponential=6]="Exponential",e[e.SuperscriptingExponent=7]="SuperscriptingExponent",e[e.PerMille=8]="PerMille",e[e.Infinity=9]="Infinity",e[e.NaN=10]="NaN",e[e.TimeSeparator=11]="TimeSeparator",e[e.CurrencyDecimal=12]="CurrencyDecimal",e[e.CurrencyGroup=13]="CurrencyGroup",e}(Eo||{});function k0(e,n){return ic(fa(e)[Pr.DateFormat],n)}function O0(e,n){return ic(fa(e)[Pr.TimeFormat],n)}function N0(e,n){return ic(fa(e)[Pr.DateTimeFormat],n)}function nc(e,n){const t=fa(e),r=t[Pr.NumberSymbols][n];if(typeof r>"u"){if(n===Eo.CurrencyDecimal)return t[Pr.NumberSymbols][Eo.Decimal];if(n===Eo.CurrencyGroup)return t[Pr.NumberSymbols][Eo.Group]}return r}function RM(e){if(!e[Pr.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[Pr.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function ic(e,n){for(let t=n;t>-1;t--)if(typeof e[t]<"u")return e[t];throw new Error("Locale data API: locale data undefined")}function Jw(e){const[n,t]=e.split(":");return{hours:+n,minutes:+t}}const cN=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,J_={},uN=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var bh=function(e){return e[e.Short=0]="Short",e[e.ShortGMT=1]="ShortGMT",e[e.Long=2]="Long",e[e.Extended=3]="Extended",e}(bh||{}),tr=function(e){return e[e.FullYear=0]="FullYear",e[e.Month=1]="Month",e[e.Date=2]="Date",e[e.Hours=3]="Hours",e[e.Minutes=4]="Minutes",e[e.Seconds=5]="Seconds",e[e.FractionalSeconds=6]="FractionalSeconds",e[e.Day=7]="Day",e}(tr||{}),nr=function(e){return e[e.DayPeriods=0]="DayPeriods",e[e.Days=1]="Days",e[e.Months=2]="Months",e[e.Eras=3]="Eras",e}(nr||{});function hN(e,n,t,r){let l=function xN(e){if(OM(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[l,f=1,y=1]=e.split("-").map(C=>+C);return F0(l,f-1,y)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let r;if(r=e.match(cN))return function bN(e){const n=new Date(0);let t=0,r=0;const l=e[8]?n.setUTCFullYear:n.setFullYear,f=e[8]?n.setUTCHours:n.setHours;e[9]&&(t=Number(e[9]+e[10]),r=Number(e[9]+e[11])),l.call(n,Number(e[1]),Number(e[2])-1,Number(e[3]));const y=Number(e[4]||0)-t,C=Number(e[5]||0)-r,D=Number(e[6]||0),O=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return f.call(n,y,C,D,O),n}(r)}const n=new Date(e);if(!OM(n))throw new Error(`Unable to convert "${e}" into a date`);return n}(e);n=wh(t,n)||n;let C,y=[];for(;n;){if(C=uN.exec(n),!C){y.push(n);break}{y=y.concat(C.slice(1));const $=y.pop();if(!$)break;n=$}}let D=l.getTimezoneOffset();r&&(D=kM(r,D),l=function vN(e,n,t){const r=t?-1:1,l=e.getTimezoneOffset();return function yN(e,n){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+n),e}(e,r*(kM(n,l)-l))}(l,r,!0));let O="";return y.forEach($=>{const W=function _N(e){if(e1[e])return e1[e];let n;switch(e){case"G":case"GG":case"GGG":n=Rr(nr.Eras,Dr.Abbreviated);break;case"GGGG":n=Rr(nr.Eras,Dr.Wide);break;case"GGGGG":n=Rr(nr.Eras,Dr.Narrow);break;case"y":n=So(tr.FullYear,1,0,!1,!0);break;case"yy":n=So(tr.FullYear,2,0,!0,!0);break;case"yyy":n=So(tr.FullYear,3,0,!1,!0);break;case"yyyy":n=So(tr.FullYear,4,0,!1,!0);break;case"Y":n=U0(1);break;case"YY":n=U0(2,!0);break;case"YYY":n=U0(3);break;case"YYYY":n=U0(4);break;case"M":case"L":n=So(tr.Month,1,1);break;case"MM":case"LL":n=So(tr.Month,2,1);break;case"MMM":n=Rr(nr.Months,Dr.Abbreviated);break;case"MMMM":n=Rr(nr.Months,Dr.Wide);break;case"MMMMM":n=Rr(nr.Months,Dr.Narrow);break;case"LLL":n=Rr(nr.Months,Dr.Abbreviated,ma.Standalone);break;case"LLLL":n=Rr(nr.Months,Dr.Wide,ma.Standalone);break;case"LLLLL":n=Rr(nr.Months,Dr.Narrow,ma.Standalone);break;case"w":n=Qw(1);break;case"ww":n=Qw(2);break;case"W":n=Qw(1,!0);break;case"d":n=So(tr.Date,1);break;case"dd":n=So(tr.Date,2);break;case"c":case"cc":n=So(tr.Day,1);break;case"ccc":n=Rr(nr.Days,Dr.Abbreviated,ma.Standalone);break;case"cccc":n=Rr(nr.Days,Dr.Wide,ma.Standalone);break;case"ccccc":n=Rr(nr.Days,Dr.Narrow,ma.Standalone);break;case"cccccc":n=Rr(nr.Days,Dr.Short,ma.Standalone);break;case"E":case"EE":case"EEE":n=Rr(nr.Days,Dr.Abbreviated);break;case"EEEE":n=Rr(nr.Days,Dr.Wide);break;case"EEEEE":n=Rr(nr.Days,Dr.Narrow);break;case"EEEEEE":n=Rr(nr.Days,Dr.Short);break;case"a":case"aa":case"aaa":n=Rr(nr.DayPeriods,Dr.Abbreviated);break;case"aaaa":n=Rr(nr.DayPeriods,Dr.Wide);break;case"aaaaa":n=Rr(nr.DayPeriods,Dr.Narrow);break;case"b":case"bb":case"bbb":n=Rr(nr.DayPeriods,Dr.Abbreviated,ma.Standalone,!0);break;case"bbbb":n=Rr(nr.DayPeriods,Dr.Wide,ma.Standalone,!0);break;case"bbbbb":n=Rr(nr.DayPeriods,Dr.Narrow,ma.Standalone,!0);break;case"B":case"BB":case"BBB":n=Rr(nr.DayPeriods,Dr.Abbreviated,ma.Format,!0);break;case"BBBB":n=Rr(nr.DayPeriods,Dr.Wide,ma.Format,!0);break;case"BBBBB":n=Rr(nr.DayPeriods,Dr.Narrow,ma.Format,!0);break;case"h":n=So(tr.Hours,1,-12);break;case"hh":n=So(tr.Hours,2,-12);break;case"H":n=So(tr.Hours,1);break;case"HH":n=So(tr.Hours,2);break;case"m":n=So(tr.Minutes,1);break;case"mm":n=So(tr.Minutes,2);break;case"s":n=So(tr.Seconds,1);break;case"ss":n=So(tr.Seconds,2);break;case"S":n=So(tr.FractionalSeconds,1);break;case"SS":n=So(tr.FractionalSeconds,2);break;case"SSS":n=So(tr.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=B0(bh.Short);break;case"ZZZZZ":n=B0(bh.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=B0(bh.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=B0(bh.Long);break;default:return null}return e1[e]=n,n}($);O+=W?W(l,t,D):"''"===$?"'":$.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),O}function F0(e,n,t){const r=new Date(0);return r.setFullYear(e,n,t),r.setHours(0,0,0),r}function wh(e,n){const t=function KO(e){return fa(e)[Pr.LocaleId]}(e);if(J_[t]=J_[t]||{},J_[t][n])return J_[t][n];let r="";switch(n){case"shortDate":r=k0(e,Tl.Short);break;case"mediumDate":r=k0(e,Tl.Medium);break;case"longDate":r=k0(e,Tl.Long);break;case"fullDate":r=k0(e,Tl.Full);break;case"shortTime":r=O0(e,Tl.Short);break;case"mediumTime":r=O0(e,Tl.Medium);break;case"longTime":r=O0(e,Tl.Long);break;case"fullTime":r=O0(e,Tl.Full);break;case"short":const l=wh(e,"shortTime"),f=wh(e,"shortDate");r=z0(N0(e,Tl.Short),[l,f]);break;case"medium":const y=wh(e,"mediumTime"),C=wh(e,"mediumDate");r=z0(N0(e,Tl.Medium),[y,C]);break;case"long":const D=wh(e,"longTime"),O=wh(e,"longDate");r=z0(N0(e,Tl.Long),[D,O]);break;case"full":const $=wh(e,"fullTime"),W=wh(e,"fullDate");r=z0(N0(e,Tl.Full),[$,W])}return r&&(J_[t][n]=r),r}function z0(e,n){return n&&(e=e.replace(/\{([^}]+)}/g,function(t,r){return null!=n&&r in n?n[r]:t})),e}function Vc(e,n,t="-",r,l){let f="";(e<0||l&&e<=0)&&(l?e=1-e:(e=-e,f=t));let y=String(e);for(;y.length<n;)y="0"+y;return r&&(y=y.slice(y.length-n)),f+y}function So(e,n,t=0,r=!1,l=!1){return function(f,y){let C=function fN(e,n){switch(e){case tr.FullYear:return n.getFullYear();case tr.Month:return n.getMonth();case tr.Date:return n.getDate();case tr.Hours:return n.getHours();case tr.Minutes:return n.getMinutes();case tr.Seconds:return n.getSeconds();case tr.FractionalSeconds:return n.getMilliseconds();case tr.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,f);if((t>0||C>-t)&&(C+=t),e===tr.Hours)0===C&&-12===t&&(C=12);else if(e===tr.FractionalSeconds)return function dN(e,n){return Vc(e,3).substring(0,n)}(C,n);const D=nc(y,Eo.MinusSign);return Vc(C,n,D,r,l)}}function Rr(e,n,t=ma.Format,r=!1){return function(l,f){return function pN(e,n,t,r,l,f){switch(t){case nr.Months:return function eN(e,n,t){const r=fa(e),f=ic([r[Pr.MonthsFormat],r[Pr.MonthsStandalone]],n);return ic(f,t)}(n,l,r)[e.getMonth()];case nr.Days:return function QO(e,n,t){const r=fa(e),f=ic([r[Pr.DaysFormat],r[Pr.DaysStandalone]],n);return ic(f,t)}(n,l,r)[e.getDay()];case nr.DayPeriods:const y=e.getHours(),C=e.getMinutes();if(f){const O=function rN(e){const n=fa(e);return RM(n),(n[Pr.ExtraData][2]||[]).map(r=>"string"==typeof r?Jw(r):[Jw(r[0]),Jw(r[1])])}(n),$=function oN(e,n,t){const r=fa(e);RM(r);const f=ic([r[Pr.ExtraData][0],r[Pr.ExtraData][1]],n)||[];return ic(f,t)||[]}(n,l,r),W=O.findIndex(oe=>{if(Array.isArray(oe)){const[ve,We]=oe,Qe=y>=ve.hours&&C>=ve.minutes,mt=y<We.hours||y===We.hours&&C<We.minutes;if(ve.hours<We.hours){if(Qe&&mt)return!0}else if(Qe||mt)return!0}else if(oe.hours===y&&oe.minutes===C)return!0;return!1});if(-1!==W)return $[W]}return function JO(e,n,t){const r=fa(e),f=ic([r[Pr.DayPeriodsFormat],r[Pr.DayPeriodsStandalone]],n);return ic(f,t)}(n,l,r)[y<12?0:1];case nr.Eras:return function tN(e,n){return ic(fa(e)[Pr.Eras],n)}(n,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${t}`)}}(l,f,e,n,t,r)}}function B0(e){return function(n,t,r){const l=-1*r,f=nc(t,Eo.MinusSign),y=l>0?Math.floor(l/60):Math.ceil(l/60);switch(e){case bh.Short:return(l>=0?"+":"")+Vc(y,2,f)+Vc(Math.abs(l%60),2,f);case bh.ShortGMT:return"GMT"+(l>=0?"+":"")+Vc(y,1,f);case bh.Long:return"GMT"+(l>=0?"+":"")+Vc(y,2,f)+":"+Vc(Math.abs(l%60),2,f);case bh.Extended:return 0===r?"Z":(l>=0?"+":"")+Vc(y,2,f)+":"+Vc(Math.abs(l%60),2,f);default:throw new Error(`Unknown zone width "${e}"`)}}}const mN=0,V0=4;function LM(e){return F0(e.getFullYear(),e.getMonth(),e.getDate()+(V0-e.getDay()))}function Qw(e,n=!1){return function(t,r){let l;if(n){const f=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,y=t.getDate();l=1+Math.floor((y+f)/7)}else{const f=LM(t),y=function gN(e){const n=F0(e,mN,1).getDay();return F0(e,0,1+(n<=V0?V0:V0+7)-n)}(f.getFullYear()),C=f.getTime()-y.getTime();l=1+Math.round(C/6048e5)}return Vc(l,e,nc(r,Eo.MinusSign))}}function U0(e,n=!1){return function(t,r){return Vc(LM(t).getFullYear(),e,nc(r,Eo.MinusSign),n)}}const e1={};function kM(e,n){e=e.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(t)?n:t}function OM(e){return e instanceof Date&&!isNaN(e.valueOf())}function BM(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[l,f]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(l.trim()===n)return decodeURIComponent(f)}return null}const s1=/\s+/,VM=[];let a1=(()=>{class e{constructor(t,r,l,f){this._iterableDiffers=t,this._keyValueDiffers=r,this._ngEl=l,this._renderer=f,this.initialClasses=VM,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(s1):VM}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(s1):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){const l=this.stateMap.get(t);void 0!==l?(l.enabled!==r&&(l.changed=!0,l.enabled=r),l.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],l=t[1];l.changed?(this._toggleClass(r,l.enabled),l.changed=!1):l.touched||(l.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),l.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split(s1).forEach(l=>{r?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}static#e=this.\u0275fac=function(r){return new(r||e)(et(P0),et(K_),et(ua),et(qa))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class kN{constructor(n,t,r,l){this.$implicit=n,this.ngForOf=t,this.index=r,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Jf=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,l){this._viewContainer=t,this._template=r,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((l,f,y)=>{if(null==l.previousIndex)r.createEmbeddedView(this._template,new kN(l.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)r.remove(null===f?void 0:f);else if(null!==f){const C=r.get(f);r.move(C,y),jM(C,l)}});for(let l=0,f=r.length;l<f;l++){const C=r.get(l).context;C.index=l,C.count=f,C.ngForOf=this._ngForOf}t.forEachIdentityChange(l=>{jM(r.get(l.currentIndex),l)})}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(et(Bc),et(yh),et(P0))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function jM(e,n){e.context.$implicit=n.item}let Eh=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new ON,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){$M("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){$M("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(et(Bc),et(yh))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class ON{constructor(){this.$implicit=null,this.ngIf=null}}function $M(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${sr(n)}'.`)}const WN=new Xt("DATE_PIPE_DEFAULT_TIMEZONE"),XN=new Xt("DATE_PIPE_DEFAULT_OPTIONS");let u1=(()=>{class e{constructor(t,r,l){this.locale=t,this.defaultTimezone=r,this.defaultOptions=l}transform(t,r,l,f){if(null==t||""===t||t!=t)return null;try{return hN(t,r??this.defaultOptions?.dateFormat??"mediumDate",f||this.locale,l??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(y){throw function Uc(e,n){return new Mt(2100,!1)}()}}static#e=this.\u0275fac=function(r){return new(r||e)(et(vh,16),et(WN,24),et(XN,24))};static#t=this.\u0275pipe=br({name:"date",type:e,pure:!0,standalone:!0})}return e})(),oF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();function ZM(e){return"server"===e}let cF=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>new uF(sn(Cl),window)})}return e})();class uF{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function hF(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=r.currentNode;for(;l;){const f=l.shadowRoot;if(f){const y=f.getElementById(n)||f.querySelector(`[name="${n}"]`);if(y)return y}l=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,l=t.top+this.window.pageYOffset,f=this.offset();this.window.scrollTo(r-f[0],l-f[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class WM{}class kF extends $O{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class m1 extends kF{static makeCurrent(){!function jO(e){Zw||(Zw=e)}(new m1)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function OF(){return ty=ty||document.querySelector("base"),ty?ty.getAttribute("href"):null}();return null==t?null:function NF(e){G0=G0||document.createElement("a"),G0.setAttribute("href",e);const n=G0.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){ty=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return BM(document.cookie,n)}}let G0,ty=null,zF=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const g1=new Xt("EventManagerPlugins");let QM=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(l=>{l.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,l){return this._findPluginFor(r).addEventListener(t,r,l)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(f=>f.supports(t)),!r)throw new Mt(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)(sn(g1),sn(v))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();class eS{constructor(n){this._doc=n}}const _1="ng-app-id";let tS=(()=>{class e{constructor(t,r,l,f={}){this.doc=t,this.appId=r,this.nonce=l,this.platformId=f,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=ZM(f),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(l=>l.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${_1}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(l=>{null!=l.textContent&&r.set(l.textContent,l)}),r}return null}changeUsageCount(t,r){const l=this.styleRef;if(l.has(t)){const f=l.get(t);return f.usage+=r,f.usage}return l.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const l=this.styleNodesInDOM,f=l?.get(r);if(f?.parentNode===t)return l.delete(r),f.removeAttribute(_1),f;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=r,this.platformIsServer&&y.setAttribute(_1,this.appId),y}}addStyleToHost(t,r){const l=this.getStyleElement(t,r);t.appendChild(l);const f=this.styleRef,y=f.get(r)?.elements;y?y.push(l):f.set(r,{elements:[l],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl),sn(kf),sn(Of,8),sn(uh))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const y1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},v1=/%COMP%/g,jF=new Xt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function iS(e,n){return n.map(t=>t.replace(v1,e))}let rS=(()=>{class e{constructor(t,r,l,f,y,C,D,O=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=l,this.removeStylesOnCompDestroy=f,this.doc=y,this.platformId=C,this.ngZone=D,this.nonce=O,this.rendererByCompId=new Map,this.platformIsServer=ZM(C),this.defaultRenderer=new x1(t,y,D,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===xr.ShadowDom&&(r={...r,encapsulation:xr.Emulated});const l=this.getOrCreateRenderer(t,r);return l instanceof sS?l.applyToHost(t):l instanceof b1&&l.applyStyles(),l}getOrCreateRenderer(t,r){const l=this.rendererByCompId;let f=l.get(r.id);if(!f){const y=this.doc,C=this.ngZone,D=this.eventManager,O=this.sharedStylesHost,$=this.removeStylesOnCompDestroy,W=this.platformIsServer;switch(r.encapsulation){case xr.Emulated:f=new sS(D,O,r,this.appId,$,y,C,W);break;case xr.ShadowDom:return new qF(D,O,t,r,y,C,this.nonce,W);default:f=new b1(D,O,r,$,y,C,W)}l.set(r.id,f)}return f}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)(sn(QM),sn(tS),sn(kf),sn(jF),sn(Cl),sn(uh),sn(v),sn(Of))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();class x1{constructor(n,t,r,l){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(y1[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(oS(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(oS(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new Mt(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,l){if(l){t=l+":"+t;const f=y1[l];f?n.setAttributeNS(f,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const l=y1[r];l?n.removeAttributeNS(l,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,l){l&(Xl.DashCase|Xl.Important)?n.style.setProperty(t,r,l&Xl.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&Xl.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){n[t]=r}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=Cd().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function oS(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class qF extends x1{constructor(n,t,r,l,f,y,C,D){super(n,f,y,D),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const O=iS(l.id,l.styles);for(const $ of O){const W=document.createElement("style");C&&W.setAttribute("nonce",C),W.textContent=$,this.shadowRoot.appendChild(W)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class b1 extends x1{constructor(n,t,r,l,f,y,C,D){super(n,f,y,C),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=l,this.styles=D?iS(D,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class sS extends b1{constructor(n,t,r,l,f,y,C,D){const O=l+"-"+r.id;super(n,t,r,f,y,C,D,O),this.contentAttr=function $F(e){return"_ngcontent-%COMP%".replace(v1,e)}(O),this.hostAttr=function HF(e){return"_nghost-%COMP%".replace(v1,e)}(O)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let ZF=(()=>{class e extends eS{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,l){return t.addEventListener(r,l,!1),()=>this.removeEventListener(t,r,l)}removeEventListener(t,r,l){return t.removeEventListener(r,l)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const aS=["alt","control","meta","shift"],WF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},XF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let YF=(()=>{class e extends eS{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,l){const f=e.parseEventName(r),y=e.eventCallback(f.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Cd().onAndCancel(t,f.domEventName,y))}static parseEventName(t){const r=t.toLowerCase().split("."),l=r.shift();if(0===r.length||"keydown"!==l&&"keyup"!==l)return null;const f=e._normalizeKey(r.pop());let y="",C=r.indexOf("code");if(C>-1&&(r.splice(C,1),y="code."),aS.forEach(O=>{const $=r.indexOf(O);$>-1&&(r.splice($,1),y+=O+".")}),y+=f,0!=r.length||0===f.length)return null;const D={};return D.domEventName=l,D.fullKey=y,D}static matchEventFullKeyCode(t,r){let l=WF[t.key]||t.key,f="";return r.indexOf("code.")>-1&&(l=t.code,f="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),aS.forEach(y=>{y!==l&&(0,XF[y])(t)&&(f+=y+".")}),f+=l,f===r)}static eventCallback(t,r,l){return f=>{e.matchEventFullKeyCode(f,t)&&l.runGuarded(()=>r(f))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const ez=tM(SO,"browser",[{provide:uh,useValue:"browser"},{provide:c_,useValue:function KF(){m1.makeCurrent()},multi:!0},{provide:Cl,useFactory:function QF(){return function pb(e){Zg=e}(document),document},deps:[]}]),tz=new Xt(""),uS=[{provide:D0,useClass:class FF{addToWindow(n){wi.getAngularTestability=(r,l=!0)=>{const f=n.findTestabilityInTree(r,l);if(null==f)throw new Mt(5103,!1);return f},wi.getAllAngularTestabilities=()=>n.getAllTestabilities(),wi.getAllAngularRootElements=()=>n.getAllRootElements(),wi.frameworkStabilizers||(wi.frameworkStabilizers=[]),wi.frameworkStabilizers.push(r=>{const l=wi.getAllAngularTestabilities();let f=l.length,y=!1;const C=function(D){y=y||D,f--,0==f&&r(y)};l.forEach(D=>{D.whenStable(C)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?Cd().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:YD,useClass:Nw,deps:[v,Fw,D0]},{provide:Nw,useClass:Nw,deps:[v,Fw,D0]}],hS=[{provide:s_,useValue:"root"},{provide:ec,useFactory:function JF(){return new ec},deps:[]},{provide:g1,useClass:ZF,multi:!0,deps:[Cl,v,uh]},{provide:g1,useClass:YF,multi:!0,deps:[Cl]},rS,tS,QM,{provide:_m,useExisting:rS},{provide:WM,useClass:zF,deps:[]},[]];let nz=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:kf,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)(sn(tz,12))};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({providers:[...hS,...uS],imports:[oF,IO]})}return e})(),dS=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl))};static#t=this.\u0275prov=an({token:e,factory:function(r){let l=null;return l=r?new r:function rz(){return new dS(sn(Cl))}(),l},providedIn:"root"})}return e})();typeof window<"u"&&window;const{isArray:uz}=Array,{getPrototypeOf:hz,prototype:dz,keys:fz}=Object;function gS(e){if(1===e.length){const n=e[0];if(uz(n))return{args:n,keys:null};if(function pz(e){return e&&"object"==typeof e&&hz(e)===dz}(n)){const t=fz(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:mz}=Array;function _S(e){return Ln(n=>function gz(e,n){return mz(n)?e(...n):e(n)}(e,n))}function yS(e,n){return e.reduce((t,r,l)=>(t[r]=n[l],t),{})}function E1(...e){const n=_o(e),t=Ca(e),{args:r,keys:l}=gS(e);if(0===r.length)return it([],n);const f=new In(function _z(e,n,t=wn){return r=>{vS(n,()=>{const{length:l}=e,f=new Array(l);let y=l,C=l;for(let D=0;D<l;D++)vS(n,()=>{const O=it(e[D],n);let $=!1;O.subscribe(ln(r,W=>{f[D]=W,$||($=!0,C--),C||r.next(t(f.slice()))},()=>{--y||r.complete()}))},r)},r)}}(r,n,l?y=>yS(l,y):wn));return t?f.pipe(_S(t)):f}function vS(e,n,t){e?Yn(t,e,n):n()}const q0=u(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function C1(...e){return function yz(){return Ea(1)}()(it(e,_o(e)))}function xS(e){return new In(n=>{Ei(e()).subscribe(n)})}function rc(e,n){const t=Te(e)?e:()=>e,r=l=>l.error(t());return new In(n?l=>n.schedule(r,0,l):r)}function T1(){return hi((e,n)=>{let t=null;e._refCount++;const r=ln(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const l=e._connection,f=t;t=null,l&&(!f||l===f)&&l.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class bS extends In{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,ci(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Le;const t=this.getSubject();n.add(this.source.subscribe(ln(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Le.EMPTY)}return n}refCount(){return T1()(this)}}function Vm(e){return e<=0?()=>oo:hi((n,t)=>{let r=0;n.subscribe(ln(t,l=>{++r<=e&&(t.next(l),e<=r&&t.complete())}))})}function Ch(e,n){return hi((t,r)=>{let l=0;t.subscribe(ln(r,f=>e.call(n,f,l++)&&r.next(f)))})}function Z0(e){return hi((n,t)=>{let r=!1;n.subscribe(ln(t,l=>{r=!0,t.next(l)},()=>{r||t.next(e),t.complete()}))})}function wS(e=xz){return hi((n,t)=>{let r=!1;n.subscribe(ln(t,l=>{r=!0,t.next(l)},()=>r?t.complete():t.error(e())))})}function xz(){return new q0}function Qf(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Ch((l,f)=>e(l,f,r)):wn,Vm(1),t?Z0(n):wS(()=>new q0))}function Um(e,n){return Te(n)?vr(e,n,1):vr(e,1)}function es(e,n,t){const r=Te(e)||n||t?{next:e,error:n,complete:t}:e;return r?hi((l,f)=>{var y;null===(y=r.subscribe)||void 0===y||y.call(r);let C=!0;l.subscribe(ln(f,D=>{var O;null===(O=r.next)||void 0===O||O.call(r,D),f.next(D)},()=>{var D;C=!1,null===(D=r.complete)||void 0===D||D.call(r),f.complete()},D=>{var O;C=!1,null===(O=r.error)||void 0===O||O.call(r,D),f.error(D)},()=>{var D,O;C&&(null===(D=r.unsubscribe)||void 0===D||D.call(r)),null===(O=r.finalize)||void 0===O||O.call(r)}))}):wn}function Xa(e){return hi((n,t)=>{let f,r=null,l=!1;r=n.subscribe(ln(t,void 0,void 0,y=>{f=Ei(e(y,Xa(e)(n))),r?(r.unsubscribe(),r=null,f.subscribe(t)):l=!0})),l&&(r.unsubscribe(),r=null,f.subscribe(t))})}function D1(e){return e<=0?()=>oo:hi((n,t)=>{let r=[];n.subscribe(ln(t,l=>{r.push(l),e<r.length&&r.shift()},()=>{for(const l of r)t.next(l);t.complete()},void 0,()=>{r=null}))})}function ny(e){return hi((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const li="primary",iy=Symbol("RouteTitle");class Dz{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function jm(e){return new Dz(e)}function Mz(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const l={};for(let f=0;f<r.length;f++){const y=r[f],C=e[f];if(y.startsWith(":"))l[y.substring(1)]=C;else if(y!==C.path)return null}return{consumed:e.slice(0,r.length),posParams:l}}function Eu(e,n){const t=e?Object.keys(e):void 0,r=n?Object.keys(n):void 0;if(!t||!r||t.length!=r.length)return!1;let l;for(let f=0;f<t.length;f++)if(l=t[f],!ES(e[l],n[l]))return!1;return!0}function ES(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((l,f)=>r[f]===l)}return e===n}function CS(e){return e.length>0?e[e.length-1]:null}function Dd(e){return function cz(e){return!!e&&(e instanceof In||Te(e.lift)&&Te(e.subscribe))}(e)?e:z_(e)?it(Promise.resolve(e)):fn(e)}const Iz={exact:function MS(e,n,t){if(!ep(e.segments,n.segments)||!W0(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!MS(e.children[r],n.children[r],t))return!1;return!0},subset:SS},TS={exact:function Az(e,n){return Eu(e,n)},subset:function Pz(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>ES(e[t],n[t]))},ignored:()=>!0};function DS(e,n,t){return Iz[t.paths](e.root,n.root,t.matrixParams)&&TS[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function SS(e,n,t){return IS(e,n,n.segments,t)}function IS(e,n,t,r){if(e.segments.length>t.length){const l=e.segments.slice(0,t.length);return!(!ep(l,t)||n.hasChildren()||!W0(l,t,r))}if(e.segments.length===t.length){if(!ep(e.segments,t)||!W0(e.segments,t,r))return!1;for(const l in n.children)if(!e.children[l]||!SS(e.children[l],n.children[l],r))return!1;return!0}{const l=t.slice(0,e.segments.length),f=t.slice(e.segments.length);return!!(ep(e.segments,l)&&W0(e.segments,l,r)&&e.children[li])&&IS(e.children[li],n,f,r)}}function W0(e,n,t){return n.every((r,l)=>TS[t](e[l].parameters,r.parameters))}class $m{constructor(n=new yr([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=jm(this.queryParams)),this._queryParamMap}toString(){return kz.serialize(this)}}class yr{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return X0(this)}}class ry{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=jm(this.parameters)),this._parameterMap}toString(){return RS(this)}}function ep(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let oy=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return new M1},providedIn:"root"})}return e})();class M1{parse(n){const t=new Gz(n);return new $m(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${sy(n.root,!0)}`,r=function Fz(e){const n=Object.keys(e).map(t=>{const r=e[t];return Array.isArray(r)?r.map(l=>`${Y0(t)}=${Y0(l)}`).join("&"):`${Y0(t)}=${Y0(r)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function Oz(e){return encodeURI(e)}(n.fragment)}`:""}`}}const kz=new M1;function X0(e){return e.segments.map(n=>RS(n)).join("/")}function sy(e,n){if(!e.hasChildren())return X0(e);if(n){const t=e.children[li]?sy(e.children[li],!1):"",r=[];return Object.entries(e.children).forEach(([l,f])=>{l!==li&&r.push(`${l}:${sy(f,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function Lz(e,n){let t=[];return Object.entries(e.children).forEach(([r,l])=>{r===li&&(t=t.concat(n(l,r)))}),Object.entries(e.children).forEach(([r,l])=>{r!==li&&(t=t.concat(n(l,r)))}),t}(e,(r,l)=>l===li?[sy(e.children[li],!1)]:[`${l}:${sy(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[li]?`${X0(e)}/${t[0]}`:`${X0(e)}/(${t.join("//")})`}}function AS(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Y0(e){return AS(e).replace(/%3B/gi,";")}function S1(e){return AS(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function K0(e){return decodeURIComponent(e)}function PS(e){return K0(e.replace(/\+/g,"%20"))}function RS(e){return`${S1(e.path)}${function Nz(e){return Object.keys(e).map(n=>`;${S1(n)}=${S1(e[n])}`).join("")}(e.parameters)}`}const zz=/^[^\/()?;#]+/;function I1(e){const n=e.match(zz);return n?n[0]:""}const Bz=/^[^\/()?;=#]+/,Uz=/^[^=?&#]+/,$z=/^[^&#]+/;class Gz{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new yr([],{}):new yr([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[li]=new yr(n,t)),r}parseSegment(){const n=I1(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Mt(4009,!1);return this.capture(n),new ry(K0(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function Vz(e){const n=e.match(Bz);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const l=I1(this.remaining);l&&(r=l,this.capture(r))}n[K0(t)]=K0(r)}parseQueryParam(n){const t=function jz(e){const n=e.match(Uz);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const y=function Hz(e){const n=e.match($z);return n?n[0]:""}(this.remaining);y&&(r=y,this.capture(r))}const l=PS(t),f=PS(r);if(n.hasOwnProperty(l)){let y=n[l];Array.isArray(y)||(y=[y],n[l]=y),y.push(f)}else n[l]=f}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=I1(this.remaining),l=this.remaining[r.length];if("/"!==l&&")"!==l&&";"!==l)throw new Mt(4010,!1);let f;r.indexOf(":")>-1?(f=r.slice(0,r.indexOf(":")),this.capture(f),this.capture(":")):n&&(f=li);const y=this.parseChildren();t[f]=1===Object.keys(y).length?y[li]:new yr([],y),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Mt(4011,!1)}}function LS(e){return e.segments.length>0?new yr([],{[li]:e}):e}function kS(e){const n={};for(const r of Object.keys(e.children)){const f=kS(e.children[r]);if(r===li&&0===f.segments.length&&f.hasChildren())for(const[y,C]of Object.entries(f.children))n[y]=C;else(f.segments.length>0||f.hasChildren())&&(n[r]=f)}return function qz(e){if(1===e.numberOfChildren&&e.children[li]){const n=e.children[li];return new yr(e.segments.concat(n.segments),n.children)}return e}(new yr(e.segments,n))}function tp(e){return e instanceof $m}function OS(e){let n;const l=LS(function t(f){const y={};for(const D of f.children){const O=t(D);y[D.outlet]=O}const C=new yr(f.url,y);return f===e&&(n=C),C}(e.root));return n??l}function NS(e,n,t,r){let l=e;for(;l.parent;)l=l.parent;if(0===n.length)return A1(l,l,l,t,r);const f=function Wz(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new zS(!0,0,e);let n=0,t=!1;const r=e.reduce((l,f,y)=>{if("object"==typeof f&&null!=f){if(f.outlets){const C={};return Object.entries(f.outlets).forEach(([D,O])=>{C[D]="string"==typeof O?O.split("/"):O}),[...l,{outlets:C}]}if(f.segmentPath)return[...l,f.segmentPath]}return"string"!=typeof f?[...l,f]:0===y?(f.split("/").forEach((C,D)=>{0==D&&"."===C||(0==D&&""===C?t=!0:".."===C?n++:""!=C&&l.push(C))}),l):[...l,f]},[]);return new zS(t,n,r)}(n);if(f.toRoot())return A1(l,l,new yr([],{}),t,r);const y=function Xz(e,n,t){if(e.isAbsolute)return new Q0(n,!0,0);if(!t)return new Q0(n,!1,NaN);if(null===t.parent)return new Q0(t,!0,0);const r=J0(e.commands[0])?0:1;return function Yz(e,n,t){let r=e,l=n,f=t;for(;f>l;){if(f-=l,r=r.parent,!r)throw new Mt(4005,!1);l=r.segments.length}return new Q0(r,!1,l-f)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(f,l,e),C=y.processChildren?ly(y.segmentGroup,y.index,f.commands):BS(y.segmentGroup,y.index,f.commands);return A1(l,y.segmentGroup,C,t,r)}function J0(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function ay(e){return"object"==typeof e&&null!=e&&e.outlets}function A1(e,n,t,r,l){let y,f={};r&&Object.entries(r).forEach(([D,O])=>{f[D]=Array.isArray(O)?O.map($=>`${$}`):`${O}`}),y=e===n?t:FS(e,n,t);const C=LS(kS(y));return new $m(C,f,l)}function FS(e,n,t){const r={};return Object.entries(e.children).forEach(([l,f])=>{r[l]=f===n?t:FS(f,n,t)}),new yr(e.segments,r)}class zS{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&J0(r[0]))throw new Mt(4003,!1);const l=r.find(ay);if(l&&l!==CS(r))throw new Mt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Q0{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function BS(e,n,t){if(e||(e=new yr([],{})),0===e.segments.length&&e.hasChildren())return ly(e,n,t);const r=function Jz(e,n,t){let r=0,l=n;const f={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(r>=t.length)return f;const y=e.segments[l],C=t[r];if(ay(C))break;const D=`${C}`,O=r<t.length-1?t[r+1]:null;if(l>0&&void 0===D)break;if(D&&O&&"object"==typeof O&&void 0===O.outlets){if(!US(D,O,y))return f;r+=2}else{if(!US(D,{},y))return f;r++}l++}return{match:!0,pathIndex:l,commandIndex:r}}(e,n,t),l=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const f=new yr(e.segments.slice(0,r.pathIndex),{});return f.children[li]=new yr(e.segments.slice(r.pathIndex),e.children),ly(f,0,l)}return r.match&&0===l.length?new yr(e.segments,{}):r.match&&!e.hasChildren()?P1(e,n,t):r.match?ly(e,0,l):P1(e,n,t)}function ly(e,n,t){if(0===t.length)return new yr(e.segments,{});{const r=function Kz(e){return ay(e[0])?e[0].outlets:{[li]:e}}(t),l={};if(Object.keys(r).some(f=>f!==li)&&e.children[li]&&1===e.numberOfChildren&&0===e.children[li].segments.length){const f=ly(e.children[li],n,t);return new yr(e.segments,f.children)}return Object.entries(r).forEach(([f,y])=>{"string"==typeof y&&(y=[y]),null!==y&&(l[f]=BS(e.children[f],n,y))}),Object.entries(e.children).forEach(([f,y])=>{void 0===r[f]&&(l[f]=y)}),new yr(e.segments,l)}}function P1(e,n,t){const r=e.segments.slice(0,n);let l=0;for(;l<t.length;){const f=t[l];if(ay(f)){const D=Qz(f.outlets);return new yr(r,D)}if(0===l&&J0(t[0])){r.push(new ry(e.segments[n].path,VS(t[0]))),l++;continue}const y=ay(f)?f.outlets[li]:`${f}`,C=l<t.length-1?t[l+1]:null;y&&C&&J0(C)?(r.push(new ry(y,VS(C))),l+=2):(r.push(new ry(y,{})),l++)}return new yr(r,{})}function Qz(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=P1(new yr([],{}),0,r))}),n}function VS(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function US(e,n,t){return e==t.path&&Eu(n,t.parameters)}const cy="imperative";class Cu{constructor(n,t){this.id=n,this.url=t}}class ex extends Cu{constructor(n,t,r="imperative",l=null){super(n,t),this.type=0,this.navigationTrigger=r,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Md extends Cu{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class uy extends Cu{constructor(n,t,r,l){super(n,t),this.reason=r,this.code=l,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Hm extends Cu{constructor(n,t,r,l){super(n,t),this.reason=r,this.code=l,this.type=16}}class tx extends Cu{constructor(n,t,r,l){super(n,t),this.error=r,this.target=l,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class jS extends Cu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class eB extends Cu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class tB extends Cu{constructor(n,t,r,l,f){super(n,t),this.urlAfterRedirects=r,this.state=l,this.shouldActivate=f,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class nB extends Cu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iB extends Cu{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rB{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class oB{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class sB{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class aB{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class lB{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cB{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $S{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class R1{}class L1{constructor(n){this.url=n}}class uB{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new hy,this.attachRef=null}}let hy=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const l=this.getOrCreateContext(t);l.outlet=r,this.contexts.set(t,l)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new uB,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class HS{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=k1(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=k1(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=O1(n,this._root);return t.length<2?[]:t[t.length-2].children.map(l=>l.value).filter(l=>l!==n)}pathFromRoot(n){return O1(n,this._root).map(t=>t.value)}}function k1(e,n){if(e===n.value)return n;for(const t of n.children){const r=k1(e,t);if(r)return r}return null}function O1(e,n){if(e===n.value)return[n];for(const t of n.children){const r=O1(e,t);if(r.length)return r.unshift(n),r}return[]}class Th{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Gm(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class GS extends HS{constructor(n,t){super(n),this.snapshot=t,N1(this,n)}toString(){return this.snapshot.toString()}}function qS(e,n){const t=function hB(e,n){const y=new nx([],{},{},"",{},li,n,null,{});return new WS("",new Th(y,[]))}(0,n),r=new mn([new ry("",{})]),l=new mn({}),f=new mn({}),y=new mn({}),C=new mn(""),D=new Sd(r,l,y,C,f,li,n,t.root);return D.snapshot=t.root,new GS(new Th(D,[]),t)}class Sd{constructor(n,t,r,l,f,y,C,D){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=l,this.dataSubject=f,this.outlet=y,this.component=C,this._futureSnapshot=D,this.title=this.dataSubject?.pipe(Ln(O=>O[iy]))??fn(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=l,this.data=f}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Ln(n=>jm(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Ln(n=>jm(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ZS(e,n="emptyOnly"){const t=e.pathFromRoot;let r=0;if("always"!==n)for(r=t.length-1;r>=1;){const l=t[r],f=t[r-1];if(l.routeConfig&&""===l.routeConfig.path)r--;else{if(f.component)break;r--}}return function dB(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class nx{get title(){return this.data?.[iy]}constructor(n,t,r,l,f,y,C,D,O){this.url=n,this.params=t,this.queryParams=r,this.fragment=l,this.data=f,this.outlet=y,this.component=C,this.routeConfig=D,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=jm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=jm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class WS extends HS{constructor(n,t){super(t),this.url=n,N1(this,t)}toString(){return XS(this._root)}}function N1(e,n){n.value._routerState=e,n.children.forEach(t=>N1(e,t))}function XS(e){const n=e.children.length>0?` { ${e.children.map(XS).join(", ")} } `:"";return`${e.value}${n}`}function F1(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Eu(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Eu(n.params,t.params)||e.paramsSubject.next(t.params),function Sz(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Eu(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Eu(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function z1(e,n){const t=Eu(e.params,n.params)&&function Rz(e,n){return ep(e,n)&&e.every((t,r)=>Eu(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||z1(e.parent,n.parent))}let B1=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=li,this.activateEvents=new s,this.deactivateEvents=new s,this.attachEvents=new s,this.detachEvents=new s,this.parentContexts=tn(hy),this.location=tn(Bc),this.changeDetector=tn(S0),this.environmentInjector=tn(Qo),this.inputBinder=tn(ix,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:l}=t.name;if(r)return;this.isTrackedInParentContexts(l)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(l)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Mt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Mt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Mt(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Mt(4013,!1);this._activatedRoute=t;const l=this.location,y=t.snapshot.component,C=this.parentContexts.getOrCreateContext(this.name).children,D=new fB(t,C,l.injector);this.activated=l.createComponent(y,{index:l.length,injector:D,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Pn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Kt]})}return e})();class fB{constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===Sd?this.route:n===hy?this.childContexts:this.parent.get(n,t)}}const ix=new Xt("");let YS=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,l=E1([r.queryParams,r.params,r.data]).pipe(Gi(([f,y,C],D)=>(C={...f,...y,...C},0===D?fn(C):Promise.resolve(C)))).subscribe(f=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const y=function UO(e){const n=ti(e);if(!n)return null;const t=new L_(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(y)for(const{templateName:C}of y.inputs)t.activatedComponentRef.setInput(C,f[C]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,l)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function dy(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const l=function mB(e,n,t){return n.children.map(r=>{for(const l of t.children)if(e.shouldReuseRoute(r.value,l.value.snapshot))return dy(e,r,l);return dy(e,r)})}(e,n,t);return new Th(r,l)}{if(e.shouldAttach(n.value)){const f=e.retrieve(n.value);if(null!==f){const y=f.route;return y.value._futureSnapshot=n.value,y.children=n.children.map(C=>dy(e,C)),y}}const r=function gB(e){return new Sd(new mn(e.url),new mn(e.params),new mn(e.queryParams),new mn(e.fragment),new mn(e.data),e.outlet,e.component,e)}(n.value),l=n.children.map(f=>dy(e,f));return new Th(r,l)}}const V1="ngNavigationCancelingError";function KS(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=tp(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,l=JS(!1,0,n);return l.url=t,l.navigationBehaviorOptions=r,l}function JS(e,n,t){const r=new Error("NavigationCancelingError: "+(e||""));return r[V1]=!0,r.cancellationCode=n,t&&(r.url=t),r}function QS(e){return e&&e[V1]}let eI=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=pr({type:e,selectors:[["ng-component"]],standalone:!0,features:[JT],decls:1,vars:0,template:function(r,l){1&r&&wo(0,"router-outlet")},dependencies:[B1],encapsulation:2})}return e})();function U1(e){const n=e.children&&e.children.map(U1),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==li&&(t.component=eI),t}function jc(e){return e.outlet||li}function fy(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class CB{constructor(n,t,r,l,f){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=l,this.inputBindingEnabled=f}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),F1(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const l=Gm(t);n.children.forEach(f=>{const y=f.value.outlet;this.deactivateRoutes(f,l[y],r),delete l[y]}),Object.values(l).forEach(f=>{this.deactivateRouteAndItsChildren(f,r)})}deactivateRoutes(n,t,r){const l=n.value,f=t?t.value:null;if(l===f)if(l.component){const y=r.getContext(l.outlet);y&&this.deactivateChildRoutes(n,t,y.children)}else this.deactivateChildRoutes(n,t,r);else f&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),l=r&&n.value.component?r.children:t,f=Gm(n);for(const y of Object.keys(f))this.deactivateRouteAndItsChildren(f[y],l);if(r&&r.outlet){const y=r.outlet.detach(),C=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:y,route:n,contexts:C})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),l=r&&n.value.component?r.children:t,f=Gm(n);for(const y of Object.keys(f))this.deactivateRouteAndItsChildren(f[y],l);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const l=Gm(t);n.children.forEach(f=>{this.activateRoutes(f,l[f.value.outlet],r),this.forwardEvent(new cB(f.value.snapshot))}),n.children.length&&this.forwardEvent(new aB(n.value.snapshot))}activateRoutes(n,t,r){const l=n.value,f=t?t.value:null;if(F1(l),l===f)if(l.component){const y=r.getOrCreateContext(l.outlet);this.activateChildRoutes(n,t,y.children)}else this.activateChildRoutes(n,t,r);else if(l.component){const y=r.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const C=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(C.contexts),y.attachRef=C.componentRef,y.route=C.route.value,y.outlet&&y.outlet.attach(C.componentRef,C.route.value),F1(C.route.value),this.activateChildRoutes(n,null,y.children)}else{const C=fy(l.snapshot);y.attachRef=null,y.route=l,y.injector=C,y.outlet&&y.outlet.activateWith(l,y.injector),this.activateChildRoutes(n,null,y.children)}}else this.activateChildRoutes(n,null,r)}}class tI{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class rx{constructor(n,t){this.component=n,this.route=t}}function TB(e,n,t){const r=e._root;return py(r,n?n._root:null,t,[r.value])}function qm(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function Pl(e){return null!==Hs(e)}(e)?n.get(e):e:r}function py(e,n,t,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const f=Gm(n);return e.children.forEach(y=>{(function MB(e,n,t,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const f=e.value,y=n?n.value:null,C=t?t.getContext(e.value.outlet):null;if(y&&f.routeConfig===y.routeConfig){const D=function SB(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!ep(e.url,n.url);case"pathParamsOrQueryParamsChange":return!ep(e.url,n.url)||!Eu(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!z1(e,n)||!Eu(e.queryParams,n.queryParams);default:return!z1(e,n)}}(y,f,f.routeConfig.runGuardsAndResolvers);D?l.canActivateChecks.push(new tI(r)):(f.data=y.data,f._resolvedData=y._resolvedData),py(e,n,f.component?C?C.children:null:t,r,l),D&&C&&C.outlet&&C.outlet.isActivated&&l.canDeactivateChecks.push(new rx(C.outlet.component,y))}else y&&my(n,C,l),l.canActivateChecks.push(new tI(r)),py(e,null,f.component?C?C.children:null:t,r,l)})(y,f[y.value.outlet],t,r.concat([y.value]),l),delete f[y.value.outlet]}),Object.entries(f).forEach(([y,C])=>my(C,t.getContext(y),l)),l}function my(e,n,t){const r=Gm(e),l=e.value;Object.entries(r).forEach(([f,y])=>{my(y,l.component?n?n.children.getContext(f):null:n,t)}),t.canDeactivateChecks.push(new rx(l.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,l))}function gy(e){return"function"==typeof e}function nI(e){return e instanceof q0||"EmptyError"===e?.name}const ox=Symbol("INITIAL_VALUE");function Zm(){return Gi(e=>E1(e.map(n=>n.pipe(Vm(1),function vz(...e){const n=_o(e);return hi((t,r)=>{(n?C1(e,t,n):C1(e,t)).subscribe(r)})}(ox)))).pipe(Ln(n=>{for(const t of n)if(!0!==t){if(t===ox)return ox;if(!1===t||t instanceof $m)return t}return!0}),Ch(n=>n!==ox),Vm(1)))}function iI(e){return function ir(...e){return dn(e)}(es(n=>{if(tp(n))throw KS(0,n)}),Ln(n=>!0===n))}class sx{constructor(n){this.segmentGroup=n||null}}class rI{constructor(n){this.urlTree=n}}function Wm(e){return rc(new sx(e))}function oI(e){return rc(new rI(e))}class WB{constructor(n,t){this.urlSerializer=n,this.urlTree=t}noMatchError(n){return new Mt(4002,!1)}lineralizeSegments(n,t){let r=[],l=t.root;for(;;){if(r=r.concat(l.segments),0===l.numberOfChildren)return fn(r);if(l.numberOfChildren>1||!l.children[li])return rc(new Mt(4e3,!1));l=l.children[li]}}applyRedirectCommands(n,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r)}applyRedirectCreateUrlTree(n,t,r,l){const f=this.createSegmentGroup(n,t.root,r,l);return new $m(f,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([l,f])=>{if("string"==typeof f&&f.startsWith(":")){const C=f.substring(1);r[l]=t[C]}else r[l]=f}),r}createSegmentGroup(n,t,r,l){const f=this.createSegments(n,t.segments,r,l);let y={};return Object.entries(t.children).forEach(([C,D])=>{y[C]=this.createSegmentGroup(n,D,r,l)}),new yr(f,y)}createSegments(n,t,r,l){return t.map(f=>f.path.startsWith(":")?this.findPosParam(n,f,l):this.findOrReturn(f,r))}findPosParam(n,t,r){const l=r[t.path.substring(1)];if(!l)throw new Mt(4001,!1);return l}findOrReturn(n,t){let r=0;for(const l of t){if(l.path===n.path)return t.splice(r),l;r++}return n}}const j1={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function XB(e,n,t,r,l){const f=$1(e,n,t);return f.matched?(r=function yB(e,n){return e.providers&&!e._injector&&(e._injector=mw(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function GB(e,n,t,r){const l=n.canMatch;return l&&0!==l.length?fn(l.map(y=>{const C=qm(y,e);return Dd(function kB(e){return e&&gy(e.canMatch)}(C)?C.canMatch(n,t):e.runInContext(()=>C(n,t)))})).pipe(Zm(),iI()):fn(!0)}(r,n,t).pipe(Ln(y=>!0===y?f:{...j1}))):fn(f)}function $1(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...j1}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const l=(n.matcher||Mz)(t,e,n);if(!l)return{...j1};const f={};Object.entries(l.posParams??{}).forEach(([C,D])=>{f[C]=D.path});const y=l.consumed.length>0?{...f,...l.consumed[l.consumed.length-1].parameters}:f;return{matched:!0,consumedSegments:l.consumed,remainingSegments:t.slice(l.consumed.length),parameters:y,positionalParamSegments:l.posParams??{}}}function sI(e,n,t,r){return t.length>0&&function JB(e,n,t){return t.some(r=>ax(e,n,r)&&jc(r)!==li)}(e,t,r)?{segmentGroup:new yr(n,KB(r,new yr(t,e.children))),slicedSegments:[]}:0===t.length&&function QB(e,n,t){return t.some(r=>ax(e,n,r))}(e,t,r)?{segmentGroup:new yr(e.segments,YB(e,0,t,r,e.children)),slicedSegments:t}:{segmentGroup:new yr(e.segments,e.children),slicedSegments:t}}function YB(e,n,t,r,l){const f={};for(const y of r)if(ax(e,t,y)&&!l[jc(y)]){const C=new yr([],{});f[jc(y)]=C}return{...l,...f}}function KB(e,n){const t={};t[li]=n;for(const r of e)if(""===r.path&&jc(r)!==li){const l=new yr([],{});t[jc(r)]=l}return t}function ax(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class i3{constructor(n,t,r,l,f,y,C){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=l,this.urlTree=f,this.paramsInheritanceStrategy=y,this.urlSerializer=C,this.allowRedirects=!0,this.applyRedirects=new WB(this.urlSerializer,this.urlTree)}noMatchError(n){return new Mt(4002,!1)}recognize(){const n=sI(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,li).pipe(Xa(t=>{if(t instanceof rI)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof sx?this.noMatchError(t):t}),Ln(t=>{const r=new nx([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},li,this.rootComponentType,null,{}),l=new Th(r,t),f=new WS("",l),y=function Zz(e,n,t=null,r=null){return NS(OS(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,f.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(f._root),{state:f,tree:y}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,li).pipe(Xa(r=>{throw r instanceof sx?this.noMatchError(r):r}))}inheritParamsAndData(n){const t=n.value,r=ZS(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),n.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(n,t,r,l){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r):this.processSegment(n,t,r,r.segments,l,!0)}processChildren(n,t,r){const l=[];for(const f of Object.keys(r.children))"primary"===f?l.unshift(f):l.push(f);return it(l).pipe(Um(f=>{const y=r.children[f],C=function wB(e,n){const t=e.filter(r=>jc(r)===n);return t.push(...e.filter(r=>jc(r)!==n)),t}(t,f);return this.processSegmentGroup(n,C,y,f)}),function wz(e,n){return hi(function bz(e,n,t,r,l){return(f,y)=>{let C=t,D=n,O=0;f.subscribe(ln(y,$=>{const W=O++;D=C?e(D,$,W):(C=!0,$),r&&y.next(D)},l&&(()=>{C&&y.next(D),y.complete()})))}}(e,n,arguments.length>=2,!0))}((f,y)=>(f.push(...y),f)),Z0(null),function Ez(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Ch((l,f)=>e(l,f,r)):wn,D1(1),t?Z0(n):wS(()=>new q0))}(),vr(f=>{if(null===f)return Wm(r);const y=aI(f);return function r3(e){e.sort((n,t)=>n.value.outlet===li?-1:t.value.outlet===li?1:n.value.outlet.localeCompare(t.value.outlet))}(y),fn(y)}))}processSegment(n,t,r,l,f,y){return it(t).pipe(Um(C=>this.processSegmentAgainstRoute(C._injector??n,t,C,r,l,f,y).pipe(Xa(D=>{if(D instanceof sx)return fn(null);throw D}))),Qf(C=>!!C),Xa(C=>{if(nI(C))return function t3(e,n,t){return 0===n.length&&!e.children[t]}(r,l,f)?fn([]):Wm(r);throw C}))}processSegmentAgainstRoute(n,t,r,l,f,y,C){return function e3(e,n,t,r){return!!(jc(e)===r||r!==li&&ax(n,t,e))&&("**"===e.path||$1(n,e,t).matched)}(r,l,f,y)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,l,r,f,y,C):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,l,t,r,f,y):Wm(l):Wm(l)}expandSegmentAgainstRouteUsingRedirect(n,t,r,l,f,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,l,f,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,r,l){const f=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?oI(f):this.applyRedirects.lineralizeSegments(r,f).pipe(vr(y=>{const C=new yr(y,{});return this.processSegment(n,t,C,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,l,f,y){const{matched:C,consumedSegments:D,remainingSegments:O,positionalParamSegments:$}=$1(t,l,f);if(!C)return Wm(t);const W=this.applyRedirects.applyRedirectCommands(D,l.redirectTo,$);return l.redirectTo.startsWith("/")?oI(W):this.applyRedirects.lineralizeSegments(l,W).pipe(vr(oe=>this.processSegment(n,r,t,oe.concat(O),y,!1)))}matchSegmentAgainstRoute(n,t,r,l,f,y){let C;if("**"===r.path){const D=l.length>0?CS(l).parameters:{};C=fn({snapshot:new nx(l,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,lI(r),jc(r),r.component??r._loadedComponent??null,r,cI(r)),consumedSegments:[],remainingSegments:[]}),t.children={}}else C=XB(t,r,l,n).pipe(Ln(({matched:D,consumedSegments:O,remainingSegments:$,parameters:W})=>D?{snapshot:new nx(O,W,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,lI(r),jc(r),r.component??r._loadedComponent??null,r,cI(r)),consumedSegments:O,remainingSegments:$}:null));return C.pipe(Gi(D=>null===D?Wm(t):this.getChildConfig(n=r._injector??n,r,l).pipe(Gi(({routes:O})=>{const $=r._loadedInjector??n,{snapshot:W,consumedSegments:oe,remainingSegments:ve}=D,{segmentGroup:We,slicedSegments:Qe}=sI(t,oe,ve,O);if(0===Qe.length&&We.hasChildren())return this.processChildren($,O,We).pipe(Ln(Vt=>null===Vt?null:[new Th(W,Vt)]));if(0===O.length&&0===Qe.length)return fn([new Th(W,[])]);const mt=jc(r)===f;return this.processSegment($,O,We,Qe,mt?li:f,!0).pipe(Ln(Vt=>[new Th(W,Vt)]))}))))}getChildConfig(n,t,r){return t.children?fn({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?fn({routes:t._loadedRoutes,injector:t._loadedInjector}):function HB(e,n,t,r){const l=n.canLoad;return void 0===l||0===l.length?fn(!0):fn(l.map(y=>{const C=qm(y,e);return Dd(function AB(e){return e&&gy(e.canLoad)}(C)?C.canLoad(n,t):e.runInContext(()=>C(n,t)))})).pipe(Zm(),iI())}(n,t,r).pipe(vr(l=>l?this.configLoader.loadChildren(n,t).pipe(es(f=>{t._loadedRoutes=f.routes,t._loadedInjector=f.injector})):function ZB(e){return rc(JS(!1,3))}())):fn({routes:[],injector:n})}}function o3(e){const n=e.value.routeConfig;return n&&""===n.path}function aI(e){const n=[],t=new Set;for(const r of e){if(!o3(r)){n.push(r);continue}const l=n.find(f=>r.value.routeConfig===f.value.routeConfig);void 0!==l?(l.children.push(...r.children),t.add(l)):n.push(r)}for(const r of t){const l=aI(r.children);n.push(new Th(r.value,l))}return n.filter(r=>!t.has(r))}function lI(e){return e.data||{}}function cI(e){return e.resolve||{}}function uI(e){return"string"==typeof e.title||null===e.title}function H1(e){return Gi(n=>{const t=e(n);return t?it(t).pipe(Ln(()=>n)):fn(n)})}const Xm=new Xt("ROUTES");let G1=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=tn(qD)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return fn(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=Dd(t.loadComponent()).pipe(Ln(hI),es(f=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=f}),ny(()=>{this.componentLoaders.delete(t)})),l=new bS(r,()=>new Dn).pipe(T1());return this.componentLoaders.set(t,l),l}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return fn({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const f=function d3(e,n,t,r){return Dd(e.loadChildren()).pipe(Ln(hI),vr(l=>l instanceof YT||Array.isArray(l)?fn(l):it(n.compileModuleAsync(l))),Ln(l=>{r&&r(e);let f,y,C=!1;return Array.isArray(l)?(y=l,!0):(f=l.create(t).injector,y=f.get(Xm,[],{optional:!0,self:!0}).flat()),{routes:y.map(U1),injector:f}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(ny(()=>{this.childrenLoaders.delete(r)})),y=new bS(f,()=>new Dn).pipe(T1());return this.childrenLoaders.set(r,y),y}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function hI(e){return function f3(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let lx=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Dn,this.transitionAbortSubject=new Dn,this.configLoader=tn(G1),this.environmentInjector=tn(Qo),this.urlSerializer=tn(oy),this.rootContexts=tn(hy),this.inputBindingEnabled=null!==tn(ix,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>fn(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=l=>this.events.next(new oB(l)),this.configLoader.onLoadStartListener=l=>this.events.next(new rB(l))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,l){return this.transitions=new mn({id:0,currentUrlTree:r,currentRawUrl:r,currentBrowserUrl:r,extractedUrl:t.urlHandlingStrategy.extract(r),urlAfterRedirects:t.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:cy,restoredState:null,currentSnapshot:l.snapshot,targetSnapshot:null,currentRouterState:l,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ch(f=>0!==f.id),Ln(f=>({...f,extractedUrl:t.urlHandlingStrategy.extract(f.rawUrl)})),Gi(f=>{this.currentTransition=f;let y=!1,C=!1;return fn(f).pipe(es(D=>{this.currentNavigation={id:D.id,initialUrl:D.rawUrl,extractedUrl:D.extractedUrl,trigger:D.source,extras:D.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Gi(D=>{const O=D.currentBrowserUrl.toString(),$=!t.navigated||D.extractedUrl.toString()!==O||O!==D.currentUrlTree.toString();if(!$&&"reload"!==(D.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const oe="";return this.events.next(new Hm(D.id,this.urlSerializer.serialize(D.rawUrl),oe,0)),D.resolve(null),oo}if(t.urlHandlingStrategy.shouldProcessUrl(D.rawUrl))return fn(D).pipe(Gi(oe=>{const ve=this.transitions?.getValue();return this.events.next(new ex(oe.id,this.urlSerializer.serialize(oe.extractedUrl),oe.source,oe.restoredState)),ve!==this.transitions?.getValue()?oo:Promise.resolve(oe)}),function s3(e,n,t,r,l,f){return vr(y=>function n3(e,n,t,r,l,f,y="emptyOnly"){return new i3(e,n,t,r,l,y,f).recognize()}(e,n,t,r,y.extractedUrl,l,f).pipe(Ln(({state:C,tree:D})=>({...y,targetSnapshot:C,urlAfterRedirects:D}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),es(oe=>{f.targetSnapshot=oe.targetSnapshot,f.urlAfterRedirects=oe.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:oe.urlAfterRedirects};const ve=new jS(oe.id,this.urlSerializer.serialize(oe.extractedUrl),this.urlSerializer.serialize(oe.urlAfterRedirects),oe.targetSnapshot);this.events.next(ve)}));if($&&t.urlHandlingStrategy.shouldProcessUrl(D.currentRawUrl)){const{id:oe,extractedUrl:ve,source:We,restoredState:Qe,extras:mt}=D,Vt=new ex(oe,this.urlSerializer.serialize(ve),We,Qe);this.events.next(Vt);const dt=qS(0,this.rootComponentType).snapshot;return this.currentTransition=f={...D,targetSnapshot:dt,urlAfterRedirects:ve,extras:{...mt,skipLocationChange:!1,replaceUrl:!1}},fn(f)}{const oe="";return this.events.next(new Hm(D.id,this.urlSerializer.serialize(D.extractedUrl),oe,1)),D.resolve(null),oo}}),es(D=>{const O=new eB(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(O)}),Ln(D=>(this.currentTransition=f={...D,guards:TB(D.targetSnapshot,D.currentSnapshot,this.rootContexts)},f)),function NB(e,n){return vr(t=>{const{targetSnapshot:r,currentSnapshot:l,guards:{canActivateChecks:f,canDeactivateChecks:y}}=t;return 0===y.length&&0===f.length?fn({...t,guardsResult:!0}):function FB(e,n,t,r){return it(e).pipe(vr(l=>function $B(e,n,t,r,l){const f=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return f&&0!==f.length?fn(f.map(C=>{const D=fy(n)??l,O=qm(C,D);return Dd(function LB(e){return e&&gy(e.canDeactivate)}(O)?O.canDeactivate(e,n,t,r):D.runInContext(()=>O(e,n,t,r))).pipe(Qf())})).pipe(Zm()):fn(!0)}(l.component,l.route,t,n,r)),Qf(l=>!0!==l,!0))}(y,r,l,e).pipe(vr(C=>C&&function IB(e){return"boolean"==typeof e}(C)?function zB(e,n,t,r){return it(n).pipe(Um(l=>C1(function VB(e,n){return null!==e&&n&&n(new sB(e)),fn(!0)}(l.route.parent,r),function BB(e,n){return null!==e&&n&&n(new lB(e)),fn(!0)}(l.route,r),function jB(e,n,t){const r=n[n.length-1],f=n.slice(0,n.length-1).reverse().map(y=>function DB(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(y)).filter(y=>null!==y).map(y=>xS(()=>fn(y.guards.map(D=>{const O=fy(y.node)??t,$=qm(D,O);return Dd(function RB(e){return e&&gy(e.canActivateChild)}($)?$.canActivateChild(r,e):O.runInContext(()=>$(r,e))).pipe(Qf())})).pipe(Zm())));return fn(f).pipe(Zm())}(e,l.path,t),function UB(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return fn(!0);const l=r.map(f=>xS(()=>{const y=fy(n)??t,C=qm(f,y);return Dd(function PB(e){return e&&gy(e.canActivate)}(C)?C.canActivate(n,e):y.runInContext(()=>C(n,e))).pipe(Qf())}));return fn(l).pipe(Zm())}(e,l.route,t))),Qf(l=>!0!==l,!0))}(r,f,e,n):fn(C)),Ln(C=>({...t,guardsResult:C})))})}(this.environmentInjector,D=>this.events.next(D)),es(D=>{if(f.guardsResult=D.guardsResult,tp(D.guardsResult))throw KS(0,D.guardsResult);const O=new tB(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot,!!D.guardsResult);this.events.next(O)}),Ch(D=>!!D.guardsResult||(this.cancelNavigationTransition(D,"",3),!1)),H1(D=>{if(D.guards.canActivateChecks.length)return fn(D).pipe(es(O=>{const $=new nB(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next($)}),Gi(O=>{let $=!1;return fn(O).pipe(function a3(e,n){return vr(t=>{const{targetSnapshot:r,guards:{canActivateChecks:l}}=t;if(!l.length)return fn(t);let f=0;return it(l).pipe(Um(y=>function l3(e,n,t,r){const l=e.routeConfig,f=e._resolve;return void 0!==l?.title&&!uI(l)&&(f[iy]=l.title),function c3(e,n,t,r){const l=function u3(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===l.length)return fn({});const f={};return it(l).pipe(vr(y=>function h3(e,n,t,r){const l=fy(n)??r,f=qm(e,l);return Dd(f.resolve?f.resolve(n,t):l.runInContext(()=>f(n,t)))}(e[y],n,t,r).pipe(Qf(),es(C=>{f[y]=C}))),D1(1),function Cz(e){return Ln(()=>e)}(f),Xa(y=>nI(y)?oo:rc(y)))}(f,e,n,r).pipe(Ln(y=>(e._resolvedData=y,e.data=ZS(e,t).resolve,l&&uI(l)&&(e.data[iy]=l.title),null)))}(y.route,r,e,n)),es(()=>f++),D1(1),vr(y=>f===l.length?fn(t):oo))})}(t.paramsInheritanceStrategy,this.environmentInjector),es({next:()=>$=!0,complete:()=>{$||this.cancelNavigationTransition(O,"",2)}}))}),es(O=>{const $=new iB(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next($)}))}),H1(D=>{const O=$=>{const W=[];$.routeConfig?.loadComponent&&!$.routeConfig._loadedComponent&&W.push(this.configLoader.loadComponent($.routeConfig).pipe(es(oe=>{$.component=oe}),Ln(()=>{})));for(const oe of $.children)W.push(...O(oe));return W};return E1(O(D.targetSnapshot.root)).pipe(Z0(),Vm(1))}),H1(()=>this.afterPreactivation()),Ln(D=>{const O=function pB(e,n,t){const r=dy(e,n._root,t?t._root:void 0);return new GS(r,n)}(t.routeReuseStrategy,D.targetSnapshot,D.currentRouterState);return this.currentTransition=f={...D,targetRouterState:O},f}),es(()=>{this.events.next(new R1)}),((e,n,t,r)=>Ln(l=>(new CB(n,l.targetRouterState,l.currentRouterState,t,r).activate(e),l)))(this.rootContexts,t.routeReuseStrategy,D=>this.events.next(D),this.inputBindingEnabled),Vm(1),es({next:D=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Md(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects))),t.titleStrategy?.updateTitle(D.targetRouterState.snapshot),D.resolve(!0)},complete:()=>{y=!0}}),function Tz(e){return hi((n,t)=>{Ei(e).subscribe(ln(t,()=>t.complete(),Nt)),!t.closed&&n.subscribe(t)})}(this.transitionAbortSubject.pipe(es(D=>{throw D}))),ny(()=>{y||C||this.cancelNavigationTransition(f,"",1),this.currentNavigation?.id===f.id&&(this.currentNavigation=null)}),Xa(D=>{if(C=!0,QS(D))this.events.next(new uy(f.id,this.urlSerializer.serialize(f.extractedUrl),D.message,D.cancellationCode)),function _B(e){return QS(e)&&tp(e.url)}(D)?this.events.next(new L1(D.url)):f.resolve(!1);else{this.events.next(new tx(f.id,this.urlSerializer.serialize(f.extractedUrl),D,f.targetSnapshot??void 0));try{f.resolve(t.errorHandler(D))}catch(O){f.reject(O)}}return oo}))}))}cancelNavigationTransition(t,r,l){const f=new uy(t.id,this.urlSerializer.serialize(t.extractedUrl),r,l);this.events.next(f),t.resolve(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function dI(e){return e!==cy}let fI=(()=>{class e{buildTitle(t){let r,l=t.root;for(;void 0!==l;)r=this.getResolvedTitleForRoute(l)??r,l=l.children.find(f=>f.outlet===li);return r}getResolvedTitleForRoute(t){return t.data[iy]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(p3)},providedIn:"root"})}return e})(),p3=(()=>{class e extends fI{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(dS))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),m3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(_3)},providedIn:"root"})}return e})();class g3{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let _3=(()=>{class e extends g3{static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const cx=new Xt("",{providedIn:"root",factory:()=>({})});let y3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(v3)},providedIn:"root"})}return e})(),v3=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var _y=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(_y||{});function pI(e,n){e.events.pipe(Ch(t=>t instanceof Md||t instanceof uy||t instanceof tx||t instanceof Hm),Ln(t=>t instanceof Md||t instanceof Hm?_y.COMPLETE:t instanceof uy&&(0===t.code||1===t.code)?_y.REDIRECTING:_y.FAILED),Ch(t=>t!==_y.REDIRECTING),Vm(1)).subscribe(()=>{n()})}function x3(e){throw e}function b3(e,n,t){return n.parse("/")}const w3={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},E3={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ls=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=tn(GD),this.isNgZoneEnabled=!1,this._events=new Dn,this.options=tn(cx,{optional:!0})||{},this.pendingTasks=tn(C0),this.errorHandler=this.options.errorHandler||x3,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||b3,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=tn(y3),this.routeReuseStrategy=tn(m3),this.titleStrategy=tn(fI),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=tn(Xm,{optional:!0})?.flat()??[],this.navigationTransitions=tn(lx),this.urlSerializer=tn(oy),this.location=tn(Yw),this.componentInputBindingEnabled=!!tn(ix,{optional:!0}),this.eventsSubscription=new Le,this.isNgZoneEnabled=tn(v)instanceof v&&v.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new $m,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=qS(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const{currentTransition:l}=this.navigationTransitions;if(null===l)return void(mI(r)&&this._events.next(r));if(r instanceof ex)dI(l.source)&&(this.browserUrlTree=l.extractedUrl);else if(r instanceof Hm)this.rawUrlTree=l.rawUrl;else if(r instanceof jS){if("eager"===this.urlUpdateStrategy){if(!l.extras.skipLocationChange){const f=this.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl);this.setBrowserUrl(f,l)}this.browserUrlTree=l.urlAfterRedirects}}else if(r instanceof R1)this.currentUrlTree=l.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl),this.routerState=l.targetRouterState,"deferred"===this.urlUpdateStrategy&&(l.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,l),this.browserUrlTree=l.urlAfterRedirects);else if(r instanceof uy)0!==r.code&&1!==r.code&&(this.navigated=!0),(3===r.code||2===r.code)&&this.restoreHistory(l);else if(r instanceof L1){const f=this.urlHandlingStrategy.merge(r.url,l.currentRawUrl),y={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||dI(l.source)};this.scheduleNavigation(f,cy,null,y,{resolve:l.resolve,reject:l.reject,promise:l.promise})}r instanceof tx&&this.restoreHistory(l,!0),r instanceof Md&&(this.navigated=!0),mI(r)&&this._events.next(r)}catch(l){this.navigationTransitions.transitionAbortSubject.next(l)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),cy,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,l){const f={replaceUrl:!0},y=l?.navigationId?l:null;if(l){const D={...l};delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(f.state=D)}const C=this.parseUrl(t);this.scheduleNavigation(C,r,y,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(U1),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:l,queryParams:f,fragment:y,queryParamsHandling:C,preserveFragment:D}=r,O=D?this.currentUrlTree.fragment:y;let W,$=null;switch(C){case"merge":$={...this.currentUrlTree.queryParams,...f};break;case"preserve":$=this.currentUrlTree.queryParams;break;default:$=f||null}null!==$&&($=this.removeEmptyProps($));try{W=OS(l?l.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),W=this.currentUrlTree.root}return NS(W,t,$,O??null)}navigateByUrl(t,r={skipLocationChange:!1}){const l=tp(t)?t:this.parseUrl(t),f=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(f,cy,null,r)}navigate(t,r={skipLocationChange:!1}){return function C3(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new Mt(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(l){r=this.malformedUriErrorHandler(l,this.urlSerializer,t)}return r}isActive(t,r){let l;if(l=!0===r?{...w3}:!1===r?{...E3}:r,tp(t))return DS(this.currentUrlTree,t,l);const f=this.parseUrl(t);return DS(this.currentUrlTree,f,l)}removeEmptyProps(t){return Object.keys(t).reduce((r,l)=>{const f=t[l];return null!=f&&(r[l]=f),r},{})}scheduleNavigation(t,r,l,f,y){if(this.disposed)return Promise.resolve(!1);let C,D,O;y?(C=y.resolve,D=y.reject,O=y.promise):O=new Promise((W,oe)=>{C=W,D=oe});const $=this.pendingTasks.add();return pI(this,()=>{queueMicrotask(()=>this.pendingTasks.remove($))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:f,resolve:C,reject:D,promise:O,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),O.catch(W=>Promise.reject(W))}setBrowserUrl(t,r){const l=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(l)||r.extras.replaceUrl){const y={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(l,"",y)}else{const f={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(l,"",f)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-this.browserPageId;0!==f?this.location.historyGo(f):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===f&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function mI(e){return!(e instanceof R1||e instanceof L1)}let ux=(()=>{class e{constructor(t,r,l,f,y,C){this.router=t,this.route=r,this.tabIndexAttribute=l,this.renderer=f,this.el=y,this.locationStrategy=C,this.href=null,this.commands=null,this.onChanges=new Dn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const D=y.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===D||"area"===D,this.isAnchorElement?this.subscription=t.events.subscribe(O=>{O instanceof Md&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,r,l,f,y){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||r||l||f||y||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function Bv(e,n,t){return function Mb(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?If:cm}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,r){const l=this.renderer,f=this.el.nativeElement;null!==r?l.setAttribute(f,t,r):l.removeAttribute(f,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(et(Ls),et(Sd),function ru(e){return function qy(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let l=0;for(;l<r;){const f=t[l];if(Ys(f))break;if(0===f)l+=2;else if("number"==typeof f)for(l++;l<r&&"string"==typeof t[l];)l++;else{if(f===n)return t[l+1];l+=2}}}return null}(Vr(),e)}("tabindex"),et(qa),et(ua),et(Kf))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,l){1&r&&Sn("click",function(y){return l.onClick(y.button,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey)}),2&r&&xu("target",l.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",zm],skipLocationChange:["skipLocationChange","skipLocationChange",zm],replaceUrl:["replaceUrl","replaceUrl",zm],routerLink:"routerLink"},standalone:!0,features:[dC,Kt]})}return e})();class gI{}let M3=(()=>{class e{constructor(t,r,l,f,y){this.router=t,this.injector=l,this.preloadingStrategy=f,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(Ch(t=>t instanceof Md),Um(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const l=[];for(const f of r){f.providers&&!f._injector&&(f._injector=mw(f.providers,t,`Route: ${f.path}`));const y=f._injector??t,C=f._loadedInjector??y;(f.loadChildren&&!f._loadedRoutes&&void 0===f.canLoad||f.loadComponent&&!f._loadedComponent)&&l.push(this.preloadConfig(y,f)),(f.children||f._loadedRoutes)&&l.push(this.processRoutes(C,f.children??f._loadedRoutes))}return it(l).pipe(Ea())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let l;l=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):fn(null);const f=l.pipe(vr(y=>null===y?fn(void 0):(r._loadedRoutes=y.routes,r._loadedInjector=y.injector,this.processRoutes(y.injector??t,y.routes))));return r.loadComponent&&!r._loadedComponent?it([f,this.loader.loadComponent(r)]).pipe(Ea()):f})}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ls),sn(qD),sn(Qo),sn(gI),sn(G1))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const q1=new Xt("");let _I=(()=>{class e{constructor(t,r,l,f,y={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=l,this.zone=f,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof ex?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Md?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Hm&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof $S&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new $S(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function Ir(){throw new Error("invalid")}()};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function Dh(e,n){return{\u0275kind:e,\u0275providers:n}}function vI(){const e=tn(As);return n=>{const t=e.get(Fm);if(n!==t.components[0])return;const r=e.get(Ls),l=e.get(xI);1===e.get(Z1)&&r.initialNavigation(),e.get(bI,null,$n.Optional)?.setUpPreloading(),e.get(q1,null,$n.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),l.closed||(l.next(),l.complete(),l.unsubscribe())}}const xI=new Xt("",{factory:()=>new Dn}),Z1=new Xt("",{providedIn:"root",factory:()=>1}),bI=new Xt("");function P3(e){return Dh(0,[{provide:bI,useExisting:M3},{provide:gI,useExisting:e}])}const wI=new Xt("ROUTER_FORROOT_GUARD"),L3=[Yw,{provide:oy,useClass:M1},Ls,hy,{provide:Sd,useFactory:function yI(e){return e.routerState.root},deps:[Ls]},G1,[]];function k3(){return new QD("Router",Ls)}let EI=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[L3,[],{provide:Xm,multi:!0,useValue:t},{provide:wI,useFactory:z3,deps:[[Ls,new Op,new Np]]},{provide:cx,useValue:r||{}},r?.useHash?{provide:Kf,useClass:qO}:{provide:Kf,useClass:IM},{provide:q1,useFactory:()=>{const e=tn(cF),n=tn(v),t=tn(cx),r=tn(lx),l=tn(oy);return t.scrollOffset&&e.setOffset(t.scrollOffset),new _I(l,r,e,n,t)}},r?.preloadingStrategy?P3(r.preloadingStrategy).\u0275providers:[],{provide:QD,multi:!0,useFactory:k3},r?.initialNavigation?B3(r):[],r?.bindToComponentInputs?Dh(8,[YS,{provide:ix,useExisting:YS}]).\u0275providers:[],[{provide:CI,useFactory:vI},{provide:Vw,multi:!0,useExisting:CI}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Xm,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)(sn(wI,8))};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();function z3(e){return"guarded"}function B3(e){return["disabled"===e.initialNavigation?Dh(3,[{provide:Rw,multi:!0,useFactory:()=>{const n=tn(Ls);return()=>{n.setUpLocationChangeListener()}}},{provide:Z1,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Dh(2,[{provide:Z1,useValue:0},{provide:Rw,multi:!0,deps:[As],useFactory:n=>{const t=n.get(HO,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const l=n.get(Ls),f=n.get(xI);pI(l,()=>{r(!0)}),n.get(lx).afterPreactivation=()=>(r(!0),f.closed?fn(void 0):f),l.initialNavigation()}))}}]).\u0275providers:[]]}const CI=new Xt(""),Mh_urlApi="https://api-back-service-3uomm4d6da-uc.a.run.app/localizador";class hx{}class dx{}class Tu{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const l=t.slice(0,r),f=l.toLowerCase(),y=t.slice(r+1).trim();this.maybeSetNormalizedName(l,f),this.headers.has(f)?this.headers.get(f).push(y):this.headers.set(f,[y])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof Tu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new Tu;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Tu?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const l=("a"===n.op?this.headers.get(t):void 0)||[];l.push(...r),this.headers.set(t,l);break;case"d":const f=n.value;if(f){let y=this.headers.get(t);if(!y)return;y=y.filter(C=>-1===f.indexOf(C)),0===y.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,y)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(n,t){const r=(Array.isArray(t)?t:[t]).map(f=>f.toString()),l=n.toLowerCase();this.headers.set(l,r),this.maybeSetNormalizedName(n,l)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class U3{encodeKey(n){return TI(n)}encodeValue(n){return TI(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const $3=/%(\d[a-f0-9])/gi,H3={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function TI(e){return encodeURIComponent(e).replace($3,(n,t)=>H3[t]??n)}function fx(e){return`${e}`}class Id{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new U3,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function j3(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const f=l.indexOf("="),[y,C]=-1==f?[n.decodeKey(l),""]:[n.decodeKey(l.slice(0,f)),n.decodeValue(l.slice(f+1))],D=t.get(y)||[];D.push(C),t.set(y,D)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],l=Array.isArray(r)?r.map(fx):[fx(r)];this.map.set(t,l)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const l=n[r];Array.isArray(l)?l.forEach(f=>{t.push({param:r,value:f,op:"a"})}):t.push({param:r,value:l,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new Id({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(fx(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const l=r.indexOf(fx(n.value));-1!==l&&r.splice(l,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class G3{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function DI(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function MI(e){return typeof Blob<"u"&&e instanceof Blob}function SI(e){return typeof FormData<"u"&&e instanceof FormData}class yy{constructor(n,t,r,l){let f;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function q3(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==r?r:null,f=l):f=r,f&&(this.reportProgress=!!f.reportProgress,this.withCredentials=!!f.withCredentials,f.responseType&&(this.responseType=f.responseType),f.headers&&(this.headers=f.headers),f.context&&(this.context=f.context),f.params&&(this.params=f.params)),this.headers||(this.headers=new Tu),this.context||(this.context=new G3),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=t;else{const C=t.indexOf("?");this.urlWithParams=t+(-1===C?"?":C<t.length-1?"&":"")+y}}else this.params=new Id,this.urlWithParams=t}serializeBody(){return null===this.body?null:DI(this.body)||MI(this.body)||SI(this.body)||function Z3(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Id?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||SI(this.body)?null:MI(this.body)?this.body.type||null:DI(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Id?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,l=n.responseType||this.responseType,f=void 0!==n.body?n.body:this.body,y=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,C=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let D=n.headers||this.headers,O=n.params||this.params;const $=n.context??this.context;return void 0!==n.setHeaders&&(D=Object.keys(n.setHeaders).reduce((W,oe)=>W.set(oe,n.setHeaders[oe]),D)),n.setParams&&(O=Object.keys(n.setParams).reduce((W,oe)=>W.set(oe,n.setParams[oe]),O)),new yy(t,r,f,{params:O,headers:D,context:$,reportProgress:C,responseType:l,withCredentials:y})}}var Ym=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Ym||{});class W1{constructor(n,t=200,r="OK"){this.headers=n.headers||new Tu,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class X1 extends W1{constructor(n={}){super(n),this.type=Ym.ResponseHeader}clone(n={}){return new X1({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Km extends W1{constructor(n={}){super(n),this.type=Ym.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new Km({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class II extends W1{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function Y1(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let Ad=(()=>{class e{constructor(t){this.handler=t}request(t,r,l={}){let f;if(t instanceof yy)f=t;else{let D,O;D=l.headers instanceof Tu?l.headers:new Tu(l.headers),l.params&&(O=l.params instanceof Id?l.params:new Id({fromObject:l.params})),f=new yy(t,r,void 0!==l.body?l.body:null,{headers:D,context:l.context,params:O,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=fn(f).pipe(Um(D=>this.handler.handle(D)));if(t instanceof yy||"events"===l.observe)return y;const C=y.pipe(Ch(D=>D instanceof Km));switch(l.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return C.pipe(Ln(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return C.pipe(Ln(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return C.pipe(Ln(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return C.pipe(Ln(D=>D.body))}case"response":return C;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new Id).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,l={}){return this.request("PATCH",t,Y1(l,r))}post(t,r,l={}){return this.request("POST",t,Y1(l,r))}put(t,r,l={}){return this.request("PUT",t,Y1(l,r))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(hx))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function RI(e,n){return n(e)}function X3(e,n){return(t,r)=>n.intercept(t,{handle:l=>e(l,r)})}const K3=new Xt(""),vy=new Xt(""),LI=new Xt("");function J3(){let e=null;return(n,t)=>{null===e&&(e=(tn(K3,{optional:!0})??[]).reduceRight(X3,RI));const r=tn(C0),l=r.add();return e(n,t).pipe(ny(()=>r.remove(l)))}}let kI=(()=>{class e extends hx{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=tn(C0)}handle(t){if(null===this.chain){const l=Array.from(new Set([...this.injector.get(vy),...this.injector.get(LI,[])]));this.chain=l.reduceRight((f,y)=>function Y3(e,n,t){return(r,l)=>t.runInContext(()=>n(r,f=>e(f,l)))}(f,y,this.injector),RI)}const r=this.pendingTasks.add();return this.chain(t,l=>this.backend.handle(l)).pipe(ny(()=>this.pendingTasks.remove(r)))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(dx),sn(Qo))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const nV=/^\)\]\}',?\n/;let NI=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Mt(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?it(r.\u0275loadImpl()):fn(null)).pipe(Gi(()=>new In(f=>{const y=r.build();if(y.open(t.method,t.urlWithParams),t.withCredentials&&(y.withCredentials=!0),t.headers.forEach((Qe,mt)=>y.setRequestHeader(Qe,mt.join(","))),t.headers.has("Accept")||y.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const Qe=t.detectContentTypeHeader();null!==Qe&&y.setRequestHeader("Content-Type",Qe)}if(t.responseType){const Qe=t.responseType.toLowerCase();y.responseType="json"!==Qe?Qe:"text"}const C=t.serializeBody();let D=null;const O=()=>{if(null!==D)return D;const Qe=y.statusText||"OK",mt=new Tu(y.getAllResponseHeaders()),Vt=function iV(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(y)||t.url;return D=new X1({headers:mt,status:y.status,statusText:Qe,url:Vt}),D},$=()=>{let{headers:Qe,status:mt,statusText:Vt,url:dt}=O(),hn=null;204!==mt&&(hn=typeof y.response>"u"?y.responseText:y.response),0===mt&&(mt=hn?200:0);let Un=mt>=200&&mt<300;if("json"===t.responseType&&"string"==typeof hn){const yi=hn;hn=hn.replace(nV,"");try{hn=""!==hn?JSON.parse(hn):null}catch(ts){hn=yi,Un&&(Un=!1,hn={error:ts,text:hn})}}Un?(f.next(new Km({body:hn,headers:Qe,status:mt,statusText:Vt,url:dt||void 0})),f.complete()):f.error(new II({error:hn,headers:Qe,status:mt,statusText:Vt,url:dt||void 0}))},W=Qe=>{const{url:mt}=O(),Vt=new II({error:Qe,status:y.status||0,statusText:y.statusText||"Unknown Error",url:mt||void 0});f.error(Vt)};let oe=!1;const ve=Qe=>{oe||(f.next(O()),oe=!0);let mt={type:Ym.DownloadProgress,loaded:Qe.loaded};Qe.lengthComputable&&(mt.total=Qe.total),"text"===t.responseType&&y.responseText&&(mt.partialText=y.responseText),f.next(mt)},We=Qe=>{let mt={type:Ym.UploadProgress,loaded:Qe.loaded};Qe.lengthComputable&&(mt.total=Qe.total),f.next(mt)};return y.addEventListener("load",$),y.addEventListener("error",W),y.addEventListener("timeout",W),y.addEventListener("abort",W),t.reportProgress&&(y.addEventListener("progress",ve),null!==C&&y.upload&&y.upload.addEventListener("progress",We)),y.send(C),f.next({type:Ym.Sent}),()=>{y.removeEventListener("error",W),y.removeEventListener("abort",W),y.removeEventListener("load",$),y.removeEventListener("timeout",W),t.reportProgress&&(y.removeEventListener("progress",ve),null!==C&&y.upload&&y.upload.removeEventListener("progress",We)),y.readyState!==y.DONE&&y.abort()}})))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(WM))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const K1=new Xt("XSRF_ENABLED"),FI=new Xt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),zI=new Xt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class BI{}let sV=(()=>{class e{constructor(t,r,l){this.doc=t,this.platform=r,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=BM(t,this.cookieName),this.lastCookieString=t),this.lastToken}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl),sn(uh),sn(FI))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function aV(e,n){const t=e.url.toLowerCase();if(!tn(K1)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const r=tn(BI).getToken(),l=tn(zI);return null!=r&&!e.headers.has(l)&&(e=e.clone({headers:e.headers.set(l,r)})),n(e)}var Pd=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(Pd||{});function lV(...e){const n=[Ad,NI,kI,{provide:hx,useExisting:kI},{provide:dx,useExisting:NI},{provide:vy,useValue:aV,multi:!0},{provide:K1,useValue:!0},{provide:BI,useClass:sV}];for(const t of e)n.push(...t.\u0275providers);return function Pf(e){return{\u0275providers:e}}(n)}const VI=new Xt("LEGACY_INTERCEPTOR_FN");function cV(){return function np(e,n){return{\u0275kind:e,\u0275providers:n}}(Pd.LegacyInterceptors,[{provide:VI,useFactory:J3},{provide:vy,useExisting:VI,multi:!0}])}let uV=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({providers:[lV(cV())]})}return e})(),Sh=(()=>{class e{constructor(t){this.http=t,this.userEmail=new mn(""),this.userEmail$=this.userEmail.asObservable(),this.userId=new mn(0),this.userId$=this.userId.asObservable(),this.userName=new mn(""),this.userName$=this.userName.asObservable(),this.userIdentificacion=new mn(""),this.userIdentificacion$=this.userIdentificacion.asObservable(),this.currentUserLoginOn=new mn(!1),this.currentUserData=new mn({id:0,nombres:"",email:"",password:"",rol:0,identificacion:"",tipoIdentificacion:""}),this.API_ENDPOINT_USER=Mh_urlApi+"/usuario"}setUserEmail(t){this.userEmail.next(t)}setUserId(t){this.userId.next(t)}setUserName(t){this.userName.next(t)}setUserIdentificacion(t){this.userIdentificacion.next(t)}login(t,r){return this.http.post(this.API_ENDPOINT_USER+"/login",{email:t,password:r}).pipe(es(f=>{this.currentUserData.next(f),this.currentUserLoginOn.next(!0)}),Ln(f=>{if(!f)throw new Error("Credenciales inv\xe1lidas o usuario no encontrado");return f}),Xa(this.handleError))}crearUsuario(t,r){return this.http.post(`${this.API_ENDPOINT_USER}/crear`,{usuario:t,perfil:r}).pipe(Xa(this.handleCreUsuarioError))}consultaNombreUsuario1(t){return this.http.get(`${this.API_ENDPOINT_USER}/nombreusuario/${t}`)}consultaNombreUsuario(t){return this.http.get(`${this.API_ENDPOINT_USER}/nombreusuario/${t}`).pipe(Ln(r=>r.nombre))}handleError(t){let r="Error en la conexi\xf3n o la consulta ";return console.log("Error desde servicio::",t.message),401===t.status?r="Credenciales inv\xe1lidas":402===t.status?r="Usuario no existe.":500===t.status&&(r="Error al verificar la contrase\xf1a"),rc(()=>new Error(r))}handleCreUsuarioError(t){let r="Error en la conexi\xf3n para crear el usuario ";return 500===t.status&&(r="Error al crear el usuario con su perfil"),rc(()=>new Error(r))}get usuarioData(){return this.currentUserData.asObservable()}get usuarioLoginOn(){return this.currentUserLoginOn.asObservable()}initializeUserDetails(){this.setUserEmail(""),this.setUserId(0),this.setUserName(""),this.setUserIdentificacion(""),this.currentUserLoginOn.next(!1),this.currentUserData.next({id:0,nombres:"",email:"",password:"",rol:0,identificacion:"",tipoIdentificacion:""})}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var mx=_e(433);let UI=(()=>{class e{constructor(t){this.http=t,this.API_ENDPOINT_USER=Mh_urlApi+"/usuario"}obtenerUbicacionUsuarioPorEmail(t){return t?this.http.get(`${this.API_ENDPOINT_USER}/ubicacion/${t}`).pipe(Xa(this.handleUbicacionError)):rc(()=>new Error("Email no puede ser nulo o vac\xedo"))}guardaActualizaUbicacion(t){return this.http.post(this.API_ENDPOINT_USER+"/ubicacion",t).pipe(Xa(this.handleUbicacionError))}handleUbicacionError(t){return rc(()=>new Error("Error en ubicaci\xf3n: "+t.message))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),jI=(()=>{class e{constructor(t){this.http=t,this.API_URL=Mh_urlApi+"/perfilestrabajo"}obtenerPerfilesPorProfesion(t){return this.http.get(`${this.API_URL}/${t}`)}obtenerPerfilesProfesion(){return this.http.get(`${this.API_URL}`)}obtenerPerfilesPorIdUsuario(t){return this.http.get(`${this.API_URL}/usuario/${t}`)}guardaActualizaPerfil(t){return this.http.post(this.API_URL+"/usuario/registra_actualiza_perfil",t).pipe(es(r=>{r.id_perfil&&!t.id_perfil&&(t.id_perfil=r.id_perfil)}),Xa(this.handlePerfilError))}handlePerfilError(t){return rc(()=>new Error("Error en perfil: "+t.message))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),$I=(()=>{class e{constructor(){this.navigateToContrato=new s}triggerNavigation(t,r){console.log("Se llamo al evento con id ",t),this.navigateToContrato.emit({idcontratante:t,idtrabajador:r})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),gV=(()=>{class e{constructor(t){this.http=t,this.API_URL=Mh_urlApi+"/profesion"}obtenerAreaYProfesion(){return this.http.get(`${this.API_URL}`)}obtenerAreaProfesionPorId(t){return this.http.get(`${this.API_URL}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),HI=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||e)(et(qa),et(ua))};static#t=this.\u0275dir=Pn({type:e})}return e})(),ip=(()=>{class e extends HI{static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Pn({type:e,features:[_r]})}return e})();const Du=new Xt("NgValueAccessor"),vV={provide:Du,useExisting:vi(()=>Ih),multi:!0},bV=new Xt("CompositionEventMode");let Ih=(()=>{class e extends HI{constructor(t,r,l){super(t,r),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function xV(){const e=Cd()?Cd().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||e)(et(qa),et(ua),et(bV,8))};static#t=this.\u0275dir=Pn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,l){1&r&&Sn("input",function(y){return l._handleInput(y.target.value)})("blur",function(){return l.onTouched()})("compositionstart",function(){return l._compositionStart()})("compositionend",function(y){return l._compositionEnd(y.target.value)})},features:[Gr([vV]),_r]})}return e})();function Rd(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function qI(e){return null!=e&&"number"==typeof e.length}const ks=new Xt("NgValidators"),Ld=new Xt("NgAsyncValidators"),wV=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class J1{static min(n){return function ZI(e){return n=>{if(Rd(n.value)||Rd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function WI(e){return n=>{if(Rd(n.value)||Rd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return XI(n)}static requiredTrue(n){return function YI(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function KI(e){return Rd(e.value)||wV.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function JI(e){return n=>Rd(n.value)||!qI(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return QI(n)}static pattern(n){return eA(n)}static nullValidator(n){return null}static compose(n){return sA(n)}static composeAsync(n){return aA(n)}}function XI(e){return Rd(e.value)?{required:!0}:null}function QI(e){return n=>qI(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}function eA(e){if(!e)return gx;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),r=>{if(Rd(r.value))return null;const l=r.value;return n.test(l)?null:{pattern:{requiredPattern:t,actualValue:l}}}}function gx(e){return null}function tA(e){return null!=e}function nA(e){return z_(e)?it(e):e}function iA(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function rA(e,n){return n.map(t=>t(e))}function oA(e){return e.map(n=>function EV(e){return!e.validate}(n)?n:t=>n.validate(t))}function sA(e){if(!e)return null;const n=e.filter(tA);return 0==n.length?null:function(t){return iA(rA(t,n))}}function Q1(e){return null!=e?sA(oA(e)):null}function aA(e){if(!e)return null;const n=e.filter(tA);return 0==n.length?null:function(t){return function _V(...e){const n=Ca(e),{args:t,keys:r}=gS(e),l=new In(f=>{const{length:y}=t;if(!y)return void f.complete();const C=new Array(y);let D=y,O=y;for(let $=0;$<y;$++){let W=!1;Ei(t[$]).subscribe(ln(f,oe=>{W||(W=!0,O--),C[$]=oe},()=>D--,void 0,()=>{(!D||!W)&&(O||f.next(r?yS(r,C):C),f.complete())}))}});return n?l.pipe(_S(n)):l}(rA(t,n).map(nA)).pipe(Ln(iA))}}function eE(e){return null!=e?aA(oA(e)):null}function lA(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function cA(e){return e._rawValidators}function uA(e){return e._rawAsyncValidators}function tE(e){return e?Array.isArray(e)?e:[e]:[]}function _x(e,n){return Array.isArray(e)?e.includes(n):e===n}function hA(e,n){const t=tE(n);return tE(e).forEach(l=>{_x(t,l)||t.push(l)}),t}function dA(e,n){return tE(n).filter(t=>!_x(e,t))}class fA{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=Q1(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=eE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class ga extends fA{get formDirective(){return null}get path(){return null}}class kd extends fA{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class pA{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Od=(()=>{class e extends pA{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(et(kd,2))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,l){2&r&&m0("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)},features:[_r]})}return e})(),Jm=(()=>{class e extends pA{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(et(ga,10))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,l){2&r&&m0("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)("ng-submitted",l.isSubmitted)},features:[_r]})}return e})();const xy="VALID",vx="INVALID",Qm="PENDING",by="DISABLED";function rE(e){return(xx(e)?e.validators:e)||null}function oE(e,n){return(xx(n)?n.asyncValidators:e)||null}function xx(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function gA(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new Mt(1e3,"");if(!r[t])throw new Mt(1001,"")}function _A(e,n,t){e._forEachChild((r,l)=>{if(void 0===t[l])throw new Mt(1002,"")})}class bx{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===xy}get invalid(){return this.status===vx}get pending(){return this.status==Qm}get disabled(){return this.status===by}get enabled(){return this.status!==by}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(hA(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(hA(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(dA(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(dA(n,this._rawAsyncValidators))}hasValidator(n){return _x(this._rawValidators,n)}hasAsyncValidator(n){return _x(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Qm,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=by,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=xy,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===xy||this.status===Qm)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?by:xy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Qm,this._hasOwnPendingAsyncValidator=!0;const t=nA(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,l)=>r&&r._find(l),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new s,this.statusChanges=new s}_calculateStatus(){return this._allControlsDisabled()?by:this.errors?vx:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Qm)?Qm:this._anyControlsHaveStatus(vx)?vx:xy}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){xx(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function MV(e){return Array.isArray(e)?Q1(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function SV(e){return Array.isArray(e)?eE(e):e||null}(this._rawAsyncValidators)}}class wy extends bx{constructor(n,t,r){super(rE(t),oE(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){_A(this,0,n),Object.keys(n).forEach(r=>{gA(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const l=this.controls[r];l&&l.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,l)=>{r.reset(n?n[l]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,l)=>((r.enabled||this.disabled)&&(t[l]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((l,f)=>{r=t(r,l,f)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class yA extends wy{}const rp=new Xt("CallSetDisabledState",{providedIn:"root",factory:()=>Ey}),Ey="always";function wx(e,n){return[...n.path,e]}function Cy(e,n,t=Ey){sE(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function AV(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&vA(e,n)})}(e,n),function RV(e,n){const t=(r,l)=>{n.valueAccessor.writeValue(r),l&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function PV(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&vA(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function IV(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function Ex(e,n,t=!0){const r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),Tx(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function Cx(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function sE(e,n){const t=cA(e);null!==n.validator?e.setValidators(lA(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=uA(e);null!==n.asyncValidator?e.setAsyncValidators(lA(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const l=()=>e.updateValueAndValidity();Cx(n._rawValidators,l),Cx(n._rawAsyncValidators,l)}function Tx(e,n){let t=!1;if(null!==e){if(null!==n.validator){const l=cA(e);if(Array.isArray(l)&&l.length>0){const f=l.filter(y=>y!==n.validator);f.length!==l.length&&(t=!0,e.setValidators(f))}}if(null!==n.asyncValidator){const l=uA(e);if(Array.isArray(l)&&l.length>0){const f=l.filter(y=>y!==n.asyncValidator);f.length!==l.length&&(t=!0,e.setAsyncValidators(f))}}}const r=()=>{};return Cx(n._rawValidators,r),Cx(n._rawAsyncValidators,r),t}function vA(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function xA(e,n){sE(e,n)}function lE(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}function bA(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function cE(e,n){if(!n)return null;let t,r,l;return Array.isArray(n),n.forEach(f=>{f.constructor===Ih?t=f:function OV(e){return Object.getPrototypeOf(e.constructor)===ip}(f)?r=f:l=f}),l||r||t||null}const FV={provide:ga,useExisting:vi(()=>op)},Ty=(()=>Promise.resolve())();let op=(()=>{class e extends ga{constructor(t,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._directives=new Set,this.ngSubmit=new s,this.form=new wy({},Q1(t),eE(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Ty.then(()=>{const r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),Cy(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Ty.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Ty.then(()=>{const r=this._findContainer(t.path),l=new wy({});xA(l,t),r.registerControl(t.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Ty.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){Ty.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,bA(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(r){return new(r||e)(et(ks,10),et(Ld,10),et(rp,8))};static#t=this.\u0275dir=Pn({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,l){1&r&&Sn("submit",function(y){return l.onSubmit(y)})("reset",function(){return l.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gr([FV]),_r]})}return e})();function wA(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function EA(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const Dy=class extends bx{constructor(n=null,t,r){super(rE(t),oE(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),xx(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=EA(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){wA(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){wA(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){EA(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},VV={provide:kd,useExisting:vi(()=>Nd)},DA=(()=>Promise.resolve())();let Nd=(()=>{class e extends kd{constructor(t,r,l,f,y,C){super(),this._changeDetectorRef=y,this.callSetDisabledState=C,this.control=new Dy,this._registered=!1,this.name="",this.update=new s,this._parent=t,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=cE(0,f)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),lE(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Cy(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){DA.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const r=t.isDisabled.currentValue,l=0!==r&&zm(r);DA.then(()=>{l&&!this.control.disabled?this.control.disable():!l&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?wx(t,this._parent):[t]}static#e=this.\u0275fac=function(r){return new(r||e)(et(ga,9),et(ks,10),et(Ld,10),et(Du,10),et(S0,8),et(rp,8))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Gr([VV]),_r,Kt]})}return e})(),eg=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Pn({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})(),SA=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();const uE=new Xt("NgModelWithFormControlWarning"),qV={provide:ga,useExisting:vi(()=>Dx)};let Dx=(()=>{class e extends ga{constructor(t,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new s,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Tx(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return Cy(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){Ex(t.control||null,t,!1),function NV(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,bA(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,l=this.form.get(t.path);r!==l&&(Ex(r||null,t),(e=>e instanceof Dy)(l)&&(Cy(l,t,this.callSetDisabledState),t.control=l))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);xA(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function LV(e,n){return Tx(e,n)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){sE(this.form,this),this._oldForm&&Tx(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(r){return new(r||e)(et(ks,10),et(Ld,10),et(rp,8))};static#t=this.\u0275dir=Pn({type:e,selectors:[["","formGroup",""]],hostBindings:function(r,l){1&r&&Sn("submit",function(y){return l.onSubmit(y)})("reset",function(){return l.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gr([qV]),_r,Kt]})}return e})();const XV={provide:kd,useExisting:vi(()=>fE)};let fE=(()=>{class e extends kd{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,r,l,f,y){super(),this._ngModelWarningConfig=y,this._added=!1,this.name=null,this.update=new s,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=cE(0,f)}ngOnChanges(t){this._added||this._setUpControl(),lE(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return wx(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(r){return new(r||e)(et(ga,13),et(ks,10),et(Ld,10),et(Du,10),et(uE,8))};static#n=this.\u0275dir=Pn({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Gr([XV]),_r,Kt]})}return e})();const YV={provide:Du,useExisting:vi(()=>Fd),multi:!0};function LA(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let Fd=(()=>{class e extends ip{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const l=LA(this._getOptionId(t),t);this.setProperty("value",l)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function KV(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Pn({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,l){1&r&&Sn("change",function(y){return l.onChange(y.target.value)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[Gr([YV]),_r]})}return e})(),tg=(()=>{class e{constructor(t,r,l){this._element=t,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(LA(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(et(ua),et(qa),et(Fd,9))};static#t=this.\u0275dir=Pn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();const JV={provide:Du,useExisting:vi(()=>pE),multi:!0};function kA(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let pE=(()=>{class e extends ip{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const l=t.map(f=>this._getOptionId(f));r=(f,y)=>{f._setSelected(l.indexOf(y.toString())>-1)}}else r=(l,f)=>{l._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const l=[],f=r.selectedOptions;if(void 0!==f){const y=f;for(let C=0;C<y.length;C++){const O=this._getOptionValue(y[C].value);l.push(O)}}else{const y=r.options;for(let C=0;C<y.length;C++){const D=y[C];if(D.selected){const O=this._getOptionValue(D.value);l.push(O)}}}this.value=l,t(l)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function QV(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Pn({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,l){1&r&&Sn("change",function(y){return l.onChange(y.target)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[Gr([JV]),_r]})}return e})(),ng=(()=>{class e{constructor(t,r,l){this._element=t,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(kA(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(kA(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(et(ua),et(qa),et(pE,9))};static#t=this.\u0275dir=Pn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();let sp=(()=>{class e{constructor(){this._validator=gx}ngOnChanges(t){if(this.inputName in t){const r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):gx,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return null!=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Pn({type:e,features:[Kt]})}return e})();const nU={provide:ks,useExisting:vi(()=>ap),multi:!0};let ap=(()=>{class e extends sp{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=zm,this.createValidator=t=>XI}enabled(t){return t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Pn({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,l){2&r&&xu("required",l._enabled?"":null)},inputs:{required:"required"},features:[Gr([nU]),_r]})}return e})();const sU={provide:ks,useExisting:vi(()=>mE),multi:!0};let mE=(()=>{class e extends sp{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=t=>function OA(e){return"number"==typeof e?e:parseInt(e,10)}(t),this.createValidator=t=>QI(t)}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Pn({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(r,l){2&r&&xu("maxlength",l._enabled?l.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Gr([sU]),_r]})}return e})();const aU={provide:ks,useExisting:vi(()=>gE),multi:!0};let gE=(()=>{class e extends sp{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=t=>t,this.createValidator=t=>eA(t)}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Pn({type:e,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(r,l){2&r&&xu("pattern",l._enabled?l.pattern:null)},inputs:{pattern:"pattern"},features:[Gr([aU]),_r]})}return e})(),jA=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[SA]})}return e})();class $A extends bx{constructor(n,t,r){super(rE(t),oE(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,r={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,t={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,r={}){let l=this._adjustIndex(n);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),t&&(this.controls.splice(l,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){_A(this,0,n),n.forEach((r,l)=>{gA(this,!1,l),this.at(l).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((r,l)=>{this.at(l)&&this.at(l).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((r,l)=>{r.reset(n[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,r)=>{n(t,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function HA(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let lU=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,r=null){const l=this._reduceControls(t);let f={};return HA(r)?f=r:null!==r&&(f.validators=r.validator,f.asyncValidators=r.asyncValidator),new wy(l,f)}record(t,r=null){const l=this._reduceControls(t);return new yA(l,r)}control(t,r,l){let f={};return this.useNonNullable?(HA(r)?f=r:(f.validators=r,f.asyncValidators=l),new Dy(t,{...f,nonNullable:!0})):new Dy(t,r,l)}array(t,r,l){const f=t.map(y=>this._createControl(y));return new $A(f,r,l)}_reduceControls(t){const r={};return Object.keys(t).forEach(l=>{r[l]=this._createControl(t[l])}),r}_createControl(t){return t instanceof Dy||t instanceof bx?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),cU=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:rp,useValue:t.callSetDisabledState??Ey}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[jA]})}return e})(),uU=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:uE,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:rp,useValue:t.callSetDisabledState??Ey}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[jA]})}return e})();function hU(e,n){1&e&&(Se(0,"div",7),rt(1," NO TIENE UBICACI\xd3N REGISTRADA, FAVOR INGRESAR SUS DATOS DE UBICACI\xd3N. "),Ie())}function dU(e,n){if(1&e&&(Se(0,"option",8),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id_area),st(1),da(" ",t.nombre_area_profesion," ")}}let fU=(()=>{class e{constructor(t,r,l,f,y,C,D){this.ubicacionService=t,this.perfiltrabajoService=r,this.router=l,this.navegacionService=f,this.zone=y,this.usuarioServicio=C,this.areaProfesionService=D,this.latUser=0,this.lonUser=0,this.profesionBuscada="",this.mimapa=null,this.marcadores=[],this.userId=0,this.profesiones=[],this.areaProfesionPersona="",this.noTieneUbicacion=!1}ngOnInit(){this.areaProfesionSubscrition=this.areaProfesionService.obtenerAreaYProfesion().subscribe({next:t=>{this.profesiones=t},error:t=>{console.error("Error al obtener profesiones",t)}})}cargarUbicacionUsuarioLogin(t){this.ubicacionSubscription=this.ubicacionService.obtenerUbicacionUsuarioPorEmail(t).subscribe({next:r=>{r?(this.latUser=r.latitud,this.lonUser=r.longitud,this.inicializarMapaUsuarioLogin()):this.noTieneUbicacion=!0},error:r=>{console.log("UBICACION ::: algo paso :( ",r)}})}inicializarMapaUsuarioLogin(){this.mimapa?console.log("Mapa ya inicializado."):(this.mimapa=new mx.Map("mapUOC").setView([this.latUser,this.lonUser],10),(0,mx.tileLayer)("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:30,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(this.mimapa),(0,mx.marker)([this.latUser,this.lonUser]).addTo(this.mimapa).bindPopup(`${this.usuarioServicio.userName$}`))}ngAfterViewInit(){this.mapaSubscription=this.usuarioServicio.userEmail$.subscribe(t=>{this.usuarioServicio.usuarioLoginOn&&this.cargarUbicacionUsuarioLogin(t)}),this.usuarioServicio.userId$.subscribe(t=>{this.usuarioServicio.usuarioLoginOn&&(this.userId=t)})}buscarProfesion(){this.profesionBuscada&&(this.marcadores.forEach(t=>{this.mimapa?.removeLayer(t)}),this.marcadores=[],this.perfiltrabajoSubscription=this.perfiltrabajoService.obtenerPerfilesPorProfesion(this.profesionBuscada).subscribe({next:t=>{t.forEach(r=>{const l=Number(r.latitud),f=Number(r.longitud);if(!isNaN(l)&&!isNaN(f)&&this.mimapa){const y=`<div>\n               <p>${r.nombres} :: Profesi\xf3n: ${r.profesion}</p>\n               <div class="d-flex justify-content-center"><button class="btn btn-primary me-3" id="contratar${r.id}">Contratar</button>\n               <button class="btn btn-primary" id="perfil${r.id}">Perfil</button> </div>               \n               </div>`,C=(0,mx.marker)([l,f]).addTo(this.mimapa).bindPopup(y);C.on("popupopen",()=>{const D=document.getElementById(`contratar${r.id}`);D&&D.addEventListener("click",()=>{console.log("Bot\xf3n contratar clickeado!"),this.navegarAContrato(this.userId,r.id)})}),this.marcadores.push(C)}})},error:t=>{console.error(t)}}))}onProfesionChange(){this.buscarProfesion()}navegarAContrato(t,r){this.router.navigate(["/crear-contrato",t,r])}ngOnDestroy(){console.log("destroy de mapa subscribe"),this.ubicacionSubscription&&this.ubicacionSubscription.unsubscribe(),this.mapaSubscription&&this.mapaSubscription.unsubscribe(),this.perfiltrabajoSubscription&&this.perfiltrabajoSubscription.unsubscribe(),this.areaProfesionSubscrition&&this.areaProfesionSubscrition.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(et(UI),et(jI),et(Ls),et($I),et(v),et(Sh),et(gV))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-mapa"]],decls:9,vars:3,consts:[[1,"custom-container","my-5"],[1,"mb-3"],["for","profesional",1,"form-label"],["class","alert alert-danger","style","text-align: center; font-weight: bold;",4,"ngIf"],["name","profesional",1,"form-select",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["id","mapUOC",1,"map-container"],[1,"alert","alert-danger",2,"text-align","center","font-weight","bold"],[3,"value"]],template:function(r,l){1&r&&(Se(0,"div",0)(1,"div",1)(2,"label",2),rt(3,"Buscar Profesional"),Ie(),Se(4,"div"),_i(5,hU,2,0,"div",3),Ie(),Se(6,"select",4),Sn("ngModelChange",function(y){return l.profesionBuscada=y})("change",function(){return l.buscarProfesion()}),_i(7,dU,2,2,"option",5),Ie()(),wo(8,"div",6),Ie()),2&r&&(st(5),Gt("ngIf",l.noTieneUbicacion),st(1),Gt("ngModel",l.profesionBuscada),st(1),Gt("ngForOf",l.profesiones))},dependencies:[Jf,Eh,tg,ng,Fd,Od,Nd],styles:["#mapUOC[_ngcontent-%COMP%]{height:590px}.custom-container[_ngcontent-%COMP%]{max-width:60%;margin-right:auto;margin-left:auto}.map-container[_ngcontent-%COMP%]{width:100%;height:400px}@media (max-width: 768px){.custom-container[_ngcontent-%COMP%]{max-width:100%}}"]})}return e})();function pU(e,n){1&e&&(Se(0,"p"),rt(1,"Usuario No autenticado"),Ie())}function mU(e,n){if(1&e&&(Se(0,"p"),rt(1),Ie()),2&e){const t=Ni();st(1),da("Usuario ",null==t.userDatos?null:t.userDatos.nombres," Autenticado")}}function gU(e,n){1&e&&wo(0,"img",2)}function _U(e,n){1&e&&wo(0,"app-mapa")}let GA=(()=>{class e{constructor(t,r){this.usuarioServer=t,this.route=r,this.userLoginOn=!1}ngOnInit(){this.route.params.subscribe(t=>{"outsesion"===t.outsesion?(console.log("entro a cerrar sesiony destruir subscricion"),this.usuarioServer.initializeUserDetails(),this.userLoginOn=!1,this.userDatos={id:0,nombres:"",email:"",password:"",rol:0,estado:"",identificacion:"",tipoIdentificacion:""},this.subscription1?.unsubscribe(),this.subscription2?.unsubscribe()):this.subscribeToUserData()})}subscribeToUserData(){this.subscription1=this.usuarioServer.currentUserLoginOn.subscribe({next:t=>{this.userLoginOn=t}}),this.subscription2=this.usuarioServer.currentUserData.subscribe({next:t=>{this.userDatos=t}})}static#e=this.\u0275fac=function(r){return new(r||e)(et(Sh),et(Sd))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-dashboard"]],decls:4,vars:4,consts:[[4,"ngIf"],["src","assets/images/Youtube-Finance.png","alt","Portada","class","img-portada",4,"ngIf"],["src","assets/images/Youtube-Finance.png","alt","Portada",1,"img-portada"]],template:function(r,l){1&r&&(_i(0,pU,2,0,"p",0),_i(1,mU,2,1,"p",0),_i(2,gU,1,0,"img",1),_i(3,_U,1,0,"app-mapa",0)),2&r&&(Gt("ngIf",!l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn),st(1),Gt("ngIf",!l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn))},dependencies:[Eh,fU],styles:[".img-portada[_ngcontent-%COMP%]{width:100%;height:auto;display:block;margin:0 auto}"]})}return e})();function yU(e,n){1&e&&(Se(0,"div"),rt(1," Email es requerido. "),Ie())}function vU(e,n){1&e&&(Se(0,"div"),rt(1," Email tiene formato invalido. "),Ie())}function xU(e,n){if(1&e&&(Se(0,"div",14),_i(1,yU,2,0,"div",15),_i(2,vU,2,0,"div",15),Ie()),2&e){const t=Ni();st(1),Gt("ngIf",null==t.user.errors?null:t.user.errors.required),st(1),Gt("ngIf",null==t.user.errors?null:t.user.errors.email)}}function bU(e,n){1&e&&(Se(0,"div"),rt(1," Pasword es requerido. "),Ie())}function wU(e,n){if(1&e&&(Se(0,"div",14),_i(1,bU,2,0,"div",15),Ie()),2&e){const t=Ni();st(1),Gt("ngIf",null==t.pasword.errors?null:t.pasword.errors.required)}}let EU=(()=>{class e{constructor(t,r,l){this.formBuilder=t,this.router=r,this.usuarioService=l,this.loginError="",this.loginForm=this.formBuilder.group({email:["",[J1.required,J1.email]],password:["",J1.required]})}ngOnInit(){}get user(){return this.loginForm.controls.email}get pasword(){return this.loginForm.controls.password}login(){if(this.loginForm.valid){const t=this.loginForm.get("email")?.value||"",r=this.loginForm.get("password")?.value||"";this.loginSubscription=this.usuarioService.login(t,r).subscribe({next:l=>{this.usuarioService.setUserEmail(t),this.usuarioService.setUserId(l.id),this.usuarioService.setUserName(l.nombres),this.usuarioService.setUserIdentificacion(l.identificacion)},error:l=>{console.log("entro a errorData::",l),this.loginError=l},complete:()=>{this.router.navigateByUrl("/inicio"),this.loginForm.reset()}})}else this.loginForm.markAllAsTouched()}ngOnDestroy(){this.loginSubscription&&this.loginSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(et(lU),et(Ls),et(Sh))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-login"]],decls:22,vars:4,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[3,"formGroup"],[1,"text-danger"],[1,"mb-3"],["for","inputEmail1",1,"form-label"],["formControlName","email","type","email","id","inputEmail1","aria-describedby","emailHelp",1,"form-control"],["id","emailHelp",1,"form-text"],["class","alert alert-danger",4,"ngIf"],["for","inputPassword1",1,"form-label"],["formControlName","password","type","password","id","inputPassword1",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"alert","alert-danger"],[4,"ngIf"]],template:function(r,l){1&r&&(Se(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),rt(4,"Inicie Sesi\xf3n"),Ie(),Se(5,"form",4)(6,"p",5),rt(7),Ie(),Se(8,"div",6)(9,"label",7),rt(10,"Email"),Ie(),wo(11,"input",8),Se(12,"div",9),rt(13,"Nunca compartiremos sus datos personales con nadie m\xe1s.."),Ie(),_i(14,xU,3,2,"div",10),Ie(),Se(15,"div",6)(16,"label",11),rt(17,"Contrase\xf1a"),Ie(),wo(18,"input",12),_i(19,wU,2,1,"div",10),Ie(),Se(20,"button",13),Sn("click",function(){return l.login()}),rt(21,"Iniciar Sesi\xf3n"),Ie()()()()()),2&r&&(st(5),Gt("formGroup",l.loginForm),st(2),Xi(l.loginError),st(7),Gt("ngIf",l.user.invalid&&(l.user.dirty||l.user.touched)),st(5),Gt("ngIf",l.pasword.invalid&&(l.pasword.dirty||l.pasword.touched)))},dependencies:[Eh,eg,Ih,Od,Jm,Dx,fE],styles:["form[_ngcontent-%COMP%]{margin:20px}"]})}return e})(),_E=(()=>{class e{constructor(t){this.http=t,this.API_URL=Mh_urlApi}crearContrato(t){return this.http.post(`${this.API_URL}/contrato/crear`,t)}consultaContratoUsuario(t){return this.http.get(`${this.API_URL}/contrato/usuario/${t}`).pipe(Xa(r=>404===r.status?fn(null):rc(()=>new Error("Error al consultar contrato: "+r.message))))}consultaContratoUsuarioRelacionado(t){return this.http.get(`${this.API_URL}/contrato/relacionado/${t}`)}consultaContratoGeneralRelacionado(t){return this.http.get(`${this.API_URL}/contrato/general/${t}`)}editarContrato(t){return this.http.put(`${this.API_URL}/contrato/editar`,t).pipe(Xa(r=>rc(()=>new Error("Error al actualizar contrato: "+r.message))))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Mx=(()=>{class e{constructor(){this.tiposIdentificacion=[{id:"CEDULA",nombre:"C\xe9dula"},{id:"PASAPORTE",nombre:"Pasaporte"},{id:"OTRO",nombre:"Otro"}],this.tiposRol=[{id:"1",nombre:"Contratista"},{id:"2",nombre:"Trabajador"}],this.areaprofesione=[{id:1,nombre:"TECNOLOGIA"},{id:2,nombre:"ABOGACIA"},{id:3,nombre:"ELECTRONICO"},{id:4,nombre:"CONSTRUCCION"},{id:5,nombre:"DISE\xd1O DIGITAL"},{id:6,nombre:"ALBA\xd1IL"},{id:7,nombre:"PLOMERO"},{id:8,nombre:"CLASES MATEMATICAS"},{id:9,nombre:"ELECTRICO"},{id:10,nombre:"CONTRATISTA"}],this.tiposContrato=[{id:1,nombre:"Por Dia"},{id:2,nombre:"Por Hora"},{id:3,nombre:"M\xe1s de 5 Dias"}],this.estadosContrato=[{id:"CONTRATADO",nombre:"CONTRATADO"},{id:"TERMINADO",nombre:"TERMINADO"},{id:"CANCELADO",nombre:"CANCELADO"}]}getTiposIdentificacion(){return this.tiposIdentificacion}getTiposRol(){return this.tiposRol}getAreProfesiones(){return this.areaprofesione}getTiposContrato(){return this.tiposContrato}getEstadosContrato(){return this.estadosContrato}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),CU=(()=>{class e{constructor(t){this.http=t,this.API_URL=Mh_urlApi}crearCalificacionContrato(t){return this.http.post(`${this.API_URL}/calificacion/crear`,t)}concultaCalificacionesContratante(t){return this.http.get(`${this.API_URL}/calificacion/${t}`)}concultaCalificacionesGeneral(){return this.http.get(`${this.API_URL}/calificacion/todos`)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function TU(e,n){if(1&e&&(Se(0,"option",20),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}const DU=function(e,n){return{"alert-success":e,"alert-danger":n}};function MU(e,n){if(1&e&&(Se(0,"div",21),rt(1),Ie()),2&e){const t=Ni();Gt("ngClass",function sD(e,n,t,r,l){return cD(vt(),hs(),e,n,t,r,l)}(2,DU,t.mensaje.includes("exito"),t.mensaje.includes("Error"))),st(1),da(" ",t.mensaje," ")}}let SU=(()=>{class e{constructor(t,r,l,f,y,C){this.navegacionService=t,this.router=r,this.route=l,this.contratoService=f,this.selectores=y,this.calificacionContratoService=C,this.contrato={id_usuario_contratante:0,id_usuario_trabajador:0,tipo_contrato:0,fecha_inicio:"",fecha_fin:"",descripcion:"",comentario:""},this.mensajeClass="",this.deshabilitaContratar=!1}guardarContrato(){this.mensaje="",this.contratoSubscription=this.contratoService.crearContrato(this.contrato).subscribe({next:t=>{this.mensaje="Contrato creado con exito:",console.log("respuesta ",t),console.log("respuesta :: ",t.id_contrato),this.deshabilitaContratar=!0,this.calificacionContratoService.crearCalificacionContrato({nivel_calificacion:0,comentario:"",id_usuario_trabajador:this.contrato.id_usuario_trabajador,id_contrato:t.id_contrato}).subscribe({next:l=>{console.log("Registro de Calificaion correcta ")},error:l=>{this.mensaje="Registro de Calificacion Presenta inconvenientes: ",console.log("Registro de Calificaion Presenta inconvenientes: ",l)}})},error:t=>{this.mensaje="Registro de Contrato Presenta inconvenientes: ",console.log("Registro de Contrato Presenta inconvenientes: ",t)}})}cancelarRegistro(){this.route.navigate(["/inicio"])}ngOnInit(){this.mensaje="",this.deshabilitaContratar=!1,this.tipoContrato=this.selectores.getTiposContrato(),this.router.params.subscribe(t=>{this.contrato.id_usuario_contratante=+t.idcontratante,this.contrato.id_usuario_trabajador=+t.idtrabajador,this.contrato.estado="CONTRATADO"}),this.contratoService.consultaContratoUsuario(this.contrato.id_usuario_trabajador).subscribe({next:t=>{t&&(this.mensaje="Error: El usuario tiene contrato vigente",this.deshabilitaContratar=!0)},error:t=>{console.log("Entro por error",t)}})}ngOnDestroy(){this.contratoSubscription&&this.contratoSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(et($I),et(Sd),et(Ls),et(_E),et(Mx),et(CU))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-contrato"]],decls:31,vars:9,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[1,"card","p-4",3,"ngSubmit"],["type","hidden","name","id_usuario_contratante",3,"ngModel","ngModelChange"],["type","hidden","name","id_usuario_trabajador",3,"ngModel","ngModelChange"],[1,"form-group","mb-3"],["for","tipo_contrato"],["name","tipo_contrato","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","fecha_inicio"],["type","date","name","fecha_inicio",1,"form-control",3,"ngModel","ngModelChange"],["for","fecha_fin"],["type","date","name","fecha_fin",1,"form-control",3,"ngModel","ngModelChange"],["for","descripcion"],["name","descripcion","placeholder","Descripci\xf3n",1,"form-control",3,"ngModel","ngModelChange"],["class","alert",3,"ngClass",4,"ngIf"],["type","submit",1,"btn","btn-primary","mb-3",3,"disabled"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],[3,"value"],[1,"alert",3,"ngClass"]],template:function(r,l){1&r&&(Se(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),rt(4,"Registro de Contrato"),Ie(),Se(5,"form",4),Sn("ngSubmit",function(){return l.guardarContrato()}),Se(6,"input",5),Sn("ngModelChange",function(y){return l.contrato.id_usuario_contratante=y}),Ie(),Se(7,"input",6),Sn("ngModelChange",function(y){return l.contrato.id_usuario_trabajador=y}),Ie(),Se(8,"div",7)(9,"label",8),rt(10,"Tipo de Contrato"),Ie(),Se(11,"select",9),Sn("ngModelChange",function(y){return l.contrato.tipo_contrato=y}),_i(12,TU,2,2,"option",10),Ie()(),Se(13,"div",7)(14,"label",11),rt(15,"Fecha de Inicio"),Ie(),Se(16,"input",12),Sn("ngModelChange",function(y){return l.contrato.fecha_inicio=y}),Ie()(),Se(17,"div",7)(18,"label",13),rt(19,"Fecha de Fin"),Ie(),Se(20,"input",14),Sn("ngModelChange",function(y){return l.contrato.fecha_fin=y}),Ie()(),Se(21,"div",7)(22,"label",15),rt(23,"Descripci\xf3n"),Ie(),Se(24,"textarea",16),Sn("ngModelChange",function(y){return l.contrato.descripcion=y}),Ie()(),Se(25,"div",7),_i(26,MU,2,5,"div",17),Ie(),Se(27,"button",18),rt(28,"Genera Contrato"),Ie(),Se(29,"button",19),Sn("click",function(){return l.cancelarRegistro()}),rt(30,"Cancelar"),Ie()()()()()),2&r&&(st(6),Gt("ngModel",l.contrato.id_usuario_contratante),st(1),Gt("ngModel",l.contrato.id_usuario_trabajador),st(4),Gt("ngModel",l.contrato.tipo_contrato),st(1),Gt("ngForOf",l.tipoContrato),st(4),Gt("ngModel",l.contrato.fecha_inicio),st(4),Gt("ngModel",l.contrato.fecha_fin),st(4),Gt("ngModel",l.contrato.descripcion),st(2),Gt("ngIf",l.mensaje),st(1),Gt("disabled",l.deshabilitaContratar))},dependencies:[a1,Jf,Eh,eg,tg,ng,Ih,Fd,Od,Jm,ap,Nd,op]})}return e})();function qA(e,n,t,r,l,f,y){try{var C=e[f](y),D=C.value}catch(O){return void t(O)}C.done?n(D):Promise.resolve(D).then(r,l)}function ZA(e){return function(){var n=this,t=arguments;return new Promise(function(r,l){var f=e.apply(n,t);function y(D){qA(f,r,l,y,C,"next",D)}function C(D){qA(f,r,l,y,C,"throw",D)}y(void 0)})}}var ig=_e(574),IU=_e(904);let AU=(()=>{class e{constructor(t){this.httpClient=t,this.cbAddres=new s,this.mapbox=ig,this.map=null,this.style="mapbox://styles/mapbox/streets-v12",this.lat=-2.275817,this.lng=-79.875993,this.zoom=14,this.wayPoint=[],this.markerDriver=null,this.mapbox.accessToken="pk.eyJ1IjoiY3ZpbGVsYTE5NzkiLCJhIjoiY2xuYWljM2x2MDJ6bTJzbzF1bzhxOWM1aiJ9.L8Me7xG665eiS43VvjW03A",console.log("constructor ###################### evento: ")}buildMap(t,r){return new Promise((l,f)=>{try{console.log("buildMap ###################### evento: "),this.lng=Number(t),this.lat=Number(r),console.log("buildMap valores iniciales lat: ",this.lat),console.log("buildMap valores iniciales lng: ",this.lng),this.map=new ig.Map({container:"map",style:this.style,zoom:this.zoom,center:[this.lat,this.lng]});const y=new IU({accessToken:ig.accessToken,mapboxgl:ig});y.on("result",C=>{const{result:D}=C,O=C.result.geometry.coordinates;console.log("###################### evento result: ",C.result),console.log("###################### evento coordinates: "+O),console.log("### Coord 0 Seleccionada: "+O[0]),console.log("### Coord 1 Seleccionada: "+O[1]),console.log("###################### evento capturado: "+D),this.lat=O[0],this.lng=O[1],y.clear(),console.log("### Evento this.lat: "+this.lat),console.log("### Evento this.lng: "+this.lng),this.marker.setLngLat([Number(this.lat),Number(this.lng)]),this.cbAddres.emit(D)}),console.log("****** lat:",this.lat),console.log("****** lng:",this.lng),this.marker=new ig.Marker({draggable:!0}).setLngLat([Number(this.lat),Number(this.lng)]).addTo(this.map),this.marker.on("dragend",()=>{const C=this.marker.getLngLat();console.log("Marker arrastrado a: ",C),this.cbAddres.emit({geometry:{coordinates:[C.lng,C.lat]}})}),l({map:this.map,geocoder:y})}catch(y){f(y)}})}addMarkerCustom(t){console.log("addMarkerCustom -----\x3e",t);const r=document.createElement("div");r.className="marker",this.markerDriver?this.markerDriver.setLngLat(t).addTo(this.map):this.markerDriver=new ig.Marker(r)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Ad))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Mu=Object.create(null);Mu.open="0",Mu.close="1",Mu.ping="2",Mu.pong="3",Mu.message="4",Mu.upgrade="5",Mu.noop="6";const Sx=Object.create(null);Object.keys(Mu).forEach(e=>{Sx[Mu[e]]=e});const yE={type:"error",data:"parser error"},WA="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),XA="function"==typeof ArrayBuffer,YA=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,vE=({type:e,data:n},t,r)=>WA&&n instanceof Blob?t?r(n):KA(n,r):XA&&(n instanceof ArrayBuffer||YA(n))?t?r(n):KA(new Blob([n]),r):r(Mu[e]+(n||"")),KA=(e,n)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];n("b"+(r||""))},t.readAsDataURL(e)};function JA(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let xE;const My=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<64;e++)My["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const LU="function"==typeof ArrayBuffer,bE=(e,n)=>{if("string"!=typeof e)return{type:"message",data:QA(e,n)};const t=e.charAt(0);return"b"===t?{type:"message",data:kU(e.substring(1),n)}:Sx[t]?e.length>1?{type:Sx[t],data:e.substring(1)}:{type:Sx[t]}:yE},kU=(e,n)=>{if(LU){const t=(e=>{let r,f,y,C,D,n=.75*e.length,t=e.length,l=0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);const O=new ArrayBuffer(n),$=new Uint8Array(O);for(r=0;r<t;r+=4)f=My[e.charCodeAt(r)],y=My[e.charCodeAt(r+1)],C=My[e.charCodeAt(r+2)],D=My[e.charCodeAt(r+3)],$[l++]=f<<2|y>>4,$[l++]=(15&y)<<4|C>>2,$[l++]=(3&C)<<6|63&D;return O})(e);return QA(t,n)}return{base64:!0,data:e}},QA=(e,n)=>"blob"===n?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,e2=String.fromCharCode(30);let wE;function Ix(e){return e.reduce((n,t)=>n+t.length,0)}function Ax(e,n){if(e[0].length===n)return e.shift();const t=new Uint8Array(n);let r=0;for(let l=0;l<n;l++)t[l]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),t}function Io(e){if(e)return function BU(e){for(var n in Io.prototype)e[n]=Io.prototype[n];return e}(e)}Io.prototype.on=Io.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(n),this},Io.prototype.once=function(e,n){function t(){this.off(e,t),n.apply(this,arguments)}return t.fn=n,this.on(e,t),this},Io.prototype.off=Io.prototype.removeListener=Io.prototype.removeAllListeners=Io.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+e];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,l=0;l<t.length;l++)if((r=t[l])===n||r.fn===n){t.splice(l,1);break}return 0===t.length&&delete this._callbacks["$"+e],this},Io.prototype.emitReserved=Io.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),t=this._callbacks["$"+e],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(t){r=0;for(var l=(t=t.slice(0)).length;r<l;++r)t[r].apply(this,n)}return this},Io.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Io.prototype.hasListeners=function(e){return!!this.listeners(e).length};const oc=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function n2(e,...n){return n.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const VU=oc.setTimeout,UU=oc.clearTimeout;function Px(e,n){n.useNativeTimers?(e.setTimeoutFn=VU.bind(oc),e.clearTimeoutFn=UU.bind(oc)):(e.setTimeoutFn=oc.setTimeout.bind(oc),e.clearTimeoutFn=oc.clearTimeout.bind(oc))}function $U(e){return"string"==typeof e?function HU(e){let n=0,t=0;for(let r=0,l=e.length;r<l;r++)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:n<55296||n>=57344?t+=3:(r++,t+=4);return t}(e):Math.ceil(1.33*(e.byteLength||e.size))}class ZU extends Error{constructor(n,t,r){super(n),this.description=t,this.context=r,this.type="TransportError"}}class EE extends Io{constructor(n){super(),this.writable=!1,Px(this,n),this.opts=n,this.query=n.query,this.socket=n.socket}onError(n,t,r){return super.emitReserved("error",new ZU(n,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(n){"open"===this.readyState&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const t=bE(n,this.socket.binaryType);this.onPacket(t)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,t={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const n=this.opts.hostname;return-1===n.indexOf(":")?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(n){const t=function GU(e){let n="";for(let t in e)e.hasOwnProperty(t)&&(n.length&&(n+="&"),n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n}(n);return t.length?"?"+t:""}}const i2="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Rx=64,r2={};let s2,o2=0,zd=0;function a2(e){let n="";do{n=i2[e%Rx]+n,e=Math.floor(e/Rx)}while(e>0);return n}function l2(){const e=a2(+new Date);return e!==s2?(o2=0,s2=e):e+"."+a2(o2++)}for(;zd<Rx;zd++)r2[i2[zd]]=zd;let c2=!1;try{c2=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const WU=c2;function u2(e){const n=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||WU))return new XMLHttpRequest}catch{}if(!n)try{return new(oc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function XU(){}const YU=null!=new u2({xdomain:!1}).responseType;let Lx=(()=>{class e extends Io{constructor(t,r){super(),Px(this,r),this.opts=r,this.method=r.method||"GET",this.uri=t,this.data=void 0!==r.data?r.data:null,this.create()}create(){var t;const r=n2(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;const l=this.xhr=new u2(r);try{l.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let f in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(f)&&l.setRequestHeader(f,this.opts.extraHeaders[f])}}catch{}if("POST"===this.method)try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(l),"withCredentials"in l&&(l.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(l.timeout=this.opts.requestTimeout),l.onreadystatechange=()=>{var f;3===l.readyState&&(null===(f=this.opts.cookieJar)||void 0===f||f.parseCookies(l)),4===l.readyState&&(200===l.status||1223===l.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof l.status?l.status:0)},0))},l.send(this.data)}catch(f){return void this.setTimeoutFn(()=>{this.onError(f)},0)}typeof document<"u"&&(this.index=e.requestsCount++,e.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=XU,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete e.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return e.requestsCount=0,e.requests={},e})();function h2(){for(let e in Lx.requests)Lx.requests.hasOwnProperty(e)&&Lx.requests[e].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",h2):"function"==typeof addEventListener&&addEventListener("onpagehide"in oc?"pagehide":"unload",h2,!1));const CE="function"==typeof Promise&&"function"==typeof Promise.resolve?n=>Promise.resolve().then(n):(n,t)=>t(n,0),kx=oc.WebSocket||oc.MozWebSocket,d2=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),tj={websocket:class QU extends EE{constructor(n){super(n),this.supportsBinary=!n.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const n=this.uri(),t=this.opts.protocols,r=d2?{}:n2(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=d2?new kx(n,t,r):t?new kx(n,t):new kx(n)}catch(l){return this.emitReserved("error",l)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const l=t===n.length-1;vE(n[t],this.supportsBinary,f=>{try{this.ws.send(f)}catch{}l&&CE(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=l2()),this.supportsBinary||(t.b64=1),this.createUri(n,t)}check(){return!!kx}},webtransport:class ej extends EE{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(n=>{const t=function zU(e,n){wE||(wE=new TextDecoder);const t=[];let r=0,l=-1,f=!1;return new TransformStream({transform(y,C){for(t.push(y);;){if(0===r){if(Ix(t)<1)break;const D=Ax(t,1);f=128==(128&D[0]),l=127&D[0],r=l<126?3:126===l?1:2}else if(1===r){if(Ix(t)<2)break;const D=Ax(t,2);l=new DataView(D.buffer,D.byteOffset,D.length).getUint16(0),r=3}else if(2===r){if(Ix(t)<8)break;const D=Ax(t,8),O=new DataView(D.buffer,D.byteOffset,D.length),$=O.getUint32(0);if($>Math.pow(2,21)-1){C.enqueue(yE);break}l=$*Math.pow(2,32)+O.getUint32(4),r=3}else{if(Ix(t)<l)break;const D=Ax(t,l);C.enqueue(bE(f?D:wE.decode(D),n)),r=0}if(0===l||l>e){C.enqueue(yE);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=n.readable.pipeThrough(t).getReader(),l=function FU(){return new TransformStream({transform(e,n){!function PU(e,n){WA&&e.data instanceof Blob?e.data.arrayBuffer().then(JA).then(n):XA&&(e.data instanceof ArrayBuffer||YA(e.data))?n(JA(e.data)):vE(e,!1,t=>{xE||(xE=new TextEncoder),n(xE.encode(t))})}(e,t=>{const r=t.length;let l;if(r<126)l=new Uint8Array(1),new DataView(l.buffer).setUint8(0,r);else if(r<65536){l=new Uint8Array(3);const f=new DataView(l.buffer);f.setUint8(0,126),f.setUint16(1,r)}else{l=new Uint8Array(9);const f=new DataView(l.buffer);f.setUint8(0,127),f.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(l[0]|=128),n.enqueue(l),n.enqueue(t)})}})}();l.readable.pipeTo(n.writable),this.writer=l.writable.getWriter();const f=()=>{r.read().then(({done:C,value:D})=>{C||(this.onPacket(D),f())}).catch(C=>{})};f();const y={type:"open"};this.query.sid&&(y.data=`{"sid":"${this.query.sid}"}`),this.writer.write(y).then(()=>this.onOpen())})}))}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const l=t===n.length-1;this.writer.write(n[t]).then(()=>{l&&CE(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;null===(n=this.transport)||void 0===n||n.close()}},polling:class KU extends EE{constructor(n){if(super(n),this.polling=!1,typeof location<"u"){const r="https:"===location.protocol;let l=location.port;l||(l=r?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||l!==n.port}this.supportsBinary=YU&&!(n&&n.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(n){this.readyState="pausing";const t=()=>{this.readyState="paused",n()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){((e,n)=>{const t=e.split(e2),r=[];for(let l=0;l<t.length;l++){const f=bE(t[l],n);if(r.push(f),"error"===f.type)break}return r})(n,this.socket.binaryType).forEach(r=>{if("opening"===this.readyState&&"open"===r.type&&this.onOpen(),"close"===r.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const n=()=>{this.write([{type:"close"}])};"open"===this.readyState?n():this.once("open",n)}write(n){this.writable=!1,((e,n)=>{const t=e.length,r=new Array(t);let l=0;e.forEach((f,y)=>{vE(f,!1,C=>{r[y]=C,++l===t&&n(r.join(e2))})})})(n,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=l2()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(n,t)}request(n={}){return Object.assign(n,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Lx(this.uri(),n)}doWrite(n,t){const r=this.request({method:"POST",data:n});r.on("success",t),r.on("error",(l,f)=>{this.onError("xhr post error",l,f)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=n}}},nj=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ij=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function DE(e){const n=e,t=e.indexOf("["),r=e.indexOf("]");-1!=t&&-1!=r&&(e=e.substring(0,t)+e.substring(t,r).replace(/:/g,";")+e.substring(r,e.length));let l=nj.exec(e||""),f={},y=14;for(;y--;)f[ij[y]]=l[y]||"";return-1!=t&&-1!=r&&(f.source=n,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=function rj(e,n){const r=n.replace(/\/{2,9}/g,"/").split("/");return("/"==n.slice(0,1)||0===n.length)&&r.splice(0,1),"/"==n.slice(-1)&&r.splice(r.length-1,1),r}(0,f.path),f.queryKey=function oj(e,n){const t={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,l,f){l&&(t[l]=f)}),t}(0,f.query),f}let f2=(()=>{class e extends Io{constructor(t,r={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(r=t,t=null),t?(t=DE(t),r.hostname=t.host,r.secure="https"===t.protocol||"wss"===t.protocol,r.port=t.port,t.query&&(r.query=t.query)):r.host&&(r.hostname=DE(r.host).host),Px(this,r),this.secure=null!=r.secure?r.secure:typeof location<"u"&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=r.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function qU(e){let n={},t=e.split("&");for(let r=0,l=t.length;r<l;r++){let f=t[r].split("=");n[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return n}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=4,r.transport=t,this.id&&(r.sid=this.id);const l=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new tj[t](l)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch{return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",r=>this.onClose("transport close",r))}probe(t){let r=this.createTransport(t),l=!1;e.priorWebsocketSuccess=!1;const f=()=>{l||(r.send([{type:"ping",data:"probe"}]),r.once("packet",oe=>{if(!l)if("pong"===oe.type&&"probe"===oe.data){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;e.priorWebsocketSuccess="websocket"===r.name,this.transport.pause(()=>{l||"closed"!==this.readyState&&(W(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const ve=new Error("probe error");ve.transport=r.name,this.emitReserved("upgradeError",ve)}}))};function y(){l||(l=!0,W(),r.close(),r=null)}const C=oe=>{const ve=new Error("probe error: "+oe);ve.transport=r.name,y(),this.emitReserved("upgradeError",ve)};function D(){C("transport closed")}function O(){C("socket closed")}function $(oe){r&&oe.name!==r.name&&y()}const W=()=>{r.removeListener("open",f),r.removeListener("error",C),r.removeListener("close",D),this.off("close",O),this.off("upgrading",$)};r.once("open",f),r.once("error",C),r.once("close",D),this.once("close",O),this.once("upgrading",$),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn(()=>{l||r.open()},200):r.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const r=this.upgrades.length;for(;t<r;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const r=new Error("server error");r.code=t.data,this.onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let l=0;l<this.writeBuffer.length;l++){const f=this.writeBuffer[l].data;if(f&&(r+=$U(f)),l>0&&r>this.maxPayload)return this.writeBuffer.slice(0,l);r+=2}return this.writeBuffer}write(t,r,l){return this.sendPacket("message",t,r,l),this}send(t,r,l){return this.sendPacket("message",t,r,l),this}sendPacket(t,r,l,f){if("function"==typeof r&&(f=r,r=void 0),"function"==typeof l&&(f=l,l=null),"closing"===this.readyState||"closed"===this.readyState)return;(l=l||{}).compress=!1!==l.compress;const y={type:t,data:r,options:l};this.emitReserved("packetCreate",y),this.writeBuffer.push(y),f&&this.once("flush",f),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},l=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():t()}):this.upgrading?l():t()),this}onError(t){e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,r){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const r=[];let l=0;const f=t.length;for(;l<f;l++)~this.transports.indexOf(t[l])&&r.push(t[l]);return r}}return e.protocol=4,e})();const aj="function"==typeof ArrayBuffer,lj=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,p2=Object.prototype.toString,cj="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===p2.call(Blob),uj="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===p2.call(File);function ME(e){return aj&&(e instanceof ArrayBuffer||lj(e))||cj&&e instanceof Blob||uj&&e instanceof File}function Ox(e,n){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Ox(e[t]))return!0;return!1}if(ME(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Ox(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Ox(e[t]))return!0;return!1}function hj(e){const n=[],r=e;return r.data=SE(e.data,n),r.attachments=n.length,{packet:r,buffers:n}}function SE(e,n){if(!e)return e;if(ME(e)){const t={_placeholder:!0,num:n.length};return n.push(e),t}if(Array.isArray(e)){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=SE(e[r],n);return t}if("object"==typeof e&&!(e instanceof Date)){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=SE(e[r],n));return t}return e}function dj(e,n){return e.data=IE(e.data,n),delete e.attachments,e}function IE(e,n){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<n.length)return n[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=IE(e[t],n);else if("object"==typeof e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=IE(e[t],n));return e}const fj=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],m2=5;var Fi=function(e){return e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK",e}(Fi||{});class pj{constructor(n){this.replacer=n}encode(n){return n.type!==Fi.EVENT&&n.type!==Fi.ACK||!Ox(n)?[this.encodeAsString(n)]:this.encodeAsBinary({type:n.type===Fi.EVENT?Fi.BINARY_EVENT:Fi.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id})}encodeAsString(n){let t=""+n.type;return(n.type===Fi.BINARY_EVENT||n.type===Fi.BINARY_ACK)&&(t+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(t+=n.nsp+","),null!=n.id&&(t+=n.id),null!=n.data&&(t+=JSON.stringify(n.data,this.replacer)),t}encodeAsBinary(n){const t=hj(n),r=this.encodeAsString(t.packet),l=t.buffers;return l.unshift(r),l}}function g2(e){return"[object Object]"===Object.prototype.toString.call(e)}class AE extends Io{constructor(n){super(),this.reviver=n}add(n){let t;if("string"==typeof n){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(n);const r=t.type===Fi.BINARY_EVENT;r||t.type===Fi.BINARY_ACK?(t.type=r?Fi.EVENT:Fi.ACK,this.reconstructor=new mj(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ME(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(n),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(n){let t=0;const r={type:Number(n.charAt(0))};if(void 0===Fi[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Fi.BINARY_EVENT||r.type===Fi.BINARY_ACK){const f=t+1;for(;"-"!==n.charAt(++t)&&t!=n.length;);const y=n.substring(f,t);if(y!=Number(y)||"-"!==n.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(y)}if("/"===n.charAt(t+1)){const f=t+1;for(;++t&&","!==n.charAt(t)&&t!==n.length;);r.nsp=n.substring(f,t)}else r.nsp="/";const l=n.charAt(t+1);if(""!==l&&Number(l)==l){const f=t+1;for(;++t;){const y=n.charAt(t);if(null==y||Number(y)!=y){--t;break}if(t===n.length)break}r.id=Number(n.substring(f,t+1))}if(n.charAt(++t)){const f=this.tryParse(n.substr(t));if(!AE.isPayloadValid(r.type,f))throw new Error("invalid payload");r.data=f}return r}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,t){switch(n){case Fi.CONNECT:return g2(t);case Fi.DISCONNECT:return void 0===t;case Fi.CONNECT_ERROR:return"string"==typeof t||g2(t);case Fi.EVENT:case Fi.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===fj.indexOf(t[0]));case Fi.ACK:case Fi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class mj{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const t=dj(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function $c(e,n,t){return e.on(n,t),function(){e.off(n,t)}}const gj=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class PE extends Io{constructor(n,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[$c(n,"open",this.onopen.bind(this)),$c(n,"packet",this.onpacket.bind(this)),$c(n,"error",this.onerror.bind(this)),$c(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...t){if(gj.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(t.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Fi.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const y=this.ids++,C=t.pop();this._registerAckCallback(y,C),r.id=y}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(n,t){var r;const l=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===l)return void(this.acks[n]=t);const f=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let y=0;y<this.sendBuffer.length;y++)this.sendBuffer[y].id===n&&this.sendBuffer.splice(y,1);t.call(this,new Error("operation has timed out"))},l);this.acks[n]=(...y)=>{this.io.clearTimeoutFn(f),t.apply(this,[null,...y])}}emitWithAck(n,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((l,f)=>{t.push((y,C)=>r?y?f(y):l(C):l(y)),this.emit(n,...t)})}_addToQueue(n){let t;"function"==typeof n[n.length-1]&&(t=n.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((l,...f)=>r!==this._queue[0]?void 0:(null!==l?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(l)):(this._queue.shift(),t&&t(null,...f)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!n||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){"function"==typeof this.auth?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:Fi.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,t)}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case Fi.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Fi.EVENT:case Fi.BINARY_EVENT:this.onevent(n);break;case Fi.ACK:case Fi.BINARY_ACK:this.onack(n);break;case Fi.DISCONNECT:this.ondisconnect();break;case Fi.CONNECT_ERROR:this.destroy();const r=new Error(n.data.message);r.data=n.data.data,this.emitReserved("connect_error",r)}}onevent(n){const t=n.data||[];null!=n.id&&t.push(this.ack(n.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&"string"==typeof n[n.length-1]&&(this._lastOffset=n[n.length-1])}ack(n){const t=this;let r=!1;return function(...l){r||(r=!0,t.packet({type:Fi.ACK,id:n,data:l}))}}onack(n){const t=this.acks[n.id];"function"==typeof t&&(t.apply(this,n.data),delete this.acks[n.id])}onconnect(n,t){this.id=n,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Fi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,n.data)}}}function og(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}og.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),t=Math.floor(n*this.jitter*e);e=1&Math.floor(10*n)?e+t:e-t}return 0|Math.min(e,this.max)},og.prototype.reset=function(){this.attempts=0},og.prototype.setMin=function(e){this.ms=e},og.prototype.setMax=function(e){this.max=e},og.prototype.setJitter=function(e){this.jitter=e};class Nx extends Io{constructor(n,t){var r;super(),this.nsps={},this.subs=[],n&&"object"==typeof n&&(t=n,n=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Px(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new og({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=n;const l=t.parser||gt;this.encoder=new l.Encoder,this.decoder=new l.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection}reconnectionAttempts(n){return void 0===n?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var t;return void 0===n?this._reconnectionDelay:(this._reconnectionDelay=n,null===(t=this.backoff)||void 0===t||t.setMin(n),this)}randomizationFactor(n){var t;return void 0===n?this._randomizationFactor:(this._randomizationFactor=n,null===(t=this.backoff)||void 0===t||t.setJitter(n),this)}reconnectionDelayMax(n){var t;return void 0===n?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,null===(t=this.backoff)||void 0===t||t.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new f2(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const l=$c(t,"open",function(){r.onopen(),n&&n()}),f=C=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",C),n?n(C):this.maybeReconnectOnOpen()},y=$c(t,"error",f);if(!1!==this._timeout){const D=this.setTimeoutFn(()=>{l(),f(new Error("timeout")),t.close()},this._timeout);this.opts.autoUnref&&D.unref(),this.subs.push(()=>{this.clearTimeoutFn(D)})}return this.subs.push(l),this.subs.push(y),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push($c(n,"ping",this.onping.bind(this)),$c(n,"data",this.ondata.bind(this)),$c(n,"error",this.onerror.bind(this)),$c(n,"close",this.onclose.bind(this)),$c(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(t){this.onclose("parse error",t)}}ondecoded(n){CE(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,t){let r=this.nsps[n];return r?this._autoConnect&&!r.active&&r.connect():(r=new PE(this,n,t),this.nsps[n]=r),r}_destroy(n){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(n){const t=this.encoder.encode(n);for(let r=0;r<t.length;r++)this.engine.write(t[r],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(n,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(l=>{l?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",l)):n.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}}const Sy={};function Bd(e,n){"object"==typeof e&&(n=e,e=void 0);const t=function sj(e,n="",t){let r=e;t=t||typeof location<"u"&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(e=typeof t<"u"?t.protocol+"//"+e:"https://"+e),r=DE(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const f=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+f+":"+r.port+n,r.href=r.protocol+"://"+f+(t&&t.port===r.port?"":":"+r.port),r}(e,(n=n||{}).path||"/socket.io"),r=t.source,l=t.id;let D;return n.forceNew||n["force new connection"]||!1===n.multiplex||Sy[l]&&t.path in Sy[l].nsps?D=new Nx(r,n):(Sy[l]||(Sy[l]=new Nx(r,n)),D=Sy[l]),t.query&&!n.query&&(n.query=t.queryKey),D.socket(t.path,n)}Object.assign(Bd,{Manager:Nx,Socket:PE,io:Bd,connect:Bd});class RE{constructor(n){this.config=n,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===n&&(n=this.emptyConfig),this.ioSocket=(Bd||Ve)(n.url,n.options)}of(n){this.ioSocket.of(n)}on(n,t){this.ioSocket.on(n,t)}once(n,t){this.ioSocket.once(n,t)}connect(){return this.ioSocket.connect()}disconnect(n){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(n,...t){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(n,t){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(n){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(n){return this.subscribersCounter[n]||(this.subscribersCounter[n]=0),this.subscribersCounter[n]++,this.eventObservables$[n]||(this.eventObservables$[n]=new In(t=>{const r=l=>{t.next(l)};return this.ioSocket.on(n,r),()=>{this.subscribersCounter[n]--,0===this.subscribersCounter[n]&&(this.ioSocket.removeListener(n,r),delete this.eventObservables$[n])}}).pipe(or())),this.eventObservables$[n]}fromOneTimeEvent(n){return new Promise(t=>this.once(n,t))}listeners(n){return this.ioSocket.listeners(n)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(n,t){return n?n&&!t?this.ioSocket.off(n):this.ioSocket.off(n,t):this.ioSocket.offAny()}onAny(n){return this.ioSocket.onAny(n)}onAnyOutgoing(n){return this.ioSocket.onAnyOutgoing(n)}prependAny(n){return this.ioSocket.prependAny(n)}prependAnyOutgoing(n){return this.ioSocket.prependAnyOutgoing(n)}timeout(n){return this.ioSocket.timeout(n)}volatile(){return this.ioSocket.volatile}}function _j(e){return new RE(e)}const _2=new Xt("__SOCKET_IO_CONFIG__");let yj=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[{provide:_2,useValue:t},{provide:RE,useFactory:_j,deps:[_2]}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Nn({type:e}),e.\u0275inj=Nr({}),e})();const vj=["asGeoCoder"];function xj(e,n){1&e&&(Se(0,"div",17),rt(1," La descripci\xf3n es requerida. "),Ie())}function bj(e,n){1&e&&(Se(0,"div",17),rt(1," Descripci\xf3n con caracteres no permitidos "),Ie())}function wj(e,n){1&e&&(Se(0,"div",17),rt(1," Tel\xe9fono es requerido. "),Ie())}function Ej(e,n){1&e&&(Se(0,"div",17),rt(1," Tel\xe9fono inv\xe1lido, ingrese solo n\xfameros. "),Ie())}const Cj=function(e,n,t){return{"alert-success":e,"alert-danger":n,"fade-out":t}};function Tj(e,n){if(1&e&&(Se(0,"div",18),rt(1),Ie()),2&e){const t=Ni();Gt("ngClass",aD(2,Cj,t.mensaje.includes("\xe9xito"),t.mensaje.includes("Error"),"fade-out"===t.mensajeClass)),st(1),da(" ",t.mensaje," ")}}const Dj=function(e){return{"active-way":e}};let Mj=(()=>{class e{constructor(t,r,l,f,y){this.mapCustonService=t,this.renderer2=r,this.socket=l,this.ubicacionService=f,this.usuarioServicio=y,this.modeInput="start",this.wayPoints={start:null,end:null},this.mensajeClass="",this.ubicacion={identificacion_usuario:"",telefono:"",latitud:"",longitud:"",estado:"",descripcion:""}}ngOnInit(){this.usuarioServicio.userEmail$.subscribe(l=>{this.usuarioServicio.usuarioLoginOn&&(this.email=l)}),this.ubicacionService.obtenerUbicacionUsuarioPorEmail(this.email).subscribe({next:l=>{l?(this.ubicacion=l,this.mapCustonService.buildMap(this.ubicacion.latitud,this.ubicacion.longitud).then(({geocoder:f,map:y})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,f.onAdd(y))}).catch(f=>{console.log("***** ERROR ****",f)})):(this.usuarioServicio.userIdentificacion$.subscribe(f=>{this.ubicacion.identificacion_usuario=f}),this.mapCustonService.buildMap("41.398176","2.170946").then(({geocoder:f,map:y})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,f.onAdd(y))}).catch(f=>{console.log("***** ERROR ****",f)}))},error:l=>{console.log("UBICACION ::: algo paso :( ",l)}}),this.mapCustonService.cbAddres.subscribe(l=>{"start"===this.modeInput&&(this.wayPoints.start=l,this.ubicacion.longitud=this.wayPoints.start.geometry.coordinates[0],this.ubicacion.latitud=this.wayPoints.start.geometry.coordinates[1])}),this.socket.fromEvent("position").subscribe(({coords:l})=>{this.mapCustonService.addMarkerCustom(l)})}changeMode(t){this.modeInput=t}actualizaUbicacion(){var t=this;return ZA(function*(){t.mensaje="",t.mensajeClass="",t.ubicacionService.guardaActualizaUbicacion(t.ubicacion).subscribe({next:r=>{t.mensaje="Guardado con \xe9xito",t.ocultarMensajeSegunTiempo()},error:r=>{console.error("Error al guardar ubicaciones:",r),t.mensaje="Presentamos inconvenientes: "+r,t.ocultarMensajeSegunTiempo()}})})()}ocultarMensajeSegunTiempo(){setTimeout(()=>{this.mensaje="",this.mensajeClass="fade-out"},5e3),setTimeout(()=>{this.mensajeClass="fade-out"},3e3)}static#e=this.\u0275fac=function(r){return new(r||e)(et(AU),et(qa),et(RE),et(UI),et(Sh))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-trabajador"]],viewQuery:function(r,l){if(1&r&&CD(vj,5),2&r){let f;Tw(f=function Dw(){return function uk(e,n){return e[Wi].queries[n].queryList}(vt(),Hh())}())&&(l.asGeoCoder=f.first)}},decls:43,vars:14,consts:[[1,"text-center"],[1,"wrapper"],[1,"box-inputs"],["id","geocoder",1,"geocoder"],["asGeoCoder",""],[3,"ngClass","click"],[1,"mock-label"],[1,"mock-input"],["type","text","pattern","^[a-zA-Z0-9.,;'\\s\xf1\xd1]*$","maxlength","200","required","true","placeholder","Ingresa una descripci\xf3n",1,"mock-input","form-control",3,"ngModel","ngModelChange"],["descripcion","ngModel"],["class","alert alert-danger",4,"ngIf"],["type","tel","pattern","[0-9]*","maxlength","15","required","true","placeholder","Ingresa un n\xfamero de tel\xe9fono",1,"mock-input","form-control",3,"ngModel","ngModelChange"],["telefono","ngModel"],["class","alert",3,"ngClass",4,"ngIf"],["id","map",1,"map-container-trabajador"],["asMap",""],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[1,"alert",3,"ngClass"]],template:function(r,l){if(1&r&&(Se(0,"h1",0),rt(1,"Actualice Datos de Ubicaci\xf3n"),Ie(),Se(2,"div",1)(3,"div",2)(4,"div"),wo(5,"div",3,4),Ie(),Se(7,"div",5),Sn("click",function(){return l.changeMode("start")}),Se(8,"div",6),rt(9,"Ubicaci\xf3n"),Ie(),Se(10,"div",7),rt(11),Ie()(),Se(12,"div")(13,"div",6),rt(14,"Longitud"),Ie(),Se(15,"div",7),rt(16),Ie()(),Se(17,"div")(18,"div",6),rt(19,"Latitud"),Ie(),Se(20,"div",7),rt(21),Ie()(),Se(22,"div")(23,"div",6),rt(24,"Descripci\xf3n del Lugar"),Ie(),Se(25,"textarea",8,9),Sn("ngModelChange",function(y){return l.ubicacion.descripcion=y}),Ie(),_i(27,xj,2,0,"div",10),_i(28,bj,2,0,"div",10),Ie(),Se(29,"div")(30,"div",6),rt(31,"Tel\xe9fono de Ubicaci\xf3n"),Ie(),Se(32,"input",11,12),Sn("ngModelChange",function(y){return l.ubicacion.telefono=y}),Ie(),_i(34,wj,2,0,"div",10),_i(35,Ej,2,0,"div",10),_i(36,Tj,2,6,"div",13),Ie()()(),Se(37,"div",1),wo(38,"div",14,15),Ie(),Se(40,"div",0)(41,"button",16),Sn("click",function(){return l.actualizaUbicacion()}),rt(42,"Guardar"),Ie()()),2&r){const f=Yb(26),y=Yb(33);st(7),Gt("ngClass",_w(12,Dj,"start"===l.modeInput)),st(4),Xi(null==l.wayPoints.start?null:l.wayPoints.start.place_name),st(5),Xi(l.ubicacion.longitud),st(5),Xi(l.ubicacion.latitud),st(4),Gt("ngModel",l.ubicacion.descripcion),st(2),Gt("ngIf",(null==f.errors?null:f.errors.required)&&(f.dirty||f.touched)),st(1),Gt("ngIf",(null==f.errors?null:f.errors.pattern)&&(f.dirty||f.touched)),st(4),Gt("ngModel",l.ubicacion.telefono),st(2),Gt("ngIf",(null==y.errors?null:y.errors.required)&&(y.dirty||y.touched)),st(1),Gt("ngIf",(null==y.errors?null:y.errors.pattern)&&(y.dirty||y.touched)),st(1),Gt("ngIf",l.mensaje),st(5),Gt("disabled",f.invalid||y.invalid)}},dependencies:[a1,Eh,Ih,Od,ap,mE,gE,Nd],styles:[".map-container-trabajador[_ngcontent-%COMP%]{width:52%;height:500px;border-radius:1rem;border:solid 10px white;box-shadow:0 12.5px 10px #00000009,0 100px 80px #00000012}.marker[_ngcontent-%COMP%]{width:50px;height:50px;background-image:url(maps-and-location.1cc4b9a453b3e1ef.png);background-size:contain;background-repeat:no-repeat;background-position:center}.box-inputs[_ngcontent-%COMP%]{background-color:#fff;width:52%;border-radius:.5rem;border:solid 2px #00000008;padding:1rem;box-shadow:0 12.5px 10px #00000009,0 100px 80px #00000012}.mock-input[_ngcontent-%COMP%]{width:100%;background:white;padding:.5rem;margin-bottom:.5rem;box-shadow:0 0 10px #0000001a;color:gray;min-height:18px}.mock-label[_ngcontent-%COMP%]{padding:.25rem;font-weight:600}.geocoder[_ngcontent-%COMP%]{margin-bottom:.5rem}.active-way[_ngcontent-%COMP%]{border:solid 2px #09c509;box-shadow:0 0 10px #09c5094a}.btn-route[_ngcontent-%COMP%]{background-color:#fff;padding:.5rem 1rem;border:solid 2px gray}.wrapper[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:center}.fade-out[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOut 2s;-webkit-animation:_ngcontent-%COMP%_fadeOut 2s}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1}to{opacity:0}}"]})}return e})();function Sj(e,n){if(1&e){const t=Pm();Se(0,"tr")(1,"td"),rt(2),Ie(),Se(3,"td"),rt(4),Ie(),Se(5,"td"),rt(6),Ie(),Se(7,"td"),rt(8),Ie(),Se(9,"td")(10,"button",11),Sn("click",function(){const f=Qi(t).$implicit;return er(Ni(2).editarPerfil(f.id_perfil))}),rt(11,"Editar"),Ie()()()}if(2&e){const t=n.$implicit,r=Ni(2);st(2),Xi(t.id_usuario),st(2),Xi(r.getProfesionDescripcion(t.profesion)),st(2),Xi(t.tiempo_experiencia),st(2),Xi(t.introduccion)}}function Ij(e,n){if(1&e){const t=Pm();Se(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),rt(4,"Mi Perfil Laboral"),Ie()(),Se(5,"div",6)(6,"button",7),Sn("click",function(){return Qi(t),er(Ni().agregarPerfil())}),rt(7,"Agregar Perfil"),Ie(),Se(8,"table",8)(9,"thead",9)(10,"tr")(11,"th"),rt(12,"ID-USUARIO"),Ie(),Se(13,"th"),rt(14,"Profesi\xf3n"),Ie(),Se(15,"th"),rt(16,"Tiempo de Experiencia"),Ie(),Se(17,"th"),rt(18,"Introducci\xf3n"),Ie(),Se(19,"th"),rt(20,"Acciones"),Ie()()(),Se(21,"tbody"),_i(22,Sj,12,4,"tr",10),Ie()()()()()}if(2&e){const t=Ni();st(22),Gt("ngForOf",t.perfiles)}}function Aj(e,n){if(1&e&&(Se(0,"option",25),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}function Pj(e,n){if(1&e){const t=Pm();Se(0,"div",12)(1,"h2"),rt(2),Ie(),Se(3,"form",13),Sn("ngSubmit",function(){return Qi(t),er(Ni().guardarPerfil())}),Se(4,"input",14),Sn("ngModelChange",function(l){return Qi(t),er(Ni().perfil.id_perfil=l)}),Ie(),Se(5,"div",15)(6,"label"),rt(7,"ID Usuario"),Ie(),Se(8,"input",16),Sn("ngModelChange",function(l){return Qi(t),er(Ni().perfil.id_usuario=l)}),Ie()(),Se(9,"div",15)(10,"label",17),rt(11,"Profesi\xf3n"),Ie(),Se(12,"select",18),Sn("ngModelChange",function(l){return Qi(t),er(Ni().perfil.profesion=l)}),_i(13,Aj,2,2,"option",19),Ie()(),Se(14,"div",15)(15,"label"),rt(16,"Tiempo de Experiencia"),Ie(),Se(17,"input",20),Sn("ngModelChange",function(l){return Qi(t),er(Ni().perfil.tiempo_experiencia=l)}),Ie()(),Se(18,"div",15)(19,"label"),rt(20,"Introducci\xf3n"),Ie(),Se(21,"textarea",21),Sn("ngModelChange",function(l){return Qi(t),er(Ni().perfil.introduccion=l)}),Ie()(),Se(22,"div",22)(23,"button",23),rt(24,"Guardar"),Ie(),Se(25,"button",24),Sn("click",function(){return Qi(t),er(Ni().cancelar())}),rt(26,"Cancelar"),Ie()()()()}if(2&e){const t=Ni();st(2),da("",t.perfil.id_perfil?"Editar":"Agregar"," Perfil"),st(2),Gt("ngModel",t.perfil.id_perfil),st(4),Gt("ngModel",t.perfil.id_usuario),st(4),Gt("ngModel",t.perfil.profesion),st(1),Gt("ngForOf",t.profesiones),st(4),Gt("ngModel",t.perfil.tiempo_experiencia),st(4),Gt("ngModel",t.perfil.introduccion)}}let Rj=(()=>{class e{constructor(t,r,l){this.perfilesServices=t,this.usuarioServices=r,this.selectores=l,this.perfil={id_perfil:0,id_usuario:0,profesion:0,tiempo_experiencia:"",introduccion:""},this.editaRegistraVisible=!1}ngOnInit(){this.profesiones=this.selectores.getAreProfesiones(),this.usuarioSubscription=this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t),this.cargarPerfilesUsuario()})}agregarPerfil(){this.inicializaPerfil(),this.editaRegistraVisible=!0}editarPerfil(t){const r=this.perfiles.find(l=>l.id_perfil===t);r&&(this.perfil={...r},this.editaRegistraVisible=!0),this.editaRegistraVisible=!0}guardarPerfil(){this.perfilesServices.guardaActualizaPerfil(this.perfil).subscribe({next:t=>{this.mensaje="Perfil registrada/actualizada con \xe9xito",this.cargarPerfilesUsuario()},error:t=>{this.mensaje="Registra de Perfil Presenta inconvenientes: "+t}}),this.editaRegistraVisible=!1}cargarPerfilesUsuario(){this.perfilesSubscrition=this.perfilesServices.obtenerPerfilesPorIdUsuario(`${this.id_usuario}`).subscribe(t=>{this.perfiles=t})}getProfesionDescripcion(t){const r=this.profesiones.find(l=>{if(l.id===t)return l});return r?r.nombre:"Desconocido"}cancelar(){this.editaRegistraVisible=!1}ngOnDestroy(){this.perfilesSubscrition&&this.perfilesSubscrition.unsubscribe(),this.usuarioSubscription&&this.usuarioSubscription.unsubscribe()}inicializaPerfil(){this.perfil={id_perfil:0,id_usuario:this.id_usuario,profesion:0,tiempo_experiencia:"",introduccion:""}}static#e=this.\u0275fac=function(r){return new(r||e)(et(jI),et(Sh),et(Mx))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-perfil"]],decls:2,vars:2,consts:[["id","listado","class","container mt-3",4,"ngIf"],["id","registro","class","container mt-3",4,"ngIf"],["id","listado",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"btn","btn-primary","mb-3",3,"click"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click"],["id","registro",1,"container","mt-3"],[3,"ngSubmit"],["type","hidden","name","id_perfil",3,"ngModel","ngModelChange"],[1,"form-group"],["name","id_usuario","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["for","profesion"],["name","profesion","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["name","tiempo_experiencia","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","introduccion","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","d-flex","justify-content-center","mt-3"],["type","submit",1,"btn","btn-primary","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"]],template:function(r,l){1&r&&(_i(0,Ij,23,1,"div",0),_i(1,Pj,27,7,"div",1)),2&r&&(Gt("ngIf",!l.editaRegistraVisible),st(1),Gt("ngIf",l.editaRegistraVisible))},dependencies:[Jf,Eh,eg,tg,ng,Ih,Fd,Od,Jm,ap,Nd,op]})}return e})();function Lj(e,n){if(1&e&&(Se(0,"option",28),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}function kj(e,n){if(1&e&&(Se(0,"option",28),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}function Oj(e,n){if(1&e&&(Se(0,"option",28),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}function Fj(e,n){if(1&e){const t=Pm();Se(0,"tr")(1,"td"),rt(2),Ie(),Se(3,"td"),rt(4),Ie(),Se(5,"td"),rt(6),Ie(),Se(7,"td"),rt(8),Ie(),Se(9,"td"),rt(10),Ie(),Se(11,"td"),rt(12),Ie(),Se(13,"td"),rt(14),Ie(),Se(15,"td"),rt(16),q_(17,"date"),Ie(),Se(18,"td"),rt(19),q_(20,"date"),Ie(),Se(21,"td"),rt(22),Ie(),Se(23,"td"),rt(24),Ie(),Se(25,"td")(26,"button",10),Sn("click",function(){const f=Qi(t).$implicit;return er(Ni(2).editarContrato(f.id_contrato))}),rt(27," Editar "),Ie()()()}if(2&e){const t=n.$implicit,r=Ni(2);st(2),Xi(t.id_contrato),st(2),Xi(t.id_usuario_contratante),st(2),Xi(t.id_contrato?r.nombreUsuarioContratistaLocal(t.id_contrato):""),st(2),Xi(t.estado),st(2),Xi(t.tipo_contrato),st(2),Xi(t.id_usuario_trabajador),st(2),Xi(t.id_contrato?r.nombreUsuarioTrabajdor(t.id_contrato):""),st(2),Xi(Z_(17,11,t.fecha_inicio,"yyyy-MM-dd HH:mm:ss")),st(3),Xi(Z_(20,14,t.fecha_fin,"yyyy-MM-dd HH:mm:ss")),st(3),Xi(t.descripcion),st(2),Xi(t.comentario)}}function zj(e,n){if(1&e&&(Se(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),rt(4,"Mis Contratos Vigentes"),Ie()(),Se(5,"div",6)(6,"table",7)(7,"thead",8)(8,"tr")(9,"th"),rt(10,"ID-CONTRATO"),Ie(),Se(11,"th"),rt(12,"ID CONTRATANTE"),Ie(),Se(13,"th"),rt(14,"NOMBRE CONTRATANTE"),Ie(),Se(15,"th"),rt(16,"ESTADO"),Ie(),Se(17,"th"),rt(18,"TIPO CONTRATO"),Ie(),Se(19,"th"),rt(20,"ID CONTRATADO"),Ie(),Se(21,"th"),rt(22,"NOMBRE CONTRATANTE"),Ie(),Se(23,"th"),rt(24,"FECHA INICIO"),Ie(),Se(25,"th"),rt(26,"FECHA FIN"),Ie(),Se(27,"th"),rt(28,"DESCRIPCION DEL TRABAJO"),Ie(),Se(29,"th"),rt(30,"COMENTARIO"),Ie(),Se(31,"th"),rt(32,"Acciones"),Ie()()(),Se(33,"tbody"),_i(34,Fj,28,17,"tr",9),Ie()()()()()),2&e){const t=Ni();st(34),Gt("ngForOf",t.contratos)}}function Bj(e,n){if(1&e&&(Se(0,"option",29),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}function Vj(e,n){if(1&e&&(Se(0,"option",29),rt(1),Ie()),2&e){const t=n.$implicit;Gt("value",t.id),st(1),da(" ",t.nombre," ")}}function Uj(e,n){if(1&e){const t=Pm();Se(0,"div",11)(1,"h2"),rt(2),Ie(),Se(3,"form",12),Sn("ngSubmit",function(){return Qi(t),er(Ni().guardarEditContrato())}),Se(4,"input",13),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.id_contrato=l)}),Ie(),Se(5,"div",14)(6,"label"),rt(7,"ID Usuario Contratante"),Ie(),Se(8,"input",15),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.id_usuario_contratante=l)}),Ie()(),Se(9,"div",14)(10,"label",16),rt(11,"Estado"),Ie(),Se(12,"select",17),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.estado=l)}),_i(13,Bj,2,2,"option",18),Ie()(),Se(14,"div",14)(15,"label",19),rt(16,"Tipo Contrato"),Ie(),Se(17,"select",20),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.tipo_contrato=l)}),_i(18,Vj,2,2,"option",18),Ie()(),Se(19,"div",14)(20,"label"),rt(21,"ID Usuario Contratado"),Ie(),Se(22,"input",21),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.id_usuario_trabajador=l)}),Ie()(),Se(23,"div",14)(24,"label"),rt(25,"Fecha Inicio"),Ie(),Se(26,"input",22),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.fecha_inicio=l)}),Ie()(),Se(27,"div",14)(28,"label"),rt(29,"Fecha Fin"),Ie(),Se(30,"input",23),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.fecha_fin=l)}),Ie()(),Se(31,"div",14)(32,"label"),rt(33,"Descripci\xf3n del trabajo"),Ie(),Se(34,"textarea",24),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.descripcion=l)}),Ie()(),Se(35,"div",14)(36,"label"),rt(37,"Comentario"),Ie(),Se(38,"textarea",25),Sn("ngModelChange",function(l){return Qi(t),er(Ni().contrato.comentario=l)}),Ie()(),Se(39,"div",26)(40,"button",27),rt(41,"Guardar"),Ie(),Se(42,"button",28),Sn("click",function(){return Qi(t),er(Ni().cancelar())}),rt(43,"Cancelar"),Ie()()()()}if(2&e){const t=Ni();st(2),sw("",t.contrato.id_contrato?"Editar":"Agregar"," Contrato # ",t.contrato.id_contrato,""),st(2),Gt("ngModel",t.contrato.id_contrato),st(4),Gt("ngModel",t.contrato.id_usuario_contratante),st(4),Gt("ngModel",t.contrato.estado),st(1),Gt("ngForOf",t.estadosContrato),st(4),Gt("ngModel",t.contrato.tipo_contrato),st(1),Gt("ngForOf",t.tiposContrato),st(4),Gt("ngModel",t.contrato.id_usuario_trabajador),st(4),Gt("ngModel",t.contrato.fecha_inicio),st(4),Gt("ngModel",t.contrato.fecha_fin),st(4),Gt("ngModel",t.contrato.descripcion),st(4),Gt("ngModel",t.contrato.comentario)}}function $j(e,n){if(1&e&&(Se(0,"tr")(1,"td"),rt(2),Ie(),Se(3,"td"),rt(4),Ie(),Se(5,"td"),rt(6),Ie(),Se(7,"td"),rt(8),Ie(),Se(9,"td"),rt(10),Ie(),Se(11,"td"),rt(12),Ie(),Se(13,"td"),rt(14),Ie(),Se(15,"td"),rt(16),q_(17,"date"),Ie(),Se(18,"td"),rt(19),q_(20,"date"),Ie(),Se(21,"td"),rt(22),Ie(),Se(23,"td"),rt(24),Ie()()),2&e){const t=n.$implicit,r=Ni();st(2),Xi(t.id_contrato),st(2),Xi(t.id_usuario_contratante),st(2),Xi(t.id_contrato?r.nombreUsuarioContratistaLocal(t.id_contrato):""),st(2),Xi(t.estado),st(2),Xi(r.nombreTipoContrato(t.tipo_contrato)),st(2),Xi(t.id_usuario_trabajador),st(2),Xi(t.id_contrato?r.nombreUsuarioTrabajdor(t.id_contrato):""),st(2),Xi(Z_(17,11,t.fecha_inicio,"yyyy-MM-dd HH:mm:ss")),st(3),Xi(Z_(20,14,t.fecha_fin,"yyyy-MM-dd HH:mm:ss")),st(3),Xi(t.descripcion),st(2),Xi(t.comentario)}}const Hj=[{path:"",redirectTo:"/inicio",pathMatch:"full"},{path:"inicio",component:GA},{path:"inicio/:outsesion",component:GA},{path:"iniciar-sesion",component:EU},{path:"crear-contrato/:idcontratante/:idtrabajador",component:SU},{path:"ubicacion",component:Mj},{path:"registro",component:(()=>{class e{constructor(t,r){this.selectores=t,this.usuarioServicio=r,this.usuario={id:0,nombres:"",email:"",password:"",rol:0,estado:"INACTIVO",identificacion:"",tipoIdentificacion:""},this.perfilTrabajo={id_perfil:0,id_usuario:0,profesion:0,tiempo_experiencia:"",introduccion:""}}ngOnInit(){this.tiposIdentificaciones=this.selectores.getTiposIdentificacion(),this.tiposRoles=this.selectores.getTiposRol(),this.profesiones=this.selectores.getAreProfesiones()}registrarUsuario(){var t=this;return ZA(function*(){t.usuarioServicio.crearUsuario(t.usuario,t.perfilTrabajo).subscribe({next:r=>{t.mensaje="Registro con \xe9xito"},error:r=>{t.mensaje="Presentamos inconvenientes: "+r}})})()}cancelarRegistro(){console.log("Cancelacion registro usuario para guardar :: ")}static#e=this.\u0275fac=function(r){return new(r||e)(et(Mx),et(Sh))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-registro"]],decls:51,vars:14,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[1,"card","p-4",3,"ngSubmit"],["type","hidden","name","id_usuario",3,"ngModel","ngModelChange"],[1,"form-group","mb-3"],["for","nombres"],["type","text","name","nombres","placeholder","Nombres completo",1,"form-control",3,"ngModel","ngModelChange"],["for","email"],["type","email","name","nombres","placeholder","Email",1,"form-control",3,"ngModel","ngModelChange"],["for","password"],["type","password","name","password","placeholder","******",1,"form-control",3,"ngModel","ngModelChange"],["for","rol"],["name","rol",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","tipoidentificacion"],["for","identificacion"],["type","text","name","identificacion","placeholder","0172621900",1,"form-control",3,"ngModel","ngModelChange"],["type","hidden","name","id_perfil",3,"ngModel","ngModelChange"],["for","profesion"],["name","profesion",1,"form-select",3,"ngModel","ngModelChange"],["for","tiempoTrabajo"],["type","text","name","tiempoTrabajo","placeholder","1 a\xf1o 3 meses",1,"form-control",3,"ngModel","ngModelChange"],["for","introduccion"],["type","text","name","introduccion","placeholder","introduccion",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","mb-3"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],[3,"value"]],template:function(r,l){1&r&&(Se(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),rt(4,"Registro de Usuario"),Ie(),Se(5,"form",4),Sn("ngSubmit",function(){return l.registrarUsuario()}),Se(6,"input",5),Sn("ngModelChange",function(y){return l.usuario.id=y}),Ie(),Se(7,"div",6)(8,"label",7),rt(9,"Nombres"),Ie(),Se(10,"input",8),Sn("ngModelChange",function(y){return l.usuario.nombres=y}),Ie()(),Se(11,"div",6)(12,"label",9),rt(13,"Email"),Ie(),Se(14,"input",10),Sn("ngModelChange",function(y){return l.usuario.email=y}),Ie()(),Se(15,"div",6)(16,"label",11),rt(17,"Password"),Ie(),Se(18,"input",12),Sn("ngModelChange",function(y){return l.usuario.password=y}),Ie()(),Se(19,"div",6)(20,"label",13),rt(21,"Rol"),Ie(),Se(22,"select",14),Sn("ngModelChange",function(y){return l.usuario.rol=y}),_i(23,Lj,2,2,"option",15),Ie()(),Se(24,"div",6)(25,"label",16),rt(26,"Tipo Identificaci\xf3n"),Ie(),Se(27,"select",14),Sn("ngModelChange",function(y){return l.usuario.tipoIdentificacion=y}),_i(28,kj,2,2,"option",15),Ie()(),Se(29,"div",6)(30,"label",17),rt(31,"Identificacion"),Ie(),Se(32,"input",18),Sn("ngModelChange",function(y){return l.usuario.identificacion=y}),Ie()(),Se(33,"input",19),Sn("ngModelChange",function(y){return l.perfilTrabajo.id_perfil=y}),Ie(),Se(34,"div",6)(35,"label",20),rt(36,"Profesi\xf3n"),Ie(),Se(37,"select",21),Sn("ngModelChange",function(y){return l.perfilTrabajo.profesion=y}),_i(38,Oj,2,2,"option",15),Ie()(),Se(39,"div",6)(40,"label",22),rt(41,"Tiempo Experiencia"),Ie(),Se(42,"input",23),Sn("ngModelChange",function(y){return l.perfilTrabajo.tiempo_experiencia=y}),Ie()(),Se(43,"div",6)(44,"label",24),rt(45,"Actividades Profesionales"),Ie(),Se(46,"input",25),Sn("ngModelChange",function(y){return l.perfilTrabajo.introduccion=y}),Ie()(),Se(47,"button",26),rt(48,"Guardar"),Ie(),Se(49,"button",27),Sn("click",function(){return l.cancelarRegistro()}),rt(50,"Cancelar"),Ie()()()()()),2&r&&(st(6),Gt("ngModel",l.usuario.id),st(4),Gt("ngModel",l.usuario.nombres),st(4),Gt("ngModel",l.usuario.email),st(4),Gt("ngModel",l.usuario.password),st(4),Gt("ngModel",l.usuario.rol),st(1),Gt("ngForOf",l.tiposRoles),st(4),Gt("ngModel",l.usuario.tipoIdentificacion),st(1),Gt("ngForOf",l.tiposIdentificaciones),st(4),Gt("ngModel",l.usuario.identificacion),st(1),Gt("ngModel",l.perfilTrabajo.id_perfil),st(4),Gt("ngModel",l.perfilTrabajo.profesion),st(1),Gt("ngForOf",l.profesiones),st(4),Gt("ngModel",l.perfilTrabajo.tiempo_experiencia),st(4),Gt("ngModel",l.perfilTrabajo.introduccion))},dependencies:[Jf,eg,tg,ng,Ih,Fd,Od,Jm,Nd,op]})}return e})()},{path:"perfil",component:Rj},{path:"admin-contrato",component:(()=>{class e{constructor(t,r,l){this.contratoService=t,this.usuarioServices=r,this.selectores=l,this.contratosConNombres=[],this.contrato={id_contrato:0,id_usuario_contratante:0,estado:"",tipo_contrato:0,id_usuario_trabajador:0,fecha_inicio:"",fecha_fin:"",descripcion:"",comentario:""},this.editaContratoVisible=!1}ngOnInit(){this.estadosContrato=this.selectores.getEstadosContrato(),this.tiposContrato=this.selectores.getTiposContrato(),this.usuarioAdminSubscripcion=this.contratoAdminSubscription=this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t)}),this.contratosConNombres=[],this.contratoAdminSubscription=this.contratoService.consultaContratoUsuarioRelacionado(this.id_usuario).subscribe(t=>{t&&(this.contratos=t,this.cargarContratosConNombres())})}editarContrato(t){const r=this.contratos.find(l=>l.id_contrato===t);r&&(this.contrato={...r},this.contrato.fecha_inicio=new Date(this.contrato.fecha_inicio).toISOString().slice(0,19).replace("T"," "),this.contrato.fecha_fin=new Date(this.contrato.fecha_fin).toISOString().slice(0,19).replace("T"," "),this.editaContratoVisible=!0),this.editaContratoVisible=!0}guardarEditContrato(){if(this.contrato){const t=new Date(this.contrato.fecha_fin);this.contrato.fecha_fin=t.toISOString().slice(0,19).replace("T"," ")}this.contratoService.editarContrato(this.contrato).subscribe({next:t=>{this.mensaje="Contrato actualizada con \xe9xito";const r=this.contratos.findIndex(l=>l.id_contrato===this.contrato.id_contrato);-1!==r&&(this.contratos[r]=this.contrato)},error:t=>{this.mensaje="Actualizaci\xf3n  de contrato presenta inconvenientes: "+t}}),this.editaContratoVisible=!1}cargarContratosConNombres(){this.contratosConNombres=[],this.contratos.forEach(t=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_contratante).subscribe(r=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_trabajador).subscribe(l=>{const f={id_contrato:t.id_contrato,id_usuario_contratante:t.id_usuario_contratante,nombre_usuario_contratante:r,id_usuario_trabajador:t.id_usuario_trabajador,nombre_usuario_trabajador:l};console.log("Se carga contrato con nombre"),this.contratosConNombres.push(f)})})})}nombreUsuarioContratistaLocal(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_contratante||" "}nombreUsuarioTrabajdor(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_trabajador||" "}cancelar(){this.editaContratoVisible=!1}ngOnDestroy(){this.usuarioAdminSubscripcion&&this.usuarioAdminSubscripcion.unsubscribe(),this.contratoAdminSubscription&&this.contratoAdminSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(et(_E),et(Sh),et(Mx))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-admincontrato"]],decls:2,vars:2,consts:[["id","listadoContrato","class","container mt-3",4,"ngIf"],["id","editar","class","container mt-3",4,"ngIf"],["id","listadoContrato",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click"],["id","editar",1,"container","mt-3"],[3,"ngSubmit"],["type","hidden","name","id_contrato",3,"ngModel","ngModelChange"],[1,"form-group"],["name","id_usuario_contratante","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["for","estado"],["name","estado","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","tipocontrato"],["name","tipocontrato","required","",1,"form-select",3,"ngModel","ngModelChange"],["name","id_usuario_trabajador","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["name","fecha_inicio","required","","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["name","fecha_fin","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","descripcion","required","","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["name","comentario","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","d-flex","justify-content-center","mt-3"],["type","submit",1,"btn","btn-primary","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"]],template:function(r,l){1&r&&(_i(0,zj,35,1,"div",0),_i(1,Uj,44,13,"div",1)),2&r&&(Gt("ngIf",!l.editaContratoVisible),st(1),Gt("ngIf",l.editaContratoVisible))},dependencies:[Jf,Eh,eg,tg,ng,Ih,Fd,Od,Jm,ap,Nd,op,u1]})}return e})()},{path:"historico-contrato",component:(()=>{class e{constructor(t,r){this.contratoService=t,this.usuarioServices=r,this.contratosConNombres=[],this.tiposContrato=[{id:1,nombre:"Por D\xeda"},{id:2,nombre:"Por Hora"},{id:3,nombre:"M\xe1s de 5 D\xedas"}]}ngOnInit(){this.usuarioContratoSubscripcion=this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t)}),this.contratosConNombres=[],this.contratoConsultaSubscription=this.contratoService.consultaContratoGeneralRelacionado(this.id_usuario).subscribe(t=>{t&&(this.contratos=t,this.cargarContratosConNombres())})}cargarContratosConNombres(){this.contratosConNombres=[],this.contratos.forEach(t=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_contratante).subscribe(r=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_trabajador).subscribe(l=>{this.contratosConNombres.push({id_contrato:t.id_contrato,id_usuario_contratante:t.id_usuario_contratante,nombre_usuario_contratante:r,id_usuario_trabajador:t.id_usuario_trabajador,nombre_usuario_trabajador:l})})})})}nombreUsuarioContratistaLocal(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_contratante||" "}nombreUsuarioTrabajdor(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_trabajador||" "}nombreTipoContrato(t){const r=this.tiposContrato.find(l=>l.id===t);return r?r.nombre:"Desconocido"}ngOnDestroy(){this.usuarioContratoSubscripcion&&this.usuarioContratoSubscripcion.unsubscribe(),this.contratoConsultaSubscription&&this.contratoConsultaSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(et(_E),et(Sh))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-historico"]],decls:33,vars:1,consts:[["id","listadoContrato",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"]],template:function(r,l){1&r&&(Se(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),rt(4,"Mis Contratos Historicos"),Ie()(),Se(5,"div",4)(6,"table",5)(7,"thead",6)(8,"tr")(9,"th"),rt(10,"# CONTRATO"),Ie(),Se(11,"th"),rt(12,"ID CONTRATANTE"),Ie(),Se(13,"th"),rt(14,"NOMBRE CONTRATANTE"),Ie(),Se(15,"th"),rt(16,"ESTADO"),Ie(),Se(17,"th"),rt(18,"TIPO CONTRATO"),Ie(),Se(19,"th"),rt(20,"ID CONTRATADO"),Ie(),Se(21,"th"),rt(22,"NOMBRE CONTRATADO"),Ie(),Se(23,"th"),rt(24,"FECHA INICIO"),Ie(),Se(25,"th"),rt(26,"FECHA FIN"),Ie(),Se(27,"th"),rt(28,"DESCRIPCION DEL TRABAJO"),Ie(),Se(29,"th"),rt(30,"COMENTARIO"),Ie()()(),Se(31,"tbody"),_i(32,$j,25,17,"tr",7),Ie()()()()()),2&r&&(st(32),Gt("ngForOf",l.contratos))},dependencies:[Jf,u1]})}return e})()}];let Gj=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[EI.forRoot(Hj),EI]})}return e})(),qj=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-header"]],decls:6,vars:0,consts:[[1,"jumotron","bg-cover","text-white"],[1,"container","py-5","text-center"],[1,"display-4","font-weight-bold"]],template:function(r,l){1&r&&(Se(0,"header",0)(1,"div",1)(2,"h1",2),rt(3,"Soluciones Inmediatas"),Ie(),Se(4,"h1",2),rt(5,"Conectamos Expertos de su area. Sin Esperas."),Ie()()())},styles:["header[_ngcontent-%COMP%]{background:url(question-mark-1872665_640.fcfd18a32560cc9e.jpg)}"]})}return e})(),Zj=(()=>{class e{getIconSvgPath(){return`assets/icons/${this.iconName}.svg`}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-icon"]],inputs:{iconName:"iconName"},decls:1,vars:2,consts:[[3,"src","alt"]],template:function(r,l){1&r&&wo(0,"img",0),2&r&&(ew("alt",l.iconName),Gt("src",l.getIconSvgPath(),cm))},styles:["a[_ngcontent-%COMP%]{text-decoration:none;display:inline-block;margin:0 10px}img[_ngcontent-%COMP%]{width:24px;height:auto}"]})}return e})(),Wj=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-footer"]],decls:20,vars:0,consts:[[1,"jumotron"],[1,"text-center","text-white"],[1,"container-fluid"],[1,"row","justify-content-center"],[1,"col-lg-8","mt-2"],[1,"text-center","mb-2"],["href","",1,"text-white","me-4"],["iconName","facebook-logo-svgrepo-com"],["iconName","twitter-social-logotype-svgrepo-com"],["iconName","google-logo-fill-svgrepo-com"],["iconName","instagram-logo-svgrepo-com"],["iconName","linkedin-logo-svgrepo-com"],["iconName","github-142-svgrepo-com"]],template:function(r,l){1&r&&(Se(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"p"),rt(6," Este sitio tiene como objetivo facilitar la distribuci\xf3n laboral a corto plazo para personas sin trabajo fijo y emprendedores, sitio web sin fines de lucro "),Ie()()(),Se(7,"div",5)(8,"a",6),wo(9,"app-icon",7),Ie(),Se(10,"a",6),wo(11,"app-icon",8),Ie(),Se(12,"a",6),wo(13,"app-icon",9),Ie(),Se(14,"a",6),wo(15,"app-icon",10),Ie(),Se(16,"a",6),wo(17,"app-icon",11),Ie(),Se(18,"a",6),wo(19,"app-icon",12),Ie()()()()())},dependencies:[Zj],styles:["footer[_ngcontent-%COMP%]{background-color:#646262}.app-footer[_ngcontent-%COMP%]{height:60px}"]})}return e})();function Xj(e,n){1&e&&(Se(0,"li",7)(1,"a",10),rt(2,"Inicio Sesi\xf3n"),Ie()())}function Yj(e,n){1&e&&(Se(0,"li",7)(1,"a",11),rt(2,"Registrarse"),Ie()())}function Kj(e,n){1&e&&(Se(0,"li",7)(1,"a",12),rt(2,"Mi Ubicaci\xf3n"),Ie()())}function Jj(e,n){1&e&&(Se(0,"li",7)(1,"a",13),rt(2,"Mi Perfil"),Ie()())}function Qj(e,n){1&e&&(Se(0,"li",7)(1,"a",14),rt(2,"Administrar Contratos Vigente"),Ie()())}function e4(e,n){1&e&&(Se(0,"li",7)(1,"a",15),rt(2,"Contratos Historico"),Ie()())}const t4=function(){return{outsesion:"outsesion"}},n4=function(e){return["/inicio",e]};function i4(e,n){1&e&&(Se(0,"li",7)(1,"a",16),rt(2,"Cerrar Sesi\xf3n"),Ie()()),2&e&&(st(1),Gt("routerLink",_w(2,n4,function oD(e,n,t){const r=hs()+e,l=vt();return l[r]===pn?vu(l,r,t?n.call(t):n()):function k_(e,n){return e[n]}(l,r)}(1,t4))))}let r4=(()=>{class e{constructor(t,r){this.usuarioServer=t,this.router=r,this.userLoginOn=!1}ngOnInit(){this.usuarioServer.currentUserLoginOn.subscribe({next:t=>{this.userLoginOn=t}})}static#e=this.\u0275fac=function(r){return new(r||e)(et(Sh),et(Ls))};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-nav"]],decls:18,vars:7,consts:[[1,"navbar","navbar-expand-lg","bg-body-tertiary"],[1,"container-fluid"],[1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],[1,"nav-item"],["aria-current","page","routerLink","/inicio",1,"nav-link"],["class","nav-item",4,"ngIf"],["routerLink","/iniciar-sesion",1,"nav-link","active"],["routerLink","/registro","aria-disabled","true",1,"nav-link"],["routerLink","/ubicacion","aria-disabled","true",1,"nav-link"],["routerLink","/perfil","aria-disabled","true",1,"nav-link"],["routerLink","/admin-contrato","aria-disabled","true",1,"nav-link"],["routerLink","/historico-contrato","aria-disabled","true",1,"nav-link"],["aria-disabled","true",1,"nav-link",3,"routerLink"]],template:function(r,l){1&r&&(Se(0,"nav",0)(1,"div",1)(2,"a",2),rt(3,"Localizador"),Ie(),Se(4,"button",3),wo(5,"span",4),Ie(),Se(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),rt(10,"Inicio"),Ie()(),_i(11,Xj,3,0,"li",9),_i(12,Yj,3,0,"li",9),_i(13,Kj,3,0,"li",9),_i(14,Jj,3,0,"li",9),_i(15,Qj,3,0,"li",9),_i(16,e4,3,0,"li",9),_i(17,i4,3,4,"li",9),Ie()()()()),2&r&&(st(11),Gt("ngIf",!l.userLoginOn),st(1),Gt("ngIf",!l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn),st(1),Gt("ngIf",l.userLoginOn))},dependencies:[Eh,ux],styles:["button[_ngcontent-%COMP%]:hover{background-color:#4caf50;color:#fff}"]})}return e})(),o4=(()=>{class e{constructor(){this.title="buscaPersonaFree"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=pr({type:e,selectors:[["app-root"]],decls:7,vars:0,consts:[[1,"main-container"],[1,"content-wrapper"],[1,"app-footer"]],template:function(r,l){1&r&&(Se(0,"div",0),wo(1,"app-header")(2,"app-nav"),Se(3,"div",1),wo(4,"router-outlet"),Ie(),Se(5,"div",2),wo(6,"app-footer"),Ie()())},dependencies:[B1,qj,Wj,r4]})}return e})();const s4={url:"https://api-back-service-3uomm4d6da-uc.a.run.app",options:{}};let a4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e,bootstrap:[o4]});static#n=this.\u0275inj=Nr({imports:[nz,Gj,uU,uV,yj.forRoot(s4),cU]})}return e})();ez().bootstrapModule(a4).catch(e=>console.error(e))},391:function(Zt,qt,_e){var gt;Zt=_e.nmd(Zt),function(Ve){"object"==typeof global&&global;var Me=function(Nt){this.message=Nt};(Me.prototype=new Error).name="InvalidCharacterError";var Le=function(Nt){throw new Me(Nt)},Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Re=/[\t\n\f\r ]/g,Bt={encode:function(Nt){Nt=String(Nt),/[^\0-\xFF]/.test(Nt)&&Le("The string to be encoded contains characters outside of the Latin1 range.");for(var bt,$e,ke,Fe,kt=Nt.length%3,he="",Je=-1,Ot=Nt.length-kt;++Je<Ot;)bt=Nt.charCodeAt(Je)<<16,$e=Nt.charCodeAt(++Je)<<8,ke=Nt.charCodeAt(++Je),he+=Ae.charAt((Fe=bt+$e+ke)>>18&63)+Ae.charAt(Fe>>12&63)+Ae.charAt(Fe>>6&63)+Ae.charAt(63&Fe);return 2==kt?(bt=Nt.charCodeAt(Je)<<8,$e=Nt.charCodeAt(++Je),he+=Ae.charAt((Fe=bt+$e)>>10)+Ae.charAt(Fe>>4&63)+Ae.charAt(Fe<<2&63)+"="):1==kt&&(Fe=Nt.charCodeAt(Je),he+=Ae.charAt(Fe>>2)+Ae.charAt(Fe<<4&63)+"=="),he},decode:function(Nt){var kt=(Nt=String(Nt).replace(Re,"")).length;kt%4==0&&(kt=(Nt=Nt.replace(/==?$/,"")).length),(kt%4==1||/[^+a-zA-Z0-9/]/.test(Nt))&&Le("Invalid character: the string to be decoded is not correctly encoded.");for(var Je,bt,he=0,$e="",ke=-1;++ke<kt;)bt=Ae.indexOf(Nt.charAt(ke)),Je=he%4?64*Je+bt:bt,he++%4&&($e+=String.fromCharCode(255&Je>>(-2*he&6)));return $e},version:"0.1.0"};void 0!==(gt=function(){return Bt}.call(qt,_e,qt,Zt))&&(Zt.exports=gt)}()},16:Zt=>{"use strict";var gt,qt="object"==typeof Reflect?Reflect:null,_e=qt&&"function"==typeof qt.apply?qt.apply:function(ke,at,Fe){return Function.prototype.apply.call(ke,at,Fe)};gt=qt&&"function"==typeof qt.ownKeys?qt.ownKeys:Object.getOwnPropertySymbols?function(ke){return Object.getOwnPropertyNames(ke).concat(Object.getOwnPropertySymbols(ke))}:function(ke){return Object.getOwnPropertyNames(ke)};var Te=Number.isNaN||function(ke){return ke!=ke};function u(){u.init.call(this)}Zt.exports=u,Zt.exports.once=function he($e,ke){return new Promise(function(at,Fe){function Ot(Lt){$e.removeListener(ke,Wt),Fe(Lt)}function Wt(){"function"==typeof $e.removeListener&&$e.removeListener("error",Ot),at([].slice.call(arguments))}bt($e,ke,Wt,{once:!0}),"error"!==ke&&function Je($e,ke,at){"function"==typeof $e.on&&bt($e,"error",ke,at)}($e,Ot,{once:!0})})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var Q=10;function Me($e){if("function"!=typeof $e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof $e)}function Le($e){return void 0===$e._maxListeners?u.defaultMaxListeners:$e._maxListeners}function Ae($e,ke,at,Fe){var Ot,Wt,Lt;if(Me(at),void 0===(Wt=$e._events)?(Wt=$e._events=Object.create(null),$e._eventsCount=0):(void 0!==Wt.newListener&&($e.emit("newListener",ke,at.listener?at.listener:at),Wt=$e._events),Lt=Wt[ke]),void 0===Lt)Lt=Wt[ke]=at,++$e._eventsCount;else if("function"==typeof Lt?Lt=Wt[ke]=Fe?[at,Lt]:[Lt,at]:Fe?Lt.unshift(at):Lt.push(at),(Ot=Le($e))>0&&Lt.length>Ot&&!Lt.warned){Lt.warned=!0;var Cn=new Error("Possible EventEmitter memory leak detected. "+Lt.length+" "+String(ke)+" listeners added. Use emitter.setMaxListeners() to increase limit");Cn.name="MaxListenersExceededWarning",Cn.emitter=$e,Cn.type=ke,Cn.count=Lt.length,function Ve($e){console&&console.warn&&console.warn($e)}(Cn)}return $e}function Re(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yt($e,ke,at){var Fe={fired:!1,wrapFn:void 0,target:$e,type:ke,listener:at},Ot=Re.bind(Fe);return Ot.listener=at,Fe.wrapFn=Ot,Ot}function Yt($e,ke,at){var Fe=$e._events;if(void 0===Fe)return[];var Ot=Fe[ke];return void 0===Ot?[]:"function"==typeof Ot?at?[Ot.listener||Ot]:[Ot]:at?function kt($e){for(var ke=new Array($e.length),at=0;at<ke.length;++at)ke[at]=$e[at].listener||$e[at];return ke}(Ot):St(Ot,Ot.length)}function Bt($e){var ke=this._events;if(void 0!==ke){var at=ke[$e];if("function"==typeof at)return 1;if(void 0!==at)return at.length}return 0}function St($e,ke){for(var at=new Array(ke),Fe=0;Fe<ke;++Fe)at[Fe]=$e[Fe];return at}function bt($e,ke,at,Fe){if("function"==typeof $e.on)Fe.once?$e.once(ke,at):$e.on(ke,at);else{if("function"!=typeof $e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof $e);$e.addEventListener(ke,function Ot(Wt){Fe.once&&$e.removeEventListener(ke,Ot),at(Wt)})}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function($e){if("number"!=typeof $e||$e<0||Te($e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+$e+".");Q=$e}}),u.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(ke){if("number"!=typeof ke||ke<0||Te(ke))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ke+".");return this._maxListeners=ke,this},u.prototype.getMaxListeners=function(){return Le(this)},u.prototype.emit=function(ke){for(var at=[],Fe=1;Fe<arguments.length;Fe++)at.push(arguments[Fe]);var Ot="error"===ke,Wt=this._events;if(void 0!==Wt)Ot=Ot&&void 0===Wt.error;else if(!Ot)return!1;if(Ot){var Lt;if(at.length>0&&(Lt=at[0]),Lt instanceof Error)throw Lt;var Cn=new Error("Unhandled error."+(Lt?" ("+Lt.message+")":""));throw Cn.context=Lt,Cn}var Ai=Wt[ke];if(void 0===Ai)return!1;if("function"==typeof Ai)_e(Ai,this,at);else{var $i=Ai.length,qr=St(Ai,$i);for(Fe=0;Fe<$i;++Fe)_e(qr[Fe],this,at)}return!0},u.prototype.on=u.prototype.addListener=function(ke,at){return Ae(this,ke,at,!1)},u.prototype.prependListener=function(ke,at){return Ae(this,ke,at,!0)},u.prototype.once=function(ke,at){return Me(at),this.on(ke,yt(this,ke,at)),this},u.prototype.prependOnceListener=function(ke,at){return Me(at),this.prependListener(ke,yt(this,ke,at)),this},u.prototype.off=u.prototype.removeListener=function(ke,at){var Fe,Ot,Wt,Lt,Cn;if(Me(at),void 0===(Ot=this._events))return this;if(void 0===(Fe=Ot[ke]))return this;if(Fe===at||Fe.listener===at)0==--this._eventsCount?this._events=Object.create(null):(delete Ot[ke],Ot.removeListener&&this.emit("removeListener",ke,Fe.listener||at));else if("function"!=typeof Fe){for(Wt=-1,Lt=Fe.length-1;Lt>=0;Lt--)if(Fe[Lt]===at||Fe[Lt].listener===at){Cn=Fe[Lt].listener,Wt=Lt;break}if(Wt<0)return this;0===Wt?Fe.shift():function Nt($e,ke){for(;ke+1<$e.length;ke++)$e[ke]=$e[ke+1];$e.pop()}(Fe,Wt),1===Fe.length&&(Ot[ke]=Fe[0]),void 0!==Ot.removeListener&&this.emit("removeListener",ke,Cn||at)}return this},u.prototype.removeAllListeners=function(ke){var at,Fe,Ot;if(void 0===(Fe=this._events))return this;if(void 0===Fe.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Fe[ke]&&(0==--this._eventsCount?this._events=Object.create(null):delete Fe[ke]),this;if(0===arguments.length){var Lt,Wt=Object.keys(Fe);for(Ot=0;Ot<Wt.length;++Ot)"removeListener"!==(Lt=Wt[Ot])&&this.removeAllListeners(Lt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(at=Fe[ke]))this.removeListener(ke,at);else if(void 0!==at)for(Ot=at.length-1;Ot>=0;Ot--)this.removeListener(ke,at[Ot]);return this},u.prototype.listeners=function(ke){return Yt(this,ke,!0)},u.prototype.rawListeners=function(ke){return Yt(this,ke,!1)},u.listenerCount=function($e,ke){return"function"==typeof $e.listenerCount?$e.listenerCount(ke):Bt.call($e,ke)},u.prototype.listenerCount=Bt,u.prototype.eventNames=function(){return this._eventsCount>0?gt(this._events):[]}},424:Zt=>{var _e;Zt.exports=_e={},_e.simpleFilter=function(gt,Ve){return Ve.filter(function(Te){return _e.test(gt,Te)})},_e.test=function(gt,Ve){return null!==_e.match(gt,Ve)},_e.match=function(gt,Ve,Te){var Bt,u=0,Q=[],Me=Ve.length,Le=0,Ae=0,Re=(Te=Te||{}).pre||"",yt=Te.post||"",Yt=Te.caseSensitive&&Ve||Ve.toLowerCase();gt=Te.caseSensitive&&gt||gt.toLowerCase();for(var St=0;St<Me;St++)Bt=Ve[St],Yt[St]===gt[u]?(Bt=Re+Bt+yt,u+=1,Ae+=1+Ae):Ae=0,Le+=Ae,Q[Q.length]=Bt;return u===gt.length?(Le=Yt===gt?1/0:Le,{rendered:Q.join(""),score:Le}):null},_e.filter=function(gt,Ve,Te){return Ve&&0!==Ve.length?"string"!=typeof gt?Ve:(Te=Te||{},Ve.reduce(function(u,Q,Me,Le){var Ae=Q;Te.extract&&(Ae=Te.extract(Q));var Re=_e.match(gt,Ae,Te);return null!=Re&&(u[u.length]={string:Re.rendered,score:Re.score,index:Me,original:Q}),u},[]).sort(function(u,Q){return Q.score-u.score||u.index-Q.index})):[]}},433:function(Zt,qt){!function(_e){"use strict";function Ve(h){var x,M,k,U;for(M=1,k=arguments.length;M<k;M++)for(x in U=arguments[M])h[x]=U[x];return h}var Te=Object.create||function(){function h(){}return function(x){return h.prototype=x,new h}}();function u(h,x){var M=Array.prototype.slice;if(h.bind)return h.bind.apply(h,M.call(arguments,1));var k=M.call(arguments,2);return function(){return h.apply(x,k.length?k.concat(M.call(arguments)):arguments)}}var Q=0;function Me(h){return"_leaflet_id"in h||(h._leaflet_id=++Q),h._leaflet_id}function Le(h,x,M){var k,U,X,xe;return xe=function(){k=!1,U&&(X.apply(M,U),U=!1)},X=function(){k?U=arguments:(h.apply(M,arguments),setTimeout(xe,x),k=!0)},X}function Ae(h,x,M){var k=x[1],U=x[0],X=k-U;return h===k&&M?h:((h-U)%X+X)%X+U}function Re(){return!1}function yt(h,x){if(!1===x)return h;var M=Math.pow(10,void 0===x?6:x);return Math.round(h*M)/M}function Yt(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function Bt(h){return Yt(h).split(/\s+/)}function St(h,x){for(var M in Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?Te(h.options):{}),x)h.options[M]=x[M];return h.options}function Nt(h,x,M){var k=[];for(var U in h)k.push(encodeURIComponent(M?U.toUpperCase():U)+"="+encodeURIComponent(h[U]));return(x&&-1!==x.indexOf("?")?"&":"?")+k.join("&")}var kt=/\{ *([\w_ -]+) *\}/g;function he(h,x){return h.replace(kt,function(M,k){var U=x[k];if(void 0===U)throw new Error("No value provided for variable "+M);return"function"==typeof U&&(U=U(x)),U})}var Je=Array.isArray||function(h){return"[object Array]"===Object.prototype.toString.call(h)};function bt(h,x){for(var M=0;M<h.length;M++)if(h[M]===x)return M;return-1}var $e="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ke(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var at=0;function Fe(h){var x=+new Date,M=Math.max(0,16-(x-at));return at=x+M,window.setTimeout(h,M)}var Ot=window.requestAnimationFrame||ke("RequestAnimationFrame")||Fe,Wt=window.cancelAnimationFrame||ke("CancelAnimationFrame")||ke("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function Lt(h,x,M){if(!M||Ot!==Fe)return Ot.call(window,u(h,x));h.call(x)}function Cn(h){h&&Wt.call(window,h)}var Ai={__proto__:null,extend:Ve,create:Te,bind:u,get lastId(){return Q},stamp:Me,throttle:Le,wrapNum:Ae,falseFn:Re,formatNum:yt,trim:Yt,splitWords:Bt,setOptions:St,getParamString:Nt,template:he,isArray:Je,indexOf:bt,emptyImageUrl:$e,requestFn:Ot,cancelFn:Wt,requestAnimFrame:Lt,cancelAnimFrame:Cn};function $i(){}$i.extend=function(h){var x=function(){St(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},M=x.__super__=this.prototype,k=Te(M);for(var U in k.constructor=x,x.prototype=k,this)Object.prototype.hasOwnProperty.call(this,U)&&"prototype"!==U&&"__super__"!==U&&(x[U]=this[U]);return h.statics&&Ve(x,h.statics),h.includes&&(function qr(h){if(!(typeof L>"u")&&L&&L.Mixin){h=Je(h)?h:[h];for(var x=0;x<h.length;x++)h[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(h.includes),Ve.apply(null,[k].concat(h.includes))),Ve(k,h),delete k.statics,delete k.includes,k.options&&(k.options=M.options?Te(M.options):{},Ve(k.options,h.options)),k._initHooks=[],k.callInitHooks=function(){if(!this._initHooksCalled){M.callInitHooks&&M.callInitHooks.call(this),this._initHooksCalled=!0;for(var X=0,xe=k._initHooks.length;X<xe;X++)k._initHooks[X].call(this)}},x},$i.include=function(h){var x=this.prototype.options;return Ve(this.prototype,h),h.options&&(this.prototype.options=x,this.mergeOptions(h.options)),this},$i.mergeOptions=function(h){return Ve(this.prototype.options,h),this},$i.addInitHook=function(h){var x=Array.prototype.slice.call(arguments,1),M="function"==typeof h?h:function(){this[h].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(M),this};var Er={on:function(h,x,M){if("object"==typeof h)for(var k in h)this._on(k,h[k],x);else for(var U=0,X=(h=Bt(h)).length;U<X;U++)this._on(h[U],x,M);return this},off:function(h,x,M){if(arguments.length)if("object"==typeof h)for(var k in h)this._off(k,h[k],x);else{h=Bt(h);for(var U=1===arguments.length,X=0,xe=h.length;X<xe;X++)U?this._off(h[X]):this._off(h[X],x,M)}else delete this._events;return this},_on:function(h,x,M,k){if("function"==typeof x){if(!1===this._listens(h,x,M)){M===this&&(M=void 0);var U={fn:x,ctx:M};k&&(U.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(U)}}else console.warn("wrong listener type: "+typeof x)},_off:function(h,x,M){var k,U,X;if(this._events&&(k=this._events[h])){if(1===arguments.length){if(this._firingCount)for(U=0,X=k.length;U<X;U++)k[U].fn=Re;return void delete this._events[h]}if("function"!=typeof x)return void console.warn("wrong listener type: "+typeof x);var xe=this._listens(h,x,M);!1!==xe&&(this._firingCount&&(k[xe].fn=Re,this._events[h]=k=k.slice()),k.splice(xe,1))}},fire:function(h,x,M){if(!this.listens(h,M))return this;var k=Ve({},x,{type:h,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var U=this._events[h];if(U){this._firingCount=this._firingCount+1||1;for(var X=0,xe=U.length;X<xe;X++){var He=U[X],Oe=He.fn;He.once&&this.off(h,Oe,He.ctx),Oe.call(He.ctx||this,k)}this._firingCount--}}return M&&this._propagateEvent(k),this},listens:function(h,x,M,k){"string"!=typeof h&&console.warn('"string" type argument expected');var U=x;"function"!=typeof x&&(k=!!x,U=void 0,M=void 0);var X=this._events&&this._events[h];if(X&&X.length&&!1!==this._listens(h,U,M))return!0;if(k)for(var xe in this._eventParents)if(this._eventParents[xe].listens(h,x,M,k))return!0;return!1},_listens:function(h,x,M){if(!this._events)return!1;var k=this._events[h]||[];if(!x)return!!k.length;M===this&&(M=void 0);for(var U=0,X=k.length;U<X;U++)if(k[U].fn===x&&k[U].ctx===M)return U;return!1},once:function(h,x,M){if("object"==typeof h)for(var k in h)this._on(k,h[k],x,!0);else for(var U=0,X=(h=Bt(h)).length;U<X;U++)this._on(h[U],x,M,!0);return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[Me(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[Me(h)],this},_propagateEvent:function(h){for(var x in this._eventParents)this._eventParents[x].fire(h.type,Ve({layer:h.target,propagatedFrom:h.target},h),!0)}};Er.addEventListener=Er.on,Er.removeEventListener=Er.clearAllEventListeners=Er.off,Er.addOneTimeEventListener=Er.once,Er.fireEvent=Er.fire,Er.hasEventListeners=Er.listens;var Tn=$i.extend(Er);function wn(h,x,M){this.x=M?Math.round(h):h,this.y=M?Math.round(x):x}var ir=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};function dn(h,x,M){return h instanceof wn?h:Je(h)?new wn(h[0],h[1]):null==h?h:"object"==typeof h&&"x"in h&&"y"in h?new wn(h.x,h.y):new wn(h,x,M)}function In(h,x){if(h)for(var M=x?[h,x]:h,k=0,U=M.length;k<U;k++)this.extend(M[k])}function ii(h,x){return!h||h instanceof In?h:new In(h,x)}function Hi(h,x){if(h)for(var M=x?[h,x]:h,k=0,U=M.length;k<U;k++)this.extend(M[k])}function Pi(h,x){return h instanceof Hi?h:new Hi(h,x)}function oi(h,x,M){if(isNaN(h)||isNaN(x))throw new Error("Invalid LatLng object: ("+h+", "+x+")");this.lat=+h,this.lng=+x,void 0!==M&&(this.alt=+M)}function Dn(h,x,M){return h instanceof oi?h:Je(h)&&"object"!=typeof h[0]?3===h.length?new oi(h[0],h[1],h[2]):2===h.length?new oi(h[0],h[1]):null:null==h?h:"object"==typeof h&&"lat"in h?new oi(h.lat,"lng"in h?h.lng:h.lon,h.alt):void 0===x?null:new oi(h,x,M)}wn.prototype={clone:function(){return new wn(this.x,this.y)},add:function(h){return this.clone()._add(dn(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(dn(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new wn(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new wn(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ir(this.x),this.y=ir(this.y),this},distanceTo:function(h){var x=(h=dn(h)).x-this.x,M=h.y-this.y;return Math.sqrt(x*x+M*M)},equals:function(h){return(h=dn(h)).x===this.x&&h.y===this.y},contains:function(h){return h=dn(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+yt(this.x)+", "+yt(this.y)+")"}},In.prototype={extend:function(h){var x,M;if(!h)return this;if(h instanceof wn||"number"==typeof h[0]||"x"in h)x=M=dn(h);else if(M=(h=ii(h)).max,!(x=h.min)||!M)return this;return this.min||this.max?(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(M.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(M.y,this.max.y)):(this.min=x.clone(),this.max=M.clone()),this},getCenter:function(h){return dn((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return dn(this.min.x,this.max.y)},getTopRight:function(){return dn(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var x,M;return(h="number"==typeof h[0]||h instanceof wn?dn(h):ii(h))instanceof In?(x=h.min,M=h.max):x=M=h,x.x>=this.min.x&&M.x<=this.max.x&&x.y>=this.min.y&&M.y<=this.max.y},intersects:function(h){h=ii(h);var x=this.min,M=this.max,k=h.min,U=h.max;return U.x>=x.x&&k.x<=M.x&&U.y>=x.y&&k.y<=M.y},overlaps:function(h){h=ii(h);var x=this.min,M=this.max,k=h.min,U=h.max;return U.x>x.x&&k.x<M.x&&U.y>x.y&&k.y<M.y},isValid:function(){return!(!this.min||!this.max)},pad:function(h){var x=this.min,M=this.max,k=Math.abs(x.x-M.x)*h,U=Math.abs(x.y-M.y)*h;return ii(dn(x.x-k,x.y-U),dn(M.x+k,M.y+U))},equals:function(h){return!!h&&(h=ii(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight()))}},Hi.prototype={extend:function(h){var k,U,x=this._southWest,M=this._northEast;if(h instanceof oi)k=h,U=h;else{if(!(h instanceof Hi))return h?this.extend(Dn(h)||Pi(h)):this;if(U=h._northEast,!(k=h._southWest)||!U)return this}return x||M?(x.lat=Math.min(k.lat,x.lat),x.lng=Math.min(k.lng,x.lng),M.lat=Math.max(U.lat,M.lat),M.lng=Math.max(U.lng,M.lng)):(this._southWest=new oi(k.lat,k.lng),this._northEast=new oi(U.lat,U.lng)),this},pad:function(h){var x=this._southWest,M=this._northEast,k=Math.abs(x.lat-M.lat)*h,U=Math.abs(x.lng-M.lng)*h;return new Hi(new oi(x.lat-k,x.lng-U),new oi(M.lat+k,M.lng+U))},getCenter:function(){return new oi((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new oi(this.getNorth(),this.getWest())},getSouthEast:function(){return new oi(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){h="number"==typeof h[0]||h instanceof oi||"lat"in h?Dn(h):Pi(h);var k,U,x=this._southWest,M=this._northEast;return h instanceof Hi?(k=h.getSouthWest(),U=h.getNorthEast()):k=U=h,k.lat>=x.lat&&U.lat<=M.lat&&k.lng>=x.lng&&U.lng<=M.lng},intersects:function(h){h=Pi(h);var x=this._southWest,M=this._northEast,k=h.getSouthWest(),U=h.getNorthEast();return U.lat>=x.lat&&k.lat<=M.lat&&U.lng>=x.lng&&k.lng<=M.lng},overlaps:function(h){h=Pi(h);var x=this._southWest,M=this._northEast,k=h.getSouthWest(),U=h.getNorthEast();return U.lat>x.lat&&k.lat<M.lat&&U.lng>x.lng&&k.lng<M.lng},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,x){return!!h&&(h=Pi(h),this._southWest.equals(h.getSouthWest(),x)&&this._northEast.equals(h.getNorthEast(),x))},isValid:function(){return!(!this._southWest||!this._northEast)}},oi.prototype={equals:function(h,x){return!!h&&(h=Dn(h),Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng))<=(void 0===x?1e-9:x))},toString:function(h){return"LatLng("+yt(this.lat,h)+", "+yt(this.lng,h)+")"},distanceTo:function(h){return ci.distance(this,Dn(h))},wrap:function(){return ci.wrapLatLng(this)},toBounds:function(h){var x=180*h/40075017,M=x/Math.cos(Math.PI/180*this.lat);return Pi([this.lat-x,this.lng-M],[this.lat+x,this.lng+M])},clone:function(){return new oi(this.lat,this.lng,this.alt)}};var h,Zr={latLngToPoint:function(h,x){var M=this.projection.project(h),k=this.scale(x);return this.transformation._transform(M,k)},pointToLatLng:function(h,x){var M=this.scale(x),k=this.transformation.untransform(h,M);return this.projection.unproject(k)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var x=this.projection.bounds,M=this.scale(h);return new In(this.transformation.transform(x.min,M),this.transformation.transform(x.max,M))},infinite:!1,wrapLatLng:function(h){var x=this.wrapLng?Ae(h.lng,this.wrapLng,!0):h.lng;return new oi(this.wrapLat?Ae(h.lat,this.wrapLat,!0):h.lat,x,h.alt)},wrapLatLngBounds:function(h){var x=h.getCenter(),M=this.wrapLatLng(x),k=x.lat-M.lat,U=x.lng-M.lng;if(0===k&&0===U)return h;var X=h.getSouthWest(),xe=h.getNorthEast();return new Hi(new oi(X.lat-k,X.lng-U),new oi(xe.lat-k,xe.lng-U))}},ci=Ve({},Zr,{wrapLng:[-180,180],R:6371e3,distance:function(h,x){var M=Math.PI/180,k=h.lat*M,U=x.lat*M,X=Math.sin((x.lat-h.lat)*M/2),xe=Math.sin((x.lng-h.lng)*M/2),He=X*X+Math.cos(k)*Math.cos(U)*xe*xe,Oe=2*Math.atan2(Math.sqrt(He),Math.sqrt(1-He));return this.R*Oe}}),ln={R:6378137,MAX_LATITUDE:85.0511287798,project:function(h){var x=Math.PI/180,M=this.MAX_LATITUDE,k=Math.max(Math.min(M,h.lat),-M),U=Math.sin(k*x);return new wn(this.R*h.lng*x,this.R*Math.log((1+U)/(1-U))/2)},unproject:function(h){var x=180/Math.PI;return new oi((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*x,h.x*x/this.R)},bounds:(h=6378137*Math.PI,new In([-h,-h],[h,h]))};function ns(h,x,M,k){if(Je(h))return this._a=h[0],this._b=h[1],this._c=h[2],void(this._d=h[3]);this._a=h,this._b=x,this._c=M,this._d=k}function Ln(h,x,M,k){return new ns(h,x,M,k)}ns.prototype={transform:function(h,x){return this._transform(h.clone(),x)},_transform:function(h,x){return h.x=(x=x||1)*(this._a*h.x+this._b),h.y=x*(this._c*h.y+this._d),h},untransform:function(h,x){return new wn((h.x/(x=x||1)-this._b)/this._a,(h.y/x-this._d)/this._c)}};var Os=Ve({},ci,{code:"EPSG:3857",projection:ln,transformation:function(){var h=.5/(Math.PI*ln.R);return Ln(h,.5,-h,.5)}()}),Yi=Ve({},Os,{code:"EPSG:900913"});function go(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function sc(h,x){var k,U,X,xe,He,Oe,M="";for(k=0,X=h.length;k<X;k++){for(U=0,xe=(He=h[k]).length;U<xe;U++)M+=(U?"L":"M")+(Oe=He[U]).x+" "+Oe.y;M+=x?zt.svg?"z":"x":""}return M||"M0 0"}var is=document.documentElement.style,no="ActiveXObject"in window,Hc=no&&!document.addEventListener,Dl="msLaunchUri"in navigator&&!("documentMode"in document),Ml=Mn("webkit"),_a=Mn("android"),Ya=Mn("android 2")||Mn("android 3"),ac=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Gc=_a&&Mn("Google")&&ac<537&&!("AudioNode"in window),io=!!window.opera,Ns=!Dl&&Mn("chrome"),ya=Mn("gecko")&&!Ml&&!io&&!no,va=!Ns&&Mn("safari"),Ka=Mn("phantom"),Sl="OTransition"in is,Ja=0===navigator.platform.indexOf("Win"),ro=no&&"transition"in is,gs="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ya,xa="MozPerspective"in is,Qa=!window.L_DISABLE_3D&&(ro||gs||xa)&&!Sl&&!Ka,ba=typeof orientation<"u"||Mn("mobile"),fe=ba&&Ml,Z=ba&&gs,Y=!window.PointerEvent&&window.MSPointerEvent,ue=!(!window.PointerEvent&&!Y),ye="ontouchstart"in window||!!window.TouchEvent,De=!window.L_NO_TOUCH&&(ye||ue),Be=ba&&io,ze=ba&&ya,Ce=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ye=function(){var h=!1;try{var x=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",Re,x),window.removeEventListener("testPassiveEventSupport",Re,x)}catch{}return h}(),Pt=!!document.createElement("canvas").getContext,Ft=!(!document.createElementNS||!go("svg").createSVGRect),Ct=!!Ft&&function(){var h=document.createElement("div");return h.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(h.firstChild&&h.firstChild.namespaceURI)}(),kn=!Ft&&function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var x=h.firstChild;return x.style.behavior="url(#default#VML)",x&&"object"==typeof x.adj}catch{return!1}}();function Mn(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var zt={ie:no,ielt9:Hc,edge:Dl,webkit:Ml,android:_a,android23:Ya,androidStock:Gc,opera:io,chrome:Ns,gecko:ya,safari:va,phantom:Ka,opera12:Sl,win:Ja,ie3d:ro,webkit3d:gs,gecko3d:xa,any3d:Qa,mobile:ba,mobileWebkit:fe,mobileWebkit3d:Z,msPointer:Y,pointer:ue,touch:De,touchNative:ye,mobileOpera:Be,mobileGecko:ze,retina:Ce,passiveEvents:Ye,canvas:Pt,svg:Ft,vml:kn,inlineSvg:Ct,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},zi=zt.msPointer?"MSPointerDown":"pointerdown",fr=zt.msPointer?"MSPointerMove":"pointermove",Ei=zt.msPointer?"MSPointerUp":"pointerup",Cr=zt.msPointer?"MSPointerCancel":"pointercancel",jo={touchstart:zi,touchmove:fr,touchend:Ei,touchcancel:Cr},Lr={touchstart:function Fs(h,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&xi(x),oo(h,x)},touchmove:oo,touchend:oo,touchcancel:oo},Mr={},wa=!1;function Vd(h,x,M){return"touchstart"===x&&function Ea(){wa||(document.addEventListener(zi,Yn,!0),document.addEventListener(fr,Iu,!0),document.addEventListener(Ei,vr,!0),document.addEventListener(Cr,vr,!0),wa=!0)}(),Lr[x]?(M=Lr[x].bind(this,M),h.addEventListener(jo[x],M,!1),M):(console.warn("wrong event specified:",x),Re)}function Yn(h){Mr[h.pointerId]=h}function Iu(h){Mr[h.pointerId]&&(Mr[h.pointerId]=h)}function vr(h){delete Mr[h.pointerId]}function oo(h,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){for(var M in x.touches=[],Mr)x.touches.push(Mr[M]);x.changedTouches=[x],h(x)}}var Au=200;var fi,sr,Po,tl,js,_o=Gi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Bs=Gi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),tt="webkitTransition"===Bs||"OTransition"===Bs?Bs+"End":"transitionend";function rs(h){return"string"==typeof h?document.getElementById(h):h}function Ki(h,x){var M=h.style[x]||h.currentStyle&&h.currentStyle[x];if((!M||"auto"===M)&&document.defaultView){var k=document.defaultView.getComputedStyle(h,null);M=k?k[x]:null}return"auto"===M?null:M}function On(h,x,M){var k=document.createElement(h);return k.className=x||"",M&&M.appendChild(k),k}function rr(h){var x=h.parentNode;x&&x.removeChild(h)}function Ao(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Vs(h){var x=h.parentNode;x&&x.lastChild!==h&&x.appendChild(h)}function el(h){var x=h.parentNode;x&&x.firstChild!==h&&x.insertBefore(h,x.firstChild)}function Ta(h,x){if(void 0!==h.classList)return h.classList.contains(x);var M=fn(h);return M.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(M)}function it(h,x){if(void 0!==h.classList)for(var M=Bt(x),k=0,U=M.length;k<U;k++)h.classList.add(M[k]);else if(!Ta(h,x)){var X=fn(h);mn(h,(X?X+" ":"")+x)}}function yn(h,x){void 0!==h.classList?h.classList.remove(x):mn(h,Yt((" "+fn(h)+" ").replace(" "+x+" "," ")))}function mn(h,x){void 0===h.className.baseVal?h.className=x:h.className.baseVal=x}function fn(h){return h.correspondingElement&&(h=h.correspondingElement),void 0===h.className.baseVal?h.className:h.className.baseVal}function or(h,x){"opacity"in h.style?h.style.opacity=x:"filter"in h.style&&function qn(h,x){var M=!1,k="DXImageTransform.Microsoft.Alpha";try{M=h.filters.item(k)}catch{if(1===x)return}x=Math.round(100*x),M?(M.Enabled=100!==x,M.Opacity=x):h.style.filter+=" progid:"+k+"(opacity="+x+")"}(h,x)}function Gi(h){for(var x=document.documentElement.style,M=0;M<h.length;M++)if(h[M]in x)return h[M];return!1}function os(h,x,M){var k=x||new wn(0,0);h.style[_o]=(zt.ie3d?"translate("+k.x+"px,"+k.y+"px)":"translate3d("+k.x+"px,"+k.y+"px,0)")+(M?" scale("+M+")":"")}function qi(h,x){h._leaflet_pos=x,zt.any3d?os(h,x):(h.style.left=x.x+"px",h.style.top=x.y+"px")}function jn(h){return h._leaflet_pos||new wn(0,0)}if("onselectstart"in document)fi=function(){on(window,"selectstart",xi)},sr=function(){ri(window,"selectstart",xi)};else{var Us=Gi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);fi=function(){if(Us){var h=document.documentElement.style;Po=h[Us],h[Us]="none"}},sr=function(){Us&&(document.documentElement.style[Us]=Po,Po=void 0)}}function vi(){on(window,"dragstart",xi)}function An(){ri(window,"dragstart",xi)}function Il(h){for(;-1===h.tabIndex;)h=h.parentNode;h.style&&(Da(),tl=h,js=h.style.outlineStyle,h.style.outlineStyle="none",on(window,"keydown",Da))}function Da(){tl&&(tl.style.outlineStyle=js,tl=void 0,js=void 0,ri(window,"keydown",Da))}function Mt(h){do{h=h.parentNode}while(!(h.offsetWidth&&h.offsetHeight||h===document.body));return h}function kr(h){var x=h.getBoundingClientRect();return{x:x.width/h.offsetWidth||1,y:x.height/h.offsetHeight||1,boundingClientRect:x}}var cn={__proto__:null,TRANSFORM:_o,TRANSITION:Bs,TRANSITION_END:tt,get:rs,getStyle:Ki,create:On,remove:rr,empty:Ao,toFront:Vs,toBack:el,hasClass:Ta,addClass:it,removeClass:yn,setClass:mn,getClass:fn,setOpacity:or,testProp:Gi,setTransform:os,setPosition:qi,getPosition:jn,get disableTextSelection(){return fi},get enableTextSelection(){return sr},disableImageDrag:vi,enableImageDrag:An,preventOutline:Il,restoreOutline:Da,getSizedParentNode:Mt,getScale:kr};function on(h,x,M,k){if(x&&"object"==typeof x)for(var U in x)Or(h,U,x[U],M);else for(var X=0,xe=(x=Bt(x)).length;X<xe;X++)Or(h,x[X],M,k);return this}var $o="_leaflet_events";function ri(h,x,M,k){if(1===arguments.length)Ro(h),delete h[$o];else if(x&&"object"==typeof x)for(var U in x)ar(h,U,x[U],M);else if(x=Bt(x),2===arguments.length)Ro(h,function(He){return-1!==bt(x,He)});else for(var X=0,xe=x.length;X<xe;X++)ar(h,x[X],M,k);return this}function Ro(h,x){for(var M in h[$o]){var k=M.split(/\d/)[0];(!x||x(k))&&ar(h,k,null,null,M)}}var Al={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Or(h,x,M,k){var U=x+Me(M)+(k?"_"+Me(k):"");if(h[$o]&&h[$o][U])return this;var X=function(He){return M.call(k||h,He||window.event)},xe=X;!zt.touchNative&&zt.pointer&&0===x.indexOf("touch")?X=Vd(h,x,X):zt.touch&&"dblclick"===x?X=function lc(h,x){h.addEventListener("dblclick",x);var k,M=0;function U(X){if(1===X.detail){if("mouse"!==X.pointerType&&(!X.sourceCapabilities||X.sourceCapabilities.firesTouchEvents)){var xe=Pu(X);if(!xe.some(function(Oe){return Oe instanceof HTMLLabelElement&&Oe.attributes.for})||xe.some(function(Oe){return Oe instanceof HTMLInputElement||Oe instanceof HTMLSelectElement})){var He=Date.now();He-M<=Au?2==++k&&x(function zs(h){var M,k,x={};for(k in h)x[k]=(M=h[k])&&M.bind?M.bind(h):M;return h=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}(X)):k=1,M=He}}}else k=X.detail}return h.addEventListener("click",U),{dblclick:x,simDblclick:U}}(h,X):"addEventListener"in h?"touchstart"===x||"touchmove"===x||"wheel"===x||"mousewheel"===x?h.addEventListener(Al[x]||x,X,!!zt.passiveEvents&&{passive:!1}):"mouseenter"===x||"mouseleave"===x?h.addEventListener(Al[x],X=function(He){He=He||window.event,Ru(h,He)&&xe(He)},!1):h.addEventListener(x,xe,!1):h.attachEvent("on"+x,X),h[$o]=h[$o]||{},h[$o][U]=X}function ar(h,x,M,k,U){U=U||x+Me(M)+(k?"_"+Me(k):"");var X=h[$o]&&h[$o][U];if(!X)return this;!zt.touchNative&&zt.pointer&&0===x.indexOf("touch")?function Ah(h,x,M){jo[x]?h.removeEventListener(jo[x],M,!1):console.warn("wrong event specified:",x)}(h,x,X):zt.touch&&"dblclick"===x?function Ca(h,x){h.removeEventListener("dblclick",x.dblclick),h.removeEventListener("click",x.simDblclick)}(h,X):"removeEventListener"in h?h.removeEventListener(Al[x]||x,X,!1):h.detachEvent("on"+x,X),h[$o][U]=null}function ss(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function qc(h){return Or(h,"wheel",ss),this}function Wr(h){return on(h,"mousedown touchstart dblclick contextmenu",ss),h._leaflet_disable_click=!0,this}function xi(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function Ma(h){return xi(h),ss(h),this}function Pu(h){if(h.composedPath)return h.composedPath();for(var x=[],M=h.target;M;)x.push(M),M=M.parentNode;return x}function $s(h,x){if(!x)return new wn(h.clientX,h.clientY);var M=kr(x),k=M.boundingClientRect;return new wn((h.clientX-k.left)/M.x-x.clientLeft,(h.clientY-k.top)/M.y-x.clientTop)}var Sa=zt.linux&&zt.chrome?window.devicePixelRatio:zt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Zc(h){return zt.edge?h.wheelDeltaY/2:h.deltaY&&0===h.deltaMode?-h.deltaY/Sa:h.deltaY&&1===h.deltaMode?20*-h.deltaY:h.deltaY&&2===h.deltaMode?60*-h.deltaY:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?20*-h.detail:h.detail?h.detail/-32765*60:0}function Ru(h,x){var M=x.relatedTarget;if(!M)return!0;try{for(;M&&M!==h;)M=M.parentNode}catch{return!1}return M!==h}var Ph={__proto__:null,on,off:ri,stopPropagation:ss,disableScrollPropagation:qc,disableClickPropagation:Wr,preventDefault:xi,stop:Ma,getPropagationPath:Pu,getMousePosition:$s,getWheelDelta:Zc,isExternalTarget:Ru,addListener:on,removeListener:ri},Ur=Tn.extend({run:function(h,x,M,k){this.stop(),this._el=h,this._inProgress=!0,this._duration=M||.25,this._easeOutPower=1/Math.max(k||.5,.2),this._startPos=jn(h),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Lt(this._animate,this),this._step()},_step:function(h){var x=+new Date-this._startTime,M=1e3*this._duration;x<M?this._runFrame(this._easeOut(x/M),h):(this._runFrame(1),this._complete())},_runFrame:function(h,x){var M=this._startPos.add(this._offset.multiplyBy(h));x&&M._round(),qi(this._el,M),this.fire("step")},_complete:function(){Cn(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),Ut=Tn.extend({options:{crs:Os,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,x){x=St(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),void 0!==x.zoom&&(this._zoom=this._limitZoom(x.zoom)),x.center&&void 0!==x.zoom&&this.setView(Dn(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Bs&&zt.any3d&&!zt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),on(this._proxy,tt,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,x,M){return x=void 0===x?this._zoom:this._limitZoom(x),h=this._limitCenter(Dn(h),x,this.options.maxBounds),M=M||{},this._stop(),this._loaded&&!M.reset&&!0!==M&&(void 0!==M.animate&&(M.zoom=Ve({animate:M.animate},M.zoom),M.pan=Ve({animate:M.animate,duration:M.duration},M.pan)),this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,x,M.zoom):this._tryAnimatedPan(h,M.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(h,x,M.pan&&M.pan.noMoveStart),this)},setZoom:function(h,x){return this._loaded?this.setView(this.getCenter(),h,{zoom:x}):(this._zoom=h,this)},zoomIn:function(h,x){return this.setZoom(this._zoom+(h=h||(zt.any3d?this.options.zoomDelta:1)),x)},zoomOut:function(h,x){return this.setZoom(this._zoom-(h=h||(zt.any3d?this.options.zoomDelta:1)),x)},setZoomAround:function(h,x,M){var k=this.getZoomScale(x),U=this.getSize().divideBy(2),xe=(h instanceof wn?h:this.latLngToContainerPoint(h)).subtract(U).multiplyBy(1-1/k),He=this.containerPointToLatLng(U.add(xe));return this.setView(He,x,{zoom:M})},_getBoundsCenterZoom:function(h,x){x=x||{},h=h.getBounds?h.getBounds():Pi(h);var M=dn(x.paddingTopLeft||x.padding||[0,0]),k=dn(x.paddingBottomRight||x.padding||[0,0]),U=this.getBoundsZoom(h,!1,M.add(k));if((U="number"==typeof x.maxZoom?Math.min(x.maxZoom,U):U)===1/0)return{center:h.getCenter(),zoom:U};var X=k.subtract(M).divideBy(2),xe=this.project(h.getSouthWest(),U),He=this.project(h.getNorthEast(),U);return{center:this.unproject(xe.add(He).divideBy(2).add(X),U),zoom:U}},fitBounds:function(h,x){if(!(h=Pi(h)).isValid())throw new Error("Bounds are not valid.");var M=this._getBoundsCenterZoom(h,x);return this.setView(M.center,M.zoom,x)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,x){return this.setView(h,this._zoom,{pan:x})},panBy:function(h,x){if(x=x||{},!(h=dn(h).round()).x&&!h.y)return this.fire("moveend");if(!0!==x.animate&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ur,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),!1!==x.animate){it(this._mapPane,"leaflet-pan-anim");var M=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,M,x.duration||.25,x.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,x,M){if(!1===(M=M||{}).animate||!zt.any3d)return this.setView(h,x,M);this._stop();var k=this.project(this.getCenter()),U=this.project(h),X=this.getSize(),xe=this._zoom;h=Dn(h),x=void 0===x?xe:x;var He=Math.max(X.x,X.y),Oe=He*this.getZoomScale(xe,x),Tt=U.distanceTo(k)||1,rn=1.42,xn=rn*rn;function vn(ur){var fl=(Oe*Oe-He*He+(ur?-1:1)*xn*xn*Tt*Tt)/(2*(ur?Oe:He)*xn*Tt),zr=Math.sqrt(fl*fl+1)-fl;return zr<1e-9?-18:Math.log(zr)}function Fr(ur){return(Math.exp(ur)-Math.exp(-ur))/2}function cr(ur){return(Math.exp(ur)+Math.exp(-ur))/2}var Sr=vn(0);function ws(ur){return He*(cr(Sr)*function Wi(ur){return Fr(ur)/cr(ur)}(Sr+rn*ur)-Fr(Sr))/xn}var Qs=Date.now(),Es=(vn(1)-Sr)/rn,ni=M.duration?1e3*M.duration:1e3*Es*.8;return this._moveStart(!0,M.noMoveStart),function Fh(){var ur=(Date.now()-Qs)/ni,jl=function Xo(ur){return 1-Math.pow(1-ur,1.5)}(ur)*Es;ur<=1?(this._flyToFrame=Lt(Fh,this),this._move(this.unproject(k.add(U.subtract(k).multiplyBy(ws(jl)/Tt)),xe),this.getScaleZoom(He/function Js(ur){return He*(cr(Sr)/cr(Sr+rn*ur))}(jl),xe),{flyTo:!0})):this._move(h,x)._moveEnd(!0)}.call(this),this},flyToBounds:function(h,x){var M=this._getBoundsCenterZoom(h,x);return this.flyTo(M.center,M.zoom,x)},setMaxBounds:function(h){return h=Pi(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var x=this.options.minZoom;return this.options.minZoom=h,this._loaded&&x!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var x=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&x!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,x){this._enforcingBounds=!0;var M=this.getCenter(),k=this._limitCenter(M,this._zoom,Pi(h));return M.equals(k)||this.panTo(k,x),this._enforcingBounds=!1,this},panInside:function(h,x){var M=dn((x=x||{}).paddingTopLeft||x.padding||[0,0]),k=dn(x.paddingBottomRight||x.padding||[0,0]),U=this.project(this.getCenter()),X=this.project(h),xe=this.getPixelBounds(),He=ii([xe.min.add(M),xe.max.subtract(k)]),Oe=He.getSize();if(!He.contains(X)){this._enforcingBounds=!0;var Tt=X.subtract(He.getCenter()),rn=He.extend(X).getSize().subtract(Oe);U.x+=Tt.x<0?-rn.x:rn.x,U.y+=Tt.y<0?-rn.y:rn.y,this.panTo(this.unproject(U),x),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=Ve({animate:!1,pan:!0},!0===h?{animate:!0}:h);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var M=this.getSize(),k=x.divideBy(2).round(),U=M.divideBy(2).round(),X=k.subtract(U);return X.x||X.y?(h.animate&&h.pan?this.panBy(X):(h.pan&&this._rawPanBy(X),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:M})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=Ve({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=u(this._handleGeolocationResponse,this),M=u(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,M,h):navigator.geolocation.getCurrentPosition(x,M,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var x=h.code,M=h.message||(1===x?"permission denied":2===x?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+M+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var k=new oi(h.coords.latitude,h.coords.longitude),U=k.toBounds(2*h.coords.accuracy),X=this._locateOptions;if(X.setView){var xe=this.getBoundsZoom(U);this.setView(k,X.maxZoom?Math.min(xe,X.maxZoom):xe)}var He={latlng:k,bounds:U,timestamp:h.timestamp};for(var Oe in h.coords)"number"==typeof h.coords[Oe]&&(He[Oe]=h.coords[Oe]);this.fire("locationfound",He)}},addHandler:function(h,x){if(!x)return this;var M=this[h]=new x(this);return this._handlers.push(M),this.options[h]&&M.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}var h;for(h in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),rr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Cn(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[h].remove();for(h in this._panes)rr(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,x){var k=On("div","leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),x||this._mapPane);return h&&(this._panes[h]=k),k},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds();return new Hi(this.unproject(h.getBottomLeft()),this.unproject(h.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,x,M){h=Pi(h),M=dn(M||[0,0]);var k=this.getZoom()||0,U=this.getMinZoom(),X=this.getMaxZoom(),xe=h.getNorthWest(),He=h.getSouthEast(),Oe=this.getSize().subtract(M),Tt=ii(this.project(He,k),this.project(xe,k)).getSize(),rn=zt.any3d?this.options.zoomSnap:1,xn=Oe.x/Tt.x,vn=Oe.y/Tt.y,Fr=x?Math.max(xn,vn):Math.min(xn,vn);return k=this.getScaleZoom(Fr,k),rn&&(k=Math.round(k/(rn/100))*(rn/100),k=x?Math.ceil(k/rn)*rn:Math.floor(k/rn)*rn),Math.max(U,Math.min(X,k))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new wn(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,x){var M=this._getTopLeftPoint(h,x);return new In(M,M.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(void 0===h?this.getZoom():h)},getPane:function(h){return"string"==typeof h?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,x){var M=this.options.crs;return x=void 0===x?this._zoom:x,M.scale(h)/M.scale(x)},getScaleZoom:function(h,x){var M=this.options.crs,k=M.zoom(h*M.scale(x=void 0===x?this._zoom:x));return isNaN(k)?1/0:k},project:function(h,x){return x=void 0===x?this._zoom:x,this.options.crs.latLngToPoint(Dn(h),x)},unproject:function(h,x){return x=void 0===x?this._zoom:x,this.options.crs.pointToLatLng(dn(h),x)},layerPointToLatLng:function(h){var x=dn(h).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(h){return this.project(Dn(h))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(Dn(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(Pi(h))},distance:function(h,x){return this.options.crs.distance(Dn(h),Dn(x))},containerPointToLayerPoint:function(h){return dn(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return dn(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var x=this.containerPointToLayerPoint(dn(h));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Dn(h)))},mouseEventToContainerPoint:function(h){return $s(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var x=this._container=rs(h);if(!x)throw new Error("Map container not found.");if(x._leaflet_id)throw new Error("Map container is already initialized.");on(x,"scroll",this._onScroll,this),this._containerId=Me(x)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&zt.any3d,it(h,"leaflet-container"+(zt.touch?" leaflet-touch":"")+(zt.retina?" leaflet-retina":"")+(zt.ielt9?" leaflet-oldie":"")+(zt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=Ki(h,"position");"absolute"!==x&&"relative"!==x&&"fixed"!==x&&"sticky"!==x&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),qi(this._mapPane,new wn(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(it(h.markerPane,"leaflet-zoom-hide"),it(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,x,M){qi(this._mapPane,new wn(0,0));var k=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var U=this._zoom!==x;this._moveStart(U,M)._move(h,x)._moveEnd(U),this.fire("viewreset"),k&&this.fire("load")},_moveStart:function(h,x){return h&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(h,x,M,k){void 0===x&&(x=this._zoom);var U=this._zoom!==x;return this._zoom=x,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),k?M&&M.pinch&&this.fire("zoom",M):((U||M&&M.pinch)&&this.fire("zoom",M),this.fire("move",M)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Cn(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){qi(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[Me(this._container)]=this;var x=h?ri:on;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),zt.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Cn(this._resizeRequest),this._resizeRequest=Lt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,x){for(var k,M=[],U="mouseout"===x||"mouseover"===x,X=h.target||h.srcElement,xe=!1;X;){if((k=this._targets[Me(X)])&&("click"===x||"preclick"===x)&&this._draggableMoved(k)){xe=!0;break}if(k&&k.listens(x,!0)&&(U&&!Ru(X,h)||(M.push(k),U))||X===this._container)break;X=X.parentNode}return!M.length&&!xe&&!U&&this.listens(x,!0)&&(M=[this]),M},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var x=h.target||h.srcElement;if(!(!this._loaded||x._leaflet_disable_events||"click"===h.type&&this._isClickDisabled(x))){var M=h.type;"mousedown"===M&&Il(x),this._fireDOMEvent(h,M)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,x,M){if("click"===h.type){var k=Ve({},h);k.type="preclick",this._fireDOMEvent(k,k.type,M)}var U=this._findEventTargets(h,x);if(M){for(var X=[],xe=0;xe<M.length;xe++)M[xe].listens(x,!0)&&X.push(M[xe]);U=X.concat(U)}if(U.length){"contextmenu"===x&&xi(h);var He=U[0],Oe={originalEvent:h};if("keypress"!==h.type&&"keydown"!==h.type&&"keyup"!==h.type){var Tt=He.getLatLng&&(!He._radius||He._radius<=10);Oe.containerPoint=Tt?this.latLngToContainerPoint(He.getLatLng()):this.mouseEventToContainerPoint(h),Oe.layerPoint=this.containerPointToLayerPoint(Oe.containerPoint),Oe.latlng=Tt?He.getLatLng():this.layerPointToLatLng(Oe.layerPoint)}for(xe=0;xe<U.length;xe++)if(U[xe].fire(x,Oe,!0),Oe.originalEvent._stopped||!1===U[xe].options.bubblingMouseEvents&&-1!==bt(this._mouseEvents,x))return}},_draggableMoved:function(h){return(h=h.dragging&&h.dragging.enabled()?h:this).dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,x=this._handlers.length;h<x;h++)this._handlers[h].disable()},whenReady:function(h,x){return this._loaded?h.call(x||this,{target:this}):this.on("load",h,x),this},_getMapPanePos:function(){return jn(this._mapPane)||new wn(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,x){return(h&&void 0!==x?this._getNewPixelOrigin(h,x):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,x){var M=this.getSize()._divideBy(2);return this.project(h,x)._subtract(M)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,x,M){var k=this._getNewPixelOrigin(M,x);return this.project(h,x)._subtract(k)},_latLngBoundsToNewLayerBounds:function(h,x,M){var k=this._getNewPixelOrigin(M,x);return ii([this.project(h.getSouthWest(),x)._subtract(k),this.project(h.getNorthWest(),x)._subtract(k),this.project(h.getSouthEast(),x)._subtract(k),this.project(h.getNorthEast(),x)._subtract(k)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,x,M){if(!M)return h;var k=this.project(h,x),U=this.getSize().divideBy(2),X=new In(k.subtract(U),k.add(U)),xe=this._getBoundsOffset(X,M,x);return Math.abs(xe.x)<=1&&Math.abs(xe.y)<=1?h:this.unproject(k.add(xe),x)},_limitOffset:function(h,x){if(!x)return h;var M=this.getPixelBounds(),k=new In(M.min.add(h),M.max.add(h));return h.add(this._getBoundsOffset(k,x))},_getBoundsOffset:function(h,x,M){var k=ii(this.project(x.getNorthEast(),M),this.project(x.getSouthWest(),M)),U=k.min.subtract(h.min),X=k.max.subtract(h.max);return new wn(this._rebound(U.x,-X.x),this._rebound(U.y,-X.y))},_rebound:function(h,x){return h+x>0?Math.round(h-x)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(x))},_limitZoom:function(h){var x=this.getMinZoom(),M=this.getMaxZoom(),k=zt.any3d?this.options.zoomSnap:1;return k&&(h=Math.round(h/k)*k),Math.max(x,Math.min(M,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){yn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,x){var M=this._getCenterOffset(h)._trunc();return!(!0!==(x&&x.animate)&&!this.getSize().contains(M)||(this.panBy(M,x),0))},_createAnimProxy:function(){var h=this._proxy=On("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(x){var M=_o,k=this._proxy.style[M];os(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),k===this._proxy.style[M]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){rr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),x=this.getZoom();os(this._proxy,this.project(h,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,x,M){if(this._animatingZoom)return!0;if(M=M||{},!this._zoomAnimated||!1===M.animate||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var k=this.getZoomScale(x),U=this._getCenterOffset(h)._divideBy(1-1/k);return!(!0!==M.animate&&!this.getSize().contains(U)||(Lt(function(){this._moveStart(!0,M.noMoveStart||!1)._animateZoom(h,x,!0)},this),0))},_animateZoom:function(h,x,M,k){this._mapPane&&(M&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=x,it(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:x,noUpdate:k}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&yn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var so=$i.extend({options:{position:"topright"},initialize:function(h){St(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var x=this._map;return x&&x.removeControl(this),this.options.position=h,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var x=this._container=this.onAdd(h),M=this.getPosition(),k=h._controlCorners[M];return it(x,"leaflet-control"),-1!==M.indexOf("bottom")?k.insertBefore(x,k.firstChild):k.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(rr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),Ho=function(h){return new so(h)};Ut.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},x="leaflet-",M=this._controlContainer=On("div",x+"control-container",this._container);function k(U,X){h[U+X]=On("div",x+U+" "+x+X,M)}k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)rr(this._controlCorners[h]);rr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var an=so.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,x,M,k){return M<k?-1:k<M?1:0}},initialize:function(h,x,M){for(var k in St(this,M),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,h)this._addLayer(h[k],k);for(k in x)this._addLayer(x[k],k,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return so.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,x){return this._addLayer(h,x),this._map?this._update():this},addOverlay:function(h,x){return this._addLayer(h,x,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var x=this._getLayer(Me(h));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){it(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(it(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):yn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return yn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",x=this._container=On("div",h),M=this.options.collapsed;x.setAttribute("aria-haspopup",!0),Wr(x),qc(x);var k=this._section=On("section",h+"-list");M&&(this._map.on("click",this.collapse,this),on(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var U=this._layersLink=On("a",h+"-toggle",x);U.href="#",U.title="Layers",U.setAttribute("role","button"),on(U,{keydown:function(X){13===X.keyCode&&this._expandSafely()},click:function(X){xi(X),this._expandSafely()}},this),M||this.expand(),this._baseLayersList=On("div",h+"-base",k),this._separator=On("div",h+"-separator",k),this._overlaysList=On("div",h+"-overlays",k),x.appendChild(k)},_getLayer:function(h){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&Me(this._layers[x].layer)===h)return this._layers[x]},_addLayer:function(h,x,M){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:x,overlay:M}),this.options.sortLayers&&this._layers.sort(u(function(k,U){return this.options.sortFunction(k.layer,U.layer,k.name,U.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ao(this._baseLayersList),Ao(this._overlaysList),this._layerControlInputs=[];var h,x,M,k,U=0;for(M=0;M<this._layers.length;M++)this._addItem(k=this._layers[M]),x=x||k.overlay,h=h||!k.overlay,U+=k.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(h=h&&U>1)?"":"none"),this._separator.style.display=x&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var x=this._getLayer(Me(h.target)),M=x.overlay?"add"===h.type?"overlayadd":"overlayremove":"add"===h.type?"baselayerchange":null;M&&this._map.fire(M,x)},_createRadioElement:function(h,x){var M='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(x?' checked="checked"':"")+"/>",k=document.createElement("div");return k.innerHTML=M,k.firstChild},_addItem:function(h){var k,x=document.createElement("label"),M=this._map.hasLayer(h.layer);h.overlay?((k=document.createElement("input")).type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=M):k=this._createRadioElement("leaflet-base-layers_"+Me(this),M),this._layerControlInputs.push(k),k.layerId=Me(h.layer),on(k,"click",this._onInputClick,this);var U=document.createElement("span");U.innerHTML=" "+h.name;var X=document.createElement("span");return x.appendChild(X),X.appendChild(k),X.appendChild(U),(h.overlay?this._overlaysList:this._baseLayersList).appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var x,M,h=this._layerControlInputs,k=[],U=[];this._handlingClick=!0;for(var X=h.length-1;X>=0;X--)M=this._getLayer((x=h[X]).layerId).layer,x.checked?k.push(M):x.checked||U.push(M);for(X=0;X<U.length;X++)this._map.hasLayer(U[X])&&this._map.removeLayer(U[X]);for(X=0;X<k.length;X++)this._map.hasLayer(k[X])||this._map.addLayer(k[X]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var x,M,h=this._layerControlInputs,k=this._map.getZoom(),U=h.length-1;U>=0;U--)M=this._getLayer((x=h[U]).layerId).layer,x.disabled=void 0!==M.options.minZoom&&k<M.options.minZoom||void 0!==M.options.maxZoom&&k>M.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,on(h,"click",xi),this.expand();var x=this;setTimeout(function(){ri(h,"click",xi),x._preventClick=!1})}}),Nr=so.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var x="leaflet-control-zoom",M=On("div",x+" leaflet-bar"),k=this.options;return this._zoomInButton=this._createButton(k.zoomInText,k.zoomInTitle,x+"-in",M,this._zoomIn),this._zoomOutButton=this._createButton(k.zoomOutText,k.zoomOutTitle,x+"-out",M,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),M},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,x,M,k,U){var X=On("a",M,k);return X.innerHTML=h,X.href="#",X.title=x,X.setAttribute("role","button"),X.setAttribute("aria-label",x),Wr(X),on(X,"click",Ma),on(X,"click",U,this),on(X,"click",this._refocusOnMap,this),X},_updateDisabled:function(){var h=this._map,x="leaflet-disabled";yn(this._zoomInButton,x),yn(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(it(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(it(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ut.mergeOptions({zoomControl:!0}),Ut.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Nr,this.addControl(this.zoomControl))});var Pl=so.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var x="leaflet-control-scale",M=On("div",x),k=this.options;return this._addScales(k,x+"-line",M),h.on(k.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),M},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,x,M){h.metric&&(this._mScale=On("div",x,M)),h.imperial&&(this._iScale=On("div",x,M))},_update:function(){var h=this._map,x=h.getSize().y/2,M=h.distance(h.containerPointToLatLng([0,x]),h.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(M)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var x=this._getRoundNum(h);this._updateScale(this._mScale,x<1e3?x+" m":x/1e3+" km",x/h)},_updateImperial:function(h){var M,k,U,x=3.2808399*h;x>5280?(k=this._getRoundNum(M=x/5280),this._updateScale(this._iScale,k+" mi",k/M)):(U=this._getRoundNum(x),this._updateScale(this._iScale,U+" ft",U/x))},_updateScale:function(h,x,M){h.style.width=Math.round(this.options.maxWidth*M)+"px",h.innerHTML=x},_getRoundNum:function(h){var x=Math.pow(10,(Math.floor(h)+"").length-1),M=h/x;return x*(M>=10?10:M>=5?5:M>=3?3:M>=2?2:1)}}),Aa=so.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(zt.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(h){St(this,h),this._attributions={}},onAdd:function(h){for(var x in h.attributionControl=this,this._container=On("div","leaflet-control-attribution"),Wr(this._container),h._layers)h._layers[x].getAttribution&&this.addAttribution(h._layers[x].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var x in this._attributions)this._attributions[x]&&h.push(x);var M=[];this.options.prefix&&M.push(this.options.prefix),h.length&&M.push(h.join(", ")),this._container.innerHTML=M.join(' <span aria-hidden="true">|</span> ')}}});Ut.mergeOptions({attributionControl:!0}),Ut.addInitHook(function(){this.options.attributionControl&&(new Aa).addTo(this)});so.Layers=an,so.Zoom=Nr,so.Scale=Pl,so.Attribution=Aa,Ho.layers=function(h,x,M){return new an(h,x,M)},Ho.zoom=function(h){return new Nr(h)},Ho.scale=function(h){return new Pl(h)},Ho.attribution=function(h){return new Aa(h)};var Xr=$i.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Xr.addTo=function(h,x){return h.addHandler(x,this),this};var ui={Events:Er},Lh=zt.touch?"touchstart mousedown":"mousedown",$n=Tn.extend({options:{clickTolerance:3},initialize:function(h,x,M,k){St(this,k),this._element=h,this._dragStartTarget=x||h,this._preventOutline=M},enable:function(){this._enabled||(on(this._dragStartTarget,Lh,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&($n._dragging===this&&this.finishDrag(!0),ri(this._dragStartTarget,Lh,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!Ta(this._element,"leaflet-zoom-anim"))){if(h.touches&&1!==h.touches.length)return void($n._dragging===this&&this.finishDrag());if(!($n._dragging||h.shiftKey||1!==h.which&&1!==h.button&&!h.touches||($n._dragging=this,this._preventOutline&&Il(this._element),vi(),fi(),this._moving))){this.fire("down");var x=h.touches?h.touches[0]:h,M=Mt(this._element);this._startPoint=new wn(x.clientX,x.clientY),this._startPos=jn(this._element),this._parentScale=kr(M);var k="mousedown"===h.type;on(document,k?"mousemove":"touchmove",this._onMove,this),on(document,k?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1)return void(this._moved=!0);var x=h.touches&&1===h.touches.length?h.touches[0]:h,M=new wn(x.clientX,x.clientY)._subtract(this._startPoint);!M.x&&!M.y||Math.abs(M.x)+Math.abs(M.y)<this.options.clickTolerance||(M.x/=this._parentScale.x,M.y/=this._parentScale.y,xi(h),this._moved||(this.fire("dragstart"),this._moved=!0,it(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),it(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(M),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),qi(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){yn(document.body,"leaflet-dragging"),this._lastTarget&&(yn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ri(document,"mousemove touchmove",this._onMove,this),ri(document,"mouseup touchend touchcancel",this._onUp,this),An(),sr();var x=this._moved&&this._moving;this._moving=!1,$n._dragging=!1,x&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function cc(h,x,M){var k,X,xe,He,Oe,Tt,rn,xn,vn,U=[1,4,2,8];for(X=0,rn=h.length;X<rn;X++)h[X]._code=Gs(h[X],x);for(He=0;He<4;He++){for(xn=U[He],k=[],X=0,xe=(rn=h.length)-1;X<rn;xe=X++)Tt=h[xe],(Oe=h[X])._code&xn?Tt._code&xn||((vn=Ra(Tt,Oe,xn,x,M))._code=Gs(vn,x),k.push(vn)):(Tt._code&xn&&((vn=Ra(Tt,Oe,xn,x,M))._code=Gs(vn,x),k.push(vn)),k.push(Oe));h=k}return h}function uc(h,x){var M,k,U,X,xe,He,Oe,Tt;if(!h||0===h.length)throw new Error("latlngs not passed");Lo(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var xn=Dn([0,0]),vn=Pi(h);vn.getNorthWest().distanceTo(vn.getSouthWest())*vn.getNorthEast().distanceTo(vn.getNorthWest())<1700&&(xn=Yr(h));var cr=h.length,Wi=[];for(M=0;M<cr;M++){var Sr=Dn(h[M]);Wi.push(x.project(Dn([Sr.lat-xn.lat,Sr.lng-xn.lng])))}for(He=Oe=Tt=0,M=0,k=cr-1;M<cr;k=M++)Oe+=((U=Wi[M]).x+(X=Wi[k]).x)*(xe=U.y*X.x-X.y*U.x),Tt+=(U.y+X.y)*xe,He+=3*xe;var Js=x.unproject(dn(0===He?Wi[0]:[Oe/He,Tt/He]));return Dn([Js.lat+xn.lat,Js.lng+xn.lng])}function Yr(h){for(var x=0,M=0,k=0,U=0;U<h.length;U++){var X=Dn(h[U]);x+=X.lat,M+=X.lng,k++}return Dn([x/k,M/k])}var dc,Xc={__proto__:null,clipPolygon:cc,polygonCenter:uc,centroid:Yr};function Ll(h,x){if(!x||!h.length)return h.slice();var M=x*x;return function Pa(h,x){var M=h.length,U=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(M);U[0]=U[M-1]=1,Xt(h,U,x,0,M-1);var X,xe=[];for(X=0;X<M;X++)U[X]&&xe.push(h[X]);return xe}(h=function kl(h,x){for(var M=[h[0]],k=1,U=0,X=h.length;k<X;k++)Ol(h[k],h[U])>x&&(M.push(h[k]),U=k);return U<X-1&&M.push(h[X-1]),M}(h,M),M)}function wi(h,x,M){return Math.sqrt(il(h,x,M,!0))}function Xt(h,x,M,k,U){var xe,He,Oe,X=0;for(He=k+1;He<=U-1;He++)(Oe=il(h[He],h[k],h[U],!0))>X&&(xe=He,X=Oe);X>M&&(x[xe]=1,Xt(h,x,M,k,xe),Xt(h,x,M,xe,U))}function nl(h,x,M,k,U){var He,Oe,Tt,X=k?dc:Gs(h,M),xe=Gs(x,M);for(dc=xe;;){if(!(X|xe))return[h,x];if(X&xe)return!1;Tt=Gs(Oe=Ra(h,x,He=X||xe,M,U),M),He===X?(h=Oe,X=Tt):(x=Oe,xe=Tt)}}function Ra(h,x,M,k,U){var Tt,rn,X=x.x-h.x,xe=x.y-h.y,He=k.min,Oe=k.max;return 8&M?(Tt=h.x+X*(Oe.y-h.y)/xe,rn=Oe.y):4&M?(Tt=h.x+X*(He.y-h.y)/xe,rn=He.y):2&M?(Tt=Oe.x,rn=h.y+xe*(Oe.x-h.x)/X):1&M&&(Tt=He.x,rn=h.y+xe*(He.x-h.x)/X),new wn(Tt,rn,U)}function Gs(h,x){var M=0;return h.x<x.min.x?M|=1:h.x>x.max.x&&(M|=2),h.y<x.min.y?M|=4:h.y>x.max.y&&(M|=8),M}function Ol(h,x){var M=x.x-h.x,k=x.y-h.y;return M*M+k*k}function il(h,x,M,k){var Tt,U=x.x,X=x.y,xe=M.x-U,He=M.y-X,Oe=xe*xe+He*He;return Oe>0&&((Tt=((h.x-U)*xe+(h.y-X)*He)/Oe)>1?(U=M.x,X=M.y):Tt>0&&(U+=xe*Tt,X+=He*Tt)),xe=h.x-U,He=h.y-X,k?xe*xe+He*He:new wn(U,X)}function Lo(h){return!Je(h[0])||"object"!=typeof h[0][0]&&typeof h[0][0]<"u"}function si(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Lo(h)}function fc(h,x){var M,k,U,X,xe,He,Oe,Tt;if(!h||0===h.length)throw new Error("latlngs not passed");Lo(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var rn=Dn([0,0]),xn=Pi(h);xn.getNorthWest().distanceTo(xn.getSouthWest())*xn.getNorthEast().distanceTo(xn.getNorthWest())<1700&&(rn=Yr(h));var Fr=h.length,cr=[];for(M=0;M<Fr;M++){var Wi=Dn(h[M]);cr.push(x.project(Dn([Wi.lat-rn.lat,Wi.lng-rn.lng])))}for(M=0,k=0;M<Fr-1;M++)k+=cr[M].distanceTo(cr[M+1])/2;if(0===k)Tt=cr[0];else for(M=0,X=0;M<Fr-1;M++)if((X+=U=(xe=cr[M]).distanceTo(He=cr[M+1]))>k){Tt=[He.x-(Oe=(X-k)/U)*(He.x-xe.x),He.y-Oe*(He.y-xe.y)];break}var Sr=x.unproject(dn(Tt));return Dn([Sr.lat+rn.lat,Sr.lng+rn.lng])}var Ud={__proto__:null,simplify:Ll,pointToSegmentDistance:wi,closestPointOnSegment:function hc(h,x,M){return il(h,x,M)},clipSegment:nl,_getEdgeIntersection:Ra,_getBitCode:Gs,_sqClosestPointOnSegment:il,isFlat:Lo,_flat:si,polylineCenter:fc},qs={project:function(h){return new wn(h.lng,h.lat)},unproject:function(h){return new oi(h.y,h.x)},bounds:new In([-180,-90],[180,90])},Nl={R:6378137,R_MINOR:6356752.314245179,bounds:new In([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(h){var x=Math.PI/180,M=this.R,k=h.lat*x,U=this.R_MINOR/M,X=Math.sqrt(1-U*U),xe=X*Math.sin(k),He=Math.tan(Math.PI/4-k/2)/Math.pow((1-xe)/(1+xe),X/2);return k=-M*Math.log(Math.max(He,1e-10)),new wn(h.lng*x*M,k)},unproject:function(h){for(var Tt,x=180/Math.PI,M=this.R,k=this.R_MINOR/M,U=Math.sqrt(1-k*k),X=Math.exp(-h.y/M),xe=Math.PI/2-2*Math.atan(X),He=0,Oe=.1;He<15&&Math.abs(Oe)>1e-7;He++)Tt=U*Math.sin(xe),Tt=Math.pow((1-Tt)/(1+Tt),U/2),xe+=Oe=Math.PI/2-2*Math.atan(X*Tt)-xe;return new oi(xe*x,h.x*x/M)}},_s={__proto__:null,LonLat:qs,Mercator:Nl,SphericalMercator:ln},ku=Ve({},ci,{code:"EPSG:3395",projection:Nl,transformation:function(){var h=.5/(Math.PI*Nl.R);return Ln(h,.5,-h,.5)}()}),kh=Ve({},ci,{code:"EPSG:4326",projection:qs,transformation:Ln(1/180,1,-1/180,.5)}),jd=Ve({},Zr,{projection:qs,transformation:Ln(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,x){var M=x.lng-h.lng,k=x.lat-h.lat;return Math.sqrt(M*M+k*k)},infinite:!0});Zr.Earth=ci,Zr.EPSG3395=ku,Zr.EPSG3857=Os,Zr.EPSG900913=Yi,Zr.EPSG4326=kh,Zr.Simple=jd;var Go=Tn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[Me(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[Me(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var x=h.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var M=this.getEvents();x.on(M,this),this.once("remove",function(){x.off(M,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});Ut.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var x=Me(h);return this._layers[x]||(this._layers[x]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h)),this},removeLayer:function(h){var x=Me(h);return this._layers[x]?(this._loaded&&h.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return Me(h)in this._layers},eachLayer:function(h,x){for(var M in this._layers)h.call(x,this._layers[M]);return this},_addLayers:function(h){for(var x=0,M=(h=h?Je(h)?h:[h]:[]).length;x<M;x++)this.addLayer(h[x])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[Me(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var x=Me(h);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,x=-1/0,M=this._getZoomSpan();for(var k in this._zoomBoundLayers){var U=this._zoomBoundLayers[k].options;h=void 0===U.minZoom?h:Math.min(h,U.minZoom),x=void 0===U.maxZoom?x:Math.max(x,U.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=h===1/0?void 0:h,M!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ko=Go.extend({initialize:function(h,x){var M,k;if(St(this,x),this._layers={},h)for(M=0,k=h.length;M<k;M++)this.addLayer(h[M])},addLayer:function(h){var x=this.getLayerId(h);return this._layers[x]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var x=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(h){return("number"==typeof h?h:this.getLayerId(h))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var M,k,x=Array.prototype.slice.call(arguments,1);for(M in this._layers)(k=this._layers[M])[h]&&k[h].apply(k,x);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,x){for(var M in this._layers)h.call(x,this._layers[M]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return Me(h)}}),jr=ko.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),ko.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),ko.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new Hi;for(var x in this._layers){var M=this._layers[x];h.extend(M.getBounds?M.getBounds():M.getLatLng())}return h}}),sn=$i.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){St(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,x){var M=this._getIconUrl(h);if(!M){if("icon"===h)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var k=this._createImg(M,x&&"IMG"===x.tagName?x:null);return this._setIconStyles(k,h),(this.options.crossOrigin||""===this.options.crossOrigin)&&(k.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),k},_setIconStyles:function(h,x){var M=this.options,k=M[x+"Size"];"number"==typeof k&&(k=[k,k]);var U=dn(k),X=dn("shadow"===x&&M.shadowAnchor||M.iconAnchor||U&&U.divideBy(2,!0));h.className="leaflet-marker-"+x+" "+(M.className||""),X&&(h.style.marginLeft=-X.x+"px",h.style.marginTop=-X.y+"px"),U&&(h.style.width=U.x+"px",h.style.height=U.y+"px")},_createImg:function(h,x){return(x=x||document.createElement("img")).src=h,x},_getIconUrl:function(h){return zt.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});var tn=sn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return"string"!=typeof tn.imagePath&&(tn.imagePath=this._detectIconPath()),(this.options.imagePath||tn.imagePath)+sn.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var x=function(M,k,U){var X=k.exec(M);return X&&X[U]};return(h=x(h,/^url\((['"])?(.+)\1\)$/,2))&&x(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=On("div","leaflet-default-icon-path",document.body),x=Ki(h,"background-image")||Ki(h,"backgroundImage");if(document.body.removeChild(h),x=this._stripUrl(x))return x;var M=document.querySelector('link[href$="leaflet.css"]');return M?M.href.substring(0,M.href.length-11-1):""}}),Zs=Xr.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new $n(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),it(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&yn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var x=this._marker,M=x._map,k=this._marker.options.autoPanSpeed,U=this._marker.options.autoPanPadding,X=jn(x._icon),xe=M.getPixelBounds(),He=M.getPixelOrigin(),Oe=ii(xe.min._subtract(He).add(U),xe.max._subtract(He).subtract(U));if(!Oe.contains(X)){var Tt=dn((Math.max(Oe.max.x,X.x)-Oe.max.x)/(xe.max.x-Oe.max.x)-(Math.min(Oe.min.x,X.x)-Oe.min.x)/(xe.min.x-Oe.min.x),(Math.max(Oe.max.y,X.y)-Oe.max.y)/(xe.max.y-Oe.max.y)-(Math.min(Oe.min.y,X.y)-Oe.min.y)/(xe.min.y-Oe.min.y)).multiplyBy(k);M.panBy(Tt,{animate:!1}),this._draggable._newPos._add(Tt),this._draggable._startPos._add(Tt),qi(x._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=Lt(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(Cn(this._panRequest),this._panRequest=Lt(this._adjustPan.bind(this,h)))},_onDrag:function(h){var x=this._marker,M=x._shadow,k=jn(x._icon),U=x._map.layerPointToLatLng(k);M&&qi(M,k),x._latlng=U,h.latlng=U,h.oldLatLng=this._oldLatLng,x.fire("move",h).fire("drag",h)},_onDragEnd:function(h){Cn(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),as=Go.extend({options:{icon:new tn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,x){St(this,x),this._latlng=Dn(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var x=this._latlng;return this._latlng=Dn(h),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),M=h.icon.createIcon(this._icon),k=!1;M!==this._icon&&(this._icon&&this._removeIcon(),k=!0,h.title&&(M.title=h.title),"IMG"===M.tagName&&(M.alt=h.alt||"")),it(M,x),h.keyboard&&(M.tabIndex="0",M.setAttribute("role","button")),this._icon=M,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&on(M,"focus",this._panOnFocus,this);var U=h.icon.createShadow(this._shadow),X=!1;U!==this._shadow&&(this._removeShadow(),X=!0),U&&(it(U,x),U.alt=""),this._shadow=U,h.opacity<1&&this._updateOpacity(),k&&this.getPane().appendChild(this._icon),this._initInteraction(),U&&X&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ri(this._icon,"focus",this._panOnFocus,this),rr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&rr(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&qi(this._icon,h),this._shadow&&qi(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(it(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Zs)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Zs(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&or(this._icon,h),this._shadow&&or(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var x=this.options.icon.options,M=x.iconSize?dn(x.iconSize):dn(0,0),k=x.iconAnchor?dn(x.iconAnchor):dn(0,0);h.panInside(this._latlng,{paddingTopLeft:k,paddingBottomRight:M.subtract(k)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var qo=Go.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return St(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Fl=qo.extend({options:{fill:!0,radius:10},initialize:function(h,x){St(this,x),this._latlng=Dn(h),this._radius=this.options.radius},setLatLng:function(h){var x=this._latlng;return this._latlng=Dn(h),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var x=h&&h.radius||this._radius;return qo.prototype.setStyle.call(this,h),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,x=this._radiusY||h,M=this._clickTolerance(),k=[h+M,x+M];this._pxBounds=new In(this._point.subtract(k),this._point.add(k))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Co=Fl.extend({initialize:function(h,x,M){if("number"==typeof x&&(x=Ve({},M,{radius:x})),St(this,x),this._latlng=Dn(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new Hi(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:qo.prototype.setStyle,_project:function(){var h=this._latlng.lng,x=this._latlng.lat,M=this._map,k=M.options.crs;if(k.distance===ci.distance){var U=Math.PI/180,X=this._mRadius/ci.R/U,xe=M.project([x+X,h]),He=M.project([x-X,h]),Oe=xe.add(He).divideBy(2),Tt=M.unproject(Oe).lat,rn=Math.acos((Math.cos(X*U)-Math.sin(x*U)*Math.sin(Tt*U))/(Math.cos(x*U)*Math.cos(Tt*U)))/U;(isNaN(rn)||0===rn)&&(rn=X/Math.cos(Math.PI/180*x)),this._point=Oe.subtract(M.getPixelOrigin()),this._radius=isNaN(rn)?0:Oe.x-M.project([Tt,h-rn]).x,this._radiusY=Oe.y-xe.y}else{var xn=k.unproject(k.project(this._latlng).subtract([this._mRadius,0]));this._point=M.latLngToLayerPoint(this._latlng),this._radius=this._point.x-M.latLngToLayerPoint(xn).x}this._updateBounds()}});var xr=qo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,x){St(this,x),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var U,X,x=1/0,M=null,k=il,xe=0,He=this._parts.length;xe<He;xe++)for(var Oe=this._parts[xe],Tt=1,rn=Oe.length;Tt<rn;Tt++){var xn=k(h,U=Oe[Tt-1],X=Oe[Tt],!0);xn<x&&(x=xn,M=k(h,U,X))}return M&&(M.distance=Math.sqrt(x)),M},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return fc(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,x){return x=x||this._defaultShape(),h=Dn(h),x.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new Hi,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Lo(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var x=[],M=Lo(h),k=0,U=h.length;k<U;k++)M?(x[k]=Dn(h[k]),this._bounds.extend(x[k])):x[k]=this._convertLatLngs(h[k]);return x},_project:function(){var h=new In;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),x=new wn(h,h);this._rawPxBounds&&(this._pxBounds=new In([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(h,x,M){var X,xe,U=h.length;if(h[0]instanceof oi){for(xe=[],X=0;X<U;X++)xe[X]=this._map.latLngToLayerPoint(h[X]),M.extend(xe[X]);x.push(xe)}else for(X=0;X<U;X++)this._projectLatlngs(h[X],x,M)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(h)){if(this.options.noClip)return void(this._parts=this._rings);var M,k,U,X,xe,He,Oe,x=this._parts;for(M=0,U=0,X=this._rings.length;M<X;M++)for(k=0,xe=(Oe=this._rings[M]).length;k<xe-1;k++)(He=nl(Oe[k],Oe[k+1],h,k,!0))&&(x[U]=x[U]||[],x[U].push(He[0]),(He[1]!==Oe[k+1]||k===xe-2)&&(x[U].push(He[1]),U++))}},_simplifyPoints:function(){for(var h=this._parts,x=this.options.smoothFactor,M=0,k=h.length;M<k;M++)h[M]=Ll(h[M],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,x){var M,k,U,X,xe,He,Oe=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(M=0,X=this._parts.length;M<X;M++)for(k=0,U=(xe=(He=this._parts[M]).length)-1;k<xe;U=k++)if((x||0!==k)&&wi(h,He[U],He[k])<=Oe)return!0;return!1}});xr._flat=si;var ei=xr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return uc(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var x=xr.prototype._convertLatLngs.call(this,h),M=x.length;return M>=2&&x[0]instanceof oi&&x[0].equals(x[M-1])&&x.pop(),x},_setLatLngs:function(h){xr.prototype._setLatLngs.call(this,h),Lo(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Lo(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,x=this.options.weight,M=new wn(x,x);if(h=new In(h.min.subtract(M),h.max.add(M)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(h)){if(this.options.noClip)return void(this._parts=this._rings);for(var X,k=0,U=this._rings.length;k<U;k++)(X=cc(this._rings[k],h,!0)).length&&this._parts.push(X)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var M,k,U,X,xe,He,Oe,Tt,x=!1;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(X=0,Oe=this._parts.length;X<Oe;X++)for(xe=0,He=(Tt=(M=this._parts[X]).length)-1;xe<Tt;He=xe++)(k=M[xe]).y>h.y!=(U=M[He]).y>h.y&&h.x<(U.x-k.x)*(h.y-k.y)/(U.y-k.y)+k.x&&(x=!x);return x||xr.prototype._containsPoint.call(this,h,!0)}});var Oo=jr.extend({initialize:function(h,x){St(this,x),this._layers={},h&&this.addData(h)},addData:function(h){var M,k,U,x=Je(h)?h:h.features;if(x){for(M=0,k=x.length;M<k;M++)((U=x[M]).geometries||U.geometry||U.features||U.coordinates)&&this.addData(U);return this}var X=this.options;if(X.filter&&!X.filter(h))return this;var xe=Ws(h,X);return xe?(xe.feature=Ys(h),xe.defaultOptions=xe.options,this.resetStyle(xe),X.onEachFeature&&X.onEachFeature(h,xe),this.addLayer(xe)):this},resetStyle:function(h){return void 0===h?this.eachLayer(this.resetStyle,this):(h.options=Ve({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(x){this._setLayerStyle(x,h)},this)},_setLayerStyle:function(h,x){h.setStyle&&("function"==typeof x&&(x=x(h.feature)),h.setStyle(x))}});function Ws(h,x){var He,Oe,Tt,rn,M="Feature"===h.type?h.geometry:h,k=M?M.coordinates:null,U=[],X=x&&x.pointToLayer,xe=x&&x.coordsToLatLng||Zo;if(!k&&!M)return null;switch(M.type){case"Point":return ol(X,h,He=xe(k),x);case"MultiPoint":for(Tt=0,rn=k.length;Tt<rn;Tt++)He=xe(k[Tt]),U.push(ol(X,h,He,x));return new jr(U);case"LineString":case"MultiLineString":return Oe=vs(k,"LineString"===M.type?0:1,xe),new xr(Oe,x);case"Polygon":case"MultiPolygon":return Oe=vs(k,"Polygon"===M.type?1:2,xe),new ei(Oe,x);case"GeometryCollection":for(Tt=0,rn=M.geometries.length;Tt<rn;Tt++){var xn=Ws({geometry:M.geometries[Tt],type:"Feature",properties:h.properties},x);xn&&U.push(xn)}return new jr(U);case"FeatureCollection":for(Tt=0,rn=M.features.length;Tt<rn;Tt++){var vn=Ws(M.features[Tt],x);vn&&U.push(vn)}return new jr(U);default:throw new Error("Invalid GeoJSON object.")}}function ol(h,x,M,k){return h?h(x,M):new as(M,k&&k.markersInheritOptions&&k)}function Zo(h){return new oi(h[1],h[0],h[2])}function vs(h,x,M){for(var xe,k=[],U=0,X=h.length;U<X;U++)xe=x?vs(h[U],x-1,M):(M||Zo)(h[U]),k.push(xe);return k}function Jc(h,x){return void 0!==(h=Dn(h)).alt?[yt(h.lng,x),yt(h.lat,x),yt(h.alt,x)]:[yt(h.lng,x),yt(h.lat,x)]}function sl(h,x,M,k){for(var U=[],X=0,xe=h.length;X<xe;X++)U.push(x?sl(h[X],Lo(h[X])?0:x-1,M,k):Jc(h[X],k));return!x&&M&&U.length>0&&U.push(U[0].slice()),U}function Xs(h,x){return h.feature?Ve({},h.feature,{geometry:x}):Ys(x)}function Ys(h){return"Feature"===h.type||"FeatureCollection"===h.type?h:{type:"Feature",properties:{},geometry:h}}var pc={toGeoJSON:function(h){return Xs(this,{type:"Point",coordinates:Jc(this.getLatLng(),h)})}};function Ks(h,x){return new Oo(h,x)}as.include(pc),Co.include(pc),Fl.include(pc),xr.include({toGeoJSON:function(h){var x=!Lo(this._latlngs);return Xs(this,{type:(x?"Multi":"")+"LineString",coordinates:sl(this._latlngs,x?1:0,!1,h)})}}),ei.include({toGeoJSON:function(h){var x=!Lo(this._latlngs),M=x&&!Lo(this._latlngs[0]),k=sl(this._latlngs,M?2:x?1:0,!0,h);return x||(k=[k]),Xs(this,{type:(M?"Multi":"")+"Polygon",coordinates:k})}}),ko.include({toMultiPoint:function(h){var x=[];return this.eachLayer(function(M){x.push(M.toGeoJSON(h).geometry.coordinates)}),Xs(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(h){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===x)return this.toMultiPoint(h);var M="GeometryCollection"===x,k=[];return this.eachLayer(function(U){if(U.toGeoJSON){var X=U.toGeoJSON(h);if(M)k.push(X.geometry);else{var xe=Ys(X);"FeatureCollection"===xe.type?k.push.apply(k,xe.features):k.push(xe)}}}),M?Xs(this,{geometries:k,type:"GeometryCollection"}):{type:"FeatureCollection",features:k}}});var Fu=Ks,xs=Go.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,x,M){this._url=h,this._bounds=Pi(x),St(this,M)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(it(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){rr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Vs(this._image),this},bringToBack:function(){return this._map&&el(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=Pi(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h="IMG"===this._url.tagName,x=this._image=h?this._url:On("img");it(x,"leaflet-image-layer"),this._zoomAnimated&&it(x,"leaflet-zoom-animated"),this.options.className&&it(x,this.options.className),x.onselectstart=Re,x.onmousemove=Re,x.onload=u(this.fire,this,"load"),x.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(x.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h?this._url=x.src:(x.src=this._url,x.alt=this.options.alt)},_animateZoom:function(h){var x=this._map.getZoomScale(h.zoom),M=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;os(this._image,M,x)},_reset:function(){var h=this._image,x=new In(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),M=x.getSize();qi(h,x.min),h.style.width=M.x+"px",h.style.height=M.y+"px"},_updateOpacity:function(){or(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&null!=this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),zu=xs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h="VIDEO"===this._url.tagName,x=this._image=h?this._url:On("video");if(it(x,"leaflet-image-layer"),this._zoomAnimated&&it(x,"leaflet-zoom-animated"),this.options.className&&it(x,this.options.className),x.onselectstart=Re,x.onmousemove=Re,x.onloadeddata=u(this.fire,this,"load"),h){for(var M=x.getElementsByTagName("source"),k=[],U=0;U<M.length;U++)k.push(M[U].src);this._url=M.length>0?k:[x.src]}else{Je(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var X=0;X<this._url.length;X++){var xe=On("source");xe.src=this._url[X],x.appendChild(xe)}}}});var Oh=xs.extend({_initImage:function(){var h=this._image=this._url;it(h,"leaflet-image-layer"),this._zoomAnimated&&it(h,"leaflet-zoom-animated"),this.options.className&&it(h,this.options.className),h.onselectstart=Re,h.onmousemove=Re}});var us=Go.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,x){h&&(h instanceof oi||Je(h))?(this._latlng=Dn(h),St(this,x)):(St(this,h),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(h){return(h=arguments.length?h:this._source._map).hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&or(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&or(this._container,1),this.bringToFront(),this.options.interactive&&(it(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(or(this._container,0),this._removeTimeout=setTimeout(u(rr,void 0,this._container),200)):rr(this._container),this.options.interactive&&(yn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=Dn(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Vs(this._container),this},bringToBack:function(){return this._map&&el(this._container),this},_prepareOpen:function(h){var x=this._source;if(!x._map)return!1;if(x instanceof jr){x=null;var M=this._source._layers;for(var k in M)if(M[k]._map){x=M[k];break}if(!x)return!1;this._source=x}if(!h)if(x.getCenter)h=x.getCenter();else if(x.getLatLng)h=x.getLatLng();else{if(!x.getBounds)throw new Error("Unable to get source layer LatLng.");h=x.getBounds().getCenter()}return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,x="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof x)h.innerHTML=x;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),x=dn(this.options.offset),M=this._getAnchor();this._zoomAnimated?qi(this._container,h.add(M)):x=x.add(h).add(M);var k=this._containerBottom=-x.y,U=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=k+"px",this._container.style.left=U+"px"}},_getAnchor:function(){return[0,0]}});Ut.include({_initOverlay:function(h,x,M,k){var U=x;return U instanceof h||(U=new h(k).setContent(x)),M&&U.setLatLng(M),U}}),Go.include({_initOverlay:function(h,x,M,k){var U=M;return U instanceof h?(St(U,k),U._source=this):(U=x&&!k?x:new h(k,this)).setContent(M),U}});var La=us.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return!(h=arguments.length?h:this._source._map).hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,us.prototype.openOn.call(this,h)},onAdd:function(h){us.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof qo||this._source.on("preclick",ss))},onRemove:function(h){us.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof qo||this._source.off("preclick",ss))},getEvents:function(){var h=us.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",x=this._container=On("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),M=this._wrapper=On("div",h+"-content-wrapper",x);if(this._contentNode=On("div",h+"-content",M),Wr(x),qc(this._contentNode),on(x,"contextmenu",ss),this._tipContainer=On("div",h+"-tip-container",x),this._tip=On("div",h+"-tip",this._tipContainer),this.options.closeButton){var k=this._closeButton=On("a",h+"-close-button",x);k.setAttribute("role","button"),k.setAttribute("aria-label","Close popup"),k.href="#close",k.innerHTML='<span aria-hidden="true">&#215;</span>',on(k,"click",function(U){xi(U),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,x=h.style;x.width="",x.whiteSpace="nowrap";var M=h.offsetWidth;M=Math.min(M,this.options.maxWidth),M=Math.max(M,this.options.minWidth),x.width=M+1+"px",x.whiteSpace="",x.height="";var U=this.options.maxHeight,X="leaflet-popup-scrolled";U&&h.offsetHeight>U?(x.height=U+"px",it(h,X)):yn(h,X),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),M=this._getAnchor();qi(this._container,x.add(M))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)return void(this._autopanning=!1);var h=this._map,x=parseInt(Ki(this._container,"marginBottom"),10)||0,M=this._container.offsetHeight+x,k=this._containerWidth,U=new wn(this._containerLeft,-M-this._containerBottom);U._add(jn(this._container));var X=h.layerPointToContainerPoint(U),xe=dn(this.options.autoPanPadding),He=dn(this.options.autoPanPaddingTopLeft||xe),Oe=dn(this.options.autoPanPaddingBottomRight||xe),Tt=h.getSize(),rn=0,xn=0;X.x+k+Oe.x>Tt.x&&(rn=X.x+k-Tt.x+Oe.x),X.x-rn-He.x<0&&(rn=X.x-He.x),X.y+M+Oe.y>Tt.y&&(xn=X.y+M-Tt.y+Oe.y),X.y-xn-He.y<0&&(xn=X.y-He.y),(rn||xn)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([rn,xn]))}},_getAnchor:function(){return dn(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Ut.mergeOptions({closePopupOnClick:!0}),Ut.include({openPopup:function(h,x,M){return this._initOverlay(La,h,x,M).openOn(this),this},closePopup:function(h){return(h=arguments.length?h:this._popup)&&h.close(),this}}),Go.include({bindPopup:function(h,x){return this._popup=this._initOverlay(La,this._popup,h,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof jr||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(this._popup&&this._map){Ma(h);var x=h.layer||h.target;if(this._popup._source===x&&!(x instanceof qo))return void(this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng));this._popup._source=x,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){13===h.originalEvent.keyCode&&this._openPopup(h)}});var mc=us.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){us.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){us.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=us.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){this._contentNode=this._container=On("div","leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide")),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+Me(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var x,M,k=this._map,U=this._container,X=k.latLngToContainerPoint(k.getCenter()),xe=k.layerPointToContainerPoint(h),He=this.options.direction,Oe=U.offsetWidth,Tt=U.offsetHeight,rn=dn(this.options.offset),xn=this._getAnchor();"top"===He?(x=Oe/2,M=Tt):"bottom"===He?(x=Oe/2,M=0):"center"===He?(x=Oe/2,M=Tt/2):"right"===He?(x=0,M=Tt/2):"left"===He?(x=Oe,M=Tt/2):xe.x<X.x?(He="right",x=0,M=Tt/2):(He="left",x=Oe+2*(rn.x+xn.x),M=Tt/2),h=h.subtract(dn(x,M,!0)).add(rn).add(xn),yn(U,"leaflet-tooltip-right"),yn(U,"leaflet-tooltip-left"),yn(U,"leaflet-tooltip-top"),yn(U,"leaflet-tooltip-bottom"),it(U,"leaflet-tooltip-"+He),qi(U,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&or(this._container,h)},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(x)},_getAnchor:function(){return dn(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Ut.include({openTooltip:function(h,x,M){return this._initOverlay(mc,h,x,M).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Go.include({bindTooltip:function(h,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(mc,this._tooltip,h,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(h||!this._tooltipHandlersAdded){var x=h?"off":"on",M={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?M.add=this._openTooltip:(M.mouseover=this._openTooltip,M.mouseout=this.closeTooltip,M.click=this._openTooltip,this._map?this._addFocusListeners():M.add=this._addFocusListeners),this._tooltip.options.sticky&&(M.mousemove=this._moveTooltip),this[x](M),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof jr||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var x="function"==typeof h.getElement&&h.getElement();x&&(on(x,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),on(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var x="function"==typeof h.getElement&&h.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(this._tooltip&&this._map){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;return void this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(h)})}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var M,k,x=h.latlng;this._tooltip.options.sticky&&h.originalEvent&&(M=this._map.mouseEventToContainerPoint(h.originalEvent),k=this._map.containerPointToLayerPoint(M),x=this._map.layerPointToLatLng(k)),this._tooltip.setLatLng(x)}});var bs=sn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var x=h&&"DIV"===h.tagName?h:document.createElement("div"),M=this.options;if(M.html instanceof Element?(Ao(x),x.appendChild(M.html)):x.innerHTML=!1!==M.html?M.html:"",M.bgPos){var k=dn(M.bgPos);x.style.backgroundPosition=-k.x+"px "+-k.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});sn.Default=tn;var ao=Go.extend({options:{tileSize:256,opacity:1,updateWhenIdle:zt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){St(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),rr(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Vs(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(el(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Le(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof wn?h:new wn(h,h)},_updateZIndex:function(){this._container&&null!=this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var X,x=this.getPane().children,M=-h(-1/0,1/0),k=0,U=x.length;k<U;k++)X=x[k].style.zIndex,x[k]!==this._container&&X&&(M=h(M,+X));isFinite(M)&&(this.options.zIndex=M+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!zt.ielt9){or(this._container,this.options.opacity);var h=+new Date,x=!1,M=!1;for(var k in this._tiles){var U=this._tiles[k];if(U.current&&U.loaded){var X=Math.min(1,(h-U.loaded)/200);or(U.el,X),X<1?x=!0:(U.active?M=!0:this._onOpaqueTile(U),U.active=!0)}}M&&!this._noPrune&&this._pruneTiles(),x&&(Cn(this._fadeFrame),this._fadeFrame=Lt(this._updateOpacity,this))}},_onOpaqueTile:Re,_initContainer:function(){this._container||(this._container=On("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,x=this.options.maxZoom;if(void 0!==h){for(var M in this._levels)M=Number(M),this._levels[M].el.children.length||M===h?(this._levels[M].el.style.zIndex=x-Math.abs(h-M),this._onUpdateLevel(M)):(rr(this._levels[M].el),this._removeTilesAtZoom(M),this._onRemoveLevel(M),delete this._levels[M]);var k=this._levels[h],U=this._map;return k||((k=this._levels[h]={}).el=On("div","leaflet-tile-container leaflet-zoom-animated",this._container),k.el.style.zIndex=x,k.origin=U.project(U.unproject(U.getPixelOrigin()),h).round(),k.zoom=h,this._setZoomTransform(k,U.getCenter(),U.getZoom()),this._onCreateLevel(k)),this._level=k,k}},_onUpdateLevel:Re,_onRemoveLevel:Re,_onCreateLevel:Re,_pruneTiles:function(){if(this._map){var h,x,M=this._map.getZoom();if(M>this.options.maxZoom||M<this.options.minZoom)return void this._removeAllTiles();for(h in this._tiles)(x=this._tiles[h]).retain=x.current;for(h in this._tiles)if((x=this._tiles[h]).current&&!x.active){var k=x.coords;this._retainParent(k.x,k.y,k.z,k.z-5)||this._retainChildren(k.x,k.y,k.z,k.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var x in this._tiles)this._tiles[x].coords.z===h&&this._removeTile(x)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)rr(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,x,M,k){var U=Math.floor(h/2),X=Math.floor(x/2),xe=M-1,He=new wn(+U,+X);He.z=+xe;var Oe=this._tileCoordsToKey(He),Tt=this._tiles[Oe];return Tt&&Tt.active?(Tt.retain=!0,!0):(Tt&&Tt.loaded&&(Tt.retain=!0),xe>k&&this._retainParent(U,X,xe,k))},_retainChildren:function(h,x,M,k){for(var U=2*h;U<2*h+2;U++)for(var X=2*x;X<2*x+2;X++){var xe=new wn(U,X);xe.z=M+1;var He=this._tileCoordsToKey(xe),Oe=this._tiles[He];Oe&&Oe.active?Oe.retain=!0:(Oe&&Oe.loaded&&(Oe.retain=!0),M+1<k&&this._retainChildren(U,X,M+1,k))}},_resetView:function(h){var x=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var x=this.options;return void 0!==x.minNativeZoom&&h<x.minNativeZoom?x.minNativeZoom:void 0!==x.maxNativeZoom&&x.maxNativeZoom<h?x.maxNativeZoom:h},_setView:function(h,x,M,k){var U=Math.round(x);U=void 0!==this.options.maxZoom&&U>this.options.maxZoom||void 0!==this.options.minZoom&&U<this.options.minZoom?void 0:this._clampZoom(U),(!k||this.options.updateWhenZooming&&U!==this._tileZoom)&&(this._tileZoom=U,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==U&&this._update(h),M||this._pruneTiles(),this._noPrune=!!M),this._setZoomTransforms(h,x)},_setZoomTransforms:function(h,x){for(var M in this._levels)this._setZoomTransform(this._levels[M],h,x)},_setZoomTransform:function(h,x,M){var k=this._map.getZoomScale(M,h.zoom),U=h.origin.multiplyBy(k).subtract(this._map._getNewPixelOrigin(x,M)).round();zt.any3d?os(h.el,U,k):qi(h.el,U)},_resetGrid:function(){var h=this._map,x=h.options.crs,M=this._tileSize=this.getTileSize(),k=this._tileZoom,U=this._map.getPixelWorldBounds(this._tileZoom);U&&(this._globalTileRange=this._pxBoundsToTileRange(U)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,x.wrapLng[0]],k).x/M.x),Math.ceil(h.project([0,x.wrapLng[1]],k).x/M.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([x.wrapLat[0],0],k).y/M.x),Math.ceil(h.project([x.wrapLat[1],0],k).y/M.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var x=this._map,M=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),k=x.getZoomScale(M,this._tileZoom),U=x.project(h,this._tileZoom).floor(),X=x.getSize().divideBy(2*k);return new In(U.subtract(X),U.add(X))},_update:function(h){var x=this._map;if(x){var M=this._clampZoom(x.getZoom());if(void 0===h&&(h=x.getCenter()),void 0!==this._tileZoom){var k=this._getTiledPixelBounds(h),U=this._pxBoundsToTileRange(k),X=U.getCenter(),xe=[],He=this.options.keepBuffer,Oe=new In(U.getBottomLeft().subtract([He,-He]),U.getTopRight().add([He,-He]));if(!(isFinite(U.min.x)&&isFinite(U.min.y)&&isFinite(U.max.x)&&isFinite(U.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Tt in this._tiles){var rn=this._tiles[Tt].coords;(rn.z!==this._tileZoom||!Oe.contains(new wn(rn.x,rn.y)))&&(this._tiles[Tt].current=!1)}if(Math.abs(M-this._tileZoom)>1)return void this._setView(h,M);for(var xn=U.min.y;xn<=U.max.y;xn++)for(var vn=U.min.x;vn<=U.max.x;vn++){var Fr=new wn(vn,xn);if(Fr.z=this._tileZoom,this._isValidTile(Fr)){var cr=this._tiles[this._tileCoordsToKey(Fr)];cr?cr.current=!0:xe.push(Fr)}}if(xe.sort(function(Sr,Js){return Sr.distanceTo(X)-Js.distanceTo(X)}),0!==xe.length){this._loading||(this._loading=!0,this.fire("loading"));var Wi=document.createDocumentFragment();for(vn=0;vn<xe.length;vn++)this._addTile(xe[vn],Wi);this._level.el.appendChild(Wi)}}}},_isValidTile:function(h){var x=this._map.options.crs;if(!x.infinite){var M=this._globalTileRange;if(!x.wrapLng&&(h.x<M.min.x||h.x>M.max.x)||!x.wrapLat&&(h.y<M.min.y||h.y>M.max.y))return!1}if(!this.options.bounds)return!0;var k=this._tileCoordsToBounds(h);return Pi(this.options.bounds).overlaps(k)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var x=this._map,M=this.getTileSize(),k=h.scaleBy(M),U=k.add(M);return[x.unproject(k,h.z),x.unproject(U,h.z)]},_tileCoordsToBounds:function(h){var x=this._tileCoordsToNwSe(h),M=new Hi(x[0],x[1]);return this.options.noWrap||(M=this._map.wrapLatLngBounds(M)),M},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var x=h.split(":"),M=new wn(+x[0],+x[1]);return M.z=+x[2],M},_removeTile:function(h){var x=this._tiles[h];x&&(rr(x.el),delete this._tiles[h],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){it(h,"leaflet-tile");var x=this.getTileSize();h.style.width=x.x+"px",h.style.height=x.y+"px",h.onselectstart=Re,h.onmousemove=Re,zt.ielt9&&this.options.opacity<1&&or(h,this.options.opacity)},_addTile:function(h,x){var M=this._getTilePos(h),k=this._tileCoordsToKey(h),U=this.createTile(this._wrapCoords(h),u(this._tileReady,this,h));this._initTile(U),this.createTile.length<2&&Lt(u(this._tileReady,this,h,null,U)),qi(U,M),this._tiles[k]={el:U,coords:h,current:!0},x.appendChild(U),this.fire("tileloadstart",{tile:U,coords:h})},_tileReady:function(h,x,M){x&&this.fire("tileerror",{error:x,tile:M,coords:h});var k=this._tileCoordsToKey(h);(M=this._tiles[k])&&(M.loaded=+new Date,this._map._fadeAnimated?(or(M.el,0),Cn(this._fadeFrame),this._fadeFrame=Lt(this._updateOpacity,this)):(M.active=!0,this._pruneTiles()),x||(it(M.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:M.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),zt.ielt9||!this._map._fadeAnimated?Lt(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var x=new wn(this._wrapX?Ae(h.x,this._wrapX):h.x,this._wrapY?Ae(h.y,this._wrapY):h.y);return x.z=h.z,x},_pxBoundsToTileRange:function(h){var x=this.getTileSize();return new In(h.min.unscaleBy(x).floor(),h.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});var al=ao.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,x){this._url=h,(x=St(this,x)).detectRetina&&zt.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),"string"==typeof x.subdomains&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,x){return this._url===h&&void 0===x&&(x=!0),this._url=h,x||this.redraw(),this},createTile:function(h,x){var M=document.createElement("img");return on(M,"load",u(this._tileOnLoad,this,x,M)),on(M,"error",u(this._tileOnError,this,x,M)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(M.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(M.referrerPolicy=this.options.referrerPolicy),M.alt="",M.src=this.getTileUrl(h),M},getTileUrl:function(h){var x={r:zt.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var M=this._globalTileRange.max.y-h.y;this.options.tms&&(x.y=M),x["-y"]=M}return he(this._url,Ve(x,this.options))},_tileOnLoad:function(h,x){zt.ielt9?setTimeout(u(h,this,null,x),0):h(null,x)},_tileOnError:function(h,x,M){var k=this.options.errorTileUrl;k&&x.getAttribute("src")!==k&&(x.src=k),h(M,x)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom;return this.options.zoomReverse&&(h=this.options.maxZoom-h),h+this.options.zoomOffset},_getSubdomain:function(h){var x=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var h,x;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&((x=this._tiles[h].el).onload=Re,x.onerror=Re,!x.complete)){x.src=$e;var M=this._tiles[h].coords;rr(x),delete this._tiles[h],this.fire("tileabort",{tile:x,coords:M})}},_removeTile:function(h){var x=this._tiles[h];if(x)return x.el.setAttribute("src",$e),ao.prototype._removeTile.call(this,h)},_tileReady:function(h,x,M){if(this._map&&(!M||M.getAttribute("src")!==$e))return ao.prototype._tileReady.call(this,h,x,M)}});function pr(h,x){return new al(h,x)}var ll=al.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,x){this._url=h;var M=Ve({},this.defaultWmsParams);for(var k in x)k in this.options||(M[k]=x[k]);var U=(x=St(this,x)).detectRetina&&zt.retina?2:1,X=this.getTileSize();M.width=X.x*U,M.height=X.y*U,this.wmsParams=M},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version),this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=this._crs.code,al.prototype.onAdd.call(this,h)},getTileUrl:function(h){var x=this._tileCoordsToNwSe(h),M=this._crs,k=ii(M.project(x[0]),M.project(x[1])),U=k.min,X=k.max,xe=(this._wmsVersion>=1.3&&this._crs===kh?[U.y,U.x,X.y,X.x]:[U.x,U.y,X.x,X.y]).join(","),He=al.prototype.getTileUrl.call(this,h);return He+Nt(this.wmsParams,He,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+xe},setParams:function(h,x){return Ve(this.wmsParams,h),x||this.redraw(),this}});al.WMS=ll,pr.wms=function Qc(h,x){return new ll(h,x)};var Wo=Go.extend({options:{padding:.1},initialize:function(h){St(this,h),Me(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),it(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,x){var M=this._map.getZoomScale(x,this._zoom),k=this._map.getSize().multiplyBy(.5+this.options.padding),U=this._map.project(this._center,x),X=k.multiplyBy(-M).add(U).subtract(this._map._getNewPixelOrigin(h,x));zt.any3d?os(this._container,X,M):qi(this._container,X)},_reset:function(){for(var h in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,x=this._map.getSize(),M=this._map.containerPointToLayerPoint(x.multiplyBy(-h)).round();this._bounds=new In(M,M.add(x.multiplyBy(1+2*h)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Nn=Wo.extend({options:{tolerance:0},getEvents:function(){var h=Wo.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Wo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");on(h,"mousemove",this._onMouseMove,this),on(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),on(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){Cn(this._redrawRequest),delete this._ctx,rr(this._container),ri(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var x in this._redrawBounds=null,this._layers)this._layers[x]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Wo.prototype._update.call(this);var h=this._bounds,x=this._container,M=h.getSize(),k=zt.retina?2:1;qi(x,h.min),x.width=k*M.x,x.height=k*M.y,x.style.width=M.x+"px",x.style.height=M.y+"px",zt.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){Wo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[Me(h)]=h;var x=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var x=h._order,M=x.next,k=x.prev;M?M.prev=k:this._drawLast=k,k?k.next=M:this._drawFirst=M,delete h._order,delete this._layers[Me(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if("string"==typeof h.options.dashArray){var k,U,x=h.options.dashArray.split(/[, ]+/),M=[];for(U=0;U<x.length;U++){if(k=Number(x[U]),isNaN(k))return;M.push(k)}h.options._dashArray=M}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||Lt(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var x=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new In,this._redrawBounds.extend(h._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(h._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var x=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,x=this._redrawBounds;if(this._ctx.save(),x){var M=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,M.x,M.y),this._ctx.clip()}this._drawing=!0;for(var k=this._drawFirst;k;k=k.next)h=k.layer,(!x||h._pxBounds&&h._pxBounds.intersects(x))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,x){if(this._drawing){var M,k,U,X,xe=h._parts,He=xe.length,Oe=this._ctx;if(He){for(Oe.beginPath(),M=0;M<He;M++){for(k=0,U=xe[M].length;k<U;k++)Oe[k?"lineTo":"moveTo"]((X=xe[M][k]).x,X.y);x&&Oe.closePath()}this._fillStroke(Oe,h)}}},_updateCircle:function(h){if(this._drawing&&!h._empty()){var x=h._point,M=this._ctx,k=Math.max(Math.round(h._radius),1),U=(Math.max(Math.round(h._radiusY),1)||k)/k;1!==U&&(M.save(),M.scale(1,U)),M.beginPath(),M.arc(x.x,x.y/U,k,0,2*Math.PI,!1),1!==U&&M.restore(),this._fillStroke(M,h)}},_fillStroke:function(h,x){var M=x.options;M.fill&&(h.globalAlpha=M.fillOpacity,h.fillStyle=M.fillColor||M.color,h.fill(M.fillRule||"evenodd")),M.stroke&&0!==M.weight&&(h.setLineDash&&h.setLineDash(x.options&&x.options._dashArray||[]),h.globalAlpha=M.opacity,h.lineWidth=M.weight,h.strokeStyle=M.color,h.lineCap=M.lineCap,h.lineJoin=M.lineJoin,h.stroke())},_onClick:function(h){for(var M,k,x=this._map.mouseEventToLayerPoint(h),U=this._drawFirst;U;U=U.next)(M=U.layer).options.interactive&&M._containsPoint(x)&&("click"!==h.type&&"preclick"!==h.type||!this._map._draggableMoved(M))&&(k=M);this._fireEvent(!!k&&[k],h)},_onMouseMove:function(h){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var x=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,x)}},_handleMouseOut:function(h){var x=this._hoveredLayer;x&&(yn(this._container,"leaflet-interactive"),this._fireEvent([x],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,x){if(!this._mouseHoverThrottled){for(var M,k,U=this._drawFirst;U;U=U.next)(M=U.layer).options.interactive&&M._containsPoint(x)&&(k=M);k!==this._hoveredLayer&&(this._handleMouseOut(h),k&&(it(this._container,"leaflet-interactive"),this._fireEvent([k],h,"mouseover"),this._hoveredLayer=k)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],h),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,x,M){this._map._fireDOMEvent(x,M||x.type,h)},_bringToFront:function(h){var x=h._order;if(x){var M=x.next,k=x.prev;if(!M)return;M.prev=k,k?k.next=M:M&&(this._drawFirst=M),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(h)}},_bringToBack:function(h){var x=h._order;if(x){var M=x.next,k=x.prev;if(!k)return;k.next=M,M?M.prev=k:k&&(this._drawLast=k),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(h)}}});function Vl(h){return zt.canvas?new Nn(h):null}var cl=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Pn={_initContainer:function(){this._container=On("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Wo.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var x=h._container=cl("shape");it(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",h._path=cl("path"),x.appendChild(h._path),this._updateStyle(h),this._layers[Me(h)]=h},_addPath:function(h){var x=h._container;this._container.appendChild(x),h.options.interactive&&h.addInteractiveTarget(x)},_removePath:function(h){var x=h._container;rr(x),h.removeInteractiveTarget(x),delete this._layers[Me(h)]},_updateStyle:function(h){var x=h._stroke,M=h._fill,k=h.options,U=h._container;U.stroked=!!k.stroke,U.filled=!!k.fill,k.stroke?(x||(x=h._stroke=cl("stroke")),U.appendChild(x),x.weight=k.weight+"px",x.color=k.color,x.opacity=k.opacity,x.dashStyle=k.dashArray?Je(k.dashArray)?k.dashArray.join(" "):k.dashArray.replace(/( *, *)/g," "):"",x.endcap=k.lineCap.replace("butt","flat"),x.joinstyle=k.lineJoin):x&&(U.removeChild(x),h._stroke=null),k.fill?(M||(M=h._fill=cl("fill")),U.appendChild(M),M.color=k.fillColor||k.color,M.opacity=k.fillOpacity):M&&(U.removeChild(M),h._fill=null)},_updateCircle:function(h){var x=h._point.round(),M=Math.round(h._radius),k=Math.round(h._radiusY||M);this._setPath(h,h._empty()?"M0 0":"AL "+x.x+","+x.y+" "+M+","+k+" 0,23592600")},_setPath:function(h,x){h._path.v=x},_bringToFront:function(h){Vs(h._container)},_bringToBack:function(h){el(h._container)}},br=zt.vml?cl:go,ti=Wo.extend({_initContainer:function(){this._container=br("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=br("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){rr(this._container),ri(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Wo.prototype._update.call(this);var h=this._bounds,x=h.getSize(),M=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,M.setAttribute("width",x.x),M.setAttribute("height",x.y)),qi(M,h.min),M.setAttribute("viewBox",[h.min.x,h.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(h){var x=h._path=br("path");h.options.className&&it(x,h.options.className),h.options.interactive&&it(x,"leaflet-interactive"),this._updateStyle(h),this._layers[Me(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){rr(h._path),h.removeInteractiveTarget(h._path),delete this._layers[Me(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var x=h._path,M=h.options;x&&(M.stroke?(x.setAttribute("stroke",M.color),x.setAttribute("stroke-opacity",M.opacity),x.setAttribute("stroke-width",M.weight),x.setAttribute("stroke-linecap",M.lineCap),x.setAttribute("stroke-linejoin",M.lineJoin),M.dashArray?x.setAttribute("stroke-dasharray",M.dashArray):x.removeAttribute("stroke-dasharray"),M.dashOffset?x.setAttribute("stroke-dashoffset",M.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),M.fill?(x.setAttribute("fill",M.fillColor||M.color),x.setAttribute("fill-opacity",M.fillOpacity),x.setAttribute("fill-rule",M.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(h,x){this._setPath(h,sc(h._parts,x))},_updateCircle:function(h){var x=h._point,M=Math.max(Math.round(h._radius),1),U="a"+M+","+(Math.max(Math.round(h._radiusY),1)||M)+" 0 1,0 ",X=h._empty()?"M0 0":"M"+(x.x-M)+","+x.y+U+2*M+",0 "+U+2*-M+",0 ";this._setPath(h,X)},_setPath:function(h,x){h._path.setAttribute("d",x)},_bringToFront:function(h){Vs(h._path)},_bringToBack:function(h){el(h._path)}});function Tr(h){return zt.svg||zt.vml?new ti(h):null}zt.vml&&ti.include(Pn),Ut.include({getRenderer:function(h){var x=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(h){if("overlayPane"===h||void 0===h)return!1;var x=this._paneRenderers[h];return void 0===x&&(x=this._createRenderer({pane:h}),this._paneRenderers[h]=x),x},_createRenderer:function(h){return this.options.preferCanvas&&Vl(h)||Tr(h)}});var lr=ei.extend({initialize:function(h,x){ei.prototype.initialize.call(this,this._boundsToLatLngs(h),x)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return[(h=Pi(h)).getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});ti.create=br,ti.pointsToPath=sc,Oo.geometryToLayer=Ws,Oo.coordsToLatLng=Zo,Oo.coordsToLatLngs=vs,Oo.latLngToCoords=Jc,Oo.latLngsToCoords=sl,Oo.getFeature=Xs,Oo.asFeature=Ys,Ut.mergeOptions({boxZoom:!0});var Kr=Xr.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ri(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){rr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||1!==h.which&&1!==h.button)return!1;this._clearDeferredResetState(),this._resetState(),fi(),vi(),this._startPoint=this._map.mouseEventToContainerPoint(h),on(document,{contextmenu:Ma,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=On("div","leaflet-zoom-box",this._container),it(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var x=new In(this._point,this._startPoint),M=x.getSize();qi(this._box,x.min),this._box.style.width=M.x+"px",this._box.style.height=M.y+"px"},_finish:function(){this._moved&&(rr(this._box),yn(this._container,"leaflet-crosshair")),sr(),An(),ri(document,{contextmenu:Ma,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if((1===h.which||1===h.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var x=new Hi(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(h){27===h.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ut.addInitHook("addHandler","boxZoom",Kr),Ut.mergeOptions({doubleClickZoom:!0});var ka=Xr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var x=this._map,M=x.getZoom(),k=x.options.zoomDelta,U=h.originalEvent.shiftKey?M-k:M+k;"center"===x.options.doubleClickZoom?x.setZoom(U):x.setZoomAround(h.containerPoint,U)}});Ut.addInitHook("addHandler","doubleClickZoom",ka),Ut.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Oa=Xr.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new $n(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}it(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){yn(this._map._container,"leaflet-grab"),yn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=Pi(this._map.options.maxBounds);this._offsetLimit=ii(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var x=this._lastTime=+new Date,M=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(M),this._times.push(x),this._prunePositions(x)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,x){return h-(h-x)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var h=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;h.x<x.min.x&&(h.x=this._viscousLimit(h.x,x.min.x)),h.y<x.min.y&&(h.y=this._viscousLimit(h.y,x.min.y)),h.x>x.max.x&&(h.x=this._viscousLimit(h.x,x.max.x)),h.y>x.max.y&&(h.y=this._viscousLimit(h.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,x=Math.round(h/2),M=this._initialWorldOffset,k=this._draggable._newPos.x,U=(k-x+M)%h+x-M,X=(k+x+M)%h-x-M,xe=Math.abs(U+M)<Math.abs(X+M)?U:X;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=xe},_onDragEnd:function(h){var x=this._map,M=x.options,k=!M.inertia||h.noInertia||this._times.length<2;if(x.fire("dragend",h),k)x.fire("moveend");else{this._prunePositions(+new Date);var U=this._lastPos.subtract(this._positions[0]),xe=M.easeLinearity,He=U.multiplyBy(xe/((this._lastTime-this._times[0])/1e3)),Oe=He.distanceTo([0,0]),Tt=Math.min(M.inertiaMaxSpeed,Oe),rn=He.multiplyBy(Tt/Oe),xn=Tt/(M.inertiaDeceleration*xe),vn=rn.multiplyBy(-xn/2).round();vn.x||vn.y?(vn=x._limitOffset(vn,x.options.maxBounds),Lt(function(){x.panBy(vn,{duration:xn,easeLinearity:xe,noMoveStart:!0,animate:!0})})):x.fire("moveend")}}});Ut.addInitHook("addHandler","dragging",Oa),Ut.mergeOptions({keyboard:!0,keyboardPanDelta:80});var hl=Xr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),on(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ri(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,x=document.documentElement,M=h.scrollTop||x.scrollTop,k=h.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(k,M)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var k,U,x=this._panKeys={},M=this.keyCodes;for(k=0,U=M.left.length;k<U;k++)x[M.left[k]]=[-1*h,0];for(k=0,U=M.right.length;k<U;k++)x[M.right[k]]=[h,0];for(k=0,U=M.down.length;k<U;k++)x[M.down[k]]=[0,h];for(k=0,U=M.up.length;k<U;k++)x[M.up[k]]=[0,-1*h]},_setZoomDelta:function(h){var k,U,x=this._zoomKeys={},M=this.keyCodes;for(k=0,U=M.zoomIn.length;k<U;k++)x[M.zoomIn[k]]=h;for(k=0,U=M.zoomOut.length;k<U;k++)x[M.zoomOut[k]]=-h},_addHooks:function(){on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ri(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var k,x=h.keyCode,M=this._map;if(x in this._panKeys){if(!M._panAnim||!M._panAnim._inProgress)if(k=this._panKeys[x],h.shiftKey&&(k=dn(k).multiplyBy(3)),M.options.maxBounds&&(k=M._limitOffset(dn(k),M.options.maxBounds)),M.options.worldCopyJump){var U=M.wrapLatLng(M.unproject(M.project(M.getCenter()).add(k)));M.panTo(U)}else M.panBy(k)}else if(x in this._zoomKeys)M.setZoom(M.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[x]);else{if(27!==x||!M._popup||!M._popup.options.closeOnEscapeKey)return;M.closePopup()}Ma(h)}}});Ut.addInitHook("addHandler","keyboard",hl),Ut.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ul=Xr.extend({addHooks:function(){on(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ri(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var x=Zc(h),M=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var k=Math.max(M-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),k),Ma(h)},_performZoom:function(){var h=this._map,x=h.getZoom(),M=this._map.options.zoomSnap||0;h._stop();var U=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,X=M?Math.ceil(U/M)*M:U,xe=h._limitZoom(x+(this._delta>0?X:-X))-x;this._delta=0,this._startTime=null,xe&&("center"===h.options.scrollWheelZoom?h.setZoom(x+xe):h.setZoomAround(this._lastMousePos,x+xe))}});Ut.addInitHook("addHandler","scrollWheelZoom",Ul);Ut.mergeOptions({tapHold:zt.touchNative&&zt.safari&&zt.mobile,tapTolerance:15});var Zi=Xr.extend({addHooks:function(){on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ri(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),1===h.touches.length){var x=h.touches[0];this._startPos=this._newPos=new wn(x.clientX,x.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(on(document,"touchend",xi),on(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),600),on(document,"touchend touchcancel contextmenu",this._cancel,this),on(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){ri(document,"touchend",xi),ri(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),ri(document,"touchend touchcancel contextmenu",this._cancel,this),ri(document,"touchmove",this._onMove,this)},_onMove:function(h){var x=h.touches[0];this._newPos=new wn(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,x){var M=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});M._simulated=!0,x.target.dispatchEvent(M)}});Ut.addInitHook("addHandler","tapHold",Zi),Ut.mergeOptions({touchZoom:zt.touch,bounceAtZoomLimits:!0});var Jt=Xr.extend({addHooks:function(){it(this._map._container,"leaflet-touch-zoom"),on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){yn(this._map._container,"leaflet-touch-zoom"),ri(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var x=this._map;if(h.touches&&2===h.touches.length&&!x._animatingZoom&&!this._zooming){var M=x.mouseEventToContainerPoint(h.touches[0]),k=x.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),"center"!==x.options.touchZoom&&(this._pinchStartLatLng=x.containerPointToLatLng(M.add(k)._divideBy(2))),this._startDist=M.distanceTo(k),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),on(document,"touchmove",this._onTouchMove,this),on(document,"touchend touchcancel",this._onTouchEnd,this),xi(h)}},_onTouchMove:function(h){if(h.touches&&2===h.touches.length&&this._zooming){var x=this._map,M=x.mouseEventToContainerPoint(h.touches[0]),k=x.mouseEventToContainerPoint(h.touches[1]),U=M.distanceTo(k)/this._startDist;if(this._zoom=x.getScaleZoom(U,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&U<1||this._zoom>x.getMaxZoom()&&U>1)&&(this._zoom=x._limitZoom(this._zoom)),"center"===x.options.touchZoom){if(this._center=this._startLatLng,1===U)return}else{var X=M._add(k)._divideBy(2)._subtract(this._centerPoint);if(1===U&&0===X.x&&0===X.y)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(X),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),Cn(this._animRequest);var xe=u(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Lt(xe,this,!0),xi(h)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,Cn(this._animRequest),ri(document,"touchmove",this._onTouchMove,this),ri(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Ut.addInitHook("addHandler","touchZoom",Jt),Ut.BoxZoom=Kr,Ut.DoubleClickZoom=ka,Ut.Drag=Oa,Ut.Keyboard=hl,Ut.ScrollWheelZoom=Ul,Ut.TapHold=Zi,Ut.TouchZoom=Jt,_e.Bounds=In,_e.Browser=zt,_e.CRS=Zr,_e.Canvas=Nn,_e.Circle=Co,_e.CircleMarker=Fl,_e.Class=$i,_e.Control=so,_e.DivIcon=bs,_e.DivOverlay=us,_e.DomEvent=Ph,_e.DomUtil=cn,_e.Draggable=$n,_e.Evented=Tn,_e.FeatureGroup=jr,_e.GeoJSON=Oo,_e.GridLayer=ao,_e.Handler=Xr,_e.Icon=sn,_e.ImageOverlay=xs,_e.LatLng=oi,_e.LatLngBounds=Hi,_e.Layer=Go,_e.LayerGroup=ko,_e.LineUtil=Ud,_e.Map=Ut,_e.Marker=as,_e.Mixin=ui,_e.Path=qo,_e.Point=wn,_e.PolyUtil=Xc,_e.Polygon=ei,_e.Polyline=xr,_e.Popup=La,_e.PosAnimation=Ur,_e.Projection=_s,_e.Rectangle=lr,_e.Renderer=Wo,_e.SVG=ti,_e.SVGOverlay=Oh,_e.TileLayer=al,_e.Tooltip=mc,_e.Transformation=ns,_e.Util=Ai,_e.VideoOverlay=zu,_e.bind=u,_e.bounds=ii,_e.canvas=Vl,_e.circle=function zl(h,x,M){return new Co(h,x,M)},_e.circleMarker=function ys(h,x){return new Fl(h,x)},_e.control=Ho,_e.divIcon=function gc(h){return new bs(h)},_e.extend=Ve,_e.featureGroup=function(h,x){return new jr(h,x)},_e.geoJSON=Ks,_e.geoJson=Fu,_e.gridLayer=function _c(h){return new ao(h)},_e.icon=function Nu(h){return new sn(h)},_e.imageOverlay=function(h,x,M){return new xs(h,x,M)},_e.latLng=Dn,_e.latLngBounds=Pi,_e.layerGroup=function(h,x){return new ko(h,x)},_e.map=function Rh(h,x){return new Ut(h,x)},_e.marker=function rl(h,x){return new as(h,x)},_e.point=dn,_e.polygon=function Kc(h,x){return new ei(h,x)},_e.polyline=function ls(h,x){return new xr(h,x)},_e.popup=function(h,x){return new La(h,x)},_e.rectangle=function ul(h,x){return new lr(h,x)},_e.setOptions=St,_e.stamp=Me,_e.svg=Tr,_e.svgOverlay=function cs(h,x,M){return new Oh(h,x,M)},_e.tileLayer=pr,_e.tooltip=function(h,x){return new mc(h,x)},_e.transformation=Ln,_e.version="1.9.4",_e.videoOverlay=function Hd(h,x,M){return new zu(h,x,M)};var ft=window.L;_e.noConflict=function(){return window.L=ft,this},window.L=_e}(qt)},220:Zt=>{var Ve=/^\s+|\s+$/g,Te=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,Q=/^0o[0-7]+$/i,Me=parseInt,Le="object"==typeof global&&global&&global.Object===Object&&global,Ae="object"==typeof self&&self&&self.Object===Object&&self,Re=Le||Ae||Function("return this")(),Yt=Object.prototype.toString,Bt=Math.max,St=Math.min,Nt=function(){return Re.Date.now()};function he(ke){var at=typeof ke;return!!ke&&("object"==at||"function"==at)}function $e(ke){if("number"==typeof ke)return ke;if(function bt(ke){return"symbol"==typeof ke||function Je(ke){return!!ke&&"object"==typeof ke}(ke)&&"[object Symbol]"==Yt.call(ke)}(ke))return NaN;if(he(ke)){var at="function"==typeof ke.valueOf?ke.valueOf():ke;ke=he(at)?at+"":at}if("string"!=typeof ke)return 0===ke?ke:+ke;ke=ke.replace(Ve,"");var Fe=u.test(ke);return Fe||Q.test(ke)?Me(ke.slice(2),Fe?2:8):Te.test(ke)?NaN:+ke}Zt.exports=function kt(ke,at,Fe){var Ot,Wt,Lt,Cn,Ai,$i,qr=0,Er=!1,Tn=!1,wn=!0;if("function"!=typeof ke)throw new TypeError("Expected a function");function ir(ci){var hi=Ot,ln=Wt;return Ot=Wt=void 0,qr=ci,Cn=ke.apply(ln,hi)}function ii(ci){var hi=ci-$i;return void 0===$i||hi>=at||hi<0||Tn&&ci-qr>=Lt}function Hi(){var ci=Nt();if(ii(ci))return Pi(ci);Ai=setTimeout(Hi,function In(ci){var ns=at-(ci-$i);return Tn?St(ns,Lt-(ci-qr)):ns}(ci))}function Pi(ci){return Ai=void 0,wn&&Ot?ir(ci):(Ot=Wt=void 0,Cn)}function Zr(){var ci=Nt(),hi=ii(ci);if(Ot=arguments,Wt=this,$i=ci,hi){if(void 0===Ai)return function dn(ci){return qr=ci,Ai=setTimeout(Hi,at),Er?ir(ci):Cn}($i);if(Tn)return Ai=setTimeout(Hi,at),ir($i)}return void 0===Ai&&(Ai=setTimeout(Hi,at)),Cn}return at=$e(at)||0,he(Fe)&&(Er=!!Fe.leading,Lt=(Tn="maxWait"in Fe)?Bt($e(Fe.maxWait)||0,at):Lt,wn="trailing"in Fe?!!Fe.trailing:wn),Zr.cancel=function oi(){void 0!==Ai&&clearTimeout(Ai),qr=0,Ot=$i=Wt=Ai=void 0},Zr.flush=function Dn(){return void 0===Ai?Cn:Pi(Nt())},Zr}},574:function(Zt){Zt.exports=function(){"use strict";var qt,_e,gt;function Ve(u,Q){if(qt)if(_e){var Me="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+qt+")(sharedChunk); ("+_e+")(sharedChunk); self.onerror = null;",Le={};qt(Le),gt=Q(Le),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(gt.workerUrl=window.URL.createObjectURL(new Blob([Me],{type:"text/javascript"})))}else _e=Q;else qt=Q}return Ve(0,function(u){var Q=typeof self<"u"?self:{},Me="2.15.0";let Le;const Ae={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Le){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Le=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{Le=o}}return Le},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ae.API_URL)return null;try{const o=new URL(Ae.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Re={supported:!1,testSupport:function(o){!Bt&&Yt&&(St?Nt(o):yt=o)}};let yt,Yt,Bt=!1,St=!1;function Nt(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Yt),o.isContextLost())return;Re.supported=!0}catch{}o.deleteTexture(i),Bt=!0}Q.document&&(Yt=Q.document.createElement("img"),Yt.onload=function(){yt&&Nt(yt),yt=null,St=!0},Yt.onerror=function(){Bt=!0,yt=null},Yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const kt="01";function he(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Je=bt;function bt(o,i,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=s,this.p2y=c}bt.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(void 0===i&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var p=this.sampleCurveX(s)-o;if(Math.abs(p)<i)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=p/g}var v=0,w=1;for(s=o,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-o)<i));c++)o>p?v=s:w=s,s=.5*(w-v)+v;return s},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var $e=he(Je),ke=at;function at(o,i){this.x=o,this.y=i}at.prototype={clone:function(){return new at(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,s=o.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),s=Math.sin(o),c=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,i){var s=Math.cos(o),c=Math.sin(o),p=i.y+c*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-c*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},at.convert=function(o){return o instanceof at?o:Array.isArray(o)?new at(o[0],o[1]):o};var Fe=he(ke);const Ot=Math.PI/180,Wt=180/Math.PI;function Lt(o){return o*Ot}function Cn(o){return o*Wt}const Ai=[[0,0],[1,0],[1,1],[0,1]];function $i(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,s=i*o;return 4*(o<.5?s:3*(o-i)+s-.75)}function qr(o,i,s,c){const p=new $e(o,i,s,c);return function(g){return p.solve(g)}}const Er=qr(.25,.1,.25,1);function Tn(o,i,s){return Math.min(s,Math.max(i,o))}function wn(o,i,s){return(s=Tn((s-o)/(i-o),0,1))*s*(3-2*s)}function ir(o,i,s){const c=s-i,p=((o-i)%c+c)%c+i;return p===i?s:p}function dn(o,i,s){if(!o.length)return s(null,[]);let c=o.length;const p=new Array(o.length);let g=null;o.forEach((v,w)=>{i(v,(T,S)=>{T&&(g=T),p[w]=S,0==--c&&s(g,p)})})}function In(o){const i=[];for(const s in o)i.push(o[s]);return i}function ii(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}let Hi=1;function Pi(){return Hi++}function oi(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Dn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Zr(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function ci(o,i){o.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function hi(o,i){return-1!==o.indexOf(i,o.length-i.length)}function ln(o,i,s){const c={};for(const p in o)c[p]=i.call(s||this,o[p],p,o);return c}function ns(o,i,s){const c={};for(const p in o)i.call(s||this,o[p],p,o)&&(c[p]=o[p]);return c}function Ln(o){return Array.isArray(o)?o.map(Ln):"object"==typeof o&&o?ln(o,Ln):o}const Os={};function Yi(o){Os[o]||(typeof console<"u"&&console.warn(o),Os[o]=!0)}function go(o,i,s){return(s.y-o.y)*(i.x-o.x)>(i.y-o.y)*(s.x-o.x)}function sc(o){let i=0;for(let s,c,p=0,g=o.length,v=g-1;p<g;v=p++)s=o[p],c=o[v],i+=(c.x-s.x)*(s.y+c.y);return i}function is(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function no(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,g)=>{const v=p||g;return i[c]=!v||v.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let Hc=null;function Dl(o){if(null==Hc){const i=o.navigator?o.navigator.userAgent:null;Hc=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Hc}function Ml(o){try{const i=Q[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function _a(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}const Ya="mapbox-tiles";let io,Ns,ac=500,Gc=50;function ya(){try{return Q.caches}catch{}}function va(){ya()&&!io&&(io=Q.caches.open(Ya))}function Ka(o){const i=o.indexOf("?");if(i<0)return o;const c=function(p){const g=p.indexOf("?");return g>0?p.slice(g+1).split("&"):[]}(o).filter(p=>{const g=p.split("=");return"language"===g[0]||"worldview"===g[0]});return c.length?`${o.slice(0,i)}?${c.join("&")}`:o.slice(0,i)}let Sl=1/0;const Ja={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ja);class ro extends Error{constructor(i,s,c){401===s&&Be(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gs=is()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Q.location.protocol?Q.parent:Q).location.href,xa=function(o,i){if(!(/^file:/.test(s=o.url)||/^file:/.test(gs())&&!/^\w+:/.test(s))){if(Q.fetch&&Q.Request&&Q.AbortController&&Q.Request.prototype.hasOwnProperty("signal"))return function(c,p){const g=new Q.AbortController,v=new Q.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:gs(),referrerPolicy:c.referrerPolicy,signal:g.signal});let w=!1,T=!1;const S=(P=v.url).indexOf("sku=")>0&&Be(P);var P;"json"===c.type&&v.headers.set("Accept","application/json");const N=(V,j,q)=>{if(T)return;if(V&&"SecurityError"!==V.message&&Yi(V.toString()),j&&q)return F(j);const J=Date.now();Q.fetch(v).then(se=>{if(se.ok){const pe=S?se.clone():null;return F(se,pe,J)}return p(new ro(se.statusText,se.status,c.url))}).catch(se=>{"AbortError"!==se.name&&p(new Error(`${se.message} ${c.url}`))})},F=(V,j,q)=>{("arrayBuffer"===c.type?V.arrayBuffer():"json"===c.type?V.json():V.text()).then(J=>{T||(j&&q&&function(se,pe,ae){if(va(),!io)return;const de={status:pe.status,statusText:pe.statusText,headers:new Q.Headers};pe.headers.forEach((Ge,je)=>de.headers.set(je,Ge));const ge=no(pe.headers.get("Cache-Control")||"");if(ge["no-store"])return;ge["max-age"]&&de.headers.set("Expires",new Date(ae+1e3*ge["max-age"]).toUTCString());const me=de.headers.get("Expires");me&&(new Date(me).getTime()-ae<42e4||function(Ge,je){if(void 0===Ns)try{new Response(new ReadableStream),Ns=!0}catch{Ns=!1}Ns?je(Ge.body):Ge.blob().then(je)}(pe,Ge=>{const je=new Q.Response(Ge,de);va(),io&&io.then(ot=>ot.put(Ka(se.url),je)).catch(ot=>Yi(ot.message))}))}(v,j,q),w=!0,p(null,J,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(J=>{T||p(new Error(J.message))})};return S?function(V,j){if(va(),!io)return j(null);const q=Ka(V.url);io.then(J=>{J.match(q).then(se=>{const pe=function(ae){if(!ae)return!1;const de=new Date(ae.headers.get("Expires")||0),ge=no(ae.headers.get("Cache-Control")||"");return de>Date.now()&&!ge["no-cache"]}(se);J.delete(q),pe&&J.put(q,se.clone()),j(null,se,pe)}).catch(j)}).catch(j)}(v,N):N(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(o,i);if(is()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var s;return function(c,p){const g=new Q.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(g.responseType="arraybuffer");for(const v in c.headers)g.setRequestHeader(v,c.headers[v]);return"json"===c.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===c.credentials,g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let v=g.response;if("json"===c.type)try{v=JSON.parse(g.response)}catch(w){return p(w)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new ro(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,i)},Qa=function(o,i){return xa(ii(o,{type:"arrayBuffer"}),i)};function ba(o){const i=Q.document.createElement("a");return i.href=o,i.protocol===Q.document.location.protocol&&i.host===Q.document.location.host}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Z,Y;Z=[],Y=0;const ue=function(o,i){if(Re.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Y>=Ae.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Z.push(g),g}Y++;let s=!1;const c=()=>{if(!s)for(s=!0,Y--;Z.length&&Y<Ae.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Z.shift(),{requestParameters:v,callback:w,cancelled:T}=g;T||(g.cancel=ue(v,w).cancel)}},p=Qa(o,(g,v,w,T)=>{c(),g?i(g):v&&(Q.createImageBitmap?function(S,P){const N=new Q.Blob([new Uint8Array(S)],{type:"image/png"});Q.createImageBitmap(N).then(F=>{P(null,F)}).catch(F=>{P(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(S,P)=>i(S,P,w,T)):function(S,P){const N=new Q.Image,F=Q.URL;N.onload=()=>{P(null,N),F.revokeObjectURL(N.src),N.onload=null,Q.requestAnimationFrame(()=>{N.src=fe})},N.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Q.Blob([new Uint8Array(S)],{type:"image/png"});N.src=S.byteLength?F.createObjectURL(V):fe}(v,(S,P)=>i(S,P,w,T)))});return{cancel:()=>{p.cancel(),c()}}},ye="NO_ACCESS_TOKEN";function De(o){return 0===o.indexOf("mapbox:")}function Be(o){return Ae.API_URL_REGEX.test(o)}function ze(o){return Ae.API_CDN_URL_REGEX.test(o)}function Ce(o){return Ae.API_STYLE_REGEX.test(o)&&!Ye(o)}function Ye(o){return Ae.API_SPRITE_REGEX.test(o)}const Pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ft(o){const i=o.match(Pt);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Ct(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}const kn="mapbox.eventData";function Gn(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Q.atob(i[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class zn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=Gn(Ae.ACCESS_TOKEN);let c="";return c=s&&s.u?Q.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(+("0x"+g)))):Ae.ACCESS_TOKEN||"",i?`${kn}.${i}:${c}`:`${kn}:${c}`}fetchEventData(){const i=Ml("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const p=Q.localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));const g=Q.localStorage.getItem(c);g&&(this.anonId=g)}catch{Yi("Unable to read from LocalStorage")}}saveEventData(){const i=Ml("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{Q.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Q.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{Yi("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,c,p){if(!Ae.EVENTS_URL)return;const g=Ft(Ae.EVENTS_URL);g.params.push(`access_token=${p||Ae.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(i).toISOString()},w=s?ii(v,s):v,T={url:Ct(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var P;this.pendingRequest=(P=S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(p)},xa(ii(T,{method:"POST"}),P))}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const Mn=new class extends zn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){Ae.EVENTS_URL&&Ae.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>De(s)||Be(s))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Gn(Ae.ACCESS_TOKEN),s=i?i.u:Ae.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Zr(this.anonId)||(this.anonId=oi(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;c=c||w>=1||w<-1||g.getDate()!==v.getDate()}else c=!0;c?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Me,skuId:kt,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=s)},o):this.processRequests()}},zt=Mn.postTurnstileEvent.bind(Mn),zi=new class extends zn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,s,c){this.skuToken=i,this.errorCb=c,Ae.EVENTS_URL&&(s||Ae.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(ye)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Zr(this.anonId)||(this.anonId=oi()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Me,skuId:kt,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o))}},fr=zi.postMapLoadEvent.bind(zi),Ei=new class extends zn{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){Ae.EVENTS_URL&&(o||Ae.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:s}=this.queue.shift(),c=function(p){const g=Q.performance.getEntriesByType("resource"),v=Q.performance.getEntriesByType("mark"),w=function(F){const V={};if(F)for(const j in F)if("other"!==j)for(const q of F[j]){const J=`${j}ResolveRangeMin`,se=`${j}ResolveRangeMax`,pe=`${j}RequestCount`,ae=`${j}RequestCachedCount`;V[J]=Math.min(V[J]||1/0,q.startTime),V[se]=Math.max(V[se]||-1/0,q.responseEnd);const de=ge=>{void 0===V[ge]&&(V[ge]=0),++V[ge]};void 0!==q.transferSize&&0===q.transferSize&&de(ae),de(pe)}return V}(function(F,V){const j={};if(F)for(const q of F){const J=V(q);void 0===j[J]&&(j[J]=[]),j[J].push(q)}return j}(g,Ah)),T=Q.devicePixelRatio,S=Q.navigator.connection||Q.navigator.mozConnection||Q.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},N=(F,V,j)=>{null!=j&&F.push({name:V,value:j.toString()})};for(const F in w)N(P.counters,F,w[F]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(N(P.counters,"interactionRangeMin",p.interactionRange[0]),N(P.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const F of Object.keys(wa)){const V=wa[F],j=v.find(q=>q.name===V);j&&N(P.counters,V,j.startTime)}return N(P.counters,"visibilityHidden",p.visibilityHidden),N(P.attributes,"style",function(F){if(F)for(const V of F){const j=V.name.split("?")[0];if(Ce(j)){const q=j.split("/").slice(-2);if(2===q.length)return`mapbox://styles/${q[0]}/${q[1]}`}}}(g)),N(P.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),N(P.attributes,"fogEnabled",p.fogEnabled?"true":"false"),N(P.attributes,"projection",p.projection),N(P.attributes,"zoom",p.zoom),N(P.metadata,"devicePixelRatio",T),N(P.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),N(P.metadata,"navigatorUserAgent",Q.navigator.userAgent),N(P.metadata,"screenWidth",Q.screen.width),N(P.metadata,"screenHeight",Q.screen.height),N(P.metadata,"windowWidth",Q.innerWidth),N(P.metadata,"windowHeight",Q.innerHeight),N(P.metadata,"mapWidth",p.width/T),N(P.metadata,"mapHeight",p.height/T),N(P.metadata,"webglRenderer",p.renderer),N(P.metadata,"webglVendor",p.vendor),N(P.metadata,"sdkVersion",Me),N(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(s);for(const p of c.metadata);for(const p of c.counters);for(const p of c.attributes);this.postEvent(i,c,()=>{},o)}},Cr=Ei.postPerformanceEvent.bind(Ei),jo=new class extends zn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,s,c){if(!Ae.API_URL||!Ae.SESSION_PATH)return;const p=Ft(Ae.API_URL+Ae.SESSION_PATH);p.params.push(`sku=${i||""}`),p.params.push(`access_token=${c||Ae.ACCESS_TOKEN||""}`);const g={url:Ct(p),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(c)},xa(ii(g,{method:"GET"}),w))}getSessionAPI(o,i,s,c){this.skuToken=i,this.errorCb=c,Ae.SESSION_PATH&&Ae.API_URL&&(s||Ae.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(ye)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o)}},Lr=jo.getSessionAPI.bind(jo),Mr=new Set,wa={create:"create",load:"load",fullLoad:"fullLoad"},Vd={mark(o){Q.performance.mark(o)},measure(o,i,s){Q.performance.measure(o,i,s)}};function Ah(o){const i=o.name.split("?")[0];return ze(i)&&i.includes("mapbox-gl.js")?"javascript":ze(i)&&i.includes("mapbox-gl.css")?"css":Ae.API_FONTS_REGEX.test(i)?"fontRange":Ye(i)?"sprite":Ce(i)?"style":Ae.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const Yn=Q.performance;function Iu(o){const i=o?o.url.toString():void 0;return Yn.getEntriesByName(i)}let vr,Ea,oo,Fs;const zs={now:()=>void 0!==oo?oo:Q.performance.now(),setNow(o){oo=o},restoreNow(){oo=void 0},frame(o){const i=Q.requestAnimationFrame(o);return{cancel:()=>Q.cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:s,height:c}=o;Fs||(Fs=Q.document.createElement("canvas"));const p=Fs.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(s>Fs.width||c>Fs.height)&&(Fs.width=s,Fs.height=c),p.clearRect(-i,-i,s+2*i,c+2*i),p.drawImage(o,0,0,s,c),p.getImageData(-i,-i,s+2*i,c+2*i)},resolveURL:o=>(vr||(vr=Q.document.createElement("a")),vr.href=o,vr.href),get devicePixelRatio(){return Q.devicePixelRatio},get prefersReducedMotion(){return!!Q.matchMedia&&(null==Ea&&(Ea=Q.matchMedia("(prefers-reduced-motion: reduce)")),Ea.matches)}};function Au(o,i,s){s[o]&&-1!==s[o].indexOf(i)||(s[o]=s[o]||[],s[o].push(i))}function lc(o,i,s){if(s&&s[o]){const c=s[o].indexOf(i);-1!==c&&s[o].splice(c,1)}}class Ca{constructor(i,s={}){ii(this,s),this.type=i}}class _o extends Ca{constructor(i,s={}){super("error",ii({error:i},s))}}class Bs{on(i,s){return this._listeners=this._listeners||{},Au(i,s,this._listeners),this}off(i,s){return lc(i,s,this._listeners),lc(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Au(i,s,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,s){"string"==typeof i&&(i=new Ca(i,s||{}));const c=i.type;if(this.listens(c)){i.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of g)lc(c,w,this._oneTimeListeners),w.call(this,i);const v=this._eventedParent;v&&(ii(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(i))}else i instanceof _o&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rs(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}function Ki(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function On(o){if(Array.isArray(o))return o.map(On);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const s in o)i[s]=On(o[s]);return i}return Ki(o)}class rr extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}var Ao=rr;class Vs{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(i){return new Vs(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var el=Vs;const Ta={kind:"null"},it={kind:"number"},yn={kind:"string"},mn={kind:"boolean"},fn={kind:"color"},or={kind:"object"},qn={kind:"value"},Gi={kind:"collator"},os={kind:"formatted"},qi={kind:"resolvedImage"};function jn(o,i){return{kind:"array",itemType:o,N:i}}function fi(o){if("array"===o.kind){const i=fi(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const sr=[Ta,it,yn,mn,fn,os,or,jn(qn),qi];function Po(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!Po(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const s of sr)if(!Po(s,i))return null}return`Expected ${fi(o)} but found ${fi(i)} instead.`}function Us(o,i){return i.some(s=>s.kind===o.kind)}function vi(o,i){return i.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}var An,tl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function js(o){return(o=Math.round(o))<0?0:o>255?255:o}function Il(o){return js("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function Da(o){return(i="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function Mt(o,i,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(i-o)*s*6:2*s<1?i:3*s<2?o+(i-o)*(2/3-s)*6:o}try{An={}.parseCSSColor=function(o){var i,s=o.replace(/ /g,"").toLowerCase();if(s in tl)return tl[s].slice();if("#"===s[0])return 4===s.length?(i=parseInt(s.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===s.length&&(i=parseInt(s.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var c=s.indexOf("("),p=s.indexOf(")");if(-1!==c&&p+1===s.length){var g=s.substr(0,c),v=s.substr(c+1,p-(c+1)).split(","),w=1;switch(g){case"rgba":if(4!==v.length)return null;w=Da(v.pop());case"rgb":return 3!==v.length?null:[Il(v[0]),Il(v[1]),Il(v[2]),w];case"hsla":if(4!==v.length)return null;w=Da(v.pop());case"hsl":if(3!==v.length)return null;var T=(parseFloat(v[0])%360+360)%360/360,S=Da(v[1]),P=Da(v[2]),N=P<=.5?P*(S+1):P+S-P*S,F=2*P-N;return[js(255*Mt(F,N,T+1/3)),js(255*Mt(F,N,T)),js(255*Mt(F,N,T-1/3)),w];default:return null}}return null}}catch{}class kr{constructor(i,s,c,p=1){this.r=i,this.g=s,this.b=c,this.a=p}static parse(i){if(!i)return;if(i instanceof kr)return i;if("string"!=typeof i)return;const s=An(i);return s?new kr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[i,s,c,p]=this.toArray();return`rgba(${Math.round(i)},${Math.round(s)},${Math.round(c)},${p})`}toArray(){const{r:i,g:s,b:c,a:p}=this;return 0===p?[0,0,0,0]:[255*i/p,255*s/p,255*c/p,p]}toArray01(){const{r:i,g:s,b:c,a:p}=this;return 0===p?[0,0,0,0]:[i/p,s/p,c/p,p]}toArray01PremultipliedAlpha(){const{r:i,g:s,b:c,a:p}=this;return[i,s,c,p]}}kr.black=new kr(0,0,0,1),kr.white=new kr(1,1,1,1),kr.transparent=new kr(0,0,0,0),kr.red=new kr(1,0,0,1),kr.blue=new kr(0,0,1,1);var cn=kr;class on{constructor(i,s,c){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $o{constructor(i,s,c,p,g){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=c,this.fontStack=p,this.textColor=g}}class ri{constructor(i){this.sections=i}static fromString(i){return new ri([new $o(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof ri?i:ri.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){i.push(["image",s.image.name]);continue}i.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),i.push(c)}return i}}class Ro{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ro({name:i,available:!1}):null}serialize(){return["image",this.name]}}function Al(o,i,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,i,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,i,s,c]:[o,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Or(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof cn||o instanceof on||o instanceof ri||o instanceof Ro)return!0;if(Array.isArray(o)){for(const i of o)if(!Or(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!Or(o[i]))return!1;return!0}return!1}function ar(o){if(null===o)return Ta;if("string"==typeof o)return yn;if("boolean"==typeof o)return mn;if("number"==typeof o)return it;if(o instanceof cn)return fn;if(o instanceof on)return Gi;if(o instanceof ri)return os;if(o instanceof Ro)return qi;if(Array.isArray(o)){const i=o.length;let s;for(const c of o){const p=ar(c);if(s){if(s===p)continue;s=qn;break}s=p}return jn(s||qn,i)}return or}function ss(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof cn||o instanceof ri||o instanceof Ro?o.toString():JSON.stringify(o)}class qc{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(2!==i.length)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Or(i[1]))return s.error("invalid value");const c=i[1];let p=ar(c);const g=s.expectedType;return"array"!==p.kind||0!==p.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(p=g),new qc(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof cn?["rgba"].concat(this.value.toArray()):this.value instanceof ri?this.value.serialize():this.value}}var Wr=qc,xi=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const Ma={string:yn,number:it,boolean:mn,object:or};class Pu{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let c,p=1;const g=i[0];if("array"===g){let w,T;if(i.length>2){const S=i[1];if("string"!=typeof S||!(S in Ma)||"object"===S)return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ma[S],p++}else w=qn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=i[2],p++}c=jn(w,T)}else c=Ma[g];const v=[];for(;p<i.length;p++){const w=s.parse(i[p],p,qn);if(!w)return null;v.push(w)}return new Pu(c,v)}evaluate(i){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(i);if(!Po(this.type,ar(c)))return c;if(s===this.args.length-1)throw new xi(`Expected value to be of type ${fi(this.type)}, but found ${fi(ar(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const p=i.N;("number"==typeof p||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(c=>c.serialize()))}}var $s=Pu;class Sa{constructor(i){this.type=os,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=i.length-1;++v){const w=i[v];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=s.parse(w["font-scale"],1,it),!T))return null;let S=null;if(w["text-font"]&&(S=s.parse(w["text-font"],1,jn(yn)),!S))return null;let P=null;if(w["text-color"]&&(P=s.parse(w["text-color"],1,fn),!P))return null;const N=p[p.length-1];N.scale=T,N.font=S,N.textColor=P}else{const T=s.parse(i[v],1,qn);if(!T)return null;const S=T.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new Sa(p)}evaluate(i){return new ri(this.sections.map(s=>{const c=s.content.evaluate(i);return ar(c)===qi?new $o("",c,null,null,null):new $o(ss(c),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),i.push(c)}return i}}class Zc{constructor(i){this.type=qi,this.input=i}static parse(i,s){if(2!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,yn);return c?new Zc(c):s.error("No image name provided.")}evaluate(i){const s=this.input.evaluate(i),c=Ro.fromString(s);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(s)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ru={"to-boolean":mn,"to-color":fn,"to-number":it,"to-string":yn};class Ph{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return s.error("Expected one argument.");const p=Ru[c],g=[];for(let v=1;v<i.length;v++){const w=s.parse(i[v],v,qn);if(!w)return null;g.push(w)}return new Ph(p,g)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let s,c;for(const p of this.args){if(s=p.evaluate(i),c=null,s instanceof cn)return s;if("string"==typeof s){const g=i.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Al(s[0],s[1],s[2],s[3]),!c))return new cn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new xi(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(i),null===s)return 0;const p=Number(s);if(!isNaN(p))return p}throw new xi(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?ri.fromString(ss(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Ro.fromString(ss(this.args[0].evaluate(i))):ss(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Sa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Zc(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Ur=Ph;const Ut=["Unknown","Point","LineString","Polygon"];var Rh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ut[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-o[0])+this.featureDistanceData.bearing[1]*(c*i-o[1])}return 0}parseColor(o){let i=this._parseColorCache[o];return i||(i=this._parseColorCache[o]=cn.parse(o)),i}};class so{constructor(i,s,c,p){this.name=i,this.type=s,this._evaluate=c,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const c=i[0],p=so.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=v.filter(([S])=>!Array.isArray(S)||S.length===i.length-1);let T=null;for(const[S,P]of w){T=new Ra(s.registry,s.path,null,s.scope);const N=[];let F=!1;for(let V=1;V<i.length;V++){const j=i[V],q=Array.isArray(S)?S[V-1]:S.type,J=T.parse(j,1+N.length,q);if(!J){F=!0;break}N.push(J)}if(!F)if(Array.isArray(S)&&S.length!==N.length)T.error(`Expected ${S.length} arguments, but found ${N.length} instead.`);else{for(let V=0;V<N.length;V++){const j=Array.isArray(S)?S[V]:S.type,q=N[V];T.concat(V+1).checkSubtype(j,q.type)}if(0===T.errors.length)return new so(c,g,P,N)}}if(1===w.length)s.errors.push(...T.errors);else{const S=(w.length?w:v).map(([N])=>{return F=N,Array.isArray(F)?`(${F.map(fi).join(", ")})`:`(${fi(F.type)}...)`;var F}).join(" | "),P=[];for(let N=1;N<i.length;N++){const F=s.parse(i[N],1+P.length);if(!F)return null;P.push(fi(F.type))}s.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(i,s){so.definitions=s;for(const c in s)i[c]=so}}var Ho=so;class an{constructor(i,s,c){this.type=Gi,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(2!==i.length)return s.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,mn);if(!p)return null;const g=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,mn);if(!g)return null;let v=null;return c.locale&&(v=s.parse(c.locale,1,yn),!v)?null:new an(p,g,v)}evaluate(i){return new on(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Ia=8192;function Nr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Hs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Pl(o,i){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(s*p*Ia),Math.round(c*p*Ia)]}function Lu(o,i,s){const c=o[0]-i[0],p=o[1]-i[1],g=o[0]-s[0],v=o[1]-s[1];return c*v-g*p==0&&c*g<=0&&p*v<=0}function Wc(o,i){let s=!1;for(let v=0,w=i.length;v<w;v++){const T=i[v];for(let S=0,P=T.length;S<P-1;S++){if(Lu(o,T[S],T[S+1]))return!1;(p=T[S])[1]>(c=o)[1]!=(g=T[S+1])[1]>c[1]&&c[0]<(g[0]-p[0])*(c[1]-p[1])/(g[1]-p[1])+p[0]&&(s=!s)}}var c,p,g;return s}function Aa(o,i){for(let s=0;s<i.length;s++)if(Wc(o,i[s]))return!0;return!1}function Rl(o,i,s,c){const p=c[0]-s[0],g=c[1]-s[1],v=(o[0]-s[0])*g-p*(o[1]-s[1]),w=(i[0]-s[0])*g-p*(i[1]-s[1]);return v>0&&w<0||v<0&&w>0}function Xr(o,i,s){for(const S of s)for(let P=0;P<S.length-1;++P)if((w=[(v=S[P+1])[0]-(g=S[P])[0],v[1]-g[1]])[0]*(T=[(p=i)[0]-(c=o)[0],p[1]-c[1]])[1]-w[1]*T[0]!=0&&Rl(c,p,g,v)&&Rl(g,v,c,p))return!0;var c,p,g,v,w,T;return!1}function ui(o,i){for(let s=0;s<o.length;++s)if(!Wc(o[s],i))return!1;for(let s=0;s<o.length-1;++s)if(Xr(o[s],o[s+1],i))return!1;return!0}function Lh(o,i){for(let s=0;s<i.length;s++)if(ui(o,i[s]))return!0;return!1}function $n(o,i,s){const c=[];for(let p=0;p<o.length;p++){const g=[];for(let v=0;v<o[p].length;v++){const w=Pl(o[p][v],s);Nr(i,w),g.push(w)}c.push(g)}return c}function cc(o,i,s){const c=[];for(let p=0;p<o.length;p++){const g=$n(o[p],i,s);c.push(g)}return c}function uc(o,i,s,c){if(o[0]<s[0]||o[0]>s[2]){const p=.5*c;let g=o[0]-s[0]>p?-c:s[0]-o[0]>p?c:0;0===g&&(g=o[0]-s[2]>p?-c:s[2]-o[0]>p?c:0),o[0]+=g}Nr(i,o)}function Yr(o,i,s,c){const p=Math.pow(2,c.z)*Ia,g=[c.x*Ia,c.y*Ia],v=[];if(!o)return v;for(const w of o)for(const T of w){const S=[T.x+g[0],T.y+g[1]];uc(S,i,s,p),v.push(S)}return v}function Xc(o,i,s,c){const p=Math.pow(2,c.z)*Ia,g=[c.x*Ia,c.y*Ia],v=[];if(!o)return v;for(const T of o){const S=[];for(const P of T){const N=[P.x+g[0],P.y+g[1]];Nr(i,N),S.push(N)}v.push(S)}if(i[2]-i[0]<=p/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of v)for(const S of T)uc(S,i,s,p)}var w;return v}class Ll{constructor(i,s){this.type=mn,this.geojson=i,this.geometries=s}static parse(i,s){if(2!==i.length)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Or(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let p=0;p<c.features.length;++p){const g=c.features[p].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Ll(c,c.features[p].geometry)}else if("Feature"===c.type){const p=c.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Ll(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new Ll(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if("Polygon"===c.type){const w=$n(c.coordinates,g,v),T=Yr(s.geometry(),p,g,v);if(!Hs(p,g))return!1;for(const S of T)if(!Wc(S,w))return!1}if("MultiPolygon"===c.type){const w=cc(c.coordinates,g,v),T=Yr(s.geometry(),p,g,v);if(!Hs(p,g))return!1;for(const S of T)if(!Aa(S,w))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if("Polygon"===c.type){const w=$n(c.coordinates,g,v),T=Xc(s.geometry(),p,g,v);if(!Hs(p,g))return!1;for(const S of T)if(!ui(S,w))return!1}if("MultiPolygon"===c.type){const w=cc(c.coordinates,g,v),T=Xc(s.geometry(),p,g,v);if(!Hs(p,g))return!1;for(const S of T)if(!Lh(S,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var wi=Ll;function hc(o){if(o instanceof Ho&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof wi)return!1;let i=!0;return o.eachChild(s=>{i&&!hc(s)&&(i=!1)}),i}function Pa(o){if(o instanceof Ho&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(s=>{i&&!Pa(s)&&(i=!1)}),i}function Xt(o,i){if(o instanceof Ho&&i.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!Xt(c,i)&&(s=!1)}),s}class kl{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(2!==i.length||"string"!=typeof i[1])return s.error("'var' expression requires exactly one string literal argument.");const c=i[1];return s.scope.has(c)?new kl(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var dc=kl;class nl{constructor(i,s=[],c,p=new el,g=[]){this.registry=i,this.path=s,this.key=s.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=c}parse(i,s,c,p,g={}){return s?this.concat(s,c,p)._parse(i,g):this._parse(i,g)}_parse(i,s){function c(p,g,v){return"assert"===v?new $s(g,[p]):"coerce"===v?new Ur(g,[p]):p}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(i,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,T=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else v=c(v,w,s.typeAnnotation||"coerce");else v=c(v,w,s.typeAnnotation||"assert")}if(!(v instanceof Wr)&&"resolvedImage"!==v.type.kind&&Gs(v)){const w=new Rh;try{v=new Wr(v.type,v.evaluate(w))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,c){const p="number"==typeof i?this.path.concat(i):this.path,g=c?this.scope.concat(c):this.scope;return new nl(this.registry,p,s||null,g,this.errors)}error(i,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ao(c,i))}checkSubtype(i,s){const c=Po(i,s);return c&&this.error(c),c}}var Ra=nl;function Gs(o){if(o instanceof dc)return Gs(o.boundExpression);if(o instanceof Ho&&"error"===o.name||o instanceof an||o instanceof wi)return!1;const i=o instanceof Ur||o instanceof $s;let s=!0;return o.eachChild(c=>{s=i?s&&Gs(c):s&&c instanceof Wr}),!!s&&hc(o)&&Xt(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ol(o,i){const s=o.length-1;let c,p,g=0,v=s,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),c=o[w],p=o[w+1],c<=i){if(w===s||i<p)return w;g=w+1}else{if(!(c>i))throw new xi("Input is not a number.");v=w-1}return 0}class il{constructor(i,s,c){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[p,g]of c)this.labels.push(p),this.outputs.push(g)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(i[1],1,it);if(!c)return null;const p=[];let g=null;s.expectedType&&"value"!==s.expectedType.kind&&(g=s.expectedType);for(let v=1;v<i.length;v+=2){const w=1===v?-1/0:i[v],T=i[v+1],S=v,P=v+1;if("number"!=typeof w)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const N=s.parse(T,P,g);if(!N)return null;g=g||N.type,p.push([w,N])}return new il(g,c,p)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=s[0])return c[0].evaluate(i);const g=s.length;return p>=s[g-1]?c[g-1].evaluate(i):c[Ol(s,p)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}var Lo=il;function si(o,i,s){return o*(1-s)+i*s}var fc=Object.freeze({__proto__:null,array:function(o,i,s){return o.map((c,p)=>si(c,i[p],s))},color:function(o,i,s){return new cn(si(o.r,i.r,s),si(o.g,i.g,s),si(o.b,i.b,s),si(o.a,i.a,s))},number:si});const Nl=4/29,_s=6/29,ku=3*_s*_s,kh=_s*_s*_s,jd=Math.PI/180,Go=180/Math.PI;function ko(o){return o>kh?Math.pow(o,1/3):o/ku+Nl}function Ou(o){return o>_s?o*o*o:ku*(o-Nl)}function jr(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Yc(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function sn(o){const i=Yc(o.r),s=Yc(o.g),c=Yc(o.b),p=ko((.4124564*i+.3575761*s+.1804375*c)/.95047),g=ko((.2126729*i+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-ko((.0193339*i+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function Nu(o){let i=(o.l+16)/116,s=isNaN(o.a)?i:i+o.a/500,c=isNaN(o.b)?i:i-o.b/200;return i=1*Ou(i),s=.95047*Ou(s),c=1.08883*Ou(c),new cn(jr(3.2404542*s-1.5371385*i-.4985314*c),jr(-.969266*s+1.8760108*i+.041556*c),jr(.0556434*s-.2040259*i+1.0572252*c),o.alpha)}function tn(o,i,s){const c=i-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Zs={forward:sn,reverse:Nu,interpolate:function(o,i,s){return{l:si(o.l,i.l,s),a:si(o.a,i.a,s),b:si(o.b,i.b,s),alpha:si(o.alpha,i.alpha,s)}}},as={forward:function(o){const{l:i,a:s,b:c}=sn(o),p=Math.atan2(c,s)*Go;return{h:p<0?p+360:p,c:Math.sqrt(s*s+c*c),l:i,alpha:o.a}},reverse:function(o){const i=o.h*jd,s=o.c;return Nu({l:o.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:o.alpha})},interpolate:function(o,i,s){return{h:tn(o.h,i.h,s),c:si(o.c,i.c,s),l:si(o.l,i.l,s),alpha:si(o.alpha,i.alpha,s)}}};var rl=Object.freeze({__proto__:null,hcl:as,lab:Zs});class qo{constructor(i,s,c,p,g){this.type=i,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(i,s,c,p){let g=0;if("exponential"===i.name)g=Fl(s,i.base,c,p);else if("linear"===i.name)g=Fl(s,1,c,p);else if("cubic-bezier"===i.name){const v=i.controlPoints;g=new $e(v[0],v[1],v[2],v[3]).solve(Fl(s,1,c,p))}return g}static parse(i,s){let[c,p,g,...v]=i;if(!Array.isArray(p)||0===p.length)return s.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const S=p[1];if("number"!=typeof S)return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if("cubic-bezier"!==p[0])return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(4!==S.length||S.some(P=>"number"!=typeof P||P<0||P>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,it),!g)return null;const w=[];let T=null;"interpolate-hcl"===c||"interpolate-lab"===c?T=fn:s.expectedType&&"value"!==s.expectedType.kind&&(T=s.expectedType);for(let S=0;S<v.length;S+=2){const P=v[S],N=v[S+1],F=S+3,V=S+4;if("number"!=typeof P)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=P)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const j=s.parse(N,V,T);if(!j)return null;T=T||j.type,w.push([P,j])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new qo(T,c,p,g,w):s.error(`Type ${fi(T)} is not interpolatable.`)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=s[0])return c[0].evaluate(i);const g=s.length;if(p>=s[g-1])return c[g-1].evaluate(i);const v=Ol(s,p),w=qo.interpolationFactor(this.interpolation,p,s[v],s[v+1]),T=c[v].evaluate(i),S=c[v+1].evaluate(i);return"interpolate"===this.operator?fc[this.type.kind.toLowerCase()](T,S,w):"interpolate-hcl"===this.operator?as.reverse(as.interpolate(as.forward(T),as.forward(S),w)):Zs.reverse(Zs.interpolate(Zs.forward(T),Zs.forward(S),w))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Fl(o,i,s,c){const p=c-s,g=o-s;return 0===p?0:1===i?g/p:(Math.pow(i,g)-1)/(Math.pow(i,p)-1)}var ys=qo;class Co{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&"value"!==p.kind&&(c=p);const g=[];for(const w of i.slice(1)){const T=s.parse(w,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,g.push(T)}const v=p&&g.some(w=>Po(p,w.type));return new Co(v?qn:c,g)}evaluate(i){let s,c=null,p=0;for(const g of this.args){if(p++,c=g.evaluate(i),c&&c instanceof Ro&&!c.available&&(s||(s=c),c=null,p===this.args.length))return s;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var zl=Co;class xr{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let g=1;g<i.length-1;g+=2){const v=i[g];if("string"!=typeof v)return s.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=s.parse(i[g+1],g+1);if(!w)return null;c.push([v,w])}const p=s.parse(i[i.length-1],i.length-1,s.expectedType,c);return p?new xr(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,c]of this.bindings)i.push(s,c.serialize());return i.push(this.result.serialize()),i}}var ls=xr;class ei{constructor(i,s,c){this.type=i,this.index=s,this.input=c}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,it),p=s.parse(i[2],2,jn(s.expectedType||qn));return c&&p?new ei(p.type.itemType,c,p):null}evaluate(i){const s=this.index.evaluate(i),c=this.input.evaluate(i);if(s<0)throw new xi(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new xi(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new xi(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Kc=ei;class Oo{constructor(i,s){this.type=mn,this.needle=i,this.haystack=s}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,qn),p=s.parse(i[2],2,qn);return c&&p?Us(c.type,[mn,yn,it,Ta,qn])?new Oo(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(c.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!vi(s,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${fi(ar(s))} instead.`);if(!vi(c,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${fi(ar(c))} instead.`);return c.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ws=Oo;class ol{constructor(i,s,c){this.type=it,this.needle=i,this.haystack=s,this.fromIndex=c}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,qn),p=s.parse(i[2],2,qn);if(!c||!p)return null;if(!Us(c.type,[mn,yn,it,Ta,qn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(c.type)} instead`);if(4===i.length){const g=s.parse(i[3],3,it);return g?new ol(c,p,g):null}return new ol(c,p)}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!vi(s,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${fi(ar(s))} instead.`);if(!vi(c,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${fi(ar(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zo=ol;class vs{constructor(i,s,c,p,g,v){this.inputType=i,this.type=s,this.input=c,this.cases=p,this.outputs=g,this.otherwise=v}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);const g={},v=[];for(let S=2;S<i.length-1;S+=2){let P=i[S];const N=i[S+1];Array.isArray(P)||(P=[P]);const F=s.concat(S);if(0===P.length)return F.error("Expected at least one branch label.");for(const j of P){if("number"!=typeof j&&"string"!=typeof j)return F.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return F.error("Numeric branch labels must be integer values.");if(c){if(F.checkSubtype(c,ar(j)))return null}else c=ar(j);if(void 0!==g[String(j)])return F.error("Branch labels must be unique.");g[String(j)]=v.length}const V=s.parse(N,S,p);if(!V)return null;p=p||V.type,v.push(V)}const w=s.parse(i[1],1,qn);if(!w)return null;const T=s.parse(i[i.length-1],i.length-1,p);return T?"value"!==w.type.kind&&s.concat(1).checkSubtype(c,w.type)?null:new vs(c,p,w,g,v,T):null}evaluate(i){const s=this.input.evaluate(i);return(ar(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],p={};for(const v of s){const w=p[this.cases[v]];void 0===w?(p[this.cases[v]]=c.length,c.push([this.cases[v],[v]])):c[w][1].push(v)}const g=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of c)i.push(1===w.length?g(w[0]):w.map(g)),i.push(this.outputs[v].serialize());return i.push(this.otherwise.serialize()),i}}var Jc=vs;class sl{constructor(i,s,c){this.type=i,this.branches=s,this.otherwise=c}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const p=[];for(let v=1;v<i.length-1;v+=2){const w=s.parse(i[v],v,mn);if(!w)return null;const T=s.parse(i[v+1],v+1,c);if(!T)return null;p.push([w,T]),c=c||T.type}const g=s.parse(i[i.length-1],i.length-1,c);return g?new sl(c,p,g):null}evaluate(i){for(const[s,c]of this.branches)if(s.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,c]of this.branches)i(s),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Xs=sl;class Ys{constructor(i,s,c,p){this.type=i,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,qn),p=s.parse(i[2],2,it);if(!c||!p)return null;if(!Us(c.type,[jn(qn),yn,qn]))return s.error(`Expected first argument to be of type array or string, but found ${fi(c.type)} instead`);if(4===i.length){const g=s.parse(i[3],3,it);return g?new Ys(c.type,c,p,g):null}return new Ys(c.type,c,p)}evaluate(i){const s=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!vi(s,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${fi(ar(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return s.slice(c,p)}return s.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var pc=Ys;function Ks(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Fu(o,i,s,c){return 0===c.compare(i,s)}function xs(o,i,s){const c="=="!==o&&"!="!==o;return class y2{constructor(g,v,w){this.type=mn,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}static parse(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");const w=g[0];let T=v.parse(g[1],1,qn);if(!T)return null;if(!Ks(w,T.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${fi(T.type)}'.`);let S=v.parse(g[2],2,qn);if(!S)return null;if(!Ks(w,S.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${fi(S.type)}'.`);if(T.type.kind!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return v.error(`Cannot compare types '${fi(T.type)}' and '${fi(S.type)}'.`);c&&("value"===T.type.kind&&"value"!==S.type.kind?T=new $s(S.type,[T]):"value"!==T.type.kind&&"value"===S.type.kind&&(S=new $s(T.type,[S])));let P=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(g[3],3,Gi),!P)return null}return new y2(T,S,P)}evaluate(g){const v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const T=ar(v),S=ar(w);if(T.kind!==S.kind||"string"!==T.kind&&"number"!==T.kind)throw new xi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=ar(v),S=ar(w);if("string"!==T.kind||"string"!==S.kind)return i(g,v,w)}return this.collator?s(g,v,w,this.collator.evaluate(g)):i(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(v=>{g.push(v.serialize())}),g}}}const $d=xs("==",function(o,i,s){return i===s},Fu),zu=xs("!=",function(o,i,s){return i!==s},function(o,i,s,c){return!Fu(0,i,s,c)}),Hd=xs("<",function(o,i,s){return i<s},function(o,i,s,c){return c.compare(i,s)<0}),Oh=xs(">",function(o,i,s){return i>s},function(o,i,s,c){return c.compare(i,s)>0}),cs=xs("<=",function(o,i,s){return i<=s},function(o,i,s,c){return c.compare(i,s)<=0}),us=xs(">=",function(o,i,s){return i>=s},function(o,i,s,c){return c.compare(i,s)>=0});class La{constructor(i,s,c,p,g,v){this.type=yn,this.number=i,this.locale=s,this.currency=c,this.unit=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,s){if(3!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,it);if(!c)return null;const p=i[2];if("object"!=typeof p||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=s.parse(p.locale,1,yn),!g))return null;let v=null;if(p.currency&&(v=s.parse(p.currency,1,yn),!v))return null;let w=null;if(p.unit&&(w=s.parse(p.unit,1,yn),!w))return null;let T=null;if(p["min-fraction-digits"]&&(T=s.parse(p["min-fraction-digits"],1,it),!T))return null;let S=null;return p["max-fraction-digits"]&&(S=s.parse(p["max-fraction-digits"],1,it),!S)?null:new La(c,g,v,w,T,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Bl{constructor(i){this.type=it,this.input=i}static parse(i,s){if(2!==i.length)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=s.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${fi(c.type)} instead.`):new Bl(c):null}evaluate(i){const s=this.input.evaluate(i);if("string"==typeof s||Array.isArray(s))return s.length;throw new xi(`Expected value to be of type string or array, but found ${fi(ar(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}const mc={"==":$d,"!=":zu,">":Oh,"<":Hd,">=":us,"<=":cs,array:$s,at:Kc,boolean:$s,case:Xs,coalesce:zl,collator:an,format:Sa,image:Zc,in:Ws,"index-of":Zo,interpolate:ys,"interpolate-hcl":ys,"interpolate-lab":ys,length:Bl,let:ls,literal:Wr,match:Jc,number:$s,"number-format":La,object:$s,slice:pc,step:Lo,string:$s,"to-boolean":Ur,"to-color":Ur,"to-number":Ur,"to-string":Ur,var:dc,within:wi};function Nh(o,[i,s,c,p]){i=i.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const g=p?p.evaluate(o):1,v=Al(i,s,c,g);if(v)throw new xi(v);return new cn(i/255*g,s/255*g,c/255*g,g)}function bs(o,i){return o in i}function gc(o,i){const s=i[o];return void 0===s?null:s}function ao(o){return{type:o}}Ho.register(mc,{error:[{kind:"error"},[yn],(o,[i])=>{throw new xi(i.evaluate(o))}],typeof:[yn,[qn],(o,[i])=>fi(ar(i.evaluate(o)))],"to-rgba":[jn(it,4),[fn],(o,[i])=>i.evaluate(o).toArray()],rgb:[fn,[it,it,it],Nh],rgba:[fn,[it,it,it,it],Nh],has:{type:mn,overloads:[[[yn],(o,[i])=>bs(i.evaluate(o),o.properties())],[[yn,or],(o,[i,s])=>bs(i.evaluate(o),s.evaluate(o))]]},get:{type:qn,overloads:[[[yn],(o,[i])=>gc(i.evaluate(o),o.properties())],[[yn,or],(o,[i,s])=>gc(i.evaluate(o),s.evaluate(o))]]},"feature-state":[qn,[yn],(o,[i])=>gc(i.evaluate(o),o.featureState||{})],properties:[or,[],o=>o.properties()],"geometry-type":[yn,[],o=>o.geometryType()],id:[qn,[],o=>o.id()],zoom:[it,[],o=>o.globals.zoom],pitch:[it,[],o=>o.globals.pitch||0],"distance-from-center":[it,[],o=>o.distanceFromCenter()],"heatmap-density":[it,[],o=>o.globals.heatmapDensity||0],"line-progress":[it,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[it,[],o=>o.globals.skyRadialProgress||0],accumulated:[qn,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[it,ao(it),(o,i)=>{let s=0;for(const c of i)s+=c.evaluate(o);return s}],"*":[it,ao(it),(o,i)=>{let s=1;for(const c of i)s*=c.evaluate(o);return s}],"-":{type:it,overloads:[[[it,it],(o,[i,s])=>i.evaluate(o)-s.evaluate(o)],[[it],(o,[i])=>-i.evaluate(o)]]},"/":[it,[it,it],(o,[i,s])=>i.evaluate(o)/s.evaluate(o)],"%":[it,[it,it],(o,[i,s])=>i.evaluate(o)%s.evaluate(o)],ln2:[it,[],()=>Math.LN2],pi:[it,[],()=>Math.PI],e:[it,[],()=>Math.E],"^":[it,[it,it],(o,[i,s])=>Math.pow(i.evaluate(o),s.evaluate(o))],sqrt:[it,[it],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[it,[it],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[it,[it],(o,[i])=>Math.log(i.evaluate(o))],log2:[it,[it],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[it,[it],(o,[i])=>Math.sin(i.evaluate(o))],cos:[it,[it],(o,[i])=>Math.cos(i.evaluate(o))],tan:[it,[it],(o,[i])=>Math.tan(i.evaluate(o))],asin:[it,[it],(o,[i])=>Math.asin(i.evaluate(o))],acos:[it,[it],(o,[i])=>Math.acos(i.evaluate(o))],atan:[it,[it],(o,[i])=>Math.atan(i.evaluate(o))],min:[it,ao(it),(o,i)=>Math.min(...i.map(s=>s.evaluate(o)))],max:[it,ao(it),(o,i)=>Math.max(...i.map(s=>s.evaluate(o)))],abs:[it,[it],(o,[i])=>Math.abs(i.evaluate(o))],round:[it,[it],(o,[i])=>{const s=i.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[it,[it],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[it,[it],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[mn,[yn,qn],(o,[i,s])=>o.properties()[i.value]===s.value],"filter-id-==":[mn,[qn],(o,[i])=>o.id()===i.value],"filter-type-==":[mn,[yn],(o,[i])=>o.geometryType()===i.value],"filter-<":[mn,[yn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[mn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<c}],"filter->":[mn,[yn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[mn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>c}],"filter-<=":[mn,[yn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[mn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<=c}],"filter->=":[mn,[yn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[mn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>=c}],"filter-has":[mn,[qn],(o,[i])=>i.value in o.properties()],"filter-has-id":[mn,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[mn,[jn(yn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[mn,[jn(qn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[mn,[yn,jn(qn)],(o,[i,s])=>s.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[mn,[yn,jn(qn)],(o,[i,s])=>function(c,p,g,v){for(;g<=v;){const w=g+v>>1;if(p[w]===c)return!0;p[w]>c?v=w-1:g=w+1}return!1}(o.properties()[i.value],s.value,0,s.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(o,[i,s])=>i.evaluate(o)&&s.evaluate(o)],[ao(mn),(o,i)=>{for(const s of i)if(!s.evaluate(o))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(o,[i,s])=>i.evaluate(o)||s.evaluate(o)],[ao(mn),(o,i)=>{for(const s of i)if(s.evaluate(o))return!0;return!1}]]},"!":[mn,[mn],(o,[i])=>!i.evaluate(o)],"is-supported-script":[mn,[yn],(o,[i])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(i.evaluate(o))}],upcase:[yn,[yn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[yn,[yn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[yn,ao(qn),(o,i)=>i.map(s=>ss(s.evaluate(o))).join("")],"resolved-locale":[yn,[Gi],(o,[i])=>i.evaluate(o).resolvedLocale()]});var _c=mc;function al(o){return{result:"success",value:o}}function pr(o){return{result:"error",value:o}}function ll(o){return"data-driven"===o["property-type"]}function Qc(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Wo(o){return!!o.expression&&o.expression.interpolated}function Nn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Vl(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function cl(o){return o}function Pn(o,i){const s="color"===i.type,c=o.stops&&"object"==typeof o.stops[0][0],p=c||!(c||void 0!==o.property),g=o.type||(Wo(i)?"exponential":"interval");if(s&&((o=rs({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],cn.parse(S[1])])),o.default=cn.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!rl[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let v,w,T;if("exponential"===g)v=lr;else if("interval"===g)v=Tr;else if("categorical"===g){v=ti,w=Object.create(null);for(const S of o.stops)w[S[0]]=S[1];T=typeof o.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);v=ul}if(c){const S={},P=[];for(let V=0;V<o.stops.length;V++){const j=o.stops[V],q=j[0].zoom;void 0===S[q]&&(S[q]={zoom:q,type:o.type,property:o.property,default:o.default,stops:[]},P.push(q)),S[q].stops.push([j[0].value,j[1]])}const N=[];for(const V of P)N.push([S[V].zoom,Pn(S[V],i)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:ys.interpolationFactor.bind(void 0,F),zoomStops:N.map(V=>V[0]),evaluate:({zoom:V},j)=>lr({stops:N,base:o.base},i,V).evaluate(V,j)}}if(p){const S="exponential"===g?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ys.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(o,i,P,w,T)}}return{kind:"source",evaluate(S,P){const N=P&&P.properties?P.properties[o.property]:void 0;return void 0===N?br(o.default,i.default):v(o,i,N,w,T)}}}function br(o,i,s){return void 0!==o?o:void 0!==i?i:void 0!==s?s:void 0}function ti(o,i,s,c,p){return br(typeof s===p?c[s]:void 0,o.default,i.default)}function Tr(o,i,s){if("number"!==Nn(s))return br(o.default,i.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const p=Ol(o.stops.map(g=>g[0]),s);return o.stops[p][1]}function lr(o,i,s){const c=void 0!==o.base?o.base:1;if("number"!==Nn(s))return br(o.default,i.default);const p=o.stops.length;if(1===p||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[p-1][0])return o.stops[p-1][1];const g=Ol(o.stops.map(P=>P[0]),s),v=function(P,N,F,V){const j=V-F,q=P-F;return 0===j?0:1===N?q/j:(Math.pow(N,q)-1)/(Math.pow(N,j)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),w=o.stops[g][1],T=o.stops[g+1][1];let S=fc[i.type]||cl;if(o.colorSpace&&"rgb"!==o.colorSpace){const P=rl[o.colorSpace];S=(N,F)=>P.reverse(P.interpolate(P.forward(N),P.forward(F),v))}return"function"==typeof w.evaluate?{evaluate(...P){const N=w.evaluate.apply(void 0,P),F=T.evaluate.apply(void 0,P);if(void 0!==N&&void 0!==F)return S(N,F,v)}}:S(w,T,v)}function ul(o,i,s){return"color"===i.type?s=cn.parse(s):"formatted"===i.type?s=ri.fromString(s.toString()):"resolvedImage"===i.type?s=Ro.fromString(s.toString()):Nn(s)===i.type||"enum"===i.type&&i.values[s]||(s=void 0),br(s,o.default,i.default)}class Kr{constructor(i,s){var c;this.expression=i,this._warningHistory={},this._evaluator=new Rh,this._defaultValue=s?"color"===(c=s).type&&(Vl(c.default)||Array.isArray(c.default))?new cn(0,0,0,0):"color"===c.type?cn.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(i,s,c,p,g,v,w,T){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,c,p,g,v,w,T){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function ka(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in _c}function Oa(o,i){const s=new Ra(_c,[],i?function(p){const g={color:fn,string:yn,number:it,enum:yn,boolean:mn,formatted:os,resolvedImage:qi};return"array"===p.type?jn(g[p.value]||qn,p.length):g[p.type]}(i):void 0),c=s.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?al(new Kr(c,i)):pr(s.errors)}class hl{constructor(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent="constant"!==i&&!Pa(s.expression)}evaluateWithoutErrorHandling(i,s,c,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,p,g,v)}evaluate(i,s,c,p,g,v){return this._styleExpression.evaluate(i,s,c,p,g,v)}}class Ul{constructor(i,s,c,p){this.kind=i,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==i&&!Pa(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,s,c,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,p,g,v)}evaluate(i,s,c,p,g,v){return this._styleExpression.evaluate(i,s,c,p,g,v)}interpolationFactor(i,s,c){return this.interpolationType?ys.interpolationFactor(this.interpolationType,i,s,c):0}}function yc(o,i){if("error"===(o=Oa(o,i)).result)return o;const s=o.value.expression,c=hc(s);if(!c&&!ll(i))return pr([new Ao("","data expressions not supported")]);const p=Xt(s,["zoom","pitch","distance-from-center"]);if(!p&&!Qc(i))return pr([new Ao("","zoom expressions not supported")]);const g=Jt(s);return g||p?g instanceof Ao?pr([g]):g instanceof ys&&!Wo(i)?pr([new Ao("",'"interpolate" expressions cannot be used with this property')]):al(g?new Ul(c?"camera":"composite",o.value,g.labels,g instanceof ys?g.interpolation:void 0):new hl(c?"constant":"source",o.value)):pr([new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zi{constructor(i,s){this._parameters=i,this._specification=s,rs(this,Pn(this._parameters,this._specification))}static deserialize(i){return new Zi(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Jt(o){let i=null;if(o instanceof ls)i=Jt(o.result);else if(o instanceof zl){for(const s of o.args)if(i=Jt(s),i)break}else(o instanceof Lo||o instanceof ys)&&o.input instanceof Ho&&"zoom"===o.input.name&&(i=o);return i instanceof Ao||o.eachChild(s=>{const c=Jt(s);c instanceof Ao?i=c:!i&&c?i=new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new Ao("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class ft{constructor(i,s,c,p){this.message=(i?`${i}: `:"")+c,p&&(this.identifier=p),null!=s&&s.__line__&&(this.line=s.__line__)}}function h(o){const i=o.key,s=o.value,c=o.valueSpec||{},p=o.objectElementValidators||{},g=o.style,v=o.styleSpec;let w=[];const T=Nn(s);if("object"!==T)return[new ft(i,s,`object expected, ${T} found`)];for(const S in s){const P=S.split(".")[0];let N;p[P]?N=p[P]:c[P]?N=lo:p["*"]?N=p["*"]:c["*"]&&(N=lo),N?w=w.concat(N({key:(i&&`${i}.`)+S,value:s[S],valueSpec:c[P]||c["*"],style:g,styleSpec:v,object:s,objectKey:S},s)):w.push(new ft(i,s[S],`unknown property "${S}"`))}for(const S in c)p[S]||c[S].required&&void 0===c[S].default&&void 0===s[S]&&w.push(new ft(i,s,`missing required property "${S}"`));return w}function x(o){const i=o.value,s=o.valueSpec,c=o.style,p=o.styleSpec,g=o.key,v=o.arrayElementValidator||lo;if("array"!==Nn(i))return[new ft(g,i,`array expected, ${Nn(i)} found`)];if(s.length&&i.length!==s.length)return[new ft(g,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new ft(g,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let w={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};p.$version<7&&(w.function=s.function),"object"===Nn(s.value)&&(w=s.value);let T=[];for(let S=0;S<i.length;S++)T=T.concat(v({array:i,arrayIndex:S,value:i[S],valueSpec:w,style:c,styleSpec:p,key:`${g}[${S}]`}));return T}function M(o){const i=o.key,s=o.value,c=o.valueSpec;let p=Nn(s);if("number"===p&&s!=s&&(p="NaN"),"number"!==p)return[new ft(i,s,`number expected, ${p} found`)];if("minimum"in c){let g=c.minimum;if("array"===Nn(c.minimum)&&(g=c.minimum[o.arrayIndex]),s<g)return[new ft(i,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if("array"===Nn(c.maximum)&&(g=c.maximum[o.arrayIndex]),s>g)return[new ft(i,s,`${s} is greater than the maximum value ${g}`)]}return[]}function k(o){const i=o.valueSpec,s=Ki(o.value.type);let c,p,g,v={};const w="categorical"!==s&&void 0===o.value.property,T=!w,S="array"===Nn(o.value.stops)&&"array"===Nn(o.value.stops[0])&&"object"===Nn(o.value.stops[0][0]),P=h({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(V){if("identity"===s)return[new ft(V.key,V.value,'identity function may not have a "stops" property')];let j=[];const q=V.value;return j=j.concat(x({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),"array"===Nn(q)&&0===q.length&&j.push(new ft(V.key,q,"array must have at least one stop")),j},default:function(V){return lo({key:V.key,value:V.value,valueSpec:i,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===s&&w&&P.push(new ft(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||P.push(new ft(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!Wo(o.valueSpec)&&P.push(new ft(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(T&&!ll(o.valueSpec)?P.push(new ft(o.key,o.value,"property functions not supported")):w&&!Qc(o.valueSpec)&&P.push(new ft(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!S||void 0!==o.value.property||P.push(new ft(o.key,o.value,'"property" property is required')),P;function N(V){let j=[];const q=V.value,J=V.key;if("array"!==Nn(q))return[new ft(J,q,`array expected, ${Nn(q)} found`)];if(2!==q.length)return[new ft(J,q,`array length 2 expected, length ${q.length} found`)];if(S){if("object"!==Nn(q[0]))return[new ft(J,q,`object expected, ${Nn(q[0])} found`)];if(void 0===q[0].zoom)return[new ft(J,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new ft(J,q,"object stop key must have value")];const se=Ki(q[0].zoom);if("number"!=typeof se)return[new ft(J,q[0].zoom,"stop zoom values must be numbers")];if(g&&g>se)return[new ft(J,q[0].zoom,"stop zoom values must appear in ascending order")];se!==g&&(g=se,p=void 0,v={}),j=j.concat(h({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:M,value:F}}))}else j=j.concat(F({key:`${J}[0]`,value:q[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},q));return ka(On(q[1]))?j.concat([new ft(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(lo({key:`${J}[1]`,value:q[1],valueSpec:i,style:V.style,styleSpec:V.styleSpec}))}function F(V,j){const q=Nn(V.value),J=Ki(V.value),se=null!==V.value?V.value:j;if(c){if(q!==c)return[new ft(V.key,se,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new ft(V.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==s){let pe=`number expected, ${q} found`;return ll(i)&&void 0===s&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(V.key,se,pe)]}return"categorical"!==s||"number"!==q||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==s&&"number"===q&&"number"==typeof J&&"number"==typeof p&&void 0!==p&&J<p?[new ft(V.key,se,"stop domain values must appear in ascending order")]:(p=J,"categorical"===s&&J in v?[new ft(V.key,se,"stop domain values must be unique")]:(v[J]=!0,[])):[new ft(V.key,se,`integer expected, found ${String(J)}`)]}}function U(o){const i=("property"===o.expressionContext?yc:Oa)(On(o.value),o.valueSpec);if("error"===i.result)return i.value.map(c=>new ft(`${o.key}${c.key}`,o.value,c.message));const s=i.value.expression||i.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new ft(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Pa(s))return[new ft(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return X(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Xt(s,["zoom","feature-state"]))return[new ft(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!hc(s))return[new ft(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function X(o,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const p of i.valueSpec.expression.parameters)s.delete(p);if(0===s.size)return[];const c=[];return o instanceof Ho&&s.has(o.name)?[new ft(i.key,i.value,`["${o.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(o.eachChild(p=>{c.push(...X(p,i))}),c)}function xe(o){const i=o.key,s=o.value,c=o.valueSpec,p=[];return Array.isArray(c.values)?-1===c.values.indexOf(Ki(s))&&p.push(new ft(i,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Ki(s))&&p.push(new ft(i,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function He(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!He(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Oe(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};He(o)||(o=Wi(o));const s=o;let c=!0;try{c=function(S){if(!xn(S))return S;let P=On(S);return rn(P),P=Tt(P),P}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const p=tt[`filter_${i}`],g=Oa(c,p);let v=null;if("error"===g.result)throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));v=(S,P,N)=>g.value.evaluate(S,P,{},N);let w=null,T=null;if(c!==s){const S=Oa(s,p);if("error"===S.result)throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,N,F,V,j)=>S.value.evaluate(P,N,{},F,void 0,void 0,V,j),T=!hc(S.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:cr(c),needFeature:!!T}}function Tt(o){if(!Array.isArray(o))return o;const i=function(s){if(vn.has(s[0]))for(let c=1;c<s.length;c++)if(xn(s[c]))return!0;return s}(o);return!0===i?i:i.map(s=>Tt(s))}function rn(o){let i=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)i=i||xn(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){i=i||xn(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){i=i||xn(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}i&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)rn(o[c])}function xn(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let s=1;s<o.length;s++)if(xn(o[s]))return!0;return!1}const vn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fr(o,i){return o<i?-1:o>i?1:0}function cr(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let i=1;i<o.length;i++)if(cr(o[i]))return!0;return!1}function Wi(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?Sr(o[1],o[2],"=="):"!="===i?Xo(Sr(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Sr(o[1],o[2],i):"any"===i?(s=o.slice(1),["any"].concat(s.map(Wi))):"all"===i?["all"].concat(o.slice(1).map(Wi)):"none"===i?["all"].concat(o.slice(1).map(Wi).map(Xo)):"in"===i?Js(o[1],o.slice(2)):"!in"===i?Xo(Js(o[1],o.slice(2))):"has"===i?ws(o[1]):"!has"===i?Xo(ws(o[1])):"within"!==i||o;var s}function Sr(o,i,s){switch(o){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,o,i]}}function Js(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Fr)]]:["filter-in-small",o,["literal",i]]}}function ws(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Xo(o){return["!",o]}function Qs(o){return He(On(o.value))?U(rs({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):Es(o)}function Es(o){const i=o.value,s=o.key;if("array"!==Nn(i))return[new ft(s,i,`array expected, ${Nn(i)} found`)];const c=o.styleSpec;let p,g=[];if(i.length<1)return[new ft(s,i,"filter array must have at least 1 element")];switch(g=g.concat(xe({key:`${s}[0]`,value:i[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Ki(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ki(i[1])&&g.push(new ft(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&g.push(new ft(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=Nn(i[1]),"string"!==p&&g.push(new ft(`${s}[1]`,i[1],`string expected, ${p} found`)));for(let v=2;v<i.length;v++)p=Nn(i[v]),"$type"===Ki(i[1])?g=g.concat(xe({key:`${s}[${v}]`,value:i[v],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&g.push(new ft(`${s}[${v}]`,i[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<i.length;v++)g=g.concat(Es({key:`${s}[${v}]`,value:i[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=Nn(i[1]),2!==i.length?g.push(new ft(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==p&&g.push(new ft(`${s}[1]`,i[1],`string expected, ${p} found`));break;case"within":p=Nn(i[1]),2!==i.length?g.push(new ft(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==p&&g.push(new ft(`${s}[1]`,i[1],`object expected, ${p} found`))}return g}function ni(o,i){const s=o.key,c=o.style,p=o.styleSpec,g=o.value,v=o.objectKey,w=p[`${i}_${o.layerType}`];if(!w)return[];const T=v.match(/^(.*)-transition$/);if("paint"===i&&T&&w[T[1]]&&w[T[1]].transition)return lo({key:s,value:g,valueSpec:p.transition,style:c,styleSpec:p});const S=o.valueSpec||w[v];if(!S)return[new ft(s,g,`unknown property "${v}"`)];let P;if("string"===Nn(g)&&ll(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(g))){const F=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new ft(s,g,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${F}.`)]}const N=[];return"symbol"===o.layerType&&("text-field"===v&&c&&!c.glyphs&&N.push(new ft(s,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Vl(On(g))&&"identity"===Ki(g.type)&&N.push(new ft(s,g,'"text-font" does not support identity functions'))),N.concat(lo({key:o.key,value:g,valueSpec:S,style:c,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:v}))}function Fh(o){return ni(o,"paint")}function ur(o){return ni(o,"layout")}function jl(o){let i=[];const s=o.value,c=o.key,p=o.style,g=o.styleSpec;s.type||s.ref||i.push(new ft(c,s,'either "type" or "ref" is required'));let v=Ki(s.type);const w=Ki(s.ref);if(s.id){const T=Ki(s.id);for(let S=0;S<o.arrayIndex;S++){const P=p.layers[S];Ki(P.id)===T&&i.push(new ft(c,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(S=>{S in s&&i.push(new ft(c,s[S],`"${S}" is prohibited for ref layers`))}),p.layers.forEach(S=>{Ki(S.id)===w&&(T=S)}),T?T.ref?i.push(new ft(c,s.ref,"ref cannot reference another ref layer")):v=Ki(T.type):"string"==typeof w&&i.push(new ft(c,s.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(s.source){const T=p.sources&&p.sources[s.source],S=T&&Ki(T.type);T?"vector"===S&&"raster"===v?i.push(new ft(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===S&&"raster"!==v?i.push(new ft(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==S||s["source-layer"]?"raster-dem"===S&&"hillshade"!==v?i.push(new ft(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||"geojson"===S&&T.lineMetrics||i.push(new ft(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ft(c,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new ft(c,s.source,`source "${s.source}" not found`))}else i.push(new ft(c,s,'missing required property "source"'));return i=i.concat(h({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lo({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:T=>Qs(rs({layerType:v},T)),layout:T=>h({layer:s,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>ur(rs({layerType:v},S))}}),paint:T=>h({layer:s,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>Fh(rs({layerType:v},S))}})}})),i}function Jr(o){const i=o.value,s=o.key,c=Nn(i);return"string"!==c?[new ft(s,i,`string expected, ${c} found`)]:[]}const vc={promoteId:function({key:o,value:i}){if("string"===Nn(i))return Jr({key:o,value:i});{const s=[];for(const c in i)s.push(...Jr({key:`${o}.${c}`,value:i[c]}));return s}}};function dl(o){const i=o.value,s=o.key,c=o.styleSpec,p=o.style;if(!i.type)return[new ft(s,i,'"type" is required')];const g=Ki(i.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=h({key:s,value:i,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:vc}),v;case"geojson":if(v=h({key:s,value:i,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:vc}),i.cluster)for(const w in i.clusterProperties){const[T,S]=i.clusterProperties[w],P="string"==typeof T?[T,["accumulated"],["get",w]]:T;v.push(...U({key:`${s}.${w}.map`,value:S,expressionContext:"cluster-map"})),v.push(...U({key:`${s}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return h({key:s,value:i,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return h({key:s,value:i,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new ft(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xe({key:`${s}.type`,value:i.type,valueSpec:{values:fl(c)},style:p,styleSpec:c})}}function fl(o){return o.source.reduce((i,s)=>{const c=o[s];return"enum"===c.type.type&&(i=i.concat(Object.keys(c.type.values))),i},[])}function zr(o){const i=o.value,s=o.styleSpec,c=s.light,p=o.style;let g=[];const v=Nn(i);if(void 0===i)return g;if("object"!==v)return g=g.concat([new ft("light",i,`object expected, ${v} found`)]),g;for(const w in i){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&c[T[1]]&&c[T[1]].transition?lo({key:w,value:i[w],valueSpec:s.transition,style:p,styleSpec:s}):c[w]?lo({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:s}):[new ft(w,i[w],`unknown property "${w}"`)])}return g}function zh(o){const i=o.value,s=o.key,c=o.style,p=o.styleSpec,g=p.terrain;let v=[];const w=Nn(i);if(void 0===i)return v;if("object"!==w)return v=v.concat([new ft("terrain",i,`object expected, ${w} found`)]),v;for(const T in i){const S=T.match(/^(.*)-transition$/);v=v.concat(S&&g[S[1]]&&g[S[1]].transition?lo({key:T,value:i[T],valueSpec:p.transition,style:c,styleSpec:p}):g[T]?lo({key:T,value:i[T],valueSpec:g[T],style:c,styleSpec:p}):[new ft(T,i[T],`unknown property "${T}"`)])}if(i.source){const T=c.sources&&c.sources[i.source],S=T&&Ki(T.type);T?"raster-dem"!==S&&v.push(new ft(s,i.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):v.push(new ft(s,i.source,`source "${i.source}" not found`))}else v.push(new ft(s,i,'terrain is missing required property "source"'));return v}function No(o){const i=o.value,s=o.style,c=o.styleSpec,p=c.fog;let g=[];const v=Nn(i);if(void 0===i)return g;if("object"!==v)return g=g.concat([new ft("fog",i,`object expected, ${v} found`)]),g;for(const w in i){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&p[T[1]]&&p[T[1]].transition?lo({key:w,value:i[w],valueSpec:c.transition,style:s,styleSpec:c}):p[w]?lo({key:w,value:i[w],valueSpec:p[w],style:s,styleSpec:c}):[new ft(w,i[w],`unknown property "${w}"`)])}return g}const To={"*":()=>[],array:x,boolean:function(o){const i=o.value,s=o.key,c=Nn(i);return"boolean"!==c?[new ft(s,i,`boolean expected, ${c} found`)]:[]},number:M,color:function(o){const i=o.key,s=o.value,c=Nn(s);return"string"!==c?[new ft(i,s,`color expected, ${c} found`)]:null===An(s)?[new ft(i,s,`color expected, "${s}" found`)]:[]},enum:xe,filter:Qs,function:k,layer:jl,object:h,source:dl,light:zr,terrain:zh,fog:No,string:Jr,formatted:function(o){return 0===Jr(o).length?[]:U(o)},resolvedImage:function(o){return 0===Jr(o).length?[]:U(o)},projection:function(o){const i=o.value,s=o.styleSpec,c=s.projection,p=o.style;let g=[];const v=Nn(i);if("object"===v)for(const w in i)g=g.concat(lo({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:s}));else"string"!==v&&(g=g.concat([new ft("projection",i,`object or string expected, ${v} found`)]));return g}};function lo(o){const i=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Vl(Ki(i))?k(o):s.expression&&ka(On(i))?U(o):s.type&&To[s.type]?To[s.type](o):h(rs({},o,{valueSpec:s.type?c[s.type]:s}))}function xc(o){const i=o.value,s=o.key,c=Jr(o);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new ft(s,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new ft(s,i,'"glyphs" url must include a "{range}" token'))),c}function Bu(o,i=tt){return Cs(lo({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:xc,"*":()=>[]}}))}const ea=o=>Cs(Fh(o)),Gd=o=>Cs(ur(o));function Cs(o){return o.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function cp(o,i){let s=!1;if(i&&i.length)for(const c of i)o.fire(new _o(new Error(c.message))),s=!0;return s}var Iy=Na,ta=3;function Na(o,i,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var p=new Int32Array(this.arrayBuffer);o=p[0],this.d=(i=p[1])+2*(s=p[2]);for(var g=0;g<this.d*this.d;g++){var v=p[ta+g],w=p[ta+g+1];c.push(v===w?null:p.subarray(v,w))}var T=p[ta+c.length+1];this.keys=p.subarray(p[ta+c.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=i+2*s;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=s,this.scale=i/o,this.uid=0;var P=s/i*o;this.min=-P,this.max=o+P}Na.prototype.insert=function(o,i,s,c,p){this._forEachCell(i,s,c,p,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)},Na.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Na.prototype._insertCell=function(o,i,s,c,p,g){this.cells[p].push(g)},Na.prototype.query=function(o,i,s,c,p){var g=this.min,v=this.max;if(o<=g&&i<=g&&v<=s&&v<=c&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(o,i,s,c,this._queryCell,w,{},p),w},Na.prototype._queryCell=function(o,i,s,c,p,g,v,w){var T=this.cells[p];if(null!==T)for(var S=this.keys,P=this.bboxes,N=0;N<T.length;N++){var F=T[N];if(void 0===v[F]){var V=4*F;(w?w(P[V+0],P[V+1],P[V+2],P[V+3]):o<=P[V+2]&&i<=P[V+3]&&s>=P[V+0]&&c>=P[V+1])?(v[F]=!0,g.push(S[F])):v[F]=!1}}},Na.prototype._forEachCell=function(o,i,s,c,p,g,v,w){for(var T=this._convertToCellCoord(o),S=this._convertToCellCoord(i),P=this._convertToCellCoord(s),N=this._convertToCellCoord(c),F=T;F<=P;F++)for(var V=S;V<=N;V++){var j=this.d*V+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&p.call(this,o,i,s,c,j,g,v,w))return}},Na.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Na.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Na.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=ta+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var p=new Int32Array(i+s+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=i,v=0;v<o.length;v++){var w=o[v];p[ta+v]=g,p.set(w,g),g+=w.length}return p[ta+o.length]=g,p.set(this.keys,g),p[ta+o.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};var eu=he(Iy);const qd={};function Qt(o,i,s={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writeable:!1}),qd[i]={klass:o,omit:s.omit||[]}}Qt(Object,"Object"),eu.serialize=function(o,i){const s=o.toArrayBuffer();return i&&i.push(s),{buffer:s}},eu.deserialize=function(o){return new eu(o.buffer)},Object.defineProperty(eu,"name",{value:"Grid"}),Qt(eu,"Grid"),Qt(cn,"Color"),Qt(Error,"Error"),Qt(ro,"AJAXError"),Qt(Ro,"ResolvedImage"),Qt(Zi,"StylePropertyFunction"),Qt(Kr,"StyleExpression",{omit:["_evaluator"]}),Qt(Ul,"ZoomDependentExpression"),Qt(hl,"ZoomConstantExpression"),Qt(Ho,"CompoundExpression",{omit:["_evaluate"]});for(const o in _c)qd[_c[o]._classRegistryKey]||Qt(_c[o],`Expression${o}`);function up(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function hp(o){return Q.ImageBitmap&&o instanceof Q.ImageBitmap}function Vu(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(up(o)||hp(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return i&&i.push(s.buffer),s}if(o instanceof Q.ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(Vu(c,i));return s}if("object"==typeof o){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=s.serialize?s.serialize(o,i):{};if(!s.serialize){for(const g in o)o.hasOwnProperty(g)&&(qd[c].omit.indexOf(g)>=0||(p[g]=Vu(o[g],i)));o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof o)}function tu(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||up(o)||hp(o)||ArrayBuffer.isView(o)||o instanceof Q.ImageData)return o;if(Array.isArray(o))return o.map(tu);if("object"==typeof o){const i=o.$name||"Object",{klass:s}=qd[i];if(!s)throw new Error(`can't deserialize unregistered class ${i}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const p of Object.keys(o))"$name"!==p&&(c[p]=tu(o[p]));return c}throw new Error("can't deserialize object of type "+typeof o)}const Ht={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function dp(o){for(const i of o)if(fp(i.charCodeAt(0)))return!0;return!1}function Ay(o){for(const i of o)if(!sg(i.charCodeAt(0)))return!1;return!0}function sg(o){return!(Ht.Arabic(o)||Ht["Arabic Supplement"](o)||Ht["Arabic Extended-A"](o)||Ht["Arabic Presentation Forms-A"](o)||Ht["Arabic Presentation Forms-B"](o))}function fp(o){return!(746!==o&&747!==o&&(o<4352||!(Ht["Bopomofo Extended"](o)||Ht.Bopomofo(o)||Ht["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Ht["CJK Compatibility Ideographs"](o)||Ht["CJK Compatibility"](o)||Ht["CJK Radicals Supplement"](o)||Ht["CJK Strokes"](o)||!(!Ht["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Ht["CJK Unified Ideographs Extension A"](o)||Ht["CJK Unified Ideographs"](o)||Ht["Enclosed CJK Letters and Months"](o)||Ht["Hangul Compatibility Jamo"](o)||Ht["Hangul Jamo Extended-A"](o)||Ht["Hangul Jamo Extended-B"](o)||Ht["Hangul Jamo"](o)||Ht["Hangul Syllables"](o)||Ht.Hiragana(o)||Ht["Ideographic Description Characters"](o)||Ht.Kanbun(o)||Ht["Kangxi Radicals"](o)||Ht["Katakana Phonetic Extensions"](o)||Ht.Katakana(o)&&12540!==o||!(!Ht["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Ht["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](o)||Ht["Unified Canadian Aboriginal Syllabics Extended"](o)||Ht["Vertical Forms"](o)||Ht["Yijing Hexagram Symbols"](o)||Ht["Yi Syllables"](o)||Ht["Yi Radicals"](o))))}function Zd(o){return!(fp(o)||(i=o,Ht["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Ht["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Ht["Letterlike Symbols"](i)||Ht["Number Forms"](i)||Ht["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Ht["Control Pictures"](i)&&9251!==i||Ht["Optical Character Recognition"](i)||Ht["Enclosed Alphanumerics"](i)||Ht["Geometric Shapes"](i)||Ht["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Ht["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Ht["CJK Symbols and Punctuation"](i)||Ht.Katakana(i)||Ht["Private Use Area"](i)||Ht["CJK Compatibility Forms"](i)||Ht["Small Form Variants"](i)||Ht["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Wd(o){return o>=1424&&o<=2303||Ht["Arabic Presentation Forms-A"](o)||Ht["Arabic Presentation Forms-B"](o)}function Py(o,i){return!(!i&&Wd(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Ht.Khmer(o))}function Ry(o){for(const i of o)if(Wd(i.charCodeAt(0)))return!0;return!1}const pp="deferred",pl="loading",Fa="loaded";let Uu=null,m="unavailable",a=null;const d=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(m="error"),Uu&&Uu(o)};function _(){b.fire(new Ca("pluginStateChange",{pluginStatus:m,pluginURL:a}))}const b=new Bs,E=function(){return m},I=function(){if(m!==pp||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=pl,_(),a&&Qa({url:a},o=>{o?d(o):(m=Fa,_())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===Fa||null!=A.applyArabicShaping,isLoading:()=>m===pl,setState(o){m=o.pluginStatus,a=o.pluginURL},isParsed:()=>null!=A.applyArabicShaping&&null!=A.processBidirectionalText&&null!=A.processStyledBidirectionalText,getPluginURL:()=>a};class R{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(s,c){for(const p of s)if(!Py(p.charCodeAt(0),c))return!1;return!0}(i,A.isLoaded())}}class B{constructor(i,s){this.property=i,this.value=s,this.expression=function(c,p){if(Vl(c))return new Zi(c,p);if(ka(c)){const g=yc(c,p);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=c;return"string"==typeof c&&"color"===p.type&&(g=cn.parse(c)),{kind:"constant",evaluate:()=>g}}}(void 0===s?i.specification.default:s,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,s,c){return this.property.possiblyEvaluate(this,i,s,c)}}class z{constructor(i){this.property=i,this.value=new B(i,void 0)}transitioned(i,s){return new K(this.property,this.value,s,ii({},i.transition,this.transition),i.now)}untransitioned(){return new K(this.property,this.value,null,{},0)}}class H{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Ln(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new z(this._values[i].property)),this._values[i].value=new B(this._values[i].property,null===s?void 0:Ln(s))}getTransition(i){return Ln(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new z(this._values[i].property)),this._values[i].transition=Ln(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c);const p=this.getTransition(s);void 0!==p&&(i[`${s}-transition`]=p)}return i}transitioned(i,s){const c=new te(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(i,s._values[p]);return c}untransitioned(){const i=new te(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class K{constructor(i,s,c,p,g){const v=p.delay||0,w=p.duration||0;g=g||0,this.property=i,this.value=s,this.begin=g+v,this.end=this.begin+w,i.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(i,s,c){const p=i.now||0,g=this.value.possiblyEvaluate(i,s,c),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(i,s,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(i,s,c),g,$i(w))}}return g}}class te{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,c){const p=new re(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,s,c);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ie{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Ln(this._values[i].value)}setValue(i,s){this._values[i]=new B(this._values[i].property,null===s?void 0:Ln(s))}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c)}return i}possiblyEvaluate(i,s,c){const p=new re(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,s,c);return p}}class ne{constructor(i,s,c){this.property=i,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,s,c,p){return this.property.evaluate(this.value,this.parameters,i,s,c,p)}}class re{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class G{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,c){const p=fc[this.specification.type];return p?p(i,s,c):i}}class ee{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,c,p){return new ne(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(s,null,{},c,p)}:i.expression,s)}interpolate(i,s,c){if("constant"!==i.value.kind||"constant"!==s.value.kind)return i;if(void 0===i.value.value||void 0===s.value.value)return new ne(this,{kind:"constant",value:void 0},i.parameters);const p=fc[this.specification.type];return p?new ne(this,{kind:"constant",value:p(i.value.value,s.value.value,c)},i.parameters):i}evaluate(i,s,c,p,g,v){return"constant"===i.kind?i.value:i.evaluate(s,c,p,g,v)}}class le{constructor(i){this.specification=i}possiblyEvaluate(i,s,c,p){return!!i.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class ce{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new R(0,{});for(const c in i){const p=i[c];p.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new B(p,void 0),v=this.defaultTransitionablePropertyValues[c]=new z(p);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(s)}}}function be(o,i){return 256*(o=Tn(Math.floor(o),0,255))+Tn(Math.floor(i),0,255)}Qt(ee,"DataDrivenProperty"),Qt(G,"DataConstantProperty"),Qt(le,"ColorRampProperty");const Ee={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class we{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ne{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pe(o,i=1){let s=0,c=0;return{members:o.map(p=>{const g=Ee[p.type].BYTES_PER_ELEMENT,v=s=Ze(s,Math.max(i,g)),w=p.components||1;return c=Math.max(c,g),s+=g*w,{name:p.name,type:p.type,components:w,offset:v}}),size:Ze(s,Math.max(c,i)),alignment:i}}function Ze(o,i){return Math.ceil(o/i)*i}class Et extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.int16[p+0]=s,this.int16[p+1]=c,i}}Et.prototype.bytesPerElement=4,Qt(Et,"StructArrayLayout2i4");class Ue extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=p,i}}Ue.prototype.bytesPerElement=6,Qt(Ue,"StructArrayLayout3i6");class ut extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=p,this.int16[v+3]=g,i}}ut.prototype.bytesPerElement=8,Qt(ut,"StructArrayLayout4i8");class Ke extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,c,p,g,v,w)}emplace(i,s,c,p,g,v,w,T){const S=6*i,P=12*i,N=3*i;return this.int16[S+0]=s,this.int16[S+1]=c,this.uint8[P+4]=p,this.uint8[P+5]=g,this.uint8[P+6]=v,this.uint8[P+7]=w,this.float32[N+2]=T,i}}Ke.prototype.bytesPerElement=12,Qt(Ke,"StructArrayLayout2i4ub1f12");class xt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,this.float32[v+3]=g,i}}xt.prototype.bytesPerElement=16,Qt(xt,"StructArrayLayout4f16");class qe extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=6*i,T=3*i;return this.uint16[w+0]=s,this.uint16[w+1]=c,this.uint16[w+2]=p,this.uint16[w+3]=g,this.float32[T+2]=v,i}}qe.prototype.bytesPerElement=12,Qt(qe,"StructArrayLayout4ui1f12");class lt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=p,this.uint16[v+3]=g,i}}lt.prototype.bytesPerElement=8,Qt(lt,"StructArrayLayout4ui8");class Dt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,p,g,v)}emplace(i,s,c,p,g,v,w){const T=6*i;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=g,this.int16[T+4]=v,this.int16[T+5]=w,i}}Dt.prototype.bytesPerElement=12,Qt(Dt,"StructArrayLayout6i12");class pt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F){const V=this.length;return this.resize(V+1),this.emplace(V,i,s,c,p,g,v,w,T,S,P,N,F)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V){const j=12*i;return this.int16[j+0]=s,this.int16[j+1]=c,this.int16[j+2]=p,this.int16[j+3]=g,this.uint16[j+4]=v,this.uint16[j+5]=w,this.uint16[j+6]=T,this.uint16[j+7]=S,this.int16[j+8]=P,this.int16[j+9]=N,this.int16[j+10]=F,this.int16[j+11]=V,i}}pt.prototype.bytesPerElement=24,Qt(pt,"StructArrayLayout4i4ui4i24");class It extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,p,g,v)}emplace(i,s,c,p,g,v,w){const T=10*i,S=5*i;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.float32[S+2]=g,this.float32[S+3]=v,this.float32[S+4]=w,i}}It.prototype.bytesPerElement=20,Qt(It,"StructArrayLayout3i3f20");class un extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}un.prototype.bytesPerElement=4,Qt(un,"StructArrayLayout1ul4");class Rn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V){const j=this.length;return this.resize(j+1),this.emplace(j,i,s,c,p,g,v,w,T,S,P,N,F,V)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=20*i,J=10*i;return this.int16[q+0]=s,this.int16[q+1]=c,this.int16[q+2]=p,this.int16[q+3]=g,this.int16[q+4]=v,this.float32[J+3]=w,this.float32[J+4]=T,this.float32[J+5]=S,this.float32[J+6]=P,this.int16[q+14]=N,this.uint32[J+8]=F,this.uint16[q+18]=V,this.uint16[q+19]=j,i}}Rn.prototype.bytesPerElement=40,Qt(Rn,"StructArrayLayout5i4f1i1ul2ui40");class en extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,c,p,g,v,w)}emplace(i,s,c,p,g,v,w,T){const S=8*i;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+4]=g,this.int16[S+5]=v,this.int16[S+6]=w,this.int16[S+7]=T,i}}en.prototype.bytesPerElement=16,Qt(en,"StructArrayLayout3i2i2i16");class bn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=4*i,T=8*i;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[T+6]=g,this.int16[T+7]=v,i}}bn.prototype.bytesPerElement=16,Qt(bn,"StructArrayLayout2f1f2i16");class Jn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=12*i,w=3*i;return this.uint8[v+0]=s,this.uint8[v+1]=c,this.float32[w+1]=p,this.float32[w+2]=g,i}}Jn.prototype.bytesPerElement=12,Qt(Jn,"StructArrayLayout2ub2f12");class Kn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=p,i}}Kn.prototype.bytesPerElement=12,Qt(Kn,"StructArrayLayout3f12");class Kt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=p,i}}Kt.prototype.bytesPerElement=6,Qt(Kt,"StructArrayLayout3ui6");class bi extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge){const me=this.length;return this.resize(me+1),this.emplace(me,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me){const Ge=30*i,je=15*i,ot=60*i;return this.int16[Ge+0]=s,this.int16[Ge+1]=c,this.int16[Ge+2]=p,this.float32[je+2]=g,this.float32[je+3]=v,this.uint16[Ge+8]=w,this.uint16[Ge+9]=T,this.uint32[je+5]=S,this.uint32[je+6]=P,this.uint32[je+7]=N,this.uint16[Ge+16]=F,this.uint16[Ge+17]=V,this.uint16[Ge+18]=j,this.float32[je+10]=q,this.float32[je+11]=J,this.uint8[ot+48]=se,this.uint8[ot+49]=pe,this.uint8[ot+50]=ae,this.uint32[je+13]=de,this.int16[Ge+28]=ge,this.uint8[ot+58]=me,i}}bi.prototype.bytesPerElement=60,Qt(bi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ri extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me,Ge,je,ot,wt,Xe,ht,ct,_t){const At=this.length;return this.resize(At+1),this.emplace(At,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me,Ge,je,ot,wt,Xe,ht,ct,_t)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,pe,ae,de,ge,me,Ge,je,ot,wt,Xe,ht,ct,_t,At){const nt=38*i,jt=19*i;return this.int16[nt+0]=s,this.int16[nt+1]=c,this.int16[nt+2]=p,this.float32[jt+2]=g,this.float32[jt+3]=v,this.int16[nt+8]=w,this.int16[nt+9]=T,this.int16[nt+10]=S,this.int16[nt+11]=P,this.int16[nt+12]=N,this.int16[nt+13]=F,this.uint16[nt+14]=V,this.uint16[nt+15]=j,this.uint16[nt+16]=q,this.uint16[nt+17]=J,this.uint16[nt+18]=se,this.uint16[nt+19]=pe,this.uint16[nt+20]=ae,this.uint16[nt+21]=de,this.uint16[nt+22]=ge,this.uint16[nt+23]=me,this.uint16[nt+24]=Ge,this.uint16[nt+25]=je,this.uint16[nt+26]=ot,this.uint16[nt+27]=wt,this.uint16[nt+28]=Xe,this.uint32[jt+15]=ht,this.float32[jt+16]=ct,this.float32[jt+17]=_t,this.float32[jt+18]=At,i}}Ri.prototype.bytesPerElement=76,Qt(Ri,"StructArrayLayout3i2f6i15ui1ul3f76");class Li extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}Li.prototype.bytesPerElement=4,Qt(Li,"StructArrayLayout1f4");class Ci extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=5*i;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.float32[w+3]=g,this.float32[w+4]=v,i}}Ci.prototype.bytesPerElement=20,Qt(Ci,"StructArrayLayout5f20");class yo extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=6*i;return this.uint32[3*i+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=p,this.uint16[v+4]=g,i}}yo.prototype.bytesPerElement=12,Qt(yo,"StructArrayLayout1ul3ui12");class co extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.uint16[p+0]=s,this.uint16[p+1]=c,i}}co.prototype.bytesPerElement=4,Qt(co,"StructArrayLayout2ui4");class Yo extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}Yo.prototype.bytesPerElement=2,Qt(Yo,"StructArrayLayout1ui2");class za extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.float32[p+0]=s,this.float32[p+1]=c,i}}za.prototype.bytesPerElement=8,Qt(za,"StructArrayLayout2f8");class pi extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pi.prototype.size=40;class Ti extends Rn{get(i){return new pi(this,i)}}Qt(Ti,"CollisionBoxArray");class di extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}di.prototype.size=60;class Xn extends bi{get(i){return new di(this,i)}}Qt(Xn,"PlacedSymbolArray");class vo extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vo.prototype.size=76;class ki extends Ri{get(i){return new vo(this,i)}}Qt(ki,"SymbolInstanceArray");class Ji extends Li{getoffsetX(i){return this.float32[1*i+0]}}Qt(Ji,"GlyphOffsetArray");class Bh extends Et{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Qt(Bh,"SymbolLineVertexArray");class $l extends we{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}$l.prototype.size=12;class Ba extends yo{get(i){return new $l(this,i)}}Qt(Ba,"FeatureIndexArray");class Br extends co{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Qt(Br,"FillExtrusionCentroidArray");const Hl=Pe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),bc=Pe([{name:"a_dash",components:4,type:"Uint16"}]);var Vh={exports:{}},ag=function(o,i){var s,c,p,g,v,w,T,S;for(c=o.length-(s=3&o.length),p=i,v=3432918353,w=461845907,S=0;S<c;)T=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,p=27492+(65535&(g=5*(65535&(p=(p^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&o.charCodeAt(S+2))<<16;case 2:T^=(255&o.charCodeAt(S+1))<<8;case 1:p^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(S)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return p^=o.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},ky=function(o,i){for(var s,c=o.length,p=i^c,g=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:p^=(255&o.charCodeAt(g+2))<<16;case 2:p^=(255&o.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&o.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};Vh.exports=ag,Vh.exports.murmur3=ag,Vh.exports.murmur2=ky;var mp=he(Vh.exports);class gp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,s,c,p){this.ids.push(Zn(i)),this.positions.push(s,c,p)}getPositions(i){const s=Zn(i);let c=0,p=this.ids.length-1;for(;c<p;){const v=c+p>>1;this.ids[v]>=s?p=v:c=v+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(i,s){const c=new Float64Array(i.ids),p=new Uint32Array(i.positions);return _p(c,p,0,c.length-1),s&&s.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(i){const s=new gp;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s}}function Zn(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:mp(String(o))}function _p(o,i,s,c){for(;s<c;){const p=o[s+c>>1];let g=s-1,v=c+1;for(;;){do{g++}while(o[g]<p);do{v--}while(o[v]>p);if(g>=v)break;lg(o,g,v),lg(i,3*g,3*v),lg(i,3*g+1,3*v+1),lg(i,3*g+2,3*v+2)}v-s<c-v?(_p(o,i,s,v),s=v+1):(_p(o,i,v+1,c),c=v)}}function lg(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}Qt(gp,"FeaturePositionMap");class wc{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}}class yp extends wc{constructor(i){super(i),this.current=0}set(i,s,c){this.fetchUniformLocation(i,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Oy extends wc{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class cg extends wc{constructor(i){super(i),this.current=cn.transparent}set(i,s,c){this.fetchUniformLocation(i,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const jh=new Float32Array(16),Fx=new Float32Array(9),zx=new Float32Array(4);function ug(o){return[be(255*o.r,255*o.g),be(255*o.b,255*o.a)]}class Xd{constructor(i,s,c){this.value=i,this.uniformNames=s.map(p=>`u_${p}`),this.type=c}setUniform(i,s,c,p,g){s.set(i,g,p.constantOr(this.value))}getBinding(i,s){return"color"===this.type?new cg(i):new yp(i)}}class $h{constructor(i,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,s,c,p,g){const v="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;v&&s.set(i,g,v)}getBinding(i,s){return"u_pattern"===s||"u_dash"===s?new Oy(i):new yp(i)}}class vt{constructor(i,s,c,p){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,s,c,p,g,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new R(0),s,{},g,p,v);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,s,c,p,g){const v=this.expression.evaluate({zoom:0},c,p,void 0,g);this._setPaintValue(i,s,v)}_setPaintValue(i,s,c){if("color"===this.type){const p=ug(c);for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=i;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qn{constructor(i,s,c,p,g,v){this.expression=i,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,s,c,p,g,v){const w=this.expression.evaluate(new R(this.zoom),s,{},g,p,v),T=this.expression.evaluate(new R(this.zoom+1),s,{},g,p,v),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,w,T)}updatePaintArray(i,s,c,p,g){const v=this.expression.evaluate({zoom:this.zoom},c,p,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,g);this._setPaintValue(i,s,v,w)}_setPaintValue(i,s,c,p){if("color"===this.type){const g=ug(c),v=ug(p);for(let w=i;w<s;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,c,p,g){const v=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,w=Tn(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);s.set(i,g,w)}getBinding(i,s){return new yp(i)}}class Qi{constructor(i,s,c,p,g){this.expression=i,this.layerId=g,this.paintVertexAttributes=("array"===c?bc:Hl).members;for(let v=0;v<s.length;++v);this.paintVertexArray=new p}populatePaintArray(i,s,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(p,i,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(i,s,c,p,g,v){this._setPaintValues(i,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(i,s,c,p){if(!p||!c)return;const g=p[c];if(!g)return;const{tl:v,br:w,pixelRatio:T}=g;for(let S=i;S<s;S++)this.paintVertexArray.emplace(S,v[0],v[1],w[0],w[1],T)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class er{constructor(i,s,c=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const g in i.paint._values){if(!c(g))continue;const v=i.paint.get(g);if(!(v instanceof ne&&ll(v.property.specification)))continue;const w=Yd(g,i.type),T=v.value,S=v.property.specification.type,P=!!v.property.useIntegerZoom,N="line-dasharray"===g||g.endsWith("pattern"),F="line-dasharray"===g&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==T.kind||F)if("source"===T.kind||F||N){const V=vp(g,S,"source");this.binders[g]=N?new Qi(T,w,S,V,i.id):new vt(T,w,S,V),p.push(`/a_${g}`)}else{const V=vp(g,S,"composite");this.binders[g]=new Qn(T,w,S,P,s,V),p.push(`/z_${g}`)}else this.binders[g]=N?new $h(T.value,w):new Xd(T.value,w,S),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof vt||s instanceof Qn?s.maxValue:0}populatePaintArrays(i,s,c,p,g,v){for(const w in this.binders){const T=this.binders[w];(T instanceof vt||T instanceof Qn||T instanceof Qi)&&T.populatePaintArray(i,s,c,p,g,v)}}setConstantPatternPositions(i){for(const s in this.binders){const c=this.binders[s];c instanceof $h&&c.setConstantPatternPositions(i)}}updatePaintArrays(i,s,c,p,g,v){let w=!1;for(const T in i){const S=s.getPositions(T);for(const P of S){const N=c.feature(P.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof vt||V instanceof Qn||V instanceof Qi)&&!0===V.expression.isStateDependent){const j=p.paint.get(F);V.expression=j.value,V.updatePaintArray(P.start,P.end,N,i[T],g,v),w=!0}}}}return w}defines(){const i=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Xd||c instanceof $h)&&i.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof vt||c instanceof Qn||c instanceof Qi)for(let p=0;p<c.paintVertexAttributes.length;p++)i.push(c.paintVertexAttributes[p].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Xd||c instanceof $h||c instanceof Qn)for(const p of c.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Xd||p instanceof $h||p instanceof Qn)for(const g of p.uniformNames)s.push({name:g,property:c,binding:p.getBinding(i,g)})}return s}setUniforms(i,s,c,p,g){for(const{name:v,property:w,binding:T}of c)this.binders[w].setUniform(i,T,g,p.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof vt||s instanceof Qn||s instanceof Qi)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(i){for(const s in this.binders){const c=this.binders[s];(c instanceof vt||c instanceof Qn||c instanceof Qi)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof vt||s instanceof Qn||s instanceof Qi)&&s.destroy()}}}class Vr{constructor(i,s,c=(()=>!0)){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new er(p,s,c);this.needsUpload=!1,this._featureMap=new gp,this._bufferOffset=0}populatePaintArrays(i,s,c,p,g,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,s,p,g,v,w);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,c,p,g){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,s,v,p,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Ny={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Yd(o,i){return Ny[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const Gl={"line-pattern":{source:qe,composite:qe},"fill-pattern":{source:qe,composite:qe},"fill-extrusion-pattern":{source:qe,composite:qe},"line-dasharray":{source:lt,composite:lt}},hg={color:{source:za,composite:xt},number:{source:Li,composite:za}};function vp(o,i,s){const c=Gl[o];return c&&c[s]||hg[i][s]}Qt(Xd,"ConstantBinder"),Qt($h,"PatternConstantBinder"),Qt(vt,"SourceExpressionBinder"),Qt(Qi,"PatternCompositeBinder"),Qt(Qn,"CompositeExpressionBinder"),Qt(er,"ProgramConfiguration",{omit:["_buffers"]}),Qt(Vr,"ProgramConfigurationSet");const Fy="-transition";class ql extends Bs{constructor(i,s){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),s.layout&&(this._unevaluatedLayout=new ie(s.layout)),s.paint)){this._transitionablePaint=new H(s.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new re(s.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s,c={}){null!=s&&this._validate(Gd,`layers.${this.id}.layout.${i}`,i,s,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,s):this.visibility=s)}getPaintProperty(i){return hi(i,Fy)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s,c={}){if(null!=s&&this._validate(ea,`layers.${this.id}.paint.${i}`,i,s,c))return!1;if(hi(i,Fy))return this._transitionablePaint.setTransition(i.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[i],g=p.value.isDataDriven(),v=p.value;this._transitionablePaint.setValue(i,s),this._handleSpecialPaintPropertyUpdate(i);const w=this._transitionablePaint._values[i].value,T=w.isDataDriven(),S=hi(i,"pattern")||"line-dasharray"===i;return T||g||S||this._handleOverridablePaintPropertyUpdate(i,v,w)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,s,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),ns(i,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(i,s,c,p,g={}){return(!g||!1!==g.validate)&&cp(this,i.call(Bu,{key:s,layerType:this.type,objectKey:c,value:p,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof ne&&ll(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Oe(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const zy=Pe([{name:"a_pos",components:2,type:"Int16"}],4),hs=Pe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Bi{constructor(i=[]){this.segments=i}prepareSegment(i,s,c,p){let g=this.segments[this.segments.length-1];return i>Bi.MAX_VERTEX_ARRAY_LENGTH&&Yi(`Max vertices per segment is ${Bi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>Bi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==p&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,c,p){return new Bi([{vertexOffset:i,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}Bi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt(Bi,"SegmentVector");var gn=8192;class na{constructor(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof mi?new mi(i.lng,i.lat):mi.convert(i),this}setSouthWest(i){return this._sw=i instanceof mi?new mi(i.lng,i.lat):mi.convert(i),this}extend(i){const s=this._sw,c=this._ne;let p,g;if(i instanceof mi)p=i,g=i;else{if(!(i instanceof na))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(na.convert(i)):this.extend(mi.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(mi.convert(i)):this;if(p=i._sw,g=i._ne,!p||!g)return this}return s||c?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new mi(p.lng,p.lat),this._ne=new mi(g.lng,g.lat)),this}getCenter(){return new mi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mi(this.getWest(),this.getNorth())}getSouthEast(){return new mi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:c}=mi.convert(i);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(i){return!i||i instanceof na?i:new na(i)}}var Va=1e-6,Ds=typeof Float32Array<"u"?Float32Array:Array;function dg(){var o=new Ds(9);return Ds!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function By(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=s[0],V=s[1],j=s[2],q=s[3],J=s[4],se=s[5],pe=s[6],ae=s[7],de=s[8];return o[0]=F*c+V*v+j*S,o[1]=F*p+V*w+j*P,o[2]=F*g+V*T+j*N,o[3]=q*c+J*v+se*S,o[4]=q*p+J*w+se*P,o[5]=q*g+J*T+se*N,o[6]=pe*c+ae*v+de*S,o[7]=pe*p+ae*w+de*P,o[8]=pe*g+ae*T+de*N,o}function ml(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Kd(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=i[4],w=i[5],T=i[6],S=i[7],P=i[8],N=i[9],F=i[10],V=i[11],j=i[12],q=i[13],J=i[14],se=i[15],pe=s*w-c*v,ae=s*T-p*v,de=s*S-g*v,ge=c*T-p*w,me=c*S-g*w,Ge=p*S-g*T,je=P*q-N*j,ot=P*J-F*j,wt=P*se-V*j,Xe=N*J-F*q,ht=N*se-V*q,ct=F*se-V*J,_t=pe*ct-ae*ht+de*Xe+ge*wt-me*ot+Ge*je;return _t?(o[0]=(w*ct-T*ht+S*Xe)*(_t=1/_t),o[1]=(p*ht-c*ct-g*Xe)*_t,o[2]=(q*Ge-J*me+se*ge)*_t,o[3]=(F*me-N*Ge-V*ge)*_t,o[4]=(T*wt-v*ct-S*ot)*_t,o[5]=(s*ct-p*wt+g*ot)*_t,o[6]=(J*de-j*Ge-se*ae)*_t,o[7]=(P*Ge-F*de+V*ae)*_t,o[8]=(v*ht-w*wt+S*je)*_t,o[9]=(c*wt-s*ht-g*je)*_t,o[10]=(j*me-q*de+se*pe)*_t,o[11]=(N*de-P*me-V*pe)*_t,o[12]=(w*ot-v*Xe-T*je)*_t,o[13]=(s*Xe-c*ot+p*je)*_t,o[14]=(q*ae-j*ge-J*pe)*_t,o[15]=(P*ge-N*ae+F*pe)*_t,o):null}function Ec(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=i[9],V=i[10],j=i[11],q=i[12],J=i[13],se=i[14],pe=i[15],ae=s[0],de=s[1],ge=s[2],me=s[3];return o[0]=ae*c+de*w+ge*N+me*q,o[1]=ae*p+de*T+ge*F+me*J,o[2]=ae*g+de*S+ge*V+me*se,o[3]=ae*v+de*P+ge*j+me*pe,o[4]=(ae=s[4])*c+(de=s[5])*w+(ge=s[6])*N+(me=s[7])*q,o[5]=ae*p+de*T+ge*F+me*J,o[6]=ae*g+de*S+ge*V+me*se,o[7]=ae*v+de*P+ge*j+me*pe,o[8]=(ae=s[8])*c+(de=s[9])*w+(ge=s[10])*N+(me=s[11])*q,o[9]=ae*p+de*T+ge*F+me*J,o[10]=ae*g+de*S+ge*V+me*se,o[11]=ae*v+de*P+ge*j+me*pe,o[12]=(ae=s[12])*c+(de=s[13])*w+(ge=s[14])*N+(me=s[15])*q,o[13]=ae*p+de*T+ge*F+me*J,o[14]=ae*g+de*S+ge*V+me*se,o[15]=ae*v+de*P+ge*j+me*pe,o}function Hh(o,i,s){var c,p,g,v,w,T,S,P,N,F,V,j,q=s[0],J=s[1],se=s[2];return i===o?(o[12]=i[0]*q+i[4]*J+i[8]*se+i[12],o[13]=i[1]*q+i[5]*J+i[9]*se+i[13],o[14]=i[2]*q+i[6]*J+i[10]*se+i[14],o[15]=i[3]*q+i[7]*J+i[11]*se+i[15]):(p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=i[9],V=i[10],j=i[11],o[0]=c=i[0],o[1]=p,o[2]=g,o[3]=v,o[4]=w,o[5]=T,o[6]=S,o[7]=P,o[8]=N,o[9]=F,o[10]=V,o[11]=j,o[12]=c*q+w*J+N*se+i[12],o[13]=p*q+T*J+F*se+i[13],o[14]=g*q+S*J+V*se+i[14],o[15]=v*q+P*J+j*se+i[15]),o}function Cc(o,i,s){var c=s[0],p=s[1],g=s[2];return o[0]=i[0]*c,o[1]=i[1]*c,o[2]=i[2]*c,o[3]=i[3]*c,o[4]=i[4]*p,o[5]=i[5]*p,o[6]=i[6]*p,o[7]=i[7]*p,o[8]=i[8]*g,o[9]=i[9]*g,o[10]=i[10]*g,o[11]=i[11]*g,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o}function fg(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[4],v=i[5],w=i[6],T=i[7],S=i[8],P=i[9],N=i[10],F=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=g*p+S*c,o[5]=v*p+P*c,o[6]=w*p+N*c,o[7]=T*p+F*c,o[8]=S*p-g*c,o[9]=P*p-v*c,o[10]=N*p-w*c,o[11]=F*p-T*c,o}function Jd(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[0],v=i[1],w=i[2],T=i[3],S=i[8],P=i[9],N=i[10],F=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*p-S*c,o[1]=v*p-P*c,o[2]=w*p-N*c,o[3]=T*p-F*c,o[8]=g*c+S*p,o[9]=v*c+P*p,o[10]=w*c+N*p,o[11]=T*c+F*p,o}function xp(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function pg(o,i,s){var c,p,g,v=s[0],w=s[1],T=s[2],S=Math.hypot(v,w,T);return S<Va?null:(v*=S=1/S,w*=S,T*=S,c=Math.sin(i),p=Math.cos(i),o[0]=v*v*(g=1-p)+p,o[1]=w*v*g+T*c,o[2]=T*v*g-w*c,o[3]=0,o[4]=v*w*g-T*c,o[5]=w*w*g+p,o[6]=T*w*g+v*c,o[7]=0,o[8]=v*T*g+w*c,o[9]=w*T*g-v*c,o[10]=T*T*g+p,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Vy=Ec;function bp(){var o=new Ds(3);return Ds!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function mg(o){var i=new Ds(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i}function ju(o){return Math.hypot(o[0],o[1],o[2])}function Gh(o,i,s){var c=new Ds(3);return c[0]=o,c[1]=i,c[2]=s,c}function Tc(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o}function Fo(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o}function nu(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o[2]=i[2]*s[2],o}function mr(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o[2]=Math.min(i[2],s[2]),o}function Qd(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o[2]=Math.max(i[2],s[2]),o}function ia(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o}function ef(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o}function Ko(o,i){var s=i[0],c=i[1],p=i[2],g=s*s+c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o}function ra(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}function wp(o,i,s){var c=i[0],p=i[1],g=i[2],v=s[0],w=s[1],T=s[2];return o[0]=p*T-g*w,o[1]=g*v-c*T,o[2]=c*w-p*v,o}function gr(o,i,s){var c=i[0],p=i[1],g=i[2],v=s[3]*c+s[7]*p+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*p+s[8]*g+s[12])/(v=v||1),o[1]=(s[1]*c+s[5]*p+s[9]*g+s[13])/v,o[2]=(s[2]*c+s[6]*p+s[10]*g+s[14])/v,o}function Dc(o,i,s){var c=s[0],p=s[1],g=s[2],v=i[0],w=i[1],T=i[2],S=p*T-g*w,P=g*v-c*T,N=c*w-p*v,F=p*N-g*P,V=g*S-c*N,j=c*P-p*S,q=2*s[3];return P*=q,N*=q,V*=2,j*=2,o[0]=v+(S*=q)+(F*=2),o[1]=w+P+V,o[2]=T+N+j,o}var tf,Ms=Fo,Ep=nu,Cp=ju;function Tp(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o}function gg(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=s*s+c*c+p*p+g*g;return v>0&&(v=1/Math.sqrt(v)),o[0]=s*v,o[1]=c*v,o[2]=p*v,o[3]=g*v,o}function iu(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3];return o[0]=s[0]*c+s[4]*p+s[8]*g+s[12]*v,o[1]=s[1]*c+s[5]*p+s[9]*g+s[13]*v,o[2]=s[2]*c+s[6]*p+s[10]*g+s[14]*v,o[3]=s[3]*c+s[7]*p+s[11]*g+s[15]*v,o}function Uy(){var o=new Ds(4);return Ds!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function $u(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function qh(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T+v*w,o[1]=p*T+g*w,o[2]=g*T-p*w,o[3]=v*T-c*w,o}function jy(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T-g*w,o[1]=p*T+v*w,o[2]=g*T+c*w,o[3]=v*T-p*w,o}bp(),tf=new Ds(4),Ds!=Float32Array&&(tf[0]=0,tf[1]=0,tf[2]=0,tf[3]=0);var kE=gg;bp(),Gh(1,0,0),Gh(0,1,0),Uy(),Uy(),dg();const _g=Pe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Bx}=_g,$y=Pe([{name:"a_pos_3",components:3,type:"Int16"}]);var nf=Pe([{name:"a_pos",type:"Int16",components:2}]);class Hy{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,c){const p=ra(s,this.dir);if(Math.abs(p)<1e-6)return!1;const g=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/p;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,s,c){if(q=(V=this.pos)[0],J=V[1],se=V[2],pe=(j=i)[0],ae=j[1],de=j[2],Math.abs(q-pe)<=Va*Math.max(1,Math.abs(q),Math.abs(pe))&&Math.abs(J-ae)<=Va*Math.max(1,Math.abs(J),Math.abs(ae))&&Math.abs(se-de)<=Va*Math.max(1,Math.abs(se),Math.abs(de))||0===s)return c[0]=c[1]=c[2]=0,!1;var V,j,q,J,se,pe,ae,de;const[p,g,v]=this.dir,w=this.pos[0]-i[0],T=this.pos[1]-i[1],S=this.pos[2]-i[2],P=p*p+g*g+v*v,N=2*(w*p+T*g+S*v),F=N*N-4*P*(w*w+T*T+S*S-s*s);if(F<0){const V=Math.max(-N/2,0),j=w+p*V,q=T+g*V,J=S+v*V,se=Math.hypot(j,q,J);return c[0]=j*s/se,c[1]=q*s/se,c[2]=J*s/se,!1}{const V=(-N-Math.sqrt(F))/(2*P);if(V<0){const j=Math.hypot(w,T,S);return c[0]=w*s/j,c[1]=T*s/j,c[2]=S*s/j,!1}return c[0]=w+p*V,c[1]=T+g*V,c[2]=S+v*V,!0}}}class Gy{constructor(i,s,c,p,g){this.TL=i,this.TR=s,this.BR=c,this.BL=p,this.horizon=g}static fromInvProjectionMatrix(i,s,c){const p=[-1,1,1],g=[1,1,1],v=[1,-1,1],w=[-1,-1,1],T=gr(p,p,i),S=gr(g,g,i),P=gr(v,v,i),N=gr(w,w,i);return new Gy(T,S,P,N,s/c)}}class rf{constructor(i,s){this.points=i,this.planes=s}static fromInvProjectionMatrix(i,s,c,p){const g=Math.pow(2,c),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const S=iu([],T,i),P=1/S[3]/s*g;return(N=S)[0]=(F=S)[0]*(V=[P,P,p?1/S[3]:P,P])[0],N[1]=F[1]*V[1],N[2]=F[2]*V[2],N[3]=F[3]*V[3],N;var N,F,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const S=Ko([],wp([],Ms([],v[T[0]],v[T[1]]),Ms([],v[T[2]],v[T[1]]))),P=-ra(S,v[T[1]]);return S.concat(P)});return new rf(v,w)}}class uo{static fromPoints(i){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of i)mr(s,s,p),Qd(c,c,p);return new uo(s,c)}static applyTransform(i,s){const c=i.getCorners();for(let p=0;p<c.length;++p)gr(c[p],c[p],s);return uo.fromPoints(c)}constructor(i,s){this.min=i,this.max=s,this.center=ia([],Tc([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],c=mg(this.min),p=mg(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new uo(c,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){const s=this.getCorners();let c=!0;for(let p=0;p<i.planes.length;p++){const g=i.planes[p];let v=0;for(let w=0;w<s.length;w++)v+=ra(g,s[w])+g[3]>=0;if(0===v)return 0;v!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<i.points.length;w++){const T=i.points[w][p]-this.min[p];g=Math.min(g,T),v=Math.max(v,T)}if(v<0||g>this.max[p]-this.min[p])return 0}return 1}}const yg=5,Zh=6,Ua=gn/Math.PI/2,Dp=16383,Xh=[64,32,16],oa=-Ua,ja=Ua,Zl=[new uo([oa,oa,oa],[ja,ja,ja]),new uo([oa,oa,oa],[0,0,ja]),new uo([0,oa,oa],[ja,0,ja]),new uo([oa,0,oa],[0,ja,ja]),new uo([0,0,oa],[ja,ja,ja])];function Mp(o){return o*Ua/ru}function sf(o,i,s,c=!0){const p=ia([],o._camera.position,o.worldSize),g=[i,s,1,1];iu(g,g,o.pixelMatrixInverse),Tp(g,g,1/g[3]);const v=Ko([],Ms([],g,p)),w=o.globeMatrix,T=[w[12],w[13],w[14]],S=Ms([],T,p),P=ju(S),N=Ko([],S),F=o.worldSize/(2*Math.PI),V=ra(N,v),j=Math.asin(F/P);if(j<Math.acos(V)){if(!c)return null;const wt=[],Xe=[];ia(wt,v,P/V),Ko(Xe,Ms(Xe,wt,S)),Ko(v,Tc(v,S,ia(v,Xe,Math.tan(j)*P)))}const q=[];new Hy(p,v).closestPointOnSphere(T,F,q);const J=Ko([],_a(w,0)),se=Ko([],_a(w,1)),pe=Ko([],_a(w,2)),ae=ra(J,q),de=ra(se,q),ge=ra(pe,q),me=Cn(Math.asin(-de/F));let Ge=Cn(Math.atan2(ae,ge));Ge=o.center.lng+function(wt,Xe){const ht=(Xe-wt+180)%360-180;return ht<-180?ht+360:ht}(o.center.lng,Ge);const je=$a(Ge),ot=Tn(ds(me),0,1);return new lf(je,ot)}class vg{constructor(i,s,c){this.a=Ms([],i,c),this.b=Ms([],s,c),this.center=c;const p=Ko([],this.a),g=Ko([],this.b);this.angle=Math.acos(ra(p,g))}}function Sp(o,i){if(0===o.angle)return null;let s;return s=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,p,g,v){const w=Math.sin(g);return c*(Math.sin((1-v)*g)/w)+p*(Math.sin(v*g)/w)}(o.a[i],o.b[i],o.angle,Tn(s,0,1))+o.center[i]}function sa(o){if(o.z<=1)return Zl[o.z+2*o.y+o.x];const i=Ip(af(o));return uo.fromPoints(i)}function Mc(o,i,s){return ia(o,o,1-s),ef(o,o,i,s)}function qy(o,i){const s=ho(i.zoom);if(0===s)return sa(o);const c=af(o),p=Ip(c),g=$a(c.getWest())*i.worldSize,v=$a(c.getEast())*i.worldSize,w=ds(c.getNorth())*i.worldSize,T=ds(c.getSouth())*i.worldSize,S=[g,w,0],P=[v,w,0],N=[g,T,0],F=[v,T,0],V=Kd([],i.globeMatrix);return gr(S,S,V),gr(P,P,V),gr(N,N,V),gr(F,F,V),p[0]=Mc(p[0],N,s),p[1]=Mc(p[1],F,s),p[2]=Mc(p[2],P,s),p[3]=Mc(p[3],S,s),uo.fromPoints(p)}function xg(o,i,s){for(const c of o)gr(c,c,i),ia(c,c,s)}function af({x:o,y:i,z:s}){const c=1/(1<<s),p=new mi(la(o*c),zo((i+1)*c)),g=new mi(la((o+1)*c),zo(i*c));return new na(p,g)}function Ip(o){const i=Lt(o.getNorth()),s=Lt(o.getSouth()),c=Math.cos(i),p=Math.cos(s),g=Math.sin(i),v=Math.sin(s),w=o.getWest(),T=o.getEast();return[Yh(p,v,w),Yh(p,v,T),Yh(c,g,T),Yh(c,g,w)]}function Yh(o,i,s,c=Ua){return s=Lt(s),[o*Math.sin(s)*c,-i*c,o*Math.cos(s)*c]}function Sc(o,i,s){return Yh(Math.cos(Lt(o)),Math.sin(Lt(o)),i,s)}function gl(o,i,s,c){const p=1<<s.z,g=(o/gn+s.x)/p;return Sc(zo((i/gn+s.y)/p),la(g),c)}function Ap({min:o,max:i}){return Dp/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const bg=new Float64Array(16);function Kh(o){const i=Ap(o),s=xp(bg,[i,i,i]);return Hh(s,s,((c=[])[0]=-(p=o.min)[0],c[1]=-p[1],c[2]=-p[2],c));var c,p}function Hu(o){const i=(c=o.min,(s=bg)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;const p=1/Ap(o);return Cc(i,i,[p,p,p])}function Wy(o,i,s,c,p){const g=function(T){const S=gn/(2*Math.PI);return T/(2*Math.PI)/S}(s),v=[o,i,-s/(2*Math.PI)],w=ml(new Float64Array(16));return Hh(w,w,v),Cc(w,w,[g,g,g]),fg(w,w,Lt(-p)),Jd(w,w,Lt(-c)),w}function ho(o){return wn(yg,Zh,o)}function Xy(o,i){const s=Sc(i.lat,i.lng);return v=(p=Fo([],function(j){const q=Sc(j._center.lat,j._center.lng);let J=wp([],Gh(0,1,0),q);const se=pg([],-j.angle,q);J=gr(J,J,se),pg(se,-j._pitch,J);const pe=Ko([],q);return ia(pe,pe,Mp(j.cameraToCenterDistance/j.pixelsPerMeter)),gr(pe,pe,se),Tc([],q,pe)}(o),s))[0],w=p[1],T=p[2],S=(g=s)[0],P=g[1],N=g[2],V=(F=Math.sqrt(v*v+w*w+T*T)*Math.sqrt(S*S+P*P+N*N))&&ra(p,g)/F,Math.acos(Math.min(Math.max(V,-1),1));var p,g,v,w,T,S,P,N,F,V}function xo(o,i){return Xy(o,i)>Math.PI/2*1.01}const Pp=Lt(85),Vx=Math.cos(Pp),Yy=Math.sin(Pp),ru=6371008.8,Gu=2*Math.PI*ru;class aa{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new aa(ir(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,c=this.lat*s,p=i.lat*s,g=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((i.lng-this.lng)*s);return ru*Math.acos(Math.min(g,1))}toBounds(i=0){const s=360*i/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new na(new aa(this.lng-c,this.lat-s),new aa(this.lng+c,this.lat+s))}toEcef(i){const s=Mp(i);return Sc(this.lat,this.lng,Ua+s)}static convert(i){if(i instanceof aa)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new aa(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new aa(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var mi=aa;function Rp(o){return Gu*Math.cos(o*Math.PI/180)}function $a(o){return(180+o)/360}function ds(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Wl(o,i){return o/Rp(i)}function la(o){return 360*o-180}function zo(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Ux(o,i){return o*Rp(zo(i))}const Bo=85.051129;function jx(o){return 1/Math.cos(o*Math.PI/180)}class lf{constructor(i,s,c=0){this.x=+i,this.y=+s,this.z=+c}static fromLngLat(i,s=0){const c=mi.convert(i);return new lf($a(c.lng),ds(c.lat),Wl(s,c.lat))}toLngLat(){return new mi(la(this.x),zo(this.y))}toAltitude(){return Ux(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gu*jx(zo(this.y))}}function Ky(o,i,s,c,p,g,v,w,T){const S=(i+c)/2,P=(s+p)/2,N=new Fe(S,P);w(N),function(F,V,j,q,J,se){const pe=j-J,ae=q-se;return Math.abs((q-V)*pe-(j-F)*ae)/Math.hypot(pe,ae)}(N.x,N.y,g.x,g.y,v.x,v.y)>=T?(Ky(o,i,s,S,P,g,N,w,T),Ky(o,S,P,c,p,N,v,w,T)):o.push(v)}function qu(o,i,s){let c=o[0],p=c.x,g=c.y;i(c);const v=[c];for(let w=1;w<o.length;w++){const T=o[w],{x:S,y:P}=T;i(T),Ky(v,p,g,S,P,c,T,i,s),p=S,g=P,c=T}return v}function wg(o,i,s,c){if(c(i,s)){const p=i.add(s)._mult(.5);wg(o,i,p,c),wg(o,p,s,c)}else o.push(s)}function $x(o,i){let s=o[0];const c=[s];for(let p=1;p<o.length;p++){const g=o[p];wg(c,s,g,i),s=g}return c}const Qr=Math.pow(2,14)-1,Jy=-Qr-1;function cf(o,i){const s=Math.round(o.x*i),c=Math.round(o.y*i);return o.x=Tn(s,Jy,Qr),o.y=Tn(c,Jy,Qr),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&Yi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ic(o,i,s){const c=o.loadGeometry(),p=o.extent,g=gn/p;if(i&&s&&s.projection.isReprojectedInTileSpace){const v=1<<i.z,{scale:w,x:T,y:S,projection:P}=s,N=F=>{const V=la((i.x+F.x/p)/v),j=zo((i.y+F.y/p)/v),q=P.project(V,j);F.x=(q.x*w-T)*p,F.y=(q.y*w-S)*p};for(let F=0;F<c.length;F++)if(1!==o.type)c[F]=qu(c[F],N,1);else{const V=[];for(const j of c[F])j.x<0||j.x>=p||j.y<0||j.y>=p||(N(j),V.push(j));c[F]=V}}for(const v of c)for(const w of v)cf(w,g);return c}function Do(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Ic(o):[]}}function Ac(o,i,s,c,p){o.emplaceBack(2*i+(c+1)/2,2*s+(p+1)/2)}function uf(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Jh{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Et,this.indexArray=new Kt,this.segments=new Bi,this.programConfigurations=new Vr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,p){const g=this.layers[0],v=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:N,sourceLayerIndex:F}of i){const V=this.layers[0]._featureFilter.needGeometry,j=Do(S,V);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),j,c))continue;const q=w?w.evaluate(j,{},c):void 0,J={id:P,properties:S.properties,type:S.type,sourceLayerIndex:F,index:N,geometry:V?j.geometry:Ic(S,c,p),patterns:{},sortKey:q};v.push(J)}w&&v.sort((S,P)=>S.sortKey-P.sortKey);let T=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new Dt,T=p.projection);for(const S of v){const{geometry:P,index:N,sourceLayerIndex:F}=S,V=i[N].feature;this.addFeature(S,P,N,s.availableImages,c,T),s.featureIndex.insert(V,P,N,F,this.index)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zy.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,hs.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,s,c,p,g,v){for(const w of s)for(const T of w){const S=T.x,P=T.y;if(S<0||S>=gn||P<0||P>=gn)continue;if(v){const V=v.projectTilePoint(S,P,g),j=v.upVector(g,S,P),q=this.globeExtVertexArray;uf(q,V,j),uf(q,V,j),uf(q,V,j),uf(q,V,j)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),F=N.vertexLength;Ac(this.layoutVertexArray,S,P,-1,-1),Ac(this.layoutVertexArray,S,P,1,-1),Ac(this.layoutVertexArray,S,P,1,1),Ac(this.layoutVertexArray,S,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},p,g)}}function Qh(o,i){for(let s=0;s<o.length;s++)if(ou(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(ou(o,i[s]))return!0;return!!Qy(o,i)}function Hx(o,i,s){return!!ou(o,i)||!!hf(i,o,s)}function Gx(o,i){if(1===o.length)return Zx(i,o[0]);for(let s=0;s<i.length;s++){const c=i[s];for(let p=0;p<c.length;p++)if(ou(o,c[p]))return!0}for(let s=0;s<o.length;s++)if(Zx(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(Qy(o,i[s]))return!0;return!1}function qx(o,i,s){if(o.length>1){if(Qy(o,i))return!0;for(let c=0;c<i.length;c++)if(hf(i[c],o,s))return!0}for(let c=0;c<o.length;c++)if(hf(o[c],i,s))return!0;return!1}function Qy(o,i){if(0===o.length||0===i.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],p=o[s+1];for(let g=0;g<i.length-1;g++)if(ca(c,p,i[g],i[g+1]))return!0}return!1}function ca(o,i,s,c){return go(o,s,c)!==go(i,s,c)&&go(o,i,s)!==go(o,i,c)}function hf(o,i,s){const c=s*s;if(1===i.length)return o.distSqr(i[0])<c;for(let p=1;p<i.length;p++)if(Zu(o,i[p-1],i[p])<c)return!0;return!1}function Zu(o,i,s){const c=i.distSqr(s);if(0===c)return o.distSqr(i);const p=((o.x-i.x)*(s.x-i.x)+(o.y-i.y)*(s.y-i.y))/c;return o.distSqr(p<0?i:p>1?s:s.sub(i)._mult(p)._add(i))}function Zx(o,i){let s,c,p,g=!1;for(let v=0;v<o.length;v++){s=o[v];for(let w=0,T=s.length-1;w<s.length;T=w++)c=s[w],p=s[T],c.y>i.y!=p.y>i.y&&i.x<(p.x-c.x)*(i.y-c.y)/(p.y-c.y)+c.x&&(g=!g)}return g}function ou(o,i){let s=!1;for(let c=0,p=o.length-1;c<o.length;p=c++){const g=o[c],v=o[p];g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(s=!s)}return s}function ev(o,i,s,c,p){for(const v of o)if(i<=v.x&&s<=v.y&&c>=v.x&&p>=v.y)return!0;const g=[new Fe(i,s),new Fe(i,p),new Fe(c,p),new Fe(c,s)];if(o.length>2)for(const v of g)if(ou(o,v))return!0;for(let v=0;v<o.length-1;v++)if(Wx(o[v],o[v+1],g))return!0;return!1}function Wx(o,i,s){const c=s[0],p=s[2];if(o.x<c.x&&i.x<c.x||o.x>p.x&&i.x>p.x||o.y<c.y&&i.y<c.y||o.y>p.y&&i.y>p.y)return!1;const g=go(o,i,s[0]);return g!==go(o,i,s[1])||g!==go(o,i,s[2])||g!==go(o,i,s[3])}function ed(o,i,s){const c=i.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(i.id).getMaxValue(o)}function Lp(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function tv(o,i,s,c,p){if(!i[0]&&!i[1])return o;const g=Fe.convert(i)._mult(p);"viewport"===s&&g._rotate(-c);const v=[];for(let w=0;w<o.length;w++)v.push(o[w].sub(g));return v}function nv(o,i,s,c){const p=Fe.convert(o)._mult(c);return"viewport"===i&&p._rotate(-s),p}Qt(Jh,"CircleBucket",{omit:["layers"]});const Eg=new ce({"circle-sort-key":new ee(tt.layout_circle["circle-sort-key"])});var kp={paint:new ce({"circle-radius":new ee(tt.paint_circle["circle-radius"]),"circle-color":new ee(tt.paint_circle["circle-color"]),"circle-blur":new ee(tt.paint_circle["circle-blur"]),"circle-opacity":new ee(tt.paint_circle["circle-opacity"]),"circle-translate":new G(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new G(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new G(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new G(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(tt.paint_circle["circle-stroke-opacity"])}),layout:Eg};function iv(o,i,s,c,p,g,v,w,T){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(T*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,P=s.projection.upVectorScale(S,s.center.lat,s.worldSize).metersToTile;for(const N of i)for(const F of N){const V=F.add(w),j=p&&s.elevation?s.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,q=s.projection.projectTilePoint(V.x,V.y,S);if(j>0){const ae=s.projection.upVector(S,V.x,V.y);q.x+=ae[0]*P*j,q.y+=ae[1]*P*j,q.z+=ae[2]*P*j}const J=g?V:Op(q.x,q.y,q.z,c),se=g?o.tilespaceRays.map(ae=>Xx(ae,j)):o.queryGeometry.screenGeometry,pe=iu([],[q.x,q.y,q.z,1],c);if(!v&&g?T*=pe[3]/s.cameraToCenterDistance:v&&!g&&(T*=s.cameraToCenterDistance/pe[3]),g){const ae=zo((F.y/gn+S.y)/(1<<S.z));T/=s.projection.pixelsPerMeter(ae,1)/Wl(1,ae)}if(Hx(se,J,T))return!0}return!1}function Op(o,i,s,c){const p=iu([],[o,i,s,1],c);return new Fe(p[0]/p[3],p[1]/p[3])}const rv=Gh(0,0,0),Np=Gh(0,0,1);function Xx(o,i){const s=bp();return rv[2]=i,o.intersectsPlane(rv,Np,s),new Fe(s[0],s[1])}class Cg extends Jh{}function Fp(o,{width:i,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*s*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*s*c);return o.width=i,o.height=s,o.data=p,o}function df(o,i,s){const{width:c,height:p}=i;c===o.width&&p===o.height||(zp(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,p)},s),o.width=c,o.height=p,o.data=i.data)}function zp(o,i,s,c,p,g){if(0===p.width||0===p.height)return i;if(p.width>o.width||p.height>o.height||s.x>o.width-p.width||s.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||c.x>i.width-p.width||c.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,w=i.data;for(let T=0;T<p.height;T++){const S=((s.y+T)*o.width+s.x)*g,P=((c.y+T)*i.width+c.x)*g;for(let N=0;N<p.width*g;N++)w[P+N]=v[S+N]}return i}Qt(Cg,"HeatmapBucket",{omit:["layers"]});class Pc{constructor(i,s){Fp(this,i,1,s)}resize(i){df(this,new Pc(i),1)}clone(){return new Pc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,p,g){zp(i,s,c,p,g,1)}}class Ss{constructor(i,s){Fp(this,i,4,s)}resize(i){df(this,new Ss(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,p,g){zp(i,s,c,p,g,4)}}Qt(Pc,"AlphaImage"),Qt(Ss,"RGBAImage");var td={paint:new ce({"heatmap-radius":new ee(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new G(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new le(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new G(tt.paint_heatmap["heatmap-opacity"])})};function Wu(o){const i={},s=o.resolution||256,c=o.clips?o.clips.length:1,p=o.image||new Ss({width:s,height:c}),g=(v,w,T)=>{i[o.evaluationKey]=T;const S=o.expression.evaluate(i);p.data[v+w+0]=Math.floor(255*S.r/S.a),p.data[v+w+1]=Math.floor(255*S.g/S.a),p.data[v+w+2]=Math.floor(255*S.b/S.a),p.data[v+w+3]=Math.floor(255*S.a)};if(o.clips)for(let v=0,w=0;v<c;++v,w+=4*s)for(let T=0,S=0;T<s;T++,S+=4){const P=T/(s-1),{start:N,end:F}=o.clips[v];g(w,S,N*(1-P)+F*P)}else for(let v=0,w=0;v<s;v++,w+=4)g(0,w,v/(s-1));return p}var Yx={paint:new ce({"hillshade-illumination-direction":new G(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new G(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new G(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new G(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new G(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new G(tt.paint_hillshade["hillshade-accent-color"])})};const OE=Pe([{name:"a_pos",components:2,type:"Int16"}],4),{members:ov}=OE;var Tg={exports:{}};function Dg(o,i,s){s=s||2;var c,p,g,v,w,T,S,P=i&&i.length,N=P?i[0]*s:o.length,F=sv(o,0,N,s,!0),V=[];if(!F||F.next===F.prev)return V;if(P&&(F=function(q,J,se,pe){var ae,de,ge,me=[];for(ae=0,de=J.length;ae<de;ae++)(ge=sv(q,J[ae]*pe,ae<de-1?J[ae+1]*pe:q.length,pe,!1))===ge.next&&(ge.steiner=!0),me.push(Jx(ge));for(me.sort(NE),ae=0;ae<me.length;ae++)se=cv(me[ae],se);return se}(o,i,F,s)),o.length>80*s){c=g=o[0],p=v=o[1];for(var j=s;j<N;j+=s)(w=o[j])<c&&(c=w),(T=o[j+1])<p&&(p=T),w>g&&(g=w),T>v&&(v=T);S=0!==(S=Math.max(g-c,v-p))?32767/S:0}return ff(F,V,s,c,p,S,0),V}function sv(o,i,s,c,p){var g,v;if(p===Up(o,i,s,c)>0)for(g=i;g<s;g+=c)v=uv(g,o[g],o[g+1],v);else for(g=s-c;g>=i;g-=c)v=uv(g,o[g],o[g+1],v);return v&&nd(v,v.next)&&(au(v),v=v.next),v}function Xu(o,i){if(!o)return o;i||(i=o);var s,c=o;do{if(s=!1,c.steiner||!nd(c,c.next)&&0!==$r(c.prev,c,c.next))c=c.next;else{if(au(c),(c=i=c.prev)===c.next)break;s=!0}}while(s||c!==i);return i}function ff(o,i,s,c,p,g,v){if(o){!v&&g&&function(P,N,F,V){var j=P;do{0===j.z&&(j.z=Mg(j.x,j.y,N,F,V)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function(q){var J,se,pe,ae,de,ge,me,Ge,je=1;do{for(se=q,q=null,de=null,ge=0;se;){for(ge++,pe=se,me=0,J=0;J<je&&(me++,pe=pe.nextZ);J++);for(Ge=je;me>0||Ge>0&&pe;)0!==me&&(0===Ge||!pe||se.z<=pe.z)?(ae=se,se=se.nextZ,me--):(ae=pe,pe=pe.nextZ,Ge--),de?de.nextZ=ae:q=ae,ae.prevZ=de,de=ae;se=pe}de.nextZ=null,je*=2}while(ge>1)}(j)}(o,c,p,g);for(var w,T,S=o;o.prev!==o.next;)if(w=o.prev,T=o.next,g?av(o,c,p,g):Bp(o))i.push(w.i/s|0),i.push(o.i/s|0),i.push(T.i/s|0),au(o),o=T.next,S=T.next;else if((o=T)===S){v?1===v?ff(o=Kx(Xu(o),i,s),i,s,c,p,g,2):2===v&&lv(o,i,s,c,p,g):ff(Xu(o),i,s,c,p,g,1);break}}}function Bp(o){var i=o.prev,s=o,c=o.next;if($r(i,s,c)>=0)return!1;for(var p=i.x,g=s.x,v=c.x,w=i.y,T=s.y,S=c.y,P=p<g?p<v?p:v:g<v?g:v,N=w<T?w<S?w:S:T<S?T:S,F=p>g?p>v?p:v:g>v?g:v,V=w>T?w>S?w:S:T>S?T:S,j=c.next;j!==i;){if(j.x>=P&&j.x<=F&&j.y>=N&&j.y<=V&&su(p,w,g,T,v,S,j.x,j.y)&&$r(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function av(o,i,s,c){var p=o.prev,g=o,v=o.next;if($r(p,g,v)>=0)return!1;for(var w=p.x,T=g.x,S=v.x,P=p.y,N=g.y,F=v.y,V=w<T?w<S?w:S:T<S?T:S,j=P<N?P<F?P:F:N<F?N:F,q=w>T?w>S?w:S:T>S?T:S,J=P>N?P>F?P:F:N>F?N:F,se=Mg(V,j,i,s,c),pe=Mg(q,J,i,s,c),ae=o.prevZ,de=o.nextZ;ae&&ae.z>=se&&de&&de.z<=pe;){if(ae.x>=V&&ae.x<=q&&ae.y>=j&&ae.y<=J&&ae!==p&&ae!==v&&su(w,P,T,N,S,F,ae.x,ae.y)&&$r(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=V&&de.x<=q&&de.y>=j&&de.y<=J&&de!==p&&de!==v&&su(w,P,T,N,S,F,de.x,de.y)&&$r(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=se;){if(ae.x>=V&&ae.x<=q&&ae.y>=j&&ae.y<=J&&ae!==p&&ae!==v&&su(w,P,T,N,S,F,ae.x,ae.y)&&$r(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=pe;){if(de.x>=V&&de.x<=q&&de.y>=j&&de.y<=J&&de!==p&&de!==v&&su(w,P,T,N,S,F,de.x,de.y)&&$r(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Kx(o,i,s){var c=o;do{var p=c.prev,g=c.next.next;!nd(p,g)&&Qx(p,c,c.next,g)&&Vp(p,g)&&Vp(g,p)&&(i.push(p.i/s|0),i.push(c.i/s|0),i.push(g.i/s|0),au(c),au(c.next),c=o=g),c=c.next}while(c!==o);return Xu(c)}function lv(o,i,s,c,p,g){var v=o;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&zE(v,w)){var T=eb(v,w);return v=Xu(v,v.next),T=Xu(T,T.next),ff(v,i,s,c,p,g,0),void ff(T,i,s,c,p,g,0)}w=w.next}v=v.next}while(v!==o)}function NE(o,i){return o.x-i.x}function cv(o,i){var s=function(p,g){var v,w=g,T=p.x,S=p.y,P=-1/0;do{if(S<=w.y&&S>=w.next.y&&w.next.y!==w.y){var N=w.x+(S-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(N<=T&&N>P&&(P=N,v=w.x<w.next.x?w:w.next,N===T))return v}w=w.next}while(w!==g);if(!v)return null;var F,V=v,j=v.x,q=v.y,J=1/0;w=v;do{T>=w.x&&w.x>=j&&T!==w.x&&su(S<q?T:P,S,j,q,S<q?P:T,S,w.x,w.y)&&(F=Math.abs(S-w.y)/(T-w.x),Vp(w,p)&&(F<J||F===J&&(w.x>v.x||w.x===v.x&&FE(v,w)))&&(v=w,J=F)),w=w.next}while(w!==V);return v}(o,i);if(!s)return i;var c=eb(s,o);return Xu(c,c.next),Xu(s,s.next)}function FE(o,i){return $r(o.prev,o,i.prev)<0&&$r(i.next,o,o.next)<0}function Mg(o,i,s,c,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-c)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Jx(o){var i=o,s=o;do{(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next}while(i!==o);return s}function su(o,i,s,c,p,g,v,w){return(p-v)*(i-w)>=(o-v)*(g-w)&&(o-v)*(c-w)>=(s-v)*(i-w)&&(s-v)*(g-w)>=(p-v)*(c-w)}function zE(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(s,c){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&Qx(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(o,i)&&(Vp(o,i)&&Vp(i,o)&&function(s,c){var p=s,g=!1,v=(s.x+c.x)/2,w=(s.y+c.y)/2;do{p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next}while(p!==s);return g}(o,i)&&($r(o.prev,o,i.prev)||$r(o,i.prev,i))||nd(o,i)&&$r(o.prev,o,o.next)>0&&$r(i.prev,i,i.next)>0)}function $r(o,i,s){return(i.y-o.y)*(s.x-i.x)-(i.x-o.x)*(s.y-i.y)}function nd(o,i){return o.x===i.x&&o.y===i.y}function Qx(o,i,s,c){var p=Ig($r(o,i,s)),g=Ig($r(o,i,c)),v=Ig($r(s,c,o)),w=Ig($r(s,c,i));return p!==g&&v!==w||!(0!==p||!Sg(o,s,i))||!(0!==g||!Sg(o,c,i))||!(0!==v||!Sg(s,o,c))||!(0!==w||!Sg(s,i,c))}function Sg(o,i,s){return i.x<=Math.max(o.x,s.x)&&i.x>=Math.min(o.x,s.x)&&i.y<=Math.max(o.y,s.y)&&i.y>=Math.min(o.y,s.y)}function Ig(o){return o>0?1:o<0?-1:0}function Vp(o,i){return $r(o.prev,o,o.next)<0?$r(o,i,o.next)>=0&&$r(o,o.prev,i)>=0:$r(o,i,o.prev)<0||$r(o,o.next,i)<0}function eb(o,i){var s=new id(o.i,o.x,o.y),c=new id(i.i,i.x,i.y),p=o.next,g=i.prev;return o.next=i,i.prev=o,s.next=p,p.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function uv(o,i,s,c){var p=new id(o,i,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function au(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function id(o,i,s){this.i=o,this.x=i,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Up(o,i,s,c){for(var p=0,g=i,v=s-c;g<s;g+=c)p+=(o[v]-o[g])*(o[g+1]+o[v+1]),v=g;return p}Tg.exports=Dg,Tg.exports.default=Dg,Dg.deviation=function(o,i,s,c){var p=i&&i.length,g=Math.abs(Up(o,0,p?i[0]*s:o.length,s));if(p)for(var v=0,w=i.length;v<w;v++)g-=Math.abs(Up(o,i[v]*s,v<w-1?i[v+1]*s:o.length,s));var T=0;for(v=0;v<c.length;v+=3){var S=c[v]*s,P=c[v+1]*s,N=c[v+2]*s;T+=Math.abs((o[S]-o[N])*(o[P+1]-o[S+1])-(o[S]-o[P])*(o[N+1]-o[S+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},Dg.flatten=function(o){for(var i=o[0][0].length,s={vertices:[],holes:[],dimensions:i},c=0,p=0;p<o.length;p++){for(var g=0;g<o[p].length;g++)for(var v=0;v<i;v++)s.vertices.push(o[p][g][v]);p>0&&s.holes.push(c+=o[p-1].length)}return s};var jp=he(Tg.exports);function hv(o,i,s,c,p){Yu(o,i,s||0,c||o.length-1,p||dv)}function Yu(o,i,s,c,p){for(;c>s;){if(c-s>600){var g=c-s+1,v=i-s+1,w=Math.log(g),T=.5*Math.exp(2*w/3),S=.5*Math.sqrt(w*T*(g-T)/g)*(v-g/2<0?-1:1);Yu(o,i,Math.max(s,Math.floor(i-v*T/g+S)),Math.min(c,Math.floor(i+(g-v)*T/g+S)),p)}var P=o[i],N=s,F=c;for(rd(o,s,i),p(o[c],P)>0&&rd(o,s,c);N<F;){for(rd(o,N,F),N++,F--;p(o[N],P)<0;)N++;for(;p(o[F],P)>0;)F--}0===p(o[s],P)?rd(o,s,F):rd(o,++F,c),F<=i&&(s=F+1),i<=F&&(c=F-1)}}function rd(o,i,s){var c=o[i];o[i]=o[s],o[s]=c}function dv(o,i){return o<i?-1:o>i?1:0}function od(o,i){const s=o.length;if(s<=1)return[o];const c=[];let p,g;for(let v=0;v<s;v++){const w=sc(o[v]);0!==w&&(o[v].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(p&&c.push(p),p=[o[v]]):p.push(o[v]))}if(p&&c.push(p),i>1)for(let v=0;v<c.length;v++)c[v].length<=i||(hv(c[v],i,1,c[v].length-1,$p),c[v]=c[v].slice(0,i));return c}function $p(o,i){return i.area-o.area}function Xl(o,i,s){const c=s.patternDependencies;let p=!1;for(const g of i){const v=g.paint.get(`${o}-pattern`);v.isConstant()||(p=!0);const w=v.constantOr(null);w&&(p=!0,c[w]=!0)}return p}function Ag(o,i,s,c,p){const g=p.patternDependencies;for(const v of i){const w=v.paint.get(`${o}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:c},s,{},p.availableImages);T=T&&T.name?T.name:T,g[T]=!0,s.patterns[v.id]=T}}return s}class Hp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Et,this.indexArray=new Kt,this.indexArray2=new co,this.programConfigurations=new Vr(i.layers,i.zoom),this.segments=new Bi,this.segments2=new Bi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection}populate(i,s,c,p){this.hasPattern=Xl("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:T,index:S,sourceLayerIndex:P}of i){const N=this.layers[0]._featureFilter.needGeometry,F=Do(w,N);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),F,c))continue;const V=g?g.evaluate(F,{},c,s.availableImages):void 0,j={id:T,properties:w.properties,type:w.type,sourceLayerIndex:P,index:S,geometry:N?F.geometry:Ic(w,c,p),patterns:{},sortKey:V};v.push(j)}g&&v.sort((w,T)=>w.sortKey-T.sortKey);for(const w of v){const{geometry:T,index:S,sourceLayerIndex:P}=w;if(this.hasPattern){const N=Ag("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(w,T,S,c,{},s.availableImages);s.featureIndex.insert(i[S].feature,T,S,P,this.index)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}addFeatures(i,s,c,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ov),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,s,c,p,g,v=[]){for(const w of od(s,500)){let T=0;for(const j of w)T+=j.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=S.vertexLength,N=[],F=[];for(const j of w){if(0===j.length)continue;j!==w[0]&&F.push(N.length/2);const q=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(J+j.length-1,J),N.push(j[0].x),N.push(j[0].y);for(let se=1;se<j.length;se++)this.layoutVertexArray.emplaceBack(j[se].x,j[se].y),this.indexArray2.emplaceBack(J+se-1,J+se),N.push(j[se].x),N.push(j[se].y);q.vertexLength+=j.length,q.primitiveLength+=j.length}const V=jp(N,F);for(let j=0;j<V.length;j+=3)this.indexArray.emplaceBack(P+V[j],P+V[j+1],P+V[j+2]);S.vertexLength+=T,S.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}}Qt(Hp,"FillBucket",{omit:["layers","patternFeatures"]});const tb=new ce({"fill-sort-key":new ee(tt.layout_fill["fill-sort-key"])});var fv={paint:new ce({"fill-antialias":new G(tt.paint_fill["fill-antialias"]),"fill-opacity":new ee(tt.paint_fill["fill-opacity"]),"fill-color":new ee(tt.paint_fill["fill-color"]),"fill-outline-color":new ee(tt.paint_fill["fill-outline-color"]),"fill-translate":new G(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new G(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ee(tt.paint_fill["fill-pattern"])}),layout:tb};const Pg=Pe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),nb=Pe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ib=Pe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:rb}=Pg;var pf={},ob=ke,pv=bo;function bo(o,i,s,c,p){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=p,o.readFields(Rg,this,i)}function Rg(o,i,s){1==o?i.id=s.readVarint():2==o?function(c,p){for(var g=c.readVarint()+c.pos;c.pos<g;){var v=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[v]=w}}(s,i):3==o?i.type=s.readVarint():4==o&&(i._geometry=s.pos)}function mv(o){for(var i,s,c=0,p=0,g=o.length,v=g-1;p<g;v=p++)c+=((s=o[v]).x-(i=o[p]).x)*(i.y+s.y);return c}bo.types=["Unknown","Point","LineString","Polygon"],bo.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,s=o.readVarint()+o.pos,c=1,p=0,g=0,v=0,w=[];o.pos<s;){if(p<=0){var T=o.readVarint();c=7&T,p=T>>3}if(p--,1===c||2===c)g+=o.readSVarint(),v+=o.readSVarint(),1===c&&(i&&w.push(i),i=[]),i.push(new ob(g,v));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&w.push(i),w},bo.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,s=1,c=0,p=0,g=0,v=1/0,w=-1/0,T=1/0,S=-1/0;o.pos<i;){if(c<=0){var P=o.readVarint();s=7&P,c=P>>3}if(c--,1===s||2===s)(p+=o.readSVarint())<v&&(v=p),p>w&&(w=p),(g+=o.readSVarint())<T&&(T=g),g>S&&(S=g);else if(7!==s)throw new Error("unknown command "+s)}return[v,T,w,S]},bo.prototype.toGeoJSON=function(o,i,s){var c,p,g=this.extent*Math.pow(2,s),v=this.extent*o,w=this.extent*i,T=this.loadGeometry(),S=bo.types[this.type];function P(V){for(var j=0;j<V.length;j++){var q=V[j];V[j]=[360*(q.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(c=0;c<T.length;c++)N[c]=T[c][0];P(T=N);break;case 2:for(c=0;c<T.length;c++)P(T[c]);break;case 3:for(T=function(V){var j=V.length;if(j<=1)return[V];for(var q,J,se=[],pe=0;pe<j;pe++){var ae=mv(V[pe]);0!==ae&&(void 0===J&&(J=ae<0),J===ae<0?(q&&se.push(q),q=[V[pe]]):q.push(V[pe]))}return q&&se.push(q),se}(T),c=0;c<T.length;c++)for(p=0;p<T[c].length;p++)P(T[c][p])}1===T.length?T=T[0]:S="Multi"+S;var F={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(F.id=this.id),F};var Lg=pv,Vo=sd;function sd(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(gv,this,i),this.length=this._features.length}function gv(o,i,s){15===o?i.version=s.readVarint():1===o?i.name=s.readString():5===o?i.extent=s.readVarint():2===o?i._features.push(s.pos):3===o?i._keys.push(s.readString()):4===o&&i._values.push(function(c){for(var p=null,g=c.readVarint()+c.pos;c.pos<g;){var v=c.readVarint()>>3;p=1===v?c.readString():2===v?c.readFloat():3===v?c.readDouble():4===v?c.readVarint64():5===v?c.readVarint():6===v?c.readSVarint():7===v?c.readBoolean():null}return p}(s))}sd.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new Lg(this._pbf,i,this.extent,this._keys,this._values)};var _v=Vo;function sb(o,i,s){if(3===o){var c=new _v(s,s.readVarint()+s.pos);c.length&&(i[c.name]=c)}}var Gp=pf.VectorTile=function(o,i){this.layers=o.readFields(sb,{},i)},qp=pf.VectorTileFeature=pv;function mf(o,i,s,c){const p=[],g=0===c?(v,w,T,S,P,N)=>{v.push(new Fe(N,T+(N-w)/(S-w)*(P-T)))}:(v,w,T,S,P,N)=>{v.push(new Fe(w+(N-T)/(P-T)*(S-w),N))};for(const v of o){const w=[];for(const T of v){if(T.length<=2)continue;const S=[];for(let F=0;F<T.length-1;F++){const V=T[F].x,j=T[F].y,q=T[F+1].x,J=T[F+1].y,se=0===c?V:j,pe=0===c?q:J;se<i?pe>i&&g(S,V,j,q,J,i):se>s?pe<s&&g(S,V,j,q,J,s):S.push(T[F]),pe<i&&se>=i&&g(S,V,j,q,J,i),pe>s&&se<=s&&g(S,V,j,q,J,s)}let P=T[T.length-1];const N=0===c?P.x:P.y;N>=i&&N<=s&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),w.push(S))}w.length&&p.push(w)}return p}pf.VectorTileLayer=Vo;const ab=qp.types,yv=Math.pow(2,13);function gf(o,i,s,c,p,g,v,w){o.emplaceBack((i<<1)+v,(s<<1)+g,(Math.floor(c*yv)<<1)+p,Math.round(w))}function _f(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Zp{constructor(){this.acc=new Fe(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Fe(i.x,i.y),this.max=new Fe(i.x,i.y))}append(i,s){this.currentPolyCount.edges++,this.acc._add(i);const c=this.min,p=this.max;i.x<c.x?c.x=i.x:i.x>p.x&&(p.x=i.x),i.y<c.y?c.y=i.y:i.y>p.y&&(p.y=i.y),((0===i.x||i.x===gn)&&i.x===s.x)!=((0===i.y||i.y===gn)&&i.y===s.y)&&this.processBorderOverlap(i,s),s.x<0!=i.x<0&&this.addBorderIntersection(0,si(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>gn!=i.x>gn&&this.addBorderIntersection(1,si(s.y,i.y,(gn-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,si(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>gn!=i.y>gn&&this.addBorderIntersection(3,si(s.x,i.x,(gn-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==i?this.acc.div(i)._round():new Fe(0,0)}span(){return new Fe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0)}}class Ku{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new ut,this.centroidVertexArray=new Br,this.indexArray=new Kt,this.programConfigurations=new Vr(i.layers,i.zoom),this.segments=new Bi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=i.enableTerrain}populate(i,s,c,p){this.features=[],this.hasPattern=Xl("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const v=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*v/(v*v+1)/gn/(1<<g.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:v,index:w,sourceLayerIndex:T}of i){const S=this.layers[0]._featureFilter.needGeometry,P=Do(g,S);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),P,c))continue;const N={id:v,sourceLayerIndex:T,index:w,geometry:S?P.geometry:Ic(g,c,p),properties:g.properties,type:g.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ag("fill-extrusion",this.layers,N,this.zoom,s)):this.addFeature(N,N.geometry,w,c,{},s.availableImages,p),s.featureIndex.insert(g,N.geometry,w,T,this.index,F)}this.sortBorders()}addFeatures(i,s,c,p,g){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,s,c,p,g)}this.sortBorders()}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rb),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,ib.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,nb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,c,p,g,v,w){const T=[new Fe(0,0),new Fe(gn,gn)],S=w.projection,P="globe"===S.name,N=this.enableTerrain&&!P?new Zp:null,F="Polygon"===ab[i.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dt);const V=od(s,500);for(let se=V.length-1;se>=0;se--){const pe=V[se];(0===pe.length||(j=pe[0]).every(ae=>ae.x<=0)||j.every(ae=>ae.x>=gn)||j.every(ae=>ae.y<=0)||j.every(ae=>ae.y>=gn))&&V.splice(se,1)}var j;let q;if(P)q=Ju(V,T,p);else{q=[];for(const se of V)q.push({polygon:se,bounds:T})}const J=F?this.edgeRadius:0;for(const{polygon:se,bounds:pe}of q){let ae=0,de=0;for(const me of se)F&&!me[0].equals(me[me.length-1])&&me.push(me[0]),de+=F?me.length-1:me.length;const ge=this.segments.prepareSegment((F?5:4)*de,this.layoutVertexArray,this.indexArray);if(F){const me=[],Ge=[];ae=ge.vertexLength;for(const ot of se){let wt,Xe;ot.length&&ot!==se[0]&&Ge.push(me.length/2),wt=ot[1].sub(ot[0])._perp()._unit();for(let ht=1;ht<ot.length;ht++){const ct=ot[ht],_t=ot[ht===ot.length-1?1:ht+1];let{x:At,y:nt}=ct;if(J){Xe=_t.sub(ct)._perp()._unit();const jt=wt.add(Xe)._unit(),nn=J*Math.min(4,1/(wt.x*jt.x+wt.y*jt.y));At+=nn*jt.x,nt+=nn*jt.y,wt=Xe}gf(this.layoutVertexArray,At,nt,0,0,1,1,0),ge.vertexLength++,me.push(ct.x,ct.y),P&&_f(this.layoutVertexExtArray,S.projectTilePoint(At,nt,p),S.upVector(p,At,nt))}}const je=jp(me,Ge);for(let ot=0;ot<je.length;ot+=3)this.indexArray.emplaceBack(ae+je[ot],ae+je[ot+2],ae+je[ot+1]),ge.primitiveLength++}for(const me of se){N&&me.length&&N.startRing(me[0]);let Ge,je,ot,wt=me.length>4&&kg(me[me.length-2],me[0],me[1]),Xe=J?yf(me[me.length-2],me[0],me[1],J):0;je=me[1].sub(me[0])._perp()._unit();let ht=!0;for(let ct=1,_t=0;ct<me.length;ct++){let At=me[ct-1],nt=me[ct];const jt=me[ct===me.length-1?1:ct+1];if(N&&F&&N.currentPolyCount.top++,bv(nt,At,pe)){J&&(je=jt.sub(nt)._perp()._unit(),ht=!ht);continue}N&&N.append(nt,At);const nn=nt.sub(At)._perp(),$t=nn.x/(Math.abs(nn.x)+Math.abs(nn.y)),Bn=nn.y>0?1:0,Rt=At.dist(nt);if(_t+Rt>32768&&(_t=0),J){ot=jt.sub(nt)._perp()._unit();let Hn=xv(At,nt,jt,vv(je,ot),J);isNaN(Hn)&&(Hn=0);const En=nt.sub(At)._unit();At=At.add(En.mult(Xe))._round(),nt=nt.add(En.mult(-Hn))._round(),Xe=Hn,je=ot}const _n=ge.vertexLength,Vn=me.length>4&&kg(At,nt,jt);let gi=Og(_t,wt,ht);if(gf(this.layoutVertexArray,At.x,At.y,$t,Bn,0,0,gi),gf(this.layoutVertexArray,At.x,At.y,$t,Bn,0,1,gi),_t+=Rt,gi=Og(_t,Vn,!ht),wt=Vn,gf(this.layoutVertexArray,nt.x,nt.y,$t,Bn,0,0,gi),gf(this.layoutVertexArray,nt.x,nt.y,$t,Bn,0,1,gi),ge.vertexLength+=4,this.indexArray.emplaceBack(_n+0,_n+1,_n+2),this.indexArray.emplaceBack(_n+1,_n+3,_n+2),ge.primitiveLength+=2,J){const Hn=ae+(1===ct?me.length-2:ct-2),En=1===ct?ae:Hn+1;if(this.indexArray.emplaceBack(_n+1,Hn,_n+3),this.indexArray.emplaceBack(Hn,En,_n+3),ge.primitiveLength+=2,void 0===Ge&&(Ge=_n),!bv(jt,me[ct],pe)){const Ui=ct===me.length-1?Ge:ge.vertexLength;this.indexArray.emplaceBack(_n+2,_n+3,Ui),this.indexArray.emplaceBack(_n+3,Ui+1,Ui),this.indexArray.emplaceBack(_n+3,En,Ui+1),ge.primitiveLength+=3}ht=!ht}if(P){const Hn=this.layoutVertexExtArray,En=S.projectTilePoint(At.x,At.y,p),Ui=S.projectTilePoint(nt.x,nt.y,p),Wn=S.upVector(p,At.x,At.y),Fn=S.upVector(p,nt.x,nt.y);_f(Hn,En,Wn),_f(Hn,En,Wn),_f(Hn,Ui,Fn),_f(Hn,Ui,Fn)}}F&&(ae+=me.length-1)}}if(N&&N.polyCount.length>0){if(N.borders){N.vertexArrayOffset=this.centroidVertexArray.length;const se=N.borders,pe=this.featuresOnBorder.push(N)-1;for(let ae=0;ae<4;ae++)se[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(pe)}this.encodeCentroid(N.borders?void 0:N.centroid(),N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((s,c)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,s,c=!0){let p,g;if(i)if(0!==i.y){const w=s.span()._mult(this.tileToMeter);p=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else p=Math.ceil(7*(i.x+450)),g=0;else p=0,g=+c;let v=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const w of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(v++,p,g);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(v++,0,g),this.centroidVertexArray.emplace(v++,p,g)}}}function vv(o,i){const s=o.add(i)._unit();return o.x*s.x+o.y*s.y}function yf(o,i,s,c){const p=i.sub(o)._perp()._unit(),g=s.sub(i)._perp()._unit();return xv(o,i,s,vv(p,g),c)}function xv(o,i,s,c,p){const g=Math.sqrt(1-c*c);return Math.min(o.dist(i)/3,i.dist(s)/3,p*g/c)}function bv(o,i,s){return o.x<s[0].x&&i.x<s[0].x||o.x>s[1].x&&i.x>s[1].x||o.y<s[0].y&&i.y<s[0].y||o.y>s[1].y&&i.y>s[1].y}function kg(o,i,s){if(o.x<0||o.x>=gn||i.x<0||i.x>=gn||s.x<0||s.x>=gn)return!1;const c=s.sub(i),p=c.perp(),g=o.sub(i);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&p.x*g.x+p.y*g.y<0}function Og(o,i,s){const c=i?2|o:-3&o;return s?1|c:-2&c}function Ng(){const o=Math.PI/32,i=Math.tan(o),s=ru;return s*Math.sqrt(1+2*i*i)-s}function Ju(o,i,s){const c=1<<s.z,p=la(s.x/c),g=la((s.x+1)/c),v=zo(s.y/c),w=zo((s.y+1)/c);return function(T,S,P,N,F=0,V){const j=[];if(!T.length||!P||!N)return j;const q=(me,Ge)=>{for(const je of me)j.push({polygon:je,bounds:Ge})},J=Math.ceil(Math.log2(P)),se=Math.ceil(Math.log2(N)),pe=J-se,ae=[];for(let me=0;me<Math.abs(pe);me++)ae.push(pe>0?0:1);for(let me=0;me<Math.min(J,se);me++)ae.push(0),ae.push(1);let de=T;if(de=mf(de,S[0].y-F,S[1].y+F,1),de=mf(de,S[0].x-F,S[1].x+F,0),!de.length)return j;const ge=[];for(ae.length?ge.push({polygons:de,bounds:S,depth:0}):q(de,S);ge.length;){const me=ge.pop(),Ge=me.depth,je=ae[Ge],ot=me.bounds[0],wt=me.bounds[1],Xe=0===je?ot.x:ot.y,ht=0===je?wt.x:wt.y,ct=V?V(je,Xe,ht):.5*(Xe+ht),_t=mf(me.polygons,Xe-F,ct+F,je),At=mf(me.polygons,ct-F,ht+F,je);if(_t.length){const nt=[ot,new Fe(0===je?ct:wt.x,1===je?ct:wt.y)];ae.length>Ge+1?ge.push({polygons:_t,bounds:nt,depth:Ge+1}):q(_t,nt)}if(At.length){const nt=[new Fe(0===je?ct:ot.x,1===je?ct:ot.y),wt];ae.length>Ge+1?ge.push({polygons:At,bounds:nt,depth:Ge+1}):q(At,nt)}}return j}(o,i,Math.ceil((g-p)/11.25),Math.ceil((v-w)/11.25),1,(T,S,P)=>{if(0===T)return.5*(S+P);{const N=zo((s.y+S/gn)/c);return(ds(.5*(zo((s.y+P/gn)/c)+N))*c-s.y)*gn}})}Qt(Ku,"FillExtrusionBucket",{omit:["layers","features"]}),Qt(Zp,"PartMetadata");const Wp=new ce({"fill-extrusion-edge-radius":new G(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var wv={paint:new ce({"fill-extrusion-opacity":new G(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new G(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new G(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ee(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new G(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new G(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new G(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new G(tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Wp};function Xp(o,i,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class Qu{constructor(i,s,c){this.z=i,this.x=s,this.y=c,this.key=vf(0,i,i,s,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,s){const c=(v=this.y,w=this.z,T=Xp(256*(g=this.x),256*(v=Math.pow(2,w)-v-1),w),S=Xp(256*(g+1),256*(v+1),w),T[0]+","+T[1]+","+S[0]+","+S[1]),p=function(g,v,w){let T,S="";for(let P=g;P>0;P--)T=1<<P-1,S+=(v&T?1:0)+(w&T?2:0);return S}(this.z,this.x,this.y);var g,v,w,T,S;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ev{constructor(i,s){this.wrap=i,this.canonical=s,this.key=vf(i,s.z,s.z,s.x,s.y)}}class Jo{constructor(i,s,c,p,g){this.overscaledZ=i,this.wrap=s,this.canonical=new Qu(c,+p,+g),this.key=0===s&&i===c?this.canonical.key:vf(s,i,c,p,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new Jo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jo(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return vf(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return vf(this.wrap*+s,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new Jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Jo(s,this.wrap,s,c,p),new Jo(s,this.wrap,s,c+1,p),new Jo(s,this.wrap,s,c,p+1),new Jo(s,this.wrap,s,c+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Jo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ev(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vf(o,i,s,c,p){const g=1<<Math.min(s,22);let v=g*(p%g)+c%g;return o&&s<22&&(v+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*v+s)+(i-s)}Qt(Qu,"CanonicalTileID"),Qt(Jo,"OverscaledTileID",{omit:["projMatrix"]});class ad extends Fe{constructor(i,s,c){super(i,s),this.z=c}}function xf(o,i){return o.x*i.x+o.y*i.y}function Cv(o,i){if(1===o.length){let s=0;const c=i[s++];let p;for(;!p||c.equals(p);)if(p=i[s++],!p)return 1/0;for(;s<i.length;s++){const g=i[s],v=o[0],w=p.sub(c),T=g.sub(c),S=v.sub(c),P=xf(w,w),N=xf(w,T),F=xf(T,T),V=xf(S,w),j=xf(S,T),q=P*F-N*N,J=(F*V-N*j)/q,se=(P*j-N*V)/q,pe=c.z*(1-J-se)+p.z*J+g.z*se;if(isFinite(pe))return pe}return 1/0}{let s=1/0;for(const c of i)s=Math.min(s,c.z);return s}}function Fg(o,i,s,c,p,g,v,w){const T=v*p.getElevationAt(o,i,!0,!0),S=0!==g[0],P=S?0===g[1]?v*(g[0]/7-450):v*function(N,F,V){const j=Math.floor(F[0]/8),q=Math.floor(F[1]/8),J=10*(F[0]-8*j),se=10*(F[1]-8*q),pe=N.getElevationAt(j,q,!0,!0),ae=N.getMeterToDEM(V),de=Math.floor(.5*(J*ae-1)),ge=Math.floor(.5*(se*ae-1)),me=N.tileCoordToPixel(j,q),Ge=2*de+1,je=2*ge+1,ot=(nn=Ge,$t=je,[(At=N).getElevationAtPixel(nt=me.x-de,jt=me.y-ge,!0),At.getElevationAtPixel(nt+$t,jt,!0),At.getElevationAtPixel(nt,jt+$t,!0),At.getElevationAtPixel(nt+nn,jt+$t,!0)]),wt=Math.abs(ot[0]-ot[1]),Xe=Math.abs(ot[2]-ot[3]),ht=Math.abs(ot[0]-ot[2])+Math.abs(ot[1]-ot[3]),ct=Math.min(.25,.5*ae*(wt+Xe)/Ge),_t=Math.min(.25,.5*ae*ht/je);var At,nt,jt,nn,$t;return pe+Math.max(ct*J,_t*se)}(p,g,w):T;return{base:T+(0===s)?-1:s,top:S?Math.max(P+c,T+s+2):T+c}}const Yp=Pe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:zg}=Yp,Bg=Pe([{name:"a_packed",components:4,type:"Float32"}]),{members:lb}=Bg,cb=qp.types,Vg=Math.cos(Math.PI/180*37.5);class bf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Ke,this.layoutVertexArray2=new xt,this.indexArray=new Kt,this.programConfigurations=new Vr(i.layers,i.zoom),this.segments=new Bi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,p){this.hasPattern=Xl("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:P,id:N,index:F,sourceLayerIndex:V}of i){const j=this.layers[0]._featureFilter.needGeometry,q=Do(P,j);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),q,c))continue;const J=g?g.evaluate(q,{},c):void 0,se={id:N,properties:P.properties,type:P.type,sourceLayerIndex:V,index:F,geometry:j?q.geometry:Ic(P,c,p),patterns:{},sortKey:J};v.push(se)}g&&v.sort((P,N)=>P.sortKey-N.sortKey);const{lineAtlas:w,featureIndex:T}=s,S=this.addConstantDashes(w);for(const P of v){const{geometry:N,index:F,sourceLayerIndex:V}=P;if(S&&this.addFeatureDashes(P,w),this.hasPattern){const j=Ag("line",this.layers,P,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(P,N,F,c,w.positions,s.availableImages);T.insert(i[F].feature,N,F,V,this.index)}}addConstantDashes(i){let s=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==g.kind)s=!0;else{const v=g.value,w=p.value;if(!w)continue;i.addDash(w,v)}}return s}addFeatureDashes(i,s){const c=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===v.kind)continue;let w,T;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:c},i);T="constant"===v.kind?v.value:v.evaluate({zoom:c},i),s.addDash(w,T),i.patterns[p.id]=s.getKey(w,T)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}addFeatures(i,s,c,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,lb)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zg),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,c,p,g,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),S=w.get("line-cap").evaluate(i,{}),P=w.get("line-miter-limit"),N=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const F of s)this.addLine(F,i,T,S,P,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}addLine(i,s,c,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<i.length-1;se++)this.totalDistance+=i[se].dist(i[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===cb[s.type];let T=i.length;for(;T>=2&&i[T-1].equals(i[T-2]);)T--;let S=0;for(;S<T-1&&i[S].equals(i[S+1]);)S++;if(T<(w?3:2))return;"bevel"===c&&(g=1.05);const P=this.overscaling<=16?15*gn/(512*this.overscaling):0,N=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let F,V,j,q,J;this.e1=this.e2=-1,w&&(F=i[T-2],J=i[S].sub(F)._unit()._perp());for(let se=S;se<T;se++){if(j=se===T-1?w?i[S+1]:void 0:i[se+1],j&&i[se].equals(j))continue;J&&(q=J),F&&(V=F),F=i[se],J=j?j.sub(F)._unit()._perp():q,q=q||J;let pe=q.add(J);0===pe.x&&0===pe.y||pe._unit();const ae=q.x*J.x+q.y*J.y,de=pe.x*J.x+pe.y*J.y,ge=0!==de?1/de:1/0,me=2*Math.sqrt(2-2*de),Ge=de<Vg&&V&&j,je=q.x*J.y-q.y*J.x>0;if(Ge&&se>S){const Xe=F.dist(V);if(Xe>2*P){const ht=F.sub(F.sub(V)._mult(P/Xe)._round());this.updateDistance(V,ht),this.addCurrentVertex(ht,q,0,0,N),V=ht}}const ot=V&&j;let wt=ot?c:w?"butt":p;if(ot&&"round"===wt&&(ge<v?wt="miter":ge<=2&&(wt="fakeround")),"miter"===wt&&ge>g&&(wt="bevel"),"bevel"===wt&&(ge>2&&(wt="flipbevel"),ge<g&&(wt="miter")),V&&this.updateDistance(V,F),"miter"===wt)pe._mult(ge),this.addCurrentVertex(F,pe,0,0,N);else if("flipbevel"===wt){if(ge>100)pe=J.mult(-1);else{const Xe=ge*q.add(J).mag()/q.sub(J).mag();pe._perp()._mult(Xe*(je?-1:1))}this.addCurrentVertex(F,pe,0,0,N),this.addCurrentVertex(F,pe.mult(-1),0,0,N)}else if("bevel"===wt||"fakeround"===wt){const Xe=-Math.sqrt(ge*ge-1),ht=je?Xe:0,ct=je?0:Xe;if(V&&this.addCurrentVertex(F,q,ht,ct,N),"fakeround"===wt){const _t=Math.round(180*me/Math.PI/20);for(let At=1;At<_t;At++){let nt=At/_t;if(.5!==nt){const nn=nt-.5;nt+=nt*nn*(nt-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*nn*nn+(.848013+ae*(.215638*ae-1.06021)))}const jt=J.sub(q)._mult(nt)._add(q)._unit()._mult(je?-1:1);this.addHalfVertex(F,jt.x,jt.y,!1,je,0,N)}}j&&this.addCurrentVertex(F,J,-ht,-ct,N)}else if("butt"===wt)this.addCurrentVertex(F,pe,0,0,N);else if("square"===wt){const Xe=V?1:-1;V||this.addCurrentVertex(F,pe,Xe,Xe,N),this.addCurrentVertex(F,pe,0,0,N),V&&this.addCurrentVertex(F,pe,Xe,Xe,N)}else"round"===wt&&(V&&(this.addCurrentVertex(F,q,0,0,N),this.addCurrentVertex(F,q,1,1,N,!0)),j&&(this.addCurrentVertex(F,J,-1,-1,N,!0),this.addCurrentVertex(F,J,0,0,N)));if(Ge&&se<T-1){const Xe=F.dist(j);if(Xe>2*P){const ht=F.add(j.sub(F)._mult(P/Xe)._round());this.updateDistance(F,ht),this.addCurrentVertex(ht,J,0,0,N),F=ht}}}}addCurrentVertex(i,s,c,p,g,v=!1){const w=s.y*p-s.x,T=-s.y-s.x*p;this.addHalfVertex(i,s.x+s.y*c,s.y-s.x*c,v,!1,c,g),this.addHalfVertex(i,w,T,v,!0,-p,g)}addHalfVertex({x:i,y:s},c,p,g,v,w,T){this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(s<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),T.primitiveLength++),v?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,s){this.distance+=i.dist(s),this.updateScaledDistance()}}Qt(bf,"LineBucket",{omit:["layers","patternFeatures"]});const eh=new ce({"line-cap":new ee(tt.layout_line["line-cap"]),"line-join":new ee(tt.layout_line["line-join"]),"line-miter-limit":new G(tt.layout_line["line-miter-limit"]),"line-round-limit":new G(tt.layout_line["line-round-limit"]),"line-sort-key":new ee(tt.layout_line["line-sort-key"])});var Ug={paint:new ce({"line-opacity":new ee(tt.paint_line["line-opacity"]),"line-color":new ee(tt.paint_line["line-color"]),"line-translate":new G(tt.paint_line["line-translate"]),"line-translate-anchor":new G(tt.paint_line["line-translate-anchor"]),"line-width":new ee(tt.paint_line["line-width"]),"line-gap-width":new ee(tt.paint_line["line-gap-width"]),"line-offset":new ee(tt.paint_line["line-offset"]),"line-blur":new ee(tt.paint_line["line-blur"]),"line-dasharray":new ee(tt.paint_line["line-dasharray"]),"line-pattern":new ee(tt.paint_line["line-pattern"]),"line-gradient":new le(tt.paint_line["line-gradient"]),"line-trim-offset":new G(tt.paint_line["line-trim-offset"])}),layout:eh};const jg=new class extends ee{possiblyEvaluate(o,i){return i=new R(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,s,c){return i=ii({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,s,c)}}(Ug.paint.properties["line-width"].specification);function Tv(o,i){return i>0?i+2*o:o}jg.useIntegerZoom=!0;const BE=Pe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kp=Pe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ub=Pe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dv=Pe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Mv=Pe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $g=Pe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hg=Pe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pe([{name:"triangle",components:3,type:"Uint16"}]),Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pe([{type:"Float32",name:"offsetX"}]),Pe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fo=24;const Is=128;function th(o,i){const{expression:s}=i;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new R(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let v=g;for(;v<c.length&&c[v]<o+1;)v++;v=Math.min(c.length-1,v);const w=c[g],T=c[v];return"composite"===s.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:T,minSize:s.evaluate(new R(w)),maxSize:s.evaluate(new R(T)),interpolationType:p}}}function wf(o,{uSize:i,uSizeT:s},{lowerSize:c,upperSize:p}){return"source"===o.kind?c/Is:"composite"===o.kind?si(c/Is,p/Is,s):i}function lu(o,i){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:p,minZoom:g,maxZoom:v}=o,w=p?Tn(ys.interpolationFactor(p,i,g,v),0,1):0;"camera"===o.kind?c=si(o.minSize,o.maxSize,w):s=w}return{uSizeT:s,uSize:c}}var Jp=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Is,evaluateSizeForFeature:wf,evaluateSizeForZoom:lu,getSizeData:th});function Sv(o,i,s){return o.sections.forEach(c=>{c.text=function(p,g,v){const w=g.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?p=p.toLocaleUpperCase():"lowercase"===w&&(p=p.toLocaleLowerCase()),A.applyArabicShaping&&(p=A.applyArabicShaping(p)),p}(c.text,i,s)}),o}const nh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Ef(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function hb(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Gg=Vi,Iv=function(o,i,s,c,p){var g,v,w=8*p-c-1,T=(1<<w)-1,S=T>>1,P=-7,N=s?p-1:0,F=s?-1:1,V=o[i+N];for(N+=F,g=V&(1<<-P)-1,V>>=-P,P+=w;P>0;g=256*g+o[i+N],N+=F,P-=8);for(v=g&(1<<-P)-1,g>>=-P,P+=c;P>0;v=256*v+o[i+N],N+=F,P-=8);if(0===g)g=1-S;else{if(g===T)return v?NaN:1/0*(V?-1:1);v+=Math.pow(2,c),g-=S}return(V?-1:1)*v*Math.pow(2,g-c)},Av=function(o,i,s,c,p,g){var v,w,T,S=8*g-p-1,P=(1<<S)-1,N=P>>1,F=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,V=c?0:g-1,j=c?1:-1,q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,v=P):(v=Math.floor(Math.log(i)/Math.LN2),i*(T=Math.pow(2,-v))<1&&(v--,T*=2),(i+=v+N>=1?F/T:F*Math.pow(2,1-N))*T>=2&&(v++,T/=2),v+N>=P?(w=0,v=P):v+N>=1?(w=(i*T-1)*Math.pow(2,p),v+=N):(w=i*Math.pow(2,N-1)*Math.pow(2,p),v=0));p>=8;o[s+V]=255&w,V+=j,w/=256,p-=8);for(v=v<<p|w,S+=p;S>0;o[s+V]=255&v,V+=j,v/=256,S-=8);o[s+V-j]|=128*q};function Vi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Vi.Varint=0,Vi.Fixed64=1,Vi.Bytes=2,Vi.Fixed32=5;var Qp=4294967296,qg=1/Qp,Cf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _l(o){return o.type===Vi.Bytes?o.readVarint()+o.pos:o.pos+1}function Pv(o,i,s){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(c);for(var p=s.pos-1;p>=o;p--)s.buf[p+c]=s.buf[p]}function db(o,i){for(var s=0;s<o.length;s++)i.writeVarint(o[s])}function VE(o,i){for(var s=0;s<o.length;s++)i.writeSVarint(o[s])}function fb(o,i){for(var s=0;s<o.length;s++)i.writeFloat(o[s])}function Zg(o,i){for(var s=0;s<o.length;s++)i.writeDouble(o[s])}function pb(o,i){for(var s=0;s<o.length;s++)i.writeBoolean(o[s])}function ld(o,i){for(var s=0;s<o.length;s++)i.writeFixed32(o[s])}function em(o,i){for(var s=0;s<o.length;s++)i.writeSFixed32(o[s])}function Wg(o,i){for(var s=0;s<o.length;s++)i.writeFixed64(o[s])}function Rv(o,i){for(var s=0;s<o.length;s++)i.writeSFixed64(o[s])}function Tf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function ih(o,i,s){o[s]=i,o[s+1]=i>>>8,o[s+2]=i>>>16,o[s+3]=i>>>24}function Xg(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}Vi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),p=c>>3,g=this.pos;this.type=7&c,o(p,i,this),this.pos===g&&this.skip(c)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=Tf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Xg(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Tf(this.buf,this.pos)+Tf(this.buf,this.pos+4)*Qp;return this.pos+=8,o},readSFixed64:function(){var o=Tf(this.buf,this.pos)+Xg(this.buf,this.pos+4)*Qp;return this.pos+=8,o},readFloat:function(){var o=Iv(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Iv(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,s,c=this.buf;return i=127&(s=c[this.pos++]),s<128?i:(i|=(127&(s=c[this.pos++]))<<7,s<128?i:(i|=(127&(s=c[this.pos++]))<<14,s<128?i:(i|=(127&(s=c[this.pos++]))<<21,s<128?i:function(p,g,v){var w,T,S=v.buf;if(w=(112&(T=S[v.pos++]))>>4,T<128||(w|=(127&(T=S[v.pos++]))<<3,T<128)||(w|=(127&(T=S[v.pos++]))<<10,T<128)||(w|=(127&(T=S[v.pos++]))<<17,T<128)||(w|=(127&(T=S[v.pos++]))<<24,T<128)||(w|=(1&(T=S[v.pos++]))<<31,T<128))return function yl(o,i,s){return s?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(p,w,g);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Cf?Cf.decode(this.buf.subarray(i,o)):function(s,c,p){for(var g="",v=c;v<p;){var w,T,S,P=s[v],N=null,F=P>239?4:P>223?3:P>191?2:1;if(v+F>p)break;1===F?P<128&&(N=P):2===F?128==(192&(w=s[v+1]))&&(N=(31&P)<<6|63&w)<=127&&(N=null):3===F?(T=s[v+2],128==(192&(w=s[v+1]))&&128==(192&T)&&((N=(15&P)<<12|(63&w)<<6|63&T)<=2047||N>=55296&&N<=57343)&&(N=null)):4===F&&(T=s[v+2],S=s[v+3],128==(192&(w=s[v+1]))&&128==(192&T)&&128==(192&S)&&((N=(15&P)<<18|(63&w)<<12|(63&T)<<6|63&S)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,F=1):N>65535&&(N-=65536,g+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),g+=String.fromCharCode(N),v+=F}return g}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==Vi.Bytes)return o.push(this.readVarint(i));var s=_l(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==Vi.Bytes)return o.push(this.readSVarint());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Vi.Bytes)return o.push(this.readBoolean());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Vi.Bytes)return o.push(this.readFloat());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Vi.Bytes)return o.push(this.readDouble());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Vi.Bytes)return o.push(this.readFixed32());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Vi.Bytes)return o.push(this.readSFixed32());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Vi.Bytes)return o.push(this.readFixed64());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Vi.Bytes)return o.push(this.readSFixed64());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===Vi.Varint)for(;this.buf[this.pos++]>127;);else if(i===Vi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Vi.Fixed32)this.pos+=4;else{if(i!==Vi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),ih(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),ih(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),ih(this.buf,-1&o,this.pos),ih(this.buf,Math.floor(o*qg),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),ih(this.buf,-1&o,this.pos),ih(this.buf,Math.floor(o*qg),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,s){var c,p,g,w;if(i>=0?(c=i%4294967296|0,p=i/4294967296|0):(p=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,p=p+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),g=c,(w=s).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(c,p,g){for(var v,w,T=0;T<p.length;T++){if((v=p.charCodeAt(T))>55295&&v<57344){if(!w){v>56319||T+1===p.length?(c[g++]=239,c[g++]=191,c[g++]=189):w=v;continue}if(v<56320){c[g++]=239,c[g++]=191,c[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(c[g++]=239,c[g++]=191,c[g++]=189,w=null);v<128?c[g++]=v:(v<2048?c[g++]=v>>6|192:(v<65536?c[g++]=v>>12|224:(c[g++]=v>>18|240,c[g++]=v>>12&63|128),c[g++]=v>>6&63|128),c[g++]=63&v|128)}return g}(this.buf,o,this.pos);var s=this.pos-i;s>=128&&Pv(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Av(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Av(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var s=0;s<i;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,i){this.pos++;var s=this.pos;o(i,this);var c=this.pos-s;c>=128&&Pv(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,i,s){this.writeTag(o,Vi.Bytes),this.writeRawMessage(i,s)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,db,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,VE,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,pb,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,fb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,Zg,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,ld,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,em,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,Wg,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,Rv,i)},writeBytesField:function(o,i){this.writeTag(o,Vi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,Vi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,Vi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,Vi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,Vi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,Vi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,Vi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,Vi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,Vi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,Vi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var tm=he(Gg);const Yg=3;function mb(o,i,s){i.glyphs=[],1===o&&s.readMessage(gb,i)}function gb(o,i,s){if(3===o){const{id:c,bitmap:p,width:g,height:v,left:w,top:T,advance:S}=s.readMessage(_b,{});i.glyphs.push({id:c,bitmap:new Pc({width:g+2*Yg,height:v+2*Yg},p),metrics:{width:g,height:v,left:w,top:T,advance:S}})}else 4===o?i.ascender=s.readSVarint():5===o&&(i.descender=s.readSVarint())}function _b(o,i,s){1===o?i.id=s.readVarint():2===o?i.bitmap=s.readBytes():3===o?i.width=s.readVarint():4===o?i.height=s.readVarint():5===o?i.left=s.readSVarint():6===o?i.top=s.readSVarint():7===o&&(i.advance=s.readVarint())}const Rc=Yg;function rh(o){let i=0,s=0;for(const v of o)i+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,w)=>w.h-v.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let p=0,g=0;for(const v of o)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===T.w&&v.h===T.h){const S=c.pop();w<c.length&&(c[w]=S)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(c.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:p,h:g,fill:i/(p*g)||0}}const fs=1;class Lv{constructor(i,{pixelRatio:s,version:c,stretchX:p,stretchY:g,content:v}){this.paddedRect=i,this.pixelRatio=s,this.stretchX=p,this.stretchY=g,this.content=v,this.version=c}get tl(){return[this.paddedRect.x+fs,this.paddedRect.y+fs]}get br(){return[this.paddedRect.x+this.paddedRect.w-fs,this.paddedRect.y+this.paddedRect.h-fs]}get displaySize(){return[(this.paddedRect.w-2*fs)/this.pixelRatio,(this.paddedRect.h-2*fs)/this.pixelRatio]}}class yb{constructor(i,s){const c={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,c,g),this.addImages(s,p,g);const{w:v,h:w}=rh(g),T=new Ss({width:v||1,height:w||1});for(const S in i){const P=i[S],N=c[S].paddedRect;Ss.copy(P.data,T,{x:0,y:0},{x:N.x+fs,y:N.y+fs},P.data)}for(const S in s){const P=s[S],N=p[S].paddedRect,F=N.x+fs,V=N.y+fs,j=P.data.width,q=P.data.height;Ss.copy(P.data,T,{x:0,y:0},{x:F,y:V},P.data),Ss.copy(P.data,T,{x:0,y:q-1},{x:F,y:V-1},{width:j,height:1}),Ss.copy(P.data,T,{x:0,y:0},{x:F,y:V+q},{width:j,height:1}),Ss.copy(P.data,T,{x:j-1,y:0},{x:F-1,y:V},{width:1,height:q}),Ss.copy(P.data,T,{x:0,y:0},{x:F+j,y:V},{width:1,height:q})}this.image=T,this.iconPositions=c,this.patternPositions=p}addImages(i,s,c){for(const p in i){const g=i[p],v={x:0,y:0,w:g.data.width+2*fs,h:g.data.height+2*fs};c.push(v),s[p]=new Lv(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>i.hasImage(c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),s)}patchUpdatedImage(i,s,c){if(!i||!s||i.version===s.version)return;i.version=s.version;const[p,g]=i.tl;c.update(s.data,void 0,{x:p,y:g})}}Qt(Lv,"ImagePosition"),Qt(yb,"ImageAtlas");const Ha={horizontal:1,vertical:2,horizontalOnly:3},vb=-17;class nm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,s){const c=new nm;return c.scale=i||1,c.fontStack=s,c}static forImage(i){const s=new nm;return s.imageName=i,s}}class oh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s){const c=new oh;for(let p=0;p<i.sections.length;p++){const g=i.sections[p];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(s,c){let p="";for(let g=0;g<s.length;g++){const v=s.charCodeAt(g+1)||null,w=s.charCodeAt(g-1)||null;p+=!c&&(v&&Zd(v)&&!nh[s[g+1]]||w&&Zd(w)&&!nh[s[g-1]])||!nh[s[g]]?s[g]:nh[s[g]]}return p}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&im[this.text.charCodeAt(c)];c++)i++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&im[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const c=new oh;return c.text=this.text.substring(i,s),c.sectionIndex=this.sectionIndex.slice(i,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(nm.forText(i.scale,i.fontStack||s));const c=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(c)}addImageSection(i){const s=i.image?i.image.name:"";if(0===s.length)return void Yi("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(nm.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Yi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kg(o,i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=oh.fromFeature(o,p);N===Ha.vertical&&q.verticalizePunctuation(F);let J=[];const se=function(me,Ge,je,ot,wt,Xe){if(!me)return[];const ht=[],ct=function(jt,nn,$t,Bn,Rt,_n){let Vn=0;for(let gi=0;gi<jt.length();gi++){const Hn=jt.getSection(gi);Vn+=kv(jt.getCharCode(gi),Hn,Bn,Rt,nn,_n)}return Vn/Math.max(1,Math.ceil(Vn/$t))}(me,Ge,je,ot,wt,Xe),_t=me.text.indexOf("\u200b")>=0;let At=0;for(let jt=0;jt<me.length();jt++){const nn=me.getSection(jt),$t=me.getCharCode(jt);if(im[$t]||(At+=kv($t,nn,ot,wt,Ge,Xe)),jt<me.length()-1){const Bn=!((nt=$t)<11904||!(Ht["Bopomofo Extended"](nt)||Ht.Bopomofo(nt)||Ht["CJK Compatibility Forms"](nt)||Ht["CJK Compatibility Ideographs"](nt)||Ht["CJK Compatibility"](nt)||Ht["CJK Radicals Supplement"](nt)||Ht["CJK Strokes"](nt)||Ht["CJK Symbols and Punctuation"](nt)||Ht["CJK Unified Ideographs Extension A"](nt)||Ht["CJK Unified Ideographs"](nt)||Ht["Enclosed CJK Letters and Months"](nt)||Ht["Halfwidth and Fullwidth Forms"](nt)||Ht.Hiragana(nt)||Ht["Ideographic Description Characters"](nt)||Ht["Kangxi Radicals"](nt)||Ht["Katakana Phonetic Extensions"](nt)||Ht.Katakana(nt)||Ht["Vertical Forms"](nt)||Ht["Yi Radicals"](nt)||Ht["Yi Syllables"](nt)));(xb[$t]||Bn||nn.imageName)&&ht.push(cd(jt+1,At,ct,ht,Lc($t,me.getCharCode(jt+1),Bn&&_t),!1))}}var nt;return Jg(cd(me.length(),At,ct,ht,0,!0))}(q,S,g,i,c,V),{processBidirectionalText:pe,processStyledBidirectionalText:ae}=A;if(pe&&1===q.sections.length){const me=pe(q.toString(),se);for(const Ge of me){const je=new oh;je.text=Ge,je.sections=q.sections;for(let ot=0;ot<Ge.length;ot++)je.sectionIndex.push(0);J.push(je)}}else if(ae){const me=ae(q.text,q.sectionIndex,se);for(const Ge of me){const je=new oh;je.text=Ge[0],je.sectionIndex=Ge[1],je.sections=q.sections,J.push(je)}}else J=function(me,Ge){const je=[],ot=me.text;let wt=0;for(const Xe of Ge)je.push(me.substring(wt,Xe)),wt=Xe;return wt<ot.length&&je.push(me.substring(wt,ot.length)),je}(q,se);const de=[],ge={positionedLines:de,text:q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,Ge,je,ot,wt,Xe,ht,ct,_t,At,nt,jt){let nn=0,$t=0,Bn=0;const Rt="right"===ct?1:"left"===ct?0:.5;let _n=!1;for(const Wn of wt){const Fn=Wn.getSections();for(const Di of Fn){if(Di.imageName)continue;const Oi=Ge[Di.fontStack];if(Oi&&(_n=void 0!==Oi.ascender&&void 0!==Oi.descender,!_n))break}if(!_n)break}let Vn=0;for(const Wn of wt){Wn.trim();const Fn=Wn.getMaxScale(),Di=(Fn-1)*fo,Oi={positionedGlyphs:[],lineOffset:0};me.positionedLines[Vn]=Oi;const ji=Oi.positionedGlyphs;let Mi=0;if(!Wn.length()){$t+=Xe,++Vn;continue}let hr=0,pn=0;for(let Si=0;Si<Wn.length();Si++){const et=Wn.getSection(Si),Ir=Wn.getSectionIndex(Si),wr=Wn.getCharCode(Si);let ai=et.scale,dr=null,Ii=null,po=null,Ar=fo,eo=0;const Hr=!(_t===Ha.horizontal||!nt&&!fp(wr)||nt&&(im[wr]||(gi=wr,Ht.Arabic(gi)||Ht["Arabic Supplement"](gi)||Ht["Arabic Extended-A"](gi)||Ht["Arabic Presentation Forms-A"](gi)||Ht["Arabic Presentation Forms-B"](gi))));if(et.imageName){const Mo=ot[et.imageName];if(!Mo)continue;po=et.imageName,me.iconsInText=me.iconsInText||!0,Ii=Mo.paddedRect;const to=Mo.displaySize;ai=ai*fo/jt,dr={width:to[0],height:to[1],left:fs,top:-Rc,advance:Hr?to[1]:to[0],localGlyph:!1},eo=_n?-dr.height*ai:vb+Fn*fo-to[1]*ai,Ar=dr.advance;const ha=(Hr?to[0]:to[1])*ai-fo*Fn;ha>0&&ha>Mi&&(Mi=ha)}else{const Mo=je[et.fontStack];if(!Mo)continue;Mo[wr]&&(Ii=Mo[wr]);const to=Ge[et.fontStack];if(!to)continue;const ha=to.glyphs[wr];if(!ha)continue;if(dr=ha.metrics,Ar=8203!==wr?fo:0,_n){const bd=void 0!==to.ascender?Math.abs(to.ascender):0,$f=void 0!==to.descender?Math.abs(to.descender):0,Hf=(bd+$f)*ai;hr<Hf&&(hr=Hf,pn=(bd-$f)/2*ai),eo=-bd*ai}else eo=vb+(Fn-ai)*fo}Hr?(me.verticalizable=!0,ji.push({glyph:wr,imageName:po,x:nn,y:$t+eo,vertical:Hr,scale:ai,localGlyph:dr.localGlyph,fontStack:et.fontStack,sectionIndex:Ir,metrics:dr,rect:Ii}),nn+=Ar*ai+At):(ji.push({glyph:wr,imageName:po,x:nn,y:$t+eo,vertical:Hr,scale:ai,localGlyph:dr.localGlyph,fontStack:et.fontStack,sectionIndex:Ir,metrics:dr,rect:Ii}),nn+=dr.advance*ai+At)}0!==ji.length&&(Bn=Math.max(nn-At,Bn),_n?Qg(ji,Rt,Mi,pn,Xe*Fn/2):Qg(ji,Rt,Mi,0,Xe/2)),nn=0;const st=Xe*Fn+Mi;Oi.lineOffset=Math.max(Mi,Di),$t+=st,++Vn}var gi;const Hn=$t,{horizontalAlign:En,verticalAlign:Ui}=om(ht);(function(Wn,Fn,Di,Oi,ji,Mi){const hr=(Fn-Di)*ji,pn=-Mi*Oi;for(const st of Wn)for(const Si of st.positionedGlyphs)Si.x+=hr,Si.y+=pn})(me.positionedLines,Rt,En,Ui,Bn,Hn),me.top+=-Ui*Hn,me.bottom=me.top+Hn,me.left+=-En*Bn,me.right=me.left+Bn,me.hasBaseline=_n}(ge,i,s,c,J,v,w,T,N,S,F,j),!function(me){for(const Ge of me)if(0!==Ge.positionedGlyphs.length)return!1;return!0}(de)&&ge}const im={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kv(o,i,s,c,p,g){if(i.imageName){const v=c[i.imageName];return v?v.displaySize[0]*i.scale*fo/g+p:0}{const v=s[i.fontStack],w=v&&v.glyphs[o];return w?w.metrics.advance*i.scale+p:0}}function rm(o,i,s,c){const p=Math.pow(o-i,2);return c?o<i?p/2:2*p:p+Math.abs(s)*s}function Lc(o,i,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==i&&65289!==i||(c+=50),c}function cd(o,i,s,c,p,g){let v=null,w=rm(i,s,p,g);for(const T of c){const S=rm(i-T.x,s,p,g)+T.badness;S<=w&&(v=T,w=S)}return{index:o,x:i,priorBreak:v,badness:w}}function Jg(o){return o?Jg(o.priorBreak).concat(o.index):[]}function om(o){let i=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function Qg(o,i,s,c,p){if(!(i||s||c||p))return;const g=o.length-1,v=o[g],w=(v.x+v.metrics.advance*v.scale)*i;for(let T=0;T<=g;T++)o[T].x-=w,o[T].y+=s+c+p}function UE(o,i,s){const{horizontalAlign:c,verticalAlign:p}=om(s),g=i[0]-o.displaySize[0]*c,v=i[1]-o.displaySize[1]*p;return{image:o,top:v,bottom:v+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function bb(o,i,s,c,p,g){const v=o.image;let w;if(v.content){const J=v.content,se=v.pixelRatio||1;w=[J[0]/se,J[1]/se,v.displaySize[0]-J[2]/se,v.displaySize[1]-J[3]/se]}const T=i.left*g,S=i.right*g;let P,N,F,V;"width"===s||"both"===s?(V=p[0]+T-c[3],N=p[0]+S+c[1]):(V=p[0]+(T+S-v.displaySize[0])/2,N=V+v.displaySize[0]);const j=i.top*g,q=i.bottom*g;return"height"===s||"both"===s?(P=p[1]+j-c[0],F=p[1]+q+c[2]):(P=p[1]+(j+q-v.displaySize[1])/2,F=P+v.displaySize[1]),{image:v,top:P,right:N,bottom:F,left:V,collisionPadding:w}}class cu extends Fe{constructor(i,s,c,p,g){super(i,s),this.angle=p,this.z=c,void 0!==g&&(this.segment=g)}clone(){return new cu(this.x,this.y,this.z,this.angle,this.segment)}}function sm(o,i,s,c,p){if(void 0===i.segment)return!0;let g=i,v=i.segment+1,w=0;for(;w>-s/2;){if(v--,v<0)return!1;w-=o[v].dist(g),g=o[v]}w+=o[v].dist(o[v+1]),v++;const T=[];let S=0;for(;w<s/2;){const P=o[v],N=o[v+1];if(!N)return!1;let F=o[v-1].angleTo(P)-P.angleTo(N);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:F}),S+=F;w-T[0].distance>c;)S-=T.shift().angleDelta;if(S>p)return!1;v++,w+=P.dist(N)}return!0}function am(o){let i=0;for(let s=0;s<o.length-1;s++)i+=o[s].dist(o[s+1]);return i}function wb(o,i,s){return o?.6*i*s:0}function Eb(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Ov(o,i,s,c,p,g){const v=wb(s,p,g),w=Eb(s,c)*g;let T=0;const S=am(o)/2;for(let P=0;P<o.length-1;P++){const N=o[P],F=o[P+1],V=N.dist(F);if(T+V>S){const j=(S-T)/V,q=si(N.x,F.x,j),J=si(N.y,F.y,j),se=new cu(q,J,0,F.angleTo(N),P);return!v||sm(o,se,w,v,i)?se:void 0}T+=V}}function Cb(o,i,s,c,p,g,v,w,T){const S=wb(c,g,v),P=Eb(c,p),N=P*v,F=0===o[0].x||o[0].x===T||0===o[0].y||o[0].y===T;return i-N<i/4&&(i=N+i/4),Nv(o,F?i/2*w%i:(P/2+2*g)*v*w%i,i,S,s,N,F,!1,T)}function Nv(o,i,s,c,p,g,v,w,T){const S=g/2,P=am(o);let N=0,F=i-s,V=[];for(let j=0;j<o.length-1;j++){const q=o[j],J=o[j+1],se=q.dist(J),pe=J.angleTo(q);for(;F+s<N+se;){F+=s;const ae=(F-N)/se,de=si(q.x,J.x,ae),ge=si(q.y,J.y,ae);if(de>=0&&de<T&&ge>=0&&ge<T&&F-S>=0&&F+S<=P){const me=new cu(de,ge,0,pe,j);me._round(),c&&!sm(o,me,g,c,p)||V.push(me)}}N+=se}return w||V.length||v||(V=Nv(o,N/2,s,c,p,g,v,!0,T)),V}function Fv(o,i,s,c,p){const g=[];for(let v=0;v<o.length;v++){const w=o[v];let T;for(let S=0;S<w.length-1;S++){let P=w[S],N=w[S+1];P.x<i&&N.x<i||(P.x<i?P=new Fe(i,P.y+(i-P.x)/(N.x-P.x)*(N.y-P.y))._round():N.x<i&&(N=new Fe(i,P.y+(i-P.x)/(N.x-P.x)*(N.y-P.y))._round()),P.y<s&&N.y<s||(P.y<s?P=new Fe(P.x+(s-P.y)/(N.y-P.y)*(N.x-P.x),s)._round():N.y<s&&(N=new Fe(P.x+(s-P.y)/(N.y-P.y)*(N.x-P.x),s)._round()),P.x>=c&&N.x>=c||(P.x>=c?P=new Fe(c,P.y+(c-P.x)/(N.x-P.x)*(N.y-P.y))._round():N.x>=c&&(N=new Fe(c,P.y+(c-P.x)/(N.x-P.x)*(N.y-P.y))._round()),P.y>=p&&N.y>=p||(P.y>=p?P=new Fe(P.x+(p-P.y)/(N.y-P.y)*(N.x-P.x),p)._round():N.y>=p&&(N=new Fe(P.x+(p-P.y)/(N.y-P.y)*(N.x-P.x),p)._round()),T&&P.equals(T[T.length-1])||(T=[P],g.push(T)),T.push(N)))))}}return g}Qt(cu,"Anchor");const Df=1e20;function e_(o,i,s,c,p,g,v,w,T){for(let S=i;S<i+c;S++)Mf(o,s*g+S,g,p,v,w,T);for(let S=s;S<s+p;S++)Mf(o,S*g+i,1,c,v,w,T)}function Mf(o,i,s,c,p,g,v){g[0]=0,v[0]=-Df,v[1]=Df,p[0]=o[i];for(let w=1,T=0,S=0;w<c;w++){p[w]=o[i+w*s];const P=w*w;do{const N=g[T];S=(p[w]-p[N]+P-N*N)/(w-N)/2}while(S<=v[T]&&--T>-1);T++,g[T]=w,v[T]=S,v[T+1]=Df}for(let w=0,T=0;w<c;w++){for(;v[T+1]<w;)T++;const S=g[T],P=w-S;o[i+w*s]=p[S]+P*P}}const vl=2,Sf={none:0,ideographs:1,all:2};class ud{constructor(i,s,c){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,s){const c=[];for(const p in i)for(const g of i[p])c.push({stack:p,id:g});dn(c,({stack:p,id:g},v)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(void 0!==T)return void v(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(w,p,g),T)return w.glyphs[g]=T,void v(null,{stack:p,id:g,glyph:T});const S=Math.floor(g/256);if(256*S>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[S])return void v(null,{stack:p,id:g,glyph:T});let P=w.requests[S];P||(P=w.requests[S]=[],ud.loadGlyphRange(p,S,this.url,this.requestManager,(N,F)=>{if(F){w.ascender=F.ascender,w.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=F.glyphs[+V]);w.ranges[S]=!0}for(const V of P)V(N,F);delete w.requests[S]})),P.push((N,F)=>{N?v(N):F&&v(null,{stack:p,id:g,glyph:F.glyphs[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const v={};for(const{stack:w,id:T,glyph:S}of g)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[T]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;s(null,v)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Sf.none&&(this.localGlyphMode===Sf.all?!!this.localFontFamily:!!this.localFontFamily&&(Ht["CJK Unified Ideographs"](i)||Ht["Hangul Syllables"](i)||Ht.Hiragana(i)||Ht.Katakana(i)||Ht["CJK Symbols and Punctuation"](i)))}_tinySDF(i,s,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=i.tinySDF;if(!g){let q="400";/bold/i.test(s)?q="900":/medium/i.test(s)?q="500":/light/i.test(s)&&(q="200"),g=i.tinySDF=new ud.TinySDF({fontFamily:p,fontWeight:q,fontSize:24*vl,buffer:3*vl,radius:8*vl}),g.fontWeight=q}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const v=String.fromCharCode(c),{data:w,width:T,height:S,glyphWidth:P,glyphHeight:N,glyphLeft:F,glyphTop:V,glyphAdvance:j}=g.draw(v);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Pc({width:T,height:S},w),metrics:{width:P/vl,height:N/vl,left:F/vl,top:V/vl-27,advance:j/vl,localGlyph:!0}}}}ud.loadGlyphRange=function(o,i,s,c,p){const g=256*i,v=g+255,w=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${v}`),Ja.Glyphs);Qa(w,(T,S)=>{if(T)p(T);else if(S){const P={},N=new tm(S).readFields(mb,{});for(const F of N.glyphs)P[F.id]=F;p(null,{glyphs:P,ascender:N.ascender,descender:N.descender})}})},ud.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=s;const w=this.size=o+4*i,T=this._createCanvas(w),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${v} ${g} ${o}px ${p}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(o),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),T=Math.min(this.size-this.buffer,v+Math.ceil(c)),S=w+2*this.buffer,P=T+2*this.buffer,N=Math.max(S*P,0),F=new Uint8ClampedArray(N),V={data:F,width:S,height:P,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:i};if(0===w||0===T)return V;const{ctx:j,buffer:q,gridInner:J,gridOuter:se}=this;j.clearRect(q,q,w,T),j.fillText(o,q,q+v);const pe=j.getImageData(q,q,w,T);se.fill(Df,0,N),J.fill(0,0,N);for(let ae=0;ae<T;ae++)for(let de=0;de<w;de++){const ge=pe.data[4*(ae*w+de)+3]/255;if(0===ge)continue;const me=(ae+q)*S+de+q;if(1===ge)se[me]=0,J[me]=Df;else{const Ge=.5-ge;se[me]=Ge>0?Ge*Ge:0,J[me]=Ge<0?Ge*Ge:0}}e_(se,0,0,S,P,S,this.f,this.v,this.z),e_(J,q,q,w,T,S,this.f,this.v,this.z);for(let ae=0;ae<N;ae++){const de=Math.sqrt(se[ae])-Math.sqrt(J[ae]);F[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return V}};const xl=fs;function zv(o,i,s,c){const p=[],g=o.image,v=g.pixelRatio,w=g.paddedRect.w-2*xl,T=g.paddedRect.h-2*xl,S=o.right-o.left,P=o.bottom-o.top,N=g.stretchX||[[0,w]],F=g.stretchY||[[0,T]],V=(Xe,ht)=>Xe+ht[1]-ht[0],j=N.reduce(V,0),q=F.reduce(V,0),J=w-j,se=T-q;let pe=0,ae=j,de=0,ge=q,me=0,Ge=J,je=0,ot=se;if(g.content&&c){const Xe=g.content;pe=lm(N,0,Xe[0]),de=lm(F,0,Xe[1]),ae=lm(N,Xe[0],Xe[2]),ge=lm(F,Xe[1],Xe[3]),me=Xe[0]-pe,je=Xe[1]-de,Ge=Xe[2]-Xe[0]-ae,ot=Xe[3]-Xe[1]-ge}const wt=(Xe,ht,ct,_t)=>{const At=If(Xe.stretch-pe,ae,S,o.left),nt=um(Xe.fixed-me,Ge,Xe.stretch,j),jt=If(ht.stretch-de,ge,P,o.top),nn=um(ht.fixed-je,ot,ht.stretch,q),$t=If(ct.stretch-pe,ae,S,o.left),Bn=um(ct.fixed-me,Ge,ct.stretch,j),Rt=If(_t.stretch-de,ge,P,o.top),_n=um(_t.fixed-je,ot,_t.stretch,q),Vn=new Fe(At,jt),gi=new Fe($t,jt),Hn=new Fe($t,Rt),En=new Fe(At,Rt),Ui=new Fe(nt/v,nn/v),Wn=new Fe(Bn/v,_n/v),Fn=i*Math.PI/180;if(Fn){const ji=Math.sin(Fn),Mi=Math.cos(Fn),hr=[Mi,-ji,ji,Mi];Vn._matMult(hr),gi._matMult(hr),En._matMult(hr),Hn._matMult(hr)}const Di=Xe.stretch+Xe.fixed,Oi=ht.stretch+ht.fixed;return{tl:Vn,tr:gi,bl:En,br:Hn,tex:{x:g.paddedRect.x+xl+Di,y:g.paddedRect.y+xl+Oi,w:ct.stretch+ct.fixed-Di,h:_t.stretch+_t.fixed-Oi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ui,pixelOffsetBR:Wn,minFontScaleX:Ge/v/S,minFontScaleY:ot/v/P,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const Xe=cm(N,J,j),ht=cm(F,se,q);for(let ct=0;ct<Xe.length-1;ct++){const _t=Xe[ct],At=Xe[ct+1];for(let nt=0;nt<ht.length-1;nt++)p.push(wt(_t,ht[nt],At,ht[nt+1]))}}else p.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return p}function lm(o,i,s){let c=0;for(const p of o)c+=Math.max(i,Math.min(s,p[1]))-Math.max(i,Math.min(s,p[0]));return c}function cm(o,i,s){const c=[{fixed:-xl,stretch:0}];for(const[p,g]of o){const v=c[c.length-1];c.push({fixed:p-v.stretch,stretch:v.stretch}),c.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return c.push({fixed:i+xl,stretch:s}),c}function If(o,i,s,c){return o/i*s+c}function um(o,i,s,c){return o-i*s/c}function Tb(o,i,s,c){const p=i+o.positionedLines[c].lineOffset;return 0===c?s+p/2:s+(p+(i+o.positionedLines[c-1].lineOffset))/2}class Db{constructor(i=[],s=Mb){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:c}=this,p=s[i];for(;i>0;){const g=i-1>>1,v=s[g];if(c(p,v)>=0)break;s[i]=v,i=g}s[i]=p}_down(i){const{data:s,compare:c}=this,p=this.length>>1,g=s[i];for(;i<p;){let v=1+(i<<1),w=s[v];const T=v+1;if(T<this.length&&c(s[T],w)<0&&(v=T,w=s[T]),c(w,g)>=0)break;s[i]=w,i=v}s[i]=g}}function Mb(o,i){return o<i?-1:o>i?1:0}function Bv(o,i=1,s=!1){let c=1/0,p=1/0,g=-1/0,v=-1/0;const w=o[0];for(let V=0;V<w.length;V++){const j=w[V];(!V||j.x<c)&&(c=j.x),(!V||j.y<p)&&(p=j.y),(!V||j.x>g)&&(g=j.x),(!V||j.y>v)&&(v=j.y)}const T=Math.min(g-c,v-p);let S=T/2;const P=new Db([],jE);if(0===T)return new Fe(c,p);for(let V=c;V<g;V+=T)for(let j=p;j<v;j+=T)P.push(new Af(V+S,j+S,S,o));let N=function(V){let j=0,q=0,J=0;const se=V[0];for(let pe=0,ae=se.length,de=ae-1;pe<ae;de=pe++){const ge=se[pe],me=se[de],Ge=ge.x*me.y-me.x*ge.y;q+=(ge.x+me.x)*Ge,J+=(ge.y+me.y)*Ge,j+=3*Ge}return new Af(q/j,J/j,0,V)}(o),F=P.length;for(;P.length;){const V=P.pop();(V.d>N.d||!N.d)&&(N=V,s&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-N.d<=i||(S=V.h/2,P.push(new Af(V.p.x-S,V.p.y-S,S,o)),P.push(new Af(V.p.x+S,V.p.y-S,S,o)),P.push(new Af(V.p.x-S,V.p.y+S,S,o)),P.push(new Af(V.p.x+S,V.p.y+S,S,o)),F+=4)}return s&&(console.log(`num probes: ${F}`),console.log(`best distance: ${N.d}`)),N.p}function jE(o,i){return i.max-o.max}class Af{constructor(i,s,c,p){this.p=new Fe(i,s),this.h=c,this.d=function(g,v){let w=!1,T=1/0;for(let S=0;S<v.length;S++){const P=v[S];for(let N=0,F=P.length,V=F-1;N<F;V=N++){const j=P[N],q=P[V];j.y>g.y!=q.y>g.y&&g.x<(q.x-j.x)*(g.y-j.y)/(q.y-j.y)+j.x&&(w=!w),T=Math.min(T,Zu(g,j,q))}}return(w?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Yl=7,sh=Number.POSITIVE_INFINITY,Vv=Math.sqrt(2);function t_(o,[i,s]){let c=0,p=0;if(s===sh){i<0&&(i=0);const g=i/Vv;switch(o){case"top-right":case"top-left":p=g-Yl;break;case"bottom-right":case"bottom-left":p=-g+Yl;break;case"bottom":p=-i+Yl;break;case"top":p=i-Yl}switch(o){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=i;break;case"right":c=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),o){case"top-right":case"top-left":case"top":p=s-Yl;break;case"bottom-right":case"bottom-left":case"bottom":p=-s+Yl}switch(o){case"top-right":case"bottom-right":case"right":c=-i;break;case"top-left":case"bottom-left":case"left":c=i}}return[c,p]}function n_(o,i,s,c,p,g,v,w,T,S){o.createArrays(),o.tilePixelRatio=gn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const P=o.layers[0].layout,N=o.layers[0]._unevaluatedLayout._values,F={};if("composite"===o.textSizeData.kind){const{minZoom:q,maxZoom:J}=o.textSizeData;F.compositeTextSizes=[N["text-size"].possiblyEvaluate(new R(q),w),N["text-size"].possiblyEvaluate(new R(J),w)]}if("composite"===o.iconSizeData.kind){const{minZoom:q,maxZoom:J}=o.iconSizeData;F.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new R(q),w),N["icon-size"].possiblyEvaluate(new R(J),w)]}F.layoutTextSize=N["text-size"].possiblyEvaluate(new R(T+1),w),F.layoutIconSize=N["icon-size"].possiblyEvaluate(new R(T+1),w),F.textMaxSize=N["text-size"].possiblyEvaluate(new R(18),w);const V="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),j=P.get("text-size");for(const q of o.features){const J=P.get("text-font").evaluate(q,{},w).join(","),se=j.evaluate(q,{},w),pe=F.layoutTextSize.evaluate(q,{},w),ae=(F.layoutIconSize.evaluate(q,{},w),{horizontal:{},vertical:void 0}),de=q.text;let ge,me=[0,0];if(de){const ot=de.toString(),wt=P.get("text-letter-spacing").evaluate(q,{},w)*fo,Xe=P.get("text-line-height").evaluate(q,{},w)*fo,ht=Ay(ot)?wt:0,ct=P.get("text-anchor").evaluate(q,{},w),_t=P.get("text-variable-anchor");if(!_t){const $t=P.get("text-radial-offset").evaluate(q,{},w);me=$t?t_(ct,[$t*fo,sh]):P.get("text-offset").evaluate(q,{},w).map(Bn=>Bn*fo)}let At=V?"center":P.get("text-justify").evaluate(q,{},w);const nt="point"===P.get("symbol-placement"),jt=nt?P.get("text-max-width").evaluate(q,{},w)*fo:1/0,nn=$t=>{o.allowVerticalPlacement&&dp(ot)&&(ae.vertical=Kg(de,i,s,p,J,jt,Xe,ct,$t,ht,me,Ha.vertical,!0,pe,se))};if(!V&&_t){const $t="auto"===At?_t.map(Rt=>Pf(Rt)):[At];let Bn=!1;for(let Rt=0;Rt<$t.length;Rt++){const _n=$t[Rt];if(!ae.horizontal[_n])if(Bn)ae.horizontal[_n]=ae.horizontal[0];else{const Vn=Kg(de,i,s,p,J,jt,Xe,"center",_n,ht,me,Ha.horizontal,!1,pe,se);Vn&&(ae.horizontal[_n]=Vn,Bn=1===Vn.positionedLines.length)}}nn("left")}else{if("auto"===At&&(At=Pf(ct)),nt||P.get("text-writing-mode").indexOf("horizontal")>=0||!dp(ot)){const $t=Kg(de,i,s,p,J,jt,Xe,ct,At,ht,me,Ha.horizontal,!1,pe,se);$t&&(ae.horizontal[At]=$t)}nn(nt?"left":At)}}let Ge=!1;if(q.icon&&q.icon.name){const ot=c[q.icon.name];ot&&(ge=UE(p[q.icon.name],P.get("icon-offset").evaluate(q,{},w),P.get("icon-anchor").evaluate(q,{},w)),Ge=ot.sdf,void 0===o.sdfIcons?o.sdfIcons=ot.sdf:o.sdfIcons!==ot.sdf&&Yi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ot.pixelRatio!==o.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const je=Ib(ae.horizontal)||ae.vertical;o.iconsInText||(o.iconsInText=!!je&&je.iconsInText),(je||ge)&&Sb(o,q,ae,ge,c,F,pe,0,me,Ge,v,w,S)}g&&o.generateCollisionDebugBuffers(T,o.collisionBoxArray)}function Pf(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sb(o,i,s,c,p,g,v,w,T,S,P,N,F){let V=g.textMaxSize.evaluate(i,{},N);void 0===V&&(V=v);const j=o.layers[0].layout,q=j.get("icon-offset").evaluate(i,{},N),J=Ib(s.horizontal)||s.vertical,se="globe"===F.name,pe=fo,ae=v/pe,de=o.tilePixelRatio*V/pe,ge=(ct=o.overscaling,o.zoom>18&&ct>2&&(ct>>=1),Math.max(gn/(512*ct),1)*j.get("symbol-spacing")),me=j.get("text-padding")*o.tilePixelRatio,Ge=j.get("icon-padding")*o.tilePixelRatio,je=Lt(j.get("text-max-angle")),ot="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),wt="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),Xe=j.get("symbol-placement"),ht=ge/2;var ct;const _t=j.get("icon-text-fit");let At;c&&"none"!==_t&&(o.allowVerticalPlacement&&s.vertical&&(At=bb(c,s.vertical,_t,j.get("icon-text-fit-padding"),q,ae)),J&&(c=bb(c,J,_t,j.get("icon-text-fit-padding"),q,ae)));const nt=(jt,nn,$t)=>{if(nn.x<0||nn.x>=gn||nn.y<0||nn.y>=gn)return;let Bn=null;if(se){const{x:Rt,y:_n,z:Vn}=F.projectTilePoint(nn.x,nn.y,$t);Bn={anchor:new cu(Rt,_n,Vn,0,void 0),up:F.upVector($t,nn.x,nn.y)}}!function(Rt,_n,Vn,gi,Hn,En,Ui,Wn,Fn,Di,Oi,ji,Mi,hr,pn,st,Si,et,Ir,wr,ai,dr,Ii,po,Ar){const eo=Rt.addToLineVertexArray(_n,gi);let Hr,Mo,to,ha,bd,$f,Hf,T_=0,Qv=0,e0=0,t0=0,D_=-1,bm=-1;const El={};let n0=mp("");const mh=Vn?Vn.anchor:_n;let ps=0,M_=0;if(void 0===Fn._unevaluatedLayout.getValue("text-radial-offset")?[ps,M_]=Fn.layout.get("text-offset").evaluate(ai,{},Ar).map(ms=>ms*fo):(ps=Fn.layout.get("text-radial-offset").evaluate(ai,{},Ar)*fo,M_=sh),Rt.allowVerticalPlacement&&Hn.vertical){const ms=Hn.vertical;if(pn)$f=i_(ms),Wn&&(Hf=i_(Wn));else{const Ps=Fn.layout.get("text-rotate").evaluate(ai,{},Ar)+90;to=dd(Di,mh,_n,Oi,ji,Mi,ms,hr,Ps,st),Wn&&(ha=dd(Di,mh,_n,Oi,ji,Mi,Wn,et,Ps))}}if(En){const ms=Fn.layout.get("icon-rotate").evaluate(ai,{},Ar),Ps="none"!==Fn.layout.get("icon-text-fit"),Gf=zv(En,ms,Ii,Ps),I_=Wn?zv(Wn,ms,Ii,Ps):void 0;Mo=dd(Di,mh,_n,Oi,ji,Mi,En,et,ms),T_=4*Gf.length;const A_=Rt.iconSizeData;let gh=null;"source"===A_.kind?(gh=[Is*Fn.layout.get("icon-size").evaluate(ai,{},Ar)],gh[0]>kc&&Yi(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${hd}. Reduce your "icon-size".`)):"composite"===A_.kind&&(gh=[Is*dr.compositeIconSizes[0].evaluate(ai,{},Ar),Is*dr.compositeIconSizes[1].evaluate(ai,{},Ar)],(gh[0]>kc||gh[1]>kc)&&Yi(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${hd}. Reduce your "icon-size".`)),Rt.addSymbols(Rt.icon,Gf,gh,wr,Ir,ai,!1,Vn,_n,eo.lineStartIndex,eo.lineLength,-1,po,Ar),D_=Rt.icon.placedSymbolArray.length-1,I_&&(Qv=4*I_.length,Rt.addSymbols(Rt.icon,I_,gh,wr,Ir,ai,Ha.vertical,Vn,_n,eo.lineStartIndex,eo.lineLength,-1,po,Ar),bm=Rt.icon.placedSymbolArray.length-1)}for(const ms in Hn.horizontal){const Ps=Hn.horizontal[ms];Hr||(n0=mp(Ps.text),pn?bd=i_(Ps):Hr=dd(Di,mh,_n,Oi,ji,Mi,Ps,hr,Fn.layout.get("text-rotate").evaluate(ai,{},Ar),st));const Gf=1===Ps.positionedLines.length;if(e0+=Rf(Rt,Vn,_n,Ps,Ui,Fn,pn,ai,st,eo,Hn.vertical?Ha.horizontal:Ha.horizontalOnly,Gf?Object.keys(Hn.horizontal):[ms],El,D_,dr,po,Ar),Gf)break}Hn.vertical&&(t0+=Rf(Rt,Vn,_n,Hn.vertical,Ui,Fn,pn,ai,st,eo,Ha.vertical,["vertical"],El,bm,dr,po,Ar));let _u=-1;const r0=(ms,Ps)=>ms?Math.max(ms,Ps):Ps;_u=r0(bd,_u),_u=r0($f,_u),_u=r0(Hf,_u);const S_=_u>-1?1:0;Rt.glyphOffsetArray.length>=pu.MAX_GLYPHS&&Yi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ai.sortKey&&Rt.addToSortKeyRanges(Rt.symbolInstances.length,ai.sortKey),Rt.symbolInstances.emplaceBack(mh.x,mh.y,mh.z,_n.x,_n.y,El.right>=0?El.right:-1,El.center>=0?El.center:-1,El.left>=0?El.left:-1,El.vertical>=0?El.vertical:-1,D_,bm,n0,void 0!==Hr?Hr:Rt.collisionBoxArray.length,void 0!==Hr?Hr+1:Rt.collisionBoxArray.length,void 0!==to?to:Rt.collisionBoxArray.length,void 0!==to?to+1:Rt.collisionBoxArray.length,void 0!==Mo?Mo:Rt.collisionBoxArray.length,void 0!==Mo?Mo+1:Rt.collisionBoxArray.length,ha||Rt.collisionBoxArray.length,ha?ha+1:Rt.collisionBoxArray.length,Oi,e0,t0,T_,Qv,S_,0,ps,M_,_u)}(o,nn,Bn,jt,s,c,p,At,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,me,ot,T,0,Ge,wt,q,i,g,S,P,N)};if("line"===Xe)for(const jt of Fv(i.geometry,0,0,gn,gn)){const nn=Cb(jt,ge,je,s.vertical||J,c,pe,de,o.overscaling,gn);for(const $t of nn)J&&r_(o,J.text,ht,$t)||nt(jt,$t,N)}else if("line-center"===Xe){for(const jt of i.geometry)if(jt.length>1){const nn=Ov(jt,je,s.vertical||J,c,pe,de);nn&&nt(jt,nn,N)}}else if("Polygon"===i.type)for(const jt of od(i.geometry,0)){const nn=Bv(jt,16);nt(jt[0],new cu(nn.x,nn.y,0,0,void 0),N)}else if("LineString"===i.type)for(const jt of i.geometry)nt(jt,new cu(jt[0].x,jt[0].y,0,0,void 0),N);else if("Point"===i.type)for(const jt of i.geometry)for(const nn of jt)nt([nn],new cu(nn.x,nn.y,0,0,void 0),N)}const hd=255,kc=hd*Is;function Rf(o,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J){const se=function(de,ge,me,Ge,je,ot,wt,Xe){const ht=[];if(0===ge.positionedLines.length)return ht;const ct=Ge.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,_t=function($t){const Bn=$t[0],Rt=$t[1],_n=Bn*Rt;return _n>0?[Bn,-Rt]:_n<0?[-Bn,Rt]:0===Bn?[Rt,Bn]:[Rt,-Bn]}(me);let At=Math.abs(ge.top-ge.bottom);for(const $t of ge.positionedLines)At-=$t.lineOffset;const nt=ge.positionedLines.length,jt=At/nt;let nn=ge.top-me[1];for(let $t=0;$t<nt;++$t){const Bn=ge.positionedLines[$t];nn=Tb(ge,jt,nn,$t);for(const Rt of Bn.positionedGlyphs){if(!Rt.rect)continue;const _n=Rt.rect||{};let Vn=Rc+1,gi=!0,Hn=1,En=0;if(Rt.imageName){const Ii=wt[Rt.imageName];if(!Ii)continue;if(Ii.sdf){Yi("SDF images are not supported in formatted text and will be ignored.");continue}gi=!1,Hn=Ii.pixelRatio,Vn=fs/Hn}const Ui=(je||Xe)&&Rt.vertical,Wn=Rt.metrics.advance*Rt.scale/2,Fn=Rt.metrics,Di=Rt.rect;if(null===Di)continue;Xe&&ge.verticalizable&&(En=Rt.imageName?Wn-Rt.metrics.width*Rt.scale/2:0);const Oi=je?[Rt.x+Wn,Rt.y]:[0,0];let ji=[0,0],Mi=[0,0],hr=!1;je||(Ui?(Mi=[Rt.x+Wn+_t[0],Rt.y+_t[1]-En],hr=!0):ji=[Rt.x+Wn+me[0],Rt.y+me[1]-En]);const pn=Di.w*Rt.scale/(Hn*(Rt.localGlyph?vl:1)),st=Di.h*Rt.scale/(Hn*(Rt.localGlyph?vl:1));let Si,et,Ir,wr;if(Ui){const Ii=Rt.y-nn,po=new Fe(-Wn,Wn-Ii),Ar=-Math.PI/2,eo=new Fe(...Mi);Si=new Fe(-Wn+ji[0],ji[1]),Si._rotateAround(Ar,po)._add(eo),Si.x+=-Ii+Wn,Si.y-=(Fn.left-Vn)*Rt.scale;const Hr=Rt.imageName?Fn.advance*Rt.scale:fo*Rt.scale,Mo=String.fromCharCode(Rt.glyph);Ef(Mo)?Si.x+=(1-Vn)*Rt.scale:hb(Mo)?Si.x+=Hr-Fn.height*Rt.scale+(-Vn-1)*Rt.scale:Si.x+=Rt.imageName||Fn.width+2*Vn===Di.w&&Fn.height+2*Vn===Di.h?(Hr-st)/2:(Hr-(Fn.height+2*Vn)*Rt.scale)/2,et=new Fe(Si.x,Si.y-pn),Ir=new Fe(Si.x+st,Si.y),wr=new Fe(Si.x+st,Si.y-pn)}else{const Ii=(Fn.left-Vn)*Rt.scale-Wn+ji[0],po=(-Fn.top-Vn)*Rt.scale+ji[1],Ar=Ii+pn,eo=po+st;Si=new Fe(Ii,po),et=new Fe(Ar,po),Ir=new Fe(Ii,eo),wr=new Fe(Ar,eo)}if(ct){let Ii;Ii=je?new Fe(0,0):hr?new Fe(_t[0],_t[1]):new Fe(me[0],me[1]),Si._rotateAround(ct,Ii),et._rotateAround(ct,Ii),Ir._rotateAround(ct,Ii),wr._rotateAround(ct,Ii)}const ai=new Fe(0,0),dr=new Fe(0,0);ht.push({tl:Si,tr:et,bl:Ir,br:wr,tex:_n,writingMode:ge.writingMode,glyphOffset:Oi,sectionIndex:Rt.sectionIndex,isSDF:gi,pixelOffsetTL:ai,pixelOffsetBR:dr,minFontScaleX:0,minFontScaleY:0})}}return ht}(0,c,T,g,v,w,p,o.allowVerticalPlacement),pe=o.textSizeData;let ae=null;"source"===pe.kind?(ae=[Is*g.layout.get("text-size").evaluate(w,{},J)],ae[0]>kc&&Yi(`${o.layerIds[0]}: Value for "text-size" is >= ${hd}. Reduce your "text-size".`)):"composite"===pe.kind&&(ae=[Is*j.compositeTextSizes[0].evaluate(w,{},J),Is*j.compositeTextSizes[1].evaluate(w,{},J)],(ae[0]>kc||ae[1]>kc)&&Yi(`${o.layerIds[0]}: Value for "text-size" is >= ${hd}. Reduce your "text-size".`)),o.addSymbols(o.text,se,ae,T,v,w,P,i,s,S.lineStartIndex,S.lineLength,V,q,J);for(const de of N)F[de]=o.text.placedSymbolArray.length-1;return 4*se.length}function Ib(o){for(const i in o)return o[i];return null}function dd(o,i,s,c,p,g,v,w,T,S){let P=v.top,N=v.bottom,F=v.left,V=v.right;const j=v.collisionPadding;if(j&&(F-=j[0],P-=j[1],V+=j[2],N+=j[3]),T){const q=new Fe(F,P),J=new Fe(V,P),se=new Fe(F,N),pe=new Fe(V,N),ae=Lt(T);let de=new Fe(0,0);S&&(de=new Fe(S[0],S[1])),q._rotateAround(ae,de),J._rotateAround(ae,de),se._rotateAround(ae,de),pe._rotateAround(ae,de),F=Math.min(q.x,J.x,se.x,pe.x),V=Math.max(q.x,J.x,se.x,pe.x),P=Math.min(q.y,J.y,se.y,pe.y),N=Math.max(q.y,J.y,se.y,pe.y)}return o.emplaceBack(i.x,i.y,i.z,s.x,s.y,F,P,V,N,w,c,p,g),o.length-1}function i_(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function r_(o,i,s,c){const p=o.compareText;if(i in p){const g=p[i];for(let v=g.length-1;v>=0;v--)if(c.dist(g[v])<s)return!0}else p[i]=[];return p[i].push(c),!1}function o_(o,i){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,p=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),g=Math.sin(s)*p/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),v=Math.sin(o._pitch)*g+p;return Math.min(1.01*v,p*(1/o._horizonShift))}function uu(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const s=Math.pow(2,-o.z),c=o.x*s,p=(o.x+1)*s,g=o.y*s,v=(o.y+1)*s,w=la(c),T=la(p),S=zo(g),P=zo(v),N=i.project(w,S),F=i.project(T,S),V=i.project(T,P),j=i.project(w,P);let q=Math.min(N.x,F.x,V.x,j.x),J=Math.min(N.y,F.y,V.y,j.y),se=Math.max(N.x,F.x,V.x,j.x),pe=Math.max(N.y,F.y,V.y,j.y);const ae=s/16;function de(me,Ge,je,ot,wt,Xe){const ht=(je+wt)/2,ct=(ot+Xe)/2,_t=i.project(la(ht),zo(ct)),At=Math.max(0,q-_t.x,J-_t.y,_t.x-se,_t.y-pe);q=Math.min(q,_t.x),se=Math.max(se,_t.x),J=Math.min(J,_t.y),pe=Math.max(pe,_t.y),At>ae&&(de(me,_t,je,ot,ht,ct),de(_t,Ge,ht,ct,wt,Xe))}de(N,F,c,g,p,g),de(F,V,p,g,p,v),de(V,j,p,v,c,v),de(j,N,c,v,c,g),q-=ae,J-=ae,se+=ae,pe+=ae;const ge=1/Math.max(se-q,pe-J);return{scale:ge,x:q*ge,y:J*ge,x2:se*ge,y2:pe*ge,projection:i}}const ah=ml(new Float32Array(16));class hu{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new mi(0,0)}projectTilePoint(i,s,c){return{x:i,y:s,z:0}}locationPoint(i,s,c=!0){return i._coordinatePoint(i.locationCoordinate(s),c)}pixelsPerMeter(i,s){return Wl(1,i)*s}pixelSpaceConversion(i,s,c){return 1}farthestPixelDistance(i){return o_(i,i.pixelsPerMeter)}pointCoordinate(i,s,c,p){const g=i.horizonLineFromTop(!1),v=new Fe(s,Math.max(g,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(v,p))}pointCoordinate3D(i,s,c){const p=new Fe(s,c);if(i.elevation)return i.elevation.pointCoordinate(p);{const g=this.pointCoordinate(i,p.x,p.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,s){if(i.elevation)return!this.pointCoordinate3D(i,s.x,s.y);const c=i.horizonLineFromTop();return s.y<c}createInversionMatrix(i,s){return ah}createTileMatrix(i,s,c){let p,g,v;const w=c.canonical,T=ml(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=uu(w,this);p=1,g=S.x+c.wrap*S.scale,v=S.y,Cc(T,T,[p/S.scale,p/S.scale,i.pixelsPerMeter/s])}else p=s/i.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*c.wrap)*p,v=w.y*p;return Hh(T,T,[g,v,0]),Cc(T,T,[p/gn,p/gn,1]),T}upVector(i,s,c){return[0,0,1]}upVectorScale(i,s,c){return{metersToTile:1}}}class s_ extends hu{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,c]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(Lt(s));this.n=(p+Math.sin(Lt(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:c,c:p,r0:g}=this,v=Lt(i-this.center[0]),w=Lt(s),T=Math.sqrt(p-2*c*Math.sin(w))/c;return{x:T*Math.sin(v*c),y:T*Math.cos(v*c)-g,z:0}}unproject(i,s){const{n:c,c:p,r0:g}=this,v=g+s;let w=Math.atan2(i,Math.abs(v))*Math.sign(v);v*c<0&&(w-=Math.PI*Math.sign(i)*Math.sign(v));const T=Lt(this.center[0])*c;w=ir(w,-Math.PI-T,Math.PI-T);const S=Tn(Cn(w/c)+this.center[0],-180,180),P=Math.asin(Tn((p-(i*i+v*v)*c*c)/(2*c),-1,1)),N=Tn(Cn(P),-Bo,Bo);return new mi(S,N)}}const du=1.340264,Lf=-.081106,lh=893e-6,fu=.003796,Qo=Math.sqrt(3)/2;class fd extends hu{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(Qo*Math.sin(s)),p=c*c,g=p*p*p;return{x:.5*(i*Math.cos(c)/(Qo*(du+3*Lf*p+g*(7*lh+9*fu*p)))/Math.PI+.5),y:1-.5*(c*(du+Lf*p+g*(lh+fu*p))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=c*c,g=p*p*p;for(let P,N,F,V=0;V<12&&(N=c*(du+Lf*p+g*(lh+fu*p))-s,F=du+3*Lf*p+g*(7*lh+9*fu*p),P=N/F,c=Tn(c-P,-Math.PI/3,Math.PI/3),p=c*c,g=p*p*p,!(Math.abs(P)<1e-12));++V);const v=Qo*i*(du+3*Lf*p+g*(7*lh+9*fu*p))/Math.cos(c),w=Math.asin(Math.sin(c)/Qo),T=Tn(180*v/Math.PI,-180,180),S=Tn(180*w/Math.PI,-Bo,Bo);return new mi(T,S)}}class a_ extends hu{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const c=360*(i-.5),p=Tn(360*(.5-s),-Bo,Bo);return new mi(c,p)}}const pd=Math.PI/2;function hm(o){return Math.tan((pd+o)/2)}class Uv extends hu{constructor(i){super(i),this.center=i.center||[0,30];const[s,c]=this.parallels=i.parallels||[30,30];let p=Lt(s),g=Lt(c);this.southernCenter=p+g<0,this.southernCenter&&(p=-p,g=-g);const v=Math.cos(p),w=hm(p);this.n=p===g?Math.sin(p):Math.log(v/Math.cos(g))/Math.log(hm(g)/w),this.f=v*Math.pow(hm(p),this.n)/this.n}project(i,s){s=Lt(s),this.southernCenter&&(s=-s),i=Lt(i-this.center[0]);const c=1e-6,{n:p,f:g}=this;g>0?s<-pd+c&&(s=-pd+c):s>pd-c&&(s=pd-c);const v=g/Math.pow(hm(s),p);let w=v*Math.sin(p*i),T=g-v*Math.cos(p*i);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:p}=this,g=p-s,v=Math.sign(g),w=Math.sign(c)*Math.sqrt(i*i+g*g);let T=Math.atan2(i,Math.abs(g))*v;g*c<0&&(T-=Math.PI*Math.sign(i)*v);const S=Tn(Cn(T/c)+this.center[0],-180,180),P=Tn(Cn(2*Math.atan(Math.pow(p/w,1/c))-pd),-Bo,Bo);return new mi(S,this.southernCenter?-P:P)}}class ch extends hu{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:$a(i),y:ds(s),z:0}}unproject(i,s){const c=la(i),p=zo(s);return new mi(c,p)}}const jv=Lt(Bo);class Ab extends hu{project(i,s){const c=(s=Lt(s))*s,p=c*c;return{x:.5*((i=Lt(i))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=25,g=0,v=c*c;do{v=c*c;const S=v*v;g=(c*(1.007226+v*(.015085+S*(.028874*v-.044475-.005916*S)))-s)/(1.007226+v*(.045255+S*(.259866*v-.311325-.005916*11*S))),c=Tn(c-g,-jv,jv)}while(Math.abs(g)>1e-6&&--p>0);v=c*c;const w=Tn(Cn(i/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),T=Cn(c);return new mi(w,T)}}const $v=Lt(Bo);class l_ extends hu{project(i,s){s=Lt(s),i=Lt(i);const c=Math.cos(s),p=2/Math.PI,g=Math.acos(c*Math.cos(i/2)),v=Math.sin(g)/g,w=.5*(i*p+2*c*Math.sin(i/2)/v)||0,T=.5*(s+Math.sin(s)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,s){let c=i=(2*i-.5)*Math.PI,p=s=(2*(1-s)-1)*Math.PI,g=25;const v=1e-6;let w=0,T=0;do{const S=Math.cos(p),P=Math.sin(p),N=2*P*S,F=P*P,V=S*S,j=Math.cos(c/2),q=Math.sin(c/2),J=2*j*q,se=q*q,pe=1-V*j*j,ae=pe?1/pe:0,de=pe?Math.acos(S*j)*Math.sqrt(1/pe):0,ge=.5*(2*de*S*q+2*c/Math.PI)-i,me=.5*(de*P+p)-s,Ge=.5*ae*(V*se+de*S*j*F)+1/Math.PI,je=ae*(J*N/4-de*P*q),ot=.125*ae*(N*q-de*P*V*J),wt=.5*ae*(F*j+de*se*S)+.5,Xe=je*ot-wt*Ge;w=(me*je-ge*wt)/Xe,T=(ge*ot-me*Ge)/Xe,c=Tn(c-w,-Math.PI,Math.PI),p=Tn(p-T,-$v,$v)}while((Math.abs(w)>v||Math.abs(T)>v)&&--g>0);return new mi(Cn(c),Cn(p))}}class kf extends hu{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Lt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:c,cosPhi:p}=this;return{x:Lt(i)*p*c+.5,y:-Math.sin(Lt(s))/p*c+.5,z:0}}unproject(i,s){const{scale:c,cosPhi:p}=this,g=-(s-.5)/c,v=Tn(Cn((i-.5)/c)/p,-180,180),w=Math.asin(Tn(g*p,-1,1)),T=Tn(Cn(w),-Bo,Bo);return new mi(v,T)}}class Pb extends ch{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,c){const p=gl(i,s,c);return gr(p,p,Kh(sa(c))),{x:p[0],y:p[1],z:p[2]}}locationPoint(i,s){const c=Sc(s.lat,s.lng),p=Ko([],c),g=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude;ef(c,c,p,Wl(1,0)*gn*g);const v=ml(new Float64Array(16));return Ec(v,i.pixelMatrix,i.globeMatrix),gr(c,c,v),new Fe(c[0],c[1])}pixelsPerMeter(i,s){return Wl(1,0)*s}pixelSpaceConversion(i,s,c){const p=Wl(1,i)*s,g=si(Wl(1,45)*s,p,c);return this.pixelsPerMeter(i,s)/g}createTileMatrix(i,s,c){const p=Hu(sa(c.canonical));return Ec(new Float64Array(16),i.globeMatrix,p)}createInversionMatrix(i,s){const{center:c}=i,p=Kh(sa(s));return Jd(p,p,Lt(c.lng)),fg(p,p,Lt(c.lat)),Cc(p,p,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(i,s,c,p){return sf(i,s,c,!0)||new lf(0,0)}pointCoordinate3D(i,s,c){const p=this.pointCoordinate(i,s,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(i,s){return!sf(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(p,g){const v=p.cameraToCenterDistance,w=p._centerAltitude*g,T=p._camera,S=p._camera.forward(),P=Tc([],ia([],S,-v),[0,0,w]),N=p.worldSize/(2*Math.PI),F=[0,0,-N],V=p.width/p.height,j=Math.tan(p.fovAboveCenter),q=ia([],T.up(),j),J=ia([],T.right(),j*V),se=Ko([],Tc([],Tc([],S,q),J)),pe=[];let ae;if(new Hy(P,se).closestPointOnSphere(F,N,pe)){const de=Tc([],pe,F),ge=Ms([],de,P);ae=Math.cos(p.fovAboveCenter)*ju(ge)}else{const de=Ms([],P,F),ge=Ms([],F,P);Ko(ge,ge);const me=ju(de)-N;ae=Math.sqrt(me*(me+2*N));const Ge=Math.acos(ae/(N+me))-Math.acos(ra(S,ge));ae*=Math.cos(Ge)}return 1.01*ae}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=ho(i.zoom);if(c>0){const p=o_(i,Wl(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),v=Math.max(i.width,i.height)/i.worldSize*Math.PI;return si(s,p+g*(1-Math.cos(v)),Math.pow(c,10))}return s}upVector(i,s,c){return gl(s,c,i,1)}upVectorScale(i){return{metersToTile:Mp(Ap(sa(i)))}}}function c_(o){const i=o.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new ch(o);case"equirectangular":return new a_(o);case"naturalEarth":return new Ab(o);case"equalEarth":return new fd(o);case"winkelTripel":return new l_(o);case"albers":return s?new kf(o):new s_(o);case"lambertConformalConic":return s?new kf(o):new Uv(o);case"globe":return new Pb(o)}throw new Error(`Invalid projection name: ${o.name}`)}const uh=qp.types,$E=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function u_(o,i,s,c,p,g,v,w,T,S,P,N,F){const V=w?Math.min(kc,Math.round(w[0])):0,j=w?Math.min(kc,Math.round(w[1])):0;o.emplaceBack(i,s,Math.round(32*c),Math.round(32*p),g,v,(V<<1)+(T?1:0),j,16*S,16*P,256*N,256*F)}function Of(o,i,s,c,p,g,v){o.emplaceBack(i,s,c,p,g,v)}function dm(o,i,s,c,p){o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p)}function HE(o){for(const i of o.sections)if(Ry(i.text))return!0;return!1}class Hv{constructor(i){this.layoutVertexArray=new pt,this.indexArray=new Kt,this.programConfigurations=i,this.segments=new Bi,this.dynamicLayoutVertexArray=new xt,this.opacityVertexArray=new un,this.placedSymbolArray=new Xn,this.globeExtVertexArray=new It}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,s,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,BE.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,ub.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,$E,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Kp.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Qt(Hv,"SymbolBuffers");class md{constructor(i,s,c){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Bi,this.collisionVertexArray=new Jn,this.collisionVertexArrayExt=new Kn}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Dv.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Mv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Qt(md,"CollisionBuffers");class pu{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(v=>v.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ml([]),this.placementViewportMatrix=ml([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=th(this.zoom,s["text-size"]),this.iconSizeData=th(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(v=>Ha[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Hv(new Vr(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Hv(new Vr(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ji,this.lineVertexArray=new Bh,this.symbolInstances=new ki}calculateGlyphDependencies(i,s,c,p,g){for(let v=0;v<i.length;v++)if(s[i.charCodeAt(v)]=!0,p&&g){const w=nh[i.charAt(v)];w&&(s[w.charCodeAt(0)]=!0)}}populate(i,s,c,p){const g=this.layers[0],v=g.layout,w="globe"===this.projection.name,T=v.get("text-font"),S=v.get("text-field"),P=v.get("icon-image"),N=("constant"!==S.value.kind||S.value.value instanceof ri&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),F="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,V=v.get("symbol-sort-key");if(this.features=[],!N&&!F)return;const j=s.iconDependencies,q=s.glyphDependencies,J=s.availableImages,se=new R(this.zoom);for(const{feature:pe,id:ae,index:de,sourceLayerIndex:ge}of i){const me=g._featureFilter.needGeometry,Ge=Do(pe,me);if(!g._featureFilter.filter(se,Ge,c))continue;if(me||(Ge.geometry=Ic(pe,c,p)),w&&1!==pe.type&&c.z<=5){const Xe=Ge.geometry,ht=.98078528056,ct=(_t,At)=>ra(gl(_t.x,_t.y,c,1),gl(At.x,At.y,c,1))<ht;for(let _t=0;_t<Xe.length;_t++)Xe[_t]=$x(Xe[_t],ct)}let je,ot;if(N){const Xe=g.getValueAndResolveTokens("text-field",Ge,c,J),ht=ri.factory(Xe);HE(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===E()||this.hasRTLText&&A.isParsed())&&(je=Sv(ht,g,Ge))}if(F){const Xe=g.getValueAndResolveTokens("icon-image",Ge,c,J);ot=Xe instanceof Ro?Xe:Ro.fromString(Xe)}if(!je&&!ot)continue;const wt=this.sortFeaturesByKey?V.evaluate(Ge,{},c):void 0;if(this.features.push({id:ae,text:je,icon:ot,index:de,sourceLayerIndex:ge,geometry:Ge.geometry,properties:pe.properties,type:uh[pe.type],sortKey:wt}),ot&&(j[ot.name]=!0),je){const Xe=T.evaluate(Ge,{},c).join(","),ht="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ha.vertical)>=0;for(const ct of je.sections)if(ct.image)j[ct.image.name]=!0;else{const _t=dp(je.toString()),At=ct.fontStack||Xe,nt=q[At]=q[At]||{};this.calculateGlyphDependencies(ct.text,nt,ht,this.allowVerticalPlacement,_t)}}}"line"===v.get("symbol-placement")&&(this.features=function(pe){const ae={},de={},ge=[];let me=0;function Ge(Xe){ge.push(pe[Xe]),me++}function je(Xe,ht,ct){const _t=de[Xe];return delete de[Xe],de[ht]=_t,ge[_t].geometry[0].pop(),ge[_t].geometry[0]=ge[_t].geometry[0].concat(ct[0]),_t}function ot(Xe,ht,ct){const _t=ae[ht];return delete ae[ht],ae[Xe]=_t,ge[_t].geometry[0].shift(),ge[_t].geometry[0]=ct[0].concat(ge[_t].geometry[0]),_t}function wt(Xe,ht,ct){const _t=ct?ht[0][ht[0].length-1]:ht[0][0];return`${Xe}:${_t.x}:${_t.y}`}for(let Xe=0;Xe<pe.length;Xe++){const ht=pe[Xe],ct=ht.geometry,_t=ht.text?ht.text.toString():null;if(!_t){Ge(Xe);continue}const At=wt(_t,ct),nt=wt(_t,ct,!0);if(At in de&&nt in ae&&de[At]!==ae[nt]){const jt=ot(At,nt,ct),nn=je(At,nt,ge[jt].geometry);delete ae[At],delete de[nt],de[wt(_t,ge[nn].geometry,!0)]=nn,ge[jt].geometry=null}else At in de?je(At,nt,ct):nt in ae?ot(At,nt,ct):(Ge(Xe),ae[At]=me-1,de[nt]=me-1)}return ge.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ae)=>pe.sortKey-ae.sortKey)}update(i,s,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,c,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=c_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const c=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:p,y:g}of s)this.lineVertexArray.emplaceBack(p,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=i.indexArray,J=i.layoutVertexArray,se=i.globeExtVertexArray,pe=i.segments.prepareSegment(4*s.length,J,q,this.canOverlap?v.sortKey:void 0),ae=this.glyphOffsetArray.length,de=pe.vertexLength,ge=this.allowVerticalPlacement&&w===Ha.vertical?Math.PI/2:0,me=v.text&&v.text.sections;for(let je=0;je<s.length;je++){const{tl:ot,tr:wt,bl:Xe,br:ht,tex:ct,pixelOffsetTL:_t,pixelOffsetBR:At,minFontScaleX:nt,minFontScaleY:jt,glyphOffset:nn,isSDF:$t,sectionIndex:Bn}=s[je],Rt=pe.vertexLength,_n=nn[1];if(u_(J,S.x,S.y,ot.x,_n+ot.y,ct.x,ct.y,c,$t,_t.x,_t.y,nt,jt),u_(J,S.x,S.y,wt.x,_n+wt.y,ct.x+ct.w,ct.y,c,$t,At.x,_t.y,nt,jt),u_(J,S.x,S.y,Xe.x,_n+Xe.y,ct.x,ct.y+ct.h,c,$t,_t.x,At.y,nt,jt),u_(J,S.x,S.y,ht.x,_n+ht.y,ct.x+ct.w,ct.y+ct.h,c,$t,At.x,At.y,nt,jt),T){const{x:Vn,y:gi,z:Hn}=T.anchor,[En,Ui,Wn]=T.up;Of(se,Vn,gi,Hn,En,Ui,Wn),Of(se,Vn,gi,Hn,En,Ui,Wn),Of(se,Vn,gi,Hn,En,Ui,Wn),Of(se,Vn,gi,Hn,En,Ui,Wn),dm(i.dynamicLayoutVertexArray,Vn,gi,Hn,ge)}else dm(i.dynamicLayoutVertexArray,S.x,S.y,S.z,ge);q.emplaceBack(Rt,Rt+1,Rt+2),q.emplaceBack(Rt+1,Rt+2,Rt+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nn[0]),je!==s.length-1&&Bn===s[je+1].sectionIndex||i.programConfigurations.populatePaintArrays(J.length,v,v.index,{},V,j,me&&me[Bn])}const Ge=T?T.anchor:S;i.placedSymbolArray.emplaceBack(Ge.x,Ge.y,Ge.z,S.x,S.y,ae,this.glyphOffsetArray.length-ae,de,P,N,S.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,F,0)}_commitLayoutVertex(i,s,c,p,g,v,w){i.emplaceBack(s,c,p,g,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,s,c,p,g,v,w){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=T.vertexLength,P=w.tileAnchorX,N=w.tileAnchorY;for(let V=0;V<4;V++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(s,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Fe(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Fe(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Fe(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new Fe(i.x1,i.y2)),T.vertexLength+=4;const F=c.indexArray;F.emplaceBack(S,S+1),F.emplaceBack(S+1,S+2),F.emplaceBack(S+2,S+3),F.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceTextSize(i,v,s,w);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceIconSize(i,s,v.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}generateCollisionDebugBuffers(i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new md(en,$g.members,co),this.iconCollisionBox=new md(en,$g.members,co);const c=lu(this.iconSizeData,i),p=lu(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,i,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,i,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,i,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,i,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(i,s,c,p){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:p),v=wf(this.textSizeData,i,g)/fo;return this.tilePixelRatio*v}getSymbolInstanceIconSize(i,s,c){const p=this.icon.placedSymbolArray.get(c),g=wf(this.iconSizeData,i,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,s,c){i.emplaceBack(s,-c,-c),i.emplaceBack(s,c,-c),i.emplaceBack(s,c,c),i.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceTextSize(i,v,s,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding)}}_updateIconDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceIconSize(i,s,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding)}}updateCollisionDebugBuffers(i,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=lu(this.iconSizeData,i),p=lu(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,i,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(p,i,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(c,i,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,i,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,c,p,g,v,w,T,S){const P={};if(s<c){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(s);P.textBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.textFeatureIndex=ge}if(p<g){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(p);P.verticalTextBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.verticalTextFeatureIndex=ge}if(v<w){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(v);P.iconBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.iconFeatureIndex=ge}if(T<S){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ge}=i.get(T);P.verticalIconBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},P.verticalIconFeatureIndex=ge}return P}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,s){const c=i.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<p;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(i),c=Math.cos(i),p=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const T=this.symbolInstances.get(w);p.push(0|Math.round(s*T.tileAnchorX+c*T.tileAnchorY)),g.push(T.featureIndex)}return v.sort((w,T)=>p[w]-p[T]||g[T]-g[w]),v}addToSortKeyRanges(i,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&v!==g&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Qt(pu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),pu.MAX_GLYPHS=65535,pu.addDynamicAttributes=dm;const h_=new ce({"symbol-placement":new G(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new G(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new G(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new G(tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new G(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new G(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new G(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new G(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(tt.layout_symbol["icon-size"]),"icon-text-fit":new G(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new G(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(tt.layout_symbol["icon-image"]),"icon-rotate":new ee(tt.layout_symbol["icon-rotate"]),"icon-padding":new G(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new G(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(tt.layout_symbol["icon-offset"]),"icon-anchor":new ee(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new G(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new G(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new G(tt.layout_symbol["text-rotation-alignment"]),"text-field":new ee(tt.layout_symbol["text-field"]),"text-font":new ee(tt.layout_symbol["text-font"]),"text-size":new ee(tt.layout_symbol["text-size"]),"text-max-width":new ee(tt.layout_symbol["text-max-width"]),"text-line-height":new ee(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(tt.layout_symbol["text-letter-spacing"]),"text-justify":new ee(tt.layout_symbol["text-justify"]),"text-radial-offset":new ee(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new G(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new ee(tt.layout_symbol["text-anchor"]),"text-max-angle":new G(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new G(tt.layout_symbol["text-writing-mode"]),"text-rotate":new ee(tt.layout_symbol["text-rotate"]),"text-padding":new G(tt.layout_symbol["text-padding"]),"text-keep-upright":new G(tt.layout_symbol["text-keep-upright"]),"text-transform":new ee(tt.layout_symbol["text-transform"]),"text-offset":new ee(tt.layout_symbol["text-offset"]),"text-allow-overlap":new G(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new G(tt.layout_symbol["text-ignore-placement"]),"text-optional":new G(tt.layout_symbol["text-optional"])});var Nf={paint:new ce({"icon-opacity":new ee(tt.paint_symbol["icon-opacity"]),"icon-color":new ee(tt.paint_symbol["icon-color"]),"icon-halo-color":new ee(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new G(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new G(tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(tt.paint_symbol["text-opacity"]),"text-color":new ee(tt.paint_symbol["text-color"],{runtimeType:fn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ee(tt.paint_symbol["text-halo-color"]),"text-halo-width":new ee(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(tt.paint_symbol["text-halo-blur"]),"text-translate":new G(tt.paint_symbol["text-translate"]),"text-translate-anchor":new G(tt.paint_symbol["text-translate-anchor"])}),layout:h_};class hh{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Ta,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt(hh,"FormatSectionOverride",{omit:["defaultValue"]});class gd extends ql{constructor(i){super(i,Nf)}recalculate(i,s){super.recalculate(i,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const g of c)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,s,c,p){const g=this.layout.get(i).evaluate(s,{},c,p),v=this._unevaluatedLayout._values[i];return v.isDataDriven()||ka(v.value)||!g?g:(w=s.properties,g.replace(/{([^{}]+)}/g,(S,P)=>P in w?String(w[P]):""));var w}createBucket(i){return new pu(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Nf.paint.overridableProperties){if(!gd.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),c=new hh(s),p=new Kr(c,s.property.specification);let g=null;g="constant"===s.value.kind||"source"===s.value.kind?new hl("source",p):new Ul("composite",p,s.value.zoomStops,s.value._interpolationType),this.paint._values[i]=new ne(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&gd.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const c=i.get("text-field"),p=Nf.paint.properties[s];let g=!1;const v=w=>{for(const T of w)if(p.overrides&&p.overrides.hasOverride(T))return void(g=!0)};if("constant"===c.value.kind&&c.value.value instanceof ri)v(c.value.value.sections);else if("source"===c.value.kind){const w=S=>{g||(S instanceof Wr&&ar(S.value)===os?v(S.value.sections):S instanceof Sa?v(S.sections):S.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramConfiguration(i){return new er(this,i)}}var d_={paint:new ce({"background-color":new G(tt.paint_background["background-color"]),"background-pattern":new G(tt.paint_background["background-pattern"]),"background-opacity":new G(tt.paint_background["background-opacity"])})},Ff={paint:new ce({"raster-opacity":new G(tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new G(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new G(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new G(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new G(tt.paint_raster["raster-saturation"]),"raster-contrast":new G(tt.paint_raster["raster-contrast"]),"raster-resampling":new G(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new G(tt.paint_raster["raster-fade-duration"])})};class fm extends ql{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var _d={paint:new ce({"sky-type":new G(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new G(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new G(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new G(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new G(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new le(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new G(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new G(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new G(tt.paint_sky["sky-opacity"])})};function zf(o,i,s){const c=[0,0,1],p=$u([]);return jy(p,p,s?-Lt(o)+Math.PI:Lt(o)),qh(p,p,-Lt(i)),Dc(c,c,p),Ko(c,c)}const f_={circle:class extends ql{constructor(o){super(o,kp)}createBucket(o){return new Jh(o)}queryRadius(o){const i=o;return ed("circle-radius",this,i)+ed("circle-stroke-width",this,i)+Lp(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,s,c,p,g,v,w){const T=nv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return iv(o,c,g,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,S)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new er(this,o)}},heatmap:class extends ql{createBucket(o){return new Cg(o)}constructor(o){super(o,td),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return ed("heatmap-radius",this,o)}queryIntersectsFeature(o,i,s,c,p,g,v,w){const T=this.paint.get("heatmap-radius").evaluate(i,s);return iv(o,c,g,v,w,!0,!0,new Fe(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new er(this,o)}},hillshade:class extends ql{constructor(o){super(o,Yx)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ql{constructor(o){super(o,fv)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new er(this,o)}recalculate(o,i){super.recalculate(o,i);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Hp(o)}queryRadius(){return Lp(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,s,c,p,g){return!o.queryGeometry.isAboveHorizon&&Gx(tv(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends ql{constructor(o){super(o,wv)}createBucket(o){return new Ku(o)}queryRadius(){return Lp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new er(this,o)}queryIntersectsFeature(o,i,s,c,p,g,v,w,T){const S=nv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(i,s),N=this.paint.get("fill-extrusion-base").evaluate(i,s),F=[0,0],V=w&&g.elevation,j=g.elevation?g.elevation.exaggeration():1,q=o.tile.getBucket(this);if(V&&q instanceof Ku){const de=q.centroidVertexArray,ge=T+1;ge<de.length&&(F[0]=de.geta_centroid_pos0(ge),F[1]=de.geta_centroid_pos1(ge))}if(0===F[0]&&1===F[1])return!1;"globe"===g.projection.name&&(c=Ju([c],[new Fe(0,0),new Fe(gn,gn)],o.tileID.canonical).map(de=>de.polygon).flat());const J=V?w:null,[se,pe]=(ge=c,me=N,Ge=P,je=S,ot=v,wt=J,Xe=F,ht=j,ct=g.center.lat,"globe"===(de=g).projection.name?function(At,nt,jt,nn,$t,Bn,Rt,_n,Vn,gi,Hn){const En=[],Ui=[],Wn=At.projection.upVectorScale(Hn,At.center.lat,At.worldSize).metersToTile,Fn=[0,0,0,1],Di=[0,0,0,1],Oi=(Mi,hr,pn,st)=>{Mi[0]=hr,Mi[1]=pn,Mi[2]=st,Mi[3]=1},ji=Ng();jt>0&&(jt+=ji),nn+=ji;for(const Mi of nt){const hr=[],pn=[];for(const st of Mi){const Si=st.x+$t.x,et=st.y+$t.y,Ir=At.projection.projectTilePoint(Si,et,Hn),wr=At.projection.upVector(Hn,st.x,st.y);let ai=jt,dr=nn;if(Rt){const Ii=Fg(Si,et,jt,nn,Rt,_n,Vn,gi);ai+=Ii.base,dr+=Ii.top}0!==jt?Oi(Fn,Ir.x+wr[0]*Wn*ai,Ir.y+wr[1]*Wn*ai,Ir.z+wr[2]*Wn*ai):Oi(Fn,Ir.x,Ir.y,Ir.z),Oi(Di,Ir.x+wr[0]*Wn*dr,Ir.y+wr[1]*Wn*dr,Ir.z+wr[2]*Wn*dr),gr(Fn,Fn,Bn),gr(Di,Di,Bn),hr.push(new ad(Fn[0],Fn[1],Fn[2])),pn.push(new ad(Di[0],Di[1],Di[2]))}En.push(hr),Ui.push(pn)}return[En,Ui]}(de,ge,me,Ge,je,ot,wt,Xe,ht,ct,o.tileID.canonical):wt?function(At,nt,jt,nn,$t,Bn,Rt,_n,Vn){const gi=[],Hn=[],En=[0,0,0,1];for(const Ui of At){const Wn=[],Fn=[];for(const Di of Ui){const Oi=Di.x+nn.x,ji=Di.y+nn.y,Mi=Fg(Oi,ji,nt,jt,Bn,Rt,_n,Vn);En[0]=Oi,En[1]=ji,En[2]=Mi.base,En[3]=1,iu(En,En,$t),En[3]=Math.max(En[3],1e-5);const hr=new ad(En[0]/En[3],En[1]/En[3],En[2]/En[3]);En[0]=Oi,En[1]=ji,En[2]=Mi.top,En[3]=1,iu(En,En,$t),En[3]=Math.max(En[3],1e-5);const pn=new ad(En[0]/En[3],En[1]/En[3],En[2]/En[3]);Wn.push(hr),Fn.push(pn)}gi.push(Wn),Hn.push(Fn)}return[gi,Hn]}(ge,me,Ge,je,ot,wt,Xe,ht,ct):function(At,nt,jt,nn,$t){const Bn=[],Rt=[],_n=$t[8]*nt,Vn=$t[9]*nt,gi=$t[10]*nt,Hn=$t[11]*nt,En=$t[8]*jt,Ui=$t[9]*jt,Wn=$t[10]*jt,Fn=$t[11]*jt;for(const Di of At){const Oi=[],ji=[];for(const Mi of Di){const hr=Mi.x+nn.x,pn=Mi.y+nn.y,st=$t[0]*hr+$t[4]*pn+$t[12],Si=$t[1]*hr+$t[5]*pn+$t[13],et=$t[2]*hr+$t[6]*pn+$t[14],Ir=$t[3]*hr+$t[7]*pn+$t[15],wr=st+_n,ai=Si+Vn,dr=et+gi,Ii=Math.max(Ir+Hn,1e-5),po=st+En,Ar=Si+Ui,eo=et+Wn,Hr=Math.max(Ir+Fn,1e-5);Oi.push(new ad(wr/Ii,ai/Ii,dr/Ii)),ji.push(new ad(po/Hr,Ar/Hr,eo/Hr))}Bn.push(Oi),Rt.push(ji)}return[Bn,Rt]}(ge,me,Ge,je,ot)),ae=o.queryGeometry;var de,ge,me,Ge,je,ot,wt,Xe,ht,ct;return function(de,ge,me){let Ge=1/0;Gx(me,ge)&&(Ge=Cv(me,ge[0]));for(let je=0;je<ge.length;je++){const ot=ge[je],wt=de[je];for(let Xe=0;Xe<ot.length-1;Xe++){const ht=ot[Xe],ct=[ht,ot[Xe+1],wt[Xe+1],wt[Xe],ht];Qh(me,ct)&&(Ge=Math.min(Ge,Cv(me,ct)))}}return Ge!==1/0&&Ge}(se,pe,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends ql{constructor(o){super(o,Ug),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Lo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=jg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new bf(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new er(this,o)}queryRadius(o){const i=o,s=Tv(ed("line-width",this,i),ed("line-gap-width",this,i)),c=ed("line-offset",this,i);return s/2+Math.abs(c)+Lp(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,s,c,p,g){if(o.queryGeometry.isAboveHorizon)return!1;const v=tv(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),w=o.pixelToTileUnitsFactor/2*Tv(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),T=this.paint.get("line-offset").evaluate(i,s);return T&&(c=function(S,P){const N=[],F=new Fe(0,0);for(let V=0;V<S.length;V++){const j=S[V],q=[];for(let J=0;J<j.length;J++){const se=j[J],pe=j[J+1],ae=0===J?F:se.sub(j[J-1])._unit()._perp(),de=J===j.length-1?F:pe.sub(se)._unit()._perp(),ge=ae._add(de)._unit();ge._mult(1/(ge.x*de.x+ge.y*de.y)),q.push(ge._mult(P)._add(se))}N.push(q)}return N}(c,T*o.pixelToTileUnitsFactor)),function(S,P,N){for(let F=0;F<P.length;F++){const V=P[F];if(S.length>=3)for(let j=0;j<V.length;j++)if(ou(S,V[j]))return!0;if(qx(S,V,N))return!0}return!1}(v,c,w)}isTileClipped(){return!0}},symbol:gd,background:class extends ql{constructor(o){super(o,d_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ql{constructor(o){super(o,Ff)}getProgramIds(){return["raster"]}},sky:class extends ql{constructor(o){super(o,_d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Wu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),p=!c,g=o.style.light,v=g.properties.get("position");return p&&"viewport"===g.properties.get("anchor")&&Yi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?zf(v.azimuthal,90-v.polar,i):zf(c[0],90-c[1],i)}const s=this.paint.get("sky-gradient-center");return zf(s[0],90-s[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class mu{constructor(i,s,c,p){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(s,p)}update(i,s,c){const{width:p,height:g}=i,{context:v}=this,{gl:w}=v,{HTMLImageElement:T,HTMLCanvasElement:S,HTMLVideoElement:P,ImageData:N,ImageBitmap:F}=Q;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!s||!1!==s.premultiply)),c||this.size&&this.size[0]===p&&this.size[1]===g){const{x:V,y:j}=c||{x:0,y:0};i instanceof T||i instanceof S||i instanceof P||i instanceof N||F&&i instanceof F?w.texSubImage2D(w.TEXTURE_2D,0,V,j,w.RGBA,w.UNSIGNED_BYTE,i):w.texSubImage2D(w.TEXTURE_2D,0,V,j,p,g,w.RGBA,w.UNSIGNED_BYTE,i.data)}else this.size=[p,g],i instanceof T||i instanceof S||i instanceof P||i instanceof N||F&&i instanceof F?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,i):w.texImage2D(w.TEXTURE_2D,0,this.format,p,g,0,this.format,w.UNSIGNED_BYTE,i.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(i,s){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?i===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:i),this.filter=i),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class GE{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class p_{constructor(){this.tasks={},this.taskQueue=[],ci(["process"],this),this.invoker=new GE(this.process),this.nextId=0}add(i,s){const c=this.nextId++,p=function({type:g,isSymbolTile:v,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||v?"parseTile"!==g||v?"parseTile"===g&&v?300-w:"maybePrepare"===g&&v?400-w:500:200-w:100-w}(s);if(0===p){is();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:s,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){is();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<s&&(s=g.priority,i=p)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class yd{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const c=i[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const Rb=["tile","layer","source","sourceLayer","state"];class m_{constructor(i,s,c,p,g){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=c,this._y=p,this.properties=i.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const s of Rb)void 0!==this[s]&&(i[s]=this[s]);return i}}const Jl=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,s=0,c=0,p=0,g=0,v=0,w=0;for(1&i?p=g=v=32:s=c=w=32;(i>>=1)>1;){const S=s+p>>1,P=c+g>>1;1&i?(p=s,g=c,s=v,c=w):(s=p,c=g,p=v,g=w),v=S,w=P}const T=4*o;Jl[T+0]=s,Jl[T+1]=c,Jl[T+2]=p,Jl[T+3]=g}const bl=new Uint16Array(2178),gu=new Uint8Array(1089),pm=new Uint16Array(1089);function Lb(o){return 0===o?-.03125:32===o?.03125:0}var Gv=Pe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Bf={type:2,extent:gn,loadGeometry:()=>[[new Fe(0,0),new Fe(gn+1,0),new Fe(gn+1,gn+1),new Fe(0,gn+1),new Fe(0,0)]]};class Vf{constructor(i,s,c,p,g){this.tileID=i,this.uid=Pi(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<zs.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=uu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,g){const v={};if(!g)return v;for(const w of p){const T=w.layerIds.map(S=>g.getLayer(S)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(S=>T.filter(P=>P.id===S)[0]));for(const S of T)v[S.id]=w}}return v}(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof pu){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof pu&&g.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||"deferred"!==E()||I();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Ti}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(i)}const s=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mu(i,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mu(i,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new mu(i,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,s,c,p,g,v,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:w,transform:v,params:g,tileTransform:this.tileTransform},i,s,c):{}}querySourceFeatures(i,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;const w=Oe(s&&s.filter),{z:T,x:S,y:P}=this.tileID.canonical,N={z:T,x:S,y:P};for(let F=0;F<v.length;F++){const V=v.feature(F);if(w.needGeometry){const J=Do(V,!0);if(!w.filter(new R(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!w.filter(new R(this.tileID.overscaledZ),V))continue;const j=c.getId(V,g),q=new m_(V,T,S,P,j);q.tile=N,i.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const c=no(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),p=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const v=this.buckets[g],w=v.layers[0].sourceLayer||"_geojsonTileLayer",T=c[w],S=i[w];if(!T||!S||0===Object.keys(S).length)continue;if(v.update(S,T,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof bf||v instanceof Hp){const N=s.style._getSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&N&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(N.id,this.tileID)}const P=s&&s.style&&s.style.getLayer(g);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zs.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=zs.now()+i}setTexture(i,s){const c=s.context,p=c.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new mu(c,i,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(i,s){const c={};for(const p of s)c[p]=!0;this.dependencies[i]=c}hasDependency(i,s){for(const c of i){const p=this.dependencies[c];if(p)for(const g of s)if(p[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=Ic(Bf,this.tileID.canonical,this.tileTransform)[0],p=new Et,g=new Yo;for(let v=0;v<c.length;v++){const{x:w,y:T}=c[v];p.emplaceBack(w,T),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(p,nf.members),this._tileDebugSegments=Bi.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=Ic(Bf,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const v=function(w,T){const S=uu(w,T),P=Math.pow(2,w.z);for(let J=0;J<33;J++)for(let se=0;se<33;se++){const pe=la((w.x+(se+Lb(se))/32)/P),ae=zo((w.y+(J+Lb(J))/32)/P),de=T.project(pe,ae),ge=33*J+se;bl[2*ge+0]=Math.round((de.x*S.scale-S.x)*gn),bl[2*ge+1]=Math.round((de.y*S.scale-S.y)*gn)}gu.fill(0),pm.fill(0);for(let J=2045;J>=0;J--){const se=4*J,pe=Jl[se+0],ae=Jl[se+1],de=Jl[se+2],ge=Jl[se+3],me=pe+de>>1,Ge=ae+ge>>1,je=me+Ge-ae,ot=Ge+pe-me,wt=33*ae+pe,Xe=33*ge+de,ht=33*Ge+me,ct=Math.hypot((bl[2*wt+0]+bl[2*Xe+0])/2-bl[2*ht+0],(bl[2*wt+1]+bl[2*Xe+1])/2-bl[2*ht+1])>=16;gu[ht]=gu[ht]||(ct?1:0),J<1022&&(gu[ht]=gu[ht]||gu[33*(ae+ot>>1)+(pe+je>>1)]||gu[33*(ge+ot>>1)+(de+je>>1)])}const N=new ut,F=new Kt;let V=0;function j(J,se){const pe=33*se+J;return 0===pm[pe]&&(N.emplaceBack(bl[2*pe+0],bl[2*pe+1],J*gn/32,se*gn/32),pm[pe]=++V),pm[pe]-1}function q(J,se,pe,ae,de,ge){const me=J+pe>>1,Ge=se+ae>>1;if(Math.abs(J-de)+Math.abs(se-ge)>1&&gu[33*Ge+me])q(de,ge,J,se,me,Ge),q(pe,ae,de,ge,me,Ge);else{const je=j(J,se),ot=j(pe,ae),wt=j(de,ge);F.emplaceBack(je,ot,wt)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:N,indices:F}}(this.tileID.canonical,s);p=v.vertices,g=v.indices}else{p=new ut,g=new Kt;for(const{x:w,y:T}of c)p.emplaceBack(w,T,0,0);const v=jp(p.int16,void 0,4);for(let w=0;w<v.length;w+=3)g.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=i.createVertexBuffer(p,Gv.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(g),this._tileBoundsSegments=Bi.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(i,s){const c=s.projection;if(!c||"globe"!==c.name||s.freezeTileCoverage)return;const p=this.tileID.canonical,g=Kh(qy(p,s)),v=ho(s.zoom);let w;v>0&&(w=Kd(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,p,s,g,w,v),this._makeGlobeTileDebugTextBuffer(i,p,s,g,w,v)}_globePoint(i,s,c,p,g,v,w){let T=gl(i,s,c);if(v){const S=1<<c.z,P=$a(p.center.lng),N=ds(p.center.lat),F=(c.x+.5)/S-P;let V=0;F>.5?V=-1:F<-.5&&(V=1);let j=(i/gn+c.x)/S+V,q=(s/gn+c.y)/S;j=(j-P)*p._pixelsPerMercatorPixel+P,q=(q-N)*p._pixelsPerMercatorPixel+N;const J=[j*p.worldSize,q*p.worldSize,0];gr(J,J,v),T=Mc(T,J,w)}return gr(T,T,g)}_makeGlobeTileDebugBorderBuffer(i,s,c,p,g,v){const w=new Et,T=new Yo,S=new Ue,P=(F,V,j,q,J)=>{const se=(j-F)/(J-1),pe=(q-V)/(J-1),ae=w.length;for(let de=0;de<J;de++){const ge=F+de*se,me=V+de*pe;w.emplaceBack(ge,me);const Ge=this._globePoint(ge,me,s,c,p,g,v);S.emplaceBack(Ge[0],Ge[1],Ge[2]),T.emplaceBack(ae+de)}},N=gn;P(0,0,N,0,16),P(N,0,N,N,16),P(N,N,0,N,16),P(0,N,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(T),this._tileDebugBuffer=i.createVertexBuffer(w,nf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(S,$y.members),this._tileDebugSegments=Bi.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(i,s,c,p,g,v){const w=gn/4,T=new Et,S=new Kt,P=new Ue,N=25;S.reserve(32),T.reserve(N),P.reserve(N);const F=(V,j)=>N*V+j;for(let V=0;V<N;V++){const j=V*w;for(let q=0;q<N;q++){const J=q*w;T.emplaceBack(J,j);const se=this._globePoint(J,j,s,c,p,g,v);P.emplaceBack(se[0],se[1],se[2])}}for(let V=0;V<4;V++)for(let j=0;j<4;j++){const q=F(V,j),J=F(V,j+1),se=F(V+1,j),pe=F(V+1,j+1);S.emplaceBack(q,J,se),S.emplaceBack(se,J,pe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(S),this._tileDebugTextBuffer=i.createVertexBuffer(T,nf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(P,$y.members),this._tileDebugTextSegments=Bi.simpleSegment(0,0,N,32)}}class kb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,c){const p=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},ii(this.stateChanges[i][p],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const g in this.state[i])g!==p&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][p]){this.deletedStates[i][p]={};for(const g in this.state[i][p])c[g]||(this.deletedStates[i][p][g]=null)}else for(const g in c)this.deletedStates[i]&&this.deletedStates[i][p]&&null===this.deletedStates[i][p][g]&&delete this.deletedStates[i][p][g]}removeFeatureState(i,s,c){if(null===this.deletedStates[i])return;const p=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==s)null!==this.deletedStates[i][p]&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][c]=null);else if(void 0!==s)if(this.stateChanges[i]&&this.stateChanges[i][p])for(c in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][c]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,s){const c=String(s),p=ii({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const g=this.deletedStates[i][s];if(null===g)return{};for(const v in g)delete p[v]}return p}initializeTileState(i,s){i.setFeatureState(this.state,s)}coalesceChanges(i,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),ii(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(null===this.deletedStates[p])for(const v in this.state[p])g[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(null===this.deletedStates[p][v])this.state[p][v]={};else if(this.state[p][v])for(const w of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][w];g[v]=this.state[p][v]}c[p]=c[p]||{},ii(c[p],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const p in i)i[p].setFeatureState(c,s)}}class g_{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const c=this.toIdx(i,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function mm(o,i,s,c){let p=0,g=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(c[v])<1e-15){if(s[v]<o[v]||s[v]>i[v])return null}else{const w=1/c[v];let T=(o[v]-s[v])*w,S=(i[v]-s[v])*w;if(T>S){const P=T;T=S,S=P}if(T>p&&(p=T),S<g&&(g=S),p>g)return null}return p}function Uf(o,i,s,c,p,g,v,w,T,S,P){const N=c-o,F=p-i,V=g-s,j=v-o,q=w-i,J=T-s,se=P[1]*J-P[2]*q,pe=P[2]*j-P[0]*J,ae=P[0]*q-P[1]*j,de=N*se+F*pe+V*ae;if(Math.abs(de)<1e-15)return null;const ge=1/de,me=S[0]-o,Ge=S[1]-i,je=S[2]-s,ot=(me*se+Ge*pe+je*ae)*ge;if(ot<0||ot>1)return null;const wt=Ge*V-je*F,Xe=je*N-me*V,ht=me*F-Ge*N,ct=(P[0]*wt+P[1]*Xe+P[2]*ht)*ge;return ct<0||ot+ct>1?null:(j*wt+q*Xe+J*ht)*ge}function qv(o,i,s){return(o-i)/(s-i)}function __(o,i,s,c,p,g,v,w,T){const S=1<<s,P=g-c,N=v-p,F=(o+1)/S*P+c,V=(i+0)/S*N+p,j=(i+1)/S*N+p;w[0]=(o+0)/S*P+c,w[1]=V,T[0]=F,T[1]=j}class Zv{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const v=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,v));const S=1/T,P=(V,j,q,J,se)=>{const pe=J?1:0,ae=(V+1)*q-pe,de=j*q,ge=(j+1)*q-pe;se[0]=V*q,se[1]=de,se[2]=ae,se[3]=ge};let N=new g_(T);const F=[];for(let V=0;V<T*T;V++){P(V%T,Math.floor(V/T),S,!1,F);const j=dh(F[0],F[1],g),q=dh(F[2],F[1],g),J=dh(F[2],F[3],g),se=dh(F[0],F[3],g);N.minimums.push(Math.min(j,q,J,se)),N.maximums.push(Math.max(j,q,J,se)),N.leaves.push(1)}for(w.push(N),T/=2;T>=1;T/=2){const V=w[w.length-1];N=new g_(T);for(let j=0;j<T*T;j++){P(j%T,Math.floor(j/T),2,!0,F);const q=V.getElevation(F[0],F[1]),J=V.getElevation(F[2],F[1]),se=V.getElevation(F[2],F[3]),pe=V.getElevation(F[0],F[3]),ae=V.isLeaf(F[0],F[1]),de=V.isLeaf(F[2],F[1]),ge=V.isLeaf(F[2],F[3]),me=V.isLeaf(F[0],F[3]),Ge=Math.min(q.min,J.min,se.min,pe.min),je=Math.max(q.max,J.max,se.max,pe.max),ot=ae&&de&&ge&&me;N.maximums.push(je),N.minimums.push(Ge),N.leaves.push(je-Ge<=5&&ot?1:0)}w.push(N)}return w}(this.dem),c=s.length-1,p=s[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(i,s,c,p,g,v,w=1){return mm([i,s,-100],[c,p,this.maximums[0]*w],g,v)}raycast(i,s,c,p,g,v,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,s,c,p,g,v,w);if(null==T)return null;const S=[],P=[],N=[],F=[],V=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:j,t:q,nodex:J,nodey:se,depth:pe}=V.pop();if(this.leaves[j]){__(J,se,pe,i,s,c,p,N,F);const de=1<<pe,ge=(J+0)/de,me=(J+1)/de,Ge=(se+0)/de,je=(se+1)/de,ot=dh(ge,Ge,this.dem)*w,wt=dh(me,Ge,this.dem)*w,Xe=dh(me,je,this.dem)*w,ht=dh(ge,je,this.dem)*w,ct=Uf(N[0],N[1],ot,F[0],N[1],wt,F[0],F[1],Xe,g,v),_t=Uf(F[0],F[1],Xe,N[0],F[1],ht,N[0],N[1],ot,g,v),At=Math.min(null!==ct?ct:Number.MAX_VALUE,null!==_t?_t:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const nt=ef([],g,v,q);if(y_(ot,wt,ht,Xe,qv(nt[0],N[0],F[0]),qv(nt[1],N[1],F[1]))>=nt[2])return q}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){__((J<<1)+this._siblingOffset[de][0],(se<<1)+this._siblingOffset[de][1],pe+1,i,s,c,p,N,F),N[2]=-100,F[2]=this.maximums[this.childOffsets[j]+de]*w;const ge=mm(N,F,g,v);if(null!=ge){const me=ge;S[de]=me;let Ge=!1;for(let je=0;je<ae&&!Ge;je++)me>=S[P[je]]&&(P.splice(je,0,de),Ge=!0);Ge||(P[ae]=de),ae++}}for(let de=0;de<ae;de++){const ge=P[de];V.push({idx:this.childOffsets[j]+ge,t:S[ge],nodex:(J<<1)+this._siblingOffset[ge][0],nodey:(se<<1)+this._siblingOffset[ge][1],depth:pe+1})}}return null}_addNode(i,s,c){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,c,p,g){if(1===i[p].isLeaf(s,c))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const v=p-1,w=i[v];let T=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const N=2*s+this._siblingOffset[P][0],F=2*c+this._siblingOffset[P][1],V=w.getElevation(N,F),j=w.isLeaf(N,F),q=this._addNode(V.min,V.max,j);j&&(T|=1<<P),S||(S=q)}for(let P=0;P<this._siblingOffset.length;P++)T&1<<P||this._construct(i,2*s+this._siblingOffset[P][0],2*c+this._siblingOffset[P][1],v,S+P)}}function y_(o,i,s,c,p,g){return si(si(o,s,g),si(i,c,g),p)}function dh(o,i,s){const c=s.dim,p=Tn(o*c-.5,0,c-1),g=Tn(i*c-.5,0,c-1),v=Math.floor(p),w=Math.floor(g),T=Math.min(v+1,c-1),S=Math.min(w+1,c-1);return y_(s.get(v,w),s.get(T,w),s.get(v,S),s.get(T,S),p-v,g-w)}const Wv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function gm(o,i,s){return(256*o*256+256*i+s)/10-1e4}function Ob(o,i,s){return 256*o+i+s/256-32768}class Oc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,c,p=!1,g=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return Yi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const v=this.dim=s.height-2,w=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let T=0;T<v;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(v,T)]=w[this._idx(v-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,v)]=w[this._idx(T,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Zv(this)}get(i,s,c=!1){c&&(i=Tn(i,-1,this.dim),s=Tn(s,-1,this.dim));const p=4*this._idx(i,s);return("terrarium"===this.encoding?Ob:gm)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(i){return Wv[i]}get unpackVector(){return Wv[this.encoding]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const c=[0,0,0,0],p=Oc.getUnpackVector(s);let g=Math.floor((i+p[3])/p[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Ss({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,g=s*this.dim+this.dim,v=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:p=g-1;break;case 1:g=p+1}switch(c){case-1:v=w-1;break;case 1:w=v+1}const T=-s*this.dim,S=-c*this.dim;for(let P=v;P<w;P++)for(let N=p;N<g;N++){const F=4*this._idx(N,P),V=4*this._idx(N+T,P+S);this.pixels[F+0]=i.pixels[V+0],this.pixels[F+1]=i.pixels[V+1],this.pixels[F+2]=i.pixels[V+2],this.pixels[F+3]=i.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Qt(Oc,"DEMData"),Qt(Zv,"DemMinMaxQuadTree",{omit:["dem"]});class ua{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,c){const p=i.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(void 0!==c&&(g.timeout=setTimeout(()=>{this.remove(i,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const c=i.wrapped().key,p=void 0===s?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const c in this.data)for(const p of this.data[c])i(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class vd{constructor(i,s,c){this.func=i,this.mask=s,this.range=c}}vd.ReadOnly=!1,vd.ReadWrite=!0,vd.disabled=new vd(519,vd.ReadOnly,[0,1]);class qa{constructor(i,s,c,p,g,v){this.test=i,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=v}}qa.disabled=new qa({func:519,mask:0},0,0,7680,7680,7680);class Ql{constructor(i,s,c){this.blendFunction=i,this.blendColor=s,this.mask=c}}Ql.Replace=[1,0],Ql.disabled=new Ql(Ql.Replace,cn.transparent,[!1,!1,!1,!1]),Ql.unblended=new Ql(Ql.Replace,cn.transparent,[!0,!0,!0,!0]),Ql.alphaBlended=new Ql([1,771],cn.transparent,[!0,!0,!0,!0]);class wl{constructor(i,s,c){this.enable=i,this.mode=s,this.frontFace=c}}wl.disabled=new wl(!1,1029,2305),wl.backCCW=new wl(!0,1029,2305),wl.backCW=new wl(!0,1029,2304),wl.frontCW=new wl(!0,1028,2304),wl.frontCCW=new wl(!0,1028,2305);class Nc extends Bs{constructor(i,s,c){super(),this.id=i,this._onlySymbols=c,s.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new ua(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new kb,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return In(this._tiles).map(i=>i.tileID).sort(Nb).map(i=>i.key)}getRenderableIds(i){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&s.push(this._tiles[c]);return i?s.sort((c,p)=>{const g=c.tileID,v=p.tileID,w=new Fe(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new Fe(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Nb).map(c=>c.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,i,s)))}_tileLoaded(i,s,c,p){if(p)if(i.state="errored",404!==p.status)this._source.fire(new _o(p,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=zs.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Ca("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(i.neighboringTiles&&i.neighboringTiles[g]){const v=this.getTileByID(g);c(i,v),c(v,i)}}function c(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),S=g.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+T)?v+=T:1===Math.abs(v-T)&&(v-=T)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,w),p.neighboringTiles&&p.neighboringTiles[S]&&(p.neighboringTiles[S].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,c,p){for(const g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>c)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const S=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[S.key],v&&v.hasData()&&(w=S)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){p[w.key]=w;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=i.overscaledZ-1;c>=s;c--){const p=i.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const c=Math.ceil(i.width/s)+1,p=Math.ceil(i.height/s)+1,g=Math.floor(c*p*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(i){const s=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(i,s,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(i,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Jo(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(p=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(w=>this._source.hasTile(w)))):p=[];const g=this._updateRetainedTiles(p);if(ym(this._source.type)&&0!==p.length){const w={},T={},S=Object.keys(g);for(const N of S){const F=g[N],V=this._tiles[N];if(!V||V.fadeEndTime&&V.fadeEndTime<=zs.now())continue;const j=this.findLoadedParent(F,Math.max(F.overscaledZ-Nc.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),w[j.tileID.key]=j.tileID),T[N]=F}const P=p[p.length-1].overscaledZ;for(const N in this._tiles){const F=this._tiles[N];if(g[N]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>P;){V=V.scaledTo(V.overscaledZ-1);const j=this._tiles[V.key];if(j&&j.hasData()&&T[V.key]){g[N]=F.tileID;break}}}for(const N in w)g[N]||(this._coveredTiles[N]=!0,g[N]=w[N])}for(const w in g)this._tiles[w].clearFadeHold();const v=function(w,T){const S=[];for(const P in w)P in T||S.push(P);return S}(this._tiles,g);for(const w of v){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(0===i.length)return s;const c={},p=i.reduce((S,P)=>Math.min(S,P.overscaledZ),1/0),g=i[0].overscaledZ,v=Math.max(g-Nc.maxOverzooming,this._source.minzoom),w=Math.max(g+Nc.maxUnderzooming,this._source.minzoom),T={};for(const S of i){const P=this._addTile(S);s[S.key]=S,P.hasData()||p<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,p,w,s);for(const S of i){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const F=S.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){s[F.key]=F;continue}}else{const F=S.children(this._source.maxzoom);if(s[F[0].key]&&s[F[1].key]&&s[F[2].key]&&s[F[3].key])continue}let N=P.wasRequested();for(let F=S.overscaledZ-1;F>=v;--F){const V=S.scaledTo(F);if(c[V.key]||(c[V.key]=!0,P=this.getTile(V),!P&&N&&(P=this._addTile(V)),P&&(s[V.key]=V,N=P.wasRequested(),P.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let c,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(i){let s=this._tiles[i.key];if(s)return s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const c=!!s;if(!c){const p=this.map?this.map.painter:null;s=new Vf(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,c||this._source.fire(new Ca("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=s.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,c){const p=[],g=this.transform;if(!g)return p;const v="globe"===g.projection.name,w=$a(g.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(v){const N=S.tileID.canonical;if(0===N.z){const F=[Math.abs(Tn(w,...xd(N,-1))-w),Math.abs(Tn(w,...xd(N,1))-w)];P=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(Tn(w,...xd(N,-1))-w),Math.abs(Tn(w,...xd(N,0))-w),Math.abs(Tn(w,...xd(N,1))-w)];P=[F.indexOf(Math.min(...F))-1]}}else P=[0];for(const N of P){const F=i.containsTile(S,g,s,N);F&&p.push(F)}}return p}getVisibleCoordinates(i){const s=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ym(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=zs.now())return!0}return!1}setFeatureState(i,s,c){this._state.updateState(i=i||"_geojsonTileLayer",s,c)}removeFeatureState(i,s,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,c)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,c){const p=this._tiles[i];p&&p.setDependencies(s,c)}reloadTilesForDependencies(i,s){for(const c in this._tiles)this._tiles[c].hasDependency(i,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(i,s))};return void this._source.on("data",w)}const c=new Map,p=Array.isArray(i)?i:[i],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of p){const T=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)c.set(S.key,S);this.usedForTerrain&&w.updateElevation(!1)}dn(Array.from(c.values()),(w,T)=>{const S=new Vf(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,P=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),T(P,S)})},s)}}function Nb(o,i){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||c-s||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function ym(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function xd(o,i){const s=1<<o.z;return[o.x/s+i,(o.x+1)/s+i]}Nc.maxOverzooming=10,Nc.maxUnderzooming=3;class vm{constructor(i,s,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(i,s,c){const p=c||i.findDEMTileFor(s);if(!p||!p.dem)return;const g=p.dem,v=p.tileID,w=1<<s.canonical.z-v.canonical.z;return new vm(p,p.tileSize/gn/w,[(s.canonical.x/w-v.canonical.x)*g.dim,(s.canonical.y/w-v.canonical.y)*g.dim])}tileCoordToPixel(i,s){const c=s*this._scale+this._offset[1],p=Math.floor(i*this._scale+this._offset[0]),g=Math.floor(c);return new Fe(p,g)}getElevationAt(i,s,c,p){const g=i*this._scale+this._offset[0],v=s*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(v),S=this._dem;return p=!!p,c?si(si(S.get(w,T,p),S.get(w,T+1,p),v-T),si(S.get(w+1,T,p),S.get(w+1,T+1,p),v-T),g-w):S.get(w,T,p)}getElevationAtPixel(i,s,c){return this._dem.get(i,s,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Wl(1,i)*this._dem.stride}}class Xv{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new eu(gn,16,0),this.featureIndexArray=new Ba,this.promoteId=s}insert(i,s,c,p,g,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,g,v);const T=this.grid;for(let S=0;S<s.length;S++){const P=s[S],N=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){const V=P[F];N[0]=Math.min(N[0],V.x),N[1]=Math.min(N[1],V.y),N[2]=Math.max(N[2],V.x),N[3]=Math.max(N[3],V.y)}N[0]<gn&&N[1]<gn&&N[2]>=0&&N[3]>=0&&T.insert(w,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Gp(new tm(this.rawTileData)).layers,this.sourceLayerCoder=new yd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s,c,p){this.loadVTLayers();const g=i.params||{},v=Oe(g.filter),w=i.tileResult,T=i.transform,S=w.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(j,q,J,se)=>ev(w.bufferedTilespaceGeometry,j,q,J,se));P.sort(Fb);let N=null;T.elevation&&P.length>0&&(N=vm.create(T.elevation,this.tileID));const F={};let V;for(let j=0;j<P.length;j++){const q=P[j];if(q===V)continue;V=q;const J=this.featureIndexArray.get(q);let se=null;this.loadMatchingFeature(F,J,v,g.layers,g.availableImages,s,c,p,(pe,ae,de,ge=0)=>(se||(se=Ic(pe,this.tileID.canonical,i.tileTransform)),ae.queryIntersectsFeature(w,pe,de,se,this.z,i.transform,i.pixelPosMatrix,N,ge)))}return F}loadMatchingFeature(i,s,c,p,g,v,w,T,S){const{featureIndex:P,bucketIndex:N,sourceLayerIndex:F,layoutVertexArrayOffset:V}=s,j=this.bucketLayerIDs[N];if(p&&!function(pe,ae){for(let de=0;de<pe.length;de++)if(ae.indexOf(pe[de])>=0)return!0;return!1}(p,j))return;const q=this.sourceLayerCoder.decode(F),J=this.vtLayers[q].feature(P);if(c.needGeometry){const pe=Do(J,!0);if(!c.filter(new R(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!c.filter(new R(this.tileID.overscaledZ),J))return;const se=this.getId(J,q);for(let pe=0;pe<j.length;pe++){const ae=j[pe];if(p&&p.indexOf(ae)<0)continue;const de=v[ae];if(!de)continue;let ge={};void 0!==se&&T&&(ge=T.getState(de.sourceLayer||"_geojsonTileLayer",se));const me=ii({},w[ae]);me.paint=x_(me.paint,de.paint,J,ge,g),me.layout=x_(me.layout,de.layout,J,ge,g);const Ge=!S||S(J,de,ge,V);if(!Ge)continue;const je=new m_(J,this.z,this.x,this.y,se);je.layer=me;let ot=i[ae];void 0===ot&&(ot=i[ae]=[]),ot.push({featureIndex:P,feature:je,intersectionZ:Ge})}}lookupSymbolFeatures(i,s,c,p,g,v,w,T){const S={};this.loadVTLayers();const P=Oe(g);for(const N of i)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:p,featureIndex:N,layoutVertexArrayOffset:0},P,v,w,T,s);return S}loadFeature(i){const{featureIndex:s,sourceLayerIndex:c}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),g=this.vtFeatures[p];if(g[s])return g[s];const v=this.vtLayers[p].feature(s);return g[s]=v,v}hasLayer(i){for(const s of this.bucketLayerIDs)for(const c of s)if(i===c)return!0;return!1}getId(i,s){let c=i.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[s];null!=p&&(c=i.properties[p]),"boolean"==typeof c&&(c=Number(c))}return c}}function x_(o,i,s,c,p){return ln(o,(g,v)=>{const w=i instanceof re?i.get(v):null;return w&&w.evaluate?w.evaluate(s,c,p):w})}function Fb(o,i){return i-o}Qt(Xv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class b_{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new Pc({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const c=this.getKey(i,s);return this.positions[c]}trim(){const i=this.width,s=this.height=Dn(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,c){const p=[];let g=i.length%2==1?-i[i.length-1]*c:0,v=i[0]*c,w=!0;p.push({left:g,right:v,isDash:w,zeroLength:0===i[0]});let T=i[0];for(let S=1;S<i.length;S++){w=!w;const P=i[S];g=T*c,T+=P,v=T*c,p.push({left:g,right:v,isDash:w,zeroLength:0===P})}return p}addRoundDash(i,s,c){const p=s/2;for(let g=-c;g<=c;g++){const v=this.width*(this.nextRow+c+g);let w=0,T=i[w];for(let S=0;S<this.width;S++){S/T.right>1&&(T=i[++w]);const P=Math.abs(S-T.left),N=Math.abs(S-T.right),F=Math.min(P,N);let V;const j=g/c*(p+1);if(T.isDash){const q=p-Math.abs(j);V=Math.sqrt(F*F+q*q)}else V=p-Math.sqrt(F*F+j*j);this.image.data[v+S]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(i,s){for(let T=i.length-1;T>=0;--T){const S=i[T],P=i[T+1];S.zeroLength?i.splice(T,1):P&&P.isDash===S.isDash&&(P.left=S.left,i.splice(T,1))}const c=i[0],p=i[i.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const g=this.width*this.nextRow;let v=0,w=i[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=i[++v]);const S=Math.abs(T-w.left),P=Math.abs(T-w.right),N=Math.min(S,P);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?N:-N)+s+128))}}addDash(i,s){const c=this.getKey(i,s);if(this.positions[c])return this.positions[c];const p="round"===s,g=p?7:0,v=2*g+1;if(this.nextRow+v>this.height)return Yi("LineAtlas out of space"),null;0===i.length&&i.push(1);let w=0;for(let P=0;P<i.length;P++)i[P]<0&&(Yi("Negative value is found in line dasharray, replacing values with 0"),i[P]=0),w+=i[P];if(0!==w){const P=this.width/w,N=this.getDashRanges(i,this.width,P);p?this.addRoundDash(N,P,g):this.addRegularDash(N,"square"===s?.5*P:0)}const T=this.nextRow+g;this.nextRow+=v;const S={tl:[T,g],br:[w,0]};return this.positions[c]=S,S}}Qt(b_,"LineAtlas");const Yv=1*vl;class Kv{constructor(i){const s={},c=[];for(const w in i){const T=i[w],S=s[w]={};for(const P in T.glyphs){const N=T.glyphs[+P];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const F=N.metrics.localGlyph?Yv:1,V={x:0,y:0,w:N.bitmap.width+2*F,h:N.bitmap.height+2*F};c.push(V),S[P]=V}}const{w:p,h:g}=rh(c),v=new Pc({width:p||1,height:g||1});for(const w in i){const T=i[w];for(const S in T.glyphs){const P=T.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const N=s[w][S],F=P.metrics.localGlyph?Yv:1;Pc.copy(P.bitmap,v,{x:0,y:0},{x:N.x+F,y:N.y+F},P.bitmap)}}this.image=v,this.positions=s}}Qt(Kv,"GlyphAtlas");class qE{constructor(i){this.tileID=new Jo(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=uu(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,s,c,p,g){this.status="parsing",this.data=i,this.collisionBoxArray=new Ti;const v=new yd(Object.keys(i.layers).sort()),w=new Xv(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},S=new b_(256,256),P={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},N=s.familiesBySource[this.source];for(const ge in N){const me=i.layers[ge];if(!me)continue;let Ge=!1,je=!1;for(const Xe of N[ge])"symbol"===Xe[0].type?Ge=!0:je=!0;if(!0===this.isSymbolTile&&!Ge||!1===this.isSymbolTile&&!je)continue;1===me.version&&Yi(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=v.encode(ge),wt=[];for(let Xe=0;Xe<me.length;Xe++){const ht=me.feature(Xe),ct=w.getId(ht,ge);wt.push({feature:ht,id:ct,index:Xe,sourceLayerIndex:ot})}for(const Xe of N[ge]){const ht=Xe[0];void 0!==this.isSymbolTile&&"symbol"===ht.type!==this.isSymbolTile||ht.minzoom&&this.zoom<Math.floor(ht.minzoom)||ht.maxzoom&&this.zoom>=ht.maxzoom||"none"!==ht.visibility&&(xm(Xe,this.zoom,c),(T[ht.id]=ht.createBucket({index:w.bucketLayerIDs.length,layers:Xe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(wt,P,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(Xe.map(ct=>ct.id)))}}let F,V,j,q;S.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=()=>{if(F)return g(F);if(V&&j&&q){const ge=new Kv(V),me=new yb(j,q);for(const Ge in T){const je=T[Ge];je instanceof pu?(xm(je.layers,this.zoom,c),n_(je,V,ge.positions,j,me.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):je.hasPattern&&(je instanceof bf||je instanceof Hp||je instanceof Ku)&&(xm(je.layers,this.zoom,c),je.addFeatures(P,this.tileID.canonical,me.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:In(T).filter(Ge=>!Ge.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:S,imageAtlas:me,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?ge.positions:null})}},pe=ln(P.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(pe).length?p.send("getGlyphs",{uid:this.uid,stacks:pe},(ge,me)=>{F||(F=ge,V=me,se())},void 0,!1,J):V={};const ae=Object.keys(P.iconDependencies);ae.length?p.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ge,me)=>{F||(F=ge,j=me,se())},void 0,!1,J):j={};const de=Object.keys(P.patternDependencies);de.length?p.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(ge,me)=>{F||(F=ge,q=me,se())},void 0,!1,J):q={},se()}}function xm(o,i,s){const c=new R(i);for(const p of o)p.recalculate(c,s)}class w_{constructor(i){this.entries={},this.scheduler=i}request(i,s,c,p){const g=this.entries[i]=this.entries[i]||{callbacks:[]};if(g.result){const[v,w]=g.result;return this.scheduler?this.scheduler.add(()=>{p(v,w)},s):p(v,w),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((v,w)=>{g.result=[v,w];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(v,w)},s):T(v,w);setTimeout(()=>delete this.entries[i],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(v=>v!==p),g.callbacks.length||(g.cancel(),delete this.entries[i]))}}}function As(o,i,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},p=>{const g=Qa(o.request,(v,w,T,S)=>{v?p(v):w&&p(null,{vectorTile:s?void 0:new Gp(new tm(w)),rawData:w,cacheControl:T,expires:S})});return()=>{g.cancel(),p()}},i)}const E_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Jv{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(i,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(1!==p)throw new Error(`Got v${p} data when expected v1.`);const g=E_[15&c];if(!g)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new Jv(w,v,g,i)}constructor(i,s=64,c=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const g=E_.indexOf(this.ArrayType),v=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=i,this.coords[this._pos++]=s,c}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return jf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:w}=this,T=[0,g.length-1,0],S=[];for(;T.length;){const P=T.pop()||0,N=T.pop()||0,F=T.pop()||0;if(N-F<=w){for(let J=F;J<=N;J++){const se=v[2*J],pe=v[2*J+1];se>=i&&se<=c&&pe>=s&&pe<=p&&S.push(g[J])}continue}const V=F+N>>1,j=v[2*V],q=v[2*V+1];j>=i&&j<=c&&q>=s&&q<=p&&S.push(g[V]),(0===P?i<=j:s<=q)&&(T.push(F),T.push(V-1),T.push(1-P)),(0===P?c>=j:p>=q)&&(T.push(V+1),T.push(N),T.push(1-P))}return S}within(i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],T=[],S=c*c;for(;w.length;){const P=w.pop()||0,N=w.pop()||0,F=w.pop()||0;if(N-F<=v){for(let J=F;J<=N;J++)zb(g[2*J],g[2*J+1],i,s)<=S&&T.push(p[J]);continue}const V=F+N>>1,j=g[2*V],q=g[2*V+1];zb(j,q,i,s)<=S&&T.push(p[V]),(0===P?i-c<=j:s-c<=q)&&(w.push(F),w.push(V-1),w.push(1-P)),(0===P?i+c>=j:s+c>=q)&&(w.push(V+1),w.push(N),w.push(1-P))}return T}}function jf(o,i,s,c,p,g){if(p-c<=s)return;const v=c+p>>1;ec(o,i,v,c,p,g),jf(o,i,s,c,v-1,1-g),jf(o,i,s,v+1,p,1-g)}function ec(o,i,s,c,p,g){for(;p>c;){if(p-c>600){const S=p-c+1,P=s-c+1,N=Math.log(S),F=.5*Math.exp(2*N/3),V=.5*Math.sqrt(N*F*(S-F)/S)*(P-S/2<0?-1:1);ec(o,i,s,Math.max(c,Math.floor(s-P*F/S+V)),Math.min(p,Math.floor(s+(S-P)*F/S+V)),g)}const v=i[2*s+g];let w=c,T=p;for(ph(o,i,c,s),i[2*p+g]>v&&ph(o,i,c,p);w<T;){for(ph(o,i,w,T),w++,T--;i[2*w+g]<v;)w++;for(;i[2*T+g]>v;)T--}i[2*c+g]===v?ph(o,i,c,T):(T++,ph(o,i,T,p)),T<=s&&(c=T+1),s<=T&&(p=T-1)}}function ph(o,i,s,c){C_(o,s,c),C_(i,2*s,2*c),C_(i,2*s+1,2*c+1)}function C_(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}function zb(o,i,s,c){const p=o-s,g=i-c;return p*p+g*g}u.ARRAY_TYPE=Ds,u.AUTH_ERR_MSG=ye,u.Aabb=uo,u.Actor=class{constructor(o,i,s){this.target=o,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},ci(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=is()?o:Q,this.scheduler=new p_}send(o,i,s,c,p=!1,g){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[v]=s);const w=Dl(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:o,hasCallback:!!s,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:Vu(i,w)},w),{cancel:()=>{s&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const i=o.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(i.mustQueue||is()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,i),c&&c.metadata||{type:"message"})}else this.processTask(s,i)}processTask(o,i){if("<response>"===i.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(i.error?s(tu(i.error)):s(null,tu(i.data)))}else{const s=Dl(this.globalScope)?void 0:[],c=i.hasCallback?(g,v)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?Vu(g):null,data:Vu(v,s)},s)}:g=>{},p=tu(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,c);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],p.source)[g[1]](p,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=Qu,u.Color=cn,u.ColorMode=Ql,u.CullFaceMode=wl,u.DEMData=Oc,u.DataConstantProperty=G,u.DedupedRequest=w_,u.DepthMode=vd,u.EXTENT=gn,u.Elevation=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const s=i.getSource().maxzoom,c=1<<s,p=Math.floor(o.x),g=Math.floor((o.x-p)*c),v=Math.floor(o.y*c),w=this.findDEMTileFor(new Jo(s,p,s,g,v));return!(!w||!w.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,s=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const c=this._source();if(!c||o.y<0||o.y>1)return i;const p=c.getSource().maxzoom,g=1<<p,v=Math.floor(o.x),w=o.x-v,T=new Jo(p,v,p,Math.floor(w*g),Math.floor(o.y*g)),S=this.findDEMTileFor(T);if(!S||!S.dem)return i;const P=S.dem,N=1<<S.tileID.canonical.z,F=(w*N-S.tileID.canonical.x)*P.dim,V=(o.y*N-S.tileID.canonical.y)*P.dim,j=Math.floor(F),q=Math.floor(V);return(s?this.exaggeration():1)*si(si(P.get(j,q),P.get(j,q+1),V-q),si(P.get(j+1,q),P.get(j+1,q+1),V-q),F-j)}getAtTileOffset(o,i,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new lf(o.wrap+(o.canonical.x+i/gn)/c,(o.canonical.y+s/gn)/c))}getAtTileOffsetFunc(o,i,s,c){return p=>{const g=this.getAtTileOffset(o,p.x,p.y),v=c.upVector(o.canonical,p.x,p.y);return ia(v,v,g*c.upVectorScale(o.canonical,i,s).metersToTile),v}}getForTilePoints(o,i,s,c){if(this.isUsingMockSource())return!1;const p=vm.create(this,o,c);return!!p&&(i.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const s=i.dem.tree,c=i.tileID,p=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/p-c.canonical.x,v=o.canonical.y/p-c.canonical.y,w=0;for(let T=0;T<o.canonical.z-c.canonical.z&&!s.leaves[w];T++){g*=2,v*=2;const S=2*Math.floor(v)+Math.floor(g);w=s.childOffsets[w]+S,g%=1,v%=1}return{min:this.exaggeration()*s.minimums[w],max:this.exaggeration()*s.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=_o,u.EvaluationParameters=R,u.Event=Ca,u.Evented=Bs,u.FillExtrusionBucket=Ku,u.Frustum=rf,u.FrustumCorners=Gy,u.GLOBE_RADIUS=Ua,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=Zh,u.GLOBE_ZOOM_THRESHOLD_MIN=yg,u.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,i){const s=new Et,c=new Kt,p=[],g=o+1+2,v=i[0]+1,w=i[0]+1+(1+i.length),T=(S,P,N)=>{let F=S===g-1?S-2:0===S?S:S-1;return F+=N?24575:0,[F,P]};for(let S=0;S<g;++S)s.emplaceBack(...T(S,0,!0));for(let S=0;S<v;++S)for(let P=0;P<g;++P)s.emplaceBack(...T(P,S,(0===P||P===g-1)&&!0));for(let S=0;S<i.length;++S){const P=i[S];for(let N=0;N<g;++N)s.emplaceBack(...T(N,P,!0))}for(let S=0;S<i.length;++S){const P=c.length,N=i[S]+1+2,F=new Kt;for(let q=0;q<N-1;q++){const J=q===N-2,se=J?g*(w-i.length+S-q):g;for(let pe=0;pe<g-1;pe++){const ae=q*g+pe;0===q||J||0===pe||pe===g-2?(F.emplaceBack(ae+1,ae,ae+se),F.emplaceBack(ae+se,ae+se+1,ae+1)):(c.emplaceBack(ae+1,ae,ae+se),c.emplaceBack(ae+se,ae+se+1,ae+1))}}const V=Bi.simpleSegment(0,P,s.length,c.length-P);for(let q=0;q<F.uint16.length;q+=3)c.emplaceBack(F.uint16[q],F.uint16[q+1],F.uint16[q+2]);const j=Bi.simpleSegment(0,P,s.length,c.length-P);p.push({withoutSkirts:V,withSkirts:j})}return{vertices:s,indices:c,segments:p}}_createGrid(o){const i=this._fillGridMeshWithLods(64,Xh);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,nf.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new Kt;for(let p=0;p<=64;p++)i.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const s=new Ci,c=new Ci;this._poleSegments=[];for(let p=0,g=0;p<yg;p++){const v=360/(1<<p);s.emplaceBack(0,-Ua,0,.5,0),c.emplaceBack(0,-Ua,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,S=si(0,v,T),[P,N,F]=Yh(Vx,Yy,S,Ua);s.emplaceBack(P,N,F,T,0),c.emplaceBack(P,N,F,T,1)}this._poleSegments.push(Bi.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,Bx,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Bx,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,i){if(!this._wireframeSegments){const s=new co,c=64,p=c+1+2,g=1;this._wireframeSegments=[];for(let v=0,w=0;v<Xh.length;v++){const T=Xh[v];for(let P=g;P<T+g;P++)for(let N=g;N<c+g;N++){const F=P*p+N;s.emplaceBack(F,F+1),s.emplaceBack(F,F+p),s.emplaceBack(F,F+p+1)}const S=T*c*3;this._wireframeSegments.push(Bi.simpleSegment(0,w,(T+1)*p,S)),w+=S}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},u.GlyphManager=ud,u.ImagePosition=Lv,u.KDBush=Jv,u.LivePerformanceUtils=Vd,u.LngLat=mi,u.LngLatBounds=na,u.LocalGlyphMode=Sf,u.MAX_MERCATOR_LATITUDE=Bo,u.MercatorCoordinate=lf,u.ONE_EM=fo,u.OverscaledTileID=Jo,u.PerformanceMarkers=wa,u.Point=Fe,u.Properties=ce,u.RGBAImage=Ss,u.Ray=Hy,u.RequestManager=class{constructor(o,i,s){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let s=0;s<10;s++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!De(o))return o;const s=Ft(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!De(o))return o;const s=Ft(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeSourceURL(o,i,s,c){if(!De(o))return o;const p=Ft(o);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),s&&p.params.push(`language=${s}`),c&&p.params.push(`worldview=${c}`),this._makeAPIURL(p,this._customAccessToken||i)}normalizeSpriteURL(o,i,s,c){const p=Ft(o);return De(o)?(p.path=`/styles/v1${p.path}/sprite${i}${s}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${i}${s}`,Ct(p))}normalizeTileURL(o,i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!De(o))return o;const c=Ft(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||s&&"raster"!==c.authority&&512===s?"@2x":""}${Re.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${Ae.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Ae.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(g){for(const v of g){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(c.params)||Ae.ACCESS_TOKEN;return Ae.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(o,i){const s=Ft(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Ae.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Ae.TILE_URL_VERSION}/`,"")}`;let p=s.params;return i&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(o,i){const s=!!i&&De(i),c=[];for(const p of o.tiles||[])Be(p)?c.push(this.canonicalizeTileURL(p,s)):c.push(p);return c}_makeAPIURL(o,i){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=Ft(Ae.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const p=o.params.indexOf("secure");p>=0&&o.params.splice(p,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!Ae.REQUIRE_ACCESS_TOKEN)return Ct(o);if(i=i||Ae.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(p=>-1===p.indexOf("access_token")),o.params.push(`access_token=${i||""}`),Ct(o)}},u.ResourceType=Ja,u.SegmentVector=Bi,u.SourceCache=Nc,u.StencilMode=qa,u.StructArrayLayout1ui2=Yo,u.StructArrayLayout2f1f2i16=bn,u.StructArrayLayout2i4=Et,u.StructArrayLayout2ui4=co,u.StructArrayLayout3f12=Kn,u.StructArrayLayout3ui6=Kt,u.StructArrayLayout4i8=ut,u.StructArrayLayout5f20=Ci,u.Texture=mu,u.Tile=Vf,u.Transitionable=H,u.Uniform1f=yp,u.Uniform1i=class extends wc{constructor(o){super(o),this.current=0}set(o,i,s){this.fetchUniformLocation(o,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},u.Uniform2f=class extends wc{constructor(o){super(o),this.current=[0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},u.Uniform3f=class extends wc{constructor(o){super(o),this.current=[0,0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},u.Uniform4f=Oy,u.UniformColor=cg,u.UniformMatrix2f=class extends wc{constructor(o){super(o),this.current=zx}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},u.UniformMatrix3f=class extends wc{constructor(o){super(o),this.current=Fx}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},u.UniformMatrix4f=class extends wc{constructor(o){super(o),this.current=jh}set(o,i,s){if(this.fetchUniformLocation(o,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},u.UnwrappedTileID=Ev,u.ValidationError=ft,u.VectorTileFeature=qp,u.VectorTileWorkerSource=class extends Bs{constructor(o,i,s,c,p){super(),this.actor=o,this.layerIndex=i,this.availableImages=s,this.loadVectorData=p||As,this.loading={},this.loaded={},this.deduped=new w_(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,i){const s=o.uid,c=o&&o.request,p=c&&c.collectResourceTiming,g=this.loading[s]=new qE(o);g.abort=this.loadVectorData(o,(v,w)=>{const T=!this.loading[s];if(delete this.loading[s],T||v||!w)return g.status="done",T||(this.loaded[s]=g),i(v);const S=w.rawData,P={};w.expires&&(P.expires=w.expires),w.cacheControl&&(P.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new Gp(new tm(S));const N=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,V)=>{if(F||!V)return i(F);const j={};if(p){const q=Iu(c);q.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(q)))}i(null,ii({rawTileData:S.slice(0)},V,P,j))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,i){const s=this.loaded,c=o.uid,p=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=uu(o.tileID.canonical,o.projection);const v=(w,T)=>{const S=g.reloadCallback;S&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,S)),i(w,T)};"parsing"===g.status?g.reloadCallback=v:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(o,i){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),i()}removeTile(o,i){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],i()}},u.WritingMode=Ha,u.ZoomDependentExpression=Ul,u.add=Tc,u.addDynamicAttributes=dm,u.adjoint=function(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=i[4],w=i[5],T=i[6],S=i[7],P=i[8];return o[0]=v*P-w*S,o[1]=p*S-c*P,o[2]=c*w-p*v,o[3]=w*T-g*P,o[4]=s*P-p*T,o[5]=p*g-s*w,o[6]=g*S-v*T,o[7]=c*T-s*S,o[8]=s*v-c*g,o},u.asyncAll=dn,u.bezier=qr,u.bindAll=ci,u.boundsAttributes=Gv,u.bufferConvexPolygon=function(o,i){const s=[];for(let c=0;c<o.length;c++){const p=ir(c-1,-1,o.length-1),g=ir(c+1,-1,o.length-1),v=o[c],w=o[g],T=o[p].sub(v).unit(),S=w.sub(v).unit(),P=S.angleWithSep(T.x,T.y),N=T.add(S).unit().mult(-1*i/Math.sin(P/2));s.push(v.add(N))}return s},u.cacheEntryPossiblyAdded=function(o){Sl++,Sl>Gc&&(o.getActor().send("enforceCacheSizeLimit",ac),Sl=0)},u.calculateGlobeLabelMatrix=function(o,i){const{x:s,y:c}=o.point,p=Wy(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Ec(p,p,Hu(sa(i)))},u.calculateGlobeMatrix=function(o){const{x:i,y:s}=o.point,{lng:c,lat:p}=o._center;return Wy(i,s,o.worldSize,c,p)},u.calculateGlobeMercatorMatrix=function(o){const i=o.pixelsPerMeter,s=i/Wl(1,o.center.lat),c=ml(new Float64Array(16));return Hh(c,c,[o.point.x,o.point.y,0]),Cc(c,c,[s,s,i]),Float32Array.from(c)},u.circumferenceAtLatitude=Rp,u.clamp=Tn,u.clearTileCache=function(o){if(!ya())return;const i=Q.caches.delete(Ya);o&&i.catch(o).then(()=>o())},u.clipLine=Fv,u.clone=function(o){var i=new Ds(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},u.clone$1=Ln,u.collisionCircleLayout=Hg,u.config=Ae,u.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},u.create=function(){var o=new Ds(16);return Ds!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},u.create$1=dg,u.createExpression=Oa,u.createLayout=Pe,u.createStyleLayer=function(o){return"custom"===o.type?new fm(o):new f_[o.type](o)},u.cross=wp,u.degToRad=Lt,u.distance=function(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])},u.div=function(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o[2]=i[2]/s[2],o},u.dot=ra,u.earthRadius=ru,u.ease=Er,u.easeCubicInOut=$i,u.ecefToLatLng=function([o,i,s]){const c=Math.hypot(o,i,s),p=Math.atan2(o,s),g=.5*Math.PI-Math.acos(-i/c);return new mi(Cn(p),Cn(g))},u.emitValidationErrors=cp,u.endsWith=hi,u.enforceCacheSizeLimit=function(o){va(),io&&io.then(i=>{i.keys().then(s=>{for(let c=0;c<s.length-o;c++)i.delete(s[c])})})},u.evaluateSizeForFeature=wf,u.evaluateSizeForZoom=lu,u.evaluateVariableOffset=t_,u.evented=b,u.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},u.exactEquals$1=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},u.exported=zs,u.exported$1=Re,u.extend=ii,u.extend$1=rs,u.fillExtrusionHeightLift=Ng,u.filterObject=ns,u.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},u.fromQuat=function(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=s+s,w=c+c,T=p+p,S=s*v,P=c*v,N=c*w,F=p*v,V=p*w,j=p*T,q=g*v,J=g*w,se=g*T;return o[0]=1-N-j,o[1]=P+se,o[2]=F-J,o[3]=0,o[4]=P-se,o[5]=1-S-j,o[6]=V+q,o[7]=0,o[8]=F+J,o[9]=V-q,o[10]=1-S-N,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},u.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},u.fromScaling=xp,u.furthestTileCorner=function(o){const i=Math.round((o+45+360)%360/90)%4;return Ai[i]},u.getAABBPointSquareDist=function(o,i,s){let c=0;for(let p=0;p<2;++p){const g=s?s[p]:0;o[p]>g&&(c+=(o[p]-g)*(o[p]-g)),i[p]<g&&(c+=(g-i[p])*(g-i[p]))}return c},u.getAnchorAlignment=om,u.getAnchorJustification=Pf,u.getBounds=function(o){let i=1/0,s=1/0,c=-1/0,p=-1/0;for(const g of o)i=Math.min(i,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),p=Math.max(p,g.y);return{min:new Fe(i,s),max:new Fe(c,p)}},u.getColumn=_a,u.getDefaultExportFromCjs=he,u.getGridMatrix=function(o,i,s,c){const p=i.getNorth(),g=i.getSouth(),v=i.getWest(),w=i.getEast(),T=1<<o.z,S=w-v,P=p-g,N=S/64,F=-P/Xh[s],V=[0,N,0,F,0,0,p,v,0];if(o.z>0){const j=180/c;By(V,V,[j/S+1,0,0,0,j/P+1,0,-.5*j/N,.5*j/F,1])}return V[2]=T,V[5]=o.x,V[8]=o.y,V},u.getImage=ue,u.getJSON=function(o,i){return xa(ii(o,{type:"json"}),i)},u.getLatitudinalLod=function(o){const i=Bo-5;o=Tn(o,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(Lt(o))),3);return Math.round(s*(Xh.length-1))},u.getMapSessionAPI=Lr,u.getPerformanceMeasurement=Iu,u.getProjection=c_,u.getRTLTextPluginStatus=E,u.getReferrer=gs,u.getTilePoint=function(o,{x:i,y:s},c=0){return new Fe(((i-c)*o.scale-o.x)*gn,(s*o.scale-o.y)*gn)},u.getTileVec3=function(o,i,s=0){return Gh(((i.x-s)*o.scale-o.x)*gn,(i.y*o.scale-o.y)*gn,Ux(i.z,i.y))},u.getVideo=function(o,i){const s=Q.document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let c=0;c<o.length;c++){const p=Q.document.createElement("source");ba(o[c])||(s.crossOrigin="Anonymous"),p.src=o[c],s.appendChild(p)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(o){const i=[0,0,0],s=ml(new Float64Array(16));return Ec(s,o.pixelMatrix,o.globeMatrix),gr(i,i,s),new Fe(i[0],i[1])},u.globeDenormalizeECEF=Hu,u.globeECEFOrigin=function(o,i){const s=[0,0,0];return gr(s,s,Kh(sa(i.canonical))),gr(s,s,o),s},u.globeMetersToEcef=Mp,u.globeNormalizeECEF=Kh,u.globePixelsToTileUnits=function(o,i){return gn/(512*Math.pow(2,o))*Ap(sa(i))},u.globePoleMatrixForTile=function(o,i,s){const c=ml(new Float64Array(16)),p=(i/(1<<o)-.5)*Math.PI*2;return Jd(c,s.globeMatrix,p),Float32Array.from(c)},u.globeTileBounds=sa,u.globeTiltAtLngLat=Xy,u.globeToMercatorTransition=ho,u.globeUseCustomAntiAliasing=function(o,i,s){const c=ho(s.zoom),p=o.style.map._antialias,g=!!i.extStandardDerivatives,v=i.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===c&&!p&&!v&&g},u.identity=ml,u.identity$1=$u,u.invert=Kd,u.isFullscreen=function(){return!!Q.document.fullscreenElement||!!Q.document.webkitFullscreenElement},u.isLngLatBehindGlobe=xo,u.isMapAuthenticated=function(o){return Mr.has(o)},u.isMapboxURL=De,u.isSafariWithAntialiasingBug=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!Dl(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=zo,u.latLngToECEF=Sc,u.len=Cp,u.length=ju,u.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},u.lngFromMercatorX=la,u.loadVectorTile=As,u.makeRequest=xa,u.mapValue=function(o,i,s,c,p){return Tn((o-i)/(s-i)*(p-c)+c,c,p)},u.mercatorScale=jx,u.mercatorXfromLng=$a,u.mercatorYfromLat=ds,u.mercatorZfromAltitude=Wl,u.mul=Vy,u.mul$1=Ep,u.multiply=Ec,u.multiply$1=By,u.multiply$2=nu,u.nextPowerOfTwo=Dn,u.normalize=Ko,u.normalize$1=kE,u.normalize$2=gg,u.number=si,u.ortho=function(o,i,s,c,p,g,v){var w=1/(i-s),T=1/(c-p),S=1/(g-v);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(i+s)*w,o[13]=(p+c)*T,o[14]=(v+g)*S,o[15]=1,o},u.pbf=Gg,u.perspective=function(o,i,s,c,p){var g,v=1/Math.tan(i/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=p&&p!==1/0?(o[10]=(p+c)*(g=1/(c-p)),o[14]=2*p*c*g):(o[10]=-1,o[14]=-2*c),o},u.pick=function(o,i){const s={};for(let c=0;c<i.length;c++){const p=i[c];p in o&&(s[p]=o[p])}return s},u.plugin=A,u.pointGeometry=ke,u.polesInViewport=function(o){const i=ml(new Float64Array(16));Ec(i,o.pixelMatrix,o.globeMatrix);const s=[0,oa,0],c=[0,ja,0];return gr(s,s,i),gr(c,c,i),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!xo(o,new mi(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!xo(o,new mi(o.center.lat,-90))]},u.polygonContainsPoint=ou,u.polygonIntersectsBox=ev,u.polygonIntersectsPolygon=Qh,u.polygonizeBounds=function(o,i,s=0,c=!0){const p=new Fe(s,s),g=o.sub(p),v=i.add(p),w=[g,new Fe(v.x,g.y),v,new Fe(g.x,v.y)];return c&&w.push(g.clone()),w},u.posAttributes=nf,u.postMapLoadEvent=fr,u.postPerformanceEvent=Cr,u.postTurnstileEvent=zt,u.potpack=rh,u.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},u.radToDeg=Cn,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:a}),b.on("pluginStateChange",o),o},u.removeAuthState=function(o){Mr.delete(o)},u.renderColorRamp=Wu,u.resample=qu,u.rotateX=fg,u.rotateX$1=qh,u.rotateY=Jd,u.rotateY$1=jy,u.rotateZ=function(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[0],v=i[1],w=i[2],T=i[3],S=i[4],P=i[5],N=i[6],F=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*p+S*c,o[1]=v*p+P*c,o[2]=w*p+N*c,o[3]=T*p+F*c,o[4]=S*p-g*c,o[5]=P*p-v*c,o[6]=N*p-w*c,o[7]=F*p-T*c,o},u.rotateZ$1=function(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T+p*w,o[1]=p*T-c*w,o[2]=g*T+v*w,o[3]=v*T-g*w,o},u.scale=Cc,u.scale$1=Tp,u.scale$2=ia,u.scaleAndAdd=ef,u.set=function(o,i,s,c){return o[0]=i,o[1]=s,o[2]=c,o},u.setCacheLimits=function(o,i){ac=o,Gc=i},u.setColumn=function(o,i,s){o[4*i+0]=s[0],o[4*i+1]=s[1],o[4*i+2]=s[2],o[4*i+3]=s[3]},u.setRTLTextPlugin=function(o,i,s=!1){if(m===pp||m===pl||m===Fa)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=zs.resolveURL(o),m=pp,Uu=i,_(),s||I()},u.smoothstep=wn,u.spec=tt,u.squaredLength=function(o){var i=o[0],s=o[1],c=o[2];return i*i+s*s+c*c},u.storeAuthState=function(o,i){i?Mr.add(o):Mr.delete(o)},u.sub=Ms,u.subtract=Fo,u.symbolSize=Jp,u.tileAABB=function(o,i,s,c,p,g,v,w,T){if("globe"===T.name)return function Zy(o,i,s){const c=i/o.worldSize,p=o.globeMatrix;if(s.z<=1){const je=sa(s).getCorners();return xg(je,p,c),uo.fromPoints(je)}const g=af(s),v=Ip(g);xg(v,p,c);const w=Number.MAX_VALUE,T=[-w,-w,-w],S=[w,w,w];if(g.contains(o.center)){for(const wt of v)mr(S,S,wt),Qd(T,T,wt);T[2]=0;const je=o.point,ot=[je.x*c,je.y*c,0];return mr(S,S,ot),Qd(T,T,ot),new uo(S,T)}const P=[p[12]*c,p[13]*c,p[14]*c],N=g.getCenter(),F=Tn(o.center.lat,-Bo,Bo),V=Tn(N.lat,-Bo,Bo),j=$a(o.center.lng),q=ds(F);let J=j-$a(N.lng);const se=q-ds(V);J>.5?J-=1:J<-.5&&(J+=1);let pe=0;Math.abs(J)>Math.abs(se)?pe=J>=0?1:3:(pe=se>=0?0:2,ef(P,P,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(Lt(se>=0?g.getSouth():g.getNorth()))*Ua));const ae=v[pe],de=v[(pe+1)%4],ge=new vg(ae,de,P),me=[Sp(ge,0)||ae[0],Sp(ge,1)||ae[1],Sp(ge,2)||ae[2]],Ge=ho(o.zoom);if(Ge>0){const je=function({x:wt,y:Xe,z:ht},ct,_t,At,nt){const jt=1/(1<<ht);let nn=wt*jt,$t=nn+jt,Bn=Xe*jt,Rt=Bn+jt,_n=0;const Vn=(nn+$t)/2-At;return Vn>.5?_n=-1:Vn<-.5&&(_n=1),nn=((nn+_n)*ct-(At*=ct))*_t+At,$t=(($t+_n)*ct-At)*_t+At,Bn=(Bn*ct-(nt*=ct))*_t+nt,Rt=(Rt*ct-nt)*_t+nt,[[nn,Rt,0],[$t,Rt,0],[$t,Bn,0],[nn,Bn,0]]}(s,i,o._pixelsPerMercatorPixel,j,q);for(let wt=0;wt<v.length;wt++)Mc(v[wt],je[wt],Ge);const ot=Tc([],je[pe],je[(pe+1)%4]);ia(ot,ot,.5),Mc(me,ot,Ge)}for(const je of v)mr(S,S,je),Qd(T,T,je);return S[2]=Math.min(ae[2],de[2]),mr(S,S,me),Qd(T,T,me),new uo(S,T)}(o,i,new Qu(s,c,p));const S=uu({z:s,x:c,y:p},T);return new uo([(g+S.x/S.scale)*i,i*(S.y/S.scale),v],[(g+S.x2/S.scale)*i,i*(S.y2/S.scale),w])},u.tileCornersToBounds=af,u.tileTransform=uu,u.transformMat3=function(o,i,s){var c=i[0],p=i[1],g=i[2];return o[0]=c*s[0]+p*s[3]+g*s[6],o[1]=c*s[1]+p*s[4]+g*s[7],o[2]=c*s[2]+p*s[5]+g*s[8],o},u.transformMat4=gr,u.transformMat4$1=iu,u.transformQuat=Dc,u.transitionTileAABBinECEF=qy,u.translate=Hh,u.transpose=function(o,i){if(o===i){var s=i[1],c=i[2],p=i[5];o[1]=i[3],o[2]=i[6],o[3]=s,o[5]=i[7],o[6]=c,o[7]=p}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},u.triggerPluginCompletionEvent=d,u.uniqueId=Pi,u.updateGlobeVertexNormal=function(o,i,s,c,p){const g=5*i+2;o.float32[g+0]=s,o.float32[g+1]=c,o.float32[g+2]=p},u.validateCustomStyleLayer=function(o){const i=[],s=o.id;return void 0===s&&i.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},u.validateFilter=o=>Cs(Qs(o)),u.validateFog=o=>Cs(No(o)),u.validateLayer=o=>Cs(jl(o)),u.validateLight=o=>Cs(zr(o)),u.validateSource=o=>Cs(dl(o)),u.validateStyle=Bu,u.validateTerrain=o=>Cs(zh(o)),u.values=In,u.vectorTile=pf,u.version=Me,u.warnOnce=Yi,u.window=Q,u.wrap=ir}),Ve(0,function(u){function Q(fe){if("number"==typeof fe||"boolean"==typeof fe||"string"==typeof fe||null==fe)return JSON.stringify(fe);if(Array.isArray(fe)){let Y="[";for(const ue of fe)Y+=`${Q(ue)},`;return`${Y}]`}let Z="{";for(const Y of Object.keys(fe).sort())Z+=`${Y}:${Q(fe[Y])},`;return`${Z}}`}function Me(fe){let Z="";for(const Y of u.refProperties)Z+=`/${Q(fe[Y])}`;return Z}class Le{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Y){for(const ye of Z)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=u.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of Y)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ue=function(ye,De){const Be={};for(let Ce=0;Ce<ye.length;Ce++){const Ye=De&&De[ye[Ce].id]||Me(ye[Ce]);De&&(De[ye[Ce].id]=Ye);let Pt=Be[Ye];Pt||(Pt=Be[Ye]=[]),Pt.push(ye[Ce])}const ze=[];for(const Ce in Be)ze.push(Be[Ce]);return ze}(u.values(this._layerConfigs),this.keyCache);for(const ye of ue){const De=ye.map(Ft=>this._layers[Ft.id]),Be=De[0];if("none"===Be.visibility)continue;const ze=Be.source||"";let Ce=this.familiesBySource[ze];Ce||(Ce=this.familiesBySource[ze]={});const Ye=Be.sourceLayer||"_geojsonTileLayer";let Pt=Ce[Ye];Pt||(Pt=Ce[Ye]=[]),Pt.push(De)}}}class Ae{loadTile(Z,Y){const{uid:ue,encoding:ye,rawImageData:De,padding:Be,buildQuadTree:ze}=Z,Ce=u.window.ImageBitmap&&De instanceof u.window.ImageBitmap?this.getImageData(De,Be):De;Y(null,new u.DEMData(ue,Ce,ye,Be<1,ze))}getImageData(Z,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ue=this.offscreenCanvasContext.getImageData(-Y,-Y,Z.width+2*Y,Z.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}function Re(fe,Z){if(0!==fe.length){yt(fe[0],Z);for(var Y=1;Y<fe.length;Y++)yt(fe[Y],!Z)}}function yt(fe,Z){for(var Y=0,ue=0,ye=0,De=fe.length,Be=De-1;ye<De;Be=ye++){var ze=(fe[ye][0]-fe[Be][0])*(fe[Be][1]+fe[ye][1]),Ce=Y+ze;ue+=Math.abs(Y)>=Math.abs(ze)?Y-Ce+ze:ze-Ce+Y,Y=Ce}Y+ue>=0!=!!Z&&fe.reverse()}var Yt=u.getDefaultExportFromCjs(function fe(Z,Y){var ue,ye=Z&&Z.type;if("FeatureCollection"===ye)for(ue=0;ue<Z.features.length;ue++)fe(Z.features[ue],Y);else if("GeometryCollection"===ye)for(ue=0;ue<Z.geometries.length;ue++)fe(Z.geometries[ue],Y);else if("Feature"===ye)fe(Z.geometry,Y);else if("Polygon"===ye)Re(Z.coordinates,Y);else if("MultiPolygon"===ye)for(ue=0;ue<Z.coordinates.length;ue++)Re(Z.coordinates[ue],Y);return Z});const Bt=u.VectorTileFeature.prototype.toGeoJSON;var St={exports:{}},Nt=u.pointGeometry,kt=u.vectorTile.VectorTileFeature,he=Je;function Je(fe,Z){this.options=Z||{},this.features=fe,this.length=fe.length}function bt(fe,Z){this.id="number"==typeof fe.id?fe.id:void 0,this.type=fe.type,this.rawGeometry=1===fe.type?[fe.geometry]:fe.geometry,this.properties=fe.tags,this.extent=Z||4096}Je.prototype.feature=function(fe){return new bt(this.features[fe],this.options.extent)},bt.prototype.loadGeometry=function(){var fe=this.rawGeometry;this.geometry=[];for(var Z=0;Z<fe.length;Z++){for(var Y=fe[Z],ue=[],ye=0;ye<Y.length;ye++)ue.push(new Nt(Y[ye][0],Y[ye][1]));this.geometry.push(ue)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var fe=this.geometry,Z=1/0,Y=-1/0,ue=1/0,ye=-1/0,De=0;De<fe.length;De++)for(var Be=fe[De],ze=0;ze<Be.length;ze++){var Ce=Be[ze];Z=Math.min(Z,Ce.x),Y=Math.max(Y,Ce.x),ue=Math.min(ue,Ce.y),ye=Math.max(ye,Ce.y)}return[Z,ue,Y,ye]},bt.prototype.toGeoJSON=kt.prototype.toGeoJSON;var $e=u.pbf,ke=he;function at(fe){var Z=new $e;return function(Y,ue){for(var ye in Y.layers)ue.writeMessage(3,Fe,Y.layers[ye])}(fe,Z),Z.finish()}function Fe(fe,Z){var Y;Z.writeVarintField(15,fe.version||1),Z.writeStringField(1,fe.name||""),Z.writeVarintField(5,fe.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<fe.length;Y++)ue.feature=fe.feature(Y),Z.writeMessage(2,Ot,ue);var ye=ue.keys;for(Y=0;Y<ye.length;Y++)Z.writeStringField(3,ye[Y]);var De=ue.values;for(Y=0;Y<De.length;Y++)Z.writeMessage(4,$i,De[Y])}function Ot(fe,Z){var Y=fe.feature;void 0!==Y.id&&Z.writeVarintField(1,Y.id),Z.writeMessage(2,Wt,fe),Z.writeVarintField(3,Y.type),Z.writeMessage(4,Ai,Y)}function Wt(fe,Z){var Y=fe.feature,ue=fe.keys,ye=fe.values,De=fe.keycache,Be=fe.valuecache;for(var ze in Y.properties){var Ce=Y.properties[ze],Ye=De[ze];if(null!==Ce){void 0===Ye&&(ue.push(ze),De[ze]=Ye=ue.length-1),Z.writeVarint(Ye);var Pt=typeof Ce;"string"!==Pt&&"boolean"!==Pt&&"number"!==Pt&&(Ce=JSON.stringify(Ce));var Ft=Pt+":"+Ce,Ct=Be[Ft];void 0===Ct&&(ye.push(Ce),Be[Ft]=Ct=ye.length-1),Z.writeVarint(Ct)}}}function Lt(fe,Z){return(Z<<3)+(7&fe)}function Cn(fe){return fe<<1^fe>>31}function Ai(fe,Z){for(var Y=fe.loadGeometry(),ue=fe.type,ye=0,De=0,Be=Y.length,ze=0;ze<Be;ze++){var Ce=Y[ze],Ye=1;1===ue&&(Ye=Ce.length),Z.writeVarint(Lt(1,Ye));for(var Pt=3===ue?Ce.length-1:Ce.length,Ft=0;Ft<Pt;Ft++){1===Ft&&1!==ue&&Z.writeVarint(Lt(2,Pt-1));var Ct=Ce[Ft].x-ye,kn=Ce[Ft].y-De;Z.writeVarint(Cn(Ct)),Z.writeVarint(Cn(kn)),ye+=Ct,De+=kn}3===ue&&Z.writeVarint(Lt(7,1))}}function $i(fe,Z){var Y=typeof fe;"string"===Y?Z.writeStringField(1,fe):"boolean"===Y?Z.writeBooleanField(7,fe):"number"===Y&&(fe%1!=0?Z.writeDoubleField(3,fe):fe<0?Z.writeSVarintField(6,fe):Z.writeVarintField(5,fe))}St.exports=at,St.exports.fromVectorTileJs=at,St.exports.fromGeojsonVt=function(fe,Z){Z=Z||{};var Y={};for(var ue in fe)Y[ue]=new ke(fe[ue].features,Z),Y[ue].name=ue,Y[ue].version=Z.version,Y[ue].extent=Z.extent;return at({layers:Y})},St.exports.GeoJSONWrapper=ke;var qr=u.getDefaultExportFromCjs(St.exports);const Er={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},Tn=Math.fround||(wn=new Float32Array(1),fe=>(wn[0]=+fe,wn[0]));var wn;const ir=3,dn=5,In=6;class ii{constructor(Z){this.options=Object.assign(Object.create(Er),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Y,minZoom:ue,maxZoom:ye}=this.options;Y&&console.time("total time");const De=`prepare ${Z.length} points`;Y&&console.time(De),this.points=Z;const Be=[];for(let Ce=0;Ce<Z.length;Ce++){const Ye=Z[Ce];if(!Ye.geometry)continue;const[Pt,Ft]=Ye.geometry.coordinates,Ct=Tn(oi(Pt)),kn=Tn(Dn(Ft));Be.push(Ct,kn,1/0,Ce,-1,1),this.options.reduce&&Be.push(0)}let ze=this.trees[ye+1]=this._createTree(Be);Y&&console.timeEnd(De);for(let Ce=ye;Ce>=ue;Ce--){const Ye=+Date.now();ze=this.trees[Ce]=this._createTree(this._cluster(ze,Ce)),Y&&console.log("z%d: %d clusters in %dms",Ce,ze.numItems,+Date.now()-Ye)}return Y&&console.timeEnd("total time"),this}getClusters(Z,Y){let ue=((Z[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,Z[1]));let De=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ue=-180,De=180;else if(ue>De){const Ft=this.getClusters([ue,ye,180,Be],Y),Ct=this.getClusters([-180,ye,De,Be],Y);return Ft.concat(Ct)}const ze=this.trees[this._limitZoom(Y)],Ce=ze.range(oi(ue),Dn(Be),oi(De),Dn(ye)),Ye=ze.data,Pt=[];for(const Ft of Ce){const Ct=this.stride*Ft;Pt.push(Ye[Ct+dn]>1?Hi(Ye,Ct,this.clusterProps):this.points[Ye[Ct+ir]])}return Pt}getChildren(Z){const Y=this._getOriginId(Z),ue=this._getOriginZoom(Z),ye="No cluster with the specified id.",De=this.trees[ue];if(!De)throw new Error(ye);const Be=De.data;if(Y*this.stride>=Be.length)throw new Error(ye);const ze=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),Ce=De.within(Be[Y*this.stride],Be[Y*this.stride+1],ze),Ye=[];for(const Pt of Ce){const Ft=Pt*this.stride;Be[Ft+4]===Z&&Ye.push(Be[Ft+dn]>1?Hi(Be,Ft,this.clusterProps):this.points[Be[Ft+ir]])}if(0===Ye.length)throw new Error(ye);return Ye}getLeaves(Z,Y,ue){const ye=[];return this._appendLeaves(ye,Z,Y=Y||10,ue=ue||0,0),ye}getTile(Z,Y,ue){const ye=this.trees[this._limitZoom(Z)],De=Math.pow(2,Z),{extent:Be,radius:ze}=this.options,Ce=ze/Be,Ye=(ue-Ce)/De,Pt=(ue+1+Ce)/De,Ft={features:[]};return this._addTileFeatures(ye.range((Y-Ce)/De,Ye,(Y+1+Ce)/De,Pt),ye.data,Y,ue,De,Ft),0===Y&&this._addTileFeatures(ye.range(1-Ce/De,Ye,1,Pt),ye.data,De,ue,De,Ft),Y===De-1&&this._addTileFeatures(ye.range(0,Ye,Ce/De,Pt),ye.data,-1,ue,De,Ft),Ft.features.length?Ft:null}getClusterExpansionZoom(Z){let Y=this._getOriginZoom(Z)-1;for(;Y<=this.options.maxZoom;){const ue=this.getChildren(Z);if(Y++,1!==ue.length)break;Z=ue[0].properties.cluster_id}return Y}_appendLeaves(Z,Y,ue,ye,De){const Be=this.getChildren(Y);for(const ze of Be){const Ce=ze.properties;if(Ce&&Ce.cluster?De+Ce.point_count<=ye?De+=Ce.point_count:De=this._appendLeaves(Z,Ce.cluster_id,ue,ye,De):De<ye?De++:Z.push(ze),Z.length===ue)break}return De}_createTree(Z){const Y=new u.KDBush(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<Z.length;ue+=this.stride)Y.add(Z[ue],Z[ue+1]);return Y.finish(),Y.data=Z,Y}_addTileFeatures(Z,Y,ue,ye,De,Be){for(const ze of Z){const Ce=ze*this.stride,Ye=Y[Ce+dn]>1;let Pt,Ft,Ct;if(Ye)Pt=Pi(Y,Ce,this.clusterProps),Ft=Y[Ce],Ct=Y[Ce+1];else{const zn=this.points[Y[Ce+ir]];Pt=zn.properties;const[Mn,zt]=zn.geometry.coordinates;Ft=oi(Mn),Ct=Dn(zt)}const kn={type:1,geometry:[[Math.round(this.options.extent*(Ft*De-ue)),Math.round(this.options.extent*(Ct*De-ye))]],tags:Pt};let Gn;Gn=Ye||this.options.generateId?Y[Ce+ir]:this.points[Y[Ce+ir]].id,void 0!==Gn&&(kn.id=Gn),Be.features.push(kn)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Y){const{radius:ue,extent:ye,reduce:De,minPoints:Be}=this.options,ze=ue/(ye*Math.pow(2,Y)),Ce=Z.data,Ye=[],Pt=this.stride;for(let Ft=0;Ft<Ce.length;Ft+=Pt){if(Ce[Ft+2]<=Y)continue;Ce[Ft+2]=Y;const Ct=Ce[Ft],kn=Ce[Ft+1],Gn=Z.within(Ce[Ft],Ce[Ft+1],ze),zn=Ce[Ft+dn];let Mn=zn;for(const zt of Gn){const zi=zt*Pt;Ce[zi+2]>Y&&(Mn+=Ce[zi+dn])}if(Mn>zn&&Mn>=Be){let zt,zi=Ct*zn,fr=kn*zn,Ei=-1;const Cr=((Ft/Pt|0)<<5)+(Y+1)+this.points.length;for(const jo of Gn){const Lr=jo*Pt;if(Ce[Lr+2]<=Y)continue;Ce[Lr+2]=Y;const Mr=Ce[Lr+dn];zi+=Ce[Lr]*Mr,fr+=Ce[Lr+1]*Mr,Ce[Lr+4]=Cr,De&&(zt||(zt=this._map(Ce,Ft,!0),Ei=this.clusterProps.length,this.clusterProps.push(zt)),De(zt,this._map(Ce,Lr)))}Ce[Ft+4]=Cr,Ye.push(zi/Mn,fr/Mn,1/0,Cr,-1,Mn),De&&Ye.push(Ei)}else{for(let zt=0;zt<Pt;zt++)Ye.push(Ce[Ft+zt]);if(Mn>1)for(const zt of Gn){const zi=zt*Pt;if(!(Ce[zi+2]<=Y)){Ce[zi+2]=Y;for(let fr=0;fr<Pt;fr++)Ye.push(Ce[zi+fr])}}}}return Ye}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Y,ue){if(Z[Y+dn]>1){const Be=this.clusterProps[Z[Y+In]];return ue?Object.assign({},Be):Be}const ye=this.points[Z[Y+ir]].properties,De=this.options.map(ye);return ue&&De===ye?Object.assign({},De):De}}function Hi(fe,Z,Y){return{type:"Feature",id:fe[Z+ir],properties:Pi(fe,Z,Y),geometry:{type:"Point",coordinates:[(ue=fe[Z],360*(ue-.5)),Zr(fe[Z+1])]}};var ue}function Pi(fe,Z,Y){const ue=fe[Z+dn],ye=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,De=fe[Z+In],Be=-1===De?{}:Object.assign({},Y[De]);return Object.assign(Be,{cluster:!0,cluster_id:fe[Z+ir],point_count:ue,point_count_abbreviated:ye})}function oi(fe){return fe/360+.5}function Dn(fe){const Z=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function Zr(fe){const Z=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function ci(fe,Z,Y,ue){for(var ye,De=ue,Be=Y-Z>>1,ze=Y-Z,Ce=fe[Z],Ye=fe[Z+1],Pt=fe[Y],Ft=fe[Y+1],Ct=Z+3;Ct<Y;Ct+=3){var kn=hi(fe[Ct],fe[Ct+1],Ce,Ye,Pt,Ft);if(kn>De)ye=Ct,De=kn;else if(kn===De){var Gn=Math.abs(Ct-Be);Gn<ze&&(ye=Ct,ze=Gn)}}De>ue&&(ye-Z>3&&ci(fe,Z,ye,ue),fe[ye+2]=De,Y-ye>3&&ci(fe,ye,Y,ue))}function hi(fe,Z,Y,ue,ye,De){var Be=ye-Y,ze=De-ue;if(0!==Be||0!==ze){var Ce=((fe-Y)*Be+(Z-ue)*ze)/(Be*Be+ze*ze);Ce>1?(Y=ye,ue=De):Ce>0&&(Y+=Be*Ce,ue+=ze*Ce)}return(Be=fe-Y)*Be+(ze=Z-ue)*ze}function ln(fe,Z,Y,ue){var ye={id:void 0===fe?null:fe,type:Z,geometry:Y,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Be=De.geometry,ze=De.type;if("Point"===ze||"MultiPoint"===ze||"LineString"===ze)ns(De,Be);else if("Polygon"===ze||"MultiLineString"===ze)for(var Ce=0;Ce<Be.length;Ce++)ns(De,Be[Ce]);else if("MultiPolygon"===ze)for(Ce=0;Ce<Be.length;Ce++)for(var Ye=0;Ye<Be[Ce].length;Ye++)ns(De,Be[Ce][Ye])}(ye),ye}function ns(fe,Z){for(var Y=0;Y<Z.length;Y+=3)fe.minX=Math.min(fe.minX,Z[Y]),fe.minY=Math.min(fe.minY,Z[Y+1]),fe.maxX=Math.max(fe.maxX,Z[Y]),fe.maxY=Math.max(fe.maxY,Z[Y+1])}function Ln(fe,Z,Y,ue){if(Z.geometry){var ye=Z.geometry.coordinates,De=Z.geometry.type,Be=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),ze=[],Ce=Z.id;if(Y.promoteId?Ce=Z.properties[Y.promoteId]:Y.generateId&&(Ce=ue||0),"Point"===De)Os(ye,ze);else if("MultiPoint"===De)for(var Ye=0;Ye<ye.length;Ye++)Os(ye[Ye],ze);else if("LineString"===De)Yi(ye,ze,Be,!1);else if("MultiLineString"===De){if(Y.lineMetrics){for(Ye=0;Ye<ye.length;Ye++)Yi(ye[Ye],ze=[],Be,!1),fe.push(ln(Ce,"LineString",ze,Z.properties));return}go(ye,ze,Be,!1)}else if("Polygon"===De)go(ye,ze,Be,!0);else{if("MultiPolygon"!==De){if("GeometryCollection"===De){for(Ye=0;Ye<Z.geometry.geometries.length;Ye++)Ln(fe,{id:Ce,geometry:Z.geometry.geometries[Ye],properties:Z.properties},Y,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ye=0;Ye<ye.length;Ye++){var Pt=[];go(ye[Ye],Pt,Be,!0),ze.push(Pt)}}fe.push(ln(Ce,De,ze,Z.properties))}}function Os(fe,Z){Z.push(sc(fe[0])),Z.push(is(fe[1])),Z.push(0)}function Yi(fe,Z,Y,ue){for(var ye,De,Be=0,ze=0;ze<fe.length;ze++){var Ce=sc(fe[ze][0]),Ye=is(fe[ze][1]);Z.push(Ce),Z.push(Ye),Z.push(0),ze>0&&(Be+=ue?(ye*Ye-Ce*De)/2:Math.sqrt(Math.pow(Ce-ye,2)+Math.pow(Ye-De,2))),ye=Ce,De=Ye}var Pt=Z.length-3;Z[2]=1,ci(Z,0,Pt,Y),Z[Pt+2]=1,Z.size=Math.abs(Be),Z.start=0,Z.end=Z.size}function go(fe,Z,Y,ue){for(var ye=0;ye<fe.length;ye++){var De=[];Yi(fe[ye],De,Y,ue),Z.push(De)}}function sc(fe){return fe/360+.5}function is(fe){var Z=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function no(fe,Z,Y,ue,ye,De,Be,ze){if(ue/=Z,De>=(Y/=Z)&&Be<ue)return fe;if(Be<Y||De>=ue)return null;for(var Ce=[],Ye=0;Ye<fe.length;Ye++){var Pt=fe[Ye],Ft=Pt.geometry,Ct=Pt.type,kn=0===ye?Pt.minX:Pt.minY,Gn=0===ye?Pt.maxX:Pt.maxY;if(kn>=Y&&Gn<ue)Ce.push(Pt);else if(!(Gn<Y||kn>=ue)){var zn=[];if("Point"===Ct||"MultiPoint"===Ct)Hc(Ft,zn,Y,ue,ye);else if("LineString"===Ct)Dl(Ft,zn,Y,ue,ye,!1,ze.lineMetrics);else if("MultiLineString"===Ct)_a(Ft,zn,Y,ue,ye,!1);else if("Polygon"===Ct)_a(Ft,zn,Y,ue,ye,!0);else if("MultiPolygon"===Ct)for(var Mn=0;Mn<Ft.length;Mn++){var zt=[];_a(Ft[Mn],zt,Y,ue,ye,!0),zt.length&&zn.push(zt)}if(zn.length){if(ze.lineMetrics&&"LineString"===Ct){for(Mn=0;Mn<zn.length;Mn++)Ce.push(ln(Pt.id,Ct,zn[Mn],Pt.tags));continue}"LineString"!==Ct&&"MultiLineString"!==Ct||(1===zn.length?(Ct="LineString",zn=zn[0]):Ct="MultiLineString"),"Point"!==Ct&&"MultiPoint"!==Ct||(Ct=3===zn.length?"Point":"MultiPoint"),Ce.push(ln(Pt.id,Ct,zn,Pt.tags))}}}return Ce.length?Ce:null}function Hc(fe,Z,Y,ue,ye){for(var De=0;De<fe.length;De+=3){var Be=fe[De+ye];Be>=Y&&Be<=ue&&(Z.push(fe[De]),Z.push(fe[De+1]),Z.push(fe[De+2]))}}function Dl(fe,Z,Y,ue,ye,De,Be){for(var ze,Ce,Ye=Ml(fe),Pt=0===ye?ac:Gc,Ft=fe.start,Ct=0;Ct<fe.length-3;Ct+=3){var kn=fe[Ct],Gn=fe[Ct+1],zn=fe[Ct+2],Mn=fe[Ct+3],zt=fe[Ct+4],zi=0===ye?kn:Gn,fr=0===ye?Mn:zt,Ei=!1;Be&&(ze=Math.sqrt(Math.pow(kn-Mn,2)+Math.pow(Gn-zt,2))),zi<Y?fr>Y&&(Ce=Pt(Ye,kn,Gn,Mn,zt,Y),Be&&(Ye.start=Ft+ze*Ce)):zi>ue?fr<ue&&(Ce=Pt(Ye,kn,Gn,Mn,zt,ue),Be&&(Ye.start=Ft+ze*Ce)):Ya(Ye,kn,Gn,zn),fr<Y&&zi>=Y&&(Ce=Pt(Ye,kn,Gn,Mn,zt,Y),Ei=!0),fr>ue&&zi<=ue&&(Ce=Pt(Ye,kn,Gn,Mn,zt,ue),Ei=!0),!De&&Ei&&(Be&&(Ye.end=Ft+ze*Ce),Z.push(Ye),Ye=Ml(fe)),Be&&(Ft+=ze)}var Cr=fe.length-3;kn=fe[Cr],Gn=fe[Cr+1],zn=fe[Cr+2],(zi=0===ye?kn:Gn)>=Y&&zi<=ue&&Ya(Ye,kn,Gn,zn),Cr=Ye.length-3,De&&Cr>=3&&(Ye[Cr]!==Ye[0]||Ye[Cr+1]!==Ye[1])&&Ya(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&Z.push(Ye)}function Ml(fe){var Z=[];return Z.size=fe.size,Z.start=fe.start,Z.end=fe.end,Z}function _a(fe,Z,Y,ue,ye,De){for(var Be=0;Be<fe.length;Be++)Dl(fe[Be],Z,Y,ue,ye,De,!1)}function Ya(fe,Z,Y,ue){fe.push(Z),fe.push(Y),fe.push(ue)}function ac(fe,Z,Y,ue,ye,De){var Be=(De-Z)/(ue-Z);return fe.push(De),fe.push(Y+(ye-Y)*Be),fe.push(1),Be}function Gc(fe,Z,Y,ue,ye,De){var Be=(De-Y)/(ye-Y);return fe.push(Z+(ue-Z)*Be),fe.push(De),fe.push(1),Be}function io(fe,Z){for(var Y=[],ue=0;ue<fe.length;ue++){var ye,De=fe[ue],Be=De.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)ye=Ns(De.geometry,Z);else if("MultiLineString"===Be||"Polygon"===Be){ye=[];for(var ze=0;ze<De.geometry.length;ze++)ye.push(Ns(De.geometry[ze],Z))}else if("MultiPolygon"===Be)for(ye=[],ze=0;ze<De.geometry.length;ze++){for(var Ce=[],Ye=0;Ye<De.geometry[ze].length;Ye++)Ce.push(Ns(De.geometry[ze][Ye],Z));ye.push(Ce)}Y.push(ln(De.id,Be,ye,De.tags))}return Y}function Ns(fe,Z){var Y=[];Y.size=fe.size,void 0!==fe.start&&(Y.start=fe.start,Y.end=fe.end);for(var ue=0;ue<fe.length;ue+=3)Y.push(fe[ue]+Z,fe[ue+1],fe[ue+2]);return Y}function ya(fe,Z){if(fe.transformed)return fe;var Y,ue,ye,De=1<<fe.z,Be=fe.x,ze=fe.y;for(Y=0;Y<fe.features.length;Y++){var Ce=fe.features[Y],Ye=Ce.geometry,Pt=Ce.type;if(Ce.geometry=[],1===Pt)for(ue=0;ue<Ye.length;ue+=2)Ce.geometry.push(va(Ye[ue],Ye[ue+1],Z,De,Be,ze));else for(ue=0;ue<Ye.length;ue++){var Ft=[];for(ye=0;ye<Ye[ue].length;ye+=2)Ft.push(va(Ye[ue][ye],Ye[ue][ye+1],Z,De,Be,ze));Ce.geometry.push(Ft)}}return fe.transformed=!0,fe}function va(fe,Z,Y,ue,ye,De){return[Math.round(Y*(fe*ue-ye)),Math.round(Y*(Z*ue-De))]}function Ka(fe,Z,Y,ue,ye){for(var De=Z===ye.maxZoom?0:ye.tolerance/((1<<Z)*ye.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ue,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ze=0;ze<fe.length;ze++){Be.numFeatures++,Sl(Be,fe[ze],De,ye);var Ce=fe[ze].minX,Ye=fe[ze].minY,Pt=fe[ze].maxX,Ft=fe[ze].maxY;Ce<Be.minX&&(Be.minX=Ce),Ye<Be.minY&&(Be.minY=Ye),Pt>Be.maxX&&(Be.maxX=Pt),Ft>Be.maxY&&(Be.maxY=Ft)}return Be}function Sl(fe,Z,Y,ue){var ye=Z.geometry,De=Z.type,Be=[];if("Point"===De||"MultiPoint"===De)for(var ze=0;ze<ye.length;ze+=3)Be.push(ye[ze]),Be.push(ye[ze+1]),fe.numPoints++,fe.numSimplified++;else if("LineString"===De)Ja(Be,ye,fe,Y,!1,!1);else if("MultiLineString"===De||"Polygon"===De)for(ze=0;ze<ye.length;ze++)Ja(Be,ye[ze],fe,Y,"Polygon"===De,0===ze);else if("MultiPolygon"===De)for(var Ce=0;Ce<ye.length;Ce++){var Ye=ye[Ce];for(ze=0;ze<Ye.length;ze++)Ja(Be,Ye[ze],fe,Y,!0,0===ze)}if(Be.length){var Pt=Z.tags||null;if("LineString"===De&&ue.lineMetrics){for(var Ft in Pt={},Z.tags)Pt[Ft]=Z.tags[Ft];Pt.mapbox_clip_start=ye.start/ye.size,Pt.mapbox_clip_end=ye.end/ye.size}var Ct={geometry:Be,type:"Polygon"===De||"MultiPolygon"===De?3:"LineString"===De||"MultiLineString"===De?2:1,tags:Pt};null!==Z.id&&(Ct.id=Z.id),fe.features.push(Ct)}}function Ja(fe,Z,Y,ue,ye,De){var Be=ue*ue;if(ue>0&&Z.size<(ye?Be:ue))Y.numPoints+=Z.length/3;else{for(var ze=[],Ce=0;Ce<Z.length;Ce+=3)(0===ue||Z[Ce+2]>Be)&&(Y.numSimplified++,ze.push(Z[Ce]),ze.push(Z[Ce+1])),Y.numPoints++;ye&&function(Ye,Pt){for(var Ft=0,Ct=0,kn=Ye.length,Gn=kn-2;Ct<kn;Gn=Ct,Ct+=2)Ft+=(Ye[Ct]-Ye[Gn])*(Ye[Ct+1]+Ye[Gn+1]);if(Ft>0===Pt)for(Ct=0,kn=Ye.length;Ct<kn/2;Ct+=2){var zn=Ye[Ct],Mn=Ye[Ct+1];Ye[Ct]=Ye[kn-2-Ct],Ye[Ct+1]=Ye[kn-1-Ct],Ye[kn-2-Ct]=zn,Ye[kn-1-Ct]=Mn}}(ze,De),fe.push(ze)}}function ro(fe,Z){var Y=(Z=this.options=function(ye,De){for(var Be in De)ye[Be]=De[Be];return ye}(Object.create(this.options),Z)).debug;if(Y&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye,De,Be,ze,Ce,Ye,ue=function(ye,De){var Be=[];if("FeatureCollection"===ye.type)for(var ze=0;ze<ye.features.length;ze++)Ln(Be,ye.features[ze],De,ze);else Ln(Be,"Feature"===ye.type?ye:{geometry:ye},De);return Be}(fe,Z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=ye=ue,Ce=no(ye,1,-1-(Be=(De=Z).buffer/De.extent),Be,0,-1,2,De),Ye=no(ye,1,1-Be,2+Be,0,-1,2,De),(Ce||Ye)&&(ze=no(ye,1,-Be,1+Be,0,-1,2,De)||[],Ce&&(ze=io(Ce,1).concat(ze)),Ye&&(ze=ze.concat(io(Ye,-1)))),(ue=ze).length&&this.splitTile(ue,0,0,0),Y&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gs(fe,Z,Y){return 32*((1<<fe)*Y+Z)+fe}function xa(fe,Z){const Y=fe.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ue=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ue)return Z(null,null);const ye=new class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=Be.length,this._features=Be}feature(Be){return new class{constructor(ze){this._feature=ze,this.extent=u.EXTENT,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(1===this._feature.type){const ze=[];for(const Ce of this._feature.geometry)ze.push([new u.Point(Ce[0],Ce[1])]);return ze}{const ze=[];for(const Ce of this._feature.geometry){const Ye=[];for(const Pt of Ce)Ye.push(new u.Point(Pt[0],Pt[1]));ze.push(Ye)}return ze}}toGeoJSON(ze,Ce,Ye){return Bt.call(this,ze,Ce,Ye)}}(this._features[Be])}}(ue.features);let De=qr(ye);0===De.byteOffset&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),Z(null,{vectorTile:ye,rawData:De.buffer})}ro.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ro.prototype.splitTile=function(fe,Z,Y,ue,ye,De,Be){for(var ze=[fe,Z,Y,ue],Ce=this.options,Ye=Ce.debug;ze.length;){ue=ze.pop(),Y=ze.pop(),Z=ze.pop(),fe=ze.pop();var Pt=1<<Z,Ft=gs(Z,Y,ue),Ct=this.tiles[Ft];if(!Ct&&(Ye>1&&console.time("creation"),Ct=this.tiles[Ft]=Ka(fe,Z,Y,ue,Ce),this.tileCoords.push({z:Z,x:Y,y:ue}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Y,ue,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));var kn="z"+Z;this.stats[kn]=(this.stats[kn]||0)+1,this.total++}if(Ct.source=fe,ye){if(Z===Ce.maxZoom||Z===ye)continue;var Gn=1<<ye-Z;if(Y!==Math.floor(De/Gn)||ue!==Math.floor(Be/Gn))continue}else if(Z===Ce.indexMaxZoom||Ct.numPoints<=Ce.indexMaxPoints)continue;if(Ct.source=null,0!==fe.length){Ye>1&&console.time("clipping");var zn,Mn,zt,zi,fr,Ei,Cr=.5*Ce.buffer/Ce.extent,jo=.5-Cr,Lr=.5+Cr,Mr=1+Cr;zn=Mn=zt=zi=null,fr=no(fe,Pt,Y-Cr,Y+Lr,0,Ct.minX,Ct.maxX,Ce),Ei=no(fe,Pt,Y+jo,Y+Mr,0,Ct.minX,Ct.maxX,Ce),fe=null,fr&&(zn=no(fr,Pt,ue-Cr,ue+Lr,1,Ct.minY,Ct.maxY,Ce),Mn=no(fr,Pt,ue+jo,ue+Mr,1,Ct.minY,Ct.maxY,Ce),fr=null),Ei&&(zt=no(Ei,Pt,ue-Cr,ue+Lr,1,Ct.minY,Ct.maxY,Ce),zi=no(Ei,Pt,ue+jo,ue+Mr,1,Ct.minY,Ct.maxY,Ce),Ei=null),Ye>1&&console.timeEnd("clipping"),ze.push(zn||[],Z+1,2*Y,2*ue),ze.push(Mn||[],Z+1,2*Y,2*ue+1),ze.push(zt||[],Z+1,2*Y+1,2*ue),ze.push(zi||[],Z+1,2*Y+1,2*ue+1)}}},ro.prototype.getTile=function(fe,Z,Y){var ue=this.options,ye=ue.extent,De=ue.debug;if(fe<0||fe>24)return null;var Be=1<<fe,ze=gs(fe,Z=(Z%Be+Be)%Be,Y);if(this.tiles[ze])return ya(this.tiles[ze],ye);De>1&&console.log("drilling down to z%d-%d-%d",fe,Z,Y);for(var Ce,Ye=fe,Pt=Z,Ft=Y;!Ce&&Ye>0;)Ye--,Pt=Math.floor(Pt/2),Ft=Math.floor(Ft/2),Ce=this.tiles[gs(Ye,Pt,Ft)];return Ce&&Ce.source?(De>1&&console.log("found parent tile z%d-%d-%d",Ye,Pt,Ft),De>1&&console.time("drilling down"),this.splitTile(Ce.source,Ye,Pt,Ft,fe,Z,Y),De>1&&console.timeEnd("drilling down"),this.tiles[ze]?ya(this.tiles[ze],ye):null):null};class Qa extends u.VectorTileWorkerSource{constructor(Z,Y,ue,ye,De){super(Z,Y,ue,ye,xa),De&&(this.loadGeoJSON=De)}loadData(Z,Y){const ue=Z&&Z.request,ye=ue&&ue.collectResourceTiming;this.loadGeoJSON(Z,(De,Be)=>{if(De||!Be)return Y(De);if("object"!=typeof Be)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Yt(Be,!0);try{if(Z.filter){const Ce=u.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ce.result)throw new Error(Ce.value.map(Pt=>`${Pt.key}: ${Pt.message}`).join(", "));Be={type:"FeatureCollection",features:Be.features.filter(Pt=>Ce.value.evaluate({zoom:0},Pt))}}this._geoJSONIndex=Z.cluster?new ii(function({superclusterOptions:Ce,clusterProperties:Ye}){if(!Ye||!Ce)return Ce;const Pt={},Ft={},Ct={accumulated:null,zoom:0},kn={properties:null},Gn=Object.keys(Ye);for(const zn of Gn){const[Mn,zt]=Ye[zn],zi=u.createExpression(zt),fr=u.createExpression("string"==typeof Mn?[Mn,["accumulated"],["get",zn]]:Mn);Pt[zn]=zi.value,Ft[zn]=fr.value}return Ce.map=zn=>{kn.properties=zn;const Mn={};for(const zt of Gn)Mn[zt]=Pt[zt].evaluate(Ct,kn);return Mn},Ce.reduce=(zn,Mn)=>{kn.properties=Mn;for(const zt of Gn)Ct.accumulated=zn[zt],zn[zt]=Ft[zt].evaluate(Ct,kn)},Ce}(Z)).load(Be.features):new ro(Ce=Be,Z.geojsonVtOptions)}catch(Ce){return Y(Ce)}this.loaded={};const ze={};if(ye){const Ce=u.getPerformanceMeasurement(ue);Ce&&(ze.resourceTiming={},ze.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ce)))}Y(null,ze)}var Ce})}reloadTile(Z,Y){const ue=this.loaded;return ue&&ue[Z.uid]?super.reloadTile(Z,Y):this.loadTile(Z,Y)}loadGeoJSON(Z,Y){if(Z.request)u.getJSON(Z.request,Y);else{if("string"!=typeof Z.data)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(Z.data))}catch{return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ue){Y(ue)}}getClusterChildren(Z,Y){try{Y(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ue){Y(ue)}}getClusterLeaves(Z,Y){try{Y(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ue){Y(ue)}}}class ba{constructor(Z){this.self=Z,this.actor=new u.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Qa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,ue)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ue},this.self.registerRTLTextPlugin=Y=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=Y.applyArabicShaping,u.plugin.processBidirectionalText=Y.processBidirectionalText,u.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(Z,Y,ue){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],ue()}checkIfReady(Z,Y,ue){ue()}setReferrer(Z,Y){this.referrer=Y}spriteLoaded(Z,Y){this.isSpriteLoaded[Z]=Y;for(const ue in this.workerSources[Z]){const ye=this.workerSources[Z][ue];for(const De in ye)ye[De]instanceof u.VectorTileWorkerSource&&(ye[De].isSpriteLoaded=Y,ye[De].fire(new u.Event("isSpriteLoaded")))}}setImages(Z,Y,ue){this.availableImages[Z]=Y;for(const ye in this.workerSources[Z]){const De=this.workerSources[Z][ye];for(const Be in De)De[Be].availableImages=Y}ue()}enableTerrain(Z,Y,ue){this.terrain=Y,ue()}setProjection(Z,Y){this.projections[Z]=u.getProjection(Y)}setLayers(Z,Y,ue){this.getLayerIndex(Z).replace(Y),ue()}updateLayers(Z,Y,ue){this.getLayerIndex(Z).update(Y.layers,Y.removedIds),ue()}loadTile(Z,Y,ue){const ye=this.enableTerrain?u.extend({enableTerrain:this.terrain},Y):Y;ye.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Y.type,Y.source).loadTile(ye,ue)}loadDEMTile(Z,Y,ue){const ye=this.enableTerrain?u.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(Z,Y.source).loadTile(ye,ue)}reloadTile(Z,Y,ue){const ye=this.enableTerrain?u.extend({enableTerrain:this.terrain},Y):Y;ye.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Y.type,Y.source).reloadTile(ye,ue)}abortTile(Z,Y,ue){this.getWorkerSource(Z,Y.type,Y.source).abortTile(Y,ue)}removeTile(Z,Y,ue){this.getWorkerSource(Z,Y.type,Y.source).removeTile(Y,ue)}removeSource(Z,Y,ue){if(!this.workerSources[Z]||!this.workerSources[Z][Y.type]||!this.workerSources[Z][Y.type][Y.source])return;const ye=this.workerSources[Z][Y.type][Y.source];delete this.workerSources[Z][Y.type][Y.source],void 0!==ye.removeSource?ye.removeSource(Y,ue):ue()}loadWorkerSource(Z,Y,ue){try{this.self.importScripts(Y.url),ue()}catch(ye){ue(ye.toString())}}syncRTLPluginState(Z,Y,ue){try{u.plugin.setState(Y);const ye=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=ye){this.self.importScripts(ye);const De=u.plugin.isParsed();ue(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),De)}}catch(ye){ue(ye.toString())}}getAvailableImages(Z){let Y=this.availableImages[Z];return Y||(Y=[]),Y}getLayerIndex(Z){let Y=this.layerIndexes[Z];return Y||(Y=this.layerIndexes[Z]=new Le),Y}getWorkerSource(Z,Y,ue){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Y]||(this.workerSources[Z][Y]={}),this.workerSources[Z][Y][ue]||(this.workerSources[Z][Y][ue]=new this.workerSourceTypes[Y]({send:(De,Be,ze,Ce,Ye,Pt)=>{this.actor.send(De,Be,ze,Z,Ye,Pt)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][Y][ue]}getDEMWorkerSource(Z,Y){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Y]||(this.demWorkerSources[Z][Y]=new Ae),this.demWorkerSources[Z][Y]}enforceCacheSizeLimit(Z,Y){u.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(Z,Y,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ba(self)),ba}),Ve(0,function(u){function Q(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let d=0;d<m.length;d++)if(!Q(m[d],a[d]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==a){if("object"!=typeof a||Object.keys(m).length!==Object.keys(a).length)return!1;for(const d in m)if(!Q(m[d],a[d]))return!1;return!0}return m===a}var Me=Le;function Le(m){return a=m,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,E=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(E);try{b=new Worker(I),_=!0}catch{_=!1}return b&&b.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===_.width}()||(void 0===Ae[d=a&&a.failIfMajorPerformanceCaveat]&&(Ae[d]=function(_){var b,I,A,R,E=(I=_,A=document.createElement("canvas"),(R=Object.create(Le.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,A.getContext("webgl",R)||A.getContext("experimental-webgl",R));if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),!0===E.getShaderParameter(b,E.COMPILE_STATUS))}(d)),!Ae[d]||document.documentMode));var a,d}var Ae={};function Re(m,a,d){const _=u.window.document.createElement(m);return void 0!==a&&(_.className=a),d&&d.appendChild(_),_}function yt(m,a,d){const _=u.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(a))_.setAttributeNS(null,b,a[b]);return d&&d.appendChild(_),_}Le.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Yt=u.window.document&&u.window.document.documentElement.style,Bt=Yt&&void 0!==Yt.userSelect?"userSelect":"WebkitUserSelect";let St;function Nt(){Yt&&Bt&&(St=Yt[Bt],Yt[Bt]="none")}function kt(){Yt&&Bt&&(Yt[Bt]=St)}function he(m){m.preventDefault(),m.stopPropagation(),u.window.removeEventListener("click",he,!0)}function Je(){u.window.addEventListener("click",he,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",he,!0)},0)}function bt(m,a){const d=m.getBoundingClientRect();return at(m,d,a)}function $e(m,a){const d=m.getBoundingClientRect(),_=[];for(let b=0;b<a.length;b++)_.push(at(m,d,a[b]));return _}function ke(m){return void 0!==u.window.InstallTrigger&&2===m.button&&m.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function at(m,a,d){const _=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new u.Point((d.clientX-a.left)*_,(d.clientY-a.top)*_)}function Fe(m,a){var d=a[0],_=a[1],b=a[2],E=a[3],I=d*E-b*_;return I?(m[0]=E*(I=1/I),m[1]=-_*I,m[2]=-b*I,m[3]=d*I,m):null}function Ot(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class Wt extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,d){this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,d){if(!a)return!0;let _=0;for(const b of a){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(a,d){return!(a&&(4!==a.length||a[0]<0||d.data.width<a[0]||a[1]<0||d.data.height<a[1]||a[2]<0||d.data.width<a[2]||a[3]<0||d.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,d){d.version=this.images[a].version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,d){let _=!0;if(!this.isLoaded())for(const b of a)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(a,d):this.requestors.push({ids:a,callback:d})}_notify(a,d){const _={};for(const b of a){this.images[b]||this.fire(new u.Event("styleimagemissing",{id:b}));const E=this.images[b];E?_[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!(!E.userImage||!E.userImage.render)}:u.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],_=this.getImage(a);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},E=new u.ImagePosition(b,_);this.patterns[a]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(a,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const E in this.patterns)a.push(this.patterns[E].bin);const{w:d,h:_}=u.potpack(a),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(const E in this.patterns){const{bin:I}=this.patterns[E],A=I.x+1,R=I.y+1,B=this.images[E].data,z=B.width,H=B.height;u.RGBAImage.copy(B,b,{x:0,y:0},{x:A,y:R},{width:z,height:H}),u.RGBAImage.copy(B,b,{x:0,y:H-1},{x:A,y:R-1},{width:z,height:1}),u.RGBAImage.copy(B,b,{x:0,y:0},{x:A,y:R+H},{width:z,height:1}),u.RGBAImage.copy(B,b,{x:z-1,y:0},{x:A-1,y:R},{width:1,height:H}),u.RGBAImage.copy(B,b,{x:0,y:0},{x:A+z,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];Ot(_)&&this.updateImage(d,_)}}}const Lt=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(m,a){return function([d,_,b]){const E=u.degToRad(_+90),I=u.degToRad(b);return{x:d*Math.cos(E)*Math.sin(I),y:d*Math.sin(E)*Math.sin(I),z:d*Math.cos(I),azimuthal:_,polar:b}}(m.expression.evaluate(a))}interpolate(m,a,d){return{x:u.number(m.x,a.x,d),y:u.number(m.y,a.y,d),z:u.number(m.z,a.z,d),azimuthal:u.number(m.azimuthal,a.azimuthal,d),polar:u.number(m.polar,a.polar,d)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)});class Cn extends u.Evented{constructor(a){super(),this._transitionable=new u.Transitionable(Lt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,d={}){if(!this._validate(u.validateLight,a,d))for(const _ in a){const b=a[_];u.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||!1!==_.validate)&&u.emitValidationErrors(this,a.call(u.validateStyle,u.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const Ai=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)});let $i=class extends u.Evented{constructor(m,a){super(),this._transitionable=new u.Transitionable(Ai),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(m){for(const a in m){const d=m[a];u.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),d):this._transitionable.setValue(a,d)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function qr(m,a,d,_){const b=u.smoothstep(45,65,d),[E,I]=Er(m,_),A=u.length(a);let R=1-Math.min(1,Math.exp((A-E)/(I-E)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*b*m.alpha}function Er(m,a){const d=.5/Math.tan(.5*a);return[m.range[0]+d,m.range[1]+d]}const Tn=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])});class wn extends u.Evented{constructor(a,d){super(),this._transitionable=new u.Transitionable(Tn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const a=this._transform,d="globe"===a.projection.name,_=u.globeToMercatorTransition(a.zoom),b=this.properties.get("range"),E=[.5,3];return{range:d?[u.number(E[0],b[0],_),u.number(E[1],b[1],_)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,d={}){if(!this._validate(u.validateFog,a,d)){for(const _ of Object.keys(u.spec.fog))a&&void 0===a[_]&&(a[_]=u.spec.fog[_].default);for(const _ in a){const b=a[_];u.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,a))*d.a}getOpacityAtLatLng(a,d){return this._transform.projection.supportsFog?function(_,b,E){const I=u.MercatorCoordinate.fromLngLat(b),A=E.elevation?E.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,A];return u.transformMat4(R,R,E.mercatorFogMatrix),qr(_,R,E.pitch,E._fov)}(this.state,a,d):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Er(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||!1!==_.validate)&&u.emitValidationErrors(this,a.call(u.validateStyle,u.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class ir{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const E=new ir.Actor(_[b],d,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,d,_){u.asyncAll(this.actors,(b,E)=>{b.send(a,d,E)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dn(m,a,d){return a*(u.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}ir.Actor=u.Actor;class In{constructor(a,d,_,b){this.screenBounds=a,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(a,d){let _,b;if(a instanceof u.Point||"number"==typeof a[0]){const E=u.Point.convert(a);_=[E],b=d.isPointAboveHorizon(E)}else{const E=u.Point.convert(a[0]),I=u.Point.convert(a[1]);_=[E,I],b=u.polygonizeBounds(E,I).every(A=>d.isPointAboveHorizon(A))}return new In(_,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],b=u.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),u.bufferConvexPolygon(b,a)}bufferedCameraGeometryGlobe(a){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],b=u.polygonizeBounds(d,_,a),E=this.cameraPoint.clone();switch(3*((E.y>d.y)+(E.y>_.y))+((E.x>d.x)+(E.x>_.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(a,d,_,b=0){const E=a.queryPadding/d._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(E,d):this._bufferedScreenMercator(E,d);let A=a.tileID.wrap+(I.unwrapped?b:0);const R=I.polygon.map(re=>u.getTilePoint(a.tileTransform,re,A));if(!u.polygonIntersectsBox(R,0,0,u.EXTENT,u.EXTENT))return;A=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const B=this.screenGeometryMercator.polygon.map(re=>u.getTileVec3(a.tileTransform,re,A)),z=B.map(re=>new u.Point(re[0],re[1])),H=d.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),K=u.getTileVec3(a.tileTransform,H,A),te=B.map(re=>{const G=u.sub(re,re,K);return u.normalize(G,G),new u.Ray(K,G)}),ie=dn(a,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:te,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ne=u.getBounds(R),ne.min.x=u.clamp(ne.min.x,0,u.EXTENT),ne.min.y=u.clamp(ne.min.y,0,u.EXTENT),ne.max.x=u.clamp(ne.max.x,0,u.EXTENT),ne.max.y=u.clamp(ne.max.y,0,u.EXTENT),ne),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:ie};var ne}_bufferedScreenMercator(a,d){const _=Pi(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),d):{polygon:this.bufferedScreenGeometry(a).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(a,d){const _=Pi(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let b;return b="globe"===d.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),d):{polygon:this.bufferedCameraGeometry(a).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[_]=b,b}}_projectAndResample(a,d){const _=function(E,I){const A=u.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-u.GLOBE_RADIUS,0,1],B=[0,u.GLOBE_RADIUS,0,1],z=[0,0,0,1];u.transformMat4$1(R,R,A),u.transformMat4$1(B,B,A),u.transformMat4$1(z,z,A);const H=new u.Point(R[0]/R[3],R[1]/R[3]),K=new u.Point(B[0]/B[3],B[1]/B[3]),te=u.polygonContainsPoint(E,H)&&R[3]<z[3],ie=u.polygonContainsPoint(E,K)&&B[3]<z[3];if(!te&&!ie)return null;const ne=function(we,Ne,Pe){for(let Ze=1;Ze<we.length;Ze++){const Et=Hi(Ne.pointCoordinate3D(we[Ze-1]).x),Ue=Hi(Ne.pointCoordinate3D(we[Ze]).x);if(Pe<0){if(Et<Ue)return{idx:Ze,t:-Et/(Ue-1-Et)}}else if(Ue<Et)return{idx:Ze,t:(1-Et)/(Ue+1-Et)}}return null}(E,I,te?-1:1);if(!ne)return null;const{idx:re,t:G}=ne;let ee=re>1?ii(E.slice(0,re),I):[],le=re<E.length?ii(E.slice(re),I):[];ee=ee.map(we=>new u.Point(Hi(we.x),we.y)),le=le.map(we=>new u.Point(Hi(we.x),we.y));const ce=[...ee];0===ce.length&&ce.push(le[le.length-1]);const be=u.number(ce[ce.length-1].y,(0===le.length?ee[0]:le[0]).y,G);let Ee;return Ee=te?[new u.Point(0,be),new u.Point(0,0),new u.Point(1,0),new u.Point(1,be)]:[new u.Point(1,be),new u.Point(1,1),new u.Point(0,1),new u.Point(0,be)],ce.push(...Ee),0===le.length?ce.push(ee[0]):ce.push(...le),{polygon:ce.map(we=>new u.MercatorCoordinate(we.x,we.y)),unwrapped:!1}}(a,d);if(_)return _;const b=function(E,I){let A=!1,R=-1/0,B=0;for(let H=0;H<E.length-1;H++)E[H].x>R&&(R=E[H].x,B=H);for(let H=0;H<E.length-1;H++){const K=(B+H)%(E.length-1),te=E[K],ie=E[K+1];Math.abs(te.x-ie.x)>.5&&(te.x<ie.x?(te.x+=1,0===K&&(E[E.length-1].x+=1)):(ie.x+=1,K+1===E.length-1&&(E[0].x+=1)),A=!0)}const z=u.mercatorXfromLng(I.center.lng);return A&&z<Math.abs(z-1)&&E.forEach(H=>{H.x-=1}),{polygon:E,unwrapped:A}}(ii(a,d).map(E=>new u.Point(Hi(E.x),E.y)),d);return{polygon:b.polygon.map(E=>new u.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function ii(m,a){return u.resample(m,d=>{const _=a.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function Hi(m){return m<0?1+m%1:m%1}function Pi(m){return 100*m|0}function oi(m,a,d,_,b){const E=function(I,A){if(I)return b(I);if(A){m.url&&A.tiles&&m.tiles&&delete m.tiles;const R=u.pick(u.extend(A,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(R.vectorLayers=A.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=a.canonicalizeTileset(R,m.url),b(null,R)}};return m.url?u.getJSON(a.transformRequest(a.normalizeSourceURL(m.url,null,d,_),u.ResourceType.Source),E):u.exported.frame(()=>E(null,m))}class Dn{constructor(a,d,_){this.bounds=u.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),_=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*d),I=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*d);return a.x>=_&&a.x<E&&a.y>=b&&a.y<I}}class Zr{constructor(a,d,_){this.context=a;const b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ci={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hi{constructor(a,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=a;const E=a.gl;this.buffer=E.createBuffer(),a.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let _=0;_<this.attributes.length;_++){const b=d.attributes[this.attributes[_].name];void 0!==b&&a.enableVertexAttribArray(b)}}setVertexAttribPointers(a,d,_){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],I=d.attributes[E.name];void 0!==I&&a.vertexAttribPointer(I,E.components,a[ci[E.type]],!1,this.itemSize,E.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ln{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ns extends ln{getDefault(){return u.Color.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ln extends ln{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Os extends ln{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Yi extends ln{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class go extends ln{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class sc extends ln{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class is extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class no extends ln{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Hc extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class Dl extends ln{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Ml extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class _a extends ln{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ya extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class ac extends ln{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Gc extends ln{getDefault(){return u.Color.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class io extends ln{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ns extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class ya extends ln{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class va extends ln{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Ka,Sl=class extends ln{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Ja extends ln{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class ro extends ln{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class gs extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class xa extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Qa extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ba extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class fe extends ln{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Z extends ln{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Y extends ln{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ue extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ye extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class De extends ln{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class Be extends De{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ze extends De{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ce extends ze{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ye{constructor(a,d,_,b){this.context=a,this.width=d,this.height=_;const E=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Be(a,E),b&&(this.depthAttachment=new ze(a,E))}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class Pt{constructor(a,d=!1){if(this.gl=a,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const _=a;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(a),deleteVertexArrayOES:_.deleteVertexArray.bind(a),bindVertexArrayOES:_.bindVertexArray.bind(a)}}this.clearColor=new ns(this),this.clearDepth=new Ln(this),this.clearStencil=new Os(this),this.colorMask=new Yi(this),this.depthMask=new go(this),this.stencilMask=new sc(this),this.stencilFunc=new is(this),this.stencilOp=new no(this),this.stencilTest=new Hc(this),this.depthRange=new Dl(this),this.depthTest=new Ml(this),this.depthFunc=new _a(this),this.blend=new Ya(this),this.blendFunc=new ac(this),this.blendColor=new Gc(this),this.blendEquation=new io(this),this.cullFace=new Ns(this),this.cullFaceSide=new ya(this),this.frontFace=new va(this),this.program=new Sl(this),this.activeTexture=new Ja(this),this.viewport=new ro(this),this.bindFramebuffer=new gs(this),this.bindRenderbuffer=new xa(this),this.bindTexture=new Qa(this),this.bindVertexBuffer=new ba(this),this.bindElementBuffer=new fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Z(this),this.pixelStoreUnpack=new Y(this),this.pixelStoreUnpackPremultiplyAlpha=new ue(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new Zr(this,a,d)}createVertexBuffer(a,d,_){return new hi(this,a,d,_)}createRenderbuffer(a,d,_){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,a,d,_),this.bindRenderbuffer.set(null),E}createFramebuffer(a,d,_){return new Ye(this,a,d,_)}clear({color:a,depth:d,stencil:_}){const b=this.gl;let E=0;a&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(E)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){Q(a.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ft extends u.Evented{constructor(a,d,_,b){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(d,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(a){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=oi(this._options,this.map._requestManager,d,_,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new u.ErrorEvent(b))):E&&(u.extend(this,E),E.bounds&&(this.tileBounds=new Dn(E.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(b)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(a,d){const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(_,u.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,a.actor&&"expired"!==a.state)"loading"===a.state?a.reloadCallback=d:a.request=a.actor.send("reloadTile",b,E.bind(this));else if(a.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const I=u.loadVectorTile.call({deduped:this._deduped},b,(A,R)=>{A||!R?E.call(this,A):(b.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},a.actor&&a.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);a.request={cancel:I}}function E(I,A){return delete a.request,a.aborted?d(null):I&&404!==I.status?d(I):(A&&A.resourceTiming&&(a.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&a.setExpiryData(A),a.loadVectorData(A,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ct extends u.Evented{constructor(a,d,_,b){super(),this.id=a,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},d),u.extend(this,u.pick(d,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=oi(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new u.ErrorEvent(d)):_&&(u.extend(this,_),_.bounds&&(this.tileBounds=new Dn(_.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(_.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(d)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,d){const _=u.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=u.getImage(this.map._requestManager.transformRequest(b,u.ResourceType.Tile),(E,I,A,R)=>(delete a.request,a.aborted?(a.state="unloaded",d(null)):E?(a.state="errored",d(E)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:A,expires:R}),a.setTexture(I,this.map.painter),a.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(a,d,_){a.setTexture(d,_)}static unloadTileData(a,d){a.texture&&d.saveTileTexture(a.texture)}abortTile(a,d){a.request&&(a.request.cancel(),delete a.request),d()}unloadTile(a,d){a.texture&&this.map.painter.saveTileTexture(a.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function kn(m,a,d,_,b,E,I,A){const R=[m,d,b,a,_,E,1,1,1],B=[I,A,1],z=u.adjoint([],R),[H,K,te]=u.transformMat3(B,B,u.transpose(z,z));return u.multiply$1(R,[H,0,0,0,K,0,0,0,te],R)}class Gn extends u.Evented{constructor(a,d,_,b){super(),this.id=a,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d,this._dirty=!1}load(a,d){this._loaded=d||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(_,b)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new u.ErrorEvent(_));else if(b){const{HTMLImageElement:E}=u.window;this.image=b instanceof E?u.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const d=a.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,E=1/0,I=-1/0,A=-1/0;for(const H of _)b=Math.min(b,H.x),E=Math.min(E,H.y),I=Math.max(I,H.x),A=Math.max(A,H.y);const R=Math.max(I-b,A-E),B=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,B);return new u.CanonicalTileID(B,Math.floor((b+I)/2*z),Math.floor((E+A)/2*z))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const R in this.tiles){const B=this.tiles[R];"loaded"!==B.state&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const d=u.tileTransform(this.tileID,this.map.transform.projection),[_,b,E,I]=this.coordinates.map(R=>{const B=d.projection.project(R[0],R[1]);return u.getTilePoint(d,B)._round()});this.perspectiveTransform=function(R,B,z,H,K,te,ie,ne,re,G){const ee=kn(0,0,R,0,0,B,R,B),le=kn(z,H,K,te,ie,ne,re,G);return u.multiply$1(le,u.adjoint(ee,ee),le),[le[6]/le[8]*R/u.EXTENT,le[7]/le[8]*B/u.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,I.x,I.y,E.x,E.y);const A=this._boundsArray=new u.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(b.x,b.y,u.EXTENT,0),A.emplaceBack(I.x,I.y,0,u.EXTENT),A.emplaceBack(E.x,E.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(A,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,d=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,d){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},d(null)):(a.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const zn={vector:Ft,raster:Ct,"raster-dem":class extends Ct{constructor(m,a,d,_){super(m,a,d,_),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,E){b&&(m.state="errored",a(b)),E&&(m.dem=E,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=u.getImage(this.map._requestManager.transformRequest(d,u.ResourceType.Tile),function(b,E,I,A){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(b)m.state="errored",a(b);else if(E){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:I,expires:A});const R=u.window.ImageBitmap&&E instanceof u.window.ImageBitmap&&(null==Ka&&(Ka=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),Ka),B=1-(E.width-u.prevPowerOfTwo(E.width))/2;B<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=R?E:u.exported.getImageData(E,B),H={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:B};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",H,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const a=m.canonical,d=Math.pow(2,a.z),_=(a.x-1+d)%d,b=0===a.x?m.wrap-1:m.wrap,E=(a.x+1+d)%d,I=a.x+1===d?m.wrap+1:m.wrap,A={};return A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y).key]={backfilled:!1},a.y>0&&(A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y-1).key]={backfilled:!1}),a.y+1<d&&(A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y+1).key]={backfilled:!1}),A}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends u.Evented{constructor(m,a,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=a.data,this._options=u.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const b=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*b,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*b,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*b,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},a),this}getClusterLeaves(m,a,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:a,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=u.extend({},this.workerOptions),a=this._data;"string"==typeof a?(m.request=this.map._requestManager.transformRequest(u.exported.resolveURL(a),u.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new u.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new u.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,a){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?a(null):_?a(_):(m.loadVectorData(b,this.map.painter,"reloadTile"===d),a(null))),void 0,"loadTile"===d)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Gn{constructor(m,a,d,_){super(m,a,d,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,u.ResourceType.Source).url);u.getVideo(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new u.ErrorEvent(a)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(m,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Gn,canvas:class extends Gn{constructor(m,a,d,_){super(m,a,d,_),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends u.Evented{constructor(m,a,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Dn(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:a,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:d,y:_,z:b}=m.tileID.canonical,E=new u.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:b},{signal:E.signal})).then(function(I){return delete m.request,m.aborted?(m.state="unloaded",a(null)):void 0===I?(m.state="errored",a(null)):null===I?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):(A=I)instanceof u.window.ImageData||A instanceof u.window.HTMLCanvasElement||A instanceof u.window.ImageBitmap||A instanceof u.window.HTMLImageElement?(this.loadTileData(m,I),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(I=>{20!==I.code&&(m.state="errored",a(I))}),m.request.cancel=()=>E.abort()}loadTileData(m,a){Ct.loadTileData(m,a,this._map.painter)}unloadTileData(m){Ct.unloadTileData(m,this._map.painter)}unloadTile(m,a){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:d,y:_,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:b})}a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Mn=function(m,a,d,_){const b=new zn[a.type](m,a,d,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],b),b};function zt(m,a){const d=u.identity([]);return u.scale(d,d,[.5*m.width,.5*-m.height,1]),u.translate(d,d,[1,-1,0]),u.multiply(d,d,m.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(d)}function zi(m,a,d,_,b,E,I,A=!1){const R=m.tilesIn(_,I,A);R.sort(Ei);const B=[];for(const H of R)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(a,d,m._state,H,b,E,zt(m.transform,H.tile.tileID),A)});const z=function(H){const K={},te={};for(const ie of H){const ne=ie.queryResults,re=ie.wrappedTileID,G=te[re]=te[re]||{};for(const ee in ne){const le=ne[ee],ce=G[ee]=G[ee]||{},be=K[ee]=K[ee]||[];for(const Ee of le)ce[Ee.featureIndex]||(ce[Ee.featureIndex]=!0,be.push(Ee))}}return K}(B);for(const H in z)z[H].forEach(K=>{const te=K.feature,ie=te.layer;ie&&"background"!==ie.type&&"sky"!==ie.type&&(te.source=ie.source,ie["source-layer"]&&(te.sourceLayer=ie["source-layer"]),te.state=void 0!==te.id?m.getFeatureState(ie["source-layer"],te.id):{})});return z}function fr(m,a){const d=m.getRenderableIds().map(E=>m.getTileByID(E)),_=[],b={};for(let E=0;E<d.length;E++){const I=d[E],A=I.tileID.canonical.key;b[A]||(b[A]=!0,I.querySourceFeatures(_,a))}return _}function Ei(m,a){const d=m.tileID,_=a.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Cr(){return null!=Uu.workerClass?new Uu.workerClass:new u.window.Worker(Uu.workerUrl)}const jo="mapboxgl_preloaded_worker_pool";class Lr{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Lr.workerCount;)this.workers.push(new Cr);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jo]}numActive(){return Object.keys(this.active).length}}let Mr;function wa(){return Mr||(Mr=new Lr),Mr}function Vd(m,a){const d={};for(const _ in m)"ref"!==_&&(d[_]=m[_]);return u.refProperties.forEach(_=>{_ in a&&(d[_]=a[_])}),d}function Ah(m){m=m.slice();const a=Object.create(null);for(let d=0;d<m.length;d++)a[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=Vd(m[d],a[m[d].ref]));return m}Lr.workerCount=2;const Yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Iu(m,a,d){d.push({command:Yn.addSource,args:[m,a[m]]})}function vr(m,a,d){a.push({command:Yn.removeSource,args:[m]}),d[m]=!0}function Ea(m,a,d,_){vr(m,d,_),Iu(m,a,d)}function oo(m,a,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&"data"!==_&&!Q(m[d][_],a[d][_]))return!1;for(_ in a[d])if(a[d].hasOwnProperty(_)&&"data"!==_&&!Q(m[d][_],a[d][_]))return!1;return!0}function Fs(m,a,d,_,b,E){let I;for(I in a=a||{},m=m||{})m.hasOwnProperty(I)&&(Q(m[I],a[I])||d.push({command:E,args:[_,I,a[I],b]}));for(I in a)a.hasOwnProperty(I)&&!m.hasOwnProperty(I)&&(Q(m[I],a[I])||d.push({command:E,args:[_,I,a[I],b]}))}function zs(m){return m.id}function Au(m,a){return m[a.id]=a,m}class lc{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=u.clamp(a,0,1);let d=1,_=this._distances[d];const b=a*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];const E=d-1,I=this._distances[E],A=_-I,R=A>0?(b-I)/A:0;return this.points[E].mult(1-R).add(this.points[d].mult(R))}}class Ca{constructor(a,d,_){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(d/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,_,b,E){this._forEachCell(d,_,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(a,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(a,d,_,b,E,I){this.boxCells[E].push(I)}_insertCircleCell(a,d,_,b,E,I){this.circleCells[E].push(I)}_query(a,d,_,b,E,I){if(_<0||a>this.width||b<0||d>this.height)return!E&&[];const A=[];if(a<=0&&d<=0&&this.width<=_&&this.height<=b){if(E)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],z=this.circles[3*R+1],H=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:B-H,y1:z-H,x2:B+H,y2:z+H})}return I?A.filter(I):A}return this._forEachCell(a,d,_,b,this._queryCell,A,{hitTest:E,seenUids:{box:{},circle:{}}},I),E?A.length>0:A}_queryCircle(a,d,_,b,E){const I=a-_,A=a+_,R=d-_,B=d+_;if(A<0||I>this.width||B<0||R>this.height)return!b&&[];const z=[];return this._forEachCell(I,R,A,B,this._queryCellCircle,z,{hitTest:b,circle:{x:a,y:d,radius:_},seenUids:{box:{},circle:{}}},E),b?z.length>0:z}query(a,d,_,b,E){return this._query(a,d,_,b,!1,E)}hitTest(a,d,_,b,E){return this._query(a,d,_,b,!0,E)}hitTestCircle(a,d,_,b){return this._queryCircle(a,d,_,!0,b)}_queryCell(a,d,_,b,E,I,A,R){const B=A.seenUids,z=this.boxCells[E];if(null!==z){const K=this.bboxes;for(const te of z)if(!B.box[te]){B.box[te]=!0;const ie=4*te;if(a<=K[ie+2]&&d<=K[ie+3]&&_>=K[ie+0]&&b>=K[ie+1]&&(!R||R(this.boxKeys[te]))){if(A.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[te],x1:K[ie],y1:K[ie+1],x2:K[ie+2],y2:K[ie+3]})}}}const H=this.circleCells[E];if(null!==H){const K=this.circles;for(const te of H)if(!B.circle[te]){B.circle[te]=!0;const ie=3*te;if(this._circleAndRectCollide(K[ie],K[ie+1],K[ie+2],a,d,_,b)&&(!R||R(this.circleKeys[te]))){if(A.hitTest)return I.push(!0),!0;{const ne=K[ie],re=K[ie+1],G=K[ie+2];I.push({key:this.circleKeys[te],x1:ne-G,y1:re-G,x2:ne+G,y2:re+G})}}}}}_queryCellCircle(a,d,_,b,E,I,A,R){const B=A.circle,z=A.seenUids,H=this.boxCells[E];if(null!==H){const te=this.bboxes;for(const ie of H)if(!z.box[ie]){z.box[ie]=!0;const ne=4*ie;if(this._circleAndRectCollide(B.x,B.y,B.radius,te[ne+0],te[ne+1],te[ne+2],te[ne+3])&&(!R||R(this.boxKeys[ie])))return I.push(!0),!0}}const K=this.circleCells[E];if(null!==K){const te=this.circles;for(const ie of K)if(!z.circle[ie]){z.circle[ie]=!0;const ne=3*ie;if(this._circlesCollide(te[ne],te[ne+1],te[ne+2],B.x,B.y,B.radius)&&(!R||R(this.circleKeys[ie])))return I.push(!0),!0}}}_forEachCell(a,d,_,b,E,I,A,R){const B=this._convertToXCellCoord(a),z=this._convertToYCellCoord(d),H=this._convertToXCellCoord(_),K=this._convertToYCellCoord(b);for(let te=B;te<=H;te++)for(let ie=z;ie<=K;ie++)if(E.call(this,a,d,_,b,this.xCellCount*ie+te,I,A,R))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,_,b,E,I){const A=b-a,R=E-d,B=_+I;return B*B>A*A+R*R}_circleAndRectCollide(a,d,_,b,E,I,A){const R=(I-b)/2,B=Math.abs(a-(b+R));if(B>R+_)return!1;const z=(A-E)/2,H=Math.abs(d-(E+z));if(H>z+_)return!1;if(B<=R||H<=z)return!0;const K=B-R,te=H-z;return K*K+te*te<=_*_}}const _o={unknown:0,flipRequired:1,flipNotRequired:2},Bs=Math.tan(85*Math.PI/180);function tt(m,a,d,_,b,E,I){const A=u.create();if(d)if("globe"===E.name){const R=u.calculateGlobeLabelMatrix(b,a);u.multiply(A,A,R)}else{const R=Fe([],I);A[0]=R[0],A[1]=R[1],A[4]=R[2],A[5]=R[3],_||u.rotateZ(A,A,b.angle)}else u.multiply(A,b.labelPlaneMatrix,m);return A}function rs(m,a,d,_,b,E,I){const A=tt(m,a,d,_,b,E,I);return"globe"===E.name&&d||(A[2]=A[6]=A[10]=A[14]=0),A}function Ki(m,a,d,_,b,E,I){if(d){if("globe"===E.name){const A=tt(m,a,d,_,b,E,I);return u.invert(A,A),u.multiply(A,m,A),A}{const A=u.clone(m),R=u.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],u.multiply(A,A,R),_||u.rotateZ(A,A,-b.angle),A}}return b.glCoordMatrix}function On(m,a,d,_){const b=[m,a,d,1];d?u.transformMat4$1(b,b,_):qn(b,b,_);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function rr(m,a){return Math.min(.5+m/a*.5,1.5)}function Ao(m,a){const d=m[0]/m[3],_=m[1]/m[3];return d>=-a[0]&&d<=a[0]&&_>=-a[1]&&_<=a[1]}function Vs(m,a,d,_,b,E,I,A,R,B){const z=d.transform,H=_?m.textSizeData:m.iconSizeData,K=u.evaluateSizeForZoom(H,d.transform.zoom),te="globe"===z.projection.name,ie=[256/d.width*2+1,256/d.height*2+1],ne=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ne.clear();let re=null;te&&(re=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const G=m.lineVertexArray,ee=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,le=d.transform.width/d.transform.height;let ce,be=!1;for(let Ee=0;Ee<ee.length;Ee++){const we=ee.get(Ee),{numGlyphs:Ne,writingMode:Pe}=we;if(Pe!==u.WritingMode.vertical||be||ce===u.WritingMode.horizontal||(be=!0),ce=Pe,(we.hidden||Pe===u.WritingMode.vertical)&&!be){or(Ne,ne);continue}be=!1;const Ze=new u.Point(we.tileAnchorX,we.tileAnchorY);let{x:Et,y:Ue,z:ut}=z.projection.projectTilePoint(Ze.x,Ze.y,B.canonical);if(R){const[Rn,en,bn]=R(Ze);Et+=Rn,Ue+=en,ut+=bn}const Ke=[Et,Ue,ut,1];if(u.transformMat4$1(Ke,Ke,a),!Ao(Ke,ie)){or(Ne,ne);continue}const xt=rr(d.transform.cameraToCenterDistance,Ke[3]),qe=u.evaluateSizeForFeature(H,K,we),lt=I?qe/xt:qe*xt,Dt=On(Et,Ue,ut,b);if(Dt[3]<=0){or(Ne,ne);continue}let pt={};const It=I?null:R,un=it(we,lt,!1,A,a,b,E,m.glyphOffsetArray,G,ne,re,Dt,Ze,pt,le,It,z.projection,B,I);be=un.useVertical,It&&un.needsFlipping&&(pt={}),(un.notEnoughRoom||be||un.needsFlipping&&it(we,lt,!0,A,a,b,E,m.glyphOffsetArray,G,ne,re,Dt,Ze,pt,le,It,z.projection,B,I).notEnoughRoom)&&or(Ne,ne)}_?(m.text.dynamicLayoutVertexBuffer.updateData(ne),re&&m.text.globeExtVertexBuffer.updateData(re)):(m.icon.dynamicLayoutVertexBuffer.updateData(ne),re&&m.icon.globeExtVertexBuffer.updateData(re))}function el(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const{lineStartIndex:re,glyphStartIndex:G,segment:ee}=A,le=G+A.numGlyphs,ce=re+A.lineLength,be=a.getoffsetX(G),Ee=a.getoffsetX(le-1),we=fn(m*be,d,_,b,E,I,ee,re,ce,R,B,z,H,K,!0,te,ie,ne);if(!we)return null;const Ne=fn(m*Ee,d,_,b,E,I,ee,re,ce,R,B,z,H,K,!0,te,ie,ne);return Ne?{first:we,last:Ne}:null}function Ta(m,a,d,_){return m===u.WritingMode.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:m===u.WritingMode.vertical?_>0?{needsFlipping:!0}:null:a!==_o.unknown&&(0===(b=d)||Math.abs(_/b)>Bs)?a===_o.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null;var b}function it(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G,ee){const le=a/24,ce=m.lineOffsetX*le,be=m.lineOffsetY*le,{lineStartIndex:Ee,glyphStartIndex:we,numGlyphs:Ne,segment:Pe,writingMode:Ze,flipState:Et}=m,Ue=Ee+m.lineLength,ut=Ke=>{if(z){const[Dt,pt,It]=Ke.up,un=B.length;u.updateGlobeVertexNormal(z,un+0,Dt,pt,It),u.updateGlobeVertexNormal(z,un+1,Dt,pt,It),u.updateGlobeVertexNormal(z,un+2,Dt,pt,It),u.updateGlobeVertexNormal(z,un+3,Dt,pt,It)}const[xt,qe,lt]=Ke.point;u.addDynamicAttributes(B,xt,qe,lt,Ke.angle)};if(Ne>1){const Ke=el(le,A,ce,be,d,H,K,m,R,E,te,ne,!1,re,G,ee);if(!Ke)return{notEnoughRoom:!0};if(_&&!d){let[xt,qe,lt]=Ke.first.point,[Dt,pt,It]=Ke.last.point;[xt,qe]=On(xt,qe,lt,I),[Dt,pt]=On(Dt,pt,It,I);const un=Ta(Ze,Et,(Dt-xt)*ie,pt-qe);if(m.flipState=un&&un.needsFlipping?_o.flipRequired:_o.flipNotRequired,un)return un}ut(Ke.first);for(let xt=we+1;xt<we+Ne-1;xt++){const qe=fn(le*A.getoffsetX(xt),ce,be,d,H,K,Pe,Ee,Ue,R,E,te,ne,!1,!1,re,G,ee);if(!qe)return B.length-=4*(xt-we),{notEnoughRoom:!0};ut(qe)}ut(Ke.last)}else{if(_&&!d){const xt=On(K.x,K.y,0,b),qe=Ee+Pe+1,lt=new u.Point(R.getx(qe),R.gety(qe)),Dt=On(lt.x,lt.y,0,b),pt=Dt[3]>0?Dt:mn(K,lt,xt,1,b,void 0,re,G.canonical),It=Ta(Ze,Et,(pt[0]-xt[0])*ie,pt[1]-xt[1]);if(m.flipState=It&&It.needsFlipping?_o.flipRequired:_o.flipNotRequired,It)return It}const Ke=fn(le*A.getoffsetX(we),ce,be,d,H,K,Pe,Ee,Ue,R,E,te,ne,!1,!1,re,G,ee);if(!Ke)return{notEnoughRoom:!0};ut(Ke)}return{}}function yn(m,a,d,_,b){const{x:E,y:I,z:A}=_.projectTilePoint(m.x,m.y,a);if(!b)return On(E,I,A,d);const[R,B,z]=b(m);return On(E+R,I+B,A+z,d)}function mn(m,a,d,_,b,E,I,A){const R=yn(m.sub(a)._unit()._add(m),A,b,I,E);return u.sub(R,d,R),u.normalize(R,R),u.scaleAndAdd(R,d,R,_)}function fn(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G){const ee=_?m-a:m+a;let le=ee>0?1:-1,ce=0;_&&(le*=-1,ce=Math.PI),le<0&&(ce+=Math.PI);let be=A+I+(le>0?0:1)|0,Ee=b,we=b,Ne=0,Pe=0;const Ze=Math.abs(ee),Et=[],Ue=[];let ut=E,Ke=ut;const xt=()=>mn(Ke,ut,we,Ze-Ne+1,z,K,ne,re.canonical);for(;Ne+Pe<=Ze;){if(be+=le,be<A||be>=R)return null;if(we=Ee,Ke=ut,Et.push(we),te&&Ue.push(Ke),ut=new u.Point(B.getx(be),B.gety(be)),Ee=H[be],!Ee){const bn=yn(ut,re.canonical,z,ne,K);Ee=bn[3]>0?H[be]=bn:xt()}Ne+=Pe,Pe=u.distance(we,Ee)}ie&&K&&(H[be]&&(Ee=xt(),Pe=u.distance(we,Ee)),H[be]=Ee);const qe=(Ze-Ne)/Pe,lt=ut.sub(Ke)._mult(qe)._add(Ke),Dt=u.sub([],Ee,we),pt=u.scaleAndAdd([],we,Dt,qe);let It=[0,0,1],un=Dt[0],Rn=Dt[1];if(G&&(It=ne.upVector(re.canonical,lt.x,lt.y),0!==It[0]||0!==It[1]||1!==It[2])){const bn=[It[2],0,-It[0]],Jn=u.cross([],It,bn);u.normalize(bn,bn),u.normalize(Jn,Jn),un=u.dot(Dt,bn),Rn=u.dot(Dt,Jn)}if(d){const bn=u.cross([],It,Dt);u.normalize(bn,bn),u.scaleAndAdd(pt,pt,bn,d*le)}const en=ce+Math.atan2(Rn,un);return Et.push(pt),te&&Ue.push(lt),{point:pt,angle:en,path:Et,tilePath:Ue,up:It}}function or(m,a){const d=a.length,_=d+4*m;a.resize(_),a.float32.fill(-1/0,4*d,4*_)}function qn(m,a,d){const _=a[0],b=a[1];return m[0]=d[0]*_+d[4]*b+d[12],m[1]=d[1]*_+d[5]*b+d[13],m[3]=d[3]*_+d[7]*b+d[15],m}const Gi=100;class os{constructor(a,d,_=new Ca(a.width+200,a.height+200,25),b=new Ca(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Gi,this.screenBottomBoundary=a.height+Gi,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=d}placeCollisionBox(a,d,_,b,E,I,A,R){let B=_.projectedAnchorX,z=_.projectedAnchorY,H=_.projectedAnchorZ;const K=_.elevation,te=_.tileID,ie=a.getProjection();if(K&&te){const[Ee,we,Ne]=ie.upVector(te.canonical,_.tileAnchorX,_.tileAnchorY),Pe=ie.upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Ee*K*Pe,z+=we*K*Pe,H+=Ne*K*Pe}const ne=this.projectAndGetPerspectiveRatio(A,B,z,H,_.tileID,"globe"===ie.name||!!K||this.transform.pitch>0,ie),re=I*ne.perspectiveRatio,G=(_.x1*d+b.x-_.padding)*re+ne.point.x,ee=(_.y1*d+b.y-_.padding)*re+ne.point.y,le=(_.x2*d+b.x+_.padding)*re+ne.point.x,ce=(_.y2*d+b.y+_.padding)*re+ne.point.y,be=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(G,ee,le,ce)||!E&&this.grid.hitTest(G,ee,le,ce,R)||be?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[G,ee,le,ce],offscreen:this.isOffscreen(G,ee,le,ce),occluded:!1}}placeCollisionCircles(a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const re=[],G=this.transform.elevation,ee=a.getProjection(),le=G?G.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,ee):null,ce=new u.Point(_.tileAnchorX,_.tileAnchorY);let{x:be,y:Ee,z:we}=ee.projectTilePoint(ce.x,ce.y,ne.canonical);if(le){const[lt,Dt,pt]=le(ce);be+=lt,Ee+=Dt,we+=pt}const Ne="globe"===ee.name,Pe=this.projectAndGetPerspectiveRatio(A,be,Ee,we,ne,Ne||!!G||this.transform.pitch>0,ee),{perspectiveRatio:Ze}=Pe,Et=(H?I/Ze:I*Ze)/u.ONE_EM,Ue=On(be,Ee,we,R),ut=Pe.signedDistanceFromCamera>0?el(Et,E,_.lineOffsetX*Et,_.lineOffsetY*Et,!1,Ue,ce,_,b,R,{},G&&!H?le:null,H&&!!G,ee,ne,H):null;let Ke=!1,xt=!1,qe=!0;if(ut&&!Pe.occluded){const lt=.5*te*Ze+ie,Dt=new u.Point(-100,-100),pt=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),It=new lc,{first:un,last:Rn}=ut,en=un.path.length;let bn=[];for(let Kt=en-1;Kt>=1;Kt--)bn.push(un.path[Kt]);for(let Kt=1;Kt<Rn.path.length;Kt++)bn.push(Rn.path[Kt]);const Jn=2.5*lt;B&&(bn=bn.map(([Kt,bi,Ri],Li)=>(le&&!Ne&&(Ri=le(Li<en-1?un.tilePath[en-1-Li]:Rn.tilePath[Li-en+2])[2]),On(Kt,bi,Ri,B))),bn.some(Kt=>Kt[3]<=0)&&(bn=[]));let Kn=[];if(bn.length>0){let Kt=1/0,bi=-1/0,Ri=1/0,Li=-1/0;for(const Ci of bn)Kt=Math.min(Kt,Ci[0]),Ri=Math.min(Ri,Ci[1]),bi=Math.max(bi,Ci[0]),Li=Math.max(Li,Ci[1]);bi>=Dt.x&&Kt<=pt.x&&Li>=Dt.y&&Ri<=pt.y&&(Kn=[bn.map(Ci=>new u.Point(Ci[0],Ci[1]))],(Kt<Dt.x||bi>pt.x||Ri<Dt.y||Li>pt.y)&&(Kn=u.clipLine(Kn,Dt.x,Dt.y,pt.x,pt.y)))}for(const Kt of Kn){It.reset(Kt,.25*lt);let bi=0;bi=It.length<=.5*lt?1:Math.ceil(It.paddedLength/Jn)+1;for(let Ri=0;Ri<bi;Ri++){const Li=Ri/Math.max(bi-1,1),Ci=It.lerp(Li),yo=Ci.x+Gi,co=Ci.y+Gi;re.push(yo,co,lt,0);const Yo=yo-lt,za=co-lt,pi=yo+lt,Ti=co+lt;if(qe=qe&&this.isOffscreen(Yo,za,pi,Ti),xt=xt||this.isInsideGrid(Yo,za,pi,Ti),!d&&this.grid.hitTestCircle(yo,co,lt,K)&&(Ke=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ke,occluded:!1}}}}return{circles:!z&&Ke||!xt?[]:re,offscreen:qe,collisionDetected:Ke,occluded:Pe.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,b=1/0,E=-1/0,I=-1/0;for(const z of a){const H=new u.Point(z.x+Gi,z.y+Gi);_=Math.min(_,H.x),b=Math.min(b,H.y),E=Math.max(E,H.x),I=Math.max(I,H.y),d.push(H)}const A=this.grid.query(_,b,E,I).concat(this.ignoredGrid.query(_,b,E,I)),R={},B={};for(const z of A){const H=z.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const K=[new u.Point(z.x1,z.y1),new u.Point(z.x2,z.y1),new u.Point(z.x2,z.y2),new u.Point(z.x1,z.y2)];u.polygonIntersectsPolygon(d,K)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===B[H.bucketInstanceId]&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(a,d,_,b,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:E},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,_,b,E){const I=d?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:b,collisionGroupID:E};for(let R=0;R<a.length;R+=4)I.insertCircle(A,a[R],a[R+1],a[R+2])}projectAndGetPerspectiveRatio(a,d,_,b,E,I,A){const R=[d,_,b,1];let B=!1;b||this.transform.pitch>0?(u.transformMat4$1(R,R,a),this.fogState&&E&&"globe"!==A.name&&(B=function(K,te,ie,ne,re,G){const ee=G.calculateFogTileMatrix(re),le=[te,ie,ne];return u.transformMat4(le,le,ee),qr(K,le,G.pitch,G._fov)}(this.fogState,d,_,b,E.toUnwrapped(),this.transform)>.9)):qn(R,R,a);const z=R[3];return{point:new u.Point((R[0]/z+1)/2*this.transform.width+Gi,(-R[1]/z+1)/2*this.transform.height+Gi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:I&&R[2]>z||B}}isOffscreen(a,d,_,b){return _<Gi||a>=this.screenRightBoundary||b<Gi||d>this.screenBottomBoundary}isInsideGrid(a,d,_,b){return _>=0&&a<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=u.identity([]);return u.translate(a,a,[-100,-100,0]),a}}function qi(m,a,d){const _=a.createTileMatrix(m,m.worldSize,d.toUnwrapped());return u.multiply(new Float32Array(16),m.projMatrix,_)}function jn(m,a,d){if(a.projection.name===d.projection.name)return m.projMatrix;const _=d.clone();return _.setProjection(a.projection),qi(_,a.getProjection(),m)}function fi(m,a,d){return a.name===d.projection.name?m.projMatrix:qi(d,a,m)}class sr{constructor(a,d,_,b){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Po{constructor(a,d,_,b,E,I=!1){this.text=new sr(a?a.text:null,d,_,E),this.icon=new sr(a?a.icon:null,d,b,E),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Us{constructor(a,d,_,b=!1){this.text=a,this.icon=d,this.skipFade=_,this.clipped=b}}class vi{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class An{constructor(a,d,_,b,E){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=E}}class tl{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[a]}}function js(m,a,d,_,b){const{horizontalAlign:E,verticalAlign:I}=u.getAnchorAlignment(m),A=-(E-.5)*a,R=-(I-.5)*d,B=u.evaluateVariableOffset(m,_);return new u.Point(A+B[0]*b,R+B[1]*b)}function Il(m,a,d,_,b){const E=new u.Point(m,a);return d&&E._rotate(_?b:-b),E}class Da{constructor(a,d,_,b,E){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new os(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new tl(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,_,b){const E=_.getBucket(d),I=_.latestFeatureIndex;if(!E||!I||d.id!==E.layerIds[0])return;const A=E.layers[0].layout,R=_.collisionBoxArray,B=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/u.EXTENT,H=_.tileID.toUnwrapped();this.transform.setProjection(E.projection);const K=(te=_.tileID,ie=E.getProjection(),ne=this.transform,ie.name===this.projection?ne.calculateProjMatrix(te.toUnwrapped()):qi(ne,ie,te));var te,ie,ne;const re="map"===A.get("text-pitch-alignment"),G="map"===A.get("text-rotation-alignment");d.compileFilter();const ee=d.dynamicFilter(),le=d.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(_),be=rs(K,_.tileID.canonical,re,G,this.transform,E.getProjection(),ce);let Ee=null;if(re){const Pe=Ki(K,_.tileID.canonical,re,G,this.transform,E.getProjection(),ce);Ee=u.multiply([],this.transform.labelPlaneMatrix,Pe)}let we=null;ee&&_.latestFeatureIndex&&(we={unwrappedTileID:H,dynamicFilter:ee,dynamicFilterNeedsFeature:le,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new An(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,_.tileID);const Ne={bucket:E,layout:A,posMatrix:K,textLabelPlaneMatrix:be,labelToScreenMatrix:Ee,clippingData:we,scale:B,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const Pe of E.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:Et,symbolInstanceEnd:Ue}=Pe;a.push({sortKey:Ze,symbolInstanceStart:Et,symbolInstanceEnd:Ue,parameters:Ne})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G,ee){const{textOffset0:le,textOffset1:ce,crossTileID:be}=K,Ee=[le,ce],we=js(a,_,b,Ee,E),Ne=this.collisionIndex.placeCollisionBox(ie,E,d,Il(we.x,we.y,I,A,this.transform.angle),H,R,B,z.predicate);if(re){const Pe=ie.getSymbolInstanceIconSize(ee,this.transform.zoom,K.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ie,Pe,re,Il(we.x,we.y,I,A,this.transform.angle),H,R,B,z.predicate).box.length)return}if(Ne.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Pe=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Ee,width:_,height:b,anchor:a,textScale:E,prevAnchor:Pe},this.markUsedJustification(ie,a,K,ne),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ne,K),this.placedOrientations[be]=ne),{shift:we,placedGlyphBoxes:Ne}}}placeLayerBucketPart(a,d,_,b){const{bucket:E,layout:I,posMatrix:A,textLabelPlaneMatrix:R,labelToScreenMatrix:B,clippingData:z,textPixelRatio:H,holdingForFade:K,collisionBoxArray:te,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ne,collisionGroup:re}=a.parameters,G=I.get("text-optional"),ee=I.get("icon-optional"),le=I.get("text-allow-overlap"),ce=I.get("icon-allow-overlap"),be="map"===I.get("text-rotation-alignment"),Ee="map"===I.get("text-pitch-alignment"),we="none"!==I.get("icon-text-fit"),Ne="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(E.projection);let Pe=le&&(ce||!E.hasIconData()||ee),Ze=ce&&(le||!E.hasTextData()||G);!E.collisionArrays&&te&&E.deserializeCollisionBoxes(te),_&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,te);const Et=(Ue,ut,Ke)=>{const{crossTileID:xt,numVerticalGlyphVertices:qe}=Ue;if(z){const pi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ti=null;if(z.dynamicFilterNeedsFeature){const di=this.retainedQueryData[E.bucketInstanceId];Ti=z.featureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:di.bucketIndex,sourceLayerIndex:di.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(pi,Ti,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new u.Point(Ue.tileAnchorX,Ue.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[xt]=new Us(!1,!1,!1,!0),void d.add(xt)}if(d.has(xt))return;if(K)return void(this.placements[xt]=new Us(!1,!1,!1));let lt=!1,Dt=!1,pt=!0,It=!1,un=!1,Rn=null,en={box:null,offscreen:null,occluded:null},bn={box:null,offscreen:null,occluded:null},Jn=null,Kn=null,Kt=null,bi=0,Ri=0,Li=0;Ke.textFeatureIndex?bi=Ke.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(bi=Ue.featureIndex),Ke.verticalTextFeatureIndex&&(Ri=Ke.verticalTextFeatureIndex);const Ci=pi=>{pi.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Ti=this.transform.elevation;(Ti||pi.elevation)&&(pi.elevation=Ti?Ti.getAtTileOffset(pi.tileID,pi.tileAnchorX,pi.tileAnchorY):0)},yo=Ke.textBox;if(yo){Ci(yo);const pi=di=>{let Xn=u.WritingMode.horizontal;if(E.allowVerticalPlacement&&!di&&this.prevPlacement){const vo=this.prevPlacement.placedOrientations[xt];vo&&(this.placedOrientations[xt]=vo,Xn=vo,this.markUsedOrientation(E,Xn,Ue))}return Xn},Ti=(di,Xn)=>{if(E.allowVerticalPlacement&&qe>0&&Ke.verticalTextBox){for(const vo of E.writingModes)if(vo===u.WritingMode.vertical?(en=Xn(),bn=en):en=di(),en&&en.box&&en.box.length)break}else en=di()};if(I.get("text-variable-anchor")){let di=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xt]){const ki=this.prevPlacement.variableOffsets[xt];di.indexOf(ki.anchor)>0&&(di=di.filter(Ji=>Ji!==ki.anchor),di.unshift(ki.anchor))}const Xn=(ki,Ji,Bh)=>{const $l=E.getSymbolInstanceTextSize(ie,Ue,this.transform.zoom,ut),Ba=(ki.x2-ki.x1)*$l+2*ki.padding,Br=(ki.y2-ki.y1)*$l+2*ki.padding,Hl=we&&!ce?Ji:null;Hl&&Ci(Hl);let bc={box:[],offscreen:!1,occluded:!1};const Vh=le?2*di.length:di.length;for(let Ts=0;Ts<Vh;++Ts){const Uh=this.attemptAnchorPlacement(di[Ts%di.length],ki,Ba,Br,$l,be,Ee,H,A,re,Ts>=di.length,Ue,ut,E,Bh,Hl,ie,ne);if(Uh&&(bc=Uh.placedGlyphBoxes,bc&&bc.box&&bc.box.length)){lt=!0,Rn=Uh.shift;break}}return bc};Ti(()=>Xn(yo,Ke.iconBox,u.WritingMode.horizontal),()=>{const ki=Ke.verticalTextBox;return ki&&Ci(ki),E.allowVerticalPlacement&&!(en&&en.box&&en.box.length)&&qe>0&&ki?Xn(ki,Ke.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),en&&(lt=en.box,pt=en.offscreen,It=en.occluded);const vo=pi(!(!en||!en.box));if(!lt&&this.prevPlacement){const ki=this.prevPlacement.variableOffsets[xt];ki&&(this.variableOffsets[xt]=ki,this.markUsedJustification(E,ki.anchor,Ue,vo))}}else{const di=(Xn,vo)=>{const ki=E.getSymbolInstanceTextSize(ie,Ue,this.transform.zoom,ut),Ji=this.collisionIndex.placeCollisionBox(E,ki,Xn,new u.Point(0,0),le,H,A,re.predicate);return Ji&&Ji.box&&Ji.box.length&&(this.markUsedOrientation(E,vo,Ue),this.placedOrientations[xt]=vo),Ji};Ti(()=>di(yo,u.WritingMode.horizontal),()=>{const Xn=Ke.verticalTextBox;return E.allowVerticalPlacement&&qe>0&&Xn?(Ci(Xn),di(Xn,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),pi(!!(en&&en.box&&en.box.length))}}if(Jn=en,lt=Jn&&Jn.box&&Jn.box.length>0,pt=Jn&&Jn.offscreen,It=Jn&&Jn.occluded,Ue.useRuntimeCollisionCircles){const pi=E.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex>=0?Ue.centerJustifiedTextSymbolIndex:Ue.verticalPlacedTextSymbolIndex),Ti=u.evaluateSizeForFeature(E.textSizeData,ie,pi),di=I.get("text-padding");Kn=this.collisionIndex.placeCollisionCircles(E,le,pi,E.lineVertexArray,E.glyphOffsetArray,Ti,A,R,B,_,Ee,re.predicate,Ue.collisionCircleDiameter*Ti/u.ONE_EM,di,this.retainedQueryData[E.bucketInstanceId].tileID),lt=le||Kn.circles.length>0&&!Kn.collisionDetected,pt=pt&&Kn.offscreen,It=Kn.occluded}if(Ke.iconFeatureIndex&&(Li=Ke.iconFeatureIndex),Ke.iconBox){const pi=Ti=>{Ci(Ti);const di=we&&Rn?Il(Rn.x,Rn.y,be,Ee,this.transform.angle):new u.Point(0,0),Xn=E.getSymbolInstanceIconSize(ne,this.transform.zoom,Ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Xn,Ti,di,ce,H,A,re.predicate)};bn&&bn.box&&bn.box.length&&Ke.verticalIconBox?(Kt=pi(Ke.verticalIconBox),Dt=Kt.box.length>0):(Kt=pi(Ke.iconBox),Dt=Kt.box.length>0),pt=pt&&Kt.offscreen,un=Kt.occluded}const co=G||0===Ue.numHorizontalGlyphVertices&&0===qe,Yo=ee||0===Ue.numIconVertices;if(co||Yo?Yo?co||(Dt=Dt&&lt):lt=Dt&&lt:Dt=lt=Dt&&lt,lt&&Jn&&Jn.box&&this.collisionIndex.insertCollisionBox(Jn.box,I.get("text-ignore-placement"),E.bucketInstanceId,bn&&bn.box&&Ri?Ri:bi,re.ID),Dt&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,I.get("icon-ignore-placement"),E.bucketInstanceId,Li,re.ID),Kn&&(lt&&this.collisionIndex.insertCollisionCircles(Kn.circles,I.get("text-ignore-placement"),E.bucketInstanceId,bi,re.ID),_)){const pi=E.bucketInstanceId;let Ti=this.collisionCircleArrays[pi];void 0===Ti&&(Ti=this.collisionCircleArrays[pi]=new vi);for(let di=0;di<Kn.circles.length;di+=4)Ti.circles.push(Kn.circles[di+0]),Ti.circles.push(Kn.circles[di+1]),Ti.circles.push(Kn.circles[di+2]),Ti.circles.push(Kn.collisionDetected?1:0)}const za="globe"!==E.projection.name;Pe=Pe&&(za||!It),Ze=Ze&&(za||!un),this.placements[xt]=new Us(lt||Pe,Dt||Ze,pt||E.justReloaded),d.add(xt)};if(Ne){const Ue=E.getSortedSymbolIndexes(this.transform.angle);for(let ut=Ue.length-1;ut>=0;--ut){const Ke=Ue[ut];Et(E.symbolInstances.get(Ke),Ke,E.collisionArrays[Ke])}}else for(let Ue=a.symbolInstanceStart;Ue<a.symbolInstanceEnd;Ue++)Et(E.symbolInstances.get(Ue),Ue,E.collisionArrays[Ue]);if(_&&E.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[E.bucketInstanceId];u.invert(Ue.invProjMatrix,A),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(a,d,_,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R,crossTileID:B}=_,z=u.getAnchorJustification(d),H=b===u.WritingMode.vertical?R:"left"===z?E:"center"===z?I:"right"===z?A:-1;E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:B),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:B),A>=0&&(a.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:B),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=H>=0&&R!==H?0:B)}markUsedOrientation(a,d,_){const b=d===u.WritingMode.horizontal||d===u.WritingMode.horizontalOnly?d:0,E=d===u.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:B}=_,z=a.text.placedSymbolArray;I>=0&&(z.get(I).placedOrientation=b),A>=0&&(z.get(A).placedOrientation=b),R>=0&&(z.get(R).placedOrientation=b),B>=0&&(z.get(B).placedOrientation=E)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(a):1,E=d?d.opacities:{},I=d?d.variableOffsets:{},A=d?d.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],z=E[R];z?(this.opacities[R]=new Po(z,b,B.text,B.icon,null,B.clipped),_=_||B.text!==z.text.placed||B.icon!==z.icon.placed):(this.opacities[R]=new Po(null,b,B.text,B.icon,B.skipFade,B.clipped),_=_||B.text||B.icon)}for(const R in E){const B=E[R];if(!this.opacities[R]){const z=new Po(B,b,!1,!1);z.isHidden()||(this.opacities[R]=z,_=_||B.text.placed||B.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);_?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const _=new Set;for(const b of d){const E=b.getBucket(a);E&&b.latestFeatureIndex&&a.id===E.layerIds[0]&&this.updateBucketOpacities(E,_,b.collisionBoxArray)}}updateBucketOpacities(a,d,_){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const b=a.layers[0].layout,E=!!a.layers[0].dynamicFilter(),I=new Po(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),B=b.get("text-variable-anchor"),z="map"===b.get("text-rotation-alignment"),H="map"===b.get("text-pitch-alignment"),K="none"!==b.get("icon-text-fit"),te=new Po(null,0,A&&(R||!a.hasIconData()||b.get("icon-optional")),R&&(A||!a.hasTextData()||b.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const ie=(re,G,ee)=>{for(let le=0;le<G/4;le++)re.opacityVertexArray.emplaceBack(ee)};let ne=0;for(let re=0;re<a.symbolInstances.length;re++){const G=a.symbolInstances.get(re),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:le,crossTileID:ce,numIconVertices:be}=G,Ee=d.has(ce);let we=this.opacities[ce];Ee?we=I:we||(we=te,this.opacities[ce]=we),d.add(ce);const Ne=ee>0||le>0,Pe=be>0,Ze=this.placedOrientations[ce],Et=Ze===u.WritingMode.vertical,Ue=Ze===u.WritingMode.horizontal||Ze===u.WritingMode.horizontalOnly;if(!Ne&&!Pe||we.isHidden()||ne++,Ne){const ut=Or(we.text);ie(a.text,ee,Et?ar:ut),ie(a.text,le,Ue?ar:ut);const Ke=we.text.isHidden(),{leftJustifiedTextSymbolIndex:xt,centerJustifiedTextSymbolIndex:qe,rightJustifiedTextSymbolIndex:lt,verticalPlacedTextSymbolIndex:Dt}=G,pt=a.text.placedSymbolArray,It=Ke||Et?1:0;xt>=0&&(pt.get(xt).hidden=It),qe>=0&&(pt.get(qe).hidden=It),lt>=0&&(pt.get(lt).hidden=It),Dt>=0&&(pt.get(Dt).hidden=Ke||Ue?1:0);const un=this.variableOffsets[ce];un&&this.markUsedJustification(a,un.anchor,G,Ze);const Rn=this.placedOrientations[ce];Rn&&(this.markUsedJustification(a,"left",G,Rn),this.markUsedOrientation(a,Rn,G))}if(Pe){const ut=Or(we.icon),{placedIconSymbolIndex:Ke,verticalPlacedIconSymbolIndex:xt}=G,qe=a.icon.placedSymbolArray,lt=we.icon.isHidden()?1:0;Ke>=0&&(ie(a.icon,be,Et?ar:ut),qe.get(Ke).hidden=lt),xt>=0&&(ie(a.icon,G.numVerticalIconVertices,Ue?ar:ut),qe.get(xt).hidden=lt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ut=a.collisionArrays[re];if(ut){let Ke=new u.Point(0,0),xt=!0;if(ut.textBox||ut.verticalTextBox){if(B){const lt=this.variableOffsets[ce];lt?(Ke=js(lt.anchor,lt.width,lt.height,lt.textOffset,lt.textScale),z&&Ke._rotate(H?this.transform.angle:-this.transform.angle)):xt=!1}E&&(xt=!we.clipped),ut.textBox&&Mt(a.textCollisionBox.collisionVertexArray,we.text.placed,!xt||Et,Ke.x,Ke.y),ut.verticalTextBox&&Mt(a.textCollisionBox.collisionVertexArray,we.text.placed,!xt||Ue,Ke.x,Ke.y)}const qe=xt&&!(Ue||!ut.verticalIconBox);ut.iconBox&&Mt(a.iconCollisionBox.collisionVertexArray,we.icon.placed,qe,K?Ke.x:0,K?Ke.y:0),ut.verticalIconBox&&Mt(a.iconCollisionBox.collisionVertexArray,we.icon.placed,!qe,K?Ke.x:0,K?Ke.y:0)}}}if(a.fullyClipped=0===ne,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=re.invProjMatrix,a.placementViewportMatrix=re.viewportMatrix,a.collisionCircleArray=re.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function Mt(m,a,d,_,b){m.emplaceBack(a?1:0,d?1:0,_||0,b||0),m.emplaceBack(a?1:0,d?1:0,_||0,b||0),m.emplaceBack(a?1:0,d?1:0,_||0,b||0),m.emplaceBack(a?1:0,d?1:0,_||0,b||0)}const kr=Math.pow(2,25),cn=Math.pow(2,24),on=Math.pow(2,17),$o=Math.pow(2,16),ri=Math.pow(2,9),Ro=Math.pow(2,8),Al=Math.pow(2,1);function Or(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const a=m.placed?1:0,d=Math.floor(127*m.opacity);return d*kr+a*cn+d*on+a*$o+d*ri+a*Ro+d*Al+a}const ar=0;class ss{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,d,_,b,E){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(I,b,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(d.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class qc{constructor(a,d,_,b,E,I,A,R){this.placement=new Da(a,E,I,A,R),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(a,d,_){const b=u.exported.now(),E=()=>{const I=u.exported.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=d[a[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ss(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Wr=512/u.EXTENT/2;class xi{constructor(a,d,_){this.tileID=a,this.bucketInstanceId=_,this.index=new u.KDBush(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=a.canonical.x*u.EXTENT,E=a.canonical.y*u.EXTENT;for(let I=0;I<d.length;I++){const{key:A,crossTileID:R,tileAnchorX:B,tileAnchorY:z}=d.get(I),H=Math.floor((b+B)*Wr),K=Math.floor((E+z)*Wr);this.index.add(H,K),this.keys.push(A),this.crossTileIDs.push(R)}this.index.finish()}findMatches(a,d,_){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=Wr/Math.pow(2,d.canonical.z-this.tileID.canonical.z),I=d.canonical.x*u.EXTENT,A=d.canonical.y*u.EXTENT;for(let R=0;R<a.length;R++){const B=a.get(R);if(B.crossTileID)continue;const{key:z,tileAnchorX:H,tileAnchorY:K}=B,te=Math.floor((I+H)*E),ie=Math.floor((A+K)*E),ne=this.index.range(te-b,ie-b,te+b,ie+b);for(const re of ne){const G=this.crossTileIDs[re];if(this.keys[re]===z&&!_.has(G)){_.add(G),B.crossTileID=G;break}}}}}class Ma{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(0!==d)for(const _ in this.indexes){const b=this.indexes[_],E={};for(const I in b){const A=b[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),E[A.tileID.key]=A}this.indexes[_]=E}this.lng=a}addBucket(a,d,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const b=this.usedCrossTileIDs[a.overscaledZ];for(const E in this.indexes){const I=this.indexes[E];if(Number(E)>a.overscaledZ)for(const A in I){const R=I[A];R.tileID.isChildOf(a)&&R.findMatches(d.symbolInstances,a,b)}else{const A=I[a.scaledTo(Number(E)).key];A&&A.findMatches(d.symbolInstances,a,b)}}for(let E=0;E<d.symbolInstances.length;E++){const I=d.symbolInstances.get(E);I.crossTileID||(I.crossTileID=_.generate(),b.add(I.crossTileID))}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new xi(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const _ of d.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let d=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const E in b)a[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[E]),delete b[E],d=!0)}return d}}class $s{constructor(){this.layerIndexes={},this.crossTileIDs=new Ma,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,_,b){let E=this.layerIndexes[a.id];void 0===E&&(E=this.layerIndexes[a.id]=new Pu);let I=!1;const A={};"globe"!==b.name&&E.handleWrapJump(_);for(const R of d){const B=R.getBucket(a);B&&a.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(R.tileID,B,this.crossTileIDs)&&(I=!0),A[B.bucketInstanceId]=!0)}return E.removeStaleBuckets(A)&&(I=!0),I}pruneUnusedLayers(a){const d={};a.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const Sa=(m,a)=>u.emitValidationErrors(m,a&&a.filter(d=>"source.canvas"!==d.identifier)),Zc=u.pick(Yn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ru=u.pick(Yn,["setCenter","setZoom","setBearing","setPitch"]),Ph={version:8,layers:[],sources:{}},Ur={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ut extends u.Evented{constructor(a,d={}){super(),this.map=a,this.dispatcher=new ir(wa(),this),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(a._requestManager,d.localFontFamily?u.LocalGlyphMode.all:d.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new $s,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const _=this;this._rtlTextPluginCallback=Ut.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,I)=>{if(u.triggerPluginCompletionEvent(E),I&&I.every(A=>A))for(const A in _._sourceCaches){const R=_._sourceCaches[A],B=R.getSource().type;"vector"!==B&&"geojson"!==B||R.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===E.id&&this._validateLayer(A)}})}loadURL(a,d={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!u.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,d.accessToken);const b=this.map._requestManager.transformRequest(a,u.ResourceType.Style);this._request=u.getJSON(b,(E,I)=>{this._request=null,E?this.fire(new u.ErrorEvent(E)):I&&this._load(I,_)})}loadJSON(a,d={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(a,!1!==d.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Ph,!1)}_updateLayerCount(a,d){const _=d?1:-1;a.is3D()&&(this._num3DLayers+=_),"circle"===a.type&&(this._numCircleLayers+=_),"symbol"===a.type&&(this._numSymbolLayers+=_)}_load(a,d){if(d&&Sa(this,u.validateStyle(a)))return;this._loaded=!0,this.stylesheet=u.clone$1(a),this._updateMapProjection();for(const b in a.sources)this.addSource(b,a.sources[b],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const _=Ah(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of _){const E=u.createStyleLayer(b);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Cn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(d,_,b){let E,I,A;const R=u.exported.devicePixelRatio>1?"@2x":"";let B=u.getJSON(_.transformRequest(_.normalizeSpriteURL(d,R,".json"),u.ResourceType.SpriteJSON),(K,te)=>{B=null,A||(A=K,E=te,H())}),z=u.getImage(_.transformRequest(_.normalizeSpriteURL(d,R,".png"),u.ResourceType.SpriteImage),(K,te)=>{z=null,A||(A=K,I=te,H())});function H(){if(A)b(A);else if(E&&I){const K=u.exported.getImageData(I),te={};for(const ie in E){const{width:ne,height:re,x:G,y:ee,sdf:le,pixelRatio:ce,stretchX:be,stretchY:Ee,content:we}=E[ie],Ne=new u.RGBAImage({width:ne,height:re});u.RGBAImage.copy(K,Ne,{x:G,y:ee},{x:0,y:0},{width:ne,height:re}),te[ie]={data:Ne,pixelRatio:ce,sdf:le,stretchX:be,stretchY:Ee,content:we}}b(null,te)}}return{cancel(){B&&(B.cancel(),B=null),z&&(z.cancel(),z=null)}}}(a,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new u.ErrorEvent(d));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(a){const d=this.getSource(a.source);if(!d)return;const _=a.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const d=[];for(const _ of a){const b=this._layers[_];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&("function"==typeof a.isLayerDraped?a.isLayerDraped():Ur[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const I in this._updatedSources){const A=this._updatedSources[I];"reload"===A?this._reloadSource(I):"clear"===A&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const E=this._sourceCaches[b];_[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];if(E.recalculate(a,this._availableImages),!E.isHidden(a.zoom)){const A=this._getLayerSourceCache(E);A&&(A.used=!0)}const I=this.map.painter;if(I){const A=E.getProgramIds();if(!A)continue;const R=E.getProgramConfiguration(a.zoom);for(const B of A)I.useProgram(B,R)}}for(const b in _){const E=this._sourceCaches[b];_[b]!==E.used&&E.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Sa(this,u.validateStyle(a)))return!1;(a=u.clone$1(a)).layers=Ah(a.layers);const d=function(b,E){if(!b)return[{command:Yn.setStyle,args:[E]}];let I=[];try{if(!Q(b.version,E.version))return[{command:Yn.setStyle,args:[E]}];Q(b.center,E.center)||I.push({command:Yn.setCenter,args:[E.center]}),Q(b.zoom,E.zoom)||I.push({command:Yn.setZoom,args:[E.zoom]}),Q(b.bearing,E.bearing)||I.push({command:Yn.setBearing,args:[E.bearing]}),Q(b.pitch,E.pitch)||I.push({command:Yn.setPitch,args:[E.pitch]}),Q(b.sprite,E.sprite)||I.push({command:Yn.setSprite,args:[E.sprite]}),Q(b.glyphs,E.glyphs)||I.push({command:Yn.setGlyphs,args:[E.glyphs]}),Q(b.transition,E.transition)||I.push({command:Yn.setTransition,args:[E.transition]}),Q(b.light,E.light)||I.push({command:Yn.setLight,args:[E.light]}),Q(b.fog,E.fog)||I.push({command:Yn.setFog,args:[E.fog]}),Q(b.projection,E.projection)||I.push({command:Yn.setProjection,args:[E.projection]});const A={},R=[];!function(H,K,te,ie){let ne;for(ne in K=K||{},H=H||{})H.hasOwnProperty(ne)&&(K.hasOwnProperty(ne)||vr(ne,te,ie));for(ne in K){if(!K.hasOwnProperty(ne))continue;const re=K[ne];H.hasOwnProperty(ne)?Q(H[ne],re)||("geojson"===H[ne].type&&"geojson"===re.type&&oo(H,K,ne)?te.push({command:Yn.setGeoJSONSourceData,args:[ne,re.data]}):Ea(ne,K,te,ie)):Iu(ne,K,te)}}(b.sources,E.sources,R,A);const B=[];b.layers&&b.layers.forEach(H=>{H.source&&A[H.source]?I.push({command:Yn.removeLayer,args:[H.id]}):B.push(H)});let z=b.terrain;z&&A[z.source]&&(I.push({command:Yn.setTerrain,args:[void 0]}),z=void 0),I=I.concat(R),Q(z,E.terrain)||I.push({command:Yn.setTerrain,args:[E.terrain]}),function(H,K,te){K=K||[];const ie=(H=H||[]).map(zs),ne=K.map(zs),re=H.reduce(Au,{}),G=K.reduce(Au,{}),ee=ie.slice(),le=Object.create(null);let ce,be,Ee,we,Ne,Pe,Ze;for(ce=0,be=0;ce<ie.length;ce++)Ee=ie[ce],G.hasOwnProperty(Ee)?be++:(te.push({command:Yn.removeLayer,args:[Ee]}),ee.splice(ee.indexOf(Ee,be),1));for(ce=0,be=0;ce<ne.length;ce++)Ee=ne[ne.length-1-ce],ee[ee.length-1-ce]!==Ee&&(re.hasOwnProperty(Ee)?(te.push({command:Yn.removeLayer,args:[Ee]}),ee.splice(ee.lastIndexOf(Ee,ee.length-be),1)):be++,Pe=ee[ee.length-ce],te.push({command:Yn.addLayer,args:[G[Ee],Pe]}),ee.splice(ee.length-ce,0,Ee),le[Ee]=!0);for(ce=0;ce<ne.length;ce++)if(Ee=ne[ce],we=re[Ee],Ne=G[Ee],!le[Ee]&&!Q(we,Ne))if(Q(we.source,Ne.source)&&Q(we["source-layer"],Ne["source-layer"])&&Q(we.type,Ne.type)){for(Ze in Fs(we.layout,Ne.layout,te,Ee,null,Yn.setLayoutProperty),Fs(we.paint,Ne.paint,te,Ee,null,Yn.setPaintProperty),Q(we.filter,Ne.filter)||te.push({command:Yn.setFilter,args:[Ee,Ne.filter]}),Q(we.minzoom,Ne.minzoom)&&Q(we.maxzoom,Ne.maxzoom)||te.push({command:Yn.setLayerZoomRange,args:[Ee,Ne.minzoom,Ne.maxzoom]}),we)we.hasOwnProperty(Ze)&&"layout"!==Ze&&"paint"!==Ze&&"filter"!==Ze&&"metadata"!==Ze&&"minzoom"!==Ze&&"maxzoom"!==Ze&&(0===Ze.indexOf("paint.")?Fs(we[Ze],Ne[Ze],te,Ee,Ze.slice(6),Yn.setPaintProperty):Q(we[Ze],Ne[Ze])||te.push({command:Yn.setLayerProperty,args:[Ee,Ze,Ne[Ze]]}));for(Ze in Ne)Ne.hasOwnProperty(Ze)&&!we.hasOwnProperty(Ze)&&"layout"!==Ze&&"paint"!==Ze&&"filter"!==Ze&&"metadata"!==Ze&&"minzoom"!==Ze&&"maxzoom"!==Ze&&(0===Ze.indexOf("paint.")?Fs(we[Ze],Ne[Ze],te,Ee,Ze.slice(6),Yn.setPaintProperty):Q(we[Ze],Ne[Ze])||te.push({command:Yn.setLayerProperty,args:[Ee,Ze,Ne[Ze]]}))}else te.push({command:Yn.removeLayer,args:[Ee]}),Pe=ee[ee.lastIndexOf(Ee)+1],te.push({command:Yn.addLayer,args:[Ne,Pe]})}(B,E.layers,I)}catch(A){console.warn("Unable to compute style diff:",A),I=[{command:Yn.setStyle,args:[E]}]}return I}(this.serialize(),a).filter(b=>!(b.command in Ru));if(0===d.length)return!1;const _=d.filter(b=>!(b.command in Zc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&"setProjection"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,d){return this.getImage(a)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,d),this._afterImageUpdated(a),this)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(u.validateSource,`sources.${a}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=Mn(a,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:b.serialize(),sourceId:a}));const E=I=>{const A=(I?"symbol:":"other:")+a,R=this._sourceCaches[A]=new u.SourceCache(A,b,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=R,R.style=this,R.onAdd(this.map)};E(!1),"vector"!==d.type&&"geojson"!==d.type||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const d=this.getSource(a);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===a)return this.fire(new u.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new u.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(a);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,d){this._checkLoaded(),this.getSource(a).setData(d),this._changed=!0}getSource(a){const d=this._getSourceCache(a);return d&&d.getSource()}_getSources(){const a=[];for(const d in this._otherSourceCaches){const _=this._getSourceCache(d);_&&a.push(_.getSource())}return a}addLayer(a,d,_={}){this._checkLoaded();const b=a.id;if(this.getLayer(b))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if("custom"===a.type){if(Sa(this,u.validateCustomStyleLayer(a)))return;E=u.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(b,a.source),a=u.clone$1(a),a=u.extend(a,{source:b})),this._validate(u.validateLayer,`layers.${b}`,a,{arrayIndex:-1},_))return;E=u.createStyleLayer(a),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const I=d?this._order.indexOf(d):this._order.length;if(d&&-1===I)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=E;const A=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&A&&"custom"!==E.type){const R=this._removedLayers[b];delete this._removedLayers[b],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",A.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const _=this._order.indexOf(a);this._order.splice(_,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new u.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const d in this._layers)if(this._layers[d].type===a)return!0;return!1}setLayerZoomRange(a,d,_){this._checkLoaded();const b=this.getLayer(a);b?b.minzoom===d&&b.maxzoom===_||(null!=d&&(b.minzoom=d),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,d,_={}){this._checkLoaded();const b=this.getLayer(a);if(b){if(!Q(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(u.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=u.clone$1(d),this._updateLayer(b)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const d=this.getLayer(a);return d&&u.clone$1(d.filter)}setLayoutProperty(a,d,_,b={}){this._checkLoaded();const E=this.getLayer(a);E?Q(E.getLayoutProperty(d),_)||(E.setLayoutProperty(d,_,b),this._updateLayer(E)):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,d){const _=this.getLayer(a);if(_)return _.getLayoutProperty(d);this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,d,_,b={}){this._checkLoaded();const E=this.getLayer(a);E?Q(E.getPaintProperty(d),_)||(E.setPaintProperty(d,_,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,d){const _=this.getLayer(a);return _&&_.getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const _=a.source,b=a.sourceLayer,E=this.getSource(_);if(!E)return void this.fire(new u.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=E.type;if("geojson"===I&&b)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!b)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const R of A)R.setFeatureState(b,a.id,d)}removeFeatureState(a,d){this._checkLoaded();const _=a.source,b=this.getSource(_);if(!b)return void this.fire(new u.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const E=b.type,I="vector"===E?a.sourceLayer:void 0;if("vector"===E&&!I)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const R of A)R.removeFeatureState(I,a.id,d)}getFeatureState(a){this._checkLoaded();const d=a.source,_=a.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||_)return void 0===a.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,a.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();a[_.id]||(a[_.id]=_.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(a){this._updatedLayers[a.id]=!0;const d=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[a.source]="reload",d.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const d=I=>"fill-extrusion"===this._layers[I].type,_={},b=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(d(A)){_[A]=I;for(const R of a){const B=R[A];if(B)for(const z of B)b.push(z)}}}b.sort((I,A)=>A.intersectionZ-I.intersectionZ);const E=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(d(A))for(let R=b.length-1;R>=0;R--){const B=b[R].feature;if(_[B.layer.id]<I)break;E.push(B),b.pop()}else for(const R of a){const B=R[A];if(B)for(const z of B)E.push(z.feature)}}return E}queryRenderedFeatures(a,d,_){d&&d.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const B=this._layers[R];if(!B)return this.fire(new u.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const E=[];d.availableImages=this._availableImages;const I=d&&d.layers?d.layers.some(R=>{const B=this.getLayer(R);return B&&B.is3D()}):this.has3DLayers(),A=In.createFromScreenPoints(a,_);for(const R in this._sourceCaches){const B=this._sourceCaches[R].getSource().id;d.layers&&!b[B]||E.push(zi(this._sourceCaches[R],this._layers,this._serializedLayers,A,d,_,I,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(R,B,z,H,K,te,ie){const ne={},re=te.queryRenderedSymbols(H),G=[];for(const ee of Object.keys(re).map(Number))G.push(ie[ee]);G.sort(Ei);for(const ee of G){const le=ee.featureIndex.lookupSymbolFeatures(re[ee.bucketInstanceId],B,ee.bucketIndex,ee.sourceLayerIndex,K.filter,K.layers,K.availableImages,R);for(const ce in le){const be=ne[ce]=ne[ce]||[],Ee=le[ce];Ee.sort((we,Ne)=>{const Pe=ee.featureSortOrder;if(Pe){const Ze=Pe.indexOf(we.featureIndex);return Pe.indexOf(Ne.featureIndex)-Ze}return Ne.featureIndex-we.featureIndex});for(const we of Ee)be.push(we)}}for(const ee in ne)ne[ee].forEach(le=>{const ce=le.feature,be=z(R[ee]);if(!be)return;const Ee=be.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=Ee});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(a,d){d&&d.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(a);let b=[];for(const E of _)b=b.concat(fr(E,d));return b}addSourceType(a,d,_){return Ut.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(Ut.setSourceType(a,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(a,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const I in a)if(!Q(a[I],_[I])){b=!0;break}if(!b)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,d=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=a;if(1===d){if("object"==typeof _.source){const b="terrain-dem-src";this.addSource(b,_.source),_=u.clone$1(_),_=u.extend(_,{source:b})}if(this._validate(u.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,d)}else{const b=this.terrain,E=b.get();for(const I of Object.keys(u.spec.terrain))!_.hasOwnProperty(I)&&u.spec.terrain[I].default&&(_[I]=u.spec.terrain[I].default);for(const I in _)if(!Q(_[I],E[I])){b.set(_),this.stylesheet.terrain=_;const A=this._setTransitionParameters({duration:0});b.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const d=this.fog=new wn(a,this.map.transform);this.stylesheet.fog=a;const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();0===Object.keys(a).length&&d.set(a);for(const b in a)if(!Q(a[b],_[b])){d.set(a),this.stylesheet.fog=a;const E=this._setTransitionParameters({duration:0});d.updateTransitions(E);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:u.exported.now(),transition:u.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...d)}_createTerrain(a,d){const _=this.terrain=new $i(a,d);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});_.updateTransitions(b)}_force3DLayerUpdate(){for(const a in this._layers){const d=this._layers[a];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const d=this._layers[a];"symbol"===d.type&&this._updateLayer(d)}}_validate(a,d,_,b,E={}){return(!E||!1!==E.validate)&&Sa(this,a.call(u.validateStyle,u.extend({key:d,style:this.serialize(),value:_,styleSpec:u.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const d=this._getSourceCaches(a);for(const _ of d)_.clearTiles()}_reloadSource(a){const d=this._getSourceCaches(a);for(const _ of d)_.resume(),_.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const d in this._sourceCaches)this._sourceCaches[d].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const d=this._sourceCaches[a];d.resume(),d.reload()}}_updatePlacement(a,d,_,b,E=!1){let I=!1,A=!1;const R={};for(const B of this._order){const z=this._layers[B];if("symbol"!==z.type)continue;if(!R[z.source]){const K=this._getLayerSourceCache(z);if(!K)continue;R[z.source]=K.getRenderableIds(!0).map(te=>K.getTileByID(te)).sort((te,ie)=>ie.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ie.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,R[z.source],a.center.lng,a.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),a.zoom))&&(this.pauseablePlacement=new qc(a,this._order,E,d,_,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const B of this._order){const z=this._layers[B];"symbol"===z.type&&this.placement.updateLayerOpacities(z,R[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const b=E=>{E&&E.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(a,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(a,d,_){return u.makeRequest(d,_)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const d=[];return this._otherSourceCaches[a]&&d.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&d.push(this._symbolSourceCaches[a]),d}_isSourceCacheLoaded(a){const d=this._getSourceCaches(a);return 0===d.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ut.getSourceType=function(m){return zn[m]},Ut.setSourceType=function(m,a){zn[m]=a},Ut.registerForPluginStateChange=u.registerForPluginStateChange;var Rh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",so="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ho="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",an="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ia="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Nr={},Hs={};const Pl=[];Xr(Rh,Pl),Xr(Ho,Pl),Xr(an,Pl),Xr(Ia,Pl),Nr=ui("",Ho),Hs=ui(Ia,an);const Lu=ui("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Wc=Rh,Aa="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Rl={background:ui("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ui("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ui("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ui("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ui("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ui("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ui("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ui("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ui("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ui("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ui("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ui("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ui("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ui("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ui("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ui("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ui("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ui("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ui("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ui("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ui("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ui("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ui("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",so),skyboxGradient:ui("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",so),skyboxCapture:ui("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ui("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ui("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Xr(m,a){const d=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of d)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=_.split(" ");for(const E of b)a.includes(E)||a.push(E)}}function ui(m,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...Pl];return Xr(m,E),Xr(a,E),{fragmentSource:m=m.replace(d,(I,A,R,B,z)=>(b[z]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = u_${z};\n#endif\n`)),vertexSource:a=a.replace(d,(I,A,R,B,z)=>{const H="float"===B?"vec2":"vec4",K=z.match(/color/)?"color":H;return b[z]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`}),staticAttributes:_,usedDefines:E}}class Lh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,d,_,b,E,I,A){this.context=a;let R=this.boundPaintVertexBuffers.length!==b.length;for(let z=0;!R&&z<b.length;z++)this.boundPaintVertexBuffers[z]!==b[z]&&(R=!0);let B=this.boundDynamicVertexBuffers.length!==A.length;for(let z=0;!B&&z<A.length;z++)this.boundDynamicVertexBuffers[z]!==A[z]&&(B=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||R||B||this.boundIndexBuffer!==E||this.boundVertexOffset!==I)this.freshBind(d,_,b,E,I,A);else{a.bindVertexArrayOES.set(this.vao);for(const z of A)z&&z.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(a,d,_,b,E,I){let A;const R=a.numAttributes,B=this.context,z=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=I;else{A=B.currentNumAttributes||0;for(let H=R;H<A;H++)z.disableVertexAttribArray(H)}d.enableAttributes(z,a),d.bind(),d.setVertexAttribPointers(z,a,E);for(const H of _)H.enableAttributes(z,a),H.bind(),H.setVertexAttribPointers(z,a,E);for(const H of I)H&&(H.enableAttributes(z,a),H.bind(),H.setVertexAttribPointers(z,a,E));b&&b.bind(),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function $n(m,a){const d=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new u.MercatorCoordinate(0,_/d).toLngLat().lat,new u.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function cc(m,a,d,_,b,E,I){const A=m.context,R=A.gl,B=d.fbo;if(!B)return;m.prepareDrawTile();const z=m.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,B.colorAttachment.get());const H=((ne,re,G,ee)=>{const le=G.paint.get("hillshade-shadow-color"),ce=G.paint.get("hillshade-highlight-color"),be=G.paint.get("hillshade-accent-color");let Ee=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(Ee-=ne.transform.angle);const we=!ne.options.moving;return{u_matrix:ee||ne.transform.calculateProjMatrix(re.tileID.toUnwrapped(),we),u_image:0,u_latrange:$n(0,re.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Ee],u_shadow:le,u_highlight:ce,u_accent:be}})(m,d,_,m.terrain?a.projMatrix:null);m.prepareDrawProgram(A,z,a.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:te,tileBoundsSegments:ie}=m.getTileBoundsBuffers(d);z.draw(A,R.TRIANGLES,b,E,I,u.CullFaceMode.disabled,H,_.id,K,te,ie)}function uc(m,a,d){if(!a.needsDEMTextureUpload)return;const _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(d.stride);const E=d.getPixels();a.demTexture?a.demTexture.update(E,{premultiply:!1}):a.demTexture=new u.Texture(_,E,b.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Yr(m,a,d,_,b,E){const I=m.context,A=I.gl;if(!a.dem)return;const R=a.dem;if(I.activeTexture.set(A.TEXTURE1),uc(m,a,R),!a.demTexture)return;a.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const B=R.dim;I.activeTexture.set(A.TEXTURE0);let z=a.fbo;if(!z){const ie=new u.Texture(I,{width:B,height:B,data:null},A.RGBA);ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),z=a.fbo=I.createFramebuffer(B,B,!0),z.colorAttachment.set(ie.texture)}I.bindFramebuffer.set(z.framebuffer),I.viewport.set([0,0,B,B]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:te}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,b,E,u.CullFaceMode.disabled,((ie,ne)=>{const re=ne.stride,G=u.create();return u.ortho(G,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(G,G,[0,-u.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[re,re],u_zoom:ie.overscaledZ,u_unpack:ne.unpackVector}})(a.tileID,R),d.id,H,K,te),a.needsHillshadePrepare=!1}const Xc=m=>({u_matrix:new u.UniformMatrix4f(m),u_image0:new u.Uniform1i(m),u_skirt_height:new u.Uniform1f(m)}),Ll=(m,a)=>({u_matrix:m,u_image0:0,u_skirt_height:a}),wi=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:I,u_frustum_tr:A,u_frustum_br:R,u_frustum_bl:B,u_globe_pos:z,u_globe_radius:H,u_viewport:K,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:te});function hc(m,a){return null!=m&&null!=a&&!(!m.hasData()||!a.hasData())&&null!=m.demTexture&&null!=a.demTexture&&m.tileID.key!==a.tileID.key}const Pa=new class{constructor(){this.operations={}}newMorphing(m,a,d,_,b){if(m in this.operations){const E=this.operations[m];E.to.tileID.key!==d.tileID.key&&(E.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:b,from:a,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const d=this.operations[a];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Xt={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function kl(m){return 6*Math.pow(1.5,22-m)}function dc(m,a){const d=1<<m.z;return!a&&(0===m.x||m.x===d-1)||0===m.y||m.y===d-1}const nl=m=>({u_matrix:m});function Ra(m,a,d,_,b){if(b>0){const E=u.exported.now(),I=(E-m.timeAdded)/b,A=a?(E-a.timeAdded)/b:-1,R=d.getSource(),B=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),z=!a||Math.abs(a.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),H=z&&m.refreshedUponExpiration?1:u.clamp(z?I:1-A,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Gs extends u.SourceCache{constructor(a){const d={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new ir(wa(),null),b=Mn("mock-dem",d,_,a.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,d){a.state="loaded",d(null)}}class Ol extends u.SourceCache{constructor(a){const d=Mn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new ir(wa(),null),a.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,d,_){if(a.freezeTileCoverage)return;this.transform=a;const b=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,I)=>{if(E[I.key]="",!this._tiles[I.key]){const A=new u.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);A.state="loaded",this._tiles[I.key]=A}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(a){const d=this.proxyCachedFBO[a];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class il extends u.OverscaledTileID{constructor(a,d,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Lo extends u.Elevation{constructor(a,d){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,E]=function(R){const B=new u.StructArrayLayout2i4,z=new u.StructArrayLayout3ui6,H=131;B.reserve(17161),z.reserve(33800);const K=u.EXTENT/128,te=u.EXTENT+K/2,ie=te+K;for(let re=-K;re<ie;re+=K)for(let G=-K;G<ie;G+=K){const ee=G<0||G>te||re<0||re>te?24575:0,le=u.clamp(Math.round(G),0,u.EXTENT),ce=u.clamp(Math.round(re),0,u.EXTENT);B.emplaceBack(le+ee,ce)}const ne=(re,G)=>{const ee=G*H+re;z.emplaceBack(ee+1,ee,ee+H),z.emplaceBack(ee+H,ee+H+1,ee+1)};for(let re=1;re<129;re++)for(let G=1;G<129;G++)ne(G,re);return[0,129].forEach(re=>{for(let G=0;G<130;G++)ne(G,re),ne(re,G)}),[B,z,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(_,u.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(b),this.gridSegments=u.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,_.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ol(d.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const A=I.gl;this._overlapStencilMode=new u.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gs(d.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,d,_){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const b=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const E=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(d,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(R=>{const B=d.getTileByID(R).tileID;return B.projMatrix=_.calculateProjMatrix(B.toUnwrapped()),B});(function(R,B){const z=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new u.Point(z.x,z.y);R.sort((K,te)=>{if(te.overscaledZ-K.overscaledZ)return te.overscaledZ-K.overscaledZ;const ie=new u.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ne=new u.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),re=H.mult(1<<K.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(ie)-re.distSqr(ne)})})(b,this.painter),this._previousZoom=_.zoom;const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const B=I[R];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,a[R],E),B.usedForTerrain))continue;const z=a[R];B.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[d.id]=b.map(R=>new il(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const B=this.terrainTileForTile[R.key];if(!B)continue;const z=B.tileID.key;z in A||(this._visibleDemTiles.push(B),A[z]=z)}}_assignTerrainTiles(a){this._initializing||a.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,d=a.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(a.activeTexture.set(d.TEXTURE1),uc(this.painter,b,E))}}_prepareDemTileUniforms(a,d,_,b){if(!d||null==d.demTexture)return!1;const E=a.tileID.canonical,I=Math.pow(2,d.tileID.canonical.z-E.z),A=b||"";return _[`u_dem_tl${A}`]=[E.x*I%1,E.y*I%1],_[`u_dem_scale${A}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,d=a.gl;if(!this._emptyDepthBufferTexture){const _=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(a,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const E=b.dem.tree.minimums[0];return E>0&&a++,_+E},0);return a?d/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,d=a.gl;a.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new u.Texture(a,b,d.RGBA,{premultiply:!1}),E}setupElevationDraw(a,d,_){const b=this.painter.context,E=b.gl,I=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let R=null,B=null,z=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,K=_.morphing.dstDemTile;z=_.morphing.phase,H&&K&&(this._prepareDemTileUniforms(a,H,I,"_prev")&&(B=H),this._prepareDemTileUniforms(a,K,I)&&(R=K))}if(B&&R?(b.activeTexture.set(E.TEXTURE2),R.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),B.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),I.u_dem_lerp=z):(R=this.terrainTileForTile[a.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(a,R,I)?R.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const H=(1<<R.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=H}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,I),"globe"===this.painter.transform.projection.name){const H=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,H)}}globeUniformValues(a,d,_){const b=a.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,u.EXTENT,0),u_tile_br_up:b.upVector(d,u.EXTENT,u.EXTENT),u_tile_bl_up:b.upVector(d,0,u.EXTENT),u_tile_up_scale:_?u.globeMetersToEcef(1):b.upVectorScale(d,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const d=this.painter,_=this.painter.context;0!==a.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,I,A,R){if("globe"===b.transform.projection.name)!function(B,z,H,K,te){const ie=B.context,ne=ie.gl;let re,G;const ee=B.options.showTerrainWireframe?2:0,le=B.transform,ce=u.globeUseCustomAntiAliasing(B,ie,le),be=(xt,qe)=>{if(G===xt)return;const lt=[Xt[xt],"PROJECTION_GLOBE_VIEW"];ce&&lt.push("CUSTOM_ANTIALIASING"),qe&&lt.push(Xt[ee]),re=B.useProgram("globeRaster",null,lt),G=xt},Ee=B.colorModeForRenderPass(),we=new u.DepthMode(ne.LEQUAL,u.DepthMode.ReadWrite,B.depthRangeFor3D);Pa.update(te);const Ne=u.calculateGlobeMercatorMatrix(le),Pe=[u.mercatorXfromLng(le.center.lng),u.mercatorYfromLat(le.center.lat)],Ze=ee?[!1,!0]:[!1],Et=B.globeSharedBuffers,Ue=[le.width*u.exported.devicePixelRatio,le.height*u.exported.devicePixelRatio],ut=Float32Array.from(le.globeMatrix),Ke={useDenormalizedUpVectorScale:!0};if(Ze.forEach(xt=>{const qe=B.transform,lt=kl(qe.zoom)*z.exaggeration();G=-1;const Dt=xt?ne.LINES:ne.TRIANGLES;for(const pt of K){const It=H.getTile(pt),un=u.StencilMode.disabled,Rn=z.prevTerrainTileForTile[pt.key],en=z.terrainTileForTile[pt.key];hc(Rn,en)&&Pa.newMorphing(pt.key,Rn,en,te,250),ie.activeTexture.set(ne.TEXTURE0),It.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const bn=Pa.getMorphValuesForProxy(pt.key),Jn=bn?1:0;bn&&u.extend$1(Ke,{morphing:{srcDemTile:bn.from,dstDemTile:bn.to,phase:u.easeCubicInOut(bn.phase)}});const Kn=u.tileCornersToBounds(pt.canonical),Kt=u.getLatitudinalLod(Kn.getCenter().lat),bi=u.getGridMatrix(pt.canonical,Kn,Kt,qe.worldSize/qe._pixelsPerMercatorPixel),Ri=u.globeNormalizeECEF(u.globeTileBounds(pt.canonical)),Li=wi(qe.projMatrix,ut,Ne,Ri,u.globeToMercatorTransition(qe.zoom),Pe,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,Ue,lt,bi);if(be(Jn,xt),z.setupElevationDraw(It,re,Ke),B.prepareDrawProgram(ie,re,pt.toUnwrapped()),Et){const[Ci,yo,co]=xt?Et.getWirefameBuffers(B.context,Kt):Et.getGridBuffers(Kt,0!==lt);re.draw(ie,Dt,we,un,Ee,u.CullFaceMode.backCCW,Li,"globe_raster",Ci,yo,co)}}}),Et){const xt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&xt.push("CUSTOM_ANTIALIASING"),re=B.useProgram("globeRaster",null,xt);for(const qe of K){const{x:lt,y:Dt,z:pt}=qe.canonical,It=0===Dt,un=Dt===(1<<pt)-1,[Rn,en,bn,Jn]=Et.getPoleBuffers(pt);if(Jn&&(It||un)){const Kn=H.getTile(qe);ie.activeTexture.set(ne.TEXTURE0),Kn.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Kt=u.globePoleMatrixForTile(pt,lt,le);const bi=u.globeNormalizeECEF(u.globeTileBounds(qe.canonical)),Ri=(Li,Ci)=>Li.draw(ie,ne.TRIANGLES,we,u.StencilMode.disabled,Ee,u.CullFaceMode.disabled,wi(le.projMatrix,Kt,Kt,bi,0,Pe,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Ue,0),"globe_pole_raster",Ci,bn,Jn);z.setupElevationDraw(Kn,re,Ke),B.prepareDrawProgram(ie,re,qe.toUnwrapped()),It&&Ri(re,Rn),un&&(Kt=u.scale(u.create(),Kt,[1,-1,1]),Ri(re,en))}}}}(b,E,I,A,R);else{const B=b.context,z=B.gl;let H,K;const te=b.options.showTerrainWireframe?2:0,ie=(le,ce)=>{if(K===le)return;const be=[Xt[le]];ce&&be.push(Xt[te]),H=b.useProgram("terrainRaster",null,be),K=le},ne=b.colorModeForRenderPass(),re=new u.DepthMode(z.LEQUAL,u.DepthMode.ReadWrite,b.depthRangeFor3D);Pa.update(R);const G=b.transform,ee=kl(G.zoom)*E.exaggeration();(te?[!1,!0]:[!1]).forEach(le=>{K=-1;const ce=le?z.LINES:z.TRIANGLES,[be,Ee]=le?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const we of A){const Ne=I.getTile(we),Pe=u.StencilMode.disabled,Ze=E.prevTerrainTileForTile[we.key],Et=E.terrainTileForTile[we.key];hc(Ze,Et)&&Pa.newMorphing(we.key,Ze,Et,R,250),B.activeTexture.set(z.TEXTURE0),Ne.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ue=Pa.getMorphValuesForProxy(we.key),ut=Ue?1:0;let Ke;Ue&&(Ke={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:u.easeCubicInOut(Ue.phase)}});const xt=Ll(we.projMatrix,dc(we.canonical,G.renderWorldCopies)?ee/10:ee);ie(ut,le),E.setupElevationDraw(Ne,H,Ke),b.prepareDrawProgram(B,H,we.toUnwrapped()),H.draw(B,ce,re,Pe,ne,u.CullFaceMode.backCCW,xt,"terrain_raster",E.gridBuffer,be,Ee)}})}}(d,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],I=this._drapedRenderBatches.shift(),A=[],R=d.style.order;let B=0;for(const z of E){const H=b.getTileByID(z.proxyTileKey),K=b.proxyCachedFBO[z.key]?b.proxyCachedFBO[z.key][a]:void 0,te=void 0!==K?b.renderCache[K]:this.pool[B++],ie=void 0!==K;if(H.texture=te.tex,ie&&!te.dirty){A.push(H.tileID);continue}let ne;_.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(_.clear({color:u.Color.transparent,stencil:0}),te.dirty=!1);for(let re=I.start;re<=I.end;++re){const G=d.style._layers[R[re]];if(G.isHidden(d.transform.zoom))continue;const ee=d.style._getLayerSourceCache(G),le=ee?this.proxyToSource[z.key][ee.id]:[z];if(!le)continue;const ce=le;_.viewport.set([0,0,te.fb.width,te.fb.height]),ne!==(ee?ee.id:null)&&(this._setupStencil(te,le,G,ee),ne=ee?ee.id:null),d.renderLayer(d,ee,G,ce)}this.renderedToTile?(te.dirty=!0,A.push(H.tileID)):ie||--B,5===B&&(B=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const d=a.order.length;if(0===d)return{efficiency:100};let _,b=0,E=0,I=!1;for(let A=0;A<d;++A){const R=a._layers[a.order[A]];this._style.isLayerDraped(R)?(I&&++b,++E):I||(I=!0,_=R.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{a=Math.min(a,d.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,d,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const I=E.tileID,A=1<<I.overscaledZ,{x:R,y:B}=I.canonical,z=R/A,H=(R+1)/A,K=B/A,te=(B+1)/A;return{minx:z,miny:K,maxx:H,maxy:te,t:E.dem.tree.raycastRoot(z,K,H,te,a,d,_),tile:E}});b.sort((E,I)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const E of b){if(null==E.t)return null;const I=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,a,d,_);if(null!=I)return I}return null}_createFBO(){const a=this.painter.context,d=a.gl,_=this.drapeBufferSize;a.activeTexture.set(d.TEXTURE0);const b=new u.Texture(a,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const E=a.createFramebuffer(_[0],_[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new Ce(a,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const d=this._style._layers[a],_=d.isHidden(this.painter.transform.zoom);return"custom"===d.type?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const _ of this._style._getSources())if(_ instanceof Ft){a=!0;break}if(!a)return;const d={};for(let _=0;_<this._style.order.length;++_){const b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(E&&!d[E.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof u.ZoomDependentExpression){d[E.id]=!0;for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][E.id];if(A)for(const R of A)this._clearRenderCacheForTile(E.id,R)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Ct){a=!0;break}if(!a)return;const d={};for(let _=0;_<this._style.order.length;++_){const b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(!E||d[E.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const I=b.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][E.id];if(R)for(const B of R){const z=Ra(E.getTile(B),E.findLoadedParent(B,0),E,this.painter.transform,I);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(E.id,B)}}}}_setupDrapedRenderBatches(){const a=this._style.order,d=a.length;if(0===d)return;const _=[];let b,E=0,I=this._style._layers[a[E]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++E<d;)I=this._style._layers[a[E]];for(;E<d;++E){const A=this._style._layers[a[E]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===b&&(b=E):void 0!==b&&(_.push({start:b,end:E-1}),b=void 0))}void 0!==b&&_.push({start:b,end:E-1}),this._drapedRenderBatches=_}_setupRenderCache(a){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const I=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let A=0;A<I.length;++A){const R=Object.values(I[A]);d.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const A=_[I];if(d.getTileByID(A.key),void 0!==d.proxyCachedFBO[A.key]){const R=a[A.key],B=this.proxyToSource[A.key];let z=0;for(const H in B){const K=B[H],te=R[H];if(!te||te.length!==K.length||K.some((ie,ne)=>ie!==te[ne]||b[H]&&b[H].hasOwnProperty(ie.key))){z=-1;break}++z}for(const H in d.proxyCachedFBO[A.key])d.renderCache[d.proxyCachedFBO[A.key][H]].dirty=z<0||z!==Object.values(R).length}}const E=[...this._drapedRenderBatches];E.sort((I,A)=>A.end-A.start-(I.end-I.start));for(const I of E)for(const A of _){if(d.proxyCachedFBO[A.key])continue;let R=d.renderCachePool.pop();void 0===R&&d.renderCache.length<50&&(R=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==R&&(d.proxyCachedFBO[A.key]={},d.proxyCachedFBO[A.key][I.start]=R,d.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(a,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,I=E.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=d.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(a,d){const _=this.painter,b=this.painter.context,E=b.gl;_._tileClippingMaskIDs={},b.setColorMode(u.ColorMode.disabled),b.setDepthMode(u.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const A of a){const R=_._tileClippingMaskIDs[A.key]=--d;I.draw(b,E.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:E.ALWAYS,mask:0},R,255,E.KEEP,E.KEEP,E.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,nl(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const d=this.painter.transform;if(a.x<0||a.x>d.width||a.y<0||a.y>d.height)return null;const _=[a.x,a.y,1,1];u.transformMat4$1(_,_,d.pixelMatrixInverse),u.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const b=d._camera.position,E=u.mercatorZfromAltitude(1,d.center.lat),I=[b[0],b[1],b[2]/E,0],A=u.subtract([],_.slice(0,3),I);u.normalize(A,A);const R=this.raycast(I,A,this._exaggeration);return null!==R&&R?(u.scaleAndAdd(I,I,A,R),I[3]=I[2],I[2]*=E,I):null}drawDepth(){const a=this.painter,d=a.context,_=this.proxySourceCache,b=Math.ceil(a.width),E=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=d.gl,A=d.createFramebuffer(b,E,!0);d.activeTexture.set(I.TEXTURE0);const R=new u.Texture(d,{width:b,height:E,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),A.colorAttachment.set(R.texture);const B=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,E);A.depthAttachment.set(B),this._depthFBO=A,this._depthTexture=R}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,E]),function(I,A,R,B){if("globe"===I.transform.projection.name)return;const z=I.context,H=z.gl;z.clear({depth:1});const K=I.useProgram("terrainDepth"),te=new u.DepthMode(H.LESS,u.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ie of B){const ne=R.getTile(ie),re=Ll(ie.projMatrix,0);A.setupElevationDraw(ne,K),K.draw(z,H.TRIANGLES,te,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,re,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,d,_){if(a.getSource()instanceof Gn)return this._setupProxiedCoordsForImageSource(a,d,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords;for(let A=0;A<E.length;A++){const R=E[A],B=this._findTileCoveringTileID(R,a);if(B){const z=this._createProxiedId(R,B,_[R.key]&&_[R.key][a.id]);b.push(z),this.proxyToSource[R.key][a.id]=[z]}}let I=!1;for(let A=0;A<d.length;A++){const R=a.getTile(d[A]);if(!R||!R.hasData())continue;const B=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[B.tileID.key][a.id],H=this._createProxiedId(B.tileID,R,_[B.tileID.key]&&_[B.tileID.key][a.id]);z?z.splice(z.length-1,0,H):this.proxyToSource[B.tileID.key][a.id]=[H],b.push(H),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,d,_){if(!a.getSource().loaded())return;const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords,I=a.getSource(),A=new u.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((z,H)=>(z.min.x=Math.min(z.min.x,H.x-A.x),z.min.y=Math.min(z.min.y,H.y-A.y),z.max.x=Math.max(z.max.x,H.x-A.x),z.max.y=Math.max(z.max.y,H.y-A.y),z),{min:new u.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(z,H)=>{const K=z.wrap+z.canonical.x/(1<<z.canonical.z),te=z.canonical.y/(1<<z.canonical.z),ie=u.EXTENT/(1<<z.canonical.z),ne=H.wrap+H.canonical.x/(1<<H.canonical.z),re=H.canonical.y/(1<<H.canonical.z);return K+ie<ne+R.min.x||K>ne+R.max.x||te+ie<re+R.min.y||te>re+R.max.y};for(let z=0;z<E.length;z++){const H=E[z];for(let K=0;K<d.length;K++){const te=a.getTile(d[K]);if(!te||!te.hasData()||B(H,te.tileID))continue;const ie=this._createProxiedId(H,te,_[H.key]&&_[H.key][a.id]),ne=this.proxyToSource[H.key][a.id];ne?ne.push(ie):this.proxyToSource[H.key][a.id]=[ie],b.push(ie)}}}_createProxiedId(a,d,_){let b=this.orthoMatrix;if(_){const E=_.find(I=>I.key===d.tileID.key);if(E)return E}if(d.tileID.key!==a.key){const E=a.canonical.z-d.tileID.canonical.z;let I,A,R;b=u.create();const B=d.tileID.wrap-a.wrap<<a.overscaledZ;E>0?(I=u.EXTENT>>E,A=I*((d.tileID.canonical.x<<E)-a.canonical.x+B),R=I*((d.tileID.canonical.y<<E)-a.canonical.y)):(I=u.EXTENT<<-E,A=u.EXTENT*(d.tileID.canonical.x-(a.canonical.x+B<<-E)),R=u.EXTENT*(d.tileID.canonical.y-(a.canonical.y<<-E))),u.ortho(b,0,I,0,I,0,1),u.translate(b,b,[A,R,0])}return new il(d.tileID,a.key,b)}_findTileCoveringTileID(a,d){let _=d.getTile(a);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[d.id],E=b[a.key];if(_=E?d.getTileByID(E):null,_&&_.hasData()||null===E)return _;let I=_?_.tileID:a,A=I.overscaledZ;const R=d.getSource().minzoom,B=[];if(!E){const H=d.getSource().maxzoom;if(a.canonical.z>=H){const K=a.canonical.z-H;d.getSource().reparseOverscaled?(A=Math.max(a.canonical.z+2,d.transform.tileZoom),I=new u.OverscaledTileID(A,a.wrap,H,a.canonical.x>>K,a.canonical.y>>K)):0!==K&&(A=H,I=new u.OverscaledTileID(A,a.wrap,H,a.canonical.x>>K,a.canonical.y>>K))}I.key!==a.key&&(B.push(I.key),_=d.getTile(I))}const z=H=>{B.forEach(K=>{b[K]=H}),B.length=0};for(A-=1;A>=R&&(!_||!_.hasData());A--){_&&z(_.tileID.key);const H=I.calculateScaledKey(A);if(_=d.getTileByID(H),_&&_.hasData())break;const K=b[H];if(null===K)break;void 0===K?B.push(H):_=d.getTileByID(K)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,d){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(d){let _=0;const b=new u.StructArrayLayout2ui4,E=131;for(let I=1;I<129;I++){for(let A=1;A<129;A++)_=I*E+A,b.emplaceBack(_,_+1),b.emplaceBack(_,_+E),b.emplaceBack(_+1,_+E),128===I&&b.emplaceBack(_+E,_+E+1);b.emplaceBack(_+1,_+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class si{static cacheKey(a,d,_,b){let E=`${d}${b?b.cacheKey:""}`;for(const I of _)a.usedDefines.includes(I)&&(E+=`/${I}`);return E}constructor(a,d,_,b,E,I){const A=a.gl;this.program=A.createProgram();const R=function(G){const ee=[];for(let le=0;le<G.length;le++){if(null===G[le])continue;const ce=G[le].split(" ");ee.push(ce.pop())}return ee}(_.staticAttributes),B=b?b.getBinderAttributes():[],z=R.concat(B);let H=b?b.defines():[];H=H.concat(I.map(G=>`#define ${G}`));const K=a.isWebGL2?"#version 300 es\n":"",te=K+H.concat(a.extStandardDerivatives&&0===K.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Aa):Aa,Aa,Wc,Lu.fragmentSource,Hs.fragmentSource,_.fragmentSource).join("\n"),ie=K+H.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Wc,Lu.vertexSource,Hs.vertexSource,Nr.vertexSource,_.vertexSource).join("\n"),ne=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ne,te),A.compileShader(ne),A.attachShader(this.program,ne);const re=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(re,ie),A.compileShader(re),A.attachShader(this.program,re),this.attributes={},this.numAttributes=z.length;for(let G=0;G<this.numAttributes;G++)z[G]&&(A.bindAttribLocation(this.program,G,z[G]),this.attributes[z[G]]=G);A.linkProgram(this.program),A.deleteShader(re),A.deleteShader(ne),this.fixedUniforms=E(a),this.binderUniforms=b?b.getUniforms(a):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(G=a),u_dem_prev:new u.Uniform1i(G),u_dem_unpack:new u.Uniform4f(G),u_dem_tl:new u.Uniform2f(G),u_dem_scale:new u.Uniform1f(G),u_dem_tl_prev:new u.Uniform2f(G),u_dem_scale_prev:new u.Uniform1f(G),u_dem_size:new u.Uniform1f(G),u_dem_lerp:new u.Uniform1f(G),u_exaggeration:new u.Uniform1f(G),u_depth:new u.Uniform1i(G),u_depth_size_inv:new u.Uniform2f(G),u_meter_to_dem:new u.Uniform1f(G),u_label_plane_matrix_inv:new u.UniformMatrix4f(G)}),I.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new u.Uniform3f(G),u_tile_tr_up:new u.Uniform3f(G),u_tile_br_up:new u.Uniform3f(G),u_tile_bl_up:new u.Uniform3f(G),u_tile_up_scale:new u.Uniform1f(G)}))(a)),I.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new u.UniformMatrix4f(G),u_fog_range:new u.Uniform2f(G),u_fog_color:new u.Uniform4f(G),u_fog_horizon_blend:new u.Uniform1f(G),u_fog_temporal_offset:new u.Uniform1f(G),u_frustum_tl:new u.Uniform3f(G),u_frustum_tr:new u.Uniform3f(G),u_frustum_br:new u.Uniform3f(G),u_frustum_bl:new u.Uniform3f(G),u_globe_pos:new u.Uniform3f(G),u_globe_radius:new u.Uniform1f(G),u_globe_transition:new u.Uniform1f(G),u_is_globe:new u.Uniform1i(G),u_viewport:new u.Uniform2f(G)}))(a))}var G}setTerrainUniformValues(a,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in d)_[b]&&_[b].set(this.program,b,d[b])}}setGlobeUniformValues(a,d){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in d)_[b]&&_[b].set(this.program,b,d[b])}}setFogUniformValues(a,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in d)_[b].set(this.program,b,d[b])}}draw(a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const re=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(b),a.setColorMode(E),a.setCullFace(I);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,A[ee]);ie&&ie.setUniforms(this.program,a,this.binderUniforms,K,{zoom:te});const G={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[d];for(const ee of H.get()){const le=ee.vaos||(ee.vaos={});(le[R]||(le[R]=new Lh)).bind(a,this,B,ie?ie.getPaintVertexBuffers():[],z,ee.vertexOffset,ne||[]),re.drawElements(d,ee.primitiveLength*G,re.UNSIGNED_SHORT,ee.primitiveOffset*G*2)}}}function fc(m,a){const d=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,m.transform.tileZoom)/d,b=_*(a.tileID.canonical.x+a.tileID.wrap*d),E=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/dn(a,1,m.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Ud=u.create(),qs=(m,a,d,_,b,E,I,A,R,B,z)=>{const H=a.style.light,K=H.properties.get("position"),te=[K.x,K.y,K.z],ie=u.create$1();"viewport"===H.properties.get("anchor")&&(u.fromRotation(ie,-a.transform.angle),u.transformMat3(te,te,ie));const ne=H.properties.get("color"),re=a.transform,G={u_matrix:m,u_lightpos:te,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ud,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return"globe"===re.projection.name&&(G.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=z,G.u_merc_center=B,G.u_up_dir=re.projection.upVector(new u.CanonicalTileID(0,0,0),B[0]*u.EXTENT,B[1]*u.EXTENT),G.u_height_lift=A),G},Nl=(m,a,d,_,b,E,I,A,R,B,z,H)=>{const K=qs(m,a,d,_,b,E,I,R,B,z,H),te={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return u.extend(K,fc(a,A),te)},_s=m=>({u_matrix:m}),ku=(m,a,d)=>u.extend(_s(m),fc(a,d)),kh=(m,a)=>({u_matrix:m,u_world:a}),jd=(m,a,d,_)=>u.extend(ku(m,a,d),{u_world:_}),Go=u.create(),ko=(m,a,d,_,b,E)=>{const I=m.transform,A="globe"===I.projection.name;let R;if("map"===E.paint.get("circle-pitch-alignment"))if(A){const z=u.globePixelsToTileUnits(I.zoom,a.canonical)*I._pixelsPerMercatorPixel;R=Float32Array.from([z,0,0,z])}else R=I.calculatePixelsToTileUnitsMatrix(d);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:m.translatePosMatrix(a.projMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Go,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){B.u_inv_rot_matrix=_,B.u_merc_center=b,B.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],B.u_zoom_transition=u.globeToMercatorTransition(I.zoom);const z=b[0]*u.EXTENT,H=b[1]*u.EXTENT;B.u_up_dir=I.projection.upVector(new u.CanonicalTileID(0,0,0),z,H)}return B},Ou=m=>{const a=[];return"map"===m.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},jr=(m,a,d,_)=>{const b=u.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/b,a.pixelsToGLUnits[1]/b]}},Yc=(m,a,d=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:d}),sn=u.create(),Nu=(m,a,d,_,b,E,I)=>{const A=m.transform,R="globe"===A.projection.name,B=R?u.globePixelsToTileUnits(A.zoom,a.canonical)*A._pixelsPerMercatorPixel:dn(d,1,E),z={u_matrix:a.projMatrix,u_extrude_scale:B,u_intensity:I,u_inv_rot_matrix:sn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){z.u_inv_rot_matrix=_,z.u_merc_center=b,z.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],z.u_zoom_transition=u.globeToMercatorTransition(A.zoom);const H=b[0]*u.EXTENT,K=b[1]*u.EXTENT;z.u_up_dir=A.projection.upVector(new u.CanonicalTileID(0,0,0),H,K)}return z},tn=(m,a,d,_,b,E,I)=>{const A=m.transform,R=A.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:rl(m,a,d,_),u_pixels_to_tile_units:R,u_device_pixel_ratio:E,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:qo(d)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:as(a,m.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Zs=(m,a,d,_,b)=>{const E=m.transform;return{u_matrix:rl(m,a,d,_),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:as(a,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function as(m,a){return 1/dn(m,1,a.tileZoom)}function rl(m,a,d,_){return m.translatePosMatrix(_||a.tileID.projMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function qo(m){const a=m.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const Fl=(m,a,d,_,b,E)=>{return{u_matrix:m,u_tl_parent:a,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(I=b.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:ys(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var I,A};function ys(m){m*=Math.PI/180;const a=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const Co=u.create(),zl=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne)=>{const re=b.transform,G={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:re.width/re.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+_,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Co,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Co,u_up_vector:[0,-1,0]};return"globe"===ne.name&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=H,G.u_inv_rot_matrix=te,G.u_merc_center=K,G.u_camera_forward=re._camera.forward(),G.u_ecef_origin=u.globeECEFOrigin(re.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(re.globeMatrix),G.u_up_vector=ie),G},xr=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re)=>u.extend(zl(m,a,d,_,b,E,I,A,R,B,H,K,te,ie,ne,re),{u_gamma_scale:_?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+z}),ls=(m,a,d,_,b,E,I,A,R,B,z,H,K,te,ie,ne)=>u.extend(xr(m,a,d,_,b,E,I,A,!0,R,!0,z,H,K,te,ie,ne),{u_texsize_icon:B,u_texture_icon:1}),ei=(m,a,d)=>({u_matrix:m,u_opacity:a,u_color:d}),Kc=(m,a,d,_,b)=>u.extend(function(E,I,A){const R=I.imageManager.getPattern(E.toString()),{width:B,height:z}=I.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),K=A.tileSize*Math.pow(2,I.transform.tileZoom)/H,te=K*(A.tileID.canonical.x+A.tileID.wrap*H),ie=K*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[B,z],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/dn(A,1,I.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}}(_,d,b),{u_matrix:m,u_opacity:a}),Oo={fillExtrusion:m=>({u_matrix:new u.UniformMatrix4f(m),u_lightpos:new u.Uniform3f(m),u_lightintensity:new u.Uniform1f(m),u_lightcolor:new u.Uniform3f(m),u_vertical_gradient:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_edge_radius:new u.Uniform1f(m),u_ao:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_up_dir:new u.Uniform3f(m),u_height_lift:new u.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_lightpos:new u.Uniform3f(m),u_lightintensity:new u.Uniform1f(m),u_lightcolor:new u.Uniform3f(m),u_vertical_gradient:new u.Uniform1f(m),u_height_factor:new u.Uniform1f(m),u_edge_radius:new u.Uniform1f(m),u_ao:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_up_dir:new u.Uniform3f(m),u_height_lift:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m)}),fill:m=>({u_matrix:new u.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),fillOutline:m=>({u_matrix:new u.UniformMatrix4f(m),u_world:new u.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_world:new u.Uniform2f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new u.Uniform1f(m),u_extrude_scale:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_up_dir:new u.Uniform3f(m)}),collisionBox:m=>({u_matrix:new u.UniformMatrix4f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_extrude_scale:new u.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new u.UniformMatrix4f(m),u_inv_matrix:new u.UniformMatrix4f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_viewport_size:new u.Uniform2f(m)}),debug:m=>({u_color:new u.UniformColor(m),u_matrix:new u.UniformMatrix4f(m),u_overlay:new u.Uniform1i(m),u_overlay_scale:new u.Uniform1f(m)}),clippingMask:m=>({u_matrix:new u.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new u.Uniform1f(m),u_intensity:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_up_dir:new u.Uniform3f(m)}),heatmapTexture:m=>({u_image:new u.Uniform1i(m),u_color_ramp:new u.Uniform1i(m),u_opacity:new u.Uniform1f(m)}),hillshade:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_latrange:new u.Uniform2f(m),u_light:new u.Uniform2f(m),u_shadow:new u.UniformColor(m),u_highlight:new u.UniformColor(m),u_accent:new u.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_dimension:new u.Uniform2f(m),u_zoom:new u.Uniform1f(m),u_unpack:new u.Uniform4f(m)}),line:m=>({u_matrix:new u.UniformMatrix4f(m),u_pixels_to_tile_units:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_units_to_pixels:new u.Uniform2f(m),u_dash_image:new u.Uniform1i(m),u_gradient_image:new u.Uniform1i(m),u_image_height:new u.Uniform1f(m),u_texsize:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_alpha_discard_threshold:new u.Uniform1f(m),u_trim_offset:new u.Uniform2f(m)}),linePattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_texsize:new u.Uniform2f(m),u_pixels_to_tile_units:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_units_to_pixels:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_alpha_discard_threshold:new u.Uniform1f(m)}),raster:m=>({u_matrix:new u.UniformMatrix4f(m),u_tl_parent:new u.Uniform2f(m),u_scale_parent:new u.Uniform1f(m),u_fade_t:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_image0:new u.Uniform1i(m),u_image1:new u.Uniform1i(m),u_brightness_low:new u.Uniform1f(m),u_brightness_high:new u.Uniform1f(m),u_saturation_factor:new u.Uniform1f(m),u_contrast_factor:new u.Uniform1f(m),u_spin_weights:new u.Uniform3f(m),u_perspective_transform:new u.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_camera_forward:new u.Uniform3f(m),u_tile_matrix:new u.UniformMatrix4f(m),u_up_vector:new u.Uniform3f(m),u_ecef_origin:new u.Uniform3f(m),u_texture:new u.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_texture:new u.Uniform1i(m),u_gamma_scale:new u.Uniform1f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_camera_forward:new u.Uniform3f(m),u_tile_matrix:new u.UniformMatrix4f(m),u_up_vector:new u.Uniform3f(m),u_ecef_origin:new u.Uniform3f(m),u_is_halo:new u.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_texsize_icon:new u.Uniform2f(m),u_texture:new u.Uniform1i(m),u_texture_icon:new u.Uniform1i(m),u_gamma_scale:new u.Uniform1f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_is_halo:new u.Uniform1i(m)}),background:m=>({u_matrix:new u.UniformMatrix4f(m),u_opacity:new u.Uniform1f(m),u_color:new u.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_opacity:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_pattern_tl:new u.Uniform2f(m),u_pattern_br:new u.Uniform2f(m),u_texsize:new u.Uniform2f(m),u_pattern_size:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),terrainRaster:Xc,terrainDepth:Xc,skybox:m=>({u_matrix:new u.UniformMatrix4f(m),u_sun_direction:new u.Uniform3f(m),u_cubemap:new u.Uniform1i(m),u_opacity:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new u.UniformMatrix4f(m),u_color_ramp:new u.Uniform1i(m),u_center_direction:new u.Uniform3f(m),u_radius:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new u.UniformMatrix3f(m),u_sun_direction:new u.Uniform3f(m),u_sun_intensity:new u.Uniform1f(m),u_color_tint_r:new u.Uniform4f(m),u_color_tint_m:new u.Uniform4f(m),u_luminance:new u.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new u.UniformMatrix4f(m),u_globe_matrix:new u.UniformMatrix4f(m),u_normalize_matrix:new u.UniformMatrix4f(m),u_merc_matrix:new u.UniformMatrix4f(m),u_zoom_transition:new u.Uniform1f(m),u_merc_center:new u.Uniform2f(m),u_image0:new u.Uniform1i(m),u_grid_matrix:new u.UniformMatrix3f(m),u_skirt_height:new u.Uniform1f(m),u_frustum_tl:new u.Uniform3f(m),u_frustum_tr:new u.Uniform3f(m),u_frustum_br:new u.Uniform3f(m),u_frustum_bl:new u.Uniform3f(m),u_globe_pos:new u.Uniform3f(m),u_globe_radius:new u.Uniform1f(m),u_viewport:new u.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new u.Uniform3f(m),u_frustum_tr:new u.Uniform3f(m),u_frustum_br:new u.Uniform3f(m),u_frustum_bl:new u.Uniform3f(m),u_horizon:new u.Uniform1f(m),u_transition:new u.Uniform1f(m),u_fadeout_range:new u.Uniform1f(m),u_color:new u.Uniform4f(m),u_high_color:new u.Uniform4f(m),u_space_color:new u.Uniform4f(m),u_star_intensity:new u.Uniform1f(m),u_star_density:new u.Uniform1f(m),u_star_size:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m),u_horizon_angle:new u.Uniform1f(m),u_rotation_matrix:new u.UniformMatrix4f(m)})};let Ws;function ol(m,a,d,_,b,E,I){const A=m.context,R=A.gl,B=m.transform,z=m.useProgram("collisionBox"),H=[];let K=0,te=0;for(let ce=0;ce<_.length;ce++){const be=_[ce],Ee=a.getTile(be),we=Ee.getBucket(d);if(!we)continue;const Ne=jn(be,we,B);let Pe=Ne;0===b[0]&&0===b[1]||(Pe=m.translatePosMatrix(Ne,Ee,b,E));const Ze=I?we.textCollisionBox:we.iconCollisionBox,Et=we.collisionCircleArray;if(Et.length>0){const Ue=u.create(),ut=Pe;u.mul(Ue,we.placementInvProjMatrix,B.glCoordMatrix),u.mul(Ue,Ue,we.placementViewportMatrix),H.push({circleArray:Et,circleOffset:te,transform:ut,invTransform:Ue,projection:we.getProjection()}),K+=Et.length/4,te=K}Ze&&(m.terrain&&m.terrain.setupElevationDraw(Ee,z),z.draw(A,R.LINES,u.DepthMode.disabled,u.StencilMode.disabled,m.colorModeForRenderPass(),u.CullFaceMode.disabled,jr(Pe,B,Ee,we.getProjection()),d.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,B.zoom,null,[Ze.collisionVertexBuffer,Ze.collisionVertexBufferExt]))}if(!I||!H.length)return;const ie=m.useProgram("collisionCircle"),ne=new u.StructArrayLayout2f1f2i16;ne.resize(4*K),ne._trim();let re=0;for(const ce of H)for(let be=0;be<ce.circleArray.length/4;be++){const Ee=4*be,we=ce.circleArray[Ee+0],Ne=ce.circleArray[Ee+1],Pe=ce.circleArray[Ee+2],Ze=ce.circleArray[Ee+3];ne.emplace(re++,we,Ne,Pe,Ze,0),ne.emplace(re++,we,Ne,Pe,Ze,1),ne.emplace(re++,we,Ne,Pe,Ze,2),ne.emplace(re++,we,Ne,Pe,Ze,3)}(!Ws||Ws.length<2*K)&&(Ws=function(ce){const be=2*ce,Ee=new u.StructArrayLayout3ui6;Ee.resize(be),Ee._trim();for(let we=0;we<be;we++){const Ne=6*we;Ee.uint16[Ne+0]=4*we+0,Ee.uint16[Ne+1]=4*we+1,Ee.uint16[Ne+2]=4*we+2,Ee.uint16[Ne+3]=4*we+2,Ee.uint16[Ne+4]=4*we+3,Ee.uint16[Ne+5]=4*we+0}return Ee}(K));const G=A.createIndexBuffer(Ws,!0),ee=A.createVertexBuffer(ne,u.collisionCircleLayout.members,!0);for(const ce of H){const be={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(le=B).getCameraToCenterDistance(ce.projection),u_viewport_size:[le.width,le.height]};ie.draw(A,R.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,m.colorModeForRenderPass(),u.CullFaceMode.disabled,be,d.id,ee,G,u.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,B.zoom)}var le;ee.destroy(),G.destroy()}const Zo=u.create();function vs({width:m,height:a,anchor:d,textOffset:_,textScale:b},E){const{horizontalAlign:I,verticalAlign:A}=u.getAnchorAlignment(d),R=-(I-.5)*m,B=-(A-.5)*a,z=u.evaluateVariableOffset(d,_);return new u.Point((R/b+z[0])*E,(B/b+z[1])*E)}function Jc(m,a,d,_,b,E,I,A,R,B,z){const H=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,te=m.icon.dynamicLayoutVertexArray,ie={},ne=m.getProjection(),re=fi(A,ne,E),G=E.elevation,ee=ne.upVectorScale(A.canonical,E.center.lat,E.worldSize).metersToTile;K.clear();for(let le=0;le<H.length;le++){const ce=H.get(le),{tileAnchorX:be,tileAnchorY:Ee,numGlyphs:we}=ce,Ne=ce.hidden||!ce.crossTileID||m.allowVerticalPlacement&&!ce.placedOrientation?null:_[ce.crossTileID];if(Ne){let Pe=0,Ze=0,Et=0;if(G){const It=G?G.getAtTileOffset(A,be,Ee):0,[un,Rn,en]=ne.upVector(A.canonical,be,Ee);Pe=It*un*ee,Ze=It*Rn*ee,Et=It*en*ee}let[Ue,ut,Ke,xt]=On(ce.projectedAnchorX+Pe,ce.projectedAnchorY+Ze,ce.projectedAnchorZ+Et,d?re:I);const qe=rr(E.getCameraToCenterDistance(ne),xt);let lt=b.evaluateSizeForFeature(m.textSizeData,B,ce)*qe/u.ONE_EM;d&&(lt*=m.tilePixelRatio/R);const Dt=vs(Ne,lt);d?(({x:Ue,y:ut,z:Ke}=ne.projectTilePoint(be+Dt.x,Ee+Dt.y,A.canonical)),[Ue,ut,Ke]=On(Ue+Pe,ut+Ze,Ke+Et,I)):(a&&Dt._rotate(-E.angle),Ue+=Dt.x,ut+=Dt.y,Ke=0);const pt=m.allowVerticalPlacement&&ce.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let It=0;It<we;It++)u.addDynamicAttributes(K,Ue,ut,Ke,pt);z&&ce.associatedIconIndex>=0&&(ie[ce.associatedIconIndex]={x:Ue,y:ut,z:Ke,angle:pt})}else or(we,K)}if(z){te.clear();const le=m.icon.placedSymbolArray;for(let ce=0;ce<le.length;ce++){const be=le.get(ce),{numGlyphs:Ee}=be,we=ie[ce];if(be.hidden||!we)or(Ee,te);else{const{x:Ne,y:Pe,z:Ze,angle:Et}=we;for(let Ue=0;Ue<Ee;Ue++)u.addDynamicAttributes(te,Ne,Pe,Ze,Et)}}m.icon.dynamicLayoutVertexBuffer.updateData(te)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function sl(m,a,d){return d.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Xs(m,a,d,_,b,E,I,A,R,B,z,H){const K=m.context,te=K.gl,ie=m.transform,ne="map"===A,re="map"===R,G=ne&&"point"!==d.layout.get("symbol-placement"),ee=ne&&!re&&!G,le=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let ce=!1;const be=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),Ee=[u.mercatorXfromLng(ie.center.lng),u.mercatorYfromLat(ie.center.lat)],we=d.layout.get("text-variable-anchor"),Ne="globe"===ie.projection.name,Pe=[],Ze=[0,-1,0];let Et=Ze;!Ne&&!ie.mercatorFromTransition||ne||(Et=function(Ue){const ut=Ue._camera.getWorldToCamera(Ue.worldSize,1),Ke=u.multiply([],ut,Ue.globeMatrix);u.invert(Ke,Ke);const xt=[0,0,0],qe=[0,1,0,0];return u.transformMat4$1(qe,qe,Ke),xt[0]=qe[0],xt[1]=qe[1],xt[2]=qe[2],u.normalize(xt,xt),xt}(ie));for(const Ue of _){const ut=a.getTile(Ue),Ke=ut.getBucket(d);if(!Ke||"mercator"===Ke.projection.name&&Ne)continue;const xt=b?Ke.text:Ke.icon;if(!xt||Ke.fullyClipped||!xt.segments.get().length)continue;const qe=xt.programConfigurations.get(d.id),lt=b||Ke.sdfIcons,Dt=b?Ke.textSizeData:Ke.iconSizeData,pt=re||0!==ie.pitch,It=u.evaluateSizeForZoom(Dt,ie.zoom);let un,Rn,en,bn,Jn=[0,0],Kn=null;if(b)Rn=ut.glyphAtlasTexture,en=te.LINEAR,un=ut.glyphAtlasTexture.size,Ke.iconsInText&&(Jn=ut.imageAtlasTexture.size,Kn=ut.imageAtlasTexture,bn=pt||m.options.rotating||m.options.zooming||"composite"===Dt.kind||"camera"===Dt.kind?te.LINEAR:te.NEAREST);else{const Br=1!==d.layout.get("icon-size").constantOr(0)||Ke.iconsNeedLinear;Rn=ut.imageAtlasTexture,en=lt||m.options.rotating||m.options.zooming||Br||pt?te.LINEAR:te.NEAREST,un=ut.imageAtlasTexture.size}const Kt="globe"===Ke.projection.name,bi=Kt?Et:Ze,Ri=Kt?u.globeToMercatorTransition(ie.zoom):0,Li=fi(Ue,Ke.getProjection(),ie),Ci=ie.calculatePixelsToTileUnitsMatrix(ut),yo=tt(Li,ut.tileID.canonical,re,ne,ie,Ke.getProjection(),Ci),co=m.terrain&&re&&G?u.invert(u.create(),yo):Zo,Yo=Ki(Li,ut.tileID.canonical,re,ne,ie,Ke.getProjection(),Ci),za=we&&Ke.hasTextData(),pi="none"!==d.layout.get("icon-text-fit")&&za&&Ke.hasIconData();if(G){const Br=ie.elevation,Hl=Br?Br.getAtTileOffsetFunc(Ue,ie.center.lat,ie.worldSize,Ke.getProjection()):null,bc=rs(Li,ut.tileID.canonical,re,ne,ie,Ke.getProjection(),Ci);Vs(Ke,Li,m,b,bc,Yo,re,B,Hl,Ue)}const Ti=G||b&&we||pi,di=m.translatePosMatrix(Li,ut,E,I),Xn=Ti?Zo:yo,vo=m.translatePosMatrix(Yo,ut,E,I,!0),ki=Ke.getProjection().createInversionMatrix(ie,Ue.canonical),Ji=[];m.terrainRenderModeElevated()&&re&&Ji.push("PITCH_WITH_MAP_TERRAIN"),Kt&&Ji.push("PROJECTION_GLOBE_VIEW"),Ti&&Ji.push("PROJECTED_POS_ON_VIEWPORT");const Bh=lt&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let $l;$l=lt?Ke.iconsInText?ls(Dt.kind,It,ee,re,m,di,Xn,vo,un,Jn,Ue,Ri,Ee,ki,bi,Ke.getProjection()):xr(Dt.kind,It,ee,re,m,di,Xn,vo,b,un,!0,Ue,Ri,Ee,ki,bi,Ke.getProjection()):zl(Dt.kind,It,ee,re,m,di,Xn,vo,b,un,Ue,Ri,Ee,ki,bi,Ke.getProjection());const Ba={program:m.useProgram(sl(lt,b,Ke),qe,Ji),buffers:xt,uniformValues:$l,atlasTexture:Rn,atlasTextureIcon:Kn,atlasInterpolation:en,atlasInterpolationIcon:bn,isSDF:lt,hasHalo:Bh,tile:ut,labelPlaneMatrixInv:co};if(le&&Ke.canOverlap){ce=!0;const Br=xt.segments.get();for(const Hl of Br)Pe.push({segments:new u.SegmentVector([Hl]),sortKey:Hl.sortKey,state:Ba})}else Pe.push({segments:xt.segments,sortKey:0,state:Ba})}ce&&Pe.sort((Ue,ut)=>Ue.sortKey-ut.sortKey);for(const Ue of Pe){const ut=Ue.state;if(m.terrain&&m.terrain.setupElevationDraw(ut.tile,ut.program,{useDepthForOcclusion:!Ne,labelPlaneMatrixInv:ut.labelPlaneMatrixInv}),K.activeTexture.set(te.TEXTURE0),ut.atlasTexture.bind(ut.atlasInterpolation,te.CLAMP_TO_EDGE),ut.atlasTextureIcon&&(K.activeTexture.set(te.TEXTURE1),ut.atlasTextureIcon&&ut.atlasTextureIcon.bind(ut.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),ut.isSDF){const Ke=ut.uniformValues;ut.hasHalo&&(Ke.u_is_halo=1,Ys(ut.buffers,Ue.segments,d,m,ut.program,be,z,H,Ke)),Ke.u_is_halo=0}Ys(ut.buffers,Ue.segments,d,m,ut.program,be,z,H,ut.uniformValues)}}function Ys(m,a,d,_,b,E,I,A,R){const B=_.context,z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];b.draw(B,B.gl.TRIANGLES,E,I,A,u.CullFaceMode.disabled,R,d.id,m.layoutVertexBuffer,m.indexBuffer,a,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),z)}function pc(m,a,d,_,b,E,I){const A=m.context.gl,R=d.paint.get("fill-pattern"),B=R&&R.constantOr(1);let z,H,K,te,ie;I?(H=B&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=A.LINES):(H=B?"fillPattern":"fill",z=A.TRIANGLES);for(const ne of _){const re=a.getTile(ne);if(B&&!re.patternsLoaded())continue;const G=re.getBucket(d);if(!G)continue;m.prepareDrawTile();const ee=G.programConfigurations.get(d.id),le=m.useProgram(H,ee);B&&(m.context.activeTexture.set(A.TEXTURE0),re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ee.updatePaintBuffers());const ce=R.constantOr(null);if(ce&&re.imageAtlas){const Ee=re.imageAtlas.patternPositions[ce.toString()];Ee&&ee.setConstantPatternPositions(Ee)}const be=m.translatePosMatrix(ne.projMatrix,re,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(I){te=G.indexBuffer2,ie=G.segments2;const Ee=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];K="fillOutlinePattern"===H&&B?jd(be,m,re,Ee):kh(be,Ee)}else te=G.indexBuffer,ie=G.segments,K=B?ku(be,m,re):_s(be);m.prepareDrawProgram(m.context,le,ne.toUnwrapped()),le.draw(m.context,z,b,m.stencilModeForClipping(ne),E,u.CullFaceMode.disabled,K,d.id,G.layoutVertexBuffer,te,ie,d.paint,m.transform.zoom,ee)}}function Ks(m,a,d,_,b,E,I){const A=m.context,R=A.gl,B=m.transform,z=d.paint.get("fill-extrusion-pattern"),H=z.constantOr(1),K=d.paint.get("fill-extrusion-opacity"),te=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],ie=d.layout.get("fill-extrusion-edge-radius"),ne=ie>0&&!d.paint.get("fill-extrusion-rounded-roof"),re=ne?0:ie,G="globe"===B.projection.name?u.fillExtrusionHeightLift():0,ee="globe"===B.projection.name,le=ee?u.globeToMercatorTransition(B.zoom):0,ce=[u.mercatorXfromLng(B.center.lng),u.mercatorYfromLat(B.center.lat)],be=[];ee&&be.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&be.push("FAUX_AO"),ne&&be.push("ZERO_ROOF_RADIUS");for(const Ee of _){const we=a.getTile(Ee),Ne=we.getBucket(d);if(!Ne||Ne.projection.name!==B.projection.name)continue;const Pe=Ne.programConfigurations.get(d.id),Ze=m.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Pe,be);if(m.terrain){const lt=m.terrain;if(m.style.terrainSetForDrapingOnly())lt.setupElevationDraw(we,Ze,{useMeterToDem:!0});else{if(!Ne.enableTerrain)continue;if(lt.setupElevationDraw(we,Ze,{useMeterToDem:!0}),Fu(A,a,Ee,Ne,d,lt),!Ne.centroidVertexBuffer){const Dt=Ze.attributes.a_centroid_pos;void 0!==Dt&&R.vertexAttrib2f(Dt,0,0)}}}H&&(m.context.activeTexture.set(R.TEXTURE0),we.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const Et=z.constantOr(null);if(Et&&we.imageAtlas){const lt=we.imageAtlas.patternPositions[Et.toString()];lt&&Pe.setConstantPatternPositions(lt)}const Ue=m.translatePosMatrix(Ee.projMatrix,we,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ut=B.projection.createInversionMatrix(B,Ee.canonical),Ke=d.paint.get("fill-extrusion-vertical-gradient"),xt=H?Nl(Ue,m,Ke,K,te,re,Ee,we,G,le,ce,ut):qs(Ue,m,Ke,K,te,re,Ee,G,le,ce,ut);m.prepareDrawProgram(A,Ze,Ee.toUnwrapped());const qe=[];m.terrain&&qe.push(Ne.centroidVertexBuffer),ee&&qe.push(Ne.layoutVertexExtBuffer),Ze.draw(A,A.gl.TRIANGLES,b,E,I,u.CullFaceMode.backCCW,xt,d.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,d.paint,m.transform.zoom,Pe,qe)}}function Fu(m,a,d,_,b,E){const I=[G=>{let ee=G.canonical.x-1,le=G.wrap;return ee<0&&(ee=(1<<G.canonical.z)-1,le--),new u.OverscaledTileID(G.overscaledZ,le,G.canonical.z,ee,G.canonical.y)},G=>{let ee=G.canonical.x+1,le=G.wrap;return ee===1<<G.canonical.z&&(ee=0,le++),new u.OverscaledTileID(G.overscaledZ,le,G.canonical.z,ee,G.canonical.y)},G=>new u.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new u.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],A=G=>{const ee=a.getSource().minzoom,le=be=>{const Ee=a.getTileByID(be);if(Ee&&Ee.hasData())return Ee.getBucket(b)},ce=[0,-1,1];for(const be of ce){if(G.overscaledZ+be<ee)continue;const Ee=le(G.calculateScaledKey(G.overscaledZ+be));if(Ee)return Ee}},R=[0,0,0],B=(G,ee)=>(R[0]=Math.min(G.min.y,ee.min.y),R[1]=Math.max(G.max.y,ee.max.y),R[2]=u.EXTENT-ee.min.x>G.max.x?ee.min.x-u.EXTENT:G.max.x,R),z=(G,ee)=>(R[0]=Math.min(G.min.x,ee.min.x),R[1]=Math.max(G.max.x,ee.max.x),R[2]=u.EXTENT-ee.min.y>G.max.y?ee.min.y-u.EXTENT:G.max.y,R),H=[(G,ee)=>B(G,ee),(G,ee)=>B(ee,G),(G,ee)=>z(G,ee),(G,ee)=>z(ee,G)],K=new u.Point(0,0);let te,ie,ne;const re=(G,ee,le,ce,be)=>{const Ee=[[ce?le:G,ce?G:le,0],[ce?le:ee,ce?ee:le,0]],we=be<0?u.EXTENT+be:be,Ne=[ce?we:(G+ee)/2,ce?(G+ee)/2:we,0];return 0===le&&be<0||0!==le&&be>0?E.getForTilePoints(ne,[Ne],!0,ie):Ee.push(Ne),E.getForTilePoints(d,Ee,!0,te),Math.max(Ee[0][2],Ee[1][2],Ne[2])/E.exaggeration()};for(let G=0;G<4;G++){const ee=(G<2?1:5)-G,le=_.borders[G];if(0===le.length)continue;const ce=ne=I[G](d),be=A(ce);if(!(be&&be instanceof u.FillExtrusionBucket&&be.enableTerrain)||_.borderDoneWithNeighborZ[G]===be.canonical.z&&be.borderDoneWithNeighborZ[ee]===_.canonical.z||(ie=E.findDEMTileFor(ce),!ie||!ie.dem))continue;if(!te){const Pe=E.findDEMTileFor(d);if(!Pe||!Pe.dem)return;te=Pe}const Ee=be.borders[ee];let we=0;const Ne=be.borderDoneWithNeighborZ[ee]!==_.canonical.z;if(_.canonical.z===be.canonical.z){for(let Pe=0;Pe<le.length;Pe++){const Ze=_.featuresOnBorder[le[Pe]],Et=Ze.borders[G];let Ue;for(;we<Ee.length&&(Ue=be.featuresOnBorder[Ee[we]],!(Ue.borders[ee][1]>Et[0]+3));)Ne&&be.encodeCentroid(void 0,Ue,!1),we++;if(Ue&&we<Ee.length){const ut=we;let Ke=0;for(;!(Ue.borders[ee][0]>Et[1]-3)&&(Ke++,++we!==Ee.length);)Ue=be.featuresOnBorder[Ee[we]];if(Ue=be.featuresOnBorder[Ee[ut]],Ze.intersectsCount()>1||Ue.intersectsCount()>1||1!==Ke){1!==Ke&&(we=ut),_.encodeCentroid(void 0,Ze,!1),Ne&&be.encodeCentroid(void 0,Ue,!1);continue}const xt=H[G](Ze,Ue),qe=G%2?u.EXTENT-1:0;K.x=re(xt[0],Math.min(u.EXTENT-1,xt[1]),qe,G<2,xt[2]),K.y=0,_.encodeCentroid(K,Ze,!1),Ne&&be.encodeCentroid(K,Ue,!1)}else _.encodeCentroid(void 0,Ze,!1)}_.borderDoneWithNeighborZ[G]=be.canonical.z,_.needsCentroidUpdate=!0,Ne&&(be.borderDoneWithNeighborZ[ee]=_.canonical.z,be.needsCentroidUpdate=!0)}else{for(const Pe of le)_.encodeCentroid(void 0,_.featuresOnBorder[Pe],!1);if(Ne){for(const Pe of Ee)be.encodeCentroid(void 0,be.featuresOnBorder[Pe],!1);be.borderDoneWithNeighborZ[ee]=_.canonical.z,be.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[G]=be.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const xs=new u.Color(1,0,0,1),$d=new u.Color(0,1,0,1),zu=new u.Color(0,0,1,1),Hd=new u.Color(1,0,1,1),Oh=new u.Color(0,1,1,1);function cs(m,a,d){const _=m.context,b=m.transform,E=_.gl,I="globe"===b.projection.name,A=I?["PROJECTION_GLOBE_VIEW"]:null;let R=d.projMatrix;if(I&&u.globeToMercatorTransition(b.zoom)>0){const Ze=u.transitionTileAABBinECEF(d.canonical,b),Et=u.globeDenormalizeECEF(Ze);R=u.multiply(new Float32Array(16),b.globeMatrix,Et),u.multiply(R,b.projMatrix,R)}const B=m.useProgram("debug",null,A),z=a.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(z,B);const H=u.DepthMode.disabled,K=u.StencilMode.disabled,te=m.colorModeForRenderPass();_.activeTexture.set(E.TEXTURE0),m.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),I?z._makeGlobeTileDebugBuffers(m.context,b):z._makeDebugTileBoundsBuffers(m.context,b.projection);const ne=z._tileDebugBuffer||m.debugBuffer,re=z._tileDebugIndexBuffer||m.debugIndexBuffer,G=z._tileDebugSegments||m.debugSegments;B.draw(_,E.LINE_STRIP,H,K,te,u.CullFaceMode.disabled,Yc(R,u.Color.red),"$debug",ne,re,G,null,null,null,[z._globeTileDebugBorderBuffer]);const ee=z.latestRawTileData,le=Math.floor((ee&&ee.byteLength||0)/1024),ce=a.getTile(d).tileSize,be=512/Math.min(ce,512)*(d.overscaledZ/b.zoom)*.5;let Ee=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ee+=` => ${d.overscaledZ}`),Ee+=` ${le}kb`,function(Ze,Et){Ze.initDebugOverlayCanvas();const Ue=Ze.debugOverlayCanvas,ut=Ze.context.gl,Ke=Ze.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Ue.width,Ue.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(Et,5,5),Ke.strokeText(Et,5,5),Ze.debugOverlayTexture.update(Ue),Ze.debugOverlayTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}(m,Ee);const we=z._tileDebugTextBuffer||m.debugBuffer,Ne=z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Pe=z._tileDebugTextSegments||m.debugSegments;B.draw(_,E.TRIANGLES,H,K,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,Yc(R,u.Color.transparent,be),"$debug",we,Ne,Pe,null,null,null,[z._globeTileDebugTextBuffer])}function us(m,a,d,_){Bl(m,0,a+d/2,m.transform.width,d,_)}function La(m,a,d,_){Bl(m,a-d/2,0,d,m.transform.height,_)}function Bl(m,a,d,_,b,E){const I=m.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(a*u.exported.devicePixelRatio,d*u.exported.devicePixelRatio,_*u.exported.devicePixelRatio,b*u.exported.devicePixelRatio),I.clear({color:E}),A.disable(A.SCISSOR_TEST)}const mc=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Nh}=mc;function bs(m,a,d,_){m.emplaceBack(a,d,_)}class gc{constructor(a){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,bs(this.vertexArray,-1,-1,1),bs(this.vertexArray,1,-1,1),bs(this.vertexArray,-1,1,1),bs(this.vertexArray,1,1,1),bs(this.vertexArray,-1,-1,-1),bs(this.vertexArray,1,-1,-1),bs(this.vertexArray,-1,1,-1),bs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Nh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function ao(m,a,d,_,b,E){const I=m.gl,A=a.paint.get("sky-atmosphere-color"),R=a.paint.get("sky-atmosphere-halo-color"),B=a.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:u.fromMat4(u.create$1(),_),u_sun_direction:b,u_sun_intensity:B,u_color_tint_r:[(ie=A).r,ie.g,ie.b,ie.a],u_color_tint_m:[(ne=R).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var ie,ne;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+E,a.skyboxTexture,0),d.draw(m,I.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,z,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const _c=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class al{constructor(a){const d=new u.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const _=new u.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(d,_c.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pr={symbol:function(m,a,d,_,b){if("translucent"!==m.renderPass)return;const E=u.StencilMode.disabled,I=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(A,R,B,z,H,K,te){const ie=R.transform,ne="map"===H,re="map"===K;for(const G of A){const ee=z.getTile(G),le=ee.getBucket(B);if(!le||!le.text||!le.text.segments.get().length)continue;const ce=u.evaluateSizeForZoom(le.textSizeData,ie.zoom),be=fi(G,le.getProjection(),ie),Ee=ie.calculatePixelsToTileUnitsMatrix(ee),we=tt(be,ee.tileID.canonical,re,ne,ie,le.getProjection(),Ee),Ne="none"!==B.layout.get("icon-text-fit")&&le.hasIconData();if(ce){const Pe=Math.pow(2,ie.zoom-ee.tileID.overscaledZ);Jc(le,ne,re,te,u.symbolSize,ie,we,G,Pe,ce,Ne)}}}(_,m,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&Xs(m,a,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),E,I),0!==d.paint.get("text-opacity").constantOr(1)&&Xs(m,a,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),E,I),a.map.showCollisionBoxes&&(ol(m,a,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),ol(m,a,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("circle-opacity"),E=d.paint.get("circle-stroke-width"),I=d.paint.get("circle-stroke-opacity"),A=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===E.constantOr(1)||0===I.constantOr(1)))return;const R=m.context,B=R.gl,z=m.transform,H=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),K=u.StencilMode.disabled,te=m.colorModeForRenderPass(),ie="globe"===z.projection.name,ne=[u.mercatorXfromLng(z.center.lng),u.mercatorYfromLat(z.center.lat)],re=[];for(let ee=0;ee<_.length;ee++){const le=_[ee],ce=a.getTile(le),be=ce.getBucket(d);if(!be||be.projection.name!==z.projection.name)continue;const Ee=be.programConfigurations.get(d.id),we=Ou(d);ie&&we.push("PROJECTION_GLOBE_VIEW");const Ne=m.useProgram("circle",Ee,we),Pe=be.layoutVertexBuffer,Ze=be.globeExtVertexBuffer,Et=be.indexBuffer,Ue=z.projection.createInversionMatrix(z,le.canonical),ut={programConfiguration:Ee,program:Ne,layoutVertexBuffer:Pe,globeExtVertexBuffer:Ze,indexBuffer:Et,uniformValues:ko(m,le,ce,Ue,ne,d),tile:ce};if(A){const Ke=be.segments.get();for(const xt of Ke)re.push({segments:new u.SegmentVector([xt]),sortKey:xt.sortKey,state:ut})}else re.push({segments:be.segments,sortKey:0,state:ut})}A&&re.sort((ee,le)=>ee.sortKey-le.sortKey);const G={useDepthForOcclusion:!ie};for(const ee of re){const{programConfiguration:le,program:ce,layoutVertexBuffer:be,globeExtVertexBuffer:Ee,indexBuffer:we,uniformValues:Ne,tile:Pe}=ee.state,Ze=ee.segments;m.terrain&&m.terrain.setupElevationDraw(Pe,ce,G),m.prepareDrawProgram(R,ce,Pe.tileID.toUnwrapped()),ce.draw(R,B.TRIANGLES,H,K,te,u.CullFaceMode.disabled,Ne,d.id,be,we,Ze,d.paint,z.zoom,le,[Ee])}},heatmap:function(m,a,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const b=m.context,E=b.gl,I=u.StencilMode.disabled,A=new u.ColorMode([E.ONE,E.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(te,ie,ne,re){const G=te.gl,ee=ie.width*re,le=ie.height*re;te.activeTexture.set(G.TEXTURE1),te.viewport.set([0,0,ee,le]);let ce=ne.heatmapFbo;if(!ce||ce&&(ce.width!==ee||ce.height!==le)){ce&&ce.destroy();const be=G.createTexture();G.bindTexture(G.TEXTURE_2D,be),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ce=ne.heatmapFbo=te.createFramebuffer(ee,le,!1),function(Ee,we,Ne,Pe,Ze,Et){const Ue=Ee.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,Ee.isWebGL2&&Ee.extRenderToTextureHalfFloat?Ue.RGBA16F:Ue.RGBA,Ze,Et,0,Ue.RGBA,Ee.extRenderToTextureHalfFloat?Ee.isWebGL2?Ue.HALF_FLOAT:Ee.extTextureHalfFloat.HALF_FLOAT_OES:Ue.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Ne)}(te,0,be,ce,ee,le)}else G.bindTexture(G.TEXTURE_2D,ce.colorAttachment.get()),te.bindFramebuffer.set(ce.framebuffer)})(b,m,d,"globe"===m.transform.projection.name?.5:.25),b.clear({color:u.Color.transparent});const R=m.transform,B="globe"===R.projection.name,z=B?["PROJECTION_GLOBE_VIEW"]:null,H=B?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,K=[u.mercatorXfromLng(R.center.lng),u.mercatorYfromLat(R.center.lat)];for(let te=0;te<_.length;te++){const ie=_[te];if(a.hasRenderableParent(ie))continue;const ne=a.getTile(ie),re=ne.getBucket(d);if(!re||re.projection.name!==R.projection.name)continue;const G=re.programConfigurations.get(d.id),ee=m.useProgram("heatmap",G,z),{zoom:le}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ne,ee),m.prepareDrawProgram(b,ee,ie.toUnwrapped());const ce=R.projection.createInversionMatrix(R,ie.canonical);ee.draw(b,E.TRIANGLES,u.DepthMode.disabled,I,A,H,Nu(m,ie,ne,ce,K,le,d.paint.get("heatmap-intensity")),d.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,d.paint,m.transform.zoom,G,B?[re.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,E){const I=b.context,A=I.gl,R=E.heatmapFbo;if(!R)return;I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(A.TEXTURE1);let B=E.colorRampTexture;B||(B=E.colorRampTexture=new u.Texture(I,E.colorRamp,A.RGBA)),B.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(I,A.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,b.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(m,d))},line:function(m,a,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("line-opacity"),E=d.paint.get("line-width");if(0===b.constantOr(1)||0===E.constantOr(1))return;const I=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),A=m.colorModeForRenderPass(),R=m.terrain&&m.terrain.renderingToTexture?1:u.exported.devicePixelRatio,B=d.paint.get("line-dasharray"),z=B.constantOr(1),H=d.layout.get("line-cap"),K=d.paint.get("line-pattern"),te=K.constantOr(1),ie=d.paint.get("line-gradient"),ne=te?"linePattern":"line",re=m.context,G=re.gl,ee=(ce=>{const be=[];qo(ce)&&be.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&be.push("RENDER_LINE_GRADIENT");const Ee=ce.paint.get("line-trim-offset");0===Ee[0]&&0===Ee[1]||be.push("RENDER_LINE_TRIM_OFFSET");const we=ce.paint.get("line-pattern").constantOr(1),Ne=1!==ce.paint.get("line-opacity").constantOr(1);return!we&&Ne&&be.push("RENDER_LINE_ALPHA_DISCARD"),be})(d);let le=ee.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ce of _){const be=a.getTile(ce);if(te&&!be.patternsLoaded())continue;const Ee=be.getBucket(d);if(!Ee)continue;m.prepareDrawTile();const we=Ee.programConfigurations.get(d.id),Ne=m.useProgram(ne,we,ee),Pe=K.constantOr(null);if(Pe&&be.imageAtlas){const lt=be.imageAtlas.patternPositions[Pe.toString()];lt&&we.setConstantPatternPositions(lt)}const Ze=B.constantOr(null),Et=H.constantOr(null);if(!te&&Ze&&Et&&be.lineAtlas){const lt=be.lineAtlas.getDash(Ze,Et);lt&&we.setConstantPatternPositions(lt)}let[Ue,ut]=d.paint.get("line-trim-offset");("round"===Et||"square"===Et)&&Ue!==ut&&(0===Ue&&(Ue-=1),1===ut&&(ut+=1));const Ke=m.terrain?ce.projMatrix:null,xt=te?Zs(m,be,d,Ke,R):tn(m,be,d,Ke,Ee.lineClipsArray.length,R,[Ue,ut]);if(ie){const lt=Ee.gradients[d.id];let Dt=lt.texture;if(d.gradientVersion!==lt.version){let pt=256;if(d.stepInterpolant){const It=a.getSource().maxzoom,un=ce.canonical.z===It?Math.ceil(1<<m.transform.maxZoom-ce.canonical.z):1;pt=u.clamp(u.nextPowerOfTwo(Ee.maxLineLength/u.EXTENT*1024*un),256,re.maxTextureSize)}lt.gradient=u.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:lt.gradient||void 0,clips:Ee.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new u.Texture(re,lt.gradient,G.RGBA),lt.version=d.gradientVersion,Dt=lt.texture}re.activeTexture.set(G.TEXTURE1),Dt.bind(d.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}z&&(re.activeTexture.set(G.TEXTURE0),be.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),we.updatePaintBuffers()),te&&(re.activeTexture.set(G.TEXTURE0),be.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),we.updatePaintBuffers()),m.prepareDrawProgram(re,Ne,ce.toUnwrapped());const qe=lt=>{Ne.draw(re,G.TRIANGLES,I,lt,A,u.CullFaceMode.disabled,xt,d.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,d.paint,m.transform.zoom,we,[Ee.layoutVertexBuffer2])};if(le){const lt=m.stencilModeForClipping(ce).ref;0===lt&&m.terrain&&re.clear({stencil:0});const Dt={func:G.EQUAL,mask:255};xt.u_alpha_discard_threshold=.8,qe(new u.StencilMode(Dt,lt,255,G.KEEP,G.KEEP,G.INVERT)),xt.u_alpha_discard_threshold=0,qe(new u.StencilMode(Dt,lt,255,G.KEEP,G.KEEP,G.KEEP))}else qe(m.stencilModeForClipping(ce))}le&&(m.resetStencilClippingMasks(),m.terrain&&re.clear({stencil:0}))},fill:function(m,a,d,_){const b=d.paint.get("fill-color"),E=d.paint.get("fill-opacity");if(0===E.constantOr(1))return;const I=m.colorModeForRenderPass(),A=d.paint.get("fill-pattern"),R=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===b.constantOr(u.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(m.renderPass===R){const B=m.depthModeForSublayer(1,"opaque"===m.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);pc(m,a,d,_,B,I,!1)}if("translucent"===m.renderPass&&d.paint.get("fill-antialias")){const B=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);pc(m,a,d,_,B,I,!0)}},"fill-extrusion":function(m,a,d,_){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===m.renderPass){const E=new u.DepthMode(m.context.gl.LEQUAL,u.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Ks(m,a,d,_,E,u.StencilMode.disabled,u.ColorMode.disabled),Ks(m,a,d,_,E,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const I=m.colorModeForRenderPass();Ks(m,a,d,_,E,u.StencilMode.disabled,I)}}},hillshade:function(m,a,d,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const b=m.context,E=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),A=m.terrain&&m.terrain.renderingToTexture,[R,B]="translucent"!==m.renderPass||A?[{},_]:m.stencilConfigForOverlap(_);for(const z of B){const H=a.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===m.renderPass)Yr(m,H,d,E,u.StencilMode.disabled,I);else if("translucent"===m.renderPass){const K=A&&m.terrain?m.terrain.stencilModeForRTTOverlap(z):R[z.overscaledZ];cc(m,z,H,d,E,K,I)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,d,_,b,E){if("translucent"!==m.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const I=m.context,A=I.gl,R=a.getSource(),B=m.useProgram("raster"),z=m.colorModeForRenderPass(),H=m.terrain&&m.terrain.renderingToTexture,[K,te]=R instanceof Gn||H?[{},_]:m.stencilConfigForOverlap(_),ie=te[te.length-1].overscaledZ,ne=!m.options.moving;for(const re of te){const G=H?u.DepthMode.disabled:m.depthModeForSublayer(re.overscaledZ-ie,1===d.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,A.LESS),ee=re.toUnwrapped(),le=a.getTile(re);if(H&&(!le||!le.hasData()))continue;const ce=H?re.projMatrix:m.transform.calculateProjMatrix(ee,ne),be=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(re):K[re.overscaledZ],Ee=E?0:d.paint.get("raster-fade-duration");le.registerFadeDuration(Ee);const we=a.findLoadedParent(re,0),Ne=Ra(le,we,a,m.transform,Ee);let Pe,Ze;m.terrain&&m.terrain.prepareDrawTile();const Et="nearest"===d.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),le.texture.bind(Et,A.CLAMP_TO_EDGE),I.activeTexture.set(A.TEXTURE1),we?(we.texture.bind(Et,A.CLAMP_TO_EDGE),Pe=Math.pow(2,we.tileID.overscaledZ-le.tileID.overscaledZ),Ze=[le.tileID.canonical.x*Pe%1,le.tileID.canonical.y*Pe%1]):le.texture.bind(Et,A.CLAMP_TO_EDGE),le.texture.useMipmap&&I.extTextureFilterAnisotropic&&m.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Ue=Fl(ce,Ze||[0,0],Pe||1,Ne,d,R instanceof Gn?R.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(I,B,ee),R instanceof Gn)R.boundsBuffer&&R.boundsSegments&&B.draw(I,A.TRIANGLES,G,u.StencilMode.disabled,z,u.CullFaceMode.disabled,Ue,d.id,R.boundsBuffer,m.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:ut,tileBoundsIndexBuffer:Ke,tileBoundsSegments:xt}=m.getTileBoundsBuffers(le);B.draw(I,A.TRIANGLES,G,be,z,u.CullFaceMode.disabled,Ue,d.id,ut,Ke,xt)}}m.resetStencilClippingMasks()},background:function(m,a,d,_){const b=d.paint.get("background-color"),E=d.paint.get("background-opacity");if(0===E)return;const I=m.context,A=I.gl,R=m.transform,B=R.tileSize,z=d.paint.get("background-pattern");if(m.isPatternMissing(z))return;const H=!z&&1===b.a&&1===E&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const K=u.StencilMode.disabled,te=m.depthModeForSublayer(0,"opaque"===H?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),ie=m.colorModeForRenderPass(),ne=m.useProgram(z?"backgroundPattern":"background");let re,G=_;G||(re=m.getBackgroundTiles(),G=Object.values(re).map(ee=>ee.tileID)),z&&(I.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));for(const ee of G){const le=ee.toUnwrapped(),ce=_?ee.projMatrix:m.transform.calculateProjMatrix(le);m.prepareDrawTile();const be=a?a.getTile(ee):re?re[ee.key]:new u.Tile(ee,B,R.zoom,m),Ee=z?Kc(ce,E,m,z,{tileID:ee,tileSize:B}):ei(ce,E,b);m.prepareDrawProgram(I,ne,le);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:Ne,tileBoundsSegments:Pe}=m.getTileBoundsBuffers(be);ne.draw(I,A.TRIANGLES,te,K,ie,u.CullFaceMode.disabled,Ee,d.id,we,Ne,Pe)}},sky:function(m,a,d){const _=m.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:u.smoothstep(7,8,_.zoom),E=d.paint.get("sky-opacity")*b;if(0===E)return;const I=m.context,A=d.paint.get("sky-type"),R=new u.DepthMode(I.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),B=m.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===m.renderPass?d.needsSkyboxCapture(m)&&(function(z,H,K,te){const ie=z.context,ne=ie.gl;let re=H.skyboxFbo;if(!re){re=H.skyboxFbo=ie.createFramebuffer(32,32,!1),H.skyboxGeometry=new gc(ie),H.skyboxTexture=ie.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,H.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ce=0;ce<6;++ce)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(re.framebuffer),ie.viewport.set([0,0,32,32]);const G=H.getCenter(z,!0),ee=z.useProgram("skyboxCapture"),le=new Float64Array(16);u.identity(le),u.rotateY(le,le,.5*-Math.PI),ao(ie,H,ee,le,G,0),u.identity(le),u.rotateY(le,le,.5*Math.PI),ao(ie,H,ee,le,G,1),u.identity(le),u.rotateX(le,le,.5*-Math.PI),ao(ie,H,ee,le,G,2),u.identity(le),u.rotateX(le,le,.5*Math.PI),ao(ie,H,ee,le,G,3),u.identity(le),ao(ie,H,ee,le,G,4),u.identity(le),u.rotateY(le,le,Math.PI),ao(ie,H,ee,le,G,5),ie.viewport.set([0,0,z.width,z.height])}(m,d),d.markSkyboxValid(m)):"sky"===m.renderPass&&function(z,H,K,te,ie){const ne=z.context,re=ne.gl,G=z.transform,ee=z.useProgram("skybox");ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,H.skyboxTexture);const le={u_matrix:G.skyboxMatrix,u_sun_direction:H.getCenter(z,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:ie};z.prepareDrawProgram(ne,ee),ee.draw(ne,re.TRIANGLES,K,u.StencilMode.disabled,z.colorModeForRenderPass(),u.CullFaceMode.backCW,le,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,d,R,E,B):"gradient"===A&&"sky"===m.renderPass&&function(z,H,K,te,ie){const ne=z.context,re=ne.gl,G=z.transform,ee=z.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new gc(ne)),ne.activeTexture.set(re.TEXTURE0);let le=H.colorRampTexture;le||(le=H.colorRampTexture=new u.Texture(ne,H.colorRamp,re.RGBA)),le.bind(re.LINEAR,re.CLAMP_TO_EDGE);const ce=(be=G.skyboxMatrix,Ee=H.getCenter(z,!1),we=H.paint.get("sky-gradient-radius"),Ne=te,Pe=ie,{u_matrix:be,u_color_ramp:0,u_center_direction:Ee,u_radius:u.degToRad(we),u_opacity:Ne,u_temporal_offset:Pe});var be,Ee,we,Ne,Pe;z.prepareDrawProgram(ne,ee),ee.draw(ne,re.TRIANGLES,K,u.StencilMode.disabled,z.colorModeForRenderPass(),u.CullFaceMode.backCW,ce,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,d,R,E,B)},debug:function(m,a,d){for(let _=0;_<d.length;_++)cs(m,a,d[_])},custom:function(m,a,d,_){const b=m.context,E=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&d.isLayerDraped()){if("offscreen"===m.renderPass){const I=E.prerender;if(I){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const A=m.transform.pointMerc;I.call(E,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(m.transform.zoom),[A.x,A.y],m.transform.pixelsPerMeterRatio)}else I.call(E,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const A=E.renderToTile;if(A){const R=_[0].canonical,B=new u.MercatorCoordinate(R.x+_[0].wrap*(1<<R.z),R.y,R.z);b.setDepthMode(u.DepthMode.disabled),b.setStencilMode(u.StencilMode.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),A.call(E,b.gl,B),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(u.StencilMode.disabled);const I="3d"===E.renderingMode?new u.DepthMode(m.context.gl.LEQUAL,u.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,u.DepthMode.ReadOnly);if(b.setDepthMode(I),"globe"===m.transform.projection.name){const A=m.transform.pointMerc;E.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(m.transform.zoom),[A.x,A.y],m.transform.pixelsPerMeterRatio)}else E.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else u.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ll{constructor(a,d,_=!1){this.context=new Pt(a,_),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,d){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Lo(this,a));const b=this._terrain;this.transform.elevation=_?b:null,b.update(a,this.transform,d)}_updateFog(a){const d=a.fog;if(!d||"globe"===this.transform.projection.name||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const E=_+.78*(b-_);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,d){if(this.width=a*u.exported.devicePixelRatio,this.height=d*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const a=this.context,d=new u.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(u.EXTENT,0),d.emplaceBack(0,u.EXTENT),d.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(d,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const _=new u.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(u.EXTENT,0),_.emplaceBack(0,u.EXTENT),_.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=a.createVertexBuffer(_,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const b=new u.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(b,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const E=new u.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(u.EXTENT,0,u.EXTENT,0),E.emplaceBack(0,u.EXTENT,0,u.EXTENT),E.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(E,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const I=new u.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const A=new u.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])A.emplaceBack(B);this.debugIndexBuffer=a.createIndexBuffer(A),this.emptyTexture=new u.Texture(a,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=u.create();const R=this.context.gl;this.stencilClearMode=new u.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new al(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,d.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,nl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,d,_){if(!d||this.currentStencilSource===d.id||!a.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){A=!0;break}if(!A)return}this.currentStencilSource=d.id;const b=this.context,E=b.gl;this.nextStencilID+_.length>256&&this.clearStencil(),b.setColorMode(u.ColorMode.disabled),b.setDepthMode(u.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of _){const R=d.getTile(A),B=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:K}=this.getTileBoundsBuffers(R);I.draw(b,E.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:E.ALWAYS,mask:0},B,255,E.KEEP,E.KEEP,E.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,nl(A.projMatrix),"$clipping",z,H,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new u.StencilMode({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const d=this.context.gl;return new u.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,_=a.sort((I,A)=>A.overscaledZ-I.overscaledZ),b=_[_.length-1].overscaledZ,E=_[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const I={};for(let A=0;A<E;A++)I[A+b]=new u.StencilMode({func:d.GEQUAL,mask:255},A+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[I,_]}return[{[b]:u.StencilMode.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([a.CONSTANT_COLOR,a.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(a,d,_){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new u.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const B in b){const z=b[B];z.used&&z.prepare(this.context)}const E={},I={},A={};for(const B in b){const z=b[B];E[B]=z.getVisibleCoordinates(),I[B]=E[B].slice().reverse(),A[B]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const B of _){const z=this.style._layers[B],H=a._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const K=H?I[H.id]:void 0;("custom"===z.type||z.isSky()||K&&K.length)&&this.renderLayer(this,H,z,K)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);if(B.isSky())continue;const H=z?I[z.id]:void 0;this._renderTileClippingMasks(B,z,H),this.renderLayer(this,z,B,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,z){const H=B.context,K=H.gl,te=B.transform,ie=new u.DepthMode(K.LEQUAL,u.DepthMode.ReadOnly,[0,1]),ne=B.useProgram("globeAtmosphere",null,"globe"===te.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),re=u.globeToMercatorTransition(te.zoom),G=z.properties.get("color").toArray01(),ee=z.properties.get("high-color").toArray01(),le=z.properties.get("space-color").toArray01PremultipliedAlpha(),ce=u.identity$1([]);u.rotateY$1(ce,ce,-u.degToRad(te._center.lng)),u.rotateX$1(ce,ce,u.degToRad(te._center.lat)),u.rotateZ$1(ce,ce,te.angle),u.rotateX$1(ce,ce,-te._pitch);const be=u.fromQuat(new Float32Array(16),ce),Ee=u.mapValue(z.properties.get("star-intensity"),0,1,0,.25),Ne=u.mapValue(z.properties.get("horizon-blend"),0,1,5e-4,.25),Pe=u.globeUseCustomAntiAliasing(B,H,te)&&5e-4===Ne?te.worldSize/(2*Math.PI*1.025)-1:te.globeRadius,Ze=B.frameCounter/1e3%1,Et=u.length(te.globeCenterInViewSpace),Ue=Math.sqrt(Math.pow(Et,2)-Math.pow(Pe,2)),ut=Math.acos(Ue/Et),Ke={u_frustum_tl:te.frustumCorners.TL,u_frustum_tr:te.frustumCorners.TR,u_frustum_br:te.frustumCorners.BR,u_frustum_bl:te.frustumCorners.BL,u_horizon:te.frustumCorners.horizon,u_transition:re,u_fadeout_range:Ne,u_color:G,u_high_color:ee,u_space_color:le,u_star_intensity:Ee,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ze,u_horizon_angle:ut,u_rotation_matrix:be};B.prepareDrawProgram(H,ne);const xt=B.atmosphereBuffer;xt&&ne.draw(H,K.TRIANGLES,ie,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,Ke,"skybox",xt.vertexBuffer,xt.indexBuffer,xt.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,z,B,z?I[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=z?("symbol"===B.type?A:I)[z.id]:void 0;this._renderTileClippingMasks(B,z,z?E[z.id]:void 0),this.renderLayer(this,z,B,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;u.values(this.style._layers).forEach(z=>{const H=a._getLayerSourceCache(z);H&&!z.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<H.getSource().maxzoom)&&(B=H)}),B&&this.options.showTileBoundaries&&pr.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const z=B.transform.padding;us(B,B.transform.height-(z.top||0),3,xs),us(B,z.bottom||0,3,$d),La(B,z.left||0,3,zu),La(B,B.transform.width-(z.right||0),3,Hd);const H=B.transform.centerPoint;var K,te,ie,ne;Bl(K=B,(te=H.x)-1,(ie=B.transform.height-H.y)-10,2,20,ne=Oh),Bl(K,te-10,ie-1,20,2,ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,d,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(_.type)||a.terrain&&"custom"===_.type)&&pr[_.type](a,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[a.id];_||(_=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,d=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),a.beginQueryEXT(a.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const d={};for(const _ in a){const b=a[_],E=this.context.extTimerQuery,I=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),d[_]=I}return d}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let _=0;for(const b of a)_+=d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(b);return _}translatePosMatrix(a,d,_,b,E){if(!_[0]&&!_[1])return a;const I=E?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(I){const B=Math.sin(I),z=Math.cos(I);_=[_[0]*z-_[1]*B,_[0]*B+_[1]*z]}const A=[E?_[0]:dn(d,_[0],this.transform.zoom),E?_[1]:dn(d,_[1],this.transform.zoom),0],R=new Float32Array(16);return u.translate(R,a,A),R}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){return null===a||void 0!==a&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),d&&b.push("ZERO_EXAGGERATION"),_&&!a&&0!==_.getOpacity(this.transform.pitch)&&b.push("FOG"),a&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(a,d,_){this.cache=this.cache||{};const b=_||[],E=this.currentGlobalDefines().concat(b),I=si.cacheKey(Rl[a],a,E,d);return this.cache[I]||(this.cache[I]=new si(this.context,a,Rl[a],d,Oo[a],E)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),I=((A,R,B,z,H,K,te,ie,ne,re,G)=>{const ee=A.transform,le=R.properties.get("color").toArray01();le[3]=z;const ce=A.frameCounter/1e3%1;return{u_fog_matrix:B?ee.calculateFogTileMatrix(B):A.identityMat,u_fog_range:R.getFovAdjustedRange(ee._fov),u_fog_color:le,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:H,u_frustum_tr:K,u_frustum_br:te,u_frustum_bl:ie,u_globe_pos:ne,u_globe_radius:re,u_viewport:G,u_globe_transition:u.globeToMercatorTransition(ee.zoom),u_is_globe:+("globe"===ee.projection.name)}})(this,b,_,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);d.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,d=a.createTexture();return a.bindTexture(a.TEXTURE_2D,d),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)d[b.key]=a[b.key]||new u.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Qc{constructor(a=0,d=0,_=0,b=0){if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=_,this.right=b}interpolate(a,d,_){return null!=d.top&&null!=a.top&&(this.top=u.number(a.top,d.top,_)),null!=d.bottom&&null!=a.bottom&&(this.bottom=u.number(a.bottom,d.bottom,_)),null!=d.left&&null!=a.left&&(this.left=u.number(a.left,d.left,_)),null!=d.right&&null!=a.right&&(this.right=u.number(a.right,d.right,_)),this}getCenter(a,d){const _=u.clamp((this.left+a-this.right)/2,0,a),b=u.clamp((this.top+d-this.bottom)/2,0,d);return new u.Point(_,b)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Qc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wo(m,a){const d=u.getColumn(m,3);u.fromQuat(m,a),u.setColumn(m,3,d)}function Nn(m,a){const d=u.identity$1([]);return u.rotateZ$1(d,d,-a),u.rotateX$1(d,d,-m),d}function Vl(m,a){const d=[m[0],m[1],0],_=[a[0],a[1],0];if(u.length(d)>=1e-15){const I=u.normalize([],d);u.scale$2(_,I,u.dot(_,I)),a[0]=_[0],a[1]=_[1]}const b=u.cross([],a,m);if(u.len(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return Nn(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),E)}class cl{constructor(a,d){this.position=a,this.orientation=d}get position(){return this._position}set position(a){if(a){const d=a instanceof u.MercatorCoordinate?a:new u.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(d.x=u.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(a,d){if(this.orientation=null,!this.position)return;const _=this.position,b=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(a)):0,E=u.MercatorCoordinate.fromLngLat(a,b),I=[E.x-_.x,E.y-_.y,E.z-_.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Vl(I,d)}setPitchBearing(a,d){this.orientation=Nn(u.degToRad(a),u.degToRad(-d))}}class Pn{constructor(a,d){this._transform=u.identity([]),this.orientation=d,this.position=a}get mercatorPosition(){const a=this.position;return new u.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=u.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var d;a&&u.setColumn(this._transform,3,[(d=a)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||u.identity$1([]),a&&Wo(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,d){this._orientation=Nn(a,d),Wo(this._transform,this._orientation)}forward(){const a=u.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=u.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=u.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,d){const _=new Float64Array(16);return u.invert(_,this.getWorldToCamera(a,d)),_}getWorldToCameraPosition(a,d,_){const b=this.position;u.scale$2(b,b,-a);const E=new Float64Array(16);return u.fromScaling(E,[_,_,_]),u.translate(E,E,b),E[10]*=d,E}getWorldToCamera(a,d){const _=new Float64Array(16),b=new Float64Array(4),E=this.position;return u.conjugate(b,this._orientation),u.scale$2(E,E,-a),u.fromQuat(_,b),u.translate(_,_,E),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(a,d,_,b){const E=new Float64Array(16);return u.perspective(E,a,d,_,b),E}getDistanceToElevation(a,d=!1){const _=0===a?0:u.mercatorZfromAltitude(a,d?u.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(_-this.position[2])/b[2]}clone(){return new Pn([...this.position],[...this.orientation])}}function br(m,a){const d=Tr(m.projection,m.zoom,m.width,m.height),_=function(E,I,A,R,B){const z=new u.LngLat(A.lng-180*lr,A.lat),H=new u.LngLat(A.lng+180*lr,A.lat),K=E.project(z.lng,z.lat),te=E.project(H.lng,H.lat),ie=-Math.atan2(te.y-K.y,te.x-K.x),ne=u.MercatorCoordinate.fromLngLat(A);ne.y=u.clamp(ne.y,-1+lr,1-lr);const re=ne.toLngLat(),G=E.project(re.lng,re.lat),ee=u.MercatorCoordinate.fromLngLat(re);ee.x+=lr;const le=ee.toLngLat(),ce=E.project(le.lng,le.lat),be=Kr(ce.x-G.x,ce.y-G.y,ie),Ee=u.MercatorCoordinate.fromLngLat(re);Ee.y+=lr;const we=Ee.toLngLat(),Ne=E.project(we.lng,we.lat),Pe=Kr(Ne.x-G.x,Ne.y-G.y,ie),Ze=Math.abs(be.x)/Math.abs(Pe.y),Et=u.identity([]);u.rotateZ(Et,Et,-ie*(1-(B?0:R)));const Ue=u.identity([]);return u.scale(Ue,Ue,[1,1-(1-Ze)*R,1]),Ue[4]=-Pe.x/Pe.y*R,u.rotateZ(Ue,Ue,ie),u.multiply(Ue,Et,Ue),Ue}(m.projection,0,m.center,d,a),b=ti(m);return u.scale(_,_,[b,b,1]),_}function ti(m){const a=m.projection,d=Tr(m.projection,m.zoom,m.width,m.height),_=ul(a,m.center),b=ul(a,u.LngLat.convert(a.center));return Math.pow(2,_*d+(1-d)*b)}function Tr(m,a,d,_,b=1/0){const E=m.range;if(!E)return 0;const I=Math.min(b,Math.max(d,_)),A=Math.log(I/1024)/Math.LN2;return u.smoothstep(E[0]+A,E[1]+A,a)}const lr=1/4e4;function ul(m,a){const d=u.clamp(a.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),_=new u.LngLat(a.lng-180*lr,d),b=new u.LngLat(a.lng+180*lr,d),E=m.project(_.lng,d),I=m.project(b.lng,d),A=u.MercatorCoordinate.fromLngLat(_),R=u.MercatorCoordinate.fromLngLat(b),B=I.x-E.x,z=I.y-E.y,H=R.x-A.x,K=R.y-A.y,te=Math.sqrt((H*H+K*K)/(B*B+z*z));return Math.log(te)/Math.LN2}function Kr(m,a,d){const _=Math.cos(d),b=Math.sin(d);return{x:m*_-a*b,y:m*b+a*_}}class ka{constructor(a,d,_,b,E,I,A){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=b??60,this.setProjection(I),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,d=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const _=!Q(d,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const d=a!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.Point(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const d=-a*Math.PI/180;var _,b,E,I,A,R,B,z,H,K;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,I=this.angle,A=(E=this.rotationMatrix)[0],R=E[1],B=E[2],z=E[3],H=Math.sin(I),K=Math.cos(I),b[0]=A*K+B*H,b[1]=R*K+z*H,b[2]=A*-H+B*K,b[3]=R*-H+z*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=u.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=u.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,E=0;for(let I=0;I<d.length;I++){const A=new u.Point(d[I][0]*this.width,_+d[I][1]*(this.height-_)),R=a.pointCoordinate(A);if(!R)continue;const B=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);b+=R[3]*B,E+=B}return 0===E?NaN:b/E}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(a),E=this._mercatorZfromZoom(this._maxZoom),I=Math.max(b-_,E);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[d.x,d.y,d.z]:[a.x,a.y,a.z];const b=u.length(u.sub([],this._camera.position,_));return u.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let d=!1;if(a.orientation&&!u.exactEquals(a.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];u.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,d=new cl;return d.position=new u.MercatorCoordinate(a[0],a[1],a[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(a){if(!u.length$1(a))return!1;u.normalize$1(a,a);const d=u.transformQuat([],[0,0,-1],a),_=u.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;const b=Vl(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(a){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;a[2]=u.clamp(a[2],b/_,b/d),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,_){this._unmodified=!1,this._edgeInsets.interpolate(a,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new u.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new u.Point(0,0)),b=this.pointCoordinate(new u.Point(this.width,0)),E=this.pointCoordinate(new u.Point(this.width,this.height)),I=this.pointCoordinate(new u.Point(0,this.height)),A=Math.floor(Math.min(_.x,b.x,E.x,I.x)),R=Math.floor(Math.max(_.x,b.x,E.x,I.x)),B=1;for(let z=A-B;z<=R+B;z++)0!==z&&d.push(new u.UnwrappedTileID(z,a))}return d}coveringTiles(a){let d=this.coveringZoomLevel(a);const _=d,b=this.elevation&&!a.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==a.minzoom&&d<a.minzoom)return[];void 0!==a.maxzoom&&d>a.maxzoom&&(d=a.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,R=1<<d,B=[R*I.x,R*I.y,0],z="globe"===this.projection.name,H=!z,K=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,H),te=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=R*u.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),re=[R*te.x,R*te.y,ne*(H?1:ie)],G=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,le=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=a.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?ti(this):1,Ee=qe=>{const Dt=new u.MercatorCoordinate(qe.x+25e-6,qe.y,qe.z),pt=new u.MercatorCoordinate(qe.x,qe.y+25e-6,qe.z),It=qe.toLngLat(),un=Dt.toLngLat(),Rn=pt.toLngLat(),en=this.locationCoordinate(It),bn=this.locationCoordinate(un),Jn=this.locationCoordinate(Rn),Kn=Math.hypot(bn.x-en.x,bn.y-en.y),Kt=Math.hypot(Jn.x-en.x,Jn.y-en.y);return Math.sqrt(Kn*Kt)*be/25e-6},we=qe=>{const lt=le,Dt=ce;return{aabb:u.tileAABB(this,R,0,0,0,qe,Dt,lt,this.projection),zoom:0,x:0,y:0,minZ:Dt,maxZ:lt,wrap:qe,fullyVisible:!1}},Ne=[];let Pe=[];const Ze=d,Et=a.reparseOverscaled?_:d,Ue=qe=>qe*qe,ut=Ue((ne-this._centerAltitude)*ie),Ke=qe=>{if(!this._elevation||!qe.tileID||!E)return;const lt=this._elevation.getMinMaxForTile(qe.tileID),Dt=qe.aabb;lt?(Dt.min[2]=lt.min,Dt.max[2]=lt.max,Dt.center[2]=(Dt.min[2]+Dt.max[2])/2):(qe.shouldSplit=xt(qe),qe.shouldSplit||(Dt.min[2]=Dt.max[2]=Dt.center[2]=this._centerAltitude))},xt=qe=>{if(qe.zoom<ee)return!0;if(qe.zoom===Ze)return!1;if(null!=qe.shouldSplit)return qe.shouldSplit;const lt=qe.aabb.distanceX(re),Dt=qe.aabb.distanceY(re);let pt=ut,It=1;if(z){pt=Ue(qe.aabb.distanceZ(re));const en=Math.pow(2,qe.zoom),bn=u.latFromMercatorY((qe.y+1)/en),Jn=u.latFromMercatorY(qe.y/en),Kn=Math.min(Math.max(A,bn),Jn),Kt=u.circumferenceAtLatitude(Kn)/u.circumferenceAtLatitude(A);if(It=Kn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Kt/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&qe.zoom===Ze-1&&Kt>=.9)return!0}else if(b&&(pt=Ue(qe.aabb.distanceZ(re)*ie)),this.projection.isReprojectedInTileSpace&&_<=5){const en=Math.pow(2,qe.zoom),bn=Ee(new u.MercatorCoordinate((qe.x+.5)/en,(qe.y+.5)/en));It=bn>.85?1:bn}const un=lt*lt+Dt*Dt+pt;return un<Ue((1<<Ze-qe.zoom)*G*It*((en,bn)=>{if(bn*Ue(.707)<en)return 1;const Jn=Math.sqrt(bn/en);return Jn/(1.4144271570014144+(Math.pow(1.1,Jn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,ut),un))};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)Ne.push(we(-qe)),Ne.push(we(qe));for(Ne.push(we(0));Ne.length>0;){const qe=Ne.pop(),lt=qe.x,Dt=qe.y;let pt=qe.fullyVisible;if(!pt){const It=qe.aabb.intersects(K);if(0===It)continue;pt=2===It}if(qe.zoom!==Ze&&xt(qe))for(let It=0;It<4;It++){const un=(lt<<1)+It%2,Rn=(Dt<<1)+(It>>1),en={aabb:E?qe.aabb.quadrant(It):u.tileAABB(this,R,qe.zoom+1,un,Rn,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:un,y:Rn,wrap:qe.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};b&&!z&&(en.tileID=new u.OverscaledTileID(qe.zoom+1===Ze?Et:qe.zoom+1,qe.wrap,qe.zoom+1,un,Rn),Ke(en)),Ne.push(en)}else{const It=qe.zoom===Ze?Et:qe.zoom;if(a.minzoom&&a.minzoom>It)continue;const un=B[0]-(.5+lt+(qe.wrap<<qe.zoom))*(1<<d-qe.zoom),Rn=B[1]-.5-Dt,en=qe.tileID?qe.tileID:new u.OverscaledTileID(It,qe.wrap,qe.zoom,lt,Dt);Pe.push({tileID:en,distanceSq:un*un+Rn*Rn})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,lt=this.horizonLineFromTop();Pe=Pe.filter(Dt=>{const pt=[0,0,0,1],It=[u.EXTENT,u.EXTENT,0,1],un=this.calculateFogTileMatrix(Dt.tileID.toUnwrapped());u.transformMat4$1(pt,pt,un),u.transformMat4$1(It,It,un);const Rn=u.getAABBPointSquareDist(pt,It);if(0===Rn)return!0;let en=!1;const bn=this._elevation;if(bn&&Rn>qe&&0!==lt){const Jn=this.calculateProjMatrix(Dt.tileID.toUnwrapped());let Kn;a.isTerrainDEM||(Kn=bn.getMinMaxForTile(Dt.tileID)),Kn||(Kn={min:ce,max:le});const Kt=u.furthestTileCorner(this.rotation),bi=[Kt[0]*u.EXTENT,Kt[1]*u.EXTENT,Kn.max];u.transformMat4(bi,bi,Jn),en=(1-bi[1])*this.height*.5<lt}return Rn<qe||en})}return Pe.sort((qe,lt)=>qe.distanceSq-lt.distanceSq).map(qe=>qe.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=u.clamp(a.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),_=this.projection.project(a.lng,d);return new u.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/u.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,d){let _,b;const E=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(d.x-E.x)/A,b=(d.y-E.y)/A}else{const A=this.pointCoordinate(d),R=this.pointCoordinate(E);_=A.x-R.x,b=A.y-R.y}const I=this.locationCoordinate(a);this.setLocation(new u.MercatorCoordinate(I.x-_,I.y-b))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,d){const _=d?u.mercatorZfromAltitude(d,a.lat):void 0,b=this.projection.project(a.lng,a.lat);return new u.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,d){const _=d??this._centerAltitude,b=[a.x,a.y,0,1],E=[a.x,a.y,1,1];u.transformMat4$1(b,b,this.pixelMatrixInverse),u.transformMat4$1(E,E,this.pixelMatrixInverse);const I=E[3];u.scale$1(b,b,1/b[3]),u.scale$1(E,E,1/I);const A=b[2],R=E[2];return{p0:b,p1:E,t:A===R?0:(_-A)/(R-A)}}screenPointToMercatorRay(a){const d=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return u.transformMat4$1(d,d,this.pixelMatrixInverse),u.transformMat4$1(_,_,this.pixelMatrixInverse),u.scale$1(d,d,1/d[3]),u.scale$1(_,_,1/_[3]),d[2]=u.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=u.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,u.scale$1(d,d,1/this.worldSize),u.scale$1(_,_,1/this.worldSize),new u.Ray([d[0],d[1],d[2]],u.normalize([],u.sub([],_,d)))}rayIntersectionCoordinate(a){const{p0:d,p1:_,t:b}=a,E=u.mercatorZfromAltitude(d[2],this._center.lat),I=u.mercatorZfromAltitude(_[2],this._center.lat);return new u.MercatorCoordinate(u.number(d[0],_[0],b)/this.worldSize,u.number(d[1],_[1],b)/this.worldSize,u.number(E,I,b))}pointCoordinate(a,d=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,d)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let d=this.projection.pointCoordinate3D(this,a.x,a.y);if(d)return new u.MercatorCoordinate(d[0],d[1],d[2]);let _=0,b=this.horizonLineFromTop();if(a.y>b)return this.pointCoordinate(a);const E=.02*b,I=a.clone();for(let A=0;A<10&&b-_>E;A++){I.y=u.number(_,b,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(b=I.y,d=R):_=I.y}return d?new u.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const d=this.pointCoordinate(a);return d.y>=0&&d.y<=1}_coordinatePoint(a,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,b=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return u.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new u.Point(b[0]/b[3],b[1]/b[3]):new u.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new u.Point(d,a)),I=this.pointLocation3D(new u.Point(b,a)),A=this.pointLocation3D(new u.Point(b,_)),R=this.pointLocation3D(new u.Point(d,_));let B=Math.min(E.lng,I.lng,A.lng,R.lng),z=Math.max(E.lng,I.lng,A.lng,R.lng),H=Math.min(E.lat,I.lat,A.lat,R.lat),K=Math.max(E.lat,I.lat,A.lat,R.lat);const te=Math.pow(2,-this.zoom)/16*270,ie="globe"===this.projection.name?1:4,ne=(re,G,ee,le,ce)=>{const be=(re+ee)/2,Ee=(G+le)/2,we=new u.Point(be,Ee),{lng:Ne,lat:Pe}=this.pointLocation3D(we),Ze=Math.max(0,B-Ne,H-Pe,Ne-z,Pe-K);B=Math.min(B,Ne),z=Math.max(z,Ne),H=Math.min(H,Pe),K=Math.max(K,Pe),(ce<ie||Ze>te)&&(ne(re,G,be,Ee,ce+1),ne(be,Ee,ee,le,ce+1))};if(ne(d,a,b,a,1),ne(b,a,b,_,1),ne(b,_,d,_,1),ne(d,_,d,a,1),"globe"===this.projection.name){const[re,G]=u.polesInViewport(this);re?(K=90,z=180,B=-180):G&&(H=-90,z=180,B=-180)}return new u.LngLatBounds(new u.LngLat(B,H),new u.LngLat(z,K))}_getBoundsRectangular(a,d){const{top:_,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=new u.Point(b,_),R=new u.Point(I,_),B=new u.Point(I,E),z=new u.Point(b,E);let H=this.pointCoordinate(A,a),K=this.pointCoordinate(R,a);const te=this.pointCoordinate(B,d),ie=this.pointCoordinate(z,d),ne=(re,G)=>(G.y-re.y)/(G.x-re.x);return H.y>1&&K.y>=0?H=new u.MercatorCoordinate((1-ie.y)/ne(ie,H)+ie.x,1):H.y<0&&K.y<=1&&(H=new u.MercatorCoordinate(-ie.y/ne(ie,H)+ie.x,0)),K.y>1&&H.y>=0?K=new u.MercatorCoordinate((1-te.y)/ne(te,K)+te.x,1):K.y<0&&H.y<=1&&(K=new u.MercatorCoordinate(-te.y/ne(te,K)+te.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(te))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=a.visibleDemTiles.reduce((_,b)=>{if(b.dem){const E=b.dem.tree;_.min=Math.min(_.min,E.minimums[0]),_.max=Math.max(_.max,E.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*a.exaggeration(),d.max*a.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,d){return this.projection.createTileMatrix(this,d,a)}calculateDistanceTileData(a){const d=a.key,_=this._distanceTileDataCache;if(_[d])return _[d];const b=a.canonical,E=1/this.height,I=this.cameraWorldSize,A=I/this.zoomScale(b.z),R=(b.x+Math.pow(2,b.z)*a.wrap)*A,B=b.y*A,z=this.point;z.x*=I/this.worldSize,z.y*=I/this.worldSize;const H=this.angle,K=Math.sin(-H),te=-Math.cos(-H);return _[d]={bearing:[K,te],center:[(z.x-R)*E,(z.y-B)*E],scale:A/u.EXTENT*E},_[d]}calculateFogTileMatrix(a){const d=a.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return u.multiply(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(a,d=!1){const _=a.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const E=this.calculatePosMatrix(a,this.worldSize);return u.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,E),b[_]=new Float32Array(E),b[_]}calculatePixelsToTileUnitsMatrix(a){const d=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const b=function(E,I){const{scale:A}=E.tileTransform,R=A*u.EXTENT/(E.tileSize*Math.pow(2,I.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return B=new Float32Array(4),K=(z=I.inverseAdjustmentMatrix)[1],te=z[2],ie=z[3],re=(H=[R,R])[1],B[0]=z[0]*(ne=H[0]),B[1]=K*ne,B[2]=te*re,B[3]=ie*re,B;var B,z,H,K,te,ie,ne,re}(a,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const a=1/this.worldSize,d=u.fromScaling([],[a,a,a]);return u.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const d=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=this._camera.forward(),E=u.mercatorZfromAltitude(1,this._center.lat);_[2]/=E,b[2]/=E,u.normalize(b,b);const I=a.raycast(_,b,a.exaggeration());if(I){const A=u.scaleAndAdd([],_,b,I),R=new u.MercatorCoordinate(A[0],A[1],u.mercatorZfromAltitude(A[2],u.latFromMercatorY(A[1]))),B=(R.z+u.length([R.x-_[0],R.y-_[1],R.z-_[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const d=this._elevation,_=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(_),E=d.getAtPointOrZero(new u.MercatorCoordinate(...b)),I=this.pixelsPerMeter/this.worldSize*E,A=this._minimumHeightOverTerrain(),R=b[2]-I;if(R<=A)if(R<0||a){const B=this.locationCoordinate(this._center,this._centerAltitude),z=[b[0],b[1],B.z-b[2]],H=u.length(z);z[2]-=(A-R)/this._pixelsPerMercatorPixel;const K=u.length(z);if(0===K)return;u.scale$2(z,z,H/K*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],B.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const K=this.center;return K.lat=u.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(K.lng=u.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const d=this._unmodified,{x:_,y:b}=this.point;let E=0,I=_,A=b;const R=this.width/2,B=this.height/2,z=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(b-B<z&&(A=z+B),b+B>H&&(A=H-B),H-z<this.height&&(E=Math.max(E,this.height/(H-z)),A=(H+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,ie=this.worldSize/2-(K+te)/2;I=(_+ie+this.worldSize)%this.worldSize-ie,I-R<K&&(I=K+R),I+R>te&&(I=te-R),te-K<this.width&&(E=Math.max(E,this.width/(te-K)),I=(te+K)/2)}I===_&&A===b||(this.center=this.unproject(new u.Point(I,A))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const _=Tr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b="meters"===this.projection.zAxisUnit?d:1,E=this._camera.getWorldToCamera(this.worldSize,b),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-a.x/this.width,I[9]=2*a.y/this.height;let A=u.mul([],I,E);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),we=u.identity([]);u.translate(we,we,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),u.multiply(we,we,br(this)),u.translate(we,we,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),u.multiply(A,A,we),this.inverseAdjustmentMatrix=function(Ne){const Pe=br(Ne,!0);return Fe([],[Pe[0],Pe[1],Pe[4],Pe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],A,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=A,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const R=u.invert([],I);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);u.identity(B),u.scale(B,B,[1,-1,1]),u.rotateX(B,B,this._pitch),u.rotateZ(B,B,this.angle);const z=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-a.x/this.width,z[9]=2*(a.y+H)/this.height,this.skyboxMatrix=u.multiply(B,z,B);const K=this.point,te=K.x,ie=K.y,ne=this.width%2/2,re=this.height%2/2,G=Math.cos(this.angle),ee=Math.sin(this.angle),le=te-Math.round(te)+G*ne+ee*re,ce=ie-Math.round(ie)+G*re+ee*ne,be=new Float64Array(A);if(u.translate(be,be,[le>.5?le-1:le,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=be,A=u.create(),u.scale(A,A,[this.width/2,-this.height/2,1]),u.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=u.create(),u.scale(A,A,[1,-1,1]),u.translate(A,A,[-1,-1,0]),u.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=u.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(Ee,Ee,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[a,a,d];u.scale$2(E,E,b),u.scale$2(_,_,-1),u.multiply$2(_,_,E);const I=u.create();u.translate(I,I,_),u.scale(I,I,E),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,d,b)}_computeCameraPosition(a){const d=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-a/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*E,b.y/this.worldSize-_[1]*E,a/this.worldSize*this._centerAltitude-_[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],b=a[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((d-_)/b,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,a,E),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),E=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),A=Math.max((a[2]-E)/Math.cos(_),I),R=this._zoomFromMercatorZ(A);u.scaleAndAdd(a,a,d,A),this._pitch=u.clamp(_,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(b,-Math.PI,Math.PI),this._setZoom(u.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let d=0,_=u.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;_-d>1e-6&&_>d;){const I=d+.5*(_-d),A=this.tileSize*Math.pow(2,I),R=this.getCameraToCenterDistance(this.projection,I,A),B=this.scaleZoom(R/(a*this.tileSize)),z=Math.abs(I-B);z<E&&(E=z,b=I),I<B?d=I:_=I}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,d){const _=Math.min(a.x,d.x),b=Math.max(a.x,d.x),E=Math.min(a.y,d.y),I=Math.max(a.y,d.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new u.Point(_,E),new u.Point(b,I),new u.Point(_,I),new u.Point(b,E)],R=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const z of A){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const K=this.rayIntersectionCoordinate(H);if(K.x<R||K.y<0||K.x>B||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.Point(0,0),new u.Point(this.width,this.height))}zoomDeltaToMovement(a,d){const _=u.length(u.sub([],this._camera.position,a)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const a=function([d,_,b],E){const I=[d,_,b,1];u.transformMat4$1(I,I,E);const A=I[3]=Math.max(I[3],1e-6);return I[0]/=A,I[1]/=A,I[2]/=A,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,a))}}getCameraToCenterDistance(a,d=this.zoom,_=this.worldSize){const b=Tr(a,d,this.width,this.height,1024),E=a.pixelSpaceConversion(this.center.lat,_,b);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(a,a,this.globeMatrix),a}}function Oa(m,a){let d=!1,_=null;const b=()=>{_=null,d&&(m(),_=setTimeout(b,a),d=!1)};return()=>(d=!0,_||b(),_)}class hl{constructor(a){this._hashName=a&&encodeURIComponent(a),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Oa(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,u.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const d=Ul(a);if(this._hashName){const _=this._hashName;let b=!1;const E=u.window.location.hash.slice(1).split("&").map(I=>{const A=I.split("=")[0];return A===_?(b=!0,`${A}=${d}`):I}).filter(I=>I);return b||E.push(`${_}=${d}`),`#${E.join("&")}`}return`#${d}`}_getCurrentHash(){const a=u.window.location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(d[3]||0):a.getBearing();return a.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,a)}}function Ul(m,a){const d=m.getCenter(),_=Math.round(100*m.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),I=Math.round(d.lng*E)/E,A=Math.round(d.lat*E)/E,R=m.getBearing(),B=m.getPitch();let z=a?`/${I}/${A}/${_}`:`${_}/${A}/${I}`;return(R||B)&&(z+="/"+Math.round(10*R)/10),B&&(z+=`/${Math.round(B)}`),z}const yc={linearity:.3,easing:u.bezier(0,0,.3,1)},Zi=u.extend({deceleration:2500,maxSpeed:1400},yc),Jt=u.extend({deceleration:20,maxSpeed:1400},yc),ft=u.extend({deceleration:1e3,maxSpeed:360},yc),h=u.extend({deceleration:1e3,maxSpeed:90},yc);class x{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=u.exported.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const E=k(d.pan.mag(),_,u.extend({},Zi,a||{}));b.offset=d.pan.mult(E.amount/d.pan.mag()),b.center=this._map.transform.center,M(b,E)}if(d.zoom){const E=k(d.zoom,_,Jt);b.zoom=this._map.transform.zoom+E.amount,M(b,E)}if(d.bearing){const E=k(d.bearing,_,ft);b.bearing=this._map.transform.bearing+u.clamp(E.amount,-179,179),M(b,E)}if(d.pitch){const E=k(d.pitch,_,h);b.pitch=this._map.transform.pitch+E.amount,M(b,E)}if(b.zoom||b.bearing){const E=void 0===d.pinchAround?d.around:d.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function M(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function k(m,a,d){const{maxSpeed:_,linearity:b,deceleration:E}=d,I=u.clamp(m*b/(a/1e3),-_,_),A=Math.abs(I)/(E*b);return{easing:d.easing,duration:1e3*A,amount:I*(A/2)}}class U extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_,b={}){const E=bt(d.getCanvasContainer(),_),I=d.unproject(E);super(a,u.extend({point:E,lngLat:I,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class X extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){const b="touchend"===a?_.changedTouches:_.touches,E=$e(d.getCanvasContainer(),b),I=E.map(R=>d.unproject(R)),A=E.reduce((R,B,z,H)=>R.add(B.div(H.length)),new u.Point(0,0));super(a,{points:E,point:A,lngLats:I,lngLat:d.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class xe extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class He{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new xe(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new U(a.type,this._map,a))}mouseup(a){this._map.fire(new U(a.type,this._map,a))}preclick(a){const d=u.extend({},a);d.type="preclick",this._map.fire(new U(d.type,this._map,d))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(a),this._map.fire(new U(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new U(a.type,this._map,a))}mouseover(a){this._map.fire(new U(a.type,this._map,a))}mouseout(a){this._map.fire(new U(a.type,this._map,a))}touchstart(a){return this._firePreventable(new X(a.type,this._map,a))}touchmove(a){this._map.fire(new X(a.type,this._map,a))}touchend(a){this._map.fire(new X(a.type,this._map,a))}touchcancel(a){this._map.fire(new X(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oe{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new U(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new U("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new U(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tt{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&0===a.button&&(Nt(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const _=d,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(_)||!this._box&&_.dist(b)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Re("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const I=Math.min(b.x,_.x),A=Math.max(b.x,_.x),R=Math.min(b.y,_.y),B=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=A-I+"px",this._box.style.height=B-R+"px")})}mouseupWindow(a,d){if(!this._active)return;const _=this._startPos,b=d;if(_&&0===a.button){if(this.reset(),Je(),_.x!==b.x||_.y!==b.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:E=>E.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),kt(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new u.Event(a,{originalEvent:d}))}}function rn(m,a){const d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=a[_];return d}class xn{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const E=new u.Point(0,0);for(const I of b)E._add(I);return E.div(b.length)}(d),this.touches=rn(_,d)))}touchmove(a,d,_){if(this.aborted||!this.centroid)return;const b=rn(_,d);for(const E in this.touches){const I=b[E];(!I||I.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(a,d,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class vn{constructor(a){this.singleTap=new xn(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,d,_){this.singleTap.touchstart(a,d,_)}touchmove(a,d,_){this.singleTap.touchmove(a,d,_)}touchend(a,d,_){const b=this.singleTap.touchend(a,d,_);if(b){const E=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(E&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Fr{constructor(){this._zoomIn=new vn({numTouches:1,numTaps:2}),this._zoomOut=new vn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,_){this._zoomIn.touchstart(a,d,_),this._zoomOut.touchstart(a,d,_)}touchmove(a,d,_){this._zoomIn.touchmove(a,d,_),this._zoomOut.touchmove(a,d,_)}touchend(a,d,_){const b=this._zoomIn.touchend(a,d,_),E=this._zoomOut.touchend(a,d,_);return b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(b)},{originalEvent:a})}):E?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(E)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cr={0:1,2:2};class Wi{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,d){return!1}_move(a,d){return{}}mousedown(a,d){if(this._lastPoint)return;const _=ke(a);this._correctButton(a,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(a,d){const _=this._lastPoint;if(_)if(a.preventDefault(),null!=this._eventButton&&function(b,E){const I=cr[E];return void 0===b.buttons||(b.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(a){this._lastPoint&&ke(a)===this._eventButton&&(this._moved&&Je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr extends Wi{mousedown(a,d){super.mousedown(a,d),this._lastPoint&&(this._active=!0)}_correctButton(a,d){return 0===d&&!a.ctrlKey}_move(a,d){return{around:d,panDelta:d.sub(a)}}}class Js extends Wi{_correctButton(a,d){return 0===d&&a.ctrlKey||2===d}_move(a,d){const _=.8*(d.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class ws extends Wi{_correctButton(a,d){return 0===d&&a.ctrlKey||2===d}_move(a,d){const _=-.5*(d.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class Xo{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.Point(0,0)}touchstart(a,d,_){return this._calculateTransform(a,d,_)}touchmove(a,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,d,_)}}touchend(a,d,_){this._calculateTransform(a,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,_){_.length>0&&(this._active=!0);const b=rn(_,d),E=new u.Point(0,0),I=new u.Point(0,0);let A=0;for(const B in b){const z=b[B],H=this._touches[B];H&&(E._add(z),I._add(z.sub(H)),A++,b[B]=z)}if(this._touches=b,A<this._minTouches||!I.mag())return;const R=I.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(A),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Qs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,d,_){return{}}touchstart(a,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,_){const b=this._firstTwoTouches;if(!b)return;a.preventDefault();const[E,I]=b,A=Es(_,d,E),R=Es(_,d,I);if(!A||!R)return;const B=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],B,a)}touchend(a,d,_){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,I=Es(_,d,b),A=Es(_,d,E);I&&A||(this._active&&Je(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Es(m,a,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return a[_]}function ni(m,a){return Math.log(m/a)/Math.LN2}class Fh extends Qs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(ni(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ni(this._distance,_),pinchAround:d}}}function ur(m,a){return 180*m.angleWith(a)/Math.PI}class jl extends Qs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d){const _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ur(this._vector,_),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const b=ur(a,_);return Math.abs(b)<d}}function Jr(m){return Math.abs(m.y)>Math.abs(m.x)}class vc extends Qs{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Jr(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,_){const b=this._lastPoints;if(!b)return;const E=a[0].sub(b[0]),I=a[1].sub(b[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(E,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(E.y+I.y)/2*-.5})}gestureBeginsVertically(a,d,_){if(void 0!==this._valid)return this._valid;const b=a.mag()>=2,E=d.mag()>=2;if(!b&&!E)return;if(!b||!E)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=a.y>0==d.y>0;return Jr(a)&&Jr(d)&&I}}const dl={panStep:100,bearingStep:15,pitchStep:10};class fl{constructor(){const a=dl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,_=0,b=0,E=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),E=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),E=1);break;case 38:a.shiftKey?b=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?b=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:zr,zoom:d?Math.round(R)+d*(a.shiftKey?2:1):R,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-I*this._panStep],center:A.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zr(m){return m*(2-m)}const zh=4.000244140625;class No{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=a.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=u.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%zh==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=bt(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>zh?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==B&&(B=1/B);const z=d(),H=Math.pow(2,z),K="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(K*B))),"wheel"===this._type&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,E=this._easing;let I,A=!1;if("wheel"===this._type&&b&&E){const R=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),B=E(R);I=u.number(b,_,B),R<1?this._frameId||(this._frameId=!0):A=!0}else I=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:I-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=u.ease;if(this._prevEase){const _=this._prevEase,b=(u.exported.now()-_.start)/_.duration,E=_.easing(b+.01)-_.easing(b),I=.27/Math.sqrt(E*E+1e-4)*.01,A=Math.sqrt(.0729-I*I);d=u.bezier(I,A,.25,1)}return this._prevEase={start:u.exported.now(),duration:a,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class To{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class lo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,d){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xc{constructor(){this._tap=new vn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,d,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,d,_))}touchmove(a,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=d[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,a.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(a,d,_)}touchend(a,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(a,d,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bu{constructor(a,d,_){this._el=a,this._mousePan=d,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ea{constructor(a,d,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gd{constructor(a,d,_,b){this._el=a,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Cs=m=>m.zoom||m.drag||m.pitch||m.rotate;class cp extends u.Event{}class Iy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,d){const _=u.sub([],d,a);this.radius=u.length(_[2]<0?u.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){u.div(a,a,this.constants),u.normalize(a,a),u.mul$1(a,a,this.constants);const d=u.scale$2([],a,this.radius);if(d[2]>0){const _=u.scale$2([],[0,0,1],u.dot(d,[0,0,1])),b=u.scale$2([],u.normalize([],[d[0],d[1],0]),this.radius),E=u.add([],d,u.scale$2([],u.sub([],u.add([],b,_),d),2));d[0]=E[0],d[1]=E[1]}return d}}function ta(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Na{constructor(a,d){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new x(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Iy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),u.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[b,E,I]of this._listeners)b.addEventListener(E,b===u.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,d,_]of this._listeners)a.removeEventListener(d,a===u.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new He(d,a));const b=d.boxZoom=new Tt(d,a);this._add("boxZoom",b);const E=new Fr,I=new lo;d.doubleClickZoom=new To(I,E),this._add("tapZoom",E),this._add("clickZoom",I);const A=new xc;this._add("tapDragZoom",A);const R=d.touchPitch=new vc(d);this._add("touchPitch",R);const B=new Js(a),z=new ws(a);d.dragRotate=new ea(a,B,z),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new Sr(a),K=new Xo(d,a);d.dragPan=new Bu(_,H,K),this._add("mousePan",H),this._add("touchPan",K,["touchZoom","touchRotate"]);const te=new jl,ie=new Fh;d.touchZoomRotate=new Gd(_,ie,te,A),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oe(d));const ne=d.scrollZoom=new No(d,this);this._add("scrollZoom",ne,["mousePan"]);const re=d.keyboard=new fl;this._add("keyboard",re);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[G]&&d[G].enable(a[G])}_add(a,d,_){this._handlers.push({handlerName:a,handler:d,allowed:_}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,d,_){for(const b in a)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const d=[];for(const _ of a)this._el.contains(_.target)&&d.push(_);return d}handleEvent(a,d){this._updatingCamera=!0;const _="renderFrame"===a.type,b=_?void 0:a,E={needsRenderFrame:!1},I={},A={},R=a.touches?this._getMapTouches(a.touches):void 0,B=R?$e(this._el,R):_?void 0:bt(this._el,a);for(const{handlerName:K,handler:te,allowed:ie}of this._handlers){if(!te.isEnabled())continue;let ne;this._blockedByActive(A,ie,K)?te.reset():te[d||a.type]&&(ne=te[d||a.type](a,B,R),this.mergeHandlerResult(E,I,ne,K,b),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||te.isActive())&&(A[K]=te)}const z={};for(const K in this._previousActiveHandlers)A[K]||(z[K]=b);this._previousActiveHandlers=A,(Object.keys(z).length||ta(E))&&(this._changes.push([E,I,z]),this._triggerRenderFrame()),(Object.keys(A).length||ta(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=E;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(a,d,_,b,E){if(!_)return;u.extend(a,_);const I={handlerName:b,originalEvent:_.originalEvent||E};void 0!==_.zoomDelta&&(d.zoom=I),void 0!==_.panDelta&&(d.drag=I),void 0!==_.pitchDelta&&(d.pitch=I),void 0!==_.bearingDelta&&(d.rotate=I)}_applyChanges(){const a={},d={},_={};for(const[b,E,I]of this._changes)b.panDelta&&(a.panDelta=(a.panDelta||new u.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(a.around=b.around),void 0!==b.aroundCoord&&(a.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(a.pinchAround=b.pinchAround),b.noInertia&&(a.noInertia=b.noInertia),u.extend(d,E),u.extend(_,I);this._updateMapTransform(a,d,_),this._changes=[]}_updateMapTransform(a,d,_){const b=this._map,E=b.transform,I=ee=>[ee.x,ee.y,ee.z];if((ee=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!ta(a)){const ee=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",ee!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!ta(a))return void this._fireEvents(d,_,!0);let{panDelta:A,zoomDelta:R,bearingDelta:B,pitchDelta:z,around:H,aroundCoord:K,pinchAround:te}=a;E._isCameraConstrained&&(R>0&&(R=0),E._isCameraConstrained=!1),void 0!==te&&(H=te),(R||(ee=>d.drag&&!this._eventsInProgress.drag)())&&H&&(this._dragOrigin=I(E.pointCoordinate3D(H)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),H=H||b.transform.centerPoint,B&&(E.bearing+=B),z&&(E.pitch+=z),E._updateCameraState();const ie=[0,0,0];if(A)if("mercator"===E.projection.name){const ee=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H).dir),le=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H.sub(A)).dir);ie[0]=le[0]-ee[0],ie[1]=le[1]-ee[1]}else{const ee=E.pointCoordinate(H);if("globe"===E.projection.name){A=A.rotate(-E.angle);const le=E._pixelsPerMercatorPixel/E.worldSize;ie[0]=-A.x*u.mercatorScale(u.latFromMercatorY(ee.y))*le,ie[1]=-A.y*u.mercatorScale(E.center.lat)*le}else{const le=E.pointCoordinate(H.sub(A));ee&&le&&(ie[0]=le.x-ee.x,ie[1]=le.y-ee.y)}}const ne=E.zoom,re=[0,0,0];if(R){const ee=I(K||E.pointCoordinate3D(H)),le={dir:u.normalize([],u.sub([],ee,E._camera.position))};if(le.dir[2]<0){const ce=E.zoomDeltaToMovement(ee,R);u.scale$2(re,le.dir,ce)}}const G=u.add(ie,ie,re);E._translateCameraConstrained(G),R&&Math.abs(E.zoom-ne)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,_,!0)}_fireEvents(a,d,_){const b=Cs(this._eventsInProgress),E=Cs(a),I={};for(const z in a){const{originalEvent:H}=a[z];this._eventsInProgress[z]||(I[`${z}start`]=H),this._eventsInProgress[z]=a[z]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const z in I)this._fireEvent(z,I[z]);E&&this._fireEvent("move",E.originalEvent);for(const z in a){const{originalEvent:H}=a[z];this._fireEvent(z,H)}const A={};let R;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:K}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],R=d[H]||K,A[`${z}end`]=R)}for(const z in A)this._fireEvent(z,A[z]);const B=Cs(this._eventsInProgress);if(_&&(b||E)&&!B){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:R})):(this._map.fire(new u.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new u.Event(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new cp("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const eu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qd extends u.Evented{constructor(a,d){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=!1!==d.respectPrefersReducedMotion,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,_){return a=u.Point.convert(a).mult(-1),this.panTo(this.transform.center,u.extend({offset:a},d),_)}panTo(a,d,_){return this.easeTo(u.extend({center:a},d),_)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,_){return this.easeTo(u.extend({zoom:a},d),_)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,_){return this.easeTo(u.extend({bearing:a},d),_)}resetNorth(a,d){return this.rotateTo(0,u.extend({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=u.LngLatBounds.convert(a);const _=d&&d.bearing||0,b=d&&d.pitch||0,E=a.getNorthWest(),I=a.getSouthEast();return this._cameraForBounds(this.transform,E,I,_,b,d)}_extendCameraOptions(a){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=u.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const _=a.padding;a.padding={top:_,bottom:_,right:_,left:_}}return a.padding=u.extend(d,a.padding),a}_minimumAABBFrustumDistance(a,d){const _=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return _/b>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):b/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,d,_,b,E,I){const A=a.clone(),R=this._extendCameraOptions(I);A.bearing=b,A.pitch=E;const B=u.LngLat.convert(d),z=u.LngLat.convert(_),H=.5*(B.lat+z.lat),K=.5*(B.lng+z.lng),te=u.latLngToECEF(H,K),ie=u.normalize([],te),ne=u.normalize([],u.cross([],ie,[0,1,0])),re=u.cross([],ne,ie),G=[ne[0],ne[1],ne[2],0,re[0],re[1],re[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],ee=[te,u.latLngToECEF(B.lat,B.lng),u.latLngToECEF(z.lat,B.lng),u.latLngToECEF(z.lat,z.lng),u.latLngToECEF(B.lat,z.lng),u.latLngToECEF(H,B.lng),u.latLngToECEF(H,z.lng),u.latLngToECEF(B.lat,K),u.latLngToECEF(z.lat,K)];let le=u.Aabb.fromPoints(ee.map(pt=>[u.dot(ne,pt),u.dot(re,pt),u.dot(ie,pt)]));const ce=u.transformMat4([],le.center,G);0===u.squaredLength(ce)&&u.set(ce,0,0,1),u.normalize(ce,ce),u.scale$2(ce,ce,u.GLOBE_RADIUS),A.center=u.ecefToLatLng(ce);const be=A.getWorldToCameraMatrix(),Ee=u.invert(new Float64Array(16),be);le=u.Aabb.applyTransform(le,u.multiply([],be,G)),u.transformMat4(ce,ce,be);const we=.5*(le.max[2]-le.min[2]),Ne=this._minimumAABBFrustumDistance(A,le),Pe=u.scale$2([],[0,0,1],we),Ze=u.add(Pe,ce,Pe),Et=Ne+(0===A.pitch?0:u.distance(ce,Ze)),Ue=A.globeCenterInViewSpace,ut=u.sub([],ce,[Ue[0],Ue[1],Ue[2]]);u.normalize(ut,ut),u.scale$2(ut,ut,Et);const Ke=u.add([],ce,ut);u.transformMat4(Ke,Ke,Ee);const xt=u.earthRadius/u.GLOBE_RADIUS,qe=u.length(Ke),lt=u.mercatorZfromAltitude(Math.max(qe*xt-u.earthRadius,Number.EPSILON),0),Dt=Math.min(A.zoomFromMercatorZAdjusted(lt),R.maxZoom);return Dt>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=Dt,this._cameraForBounds(A,d,_,b,E,I)):{center:A.center,zoom:Dt,bearing:b,pitch:E}}queryTerrainElevation(a,d){const _=this.transform.elevation;return _?(d=u.extend({},{exaggerated:!0},d),_.getAtPoint(u.MercatorCoordinate.fromLngLat(a),null,d.exaggerated)):null}_cameraForBounds(a,d,_,b,E,I){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,d,_,b,E,I);const A=a.clone(),R=this._extendCameraOptions(I),B=A.padding;A.bearing=b,A.pitch=E;const z=u.LngLat.convert(d),H=u.LngLat.convert(_),K=new u.LngLat(z.lng,H.lat),te=new u.LngLat(H.lng,z.lat),ie=A.project(z),ne=A.project(H),re=this.queryTerrainElevation(z),G=this.queryTerrainElevation(H),ee=this.queryTerrainElevation(K),le=this.queryTerrainElevation(te),ce=[[ie.x,ie.y,Math.min(re||0,G||0,ee||0,le||0)],[ne.x,ne.y,Math.max(re||0,G||0,ee||0,le||0)]];let be=u.Aabb.fromPoints(ce);const Ee=A.getWorldToCameraMatrix(),we=u.invert(new Float64Array(16),Ee);be=u.Aabb.applyTransform(be,Ee);const Ne=u.sub([],be.max,be.min),Pe=B.left||0,Ze=B.right||0,Et=B.bottom||0,Ue=B.top||0,{left:ut,right:Ke,top:xt,bottom:qe}=R.padding,lt=.5*(Pe+Ze),Dt=.5*(Ue+Et),pt=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Pe+Ze+ut+Ke))/Ne[0],(A.height-(Et+Ue+qe+xt))/Ne[1])),R.maxZoom),It=A.scale/A.zoomScale(pt);be=new u.Aabb([be.min[0]-(ut+lt)*It,be.min[1]-(qe+Dt)*It,be.min[2]],[be.max[0]+(Ke+lt)*It,be.max[1]+(xt+Dt)*It,be.max[2]]);const un=.5*Ne[2],Rn=this._minimumAABBFrustumDistance(A,be),en=[0,0,1,0];u.transformMat4$1(en,en,Ee),u.normalize$2(en,en);const bn=u.scale$2([],en,Rn+un),Jn=u.add([],be.center,bn),Kn=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new u.Point(R.offset.x,R.offset.y):u.Point.convert(R.offset)).rotate(-u.degToRad(b));be.center[0]-=Kn.x*It,be.center[1]+=Kn.y*It,u.transformMat4(be.center,be.center,we),u.transformMat4(Jn,Jn,we);const Kt=[be.center[0],be.center[1],Jn[2]*A.pixelsPerMeter];u.scale$2(Kt,Kt,1/A.worldSize);const bi=u.lngFromMercatorX(Kt[0]),Ri=u.latFromMercatorY(Kt[1]),Li=Math.min(A._zoomFromMercatorZ(Kt[2]),R.maxZoom),Ci=new u.LngLat(bi,Ri);return A.mercatorFromTransition&&Li<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Li,this._cameraForBounds(A,d,_,b,E,I)):{center:Ci,zoom:Li,bearing:b,pitch:E}}fitBounds(a,d,_){const b=this.cameraForBounds(a,d);return this._fitInternal(b,d,_)}fitScreenCoordinates(a,d,_,b,E){const I=u.Point.convert(a),A=u.Point.convert(d),R=new u.Point(Math.min(I.x,A.x),Math.min(I.y,A.y)),B=new u.Point(Math.max(I.x,A.x),Math.max(I.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,A))return this;const z=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(B),K=this.transform.pointLocation3D(new u.Point(R.x,B.y)),te=this.transform.pointLocation3D(new u.Point(B.x,R.y)),ie=[Math.min(z.lng,H.lng,K.lng,te.lng),Math.min(z.lat,H.lat,K.lat,te.lat)],ne=[Math.max(z.lng,H.lng,K.lng,te.lng),Math.max(z.lat,H.lat,K.lat,te.lat)],re=b&&b.pitch?b.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,ie,ne,_,re,b);return this._fitInternal(G,b,E)}_fitInternal(a,d,_){return a?(delete(d=u.extend(a,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(a,d){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,I=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(b=!0,_.zoom=+a.zoom),void 0!==a.center&&(_.center=u.LngLat.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(E=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(I=!0,_.pitch=+a.pitch),null==a.padding||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new u.Event("movestart",d)).fire(new u.Event("move",d)),b&&this.fire(new u.Event("zoomstart",d)).fire(new u.Event("zoom",d)).fire(new u.Event("zoomend",d)),E&&this.fire(new u.Event("rotatestart",d)).fire(new u.Event("rotate",d)).fire(new u.Event("rotateend",d)),I&&this.fire(new u.Event("pitchstart",d)).fire(new u.Event("pitch",d)).fire(new u.Event("pitchend",d)),this.fire(new u.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(eu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return u.warnOnce(eu),this;this.stop();const b=_.zoom,E=_.pitch,I=_.bearing;_.setFreeCameraOptions(a);const A=b!==_.zoom,R=E!==_.pitch,B=I!==_.bearing;return this.fire(new u.Event("movestart",d)).fire(new u.Event("move",d)),A&&this.fire(new u.Event("zoomstart",d)).fire(new u.Event("zoom",d)).fire(new u.Event("zoomend",d)),B&&this.fire(new u.Event("rotatestart",d)).fire(new u.Event("rotate",d)).fire(new u.Event("rotateend",d)),R&&this.fire(new u.Event("pitchstart",d)).fire(new u.Event("pitch",d)).fire(new u.Event("pitchend",d)),this.fire(new u.Event("moveend",d)),this}easeTo(a,d){this._stop(!1,a.easeId),(!1===(a=u.extend({offset:[0,0],duration:500,easing:u.ease},a)).animate||this._prefersReducedMotion(a))&&(a.duration=0);const _=this.transform,b=this.getZoom(),E=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in a?+a.zoom:b,B="bearing"in a?this._normalizeBearing(a.bearing,E):E,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,K=u.Point.convert(a.offset);let te,ie,ne;if("globe"===_.projection.name){const Pe=u.MercatorCoordinate.fromLngLat(_.center),Ze=K.rotate(-_.angle);Pe.x+=Ze.x/_.worldSize,Pe.y+=Ze.y/_.worldSize;const Et=Pe.toLngLat(),Ue=u.LngLat.convert(a.center||Et);this._normalizeCenter(Ue),te=_.centerPoint.add(Ze),ie=new u.Point(Pe.x,Pe.y).mult(_.worldSize),ne=new u.Point(u.mercatorXfromLng(Ue.lng),u.mercatorYfromLat(Ue.lat)).mult(_.worldSize).sub(ie)}else{te=_.centerPoint.add(K);const Pe=_.pointLocation(te),Ze=u.LngLat.convert(a.center||Pe);this._normalizeCenter(Ze),ie=_.project(Pe),ne=_.project(Ze).sub(ie)}const re=_.zoomScale(R-b);let G,ee;a.around&&(G=u.LngLat.convert(a.around),ee=_.locationPoint(G));const le=this._zooming||R!==b,ce=this._rotating||E!==B,be=this._pitching||z!==I,Ee=!_.isPaddingEqual(H),we=Pe=>Ze=>{if(le&&(Pe.zoom=u.number(b,R,Ze)),ce&&(Pe.bearing=u.number(E,B,Ze)),be&&(Pe.pitch=u.number(I,z,Ze)),Ee&&(Pe.interpolatePadding(A,H,Ze),te=Pe.centerPoint.add(K)),G)Pe.setLocationAtPoint(G,ee);else{const Et=Pe.zoomScale(Pe.zoom-b),Ue=R>b?Math.min(2,re):Math.max(.5,re),ut=Math.pow(Ue,1-Ze),Ke=Pe.unproject(ie.add(ne.mult(Ze*ut)).mult(Et));Pe.setLocationAtPoint(Pe.renderWorldCopies?Ke.wrap():Ke,te)}return a.preloadOnly||this._fireMoveEvents(d),Pe};if(a.preloadOnly){const Pe=this._emulate(we,a.duration,_);return this._preloadTiles(Pe),this}const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=ce,this._pitching=be,this._padding=Ee,this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,Ne),this._ease(we(_),Pe=>{_.recenterOnTerrain(),this._afterEase(d,Pe)},a),this}_prepareEase(a,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new u.Event("movestart",a)),this._zooming&&!_.zooming&&this.fire(new u.Event("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new u.Event("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new u.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new u.Event("move",a)),this._zooming&&this.fire(new u.Event("zoom",a)),this._rotating&&this.fire(new u.Event("rotate",a)),this._pitching&&this.fire(new u.Event("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new u.Event("zoomend",a)),b&&this.fire(new u.Event("rotateend",a)),E&&this.fire(new u.Event("pitchend",a)),this.fire(new u.Event("moveend",a))}flyTo(a,d){if(this._prefersReducedMotion(a)){const pt=u.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pt,d)}this.stop(),a=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},a);const _=this.transform,b=this.getZoom(),E=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in a?u.clamp(+a.zoom,_.minZoom,_.maxZoom):b,B="bearing"in a?this._normalizeBearing(a.bearing,E):E,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,K=_.zoomScale(R-b),te=u.Point.convert(a.offset);let ie=_.centerPoint.add(te);const ne=_.pointLocation(ie),re=u.LngLat.convert(a.center||ne);this._normalizeCenter(re);const G=_.project(ne),ee=_.project(re).sub(G);let le=a.curve;const ce=Math.max(_.width,_.height),be=ce/K,Ee=ee.mag();if("minZoom"in a){const pt=u.clamp(Math.min(a.minZoom,b,R),_.minZoom,_.maxZoom),It=ce/_.zoomScale(pt-b);le=Math.sqrt(It/Ee*2)}const we=le*le;function Ne(pt){const It=(be*be-ce*ce+(pt?-1:1)*we*we*Ee*Ee)/(2*(pt?be:ce)*we*Ee);return Math.log(Math.sqrt(It*It+1)-It)}function Pe(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Ze(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const Et=Ne(0);let Ue=function(pt){return Ze(Et)/Ze(Et+le*pt)},ut=function(pt){return ce*((Ze(Et)*(Pe(It=Et+le*pt)/Ze(It))-Pe(Et))/we)/Ee;var It},Ke=(Ne(1)-Et)/le;if(Math.abs(Ee)<1e-6||!isFinite(Ke)){if(Math.abs(ce-be)<1e-6)return this.easeTo(a,d);const pt=be<ce?-1:1;Ke=Math.abs(Math.log(be/ce))/le,ut=function(){return 0},Ue=function(It){return Math.exp(pt*le*It)}}a.duration="duration"in a?+a.duration:1e3*Ke/("screenSpeed"in a?+a.screenSpeed/le:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const xt=E!==B,qe=z!==I,lt=!_.isPaddingEqual(H),Dt=pt=>It=>{const un=It*Ke,Rn=1/Ue(un);pt.zoom=1===It?R:b+pt.scaleZoom(Rn),xt&&(pt.bearing=u.number(E,B,It)),qe&&(pt.pitch=u.number(I,z,It)),lt&&(pt.interpolatePadding(A,H,It),ie=pt.centerPoint.add(te));const en=1===It?re:pt.unproject(G.add(ee.mult(ut(un))).mult(Rn));return pt.setLocationAtPoint(pt.renderWorldCopies?en.wrap():en,ie),pt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(d),pt};if(a.preloadOnly){const pt=this._emulate(Dt,a.duration,_);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=xt,this._pitching=qe,this._padding=lt,this._prepareEase(d,!1),this._ease(Dt(_),()=>this._afterEase(d),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,d,_){!1===_.animate||0===_.duration?(a(1),d()):(this._easeStart=u.exported.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,d){a=u.wrap(a,-180,180);const _=Math.abs(a-d);return Math.abs(a-360-d)<_&&(a-=360),Math.abs(a+360-d)<_&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=a.lng-d.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&u.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,d,_){const b=Math.ceil(15*d/1e3),E=[],I=a(_.clone());for(let A=0;A<=b;A++){const R=I(A/b);E.push(R.clone())}return E}}class Qt{constructor(a={}){this.options=a,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const d=this.options&&this.options.compact;return this._map=a,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Re("button","mapboxgl-ctrl-attrib-button",this._container),Re("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Re("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const _=this._map._getUIString(`AttributionControl.${d}`);a.setAttribute("aria-label",_),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(a){const _=d.reduce((b,E,I)=>(E.value&&(b+=`${E.key}=${E.value}${I<d.length-1?"&":""}`),b),"?");a.href=`${u.config.FEEDBACK_URL}/${_}#${Ul(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const E=d[b];if(E.used){const I=E.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((b,E)=>b.length-E.length),a=a.filter((b,E)=>{for(let I=E+1;I<a.length;I++)if(a[I].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class up{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Re("div","mapboxgl-ctrl");const d=Re("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const d in a){const _=a[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class hp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const b of _)if(b.id===a)return void(b.cancelled=!0)}run(a=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vu(m,a,d){if(m=new u.LngLat(m.lng,m.lat),a){const _=new u.LngLat(m.lng-360,m.lat),b=new u.LngLat(m.lng+360,m.lat),E=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),I=d.locationPoint(m).distSqr(a),A=a.x<0||a.y<0||a.x>d.width||a.y>d.height;d.locationPoint(_).distSqr(a)<I&&(A||Math.abs(_.lng-d.center.lng)<E)?m=_:d.locationPoint(b).distSqr(a)<I&&(A||Math.abs(b.lng-d.center.lng)<E)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ht extends u.Evented{constructor(a,d){if(super(),(a instanceof u.window.HTMLElement||d)&&(a=u.extend({element:a},d)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=u.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Re("div");const b=41,E=27,I=yt("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),A=yt("radialGradient",{id:"shadowGradient"},yt("defs",{},I));yt("stop",{offset:"10%","stop-opacity":.4},A),yt("stop",{offset:"100%","stop-opacity":.05},A),yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=u.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in tu)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=u.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const d=a.code,_=a.charCode||a.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(a){const d=a.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,d=this._pos;if(!a||!d)return!1;const _=a.unproject(d),b=a.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(_)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const d=this._pos;if(!d||d.x<0||d.x>a.transform.width||d.y<0||d.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(d);let b;a._showingGlobe()&&u.isLngLatBehindGlobe(a.transform,this._lngLat)?b=0:(b=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${tu[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${d.x}px,${d.y}px)\n        `}_calculateXYTransform(){const a=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!a||"map"!==_)return"";if(!d._showingGlobe()){const R=d.getPitch();return R?`rotateX(${R}deg)`:""}const b=u.radToDeg(u.globeTiltAtLngLat(d.transform,this._lngLat)),E=a.sub(u.globeCenterToScreenPoint(d.transform)),I=Math.abs(E.x)+Math.abs(E.y);if(0===I)return"";const A=b/I;return`rotateX(${-E.y*A}deg) rotateY(${E.x*A}deg)`}_calculateZTransform(){const a=this._pos,d=this._map;if(!d||!a)return"";let _=0;const b=this.getRotationAlignment();if("map"===b)if(d._showingGlobe()){const E=d.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=d.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);_=u.radToDeg(Math.atan2(I.y,I.x))-90}else _=-d.getBearing();else if("horizon"===b){const E=u.smoothstep(4,6,d.getZoom()),I=u.globeCenterToScreenPoint(d.transform);I.y+=E*d.transform.height;const A=a.sub(I),R=u.radToDeg(Math.atan2(A.y,A.x));_=(R>90?R-270:R+90)*(1-E)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){u.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Vu(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===a?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=u.Point.convert(a),this._update(),this}_onMove(a){const d=this._map;if(!d)return;const _=this._pointerdownPos,b=this._positionDelta;if(_&&b){if(!this._isDragging){const E=this._clickTolerance||d._clickTolerance;if(a.point.dist(_)<E)return;this._isDragging=!0}this._pos=a.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(a){const d=this._map,_=this._pos;d&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const d=this._map;return d&&(a?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const dp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ay=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sg(m=new u.Point(0,0),a="bottom"){if("number"==typeof m){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new u.Point(0,m);case"top-left":return new u.Point(d,d);case"top-right":return new u.Point(-d,d);case"bottom":return new u.Point(0,-m);case"bottom-left":return new u.Point(d,-d);case"bottom-right":return new u.Point(-d,-d);case"left":return new u.Point(m,0);case"right":return new u.Point(-m,0)}return new u.Point(0,0)}return m instanceof u.Point||Array.isArray(m)?u.Point.convert(m):u.Point.convert(m[a]||[0,0])}class fp{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const d=u.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,d,_){this._start=this.getValue(d),this._end=a,this._startTime=d,this._endTime=d+_}}const Zd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Wd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Py={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ry{constructor(a,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Js({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new ws({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(a,d){this.mouseRotate.mousedown(a,d),this.mousePitch&&this.mousePitch.mousedown(a,d),Nt()}move(a,d){const _=this.map,b=this.mouseRotate.mousemoveWindow(a,d),E=b&&b.bearingDelta;if(E&&_.setBearing(_.getBearing()+E),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,d),A=I&&I.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){kt(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(u.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),bt(this.element,a)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,bt(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=$e(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=$e(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const pp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},pl={maxWidth:100,unit:"metric"},Fa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Uu={version:u.version,supported:Me,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends qd{constructor(m){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(m=u.extend({},Wd,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(m.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new hp,this._domRenderTaskQueue=new hp,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},Zd,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=u.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Na(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new hl("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,u.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Qt({customAttribution:m.customAttribution})),this._logoControl=new up,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new u.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new u.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(m,a){if(void 0===a&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[a];return-1!==a.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new u.Event("movestart",m)).fire(new u.Event("move",m)),this.fire(new u.Event("resize",m)),a&&this.fire(new u.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(u.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?u.window.navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(a=>"auto"===a?u.window.navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,a=m.projection.name;let d;"globe"===a&&m.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),d=!0):"mercator"===a&&m.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;if(a="globe"===m.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(u.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(u.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,d){if("mouseenter"===m||"mouseover"===m){let _=!1;const b=I=>{const A=a.filter(B=>this.getLayer(B)),R=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];R.length?_||(_=!0,d.call(this,new U(m,this,I.originalEvent,{features:R}))):_=!1},E=()=>{_=!1};return{layers:new Set(a),listener:d,delegates:{mousemove:b,mouseout:E}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const b=I=>{const A=a.filter(R=>this.getLayer(R));(A.length?this.queryRenderedFeatures(I.point,{layers:A}):[]).length?_=!0:_&&(_=!1,d.call(this,new U(m,this,I.originalEvent)))},E=I=>{_&&(_=!1,d.call(this,new U(m,this,I.originalEvent)))};return{layers:new Set(a),listener:d,delegates:{mousemove:b,mouseout:E}}}{const _=b=>{const E=a.filter(A=>this.getLayer(A)),I=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];I.length&&(b.features=I,d.call(this,b),delete b.features)};return{layers:new Set(a),listener:d,delegates:{[m]:_}}}}on(m,a,d){if(void 0===d)return super.on(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,a,d){if(void 0===d)return super.once(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,d);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,a,d){if(void 0===d)return super.off(m,a);a=new Set(Array.isArray(a)?a:[a]);const _=(E,I)=>{if(E.size!==I.size)return!1;for(const A of E)if(!I.has(A))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(E=>{for(let I=0;I<E.length;I++){const A=E[I];if(A.listener===d&&_(A.layers,a)){for(const R in A.delegates)this.off(R,A.delegates[R]);return E.splice(I,1),this}}})(b),this}queryRenderedFeatures(m,a){return this.style?(void 0!==a||void 0===m||m instanceof u.Point||Array.isArray(m)||(a=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(m,a){return this.style.querySourceFeatures(m,a)}isPointOnSurface(m){const{name:a}=this.transform.projection;return"globe"!==a&&"mercator"!==a&&u.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(u.Point.convert(m))}setStyle(m,a){return!1!==(a=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(null==a)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Ut(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ut(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,a){if("string"==typeof m){const d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,u.ResourceType.Style);u.getJSON(_,(b,E)=>{b?this.fire(new u.ErrorEvent(b)):E&&this._updateDiff(E,a)})}else"object"==typeof m&&this._updateDiff(m,a)}_updateDiff(m,a){try{this.style.setState(m)&&this._update(!0)}catch(d){u.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(m,a){return this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const a in m){const d=m[a]._tiles;for(const _ in d){const b=d[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(m,a,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,a,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:E,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap){const{width:A,height:R,data:B}=u.exported.getImageData(a);this.style.addImage(m,{data:new u.RGBAImage({width:A,height:R},B),pixelRatio:d,stretchX:b,stretchY:E,content:I,sdf:_,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=a,B=a;this.style.addImage(m,{data:new u.RGBAImage({width:A,height:R},new Uint8Array(B.data)),pixelRatio:d,stretchX:b,stretchY:E,content:I,sdf:_,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,a){const d=this.style.getImage(m);if(!d)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap?u.exported.getImageData(a):a,{width:b,height:E}=_;void 0!==b&&void 0!==E?b===d.data.width&&E===d.data.height?(d.data.replace(_.data,!(a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})\n                must be that same as the previous version of the image\n                (${d.data.width}, ${d.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){u.getImage(this._requestManager.transformRequest(m,u.ResourceType.Image),(d,_)=>{a(d,_ instanceof u.window.HTMLImageElement?u.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,a){return this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)}moveLayer(m,a){return this.style.moveLayer(m,a),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,a,d){return this.style.setLayerZoomRange(m,a,d),this._update(!0)}setFilter(m,a,d={}){return this.style.setFilter(m,a,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,a,d,_={}){return this.style.setPaintProperty(m,a,d,_),this._update(!0)}getPaintProperty(m,a){return this.style.getPaintProperty(m,a)}setLayoutProperty(m,a,d,_={}){return this.style.setLayoutProperty(m,a,d,_),this._update(!0)}getLayoutProperty(m,a){return this.style.getLayoutProperty(m,a)}setLight(m,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(m),this.transform):0}setFeatureState(m,a){return this.style.setFeatureState(m,a),this._update()}removeFeatureState(m,a){return this.style.removeFeatureState(m,a),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let d,_,b,E=this._container;for(;E&&(!_||!b);){const I=u.window.getComputedStyle(E).transform;I&&"none"!==I&&(d=I.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(_=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),E=E.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=b?Math.abs(a/b):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Re("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Re("div","mapboxgl-canvas-container",m);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Re("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=Re("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=Re("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const d=u.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);-1!==a&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const m=u.extend({},Me.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",m),d=a||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);d?(this._useWebGL2&&!a&&u.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),u.storeAuthState(d,!0),this.painter=new ll(d,this.transform,!!a),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(d)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;const d=this.painter.context.extTimerQuery,_=u.exported.now();if(this.listens("gpu-timing-frame")&&(a=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,B=u.exported.now(),z=new u.EvaluationParameters(A,{now:B,fadeDuration:b,pitch:R,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const A=u.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,a),setTimeout(()=>{const R=d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(a),this.fire(new u.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),u.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new u.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(E=this._updateAverageElevation(_,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const I=Math.abs(_-b);if(I>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,m,300)}else if(I>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===u.AUTH_ERR_MSG||401===m.status)){const a=this.painter.context.gl;u.storeAuthState(a,!1),this._logoControl instanceof up&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function b(E){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,E,0);const I=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,I),I}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),a.canvasCopies.map(b),a.timeStamps)}_canvasPixelComparison(m,a,d){let _=d[1]-d[0];const b=m.length/4;for(let E=0;E<a.length;E++){const I=a[E];let A=0;for(let R=0;R<I.length;R+=4)I[R]===m[R]&&I[R+1]===m[R+1]&&I[R+2]===m[R+2]&&I[R+3]===m[R+3]&&(A+=1);_+=(d[E+2]-d[E+1])*(1-A/b)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1),u.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=u.exported.frame(a=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(a)}))}_preloadTiles(m){const a=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(a,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===u.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,a){u.setCacheLimits(m,a)}get version(){return u.version}},NavigationControl:class{constructor(m){this.options=u.extend({},Py,m),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Re("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Re("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:a}):d.resetNorth({},{originalEvent:a}))}),this._compassIcon=Re("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),d=a===m.getMaxZoom(),_=a===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ry(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const d=Re("button",m,this._container);return d.type="button",d.addEventListener("click",a),d}_setButtonTitle(m,a){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends u.Evented{constructor(m){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},pp,m),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Oa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(d=>a("denied"!==d.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),d=m.coords;return!!a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",m)),this._finish()}}_updateCamera(m){const a=new u.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),b=u.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new u.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=u.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Re("button","mapboxgl-ctrl-geolocate",this._container),Re("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Re("div","mapboxgl-user-location"),this._dotElement.appendChild(Re("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Re("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ht({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Re("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ht({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qt,ScaleControl:class{constructor(m){this.options=u.extend({},pl,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,d=a._containerHeight/2,_=a._containerWidth/2-m/2,b=a.unproject([_,d]),E=a.unproject([_+m,d]),I=b.distanceTo(E);if("imperial"===this.options.unit){const A=3.2808*I;A>5280?this._setScale(m,A/5280,"mile"):this._setScale(m,A,"foot")}else"nautical"===this.options.unit?this._setScale(m,I/1852,"nautical-mile"):I>=1e3?this._setScale(m,I/1e3,"kilometer"):this._setScale(m,I,"meter")}_setScale(m,a,d){this._map._requestDomTask(()=>{const _=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let A=E/I;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(A),I*A}(a),b=_/a;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==d?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(_):`${_}&nbsp;${Fa[d]}`,this._container.style.width=m*b+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof u.window.HTMLElement?this._container=m.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Re("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Re("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(m){super(),this.options=u.extend(Object.create(dp),m),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=u.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(u.window.document.createTextNode(m))}setHTML(m){const a=u.window.document.createDocumentFragment(),d=u.window.document.createElement("body");let _;for(d.innerHTML=m;_=d.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Re("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const d=this._closeButton=Re("button","mapboxgl-popup-close-button",a);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,d=this._container,_=this._pos;if(!a||!d||!_)return"bottom";const b=d.offsetWidth,E=d.offsetHeight,I=_.x<b/2,A=_.x>a.transform.width-b/2;if(_.y+m<E)return I?"top-left":A?"top-right":"top";if(_.y>a.transform.height-E){if(I)return"bottom-left";if(A)return"bottom-right"}return I?"left":A?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,d=this._content;if(!a||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=Re("div","mapboxgl-popup",a.getContainer()),this._tip=Re("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vu(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m?m:a.project(this._lngLat),E=sg(this.options.offset),I=this._anchor=this._getAnchor(E.y),A=sg(this.options.offset,I),R=b.add(A).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${tu[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&a._showingGlobe()){const b=u.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Ay);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Ht,Style:Ut,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.Point,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:cl,Evented:u.Evented,config:u.config,prewarm:function(){wa().acquire(jo)},clearPrewarmedResources:function(){const m=Mr;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(jo),Mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(m){u.config.ACCESS_TOKEN=m},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(m){u.config.API_URL=m},get workerCount(){return Lr.workerCount},set workerCount(m){Lr.workerCount=m},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){u.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){u.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return Uu}),gt}()},681:function(Zt){var gt;gt=function(){var qt="",_e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function gt(Me){return Me.match(_e)||[]}function Te(Me){return{language:(Me=gt(Me))[1]||qt,extlang:Me[2]||qt,script:Me[3]||qt,region:Me[4]||qt}}function u(Me,Le,Ae){Object.defineProperty(Me,Le,{value:Ae,enumerable:!0})}function Q(Me,Le,Ae){function Re(yt){return gt(yt)[Me]||qt}u(Re,"pattern",Le),u(Te,Ae,Re)}return Q(1,/^[a-zA-Z]{2,3}$/,"language"),Q(2,/^[a-zA-Z]{3}$/,"extlang"),Q(3,/^[a-zA-Z]{4}$/,"script"),Q(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),u(Te,"split",function Ve(Me){return gt(Me).filter(function(Le,Ae){return Le&&Ae})}),Te},Zt.exports?Zt.exports=gt():this.subtag=gt()},28:(Zt,qt,_e)=>{"use strict";var gt=_e(603);Zt.exports=gt,typeof window<"u"&&(window.Suggestions=gt)},331:Zt=>{"use strict";var qt=function(_e){return this.component=_e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,_e.el.parentNode.insertBefore(this.wrapper,_e.el.nextSibling),this};qt.prototype.show=function(){this.element.style.display="block"},qt.prototype.hide=function(){this.element.style.display="none"},qt.prototype.add=function(_e){this.items.push(_e)},qt.prototype.clear=function(){this.items=[],this.active=0},qt.prototype.isEmpty=function(){return!this.items.length},qt.prototype.isVisible=function(){return"block"===this.element.style.display},qt.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var _e=0;_e<this.items.length;_e++)this.drawItem(this.items[_e],this.active===_e);this.show()}else this.hide()},qt.prototype.drawItem=function(_e,gt){var Ve=document.createElement("li"),Te=document.createElement("a");gt&&(Ve.className+=" active"),Te.innerHTML=_e.string,Ve.appendChild(Te),this.element.appendChild(Ve),Ve.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Ve.addEventListener("mouseup",function(){this.handleMouseUp.call(this,_e)}.bind(this))},qt.prototype.handleMouseUp=function(_e){this.selectingListItem=!1,this.component.value(_e.original),this.clear(),this.draw()},qt.prototype.move=function(_e){this.active=_e,this.draw()},qt.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},qt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},qt.prototype.drawError=function(_e){var gt=document.createElement("li");gt.innerHTML=_e,this.element.appendChild(gt),this.show()},Zt.exports=qt},603:(Zt,qt,_e)=>{"use strict";var gt=_e(498),Ve=_e(424),Te=_e(331),u=function(Q,Me,Le){return this.options=gt({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Le=Le||{}),this.el=Q,this.data=Me||[],this.list=new Te(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(Ae){this.handleKeyUp(Ae.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(Ae){this.handleKeyDown(Ae)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(Ae){this.handlePaste(Ae)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};u.prototype.handleKeyUp=function(Q){40===Q||38===Q||27===Q||13===Q||9===Q||this.handleInputChange(this.el.value)},u.prototype.handleKeyDown=function(Q){switch(Q.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&Q.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},u.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},u.prototype.handlePaste=function(Q){if(Q.clipboardData)this.handleInputChange(Q.clipboardData.getData("Text"));else{var Me=this;setTimeout(function(){Me.handleInputChange(Q.target.value)},100)}},u.prototype.handleInputChange=function(Q){this.query=this.normalize(Q),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Me){for(var Le=0;Le<Me.length&&(this.list.add(Me[Le]),Le!==this.options.limit-1);Le++);this.list.draw()}.bind(this))},u.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},u.prototype.update=function(Q){this.data=Q,this.handleKeyUp()},u.prototype.clear=function(){this.data=[],this.list.clear()},u.prototype.normalize=function(Q){return Q.toLowerCase()},u.prototype.match=function(Q,Me){return Q.indexOf(Me)>-1},u.prototype.value=function(Q){if(this.selected=Q,this.el.value=this.getItemValue(Q),document.createEvent){var Me=document.createEvent("HTMLEvents");Me.initEvent("change",!0,!1),this.el.dispatchEvent(Me)}else this.el.fireEvent("onchange")},u.prototype.getCandidates=function(Q){var Me={pre:"<strong>",post:"</strong>",extract:function(Ae){return this.getItemValue(Ae)}.bind(this)};Q(this.options.filter?Ve.filter(this.query,this.data,Me).map(function(Ae){return{original:Ae.original,string:this.render(Ae.original,Ae.string)}}.bind(this)):this.data.map(function(Ae){return{original:Ae,string:this.render(Ae)}}.bind(this)))},u.prototype.getItemValue=function(Q){return Q},u.prototype.render=function(Q,Me){if(Me)return Me;for(var Le=this.getItemValue(Q.original?Q.original:Q),Ae=this.normalize(Le),Re=Ae.lastIndexOf(this.query);Re>-1;){var yt=Re+this.query.length;Le=Le.slice(0,Re)+"<strong>"+Le.slice(Re,yt)+"</strong>"+Le.slice(yt),Re=Ae.slice(0,Re).lastIndexOf(this.query)}return Le},u.prototype.renderError=function(Q){this.list.drawError(Q)},Zt.exports=u},498:Zt=>{Zt.exports=function _e(){for(var gt={},Ve=0;Ve<arguments.length;Ve++){var Te=arguments[Ve];for(var u in Te)qt.call(Te,u)&&(gt[u]=Te[u])}return gt};var qt=Object.prototype.hasOwnProperty},630:(Zt,qt,_e)=>{"use strict";_e.d(qt,{x0:()=>u});let u=(Q=21)=>crypto.getRandomValues(new Uint8Array(Q)).reduce((Me,Le)=>Me+((Le&=63)<36?Le.toString(36):Le<62?(Le-26).toString(36).toUpperCase():Le>62?"-":"_"),"")}},Zt=>{Zt(Zt.s=724)}]);