(self.webpackChunkbuscaPersonaFree=self.webpackChunkbuscaPersonaFree||[]).push([[179],{406:(Zt,qt,ve)=>{"use strict";var gt=ve(564),Ue=ve(498),u="\n  ",Q={};function Ie(Ot){var he=Array.isArray(Ot);return function(Ge){var ke=Le(Q.plainArray,Ge);if(ke)return ke;if(he&&Ge.length!==Ot.length)return"an array with "+Ot.length+" items";for(var at=0;at<Ge.length;at++)if(ke=Le(he?Ot[at]:Ot,Ge[at]))return[at].concat(ke)}}function Le(Ot,he){if(null!=he||Ot.hasOwnProperty("__required")){var tt=Ot(he);if(tt)return Array.isArray(tt)?tt:[tt]}}function Ae(Ot,he){var tt=Ot.length,bt=Ot[tt-1],Ge=Ot.slice(0,tt-1);return 0===Ge.length&&(Ge=["value"]),he=Ue(he,{path:Ge}),"function"==typeof bt?bt(he):Vt(he,function yt(Ot){return"must be "+function Yt(Ot){return/^an? /.test(Ot)?Ot:/^[aeiou]/i.test(Ot)?"an "+Ot:/^[a-z]/i.test(Ot)?"a "+Ot:Ot}(Ot)+"."}(bt))}function Vt(Ot,he){return(St(Ot.path)?"Item at position ":"")+Ot.path.join(".")+" "+he}function St(Ot){return"number"==typeof Ot[Ot.length-1]||"number"==typeof Ot[0]}Q.assert=function(Ot,he){return he=he||{},function(tt){var bt=Le(Ot,tt);if(bt){var Ge=Ae(bt,he);throw he.apiName&&(Ge=he.apiName+": "+Ge),new Error(Ge)}}},Q.shape=function(he){var tt=function Ft(Ot){return Object.keys(Ot||{}).map(function(he){return{key:he,value:Ot[he]}})}(he);return function(Ge){var ke=Le(Q.plainObject,Ge);if(ke)return ke;for(var at,Nt=[],Wt=0;Wt<tt.length;Wt++)(ke=Le(tt[Wt].value,Ge[at=tt[Wt].key]))&&Nt.push([at].concat(ke));return Nt.length<2?Nt[0]:function(kt){Nt=Nt.map(function(qi){return"- "+qi[0]+": "+Ae(qi,kt).split("\n").join(u)});var Tn=kt.path.join(".");return"The following properties"+("value"===Tn?"":" of "+Tn)+" have invalid values:"+u+Nt.join(u)}}},Q.strictShape=function(he){var tt=Q.shape(he);return function(Ge){var ke=tt(Ge);if(ke)return ke;var at=Object.keys(Ge).reduce(function(ze,Nt){return void 0===he[Nt]&&ze.push(Nt),ze},[]);return 0!==at.length?function(){return"The following keys are invalid: "+at.join(", ")}:void 0}},Q.arrayOf=function(he){return Ie(he)},Q.tuple=function(){return Ie(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},Q.required=function(he){function tt(bt){return null==bt?function(Ge){return Vt(Ge,St(Ge.path)?"cannot be undefined/null.":"is required.")}:he.apply(this,arguments)}return tt.__required=!0,tt},Q.oneOfType=function(){var he=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(bt){var Ge=he.map(function(ke){return Le(ke,bt)}).filter(Boolean);if(Ge.length===he.length)return Ge.every(function(ke){return 1===ke.length&&"string"==typeof ke[0]})?function Re(Ot){return Ot.length<2?Ot[0]:2===Ot.length?Ot.join(" or "):Ot.slice(0,-1).join(", ")+", or "+Ot.slice(-1)}(Ge.map(function(ke){return ke[0]})):Ge.reduce(function(ke,at){return at.length>ke.length?at:ke})}},Q.equal=function(he){return function(bt){if(bt!==he)return JSON.stringify(he)}},Q.oneOf=function(){var tt=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(bt){return Q.equal(bt)});return Q.oneOfType.apply(this,tt)},Q.range=function(he){var tt=he[0],bt=he[1];return function(ke){if(Le(Q.number,ke)||ke<tt||ke>bt)return"number between "+tt+" & "+bt+" (inclusive)"}},Q.any=function(){},Q.boolean=function(he){if("boolean"!=typeof he)return"boolean"},Q.number=function(he){if("number"!=typeof he)return"number"},Q.plainArray=function(he){if(!Array.isArray(he))return"array"},Q.plainObject=function(he){if(!gt(he))return"object"},Q.string=function(he){if("string"!=typeof he)return"string"},Q.func=function(he){if("function"!=typeof he)return"function"},Q.validate=Le,Q.processMessage=Ae,Zt.exports=Q},564:Zt=>{"use strict";var qt=Object.prototype.toString;Zt.exports=function(ve){var gt;return"[object Object]"===qt.call(ve)&&(null===(gt=Object.getPrototypeOf(ve))||gt===Object.getPrototypeOf({}))}},805:(Zt,qt,ve)=>{"use strict";var gt=ve(630).x0;function Ue(Me){this.origin=Me.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=Me.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=Me,this.send=this.send.bind(this),this.countries=Me.countries?Me.countries.split(","):null,this.types=Me.types?Me.types.split(","):null,this.bbox=Me.bbox?Me.bbox:null,this.language=Me.language?Me.language.split(","):null,this.limit=Me.limit?+Me.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(Me),this.eventQueue=new Array,this.flushInterval=Me.flushInterval||1e3,this.maxQueueSize=Me.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Ue.prototype={select:function(Me,u){var Q=this.getSelectedIndex(Me,u),Ie=this.getEventPayload("search.select",u);if(Ie.resultIndex=Q,Ie.resultPlaceName=Me.place_name,Ie.resultId=Me.id,(Q!==this.lastSentIndex||Ie.queryString!==this.lastSentInput)&&-1!=Q&&(this.lastSentIndex=Q,this.lastSentInput=Ie.queryString,Ie.queryString))return this.push(Ie)},start:function(Me){var u=this.getEventPayload("search.start",Me);if(u.queryString)return this.push(u)},keyevent:function(Me,u){if(Me.key&&!Me.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(Me.keyCode)){var Q=this.getEventPayload("search.keystroke",u);if(Q.lastAction=Me.key,Q.queryString)return this.push(Q)}},send:function(Me,u){if(!this.enableEventLogging)return u?u():void 0;var Q=this.getRequestOptions(Me);this.request(Q,function(Ie){return Ie?this.handleError(Ie,u):u?u():void 0}.bind(this))},getRequestOptions:function(Me){return Array.isArray(Me)||(Me=[Me]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)}},getEventPayload:function(Me,u){var Q;Q=u.options.proximity?"object"==typeof u.options.proximity?[u.options.proximity.longitude,u.options.proximity.latitude]:"ip"===u.options.proximity?[999,999]:u.options.proximity:null;var Ie=u._map?u._map.getZoom():void 0,Le={event:Me,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:u.options.autocomplete,fuzzyMatch:u.options.fuzzyMatch,proximity:Q,limit:u.options.limit,routing:u.options.routing,worldview:u.options.worldview,mapZoom:Ie,keyboardLocale:this.locale};return Le.queryString="search.select"===Me?u.inputString:"search.select"!=Me&&u._inputEl?u._inputEl.value:u.inputString,Le},request:function(Me,u){var Q=new XMLHttpRequest;for(var Ie in Q.onreadystatechange=function(){if(4==this.readyState)return u(204==this.status?null:this.statusText)},Q.open(Me.method,Me.host+"/"+Me.path,!0),Me.headers)Q.setRequestHeader(Ie,Me.headers[Ie]);Q.send(Me.body)},handleError:function(Me,u){if(u)return u(Me)},generateSessionID:function(){return gt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(Me,u){if(u._typeahead){var Ie=Me.id;return u._typeahead.data.map(function(Re){return Re.id}).indexOf(Ie)}},shouldEnableLogging:function(Me){return!(!1===Me.enableEventLogging||Me.origin&&"https://api.mapbox.com"!==Me.origin||Me.localGeocoder||Me.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(Me,u){this.eventQueue.push(Me),(this.eventQueue.length>=this.maxQueueSize||u)&&this.flush()},remove:function(){this.flush()}},Zt.exports=Ue},280:Zt=>{Zt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},272:Zt=>{function qt(){}qt.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const ve={enableHighAccuracy:!0};return new Promise(function(gt,Ue){window.navigator.geolocation.getCurrentPosition(gt,Ue,ve)})}},Zt.exports=qt},904:(Zt,qt,ve)=>{"use strict";var gt=ve(28),Ue=ve(220),Me=ve(498),u=ve(16).EventEmitter,Q=ve(280),Ie=ve(658),Le=ve(725),Ae=ve(805),Re=ve(251),yt=ve(681),Yt=ve(272),Vt=ve(485);function Ot(he){this._eventEmitter=new u,this.options=Me({},this.options,he),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Yt}Ot.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(he){return he.place_name},render:function(he){var tt=he.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+tt[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+tt.splice(1,tt.length).join(",")+"</div></div>"}},addTo:function(he){function tt(bt,Ge){if(!document.body.contains(Ge))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ke=bt.onAdd();Ge.appendChild(ke)}if(he._controlContainer)he.addControl(this);else if(he instanceof HTMLElement)tt(this,he);else{if("string"!=typeof he)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const bt=document.querySelectorAll(he);if(0===bt.length)throw new Error("Element ",he,"not found.");if(bt.length>1)throw new Error("Geocoder can only be added to a single html element");tt(this,bt[0])}}},onAdd:function(he){if(he&&"string"!=typeof he&&(this._map=he),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Le(Ie({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Ae(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var tt=this.container=document.createElement("div");tt.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var bt=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Ue(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(kt){this.eventManager.keyevent(kt,this)}.bind(this));var Ge=document.createElement("div");Ge.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ke=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ke),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Ge.appendChild(this._clearEl),Ge.appendChild(this._loadingEl),tt.appendChild(bt),tt.appendChild(this._inputEl),tt.appendChild(Ge),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var at=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(at),Ge.appendChild(this._geolocateEl),this._showGeolocateButton()}var ze=this._typeahead=new gt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),ze.getItemValue=this.options.getItemValue;var Nt=ze.list.draw,Wt=this._footerNode=function Ft(){var he=document.createElement("div");return he.className="mapboxgl-ctrl-geocoder--powered-by",he.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',he}();return ze.list.draw=function(){Nt.call(this),Wt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Wt.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(Wt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),tt},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(he){this._hideLoadingIcon();const tt={geometry:{type:"Point",coordinates:[he.coords.longitude,he.coords.latitude]}};this._handleMarker(tt),this._fly(tt),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(tt),this._showClearButton(),this.fresh=!1;const bt={limit:1,language:[this.options.language],query:tt.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(tt.geometry.coordinates[0]+","+tt.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:tt})):this.geocoderService.reverseGeocode(bt).send().then(function(Ge){const ke=Ge.body.features[0];if(ke){const at=Vt.transformFeatureToGeolocationText(ke,this.options.addressAccuracy);this._setInputValue(at),ke.user_coordinates=tt.geometry.coordinates,this._eventEmitter.emit("result",{result:ke})}else this._eventEmitter.emit("result",{result:{user_coordinates:tt.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(he){1===he.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(he,tt){var bt=document.createElementNS("http://www.w3.org/2000/svg","svg");return bt.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+he),bt.setAttribute("viewBox","0 0 18 18"),bt.setAttribute("xml:space","preserve"),bt.setAttribute("width",18),bt.setAttribute("height",18),bt.innerHTML=tt,bt},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(he){this._inputEl.value=he,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(he){var tt=(he.clipboardData||window.clipboardData).getData("text");tt.length>=this.options.minLength&&this._geocode(tt)},_onKeyDown:function(he){var tt=27,bt=9;if(he.keyCode===tt&&this.options.clearAndBlurOnEsc)return this._clear(he),this._inputEl.blur();var Ge=he.target&&he.target.shadowRoot?he.target.shadowRoot.activeElement:he.target;if(!Ge||!Ge.value)return this.fresh=!0,he.keyCode!==bt&&this.clear(he),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!he.metaKey&&-1===[bt,tt,37,39,13,38,40].indexOf(he.keyCode)&&Ge.value.length>=this.options.minLength&&this._geocode(Ge.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(he){this.options.clearOnBlur&&this._clearOnBlur(he),this.options.collapsed&&this._collapse()},_onChange:function(){var he=this._typeahead.selected;he&&JSON.stringify(he)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(he),this.options.marker&&this._mapboxgl&&this._handleMarker(he),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(he),this._eventEmitter.emit("result",{result:he}),this.eventManager.select(he,this))},_fly:function(he){var tt;if(he.properties&&Q[he.properties.short_code])tt=Me({},this.options.flyTo),this._map&&this._map.fitBounds(Q[he.properties.short_code].bbox,tt);else if(he.bbox){var bt=he.bbox;tt=Me({},this.options.flyTo),this._map&&this._map.fitBounds([[bt[0],bt[1]],[bt[2],bt[3]]],tt)}else tt=Me({},{zoom:this.options.zoom},this.options.flyTo),he.center?tt.center=he.center:he.geometry&&he.geometry.type&&"Point"===he.geometry.type&&he.geometry.coordinates&&(tt.center=he.geometry.coordinates),this._map&&this._map.flyTo(tt)},_requestType:function(he,tt){return he.localGeocoderOnly?1:he.reverseGeocode&&Vt.REVERSE_GEOCODE_COORD_RGX.test(tt)?2:0},_setupConfig:function(he,tt){const Ge=/[\s,]+/;var ke=this,at=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(Nt,Wt){return null==ke.options[Wt]||(Nt[Wt]=["countries","types","language"].indexOf(Wt)>-1?ke.options[Wt].split(Ge):ke.options[Wt],"proximity"===Wt&&"number"==typeof ke.options[Wt].longitude&&"number"==typeof ke.options[Wt].latitude&&(Nt[Wt]=[ke.options[Wt].longitude,ke.options[Wt].latitude])),Nt},{});switch(he){case 2:var ze=tt.split(Ge).map(function(Nt){return parseFloat(Nt,10)});ke.options.flipCoordinates||ze.reverse(),at=Me(at,{query:ze,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Nt){Nt in at&&delete at[Nt]});break;case 0:{const Nt=tt.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(Nt)&&(tt=tt.replace(/,/g," ")),at=Me(at,{query:tt})}}return at},_geocode:function(he){this.inputString=he,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:he});const tt=this._requestType(this.options,he),bt=this._setupConfig(tt,he);var Ge;switch(tt){case 1:Ge=Promise.resolve();break;case 0:Ge=this.geocoderService.forwardGeocode(bt).send();break;case 2:Ge=this.geocoderService.reverseGeocode(bt).send()}var ke=this.options.localGeocoder&&this.options.localGeocoder(he)||[],at=[],ze=null;return Ge.catch(function(Nt){ze=Nt}.bind(this)).then(function(Nt){this._hideLoadingIcon();var Wt={};return Nt?"200"==Nt.statusCode&&((Wt=Nt.body).request=Nt.request,Wt.headers=Nt.headers):Wt={type:"FeatureCollection",features:[]},Wt.config=bt,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Wt.features=Wt.features?ke.concat(Wt.features):ke,this.options.externalGeocoder?(at=this.options.externalGeocoder(he,Wt.features)||Promise.resolve([])).then(function(kt){return Wt.features=Wt.features?kt.concat(Wt.features):kt,Wt},function(){return Wt}):Wt}.bind(this)).then(function(Nt){if(ze)throw ze;this.options.filter&&Nt.features.length&&(Nt.features=Nt.features.filter(this.options.filter)),Nt.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",Nt),this._typeahead.update(Nt.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Nt))}.bind(this)).catch(function(Nt){this._hideLoadingIcon(),this._hideAttribution(),ke.length&&this.options.localGeocoder||at.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ke)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ke}),this._eventEmitter.emit("error",{error:Nt})}.bind(this)),Ge},_clear:function(he){he&&he.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(he){this._clear(he),this._inputEl.focus()},_clearOnBlur:function(he){he.relatedTarget&&this._clear(he)},_onQueryResult:function(he){var tt=he.body;if(tt.features.length){var bt=tt.features[0];this._typeahead.selected=bt,this._inputEl.value=bt.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var he=this._map.getCenter().wrap();this.setProximity({longitude:he.lng,latitude:he.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(he){return this._geocode(he).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(he){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(he)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var he=this.options.language.split(",")[0],tt=yt.language(he),bt=Re.placeholder[tt];if(bt)return bt}return"Search"},setInput:function(he){return this._inputEl.value=he,this._typeahead.selected=null,this._typeahead.clear(),he.length>=this.options.minLength&&this._geocode(he),this},setProximity:function(he,tt=!0){return this.options.proximity=he,tt&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(he){return he&&"function"==typeof he&&(this._typeahead.render=he),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(he){var tt=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=he||this.options.language||tt,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(he){return this.options.zoom=he,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(he){return this.options.flyTo=he,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(he){return this.placeholder=he||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(he){return this.options.bbox=he,this},getCountries:function(){return this.options.countries},setCountries:function(he){return this.options.countries=he,this},getTypes:function(){return this.options.types},setTypes:function(he){return this.options.types=he,this},getMinLength:function(){return this.options.minLength},setMinLength:function(he){return this.options.minLength=he,this._typeahead&&(this._typeahead.options.minLength=he),this},getLimit:function(){return this.options.limit},setLimit:function(he){return this.options.limit=he,this._typeahead&&(this._typeahead.options.limit=he),this},getFilter:function(){return this.options.filter},setFilter:function(he){return this.options.filter=he,this},setOrigin:function(he){return this.options.origin=he,this.geocoderService=Le(Ie({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(he){return this.options.accessToken=he,this.geocoderService=Le(Ie({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(he){return this.options.autocomplete=he,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(he){return this.options.fuzzyMatch=he,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(he){return this.options.routing=he,this},getRouting:function(){return this.options.routing},setWorldview:function(he){return this.options.worldview=he,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(he){if(this._map){this._removeMarker();var bt=Me({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(bt),he.center?this.mapMarker.setLngLat(he.center).addTo(this._map):he.geometry&&he.geometry.type&&"Point"===he.geometry.type&&he.geometry.coordinates&&this.mapMarker.setLngLat(he.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(he,tt){return this._eventEmitter.on(he,tt),this},off:function(he,tt){return this._eventEmitter.removeListener(he,tt),this.eventManager.remove(),this}},Zt.exports=Ot},251:Zt=>{"use strict";Zt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},485:Zt=>{function ve(Ue){const Me=Ue.address||"",u=Ue.text||"",Q=Ue.place_name||"",Le={address:Q.split(",")[0],houseNumber:Me,street:u,placeName:Q};return Ue.context.forEach(function(Ae){const Re=Ae.id.split(".")[0];Le[Re]=Ae.text}),Le}Zt.exports={transformFeatureToGeolocationText:function qt(Ue,Me){const u=ve(Ue),Q=["address","street","place","country"];if("function"==typeof Me)return Me(u);const Le=Q.indexOf(Me);return(-1===Le?Q:Q.slice(Le)).reduce(function(Ae,Re){return u[Re]?(""!==Ae&&(Ae+=", "),Ae+u[Re]):Ae},"")},getAddressInfo:ve,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},658:(Zt,qt,ve)=>{"use strict";var gt=ve(819);Zt.exports=gt},819:(Zt,qt,ve)=>{"use strict";var gt=ve(561),Ue=ve(983);function Me(Q){Ue.call(this,Q)}(Me.prototype=Object.create(Ue.prototype)).constructor=Me,Me.prototype.sendRequest=gt.browserSend,Me.prototype.abortRequest=gt.browserAbort,Zt.exports=function u(Q){return new Me(Q)}},561:(Zt,qt,ve)=>{"use strict";var gt=ve(896),Ue=ve(43),Me=ve(889),u=ve(17),Q={};function Ae(Vt){var St=Vt.total,Ft=Vt.loaded;return{total:St,transferred:Ft,percent:100*Ft/St}}function Re(Vt,St){return new Promise(function(Ft,Ot){St.onprogress=function(bt){Vt.emitter.emit(Me.EVENT_PROGRESS_DOWNLOAD,Ae(bt))};var he=Vt.file;he&&(St.upload.onprogress=function(bt){Vt.emitter.emit(Me.EVENT_PROGRESS_UPLOAD,Ae(bt))}),St.onerror=function(bt){Ot(bt)},St.onabort=function(){var bt=new Ue({request:Vt,type:Me.ERROR_REQUEST_ABORTED});Ot(bt)},St.onload=function(){if(delete Q[Vt.id],St.status<200||St.status>=400){var bt=new Ue({request:Vt,body:St.response,statusCode:St.status});Ot(bt)}else Ft(St)};var tt=Vt.body;"string"==typeof tt?St.send(tt):tt?St.send(JSON.stringify(tt)):he?St.send(he):St.send(),Q[Vt.id]=St}).then(function(Ft){return function Le(Vt,St){return new gt(Vt,{body:St.response,headers:u(St.getAllResponseHeaders()),statusCode:St.status})}(Vt,Ft)})}function yt(Vt,St){var Ft=Vt.url(St),Ot=new window.XMLHttpRequest;return Ot.open(Vt.method,Ft),Object.keys(Vt.headers).forEach(function(he){Ot.setRequestHeader(he,Vt.headers[he])}),Ot}Zt.exports={browserAbort:function Ie(Vt){var St=Q[Vt.id];St&&(St.abort(),delete Q[Vt.id])},sendRequestXhr:Re,browserSend:function Yt(Vt){return Promise.resolve().then(function(){var St=yt(Vt,Vt.client.accessToken);return Re(Vt,St)})},createRequestXhr:yt}},983:(Zt,qt,ve)=>{"use strict";var gt=ve(746),Ue=ve(323),Me=ve(889);function u(Q){if(!Q||!Q.accessToken)throw new Error("Cannot create a client without an access token");gt(Q.accessToken),this.accessToken=Q.accessToken,this.origin=Q.origin||Me.API_ORIGIN}u.prototype.createRequest=function(Ie){return new Ue(this,Ie)},Zt.exports=u},43:(Zt,qt,ve)=>{"use strict";var gt=ve(889);Zt.exports=function Ue(Me){var Q,u=Me.type||gt.ERROR_HTTP;if(Me.body)try{Q=JSON.parse(Me.body)}catch{Q=Me.body}else Q=null;var Ie=Me.message||null;Ie||("string"==typeof Q?Ie=Q:Q&&"string"==typeof Q.message?Ie=Q.message:u===gt.ERROR_REQUEST_ABORTED&&(Ie="Request aborted")),this.message=Ie,this.type=u,this.statusCode=Me.statusCode||null,this.request=Me.request,this.body=Q}},323:(Zt,qt,ve)=>{"use strict";var gt=ve(746),Ue=ve(498),Me=ve(81),u=ve(51),Q=ve(889),Ie=1;function Le(Ae,Re){if(!Ae)throw new Error("MapiRequest requires a client");if(!Re||!Re.path||!Re.method)throw new Error("MapiRequest requires an options object with path and method properties");var yt={};Re.body&&(yt["content-type"]="application/json");var Yt=Ue(yt,Re.headers),Vt=Object.keys(Yt).reduce(function(St,Ft){return St[Ft.toLowerCase()]=Yt[Ft],St},{});this.id=Ie++,this._options=Re,this.emitter=new Me,this.client=Ae,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=Re.path,this.method=Re.method,this.origin=Re.origin||Ae.origin,this.query=Re.query||{},this.params=Re.params||{},this.body=Re.body||null,this.file=Re.file||null,this.encoding=Re.encoding||"utf8",this.sendFileAs=Re.sendFileAs||null,this.headers=Vt}Le.prototype.url=function(Re){var yt=u.prependOrigin(this.path,this.origin);yt=u.appendQueryObject(yt,this.query);var Yt=this.params,Vt=Re??this.client.accessToken;if(Vt){yt=u.appendQueryParam(yt,"access_token",Vt);var St=gt(Vt).user;Yt=Ue({ownerId:St},Yt)}return u.interpolateRouteParams(yt,Yt)},Le.prototype.send=function(){var Re=this;if(Re.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return Re.sent=!0,Re.client.sendRequest(Re).then(function(yt){return Re.response=yt,Re.emitter.emit(Q.EVENT_RESPONSE,yt),yt},function(yt){throw Re.error=yt,Re.emitter.emit(Q.EVENT_ERROR,yt),yt})},Le.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Le.prototype.eachPage=function(Re){var yt=this;function Yt(Ft){Re(null,Ft,function Ot(){delete yt._nextPageRequest;var he=Ft.nextPage();he&&(yt._nextPageRequest=he,St(he))})}function Vt(Ft){Re(Ft,null,function(){})}function St(Ft){Ft.send().then(Yt,Vt)}St(this)},Le.prototype.clone=function(){return this._extend()},Le.prototype._extend=function(Re){var yt=Ue(this._options,Re);return new Le(this.client,yt)},Zt.exports=Le},896:(Zt,qt,ve)=>{"use strict";var gt=ve(295);function Ue(Me,u){this.request=Me,this.headers=u.headers,this.rawBody=u.body,this.statusCode=u.statusCode;try{this.body=JSON.parse(u.body||"{}")}catch{this.body=u.body}this.links=gt(this.headers.link)}Ue.prototype.hasNextPage=function(){return!!this.links.next},Ue.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Zt.exports=Ue},889:Zt=>{"use strict";Zt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},17:Zt=>{"use strict";Zt.exports=function ve(gt){var Ue={};return gt&&gt.trim().split(/[\r|\n]+/).forEach(function(Me){var u=function qt(gt){var Ue=gt.indexOf(":");return{name:gt.substring(0,Ue).trim().toLowerCase(),value:gt.substring(Ue+1).trim()}}(Me);Ue[u.name]=u.value}),Ue}},295:Zt=>{"use strict";Zt.exports=function gt(Ue){return Ue?Ue.split(/,\s*</).reduce(function(Me,u){var Q=function ve(Ue){var Me=Ue.match(/<?([^>]*)>(.*)/);if(!Me)return null;var u=Me[1],Q=Me[2].split(";"),Ie=null,Le=Q.reduce(function(Ae,Re){var yt=function qt(Ue){var Me=Ue.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return Me?{key:Me[1],value:Me[2]}:null}(Re);return yt?"rel"===yt.key?(Ie||(Ie=yt.value),Ae):(Ae[yt.key]=yt.value,Ae):Ae},{});return Ie?{url:u,rel:Ie,params:Le}:null}(u);return Q?(Q.rel.split(/\s+/).forEach(function(Le){Me[Le]||(Me[Le]={url:Q.url,params:Q.params})}),Me):Me},{}):{}}},51:Zt=>{"use strict";function ve(Q){return Array.isArray(Q)?function qt(Q){return Q.map(encodeURIComponent).join(",")}(Q):encodeURIComponent(String(Q))}function gt(Q,Ie,Le){if(!1===Le||null===Le)return Q;var Ae=/\?/.test(Q)?"&":"?",Re=encodeURIComponent(Ie);return void 0!==Le&&""!==Le&&!0!==Le&&(Re+="="+ve(Le)),""+Q+Ae+Re}Zt.exports={appendQueryObject:function Ue(Q,Ie){if(!Ie)return Q;var Le=Q;return Object.keys(Ie).forEach(function(Ae){var Re=Ie[Ae];void 0!==Re&&(Array.isArray(Re)&&(Re=Re.filter(function(yt){return null!=yt}).join(",")),Le=gt(Le,Ae,Re))}),Le},appendQueryParam:gt,prependOrigin:function Me(Q,Ie){if(!Ie||"http"===Q.slice(0,4))return Q;var Le="/"===Q[0]?"":"/";return""+Ie.replace(/\/$/,"")+Le+Q},interpolateRouteParams:function u(Q,Ie){return Ie?Q.replace(/\/:([a-zA-Z0-9]+)/g,function(Le,Ae){var Re=Ie[Ae];if(void 0===Re)throw new Error("Unspecified route parameter "+Ae);return"/"+ve(Re)}):Q}}},81:Zt=>{"use strict";var qt=Object.prototype.hasOwnProperty,ve="~";function gt(){}function Ue(Ie,Le,Ae){this.fn=Ie,this.context=Le,this.once=Ae||!1}function Me(Ie,Le,Ae,Re,yt){if("function"!=typeof Ae)throw new TypeError("The listener must be a function");var Yt=new Ue(Ae,Re||Ie,yt),Vt=ve?ve+Le:Le;return Ie._events[Vt]?Ie._events[Vt].fn?Ie._events[Vt]=[Ie._events[Vt],Yt]:Ie._events[Vt].push(Yt):(Ie._events[Vt]=Yt,Ie._eventsCount++),Ie}function u(Ie,Le){0==--Ie._eventsCount?Ie._events=new gt:delete Ie._events[Le]}function Q(){this._events=new gt,this._eventsCount=0}Object.create&&(gt.prototype=Object.create(null),(new gt).__proto__||(ve=!1)),Q.prototype.eventNames=function(){var Ae,Re,Le=[];if(0===this._eventsCount)return Le;for(Re in Ae=this._events)qt.call(Ae,Re)&&Le.push(ve?Re.slice(1):Re);return Object.getOwnPropertySymbols?Le.concat(Object.getOwnPropertySymbols(Ae)):Le},Q.prototype.listeners=function(Le){var Re=this._events[ve?ve+Le:Le];if(!Re)return[];if(Re.fn)return[Re.fn];for(var yt=0,Yt=Re.length,Vt=new Array(Yt);yt<Yt;yt++)Vt[yt]=Re[yt].fn;return Vt},Q.prototype.listenerCount=function(Le){var Re=this._events[ve?ve+Le:Le];return Re?Re.fn?1:Re.length:0},Q.prototype.emit=function(Le,Ae,Re,yt,Yt,Vt){var St=ve?ve+Le:Le;if(!this._events[St])return!1;var he,tt,Ft=this._events[St],Ot=arguments.length;if(Ft.fn){switch(Ft.once&&this.removeListener(Le,Ft.fn,void 0,!0),Ot){case 1:return Ft.fn.call(Ft.context),!0;case 2:return Ft.fn.call(Ft.context,Ae),!0;case 3:return Ft.fn.call(Ft.context,Ae,Re),!0;case 4:return Ft.fn.call(Ft.context,Ae,Re,yt),!0;case 5:return Ft.fn.call(Ft.context,Ae,Re,yt,Yt),!0;case 6:return Ft.fn.call(Ft.context,Ae,Re,yt,Yt,Vt),!0}for(tt=1,he=new Array(Ot-1);tt<Ot;tt++)he[tt-1]=arguments[tt];Ft.fn.apply(Ft.context,he)}else{var Ge,bt=Ft.length;for(tt=0;tt<bt;tt++)switch(Ft[tt].once&&this.removeListener(Le,Ft[tt].fn,void 0,!0),Ot){case 1:Ft[tt].fn.call(Ft[tt].context);break;case 2:Ft[tt].fn.call(Ft[tt].context,Ae);break;case 3:Ft[tt].fn.call(Ft[tt].context,Ae,Re);break;case 4:Ft[tt].fn.call(Ft[tt].context,Ae,Re,yt);break;default:if(!he)for(Ge=1,he=new Array(Ot-1);Ge<Ot;Ge++)he[Ge-1]=arguments[Ge];Ft[tt].fn.apply(Ft[tt].context,he)}}return!0},Q.prototype.on=function(Le,Ae,Re){return Me(this,Le,Ae,Re,!1)},Q.prototype.once=function(Le,Ae,Re){return Me(this,Le,Ae,Re,!0)},Q.prototype.removeListener=function(Le,Ae,Re,yt){var Yt=ve?ve+Le:Le;if(!this._events[Yt])return this;if(!Ae)return u(this,Yt),this;var Vt=this._events[Yt];if(Vt.fn)Vt.fn===Ae&&(!yt||Vt.once)&&(!Re||Vt.context===Re)&&u(this,Yt);else{for(var St=0,Ft=[],Ot=Vt.length;St<Ot;St++)(Vt[St].fn!==Ae||yt&&!Vt[St].once||Re&&Vt[St].context!==Re)&&Ft.push(Vt[St]);Ft.length?this._events[Yt]=1===Ft.length?Ft[0]:Ft:u(this,Yt)}return this},Q.prototype.removeAllListeners=function(Le){var Ae;return Le?this._events[Ae=ve?ve+Le:Le]&&u(this,Ae):(this._events=new gt,this._eventsCount=0),this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.addListener=Q.prototype.on,Q.prefixed=ve,Q.EventEmitter=Q,Zt.exports=Q},725:(Zt,qt,ve)=>{"use strict";var gt=ve(498),Ue=ve(253),Me=ve(160),u=ve(193),Q=ve(981),Ie={},Le=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Ie.forwardGeocode=function(Ae){Ue.assertShape({query:Ue.required(Ue.string),mode:Ue.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ue.arrayOf(Ue.string),proximity:Ue.oneOf(Ue.coordinates,"ip"),types:Ue.arrayOf(Ue.oneOf(Le)),autocomplete:Ue.boolean,bbox:Ue.arrayOf(Ue.number),limit:Ue.number,language:Ue.arrayOf(Ue.string),routing:Ue.boolean,fuzzyMatch:Ue.boolean,worldview:Ue.string})(Ae),Ae.mode=Ae.mode||"mapbox.places";var Re=u(gt({country:Ae.countries},Me(Ae,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Me(Ae,["mode","query"]),query:Re})},Ie.reverseGeocode=function(Ae){Ue.assertShape({query:Ue.required(Ue.coordinates),mode:Ue.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ue.arrayOf(Ue.string),types:Ue.arrayOf(Ue.oneOf(Le)),bbox:Ue.arrayOf(Ue.number),limit:Ue.number,language:Ue.arrayOf(Ue.string),reverseMode:Ue.oneOf("distance","score"),routing:Ue.boolean,worldview:Ue.string})(Ae),Ae.mode=Ae.mode||"mapbox.places";var Re=u(gt({country:Ae.countries},Me(Ae,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Me(Ae,["mode","query"]),query:Re})},Zt.exports=Q(Ie)},981:(Zt,qt,ve)=>{"use strict";var gt=ve(983),Ue=ve(819);Zt.exports=function Me(u){return function(Q){var Ie;Ie=gt.prototype.isPrototypeOf(Q)?Q:Ue(Q);var Le=Object.create(u);return Le.client=Ie,Le}}},99:Zt=>{"use strict";Zt.exports=function qt(ve,gt){return Object.keys(ve).reduce(function(Ue,Me){return Ue[Me]=gt(Me,ve[Me]),Ue},{})}},160:Zt=>{"use strict";Zt.exports=function qt(ve,gt){var Ue=function(Me,u){return-1!==gt.indexOf(Me)&&void 0!==u};return"function"==typeof gt&&(Ue=gt),Object.keys(ve).filter(function(Me){return Ue(Me,ve[Me])}).reduce(function(Me,u){return Me[u]=ve[u],Me},{})}},193:(Zt,qt,ve)=>{"use strict";var gt=ve(99);Zt.exports=function Ue(Me){return gt(Me,function(u,Q){return"boolean"==typeof Q?JSON.stringify(Q):Q})}},253:(Zt,qt,ve)=>{"use strict";var gt=ve(498),Ue=ve(406);Zt.exports=gt(Ue,{file:function Me(Le){return typeof window<"u"?Le instanceof global.Blob||Le instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Le&&void 0===Le.pipe?"Filename or Readable stream":void 0},date:function Q(Le){var Ae="date";if("boolean"==typeof Le)return Ae;try{var Re=new Date(Le);if(Re.getTime&&isNaN(Re.getTime()))return Ae}catch{return Ae}},coordinates:function Ie(Le){return Ue.tuple(Ue.number,Ue.number)(Le)},assertShape:function u(Le,Ae){return Ue.assert(Ue.strictShape(Le),Ae)}})},746:(Zt,qt,ve)=>{"use strict";var gt=ve(391),Ue={};function Q(Ie,Le){return Object.prototype.hasOwnProperty.call(Ie,Le)}Zt.exports=function Me(Ie){if(Ue[Ie])return Ue[Ie];var Le=Ie.split("."),Ae=Le[0],Re=Le[1];if(!Re)throw new Error("Invalid token");var yt=function u(Ie){try{return JSON.parse(gt.decode(Ie))}catch{throw new Error("Invalid token")}}(Re),Yt={usage:Ae,user:yt.u};return Q(yt,"a")&&(Yt.authorization=yt.a),Q(yt,"exp")&&(Yt.expires=1e3*yt.exp),Q(yt,"iat")&&(Yt.created=1e3*yt.iat),Q(yt,"scopes")&&(Yt.scopes=yt.scopes),Q(yt,"client")&&(Yt.client=yt.client),Q(yt,"ll")&&(Yt.lastLogin=yt.ll),Q(yt,"iu")&&(Yt.impersonator=yt.iu),Ue[Ie]=Yt,Yt}},540:(Zt,qt,ve)=>{"use strict";var gt={};ve.r(gt),ve.d(gt,{Decoder:()=>RE,Encoder:()=>mj,PacketType:()=>Vi,protocol:()=>_2});var Ue={};function Me(e){return"function"==typeof e}function u(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}ve.r(Ue),ve.d(Ue,{Manager:()=>Bx,Socket:()=>LE,connect:()=>$d,default:()=>$d,io:()=>$d,protocol:()=>_2});const Q=u(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,l)=>`${l+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Ie(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Le{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const d of t)d.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Me(r))try{r()}catch(d){n=d instanceof Q?d.errors:[d]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const d of l)try{yt(d)}catch(y){n=n??[],y instanceof Q?n=[...n,...y.errors]:n.push(y)}}if(n)throw new Q(n)}}add(n){var t;if(n&&n!==this)if(this.closed)yt(n);else{if(n instanceof Le){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&Ie(t,n)}remove(n){const{_finalizers:t}=this;t&&Ie(t,n),n instanceof Le&&n._removeParent(this)}}Le.EMPTY=(()=>{const e=new Le;return e.closed=!0,e})();const Ae=Le.EMPTY;function Re(e){return e instanceof Le||e&&"closed"in e&&Me(e.remove)&&Me(e.add)&&Me(e.unsubscribe)}function yt(e){Me(e)?e():e.unsubscribe()}const Yt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Vt={setTimeout(e,n,...t){const{delegate:r}=Vt;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Vt;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function St(e){Vt.setTimeout(()=>{const{onUnhandledError:n}=Yt;if(!n)throw e;n(e)})}function Ft(){}const Ot=bt("C",void 0,void 0);function bt(e,n,t){return{kind:e,value:n,error:t}}let Ge=null;function ke(e){if(Yt.useDeprecatedSynchronousErrorHandling){const n=!Ge;if(n&&(Ge={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=Ge;if(Ge=null,t)throw r}}else e()}class ze extends Le{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Re(n)&&n.add(this)):this.destination=Er}static create(n,t,r){return new Tn(n,t,r)}next(n){this.isStopped?qr(function tt(e){return bt("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?qr(function he(e){return bt("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?qr(Ot,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Nt=Function.prototype.bind;function Wt(e,n){return Nt.call(e,n)}class kt{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){ki(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){ki(r)}else ki(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){ki(t)}}}class Tn extends ze{constructor(n,t,r){let l;if(super(),Me(n)||!n)l={next:n??void 0,error:t??void 0,complete:r??void 0};else{let d;this&&Yt.useDeprecatedNextContext?(d=Object.create(n),d.unsubscribe=()=>this.unsubscribe(),l={next:n.next&&Wt(n.next,d),error:n.error&&Wt(n.error,d),complete:n.complete&&Wt(n.complete,d)}):l=n}this.destination=new kt(l)}}function ki(e){Yt.useDeprecatedSynchronousErrorHandling?function at(e){Yt.useDeprecatedSynchronousErrorHandling&&Ge&&(Ge.errorThrown=!0,Ge.error=e)}(e):St(e)}function qr(e,n){const{onStoppedNotification:t}=Yt;t&&Vt.setTimeout(()=>t(e,n))}const Er={closed:!0,next:Ft,error:function qi(e){throw e},complete:Ft},Dn="function"==typeof Symbol&&Symbol.observable||"@@observable";function En(e){return e}function dn(e){return 0===e.length?En:1===e.length?e[0]:function(t){return e.reduce((r,l)=>l(r),t)}}let In=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,l){const d=function Oi(e){return e&&e instanceof ze||function Zi(e){return e&&Me(e.next)&&Me(e.error)&&Me(e.complete)}(e)&&Re(e)}(t)?t:new Tn(t,r,l);return ke(()=>{const{operator:y,source:C}=this;d.add(y?y.call(d,C):C?this._subscribe(d):this._trySubscribe(d))}),d}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=si(r))((l,d)=>{const y=new Tn({next:C=>{try{t(C)}catch(D){d(D),y.unsubscribe()}},error:d,complete:l});this.subscribe(y)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Dn](){return this}pipe(...t){return dn(t)(this)}toPromise(t){return new(t=si(t))((r,l)=>{let d;this.subscribe(y=>d=y,y=>l(y),()=>r(d))})}}return e.create=n=>new e(n),e})();function si(e){var n;return null!==(n=e??Yt.Promise)&&void 0!==n?n:Promise}const li=u(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Mn=(()=>{class e extends In{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new Zr(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new li}next(t){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:l,observers:d}=this;return r||l?Ae:(this.currentObservers=null,d.push(t),new Le(()=>{this.currentObservers=null,Ie(d,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:l,isStopped:d}=this;r?t.error(l):d&&t.complete()}asObservable(){const t=new In;return t.source=this,t}}return e.create=(n,t)=>new Zr(n,t),e})();class Zr extends Mn{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:Ae}}function di(e){return Me(e?.lift)}function pi(e){return n=>{if(di(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ln(e,n,t,r,l){return new is(e,n,t,r,l)}class is extends ze{constructor(n,t,r,l,d,y){super(n),this.onFinalize=d,this.shouldUnsubscribe=y,this._next=t?function(C){try{t(C)}catch(D){n.error(D)}}:super._next,this._error=l?function(C){try{l(C)}catch(D){n.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(C){n.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function An(e,n){return pi((t,r)=>{let l=0;t.subscribe(ln(r,d=>{r.next(e.call(n,d,l++))}))})}function ro(e){return this instanceof ro?(this.v=e,this):new ro(e)}function Qa(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function va(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(d){t[d]=e[d]&&function(y){return new Promise(function(C,D){!function l(d,y,C,D){Promise.resolve(D).then(function(O){d({value:O,done:C})},y)}(C,D,(y=e[d](y)).done,y.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Rt=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function zt(e){return Me(e?.then)}function Ct(e){return Me(e[Dn])}function kn(e){return Symbol.asyncIterator&&Me(e?.[Symbol.asyncIterator])}function Gn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Sn=function zn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Bt(e){return Me(e?.[Sn])}function Ui(e){return function ys(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,r=t.apply(e,n||[]),d=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(oe){r[oe]&&(l[oe]=function(be){return new Promise(function(Ye,nt){d.push([oe,be,Ye,nt])>1||C(oe,be)})})}function C(oe,be){try{!function D(oe){oe.value instanceof ro?Promise.resolve(oe.value.v).then(O,$):W(d[0][2],oe)}(r[oe](be))}catch(Ye){W(d[0][3],Ye)}}function O(oe){C("next",oe)}function $(oe){C("throw",oe)}function W(oe,be){oe(be),d.shift(),d.length&&C(d[0][0],d[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:l}=yield ro(t.read());if(l)return yield ro(void 0);yield yield ro(r)}}finally{t.releaseLock()}})}function pr(e){return Me(e?.getReader)}function Mi(e){if(e instanceof In)return e;if(null!=e){if(Ct(e))return function Cr(e){return new In(n=>{const t=e[Dn]();if(Me(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Rt(e))return function jo(e){return new In(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(zt(e))return function Lr(e){return new In(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,St)})}(e);if(kn(e))return Ea(e);if(Bt(e))return function Mr(e){return new In(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(pr(e))return function Hd(e){return Ea(Ui(e))}(e)}throw Gn(e)}function Ea(e){return new In(n=>{(function Nh(e,n){var t,r,l,d;return function ac(e,n,t,r){return new(t||(t=Promise))(function(d,y){function C($){try{O(r.next($))}catch(W){y(W)}}function D($){try{O(r.throw($))}catch(W){y(W)}}function O($){$.done?d($.value):function l(d){return d instanceof t?d:new t(function(y){y(d)})}($.value).then(C,D)}O((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Qa(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(y){l={error:y}}finally{try{r&&!r.done&&(d=t.return)&&(yield d.call(t))}finally{if(l)throw l.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Kn(e,n,t,r=0,l=!1){const d=n.schedule(function(){t(),l?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(d),!l)return d}function vr(e,n,t=1/0){return Me(n)?vr((r,l)=>An((d,y)=>n(r,d,l,y))(Mi(e(r,l))),t):("number"==typeof n&&(t=n),pi((r,l)=>function Ru(e,n,t,r,l,d,y,C){const D=[];let O=0,$=0,W=!1;const oe=()=>{W&&!D.length&&!O&&n.complete()},be=nt=>O<r?Ye(nt):D.push(nt),Ye=nt=>{d&&n.next(nt),O++;let mt=!1;Mi(t(nt,$++)).subscribe(ln(n,Ut=>{l?.(Ut),d?be(Ut):n.next(Ut)},()=>{mt=!0},void 0,()=>{if(mt)try{for(O--;D.length&&O<r;){const Ut=D.shift();y?Kn(n,y,()=>Ye(Ut)):Ye(Ut)}oe()}catch(Ut){n.error(Ut)}}))};return e.subscribe(ln(n,be,()=>{W=!0,oe()})),()=>{C?.()}}(r,l,e,t)))}function Ca(e=1/0){return vr(En,e)}const oo=new In(e=>e.complete());function lc(e){return e[e.length-1]}function Ta(e){return Me(lc(e))?e.pop():void 0}function _o(e){return function Lu(e){return e&&Me(e.schedule)}(lc(e))?e.pop():void 0}function it(e,n=0){return pi((t,r)=>{t.subscribe(ln(r,l=>Kn(r,e,()=>r.next(l),n),()=>Kn(r,e,()=>r.complete(),n),l=>Kn(r,e,()=>r.error(l),n)))})}function os(e,n=0){return pi((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function Us(e,n){if(!e)throw new Error("Iterable cannot be null");return new In(t=>{Kn(t,n,()=>{const r=e[Symbol.asyncIterator]();Kn(t,n,()=>{r.next().then(l=>{l.done?t.complete():t.next(l.value)})},0,!0)})})}function ot(e,n){return n?function Da(e,n){if(null!=e){if(Ct(e))return function Qi(e,n){return Mi(e).pipe(os(n),it(n))}(e,n);if(Rt(e))return function or(e,n){return new In(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(zt(e))return function On(e,n){return Mi(e).pipe(os(n),it(n))}(e,n);if(kn(e))return Us(e,n);if(Bt(e))return function Ao(e,n){return new In(t=>{let r;return Kn(t,n,()=>{r=e[Sn](),Kn(t,n,()=>{let l,d;try{({value:l,done:d}=r.next())}catch(y){return void t.error(y)}d?t.complete():t.next(l)},0,!0)}),()=>Me(r?.return)&&r.return()})}(e,n);if(pr(e))return function el(e,n){return Us(Ui(e),n)}(e,n)}throw Gn(e)}(e,n):Mi(e)}class gn extends Mn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function fn(...e){return ot(e,_o(e))}function sr(e={}){const{connector:n=(()=>new Mn),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:l=!0}=e;return d=>{let y,C,D,O=0,$=!1,W=!1;const oe=()=>{C?.unsubscribe(),C=void 0},be=()=>{oe(),y=D=void 0,$=W=!1},Ye=()=>{const nt=y;be(),nt?.unsubscribe()};return pi((nt,mt)=>{O++,!W&&!$&&oe();const Ut=D=D??n();mt.add(()=>{O--,0===O&&!W&&!$&&(C=qn(Ye,l))}),Ut.subscribe(mt),!y&&O>0&&(y=new Tn({next:dt=>Ut.next(dt),error:dt=>{W=!0,oe(),C=qn(be,t,dt),Ut.error(dt)},complete:()=>{$=!0,oe(),C=qn(be,r),Ut.complete()}}),Mi(nt).subscribe(y))})(d)}}function qn(e,n,...t){if(!0===n)return void e();if(!1===n)return;const r=new Tn({next:()=>{r.unsubscribe(),e()}});return Mi(n(...t)).subscribe(r)}function Wi(e,n){return pi((t,r)=>{let l=null,d=0,y=!1;const C=()=>y&&!l&&r.complete();t.subscribe(ln(r,D=>{l?.unsubscribe();let O=0;const $=d++;Mi(e(D,$)).subscribe(l=ln(r,W=>r.next(n?n(D,W,$,O++):W),()=>{l=null,C()}))},()=>{y=!0,C()}))})}function Xi(e,n){return e===n}function jn(e){for(let n in e)if(e[n]===jn)return n;throw Error("Could not find renamed property on target object.")}function gi(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function ar(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(ar).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Po(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const js=jn({__forward_ref__:jn});function Ei(e){return e.__forward_ref__=Ei,e.toString=function(){return ar(this())},e}function Pn(e){return tl(e)?e():e}function tl(e){return"function"==typeof e&&e.hasOwnProperty(js)&&e.__forward_ref__===Ei}function $s(e){return e&&!!e.\u0275providers}const Ma="https://g.co/ng/security#xss";class Mt extends Error{constructor(n,t){super(function kr(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function cn(e){return"string"==typeof e?e:null==e?"":String(e)}function Pl(e,n){throw new Mt(-201,!1)}function Ur(e,n){null==e&&function jt(e,n,t,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${t} ${r} ${n} <=Actual]`))}(n,e,null,"!=")}function an(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Nr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Gs(e){return Nu(e,Ll)||Nu(e,fi)}function Nu(e,n){return e.hasOwnProperty(n)?e[n]:null}function Pa(e){return e&&(e.hasOwnProperty(Xr)||e.hasOwnProperty(Bh))?e[Xr]:null}const Ll=jn({\u0275prov:jn}),Xr=jn({\u0275inj:jn}),fi=jn({ngInjectableDef:jn}),Bh=jn({ngInjectorDef:jn});var $n=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}($n||{});let cc;function Yr(e){const n=cc;return cc=e,n}function Kc(e,n,t){const r=Gs(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&$n.Optional?null:void 0!==n?n:void Pl(ar(e))}const Di=globalThis;class Xt{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=an({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Zs={},Fl="__NG_DI_FLAG__",vs="ngTempTokenPath",Vh=/\n/gm,Go="__source";let ko;function jr(e){const n=ko;return ko=e,n}function Jc(e,n=$n.Default){if(void 0===ko)throw new Mt(-203,!1);return null===ko?Kc(e,void 0,n):ko.get(e,n&$n.Optional?null:void 0,n)}function sn(e,n=$n.Default){return(function uc(){return cc}()||Jc)(Pn(e),n)}function tn(e,n=$n.Default){return sn(e,Ws(n))}function Ws(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function ls(e){const n=[];for(let t=0;t<e.length;t++){const r=Pn(e[t]);if(Array.isArray(r)){if(0===r.length)throw new Mt(900,!1);let l,d=$n.Default;for(let y=0;y<r.length;y++){const C=r[y],D=qo(C);"number"==typeof D?-1===D?l=C.token:d|=D:l=C}n.push(sn(l,d))}else n.push(sn(r))}return n}function rl(e,n){return e[Fl]=n,e.prototype[Fl]=n,e}function qo(e){return e[Fl]}function Co(e){return{toString:e}.toString()}var Bl=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Bl||{}),xr=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(xr||{});const cs={},ni=[],Qc=jn({\u0275cmp:jn}),Oo=jn({\u0275dir:jn}),Xs=jn({\u0275pipe:jn}),ol=jn({\u0275mod:jn}),Zo=jn({\u0275fac:jn}),bs=jn({__NG_ELEMENT_ID__:jn}),eu=jn({__NG_ENV_ID__:jn});function sl(e,n,t){let r=e.length;for(;;){const l=e.indexOf(n,t);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const d=n.length;if(l+d===r||e.charCodeAt(l+d)<=32)return l}t=l+1}}function Ys(e,n,t){let r=0;for(;r<t.length;){const l=t[r];if("number"==typeof l){if(0!==l)break;r++;const d=t[r++],y=t[r++],C=t[r++];e.setAttribute(n,y,C,d)}else{const d=l,y=t[++r];pc(d)?e.setProperty(n,d,y):e.setAttribute(n,d,y),r++}}return r}function Ks(e){return 3===e||4===e||6===e}function pc(e){return 64===e.charCodeAt(0)}function Js(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const l=n[r];"number"==typeof l?t=l:0===t||Vu(e,t,l,null,-1===t||2===t?n[++r]:null)}}return e}function Vu(e,n,t,r,l){let d=0,y=e.length;if(-1===n)y=-1;else for(;d<e.length;){const C=e[d++];if("number"==typeof C){if(C===n){y=-1;break}if(C>n){y=d-1;break}}}for(;d<e.length;){const C=e[d];if("number"==typeof C)break;if(C===t){if(null===r)return void(null!==l&&(e[d+1]=l));if(r===e[d+1])return void(e[d+2]=l)}d++,null!==r&&d++,null!==l&&d++}-1!==y&&(e.splice(y,0,n),d=y+1),e.splice(d++,0,t),null!==r&&e.splice(d++,0,r),null!==l&&e.splice(d++,0,l)}const ws="ng-template";function Zd(e,n,t){let r=0,l=!0;for(;r<e.length;){let d=e[r++];if("string"==typeof d&&l){const y=e[r++];if(t&&"class"===d&&-1!==sl(y.toLowerCase(),n,0))return!0}else{if(1===d){for(;r<e.length&&"string"==typeof(d=e[r++]);)if(d.toLowerCase()===n)return!0;return!1}"number"==typeof d&&(l=!1)}}return!1}function Uu(e){return 4===e.type&&e.value!==ws}function Wd(e,n,t){return n===(4!==e.type||t?e.value:ws)}function Uh(e,n,t){let r=4;const l=e.attrs||[],d=function mc(e){for(let n=0;n<e.length;n++)if(Ks(e[n]))return n;return e.length}(l);let y=!1;for(let C=0;C<n.length;C++){const D=n[C];if("number"!=typeof D){if(!y)if(4&r){if(r=2|1&r,""!==D&&!Wd(e,D,t)||""===D&&1===n.length){if(us(r))return!1;y=!0}}else{const O=8&r?D:n[++C];if(8&r&&null!==e.attrs){if(!Zd(e.attrs,O,t)){if(us(r))return!1;y=!0}continue}const W=hs(8&r?"class":D,l,Uu(e),t);if(-1===W){if(us(r))return!1;y=!0;continue}if(""!==O){let oe;oe=W>d?"":l[W+1].toLowerCase();const be=8&r?oe:null;if(be&&-1!==sl(be,O,0)||2&r&&O!==oe){if(us(r))return!1;y=!0}}}}else{if(!y&&!us(r)&&!us(D))return!1;if(y&&us(D))continue;y=!1,r=D|1&r}}return us(r)||y}function us(e){return 0==(1&e)}function hs(e,n,t,r){if(null===n)return-1;let l=0;if(r||!t){let d=!1;for(;l<n.length;){const y=n[l];if(y===e)return l;if(3===y||6===y)d=!0;else{if(1===y||2===y){let C=n[++l];for(;"string"==typeof C;)C=n[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=d?1:2}return-1}return function jh(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function ka(e,n,t=!1){for(let r=0;r<n.length;r++)if(Uh(e,n[r],t))return!0;return!1}function gc(e,n){return e?":not("+n.trim()+")":n}function ao(e){let n=e[0],t=1,r=2,l="",d=!1;for(;t<e.length;){let y=e[t];if("string"==typeof y)if(2&r){const C=e[++t];l+="["+y+(C.length>0?'="'+C+'"':"")+"]"}else 8&r?l+="."+y:4&r&&(l+=" "+y);else""!==l&&!us(y)&&(n+=gc(d,l),l=""),r=y,d=d||!us(r);t++}return""!==l&&(n+=gc(d,l)),n}function er(e){return Co(()=>{const n=Oa(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Bl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||xr.Emulated,styles:e.styles||ni,_:null,schemas:e.schemas||null,tView:null,id:""};Na(t);const r=e.dependencies;return t.directiveDefs=hl(r,!1),t.pipeDefs=hl(r,!0),t.id=function yc(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const l of t)n=Math.imul(31,n)+l.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function tu(e){return ii(e)||Tr(e)}function Wo(e){return null!==e}function Nn(e){return Co(()=>({type:e.type,bootstrap:e.bootstrap||ni,declarations:e.declarations||ni,imports:e.imports||ni,exports:e.exports||ni,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function cl(e,n){if(null==e)return cs;const t={};for(const r in e)if(e.hasOwnProperty(r)){let l=e[r],d=l;Array.isArray(l)&&(d=l[1],l=l[0]),t[l]=r,n&&(n[l]=d)}return t}function Rn(e){return Co(()=>{const n=Oa(e);return Na(n),n})}function br(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function ii(e){return e[Qc]||null}function Tr(e){return e[Oo]||null}function cr(e){return e[Xs]||null}function Kr(e,n){const t=e[ol]||null;if(!t&&!0===n)throw new Error(`Type ${ar(e)} does not have '\u0275mod' property.`);return t}function Oa(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||cs,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||ni,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:cl(e.inputs,n),outputs:cl(e.outputs)}}function Na(e){e.features?.forEach(n=>n(e))}function hl(e,n){if(!e)return null;const t=n?cr:tu;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(Wo)}const Yi=0,Jt=1,ft=2,h=3,x=4,M=5,k=6,U=7,X=8,we=9,qe=10,Oe=11,Tt=12,rn=13,bn=14,xn=15,Fr=16,ur=17,Ki=18,Sr=19,Qs=20,Cs=21,Xo=22,ea=23,Ts=24,ri=25,hr=1,$l=2,Jr=7,dl=9,zr=11;function No(e){return Array.isArray(e)&&"object"==typeof e[hr]}function To(e){return Array.isArray(e)&&!0===e[hr]}function lo(e){return 0!=(4&e.flags)}function xc(e){return e.componentOffset>-1}function ju(e){return 1==(1&e.flags)}function ta(e){return!!e.template}function Xd(e){return 0!=(512&e[ft])}function pl(e,n){return e.hasOwnProperty(Zo)?e[Zo]:null}let a=null,f=!1;function _(e){const n=a;return a=e,n}const b={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function I(e){if(!re(e)||e.dirty){if(!e.producerMustRecompute(e)&&!K(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function B(e){e.dirty=!0,function A(e){if(void 0===e.liveConsumerNode)return;const n=f;f=!0;try{for(const t of e.liveConsumerNode)t.dirty||B(t)}finally{f=n}}(e),e.consumerMarkedDirty?.(e)}function z(e){return e&&(e.nextProducerIndex=0),_(e)}function H(e,n){if(_(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(re(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)ne(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function K(e){G(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(I(t),r!==t.version))return!0}return!1}function te(e){if(G(e),re(e))for(let n=0;n<e.producerNode.length;n++)ne(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function ne(e,n){if(function ee(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),G(e),1===e.liveConsumerNode.length)for(let r=0;r<e.producerNode.length;r++)ne(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],l=e.liveConsumerNode[n];G(l),l.producerIndexOfThis[r]=n}}function re(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function G(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let Pe=null;const en=()=>{},wn=(()=>({...b,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:en}))();class Jn{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Kt(){return Ti}function Ti(e){return e.type.prototype.ngOnChanges&&(e.setInput=Fi),Ni}function Ni(){const e=yo(this),n=e?.current;if(n){const t=e.previous;if(t===cs)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function Fi(e,n,t,r){const l=this.declaredInputs[t],d=yo(e)||function co(e,n){return e[Si]=n}(e,{previous:cs,current:null}),y=d.current||(d.current={}),C=d.previous,D=C[l];y[l]=new Jn(D&&D.currentValue,n,C===cs),e[r]=n}Kt.ngInherit=!0;const Si="__ngSimpleChanges__";function yo(e){return e[Si]||null}const _i=function(e,n,t){};function Xn(e){for(;Array.isArray(e);)e=e[Yi];return e}function zi(e,n){return Xn(n[e])}function tr(e,n){return Xn(n[e.index])}function Hl(e,n){return e.data[n]}function Va(e,n){return e[n]}function Br(e,n){const t=n[e];return No(t)?t:t[Yi]}function Ms(e,n){return null==n?null:e[n]}function Zh(e){e[ur]=0}function Ny(e){1024&e[ft]||(e[ft]|=1024,Fy(e,1))}function lg(e){1024&e[ft]&&(e[ft]&=-1025,Fy(e,-1))}function Fy(e,n){let t=e[h];if(null===t)return;t[M]+=n;let r=t;for(t=t[h];null!==t&&(1===n&&1===r[M]||-1===n&&0===r[M]);)t[M]+=n,r=t,t=t[h]}const Zn={lFrame:$y(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function ug(){return Zn.bindingsEnabled}function vt(){return Zn.lFrame.lView}function ti(){return Zn.lFrame.tView}function yi(e){return Zn.lFrame.contextLView=e,e[X]}function vi(e){return Zn.lFrame.contextLView=null,e}function Vr(){let e=By();for(;null!==e&&64===e.type;)e=e.parent;return e}function By(){return Zn.lFrame.currentTNode}function ql(e,n){const t=Zn.lFrame;t.currentTNode=e,t.isParent=n}function dg(){return Zn.lFrame.isParent}function ds(){const e=Zn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function ia(){return Zn.lFrame.bindingIndex++}function Ua(e){const n=Zn.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function jy(e,n){const t=Zn.lFrame;t.bindingIndex=t.bindingRootIndex=e,tf(n)}function tf(e){Zn.lFrame.currentDirectiveIndex=e}function Yh(){return Zn.lFrame.currentQueryIndex}function Cc(e){Zn.lFrame.currentQueryIndex=e}function pg(e){const n=e[Jt];return 2===n.type?n.declTNode:1===n.type?e[k]:null}function nf(e,n,t){if(t&$n.SkipSelf){let l=n,d=e;for(;!(l=l.parent,null!==l||t&$n.Host||(l=pg(d),null===l||(d=d[bn],10&l.type))););if(null===l)return!1;n=l,e=d}const r=Zn.lFrame=mg();return r.currentTNode=n,r.lView=e,!0}function Tp(e){const n=mg(),t=e[Jt];Zn.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function mg(){const e=Zn.lFrame,n=null===e?null:e.child;return null===n?$y(e):n}function $y(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function Dp(){const e=Zn.lFrame;return Zn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gg=Dp;function Gu(){const e=Dp();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Fo(){return Zn.lFrame.selectedIndex}function ru(e){Zn.lFrame.selectedIndex=e}function mr(){const e=Zn.lFrame;return Hl(e.tView,e.selectedIndex)}let Mp=!0;function gr(){return Mp}function Dc(e){Mp=e}function Is(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const d=e.data[t].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:C,ngAfterViewInit:D,ngAfterViewChecked:O,ngOnDestroy:$}=d;y&&(e.contentHooks??=[]).push(-t,y),C&&((e.contentHooks??=[]).push(t,C),(e.contentCheckHooks??=[]).push(t,C)),D&&(e.viewHooks??=[]).push(-t,D),O&&((e.viewHooks??=[]).push(t,O),(e.viewCheckHooks??=[]).push(t,O)),null!=$&&(e.destroyHooks??=[]).push(t,$)}}function Sp(e,n,t){_g(e,n,3,t)}function Ip(e,n,t,r){(3&e[ft])===t&&_g(e,n,t,r)}function Ap(e,n){let t=e[ft];(3&t)===n&&(t&=8191,t+=1,e[ft]=t)}function _g(e,n,t,r){const d=r??-1,y=n.length-1;let C=0;for(let D=void 0!==r?65535&e[ur]:0;D<y;D++)if("number"==typeof n[D+1]){if(C=n[D],null!=r&&C>=r)break}else n[D]<0&&(e[ur]+=65536),(C<d||-1==d)&&(Hy(e,t,n,D),e[ur]=(4294901760&e[ur])+D+2),D++}function ou(e,n){_i(4,e,n);const t=_(null);try{n.call(e)}finally{_(t),_i(5,e,n)}}function Hy(e,n,t,r){const l=t[r]<0,d=t[r+1],C=e[l?-t[r]:t[r]];l?e[ft]>>13<e[ur]>>16&&(3&e[ft])===n&&(e[ft]+=8192,ou(C,d)):ou(C,d)}const qu=-1;class Jh{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function cf(e){return e!==qu}function uo(e){return 32767&e}function Qh(e,n){let t=function vg(e){return e>>16}(e),r=n;for(;t>0;)r=r[bn],t--;return r}let ja=!0;function Pp(e){const n=ja;return ja=e,n}const td=255,sa=5;let $a=0;const Wl={};function uf(e,n){const t=Lp(e,n);if(-1!==t)return t;const r=n[Jt];r.firstCreatePass&&(e.injectorIndex=n.length,xg(r.data,e),xg(n,null),xg(r.blueprint,null));const l=aa(e,n),d=e.injectorIndex;if(cf(l)){const y=uo(l),C=Qh(l,n),D=C[Jt].data;for(let O=0;O<8;O++)n[d+O]=C[y+O]|D[y+O]}return n[d+8]=l,d}function xg(e,n){e.push(0,0,0,0,0,0,0,0,n)}function Lp(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function aa(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,l=n;for(;null!==l;){if(r=Qy(l),null===r)return qu;if(t++,l=l[bn],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return qu}function Mc(e,n,t){!function Rp(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(bs)&&(r=t[bs]),null==r&&(r=t[bs]=$a++);const l=r&td;n.data[e+(l>>sa)]|=1<<l}(e,n,t)}function bg(e,n,t){if(t&$n.Optional||void 0!==e)return e;Pl()}function Yy(e,n,t,r){if(t&$n.Optional&&void 0===r&&(r=null),!(t&($n.Self|$n.Host))){const l=e[we],d=Yr(void 0);try{return l?l.get(n,r,t&$n.Optional):Kc(n,r,t&$n.Optional)}finally{Yr(d)}}return bg(r,0,t)}function hf(e,n,t,r=$n.Default,l){if(null!==e){if(2048&n[ft]&&!(r&$n.Self)){const y=function $x(e,n,t,r,l){let d=e,y=n;for(;null!==d&&null!==y&&2048&y[ft]&&!(512&y[ft]);){const C=kp(d,y,t,r|$n.Self,Wl);if(C!==Wl)return C;let D=d.parent;if(!D){const O=y[Qs];if(O){const $=O.get(t,Wl,r);if($!==Wl)return $}D=Qy(y),y=y[bn]}d=D}return l}(e,n,t,r,Wl);if(y!==Wl)return y}const d=kp(e,n,t,r,Wl);if(d!==Wl)return d}return Yy(n,t,r,l)}function kp(e,n,t,r,l){const d=function Op(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(bs)?e[bs]:void 0;return"number"==typeof n?n>=0?n&td:Jy:n}(t);if("function"==typeof d){if(!nf(n,e,r))return r&$n.Host?bg(l,0,r):Yy(n,t,r,l);try{let y;if(y=d(r),null!=y||r&$n.Optional)return y;Pl()}finally{gg()}}else if("number"==typeof d){let y=null,C=Lp(e,n),D=qu,O=r&$n.Host?n[xn][k]:null;for((-1===C||r&$n.SkipSelf)&&(D=-1===C?aa(e,n):n[C+8],D!==qu&&id(r,!1)?(y=n[Jt],C=uo(D),n=Qh(D,n)):C=-1);-1!==C;){const $=n[Jt];if(wg(d,C,$.data)){const W=nd(C,n,t,y,r,O);if(W!==Wl)return W}D=n[C+8],D!==qu&&id(r,n[Jt].data[C+8]===O)&&wg(d,C,n)?(y=$,C=uo(D),n=Qh(D,n)):C=-1}}return l}function nd(e,n,t,r,l,d){const y=n[Jt],C=y.data[e+8],$=Sc(C,y,t,null==r?xc(C)&&ja:r!=y&&0!=(3&C.type),l&$n.Host&&d===C);return null!==$?gl(n,y,$,C):Wl}function Sc(e,n,t,r,l){const d=e.providerIndexes,y=n.data,C=1048575&d,D=e.directiveStart,$=d>>20,oe=l?C+$:e.directiveEnd;for(let be=r?C:C+$;be<oe;be++){const Ye=y[be];if(be<D&&t===Ye||be>=D&&Ye.type===t)return be}if(l){const be=y[D];if(be&&ta(be)&&be.type===t)return D}return null}function gl(e,n,t,r){let l=e[t];const d=n.data;if(function Gy(e){return e instanceof Jh}(l)){const y=l;y.resolving&&function $o(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new Mt(-200,`Circular dependency in DI detected for ${e}${t}`)}(function on(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():cn(e)}(d[t]));const C=Pp(y.canSeeViewProviders);y.resolving=!0;const O=y.injectImpl?Yr(y.injectImpl):null;nf(e,r,$n.Default);try{l=e[t]=y.factory(void 0,d,e,r),n.firstCreatePass&&t>=r.directiveStart&&function af(e,n,t){const{ngOnChanges:r,ngOnInit:l,ngDoCheck:d}=n.type.prototype;if(r){const y=Ti(n);(t.preOrderHooks??=[]).push(e,y),(t.preOrderCheckHooks??=[]).push(e,y)}l&&(t.preOrderHooks??=[]).push(0-e,l),d&&((t.preOrderHooks??=[]).push(e,d),(t.preOrderCheckHooks??=[]).push(e,d))}(t,d[t],n)}finally{null!==O&&Yr(O),Pp(C),y.resolving=!1,gg()}}return l}function wg(e,n,t){return!!(t[n+(e>>sa)]&1<<e)}function id(e,n){return!(e&$n.Self||e&$n.Host&&n)}class ho{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return hf(this._tNode,this._lView,n,Ws(r),t)}}function Jy(){return new ho(Vr(),vt())}function xo(e){return Co(()=>{const n=e.prototype.constructor,t=n[Zo]||Np(n),r=Object.prototype;let l=Object.getPrototypeOf(e.prototype).constructor;for(;l&&l!==r;){const d=l[Zo]||Np(l);if(d&&d!==t)return d;l=Object.getPrototypeOf(l)}return d=>new d})}function Np(e){return tl(e)?()=>{const n=Np(Pn(e));return n&&n()}:pl(e)}function Qy(e){const n=e[Jt],t=n.type;return 2===t?n.declTNode:1===t?e[k]:null}const la="__parameters__";function fs(e,n,t){return Co(()=>{const r=function Ha(e){return function(...t){if(e){const r=e(...t);for(const l in r)this[l]=r[l]}}}(n);function l(...d){if(this instanceof l)return r.apply(this,d),this;const y=new l(...d);return C.annotation=y,C;function C(D,O,$){const W=D.hasOwnProperty(la)?D[la]:Object.defineProperty(D,la,{value:[]})[la];for(;W.length<=$;)W.push(null);return(W[$]=W[$]||[]).push(y),D}}return t&&(l.prototype=Object.create(t.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}function Ac(e,n){e.forEach(t=>Array.isArray(t)?Ac(t,n):n(t))}function pf(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function rd(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function ua(e,n,t){let r=Yu(e,n);return r>=0?e[1|r]=t:(r=~r,function Xx(e,n,t,r){let l=e.length;if(l==n)e.push(t,r);else if(1===l)e.push(r,e[0]),e[0]=t;else{for(l--,e.push(e[l-1],e[l]);l>n;)e[l]=e[l-2],l--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function mf(e,n){const t=Yu(e,n);if(t>=0)return e[1|t]}function Yu(e,n){return function au(e,n,t){let r=0,l=e.length>>t;for(;l!==r;){const d=r+(l-r>>1),y=e[d<<t];if(n===y)return d<<t;y>n?l=d:r=d+1}return~(l<<t)}(e,n,1)}const Vp=rl(fs("Optional"),8),Up=rl(fs("SkipSelf"),4);function hd(e){return 128==(128&e.flags)}var Yl=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Yl||{});const Rg=new Map;let ob=0;const kg="__ngContext__";function Vo(e,n){No(n)?(e[kg]=n[Sr],function ab(e){Rg.set(e[Sr],e)}(n)):e[kg]=n}let Jp;function eh(e,n){return Jp(e,n)}function wf(e){const n=e[h];return To(n)?n[h]:n}function Og(e){return Fg(e[Tt])}function Ng(e){return Fg(e[x])}function Fg(e){for(;null!==e&&!To(e);)e=e[x];return e}function th(e,n,t,r,l){if(null!=r){let d,y=!1;To(r)?d=r:No(r)&&(y=!0,r=r[Yi]);const C=Xn(r);0===e&&null!==t?null==l?jg(n,t,C):ih(n,t,C,l||null,!0):1===e&&null!==t?ih(n,t,C,l||null,!0):2===e?function im(e,n,t){const r=nm(e,n);r&&function Sv(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,C,y):3===e&&n.destroyNode(C),null!=d&&function Rv(e,n,t,r,l){const d=t[Jr];d!==Xn(t)&&th(n,e,r,d,l);for(let C=zr;C<t.length;C++){const D=t[C];Mf(D[Jt],D,e,n,r,d)}}(n,e,d,t,l)}}function nh(e,n,t){return e.createElement(n,t)}function zg(e,n){const t=e[dl],r=t.indexOf(n);lg(n),t.splice(r,1)}function tm(e,n){if(e.length<=zr)return;const t=zr+n,r=e[t];if(r){const l=r[Fr];null!==l&&l!==e&&zg(l,r),n>0&&(e[t-1][x]=r[x]);const d=rd(e,zr+n);!function Dv(e,n){Mf(e,n,n[Oe],2,null,null),n[Yi]=null,n[k]=null}(r[Jt],r);const y=d[Ki];null!==y&&y.detachView(d[Jt]),r[h]=null,r[x]=null,r[ft]&=-129}return r}function Bg(e,n){if(!(256&n[ft])){const t=n[Oe];n[ea]&&te(n[ea]),n[Ts]&&te(n[Ts]),t.destroyNode&&Mf(e,n,t,3,null,null),function fd(e){let n=e[Tt];if(!n)return Vg(e[Jt],e);for(;n;){let t=null;if(No(n))t=n[Tt];else{const r=n[zr];r&&(t=r)}if(!t){for(;n&&!n[x]&&n!==e;)No(n)&&Vg(n[Jt],n),n=n[h];null===n&&(n=e),No(n)&&Vg(n[Jt],n),t=n&&n[x]}n=t}}(n)}}function Vg(e,n){if(!(256&n[ft])){n[ft]&=-129,n[ft]|=256,function db(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const l=n[t[r]];if(!(l instanceof Jh)){const d=t[r+1];if(Array.isArray(d))for(let y=0;y<d.length;y+=2){const C=l[d[y]],D=d[y+1];_i(4,C,D);try{D.call(C)}finally{_i(5,C,D)}}else{_i(4,l,d);try{d.call(l)}finally{_i(5,l,d)}}}}}(e,n),function hb(e,n){const t=e.cleanup,r=n[U];if(null!==t)for(let d=0;d<t.length-1;d+=2)if("string"==typeof t[d]){const y=t[d+3];y>=0?r[y]():r[-y].unsubscribe(),d+=2}else t[d].call(r[t[d+1]]);null!==r&&(n[U]=null);const l=n[Cs];if(null!==l){n[Cs]=null;for(let d=0;d<l.length;d++)(0,l[d])()}}(e,n),1===n[Jt].type&&n[Oe].destroy();const t=n[Fr];if(null!==t&&To(n[h])){t!==n[h]&&zg(t,n);const r=n[Ki];null!==r&&r.detachView(e)}!function lb(e){Rg.delete(e[Sr])}(n)}}function Ug(e,n,t){return function Tf(e,n,t){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return t[Yi];{const{componentOffset:l}=r;if(l>-1){const{encapsulation:d}=e.data[r.directiveStart+l];if(d===xr.None||d===xr.Emulated)return null}return tr(r,t)}}(e,n.parent,t)}function ih(e,n,t,r,l){e.insertBefore(n,t,r,l)}function jg(e,n,t){e.appendChild(n,t)}function $g(e,n,t,r,l){null!==r?ih(e,n,t,r,l):jg(e,n,t)}function nm(e,n){return e.parentNode(n)}let Gg,Wg,om,Hg=function Av(e,n,t){return 40&e.type?tr(e,t):null};function Ps(e,n,t,r){const l=Ug(e,r,n),d=n[Oe],C=function Iv(e,n,t){return Hg(e,n,t)}(r.parent||n[k],r,n);if(null!=l)if(Array.isArray(t))for(let D=0;D<t.length;D++)$g(d,l,t[D],C,!1);else $g(d,l,t,C,!1);void 0!==Gg&&Gg(d,r,n,t,l)}function rh(e,n){if(null!==n){const t=n.type;if(3&t)return tr(n,e);if(4&t)return uu(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return rh(e,r);{const l=e[n.index];return To(l)?uu(-1,l):Xn(l)}}if(32&t)return eh(n,e)()||Xn(e[n.index]);{const r=Df(e,n);return null!==r?Array.isArray(r)?r[0]:rh(wf(e[xn]),r):rh(e,n.next)}}return null}function Df(e,n){return null!==n?e[xn][k].projection[n.projection]:null}function uu(e,n){const t=zr+e+1;if(t<n.length){const r=n[t],l=r[Jt].firstChild;if(null!==l)return rh(r,l)}return n[Jr]}function oh(e,n,t,r,l,d,y){for(;null!=t;){const C=r[t.index],D=t.type;if(y&&0===n&&(C&&Vo(Xn(C),r),t.flags|=2),32!=(32&t.flags))if(8&D)oh(e,n,t.child,r,l,d,!1),th(n,e,l,C,d);else if(32&D){const O=eh(t,r);let $;for(;$=O();)th(n,e,l,$,d);th(n,e,l,C,d)}else 16&D?qg(e,n,r,t,l,d):th(n,e,l,C,d);t=y?t.projectionNext:t.next}}function Mf(e,n,t,r,l,d){oh(t,r,e.firstChild,n,l,d,!1)}function qg(e,n,t,r,l,d){const y=t[xn],D=y[k].projection[r.projection];if(Array.isArray(D))for(let O=0;O<D.length;O++)th(n,e,l,D[O],d);else{let O=D;const $=y[h];hd(r)&&(O.flags|=128),oh(e,n,O,$,l,d,!0)}}function rm(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function Zg(e,n,t){const{mergedAttrs:r,classes:l,styles:d}=t;null!==r&&Ys(e,n,r),null!==l&&rm(e,n,l),null!==d&&function $i(e,n,t){e.setAttribute(n,"style",t)}(e,n,d)}function sh(e){return function Xg(){if(void 0===om&&(om=null,Di.trustedTypes))try{om=Di.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return om}()?.createScriptURL(e)||e}class Yg{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Ma})`}}function Rc(e){return e instanceof Yg?e.changingThisBreaksApplicationSecurity:e}function ah(e,n){const t=function ps(e){return e instanceof Yg&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${Ma})`)}return t===n}const Fv=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var xl=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(xl||{});function pm(e){const n=Kl();return n?n.sanitize(xl.URL,e)||"":ah(e,"URL")?Rc(e):function cm(e){return(e=String(e)).match(Fv)?e:"unsafe:"+e}(cn(e))}function Lf(e){const n=Kl();if(n)return sh(n.sanitize(xl.RESOURCE_URL,e)||"");if(ah(e,"ResourceURL"))return sh(Rc(e));throw new Mt(904,!1)}function Kl(){const e=vt();return e&&e[qe].sanitizer}const ch=new Xt("ENVIRONMENT_INITIALIZER"),$v=new Xt("INJECTOR",-1),n_=new Xt("INJECTOR_DEF_TYPES");class i_{get(n,t=Zs){if(t===Zs){const r=new Error(`NullInjectorError: No provider for ${ar(n)}!`);throw r.name="NullInjectorError",r}return t}}function Pb(...e){return{\u0275providers:_d(0,e),\u0275fromNgModule:!0}}function _d(e,...n){const t=[],r=new Set;let l;const d=y=>{t.push(y)};return Ac(n,y=>{const C=y;Nf(C,d,[],r)&&(l||=[],l.push(C))}),void 0!==l&&kc(l,d),t}function kc(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:l}=e[t];yd(l,d=>{n(d,r)})}}function Nf(e,n,t,r){if(!(e=Pn(e)))return!1;let l=null,d=Pa(e);const y=!d&&ii(e);if(d||y){if(y&&!y.standalone)return!1;l=e}else{const D=e.ngModule;if(d=Pa(D),!d)return!1;l=D}const C=r.has(l);if(y){if(C)return!1;if(r.add(l),y.dependencies){const D="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const O of D)Nf(O,n,t,r)}}else{if(!d)return!1;{if(null!=d.imports&&!C){let O;r.add(l);try{Ac(d.imports,$=>{Nf($,n,t,r)&&(O||=[],O.push($))})}finally{}void 0!==O&&kc(O,n)}if(!C){const O=pl(l)||(()=>new l);n({provide:l,useFactory:O,deps:ni},l),n({provide:n_,useValue:l,multi:!0},l),n({provide:ch,useValue:()=>sn(l),multi:!0},l)}const D=d.providers;if(null!=D&&!C){const O=e;yd(D,$=>{n($,O)})}}}return l!==e&&void 0!==e.providers}function yd(e,n){for(let t of e)$s(t)&&(t=t.\u0275providers),Array.isArray(t)?yd(t,n):n(t)}const r_=jn({provide:String,useValue:jn});function o_(e){return null!==e&&"object"==typeof e&&r_ in e}function uh(e){return"function"==typeof e}const a_=new Xt("Set Injector scope."),pu={},Ff={};let hh;function mu(){return void 0===hh&&(hh=new i_),hh}class Qo{}class vd extends Qo{get destroyed(){return this._destroyed}constructor(n,t,r,l){super(),this.parent=t,this.source=r,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,c_(n,y=>this.processProvider(y)),this.records.set($v,dh(void 0,this)),l.has("environment")&&this.records.set(Qo,dh(void 0,this));const d=this.records.get(a_);null!=d&&"string"==typeof d.value&&this.scopes.add(d.value),this.injectorDefTypes=new Set(this.get(n_.multi,ni,$n.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=jr(this),r=Yr(void 0);try{return n()}finally{jr(t),Yr(r)}}get(n,t=Zs,r=$n.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(eu))return n[eu](this);r=Ws(r);const d=jr(this),y=Yr(void 0);try{if(!(r&$n.SkipSelf)){let D=this.records.get(n);if(void 0===D){const O=function qv(e){return"function"==typeof e||"object"==typeof e&&e instanceof Xt}(n)&&Gs(n);D=O&&this.injectableDefInScope(O)?dh(l_(n),pu):null,this.records.set(n,D)}if(null!=D)return this.hydrate(n,D)}return(r&$n.Self?mu():this.parent).get(n,t=r&$n.Optional&&t===Zs?null:t)}catch(C){if("NullInjectorError"===C.name){if((C[vs]=C[vs]||[]).unshift(ar(n)),d)throw C;return function zl(e,n,t,r){const l=e[vs];throw n[Go]&&l.unshift(n[Go]),e.message=function xs(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let l=ar(n);if(Array.isArray(n))l=n.map(ar).join(" -> ");else if("object"==typeof n){let d=[];for(let y in n)if(n.hasOwnProperty(y)){let C=n[y];d.push(y+":"+("string"==typeof C?JSON.stringify(C):ar(C)))}l=`{${d.join(", ")}}`}return`${t}${r?"("+r+")":""}[${l}]: ${e.replace(Vh,"\n  ")}`}("\n"+e.message,l,t,r),e.ngTokenPath=l,e[vs]=null,e}(C,n,"R3InjectorError",this.source)}throw C}finally{Yr(y),jr(d)}}resolveInjectorInitializers(){const n=jr(this),t=Yr(void 0);try{const l=this.get(ch.multi,ni,$n.Self);for(const d of l)d()}finally{jr(n),Yr(t)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(ar(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Mt(205,!1)}processProvider(n){let t=uh(n=Pn(n))?n:Pn(n&&n.provide);const r=function gm(e){return o_(e)?dh(void 0,e.useValue):dh(Hv(e),pu)}(n);if(uh(n)||!0!==n.multi)this.records.get(t);else{let l=this.records.get(t);l||(l=dh(void 0,pu,!0),l.factory=()=>ls(l.multi),this.records.set(t,l)),t=n,l.multi.push(n)}this.records.set(t,r)}hydrate(n,t){return t.value===pu&&(t.value=Ff,t.value=t.factory()),"object"==typeof t.value&&t.value&&function Lb(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Pn(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function l_(e){const n=Gs(e),t=null!==n?n.factory:pl(e);if(null!==t)return t;if(e instanceof Xt)throw new Mt(204,!1);if(e instanceof Function)return function xd(e){const n=e.length;if(n>0)throw function od(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(n,"?"),new Mt(204,!1);const t=function Yc(e){return e&&(e[Ll]||e[fi])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new Mt(204,!1)}function Hv(e,n,t){let r;if(uh(e)){const l=Pn(e);return pl(l)||l_(l)}if(o_(e))r=()=>Pn(e.useValue);else if(function du(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...ls(e.deps||[]));else if(function s_(e){return!(!e||!e.useExisting)}(e))r=()=>sn(Pn(e.useExisting));else{const l=Pn(e&&(e.useClass||e.provide));if(!function Gv(e){return!!e.deps}(e))return pl(l)||l_(l);r=()=>new l(...ls(e.deps))}return r}function dh(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function c_(e,n){for(const t of e)Array.isArray(t)?c_(t,n):t&&$s(t)?c_(t.\u0275providers,n):n(t)}const zf=new Xt("AppId",{providedIn:"root",factory:()=>kb}),kb="ng",u_=new Xt("Platform Initializer"),fh=new Xt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Bf=new Xt("CSP nonce",{providedIn:"root",factory:()=>function pd(){if(void 0!==Wg)return Wg;if(typeof document<"u")return document;throw new Mt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let g_=(e,n,t)=>null;function Ql(e,n,t=!1){return g_(e,n,t)}class Xv{}class y_{}class Kv{resolveComponentFactory(n){throw function Yv(e){const n=Error(`No component factory found for ${ar(e)}.`);return n.ngComponent=e,n}(n)}}let bm=(()=>{class e{static#e=this.NULL=new Kv}return e})();function zb(){return Oc(Vr(),vt())}function Oc(e,n){return new ha(tr(e,n))}let ha=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=zb}return e})();function Td(e){return e instanceof ha?e.nativeElement:e}class wm{}let Za=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function ec(){const e=vt(),t=Br(Vr().index,e);return(No(t)?t:e)[Oe]}()}return e})(),x_=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>null})}return e})();class gh{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const wl=new gh("16.2.11"),Nc={};function Tm(e,n=null,t=null,r){const l=E_(e,n,t,r);return l.resolveInjectorInitializers(),l}function E_(e,n=null,t=null,r,l=new Set){const d=[t||ni,Pb(e)];return r=r||("object"==typeof e?void 0:ar(e)),new vd(d,n||mu(),r||null,l)}let Rs=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=Zs;static#t=this.NULL=new i_;static create(t,r){if(Array.isArray(t))return Tm({name:""},r,t,"");{const l=t.name??"";return Tm({name:l},t.parent,t.providers,l)}}static#n=this.\u0275prov=an({token:e,providedIn:"any",factory:()=>sn($v)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function qf(e){return e.ngOriginalError}class tc{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&qf(n);for(;t&&qf(t);)t=qf(t);return t||null}}function i(e){return n=>{setTimeout(e,void 0,n)}}const s=class o extends Mn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,r){let l=n,d=t||(()=>null),y=r;if(n&&"object"==typeof n){const D=n;l=D.next?.bind(D),d=D.error?.bind(D),y=D.complete?.bind(D)}this.__isAsync&&(d=i(d),l&&(l=i(l)),y&&(y=i(y)));const C=super.subscribe({next:l,error:d,complete:y});return n instanceof Le&&n.add(C),C}};function c(...e){}class v{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new s(!1),this.onMicrotaskEmpty=new s(!1),this.onStable=new s(!1),this.onError=new s(!1),typeof Zone>"u")throw new Mt(908,!1);Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!r&&t,l.shouldCoalesceRunChangeDetection=r,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function p(){const e="function"==typeof Di.requestAnimationFrame;let n=Di[e?"requestAnimationFrame":"setTimeout"],t=Di[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const l=t[Zone.__symbol__("OriginalDelegate")];l&&(t=l)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function P(e){const n=()=>{!function S(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Di,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,N(e),e.isCheckStableRunning=!0,T(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),N(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,l,d,y,C)=>{if(function se(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(C))return t.invokeTask(l,d,y,C);try{return F(e),t.invokeTask(l,d,y,C)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===d.type||e.shouldCoalesceRunChangeDetection)&&n(),V(e)}},onInvoke:(t,r,l,d,y,C,D)=>{try{return F(e),t.invoke(l,d,y,C,D)}finally{e.shouldCoalesceRunChangeDetection&&n(),V(e)}},onHasTask:(t,r,l,d)=>{t.hasTask(l,d),r===l&&("microTask"==d.change?(e._hasPendingMicrotasks=d.microTask,N(e),T(e)):"macroTask"==d.change&&(e.hasPendingMacrotasks=d.macroTask))},onHandleError:(t,r,l,d)=>(t.handleError(l,d),e.runOutsideAngular(()=>e.onError.emit(d)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!v.isInAngularZone())throw new Mt(909,!1)}static assertNotInAngularZone(){if(v.isInAngularZone())throw new Mt(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,l){const d=this._inner,y=d.scheduleEventTask("NgZoneEvent: "+l,n,w,c,c);try{return d.runTask(y,t,r)}finally{d.cancelTask(y)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const w={};function T(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function N(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function F(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function V(e){e._nesting--,T(e)}class j{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new s,this.onMicrotaskEmpty=new s,this.onStable=new s,this.onError=new s}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,l){return n.apply(t,r)}}const q=new Xt("",{providedIn:"root",factory:J});function J(){const e=tn(v);let n=!0;return function vn(...e){const n=_o(e),t=function Vs(e,n){return"number"==typeof lc(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?Mi(r[0]):Ca(t)(ot(r,n)):oo}(new In(l=>{n=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{l.next(n),l.complete()})}),new In(l=>{let d;e.runOutsideAngular(()=>{d=e.onStable.subscribe(()=>{v.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(n=!0,l.next(!0))})})});const y=e.onUnstable.subscribe(()=>{v.assertInAngularZone(),n&&(n=!1,e.runOutsideAngular(()=>{l.next(!1)}))});return()=>{d.unsubscribe(),y.unsubscribe()}}).pipe(sr()))}function _e(e){return e instanceof Function?e():e}let ht=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>new e})}return e})();function ct(e){for(;e;){e[ft]|=64;const n=wf(e);if(Xd(e)&&!n)return e;e=n}return null}const rt=new Xt("",{providedIn:"root",factory:()=>!1});let Fn=null;function Ai(e,n){return e[n]??dr()}function Bi(e,n){const t=dr();t.producerNode?.length&&(e[n]=Fn,t.lView=e,Fn=Pi())}const Gi={...b,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{ct(e.lView)},lView:null};function Pi(){return Object.create(Gi)}function dr(){return Fn??=Pi(),Fn}const pn={};function $e(e){Ri(ti(),vt(),Fo()+e,!1)}function Ri(e,n,t,r){if(!r)if(3==(3&n[ft])){const d=e.preOrderCheckHooks;null!==d&&Sp(n,d,t)}else{const d=e.preOrderHooks;null!==d&&Ip(n,d,0,t)}ru(t)}function Qe(e,n=$n.Default){const t=vt();return null===t?sn(e,n):hf(Vr(),t,Pn(e),n)}function ui(e,n,t,r,l,d,y,C,D,O,$){const W=n.blueprint.slice();return W[Yi]=l,W[ft]=140|r,(null!==O||e&&2048&e[ft])&&(W[ft]|=2048),Zh(W),W[h]=W[bn]=e,W[X]=t,W[qe]=y||e&&e[qe],W[Oe]=C||e&&e[Oe],W[we]=D||e&&e[we]||null,W[k]=d,W[Sr]=function sb(){return ob++}(),W[Xo]=$,W[Qs]=O,W[xn]=2==n.type?e[xn]:W,W}function fr(e,n,t,r,l){let d=e.data[n];if(null===d)d=function Li(e,n,t,r,l){const d=By(),y=dg(),D=e.data[n]=function M_(e,n,t,r,l,d){let y=n?n.injectorIndex:-1,C=0;return function Wh(){return null!==Zn.skipHydrationRootTNode}()&&(C|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:C,providerIndexes:0,value:l,attrs:d,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?d:d&&d.parent,t,n,r,l);return null===e.firstChild&&(e.firstChild=D),null!==d&&(y?null==d.child&&null!==D.parent&&(d.child=D):null===d.next&&(d.next=D,D.prev=d)),D}(e,n,t,r,l),function Ss(){return Zn.lFrame.inI18n}()&&(d.flags|=32);else if(64&d.type){d.type=t,d.value=r,d.attrs=l;const y=function ef(){const e=Zn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();d.injectorIndex=null===y?-1:y.injectorIndex}return ql(d,!0),d}function po(e,n,t,r){if(0===t)return-1;const l=n.length;for(let d=0;d<t;d++)n.push(r),e.blueprint.push(r),e.data.push(null);return l}function Ar(e,n,t,r,l){const d=Ai(n,ea),y=Fo(),C=2&r;try{ru(-1),C&&n.length>ri&&Ri(e,n,ri,!1),_i(C?2:0,l);const O=C?d:null,$=z(O);try{null!==O&&(O.dirty=!1),t(r,l)}finally{H(O,$)}}finally{C&&null===n[ea]&&Bi(n,ea),ru(y),_i(C?3:1,l)}}function eo(e,n,t){if(lo(n)){const r=_(null);try{const d=n.directiveEnd;for(let y=n.directiveStart;y<d;y++){const C=e.data[y];C.contentQueries&&C.contentQueries(1,t[y],y)}}finally{_(r)}}}function Hr(e,n,t){ug()&&(function A_(e,n,t,r){const l=t.directiveStart,d=t.directiveEnd;xc(t)&&function D2(e,n,t){const r=tr(n,e),l=to(t);let y=16;t.signals?y=4096:t.onPush&&(y=64);const C=l0(e,ui(e,l,null,y,r,n,null,e[qe].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=C}(n,t,e.data[l+t.componentOffset]),e.firstCreatePass||uf(t,n),Vo(r,n);const y=t.initialInputs;for(let C=l;C<d;C++){const D=e.data[C],O=gl(n,e,C,t);Vo(O,n),null!==y&&M2(0,C-l,O,D,0,y),ta(D)&&(Br(t.index,n)[X]=gl(n,e,C,t))}}(e,n,t,tr(t,n)),64==(64&t.flags)&&P_(e,n,t))}function Mo(e,n,t=tr){const r=n.localNames;if(null!==r){let l=n.index+1;for(let d=0;d<r.length;d+=2){const y=r[d+1],C=-1===y?t(n,e):e[y];e[l++]=C}}}function to(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=da(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function da(e,n,t,r,l,d,y,C,D,O,$){const W=ri+r,oe=W+l,be=function Md(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:pn);return t}(W,oe),Ye="function"==typeof O?O():O;return be[Jt]={type:e,blueprint:be,template:t,queries:null,viewQuery:C,declTNode:n,data:be.slice().fill(null,W),bindingStartIndex:W,expandoStartIndex:oe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof d?d():d,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:D,consts:Ye,incompleteFirstPass:!1,ssrId:$}}let D_=e=>null;function Dm(e,n,t,r){for(let l in e)if(e.hasOwnProperty(l)){t=null===t?{}:t;const d=e[l];null===r?El(t,n,l,d):r.hasOwnProperty(l)&&El(t,n,r[l],d)}return t}function El(e,n,t,r){e.hasOwnProperty(t)?e[t].push(n,r):e[t]=[n,r]}function ms(e,n,t,r,l,d,y,C){const D=tr(n,t);let $,O=n.inputs;!C&&null!=O&&($=O[r])?(Gb(e,t,$,r,l),xc(n)&&function S_(e,n){const t=Br(n,e);16&t[ft]||(t[ft]|=64)}(t,n.index)):3&n.type&&(r=function yh(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),l=null!=y?y(l,n.value||"",r):l,d.setProperty(D,r,l))}function I_(e,n,t,r){if(ug()){const l=null===r?null:{"":-1},d=function b2(e,n){const t=e.directiveRegistry;let r=null,l=null;if(t)for(let d=0;d<t.length;d++){const y=t[d];if(ka(n,y.selectors,!1))if(r||(r=[]),ta(y))if(null!==y.findHostDirectiveDefs){const C=[];l=l||new Map,y.findHostDirectiveDefs(y,C,l),r.unshift(...C,y),jb(e,n,C.length)}else r.unshift(y),jb(e,n,0);else l=l||new Map,y.findHostDirectiveDefs?.(y,r,l),r.push(y)}return null===r?null:[r,l]}(e,t);let y,C;null===d?y=C=null:[y,C]=d,null!==y&&gs(e,n,t,y,l,C),l&&function w2(e,n,t){if(n){const r=e.localNames=[];for(let l=0;l<n.length;l+=2){const d=t[n[l+1]];if(null==d)throw new Mt(-301,!1);r.push(n[l],d)}}}(t,r,l)}t.mergedAttrs=Js(t.mergedAttrs,t.attrs)}function gs(e,n,t,r,l,d){for(let O=0;O<r.length;O++)Mc(uf(t,n),e,r[O].type);!function C2(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let O=0;O<r.length;O++){const $=r[O];$.providersResolver&&$.providersResolver($)}let y=!1,C=!1,D=po(e,n,r.length,null);for(let O=0;O<r.length;O++){const $=r[O];t.mergedAttrs=Js(t.mergedAttrs,$.hostAttrs),T2(e,t,n,D,$),E2(D,$,l),null!==$.contentQueries&&(t.flags|=4),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(t.flags|=64);const W=$.type.prototype;!y&&(W.ngOnChanges||W.ngOnInit||W.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),y=!0),!C&&(W.ngOnChanges||W.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),C=!0),D++}!function s0(e,n,t){const l=n.directiveEnd,d=e.data,y=n.attrs,C=[];let D=null,O=null;for(let $=n.directiveStart;$<l;$++){const W=d[$],oe=t?t.get(W):null,Ye=oe?oe.outputs:null;D=Dm(W.inputs,$,D,oe?oe.inputs:null),O=Dm(W.outputs,$,O,Ye);const nt=null===D||null===y||Uu(n)?null:S2(D,$,y);C.push(nt)}null!==D&&(D.hasOwnProperty("class")&&(n.flags|=8),D.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=C,n.inputs=D,n.outputs=O}(e,t,d)}function P_(e,n,t){const r=t.directiveStart,l=t.directiveEnd,d=t.index,y=function ml(){return Zn.lFrame.currentDirectiveIndex}();try{ru(d);for(let C=r;C<l;C++){const D=e.data[C],O=n[C];tf(C),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&vh(D,O)}}finally{ru(-1),tf(y)}}function vh(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function jb(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function E2(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;ta(n)&&(t[""]=e)}}function T2(e,n,t,r,l){e.data[r]=l;const d=l.factory||(l.factory=pl(l.type)),y=new Jh(d,ta(l),Qe);e.blueprint[r]=y,t[r]=y,function Ls(e,n,t,r,l){const d=l.hostBindings;if(d){let y=e.hostBindingOpCodes;null===y&&(y=e.hostBindingOpCodes=[]);const C=~n.index;(function Xf(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(y)!=C&&y.push(C),y.push(t,r,d)}}(e,n,r,po(e,t,l.hostVars,pn),l)}function xu(e,n,t,r,l,d){const y=tr(e,n);!function $b(e,n,t,r,l,d,y){if(null==d)e.removeAttribute(n,l,t);else{const C=null==y?cn(d):y(d,r||"",l);e.setAttribute(n,l,C,t)}}(n[Oe],y,d,e.value,t,r,l)}function M2(e,n,t,r,l,d){const y=d[n];if(null!==y)for(let C=0;C<y.length;)XE(r,t,y[C++],y[C++],y[C++])}function XE(e,n,t,r,l){const d=_(null);try{const y=e.inputTransforms;null!==y&&y.hasOwnProperty(r)&&(l=y[r].call(n,l)),null!==e.setInput?e.setInput(n,l,t,r):n[r]=l}finally{_(d)}}function S2(e,n,t){let r=null,l=0;for(;l<t.length;){const d=t[l];if(0!==d)if(5!==d){if("number"==typeof d)break;if(e.hasOwnProperty(d)){null===r&&(r=[]);const y=e[d];for(let C=0;C<y.length;C+=2)if(y[C]===n){r.push(d,y[C+1],t[l+1]);break}}l+=2}else l+=2;else l+=4}return r}function YE(e,n,t,r){return[e,!0,!1,n,null,0,r,t,null,null,null]}function KE(e,n){const t=e.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const d=t[r+1];if(-1!==d){const y=e.data[d];Cc(t[r]),y.contentQueries(2,n[d],d)}}}function l0(e,n){return e[Tt]?e[rn][x]=n:e[Tt]=n,e[rn]=n,n}function Hb(e,n,t){Cc(0);const r=_(null);try{n(e,t)}finally{_(r)}}function JE(e){return e[U]||(e[U]=[])}function QE(e){return e.cleanup||(e.cleanup=[])}function tC(e,n){const t=e[we],r=t?t.get(tc,null):null;r&&r.handleError(n)}function Gb(e,n,t,r,l){for(let d=0;d<t.length;){const y=t[d++],C=t[d++];XE(e.data[y],n[y],r,C,l)}}function xh(e,n,t){const r=zi(n,e);!function Tv(e,n,t){e.setValue(n,t)}(e[Oe],r,t)}function I2(e,n){const t=Br(n,e),r=t[Jt];!function A2(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const l=t[Yi];null!==l&&null===t[Xo]&&(t[Xo]=Ql(l,t[we])),qb(r,t,t[X])}function qb(e,n,t){Tp(n);try{const r=e.viewQuery;null!==r&&Hb(1,r,t);const l=e.template;null!==l&&Ar(e,n,l,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&KE(e,n),e.staticViewQueries&&Hb(2,e.viewQuery,t);const d=e.components;null!==d&&function P2(e,n){for(let t=0;t<n.length;t++)I2(e,n[t])}(n,d)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[ft]&=-5,Gu()}}let nC=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,r,l){const d=typeof Zone>"u"?null:Zone.current,y=function Ln(e,n,t){const r=Object.create(wn);t&&(r.consumerAllowSignalWrites=!0),r.fn=e,r.schedule=n;const l=y=>{r.cleanupFn=y};return r.ref={notify:()=>B(r),run:()=>{if(r.dirty=!1,r.hasRun&&!K(r))return;r.hasRun=!0;const y=z(r);try{r.cleanupFn(),r.cleanupFn=en,r.fn(l)}finally{H(r,y)}},cleanup:()=>r.cleanupFn()},r.ref}(t,O=>{this.all.has(O)&&this.queue.set(O,d)},l);let C;this.all.add(y),y.notify();const D=()=>{y.cleanup(),C?.(),this.all.delete(y),this.queue.delete(y)};return C=r?.onDestroy(D),{destroy:D}}flush(){if(0!==this.queue.size)for(const[t,r]of this.queue)this.queue.delete(t),r?r.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>new e})}return e})();function c0(e,n,t){let r=t?e.styles:null,l=t?e.classes:null,d=0;if(null!==n)for(let y=0;y<n.length;y++){const C=n[y];"number"==typeof C?d=C:1==d?l=Po(l,C):2==d&&(r=Po(r,C+": "+n[++y]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=l:e.classesWithoutHost=l}function R_(e,n,t,r,l=!1){for(;null!==t;){const d=n[t.index];null!==d&&r.push(Xn(d)),To(d)&&iC(d,r);const y=t.type;if(8&y)R_(e,n,t.child,r);else if(32&y){const C=eh(t,n);let D;for(;D=C();)r.push(D)}else if(16&y){const C=Df(n,t);if(Array.isArray(C))r.push(...C);else{const D=wf(n[xn]);R_(D[Jt],D,C,r,!0)}}t=l?t.projectionNext:t.next}return r}function iC(e,n){for(let t=zr;t<e.length;t++){const r=e[t],l=r[Jt].firstChild;null!==l&&R_(r[Jt],r,l,n)}e[Jr]!==e[Yi]&&n.push(e[Jr])}function u0(e,n,t,r=!0){const l=n[qe],d=l.rendererFactory,y=l.afterRenderEventManager;d.begin?.(),y?.begin();try{rC(e,n,e.template,t)}catch(D){throw r&&tC(n,D),D}finally{d.end?.(),l.effectManager?.flush(),y?.end()}}function rC(e,n,t,r){const l=n[ft];if(256!=(256&l)){n[qe].effectManager?.flush(),Tp(n);try{Zh(n),function _n(e){return Zn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Ar(e,n,t,2,r);const y=3==(3&l);if(y){const O=e.preOrderCheckHooks;null!==O&&Sp(n,O,null)}else{const O=e.preOrderHooks;null!==O&&Ip(n,O,0,null),Ap(n,0)}if(function k2(e){for(let n=Og(e);null!==n;n=Ng(n)){if(!n[$l])continue;const t=n[dl];for(let r=0;r<t.length;r++){Ny(t[r])}}}(n),oC(n,2),null!==e.contentQueries&&KE(e,n),y){const O=e.contentCheckHooks;null!==O&&Sp(n,O)}else{const O=e.contentHooks;null!==O&&Ip(n,O,1),Ap(n,1)}!function wr(e,n){const t=e.hostBindingOpCodes;if(null===t)return;const r=Ai(n,Ts);try{for(let l=0;l<t.length;l++){const d=t[l];if(d<0)ru(~d);else{const y=d,C=t[++l],D=t[++l];jy(C,y),r.dirty=!1;const O=z(r);try{D(2,n[y])}finally{H(r,O)}}}}finally{null===n[Ts]&&Bi(n,Ts),ru(-1)}}(e,n);const C=e.components;null!==C&&aC(n,C,0);const D=e.viewQuery;if(null!==D&&Hb(2,D,r),y){const O=e.viewCheckHooks;null!==O&&Sp(n,O)}else{const O=e.viewHooks;null!==O&&Ip(n,O,2),Ap(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[ft]&=-73,lg(n)}finally{Gu()}}}function oC(e,n){for(let t=Og(e);null!==t;t=Ng(t))for(let r=zr;r<t.length;r++)sC(t[r],n)}function O2(e,n,t){sC(Br(n,e),t)}function sC(e,n){if(!function bc(e){return 128==(128&e[ft])}(e))return;const t=e[Jt],r=e[ft];if(80&r&&0===n||1024&r||2===n)rC(t,e,t.template,e[X]);else if(e[M]>0){oC(e,1);const l=t.components;null!==l&&aC(e,l,1)}}function aC(e,n,t){for(let r=0;r<n.length;r++)O2(e,n[r],t)}class L_{get rootNodes(){const n=this._lView,t=n[Jt];return R_(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[X]}set context(n){this._lView[X]=n}get destroyed(){return 256==(256&this._lView[ft])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[h];if(To(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(tm(n,r),rd(t,r))}this._attachedToViewContainer=!1}Bg(this._lView[Jt],this._lView)}onDestroy(n){!function xp(e,n){if(256==(256&e[ft]))throw new Mt(911,!1);null===e[Cs]&&(e[Cs]=[]),e[Cs].push(n)}(this._lView,n)}markForCheck(){ct(this._cdRefInjectingView||this._lView)}detach(){this._lView[ft]&=-129}reattach(){this._lView[ft]|=128}detectChanges(){u0(this._lView[Jt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Mt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ef(e,n){Mf(e,n,n[Oe],2,null,null)}(this._lView[Jt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Mt(902,!1);this._appRef=n}}class N2 extends L_{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;u0(n[Jt],n,n[X],!1)}checkNoChanges(){}get context(){return null}}class lC extends bm{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=ii(n);return new k_(t,this.ngModule)}}function cC(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class z2{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=Ws(r);const l=this.injector.get(n,Nc,r);return l!==Nc||t===Nc?l:this.parentInjector.get(n,t,r)}}class k_ extends y_{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=cC(n.inputs);if(null!==t)for(const l of r)t.hasOwnProperty(l.propName)&&(l.transform=t[l.propName]);return r}get outputs(){return cC(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function _c(e){return e.map(ao).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,l){let d=(l=l||this.ngModule)instanceof Qo?l:l?.injector;d&&null!==this.componentDef.getStandaloneInjector&&(d=this.componentDef.getStandaloneInjector(d)||d);const y=d?new z2(n,d):n,C=y.get(wm,null);if(null===C)throw new Mt(407,!1);const W={rendererFactory:C,sanitizer:y.get(x_,null),effectManager:y.get(nC,null),afterRenderEventManager:y.get(ht,null)},oe=C.createRenderer(null,this.componentDef),be=this.componentDef.selectors[0][0]||"div",Ye=r?function Zf(e,n,t,r){const d=r.get(rt,!1)||t===xr.ShadowDom,y=e.selectRootElement(n,d);return function Wf(e){D_(e)}(y),y}(oe,r,this.componentDef.encapsulation,y):nh(oe,be,function F2(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(be)),Ut=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let dt=null;null!==Ye&&(dt=Ql(Ye,y,!0));const hn=da(0,null,null,1,0,null,null,null,null,null,null),Un=ui(null,hn,null,Ut,null,null,W,oe,y,null,dt);let wi,ns;Tp(Un);try{const Pu=this.componentDef;let fp,OE=null;Pu.findHostDirectiveDefs?(fp=[],OE=new Map,Pu.findHostDirectiveDefs(Pu,fp,OE),fp.push(Pu)):fp=[Pu];const x4=function V2(e,n){const t=e[Jt],r=ri;return e[r]=n,fr(t,r,2,"#host",null)}(Un,Ye),b4=function U2(e,n,t,r,l,d,y){const C=l[Jt];!function j2(e,n,t,r){for(const l of e)n.mergedAttrs=Js(n.mergedAttrs,l.hostAttrs);null!==n.mergedAttrs&&(c0(n,n.mergedAttrs,!0),null!==t&&Zg(r,t,n))}(r,e,n,y);let D=null;null!==n&&(D=Ql(n,l[we]));const O=d.rendererFactory.createRenderer(n,t);let $=16;t.signals?$=4096:t.onPush&&($=64);const W=ui(l,to(t),null,$,l[e.index],e,d,O,null,null,D);return C.firstCreatePass&&jb(C,e,r.length-1),l0(l,W),l[e.index]=W}(x4,Ye,Pu,fp,Un,W,oe);ns=Hl(hn,ri),Ye&&function H2(e,n,t,r){if(r)Ys(e,t,["ng-version",wl.full]);else{const{attrs:l,classes:d}=function al(e){const n=[],t=[];let r=1,l=2;for(;r<e.length;){let d=e[r];if("string"==typeof d)2===l?""!==d&&n.push(d,e[++r]):8===l&&t.push(d);else{if(!us(l))break;l=d}r++}return{attrs:n,classes:t}}(n.selectors[0]);l&&Ys(e,t,l),d&&d.length>0&&rm(e,t,d.join(" "))}}(oe,Pu,Ye,r),void 0!==t&&function G2(e,n,t){const r=e.projection=[];for(let l=0;l<n.length;l++){const d=t[l];r.push(null!=d?Array.from(d):null)}}(ns,this.ngContentSelectors,t),wi=function $2(e,n,t,r,l,d){const y=Vr(),C=l[Jt],D=tr(y,l);gs(C,l,y,t,null,r);for(let $=0;$<t.length;$++)Vo(gl(l,C,y.directiveStart+$,y),l);P_(C,l,y),D&&Vo(D,l);const O=gl(l,C,y.directiveStart+y.componentOffset,y);if(e[X]=l[X]=O,null!==d)for(const $ of d)$(O,n);return eo(C,y,e),O}(b4,Pu,fp,OE,Un,[q2]),qb(hn,Un,null)}finally{Gu()}return new B2(this.componentType,wi,Oc(ns,Un),Un,ns)}}class B2 extends Xv{constructor(n,t,r,l,d){super(),this.location=r,this._rootLView=l,this._tNode=d,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new N2(l),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let l;if(null!==r&&(l=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const d=this._rootLView;Gb(d[Jt],d,l,n,t),this.previousInputValues.set(n,t),ct(Br(this._tNode.index,d))}}get injector(){return new ho(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function q2(){const e=Vr();Is(vt()[Jt],e)}function _r(e){let n=function uC(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let l;if(ta(e))l=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Mt(903,!1);l=n.\u0275dir}if(l){if(t){r.push(l);const y=e;y.inputs=h0(e.inputs),y.inputTransforms=h0(e.inputTransforms),y.declaredInputs=h0(e.declaredInputs),y.outputs=h0(e.outputs);const C=l.hostBindings;C&&Y2(e,C);const D=l.viewQuery,O=l.contentQueries;if(D&&W2(e,D),O&&X2(e,O),gi(e.inputs,l.inputs),gi(e.declaredInputs,l.declaredInputs),gi(e.outputs,l.outputs),null!==l.inputTransforms&&(null===y.inputTransforms&&(y.inputTransforms={}),gi(y.inputTransforms,l.inputTransforms)),ta(l)&&l.data.animation){const $=e.data;$.animation=($.animation||[]).concat(l.data.animation)}}const d=l.features;if(d)for(let y=0;y<d.length;y++){const C=d[y];C&&C.ngInherit&&C(e),C===_r&&(t=!1)}}n=Object.getPrototypeOf(n)}!function Z2(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const l=e[r];l.hostVars=n+=l.hostVars,l.hostAttrs=Js(l.hostAttrs,t=Js(t,l.hostAttrs))}}(r)}function h0(e){return e===cs?{}:e===ni?[]:e}function W2(e,n){const t=e.viewQuery;e.viewQuery=t?(r,l)=>{n(r,l),t(r,l)}:n}function X2(e,n){const t=e.contentQueries;e.contentQueries=t?(r,l,d)=>{n(r,l,d),t(r,l,d)}:n}function Y2(e,n){const t=e.hostBindings;e.hostBindings=t?(r,l)=>{n(r,l),t(r,l)}:n}function pC(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const l=n[r];Array.isArray(l)&&l[2]&&(t[r]=l[2])}e.inputTransforms=t}function d0(e){return!!Zb(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Zb(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function bu(e,n,t){return e[n]=t}function ks(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Yf(e,n,t,r){const l=ks(e,n,t);return ks(e,n+1,r)||l}function wu(e,n,t,r){const l=vt();return ks(l,ia(),n)&&(ti(),xu(mr(),l,e,n,t,r)),wu}function Sm(e,n,t,r){return ks(e,ia(),t)?n+cn(t)+r:pn}function Im(e,n,t,r,l,d){const C=Yf(e,function ji(){return Zn.lFrame.bindingIndex}(),t,l);return Ua(2),C?n+cn(t)+r+cn(l)+d:pn}function Qn(e,n,t,r,l,d,y,C){const D=vt(),O=ti(),$=e+ri,W=O.firstCreatePass?function bP(e,n,t,r,l,d,y,C,D){const O=n.consts,$=fr(n,e,4,y||null,Ms(O,C));I_(n,t,$,Ms(O,D)),Is(n,$);const W=$.tView=da(2,$,r,l,d,n.directiveRegistry,n.pipeRegistry,null,n.schemas,O,null);return null!==n.queries&&(n.queries.template(n,$),W.queries=n.queries.embeddedTView($)),$}($,O,D,n,t,r,l,d,y):O.data[$];ql(W,!1);const oe=MC(O,D,W,e);gr()&&Ps(O,D,oe,W),Vo(oe,D),l0(D,D[$]=YE(oe,D,oe,W)),ju(W)&&Hr(O,D,W),null!=y&&Mo(D,W,C)}let MC=function SC(e,n,t,r){return Dc(!0),n[Oe].createComment("")};function B_(e){return Va(function Vy(){return Zn.lFrame.contextLView}(),ri+e)}function At(e,n,t){const r=vt();return ks(r,ia(),n)&&ms(ti(),mr(),r,e,n,r[Oe],t,!1),At}function Qb(e,n,t,r,l){const y=l?"class":"style";Gb(e,t,n.inputs[y],y,r)}function pe(e,n,t,r){const l=vt(),d=ti(),y=ri+e,C=l[Oe],D=d.firstCreatePass?function TP(e,n,t,r,l,d){const y=n.consts,D=fr(n,e,2,r,Ms(y,l));return I_(n,t,D,Ms(y,d)),null!==D.attrs&&c0(D,D.attrs,!1),null!==D.mergedAttrs&&c0(D,D.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,D),D}(y,d,l,n,t,r):d.data[y],O=IC(d,l,D,C,n,e);l[y]=O;const $=ju(D);return ql(D,!0),Zg(C,O,D),32!=(32&D.flags)&&gr()&&Ps(d,l,O,D),0===function wc(){return Zn.lFrame.elementDepthCount}()&&Vo(O,l),function Ep(){Zn.lFrame.elementDepthCount++}(),$&&(Hr(d,l,D),eo(d,D,l)),null!==r&&Mo(l,D),pe}function me(){let e=Vr();dg()?function Cp(){Zn.lFrame.isParent=!1}():(e=e.parent,ql(e,!1));const n=e;(function Vx(e){return Zn.skipHydrationRootTNode===e})(n)&&function Xh(){Zn.skipHydrationRootTNode=null}(),function zy(){Zn.lFrame.elementDepthCount--}();const t=ti();return t.firstCreatePass&&(Is(t,e),lo(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function qy(e){return 0!=(8&e.flags)}(n)&&Qb(t,n,vt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function lf(e){return 0!=(16&e.flags)}(n)&&Qb(t,n,vt(),n.stylesWithoutHost,!1),me}function wo(e,n,t,r){return pe(e,n,t,r),me(),wo}let IC=(e,n,t,r,l,d)=>(Dc(!0),nh(r,l,function oa(){return Zn.lFrame.currentNamespace}()));function Sd(){return vt()}function V_(e){return!!e&&"function"==typeof e.then}function RC(e){return!!e&&"function"==typeof e.subscribe}function mn(e,n,t,r){const l=vt(),d=ti(),y=Vr();return function kC(e,n,t,r,l,d,y){const C=ju(r),O=e.firstCreatePass&&QE(e),$=n[X],W=JE(n);let oe=!0;if(3&r.type||y){const nt=tr(r,n),mt=y?y(nt):nt,Ut=W.length,dt=y?Un=>y(Xn(Un[r.index])):r.index;let hn=null;if(!y&&C&&(hn=function PP(e,n,t,r){const l=e.cleanup;if(null!=l)for(let d=0;d<l.length-1;d+=2){const y=l[d];if(y===t&&l[d+1]===r){const C=n[U],D=l[d+2];return C.length>D?C[D]:null}"string"==typeof y&&(d+=2)}return null}(e,n,l,r.index)),null!==hn)(hn.__ngLastListenerFn__||hn).__ngNextListenerFn__=d,hn.__ngLastListenerFn__=d,oe=!1;else{d=NC(r,n,$,d,!1);const Un=t.listen(mt,l,d);W.push(d,Un),O&&O.push(l,dt,Ut,Ut+1)}}else d=NC(r,n,$,d,!1);const be=r.outputs;let Ye;if(oe&&null!==be&&(Ye=be[l])){const nt=Ye.length;if(nt)for(let mt=0;mt<nt;mt+=2){const wi=n[Ye[mt]][Ye[mt+1]].subscribe(d),ns=W.length;W.push(d,wi),O&&O.push(l,r.index,ns,-(ns+1))}}}(d,l,l[Oe],y,e,n,r),mn}function OC(e,n,t,r){try{return _i(6,n,t),!1!==t(r)}catch(l){return tC(e,l),!1}finally{_i(7,n,t)}}function NC(e,n,t,r,l){return function d(y){if(y===Function)return r;ct(e.componentOffset>-1?Br(e.index,n):n);let D=OC(n,t,r,y),O=d.__ngNextListenerFn__;for(;O;)D=OC(n,t,O,y)&&D,O=O.__ngNextListenerFn__;return l&&!1===D&&y.preventDefault(),D}}function Yn(e=1){return function Kh(e){return(Zn.lFrame.contextLView=function Tc(e,n){for(;e>0;)n=n[bn],e--;return n}(e,Zn.lFrame.contextLView))[X]}(e)}function n1(e,n,t){return i1(e,"",n,"",t),n1}function i1(e,n,t,r,l){const d=vt(),y=Sm(d,n,t,r);return y!==pn&&ms(ti(),mr(),d,e,y,d[Oe],l,!1),i1}function _0(e,n){return e<<17|n<<2}function Id(e){return e>>17&32767}function r1(e){return 2|e}function Kf(e){return(131068&e)>>2}function o1(e,n){return-131069&e|n<<2}function s1(e){return 1|e}function GC(e,n,t,r,l){const d=e[t+1],y=null===n;let C=r?Id(d):Kf(d),D=!1;for(;0!==C&&(!1===D||y);){const $=e[C+1];VP(e[C],n)&&(D=!0,e[C+1]=r?s1($):r1($)),C=r?Id($):Kf($)}D&&(e[t+1]=r?r1(d):s1(d))}function VP(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&Yu(e,n)>=0}function y0(e,n){return function Fc(e,n,t,r){const l=vt(),d=ti(),y=Ua(2);d.firstUpdatePass&&function eT(e,n,t,r){const l=e.data;if(null===l[t+1]){const d=l[Fo()],y=function QC(e,n){return n>=e.expandoStartIndex}(e,t);(function rT(e,n){return 0!=(e.flags&(n?8:16))})(d,r)&&null===n&&!y&&(n=!1),n=function XP(e,n,t,r){const l=function Ec(e){const n=Zn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let d=r?n.residualClasses:n.residualStyles;if(null===l)0===(r?n.classBindings:n.styleBindings)&&(t=U_(t=a1(null,e,n,t,r),n.attrs,r),d=null);else{const y=n.directiveStylingLast;if(-1===y||e[y]!==l)if(t=a1(l,e,n,t,r),null===d){let D=function YP(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==Kf(r))return e[Id(r)]}(e,n,r);void 0!==D&&Array.isArray(D)&&(D=a1(null,e,n,D[1],r),D=U_(D,n.attrs,r),function KP(e,n,t,r){e[Id(t?n.classBindings:n.styleBindings)]=r}(e,n,r,D))}else d=function JP(e,n,t){let r;const l=n.directiveEnd;for(let d=1+n.directiveStylingLast;d<l;d++)r=U_(r,e[d].hostAttrs,t);return U_(r,n.attrs,t)}(e,n,r)}return void 0!==d&&(r?n.residualClasses=d:n.residualStyles=d),t}(l,d,n,r),function zP(e,n,t,r,l,d){let y=d?n.classBindings:n.styleBindings,C=Id(y),D=Kf(y);e[r]=t;let $,O=!1;if(Array.isArray(t)?($=t[1],(null===$||Yu(t,$)>0)&&(O=!0)):$=t,l)if(0!==D){const oe=Id(e[C+1]);e[r+1]=_0(oe,C),0!==oe&&(e[oe+1]=o1(e[oe+1],r)),e[C+1]=function NP(e,n){return 131071&e|n<<17}(e[C+1],r)}else e[r+1]=_0(C,0),0!==C&&(e[C+1]=o1(e[C+1],r)),C=r;else e[r+1]=_0(D,0),0===C?C=r:e[D+1]=o1(e[D+1],r),D=r;O&&(e[r+1]=r1(e[r+1])),GC(e,$,r,!0),GC(e,$,r,!1),function BP(e,n,t,r,l){const d=l?e.residualClasses:e.residualStyles;null!=d&&"string"==typeof n&&Yu(d,n)>=0&&(t[r+1]=s1(t[r+1]))}(n,$,e,r,d),y=_0(C,D),d?n.classBindings=y:n.styleBindings=y}(l,d,n,t,y,r)}}(d,e,y,r),n!==pn&&ks(l,y,n)&&function nT(e,n,t,r,l,d,y,C){if(!(3&n.type))return;const D=e.data,O=D[C+1],$=function FP(e){return 1==(1&e)}(O)?iT(D,n,t,l,Kf(O),y):void 0;v0($)||(v0(d)||function OP(e){return 2==(2&e)}(O)&&(d=iT(D,null,t,l,C,y)),function Lv(e,n,t,r,l){if(n)l?e.addClass(t,r):e.removeClass(t,r);else{let d=-1===r.indexOf("-")?void 0:Yl.DashCase;null==l?e.removeStyle(t,r,d):("string"==typeof l&&l.endsWith("!important")&&(l=l.slice(0,-10),d|=Yl.Important),e.setStyle(t,r,l,d))}}(r,y,zi(Fo(),t),l,d))}(d,d.data[Fo()],l,l[Oe],e,l[y+1]=function nR(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=ar(Rc(e)))),e}(n,t),r,y)}(e,n,null,!0),y0}function a1(e,n,t,r,l){let d=null;const y=t.directiveEnd;let C=t.directiveStylingLast;for(-1===C?C=t.directiveStart:C++;C<y&&(d=n[C],r=U_(r,d.hostAttrs,l),d!==e);)C++;return null!==e&&(t.directiveStylingLast=C),r}function U_(e,n,t){const r=t?1:2;let l=-1;if(null!==n)for(let d=0;d<n.length;d++){const y=n[d];"number"==typeof y?l=y:l===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ua(e,y,!!t||n[++d]))}return void 0===e?null:e}function iT(e,n,t,r,l,d){const y=null===n;let C;for(;l>0;){const D=e[l],O=Array.isArray(D),$=O?D[1]:D,W=null===$;let oe=t[l+1];oe===pn&&(oe=W?ni:void 0);let be=W?mf(oe,r):$===r?oe:void 0;if(O&&!v0(be)&&(be=mf(D,r)),v0(be)&&(C=be,y))return C;const Ye=e[l+1];l=y?Id(Ye):Kf(Ye)}if(null!==n){let D=d?n.residualClasses:n.residualStyles;null!=D&&(C=mf(D,r))}return C}function v0(e){return void 0!==e}function Fe(e,n=""){const t=vt(),r=ti(),l=e+ri,d=r.firstCreatePass?fr(r,l,1,n,null):r.data[l],y=oT(r,t,d,n,e);t[l]=y,gr()&&Ps(r,t,y,d),ql(d,!1)}let oT=(e,n,t,r,l)=>(Dc(!0),function Qp(e,n){return e.createText(n)}(n[Oe],r));function oi(e){return es("",e,""),oi}function es(e,n,t){const r=vt(),l=Sm(r,e,n,t);return l!==pn&&xh(r,Fo(),l),es}function x0(e,n,t,r,l){const d=vt(),y=Im(d,e,n,t,r,l);return y!==pn&&xh(d,Fo(),y),x0}const Jf=void 0;var CR=["en",[["a","p"],["AM","PM"],Jf],[["AM","PM"],Jf,Jf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Jf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Jf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Jf,"{1} 'at' {0}",Jf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function ER(e){const t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];let Fm={};function fa(e){const n=function TR(e){return e.toLowerCase().replace(/_/g,"-")}(e);let t=TT(n);if(t)return t;const r=n.split("-")[0];if(t=TT(r),t)return t;if("en"===r)return CR;throw new Mt(701,!1)}function TT(e){return e in Fm||(Fm[e]=Di.ng&&Di.ng.common&&Di.ng.common.locales&&Di.ng.common.locales[e]),Fm[e]}var Pr=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}(Pr||{});const zm="en-US";let DT=zm;function u1(e,n,t,r,l){if(e=Pn(e),Array.isArray(e))for(let d=0;d<e.length;d++)u1(e[d],n,t,r,l);else{const d=ti(),y=vt(),C=Vr();let D=uh(e)?e:Pn(e.provide);const O=Hv(e),$=1048575&C.providerIndexes,W=C.directiveStart,oe=C.providerIndexes>>20;if(uh(e)||!e.multi){const be=new Jh(O,l,Qe),Ye=d1(D,n,l?$:$+oe,W);-1===Ye?(Mc(uf(C,y),d,D),h1(d,e,n.length),n.push(D),C.directiveStart++,C.directiveEnd++,l&&(C.providerIndexes+=1048576),t.push(be),y.push(be)):(t[Ye]=be,y[Ye]=be)}else{const be=d1(D,n,$+oe,W),Ye=d1(D,n,$,$+oe),mt=Ye>=0&&t[Ye];if(l&&!mt||!l&&!(be>=0&&t[be])){Mc(uf(C,y),d,D);const Ut=function EL(e,n,t,r,l){const d=new Jh(e,t,Qe);return d.multi=[],d.index=n,d.componentProviders=0,KT(d,l,r&&!t),d}(l?wL:bL,t.length,l,r,O);!l&&mt&&(t[Ye].providerFactory=Ut),h1(d,e,n.length,0),n.push(D),C.directiveStart++,C.directiveEnd++,l&&(C.providerIndexes+=1048576),t.push(Ut),y.push(Ut)}else h1(d,e,be>-1?be:Ye,KT(t[l?Ye:be],O,!l&&r));!l&&r&&mt&&t[Ye].componentProviders++}}}function h1(e,n,t,r){const l=uh(n),d=function fu(e){return!!e.useClass}(n);if(l||d){const D=(d?Pn(n.useClass):n).prototype.ngOnDestroy;if(D){const O=e.destroyHooks||(e.destroyHooks=[]);if(!l&&n.multi){const $=O.indexOf(t);-1===$?O.push(t,[r,D]):O[$+1].push(r,D)}else O.push(t,D)}}}function KT(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function d1(e,n,t,r){for(let l=t;l<r;l++)if(n[l]===e)return l;return-1}function bL(e,n,t,r){return f1(this.multi,[])}function wL(e,n,t,r){const l=this.multi;let d;if(this.providerFactory){const y=this.providerFactory.componentProviders,C=gl(t,t[Jt],this.providerFactory.index,r);d=C.slice(0,y),f1(l,d);for(let D=y;D<C.length;D++)d.push(C[D])}else d=[],f1(l,d);return d}function f1(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Gr(e,n=[]){return t=>{t.providersResolver=(r,l)=>function xL(e,n,t){const r=ti();if(r.firstCreatePass){const l=ta(e);u1(t,r.data,r.blueprint,l,!0),u1(n,r.data,r.blueprint,l,!1)}}(r,l?l(e):e,n)}}class Qf{}class JT{}class p1 extends Qf{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new lC(this);const l=Kr(n);this._bootstrapComponents=_e(l.bootstrap),this._r3Injector=E_(n,t,[{provide:Qf,useValue:this},{provide:bm,useValue:this.componentFactoryResolver},...r],ar(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class m1 extends JT{constructor(n){super(),this.moduleType=n}create(n){return new p1(this.moduleType,n,[])}}class QT extends Qf{constructor(n){super(),this.componentFactoryResolver=new lC(this),this.instance=null;const t=new vd([...n.providers,{provide:Qf,useValue:this},{provide:bm,useValue:this.componentFactoryResolver}],n.parent||mu(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function g1(e,n,t=null){return new QT({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let DL=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=_d(0,t.type),l=r.length>0?g1([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,l)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=an({token:e,providedIn:"environment",factory:()=>new e(sn(Qo))})}return e})();function eD(e){e.getStandaloneInjector=n=>n.get(DL).getOrCreateStandaloneInjector(e)}function y1(e,n,t,r){return function cD(e,n,t,r,l,d){const y=n+t;return ks(e,y,l)?bu(e,y+1,d?r.call(d,l):r(l)):Z_(e,y+1)}(vt(),ds(),e,n,t,r)}function v1(e,n,t,r,l,d){return function hD(e,n,t,r,l,d,y,C){const D=n+t;return function f0(e,n,t,r,l){const d=Yf(e,n,t,r);return ks(e,n+2,l)||d}(e,D,l,d,y)?bu(e,D+3,C?r.call(C,l,d,y):r(l,d,y)):Z_(e,D+3)}(vt(),ds(),e,n,t,r,l,d)}function Z_(e,n){const t=e[n];return t===pn?void 0:t}function uD(e,n,t,r,l,d,y){const C=n+t;return Yf(e,C,l,d)?bu(e,C+2,y?r.call(y,l,d):r(l,d)):Z_(e,C+2)}function W_(e,n){const t=ti();let r;const l=e+ri;t.firstCreatePass?(r=function UL(e,n){if(n)for(let t=n.length-1;t>=0;t--){const r=n[t];if(e===r.name)return r}}(n,t.pipeRegistry),t.data[l]=r,r.onDestroy&&(t.destroyHooks??=[]).push(l,r.onDestroy)):r=t.data[l];const d=r.factory||(r.factory=pl(r.type)),C=Yr(Qe);try{const D=Pp(!1),O=d();return Pp(D),function CP(e,n,t,r){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=r}(t,vt(),l,O),O}finally{Yr(C)}}function X_(e,n,t,r){const l=e+ri,d=vt(),y=Va(d,l);return function Y_(e,n){return e[Jt].data[n].pure}(d,l)?uD(d,ds(),n,y.transform,t,r,y):y.transform(t,r)}function qL(){return this._results[Symbol.iterator]()}class x1{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new s)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=x1.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=qL)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){const r=this;r.dirty=!1;const l=function Do(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Ic(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let l=e[r],d=n[r];if(t&&(l=t(l),d=t(d)),d!==l)return!1}return!0}(r._results,l,t))&&(r._results=l,r.length=l.length,r.last=l[this.length-1],r.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function WL(e,n,t,r=!0){const l=n[Jt];if(function Cf(e,n,t,r){const l=zr+r,d=t.length;r>0&&(t[l-1][x]=n),r<d-zr?(n[x]=t[l],pf(t,zr+r,n)):(t.push(n),n[x]=null),n[h]=t;const y=n[Fr];null!==y&&t!==y&&function Mv(e,n){const t=e[dl];n[xn]!==n[h][h][xn]&&(e[$l]=!0),null===t?e[dl]=[n]:t.push(n)}(y,n);const C=n[Ki];null!==C&&C.insertView(e),n[ft]|=128}(l,n,e,t),r){const d=uu(t,e),y=n[Oe],C=nm(y,e[Jr]);null!==C&&function Jo(e,n,t,r,l,d){r[Yi]=l,r[k]=n,Mf(e,r,t,1,l,d)}(l,e[k],y,n,C,d)}}let bh=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=KL}return e})();const XL=bh,YL=class extends XL{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const l=function ZL(e,n,t,r){const l=n.tView,C=ui(e,l,t,4096&e[ft]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);C[Fr]=e[n.index];const O=e[Ki];return null!==O&&(C[Ki]=O.createEmbeddedView(l)),qb(l,C,t),C}(this._declarationLView,this._declarationTContainer,n,{injector:t,hydrationInfo:r});return new L_(l)}};function KL(){return T0(Vr(),vt())}function T0(e,n){return 4&e.type?new YL(n,e,Oc(e,n)):null}let Bc=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=ik}return e})();function ik(){return xD(Vr(),vt())}const rk=Bc,yD=class extends rk{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Oc(this._hostTNode,this._hostLView)}get injector(){return new ho(this._hostTNode,this._hostLView)}get parentInjector(){const n=aa(this._hostTNode,this._hostLView);if(cf(n)){const t=Qh(n,this._hostLView),r=uo(n);return new ho(t[Jt].data[r+8],t)}return new ho(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=vD(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-zr}createEmbeddedView(n,t,r){let l,d;"number"==typeof r?l=r:null!=r&&(l=r.index,d=r.injector);const C=n.createEmbeddedViewImpl(t||{},d,null);return this.insertImpl(C,l,false),C}createComponent(n,t,r,l,d){const y=n&&!function ff(e){return"function"==typeof e}(n);let C;if(y)C=t;else{const nt=t||{};C=nt.index,r=nt.injector,l=nt.projectableNodes,d=nt.environmentInjector||nt.ngModuleRef}const D=y?n:new k_(ii(n)),O=r||this.parentInjector;if(!d&&null==D.ngModule){const mt=(y?O:this.parentInjector).get(Qo,null);mt&&(d=mt)}ii(D.componentType??{});const be=D.create(O,l,null,d);return this.insertImpl(be.hostView,C,false),be}insert(n,t){return this.insertImpl(n,t,!1)}insertImpl(n,t,r){const l=n._lView;if(function qh(e){return To(e[h])}(l)){const D=this.indexOf(n);if(-1!==D)this.detach(D);else{const O=l[h],$=new yD(O,O[k],O[h]);$.detach($.indexOf(n))}}const y=this._adjustIndex(t),C=this._lContainer;return WL(C,l,y,!r),n.attachToViewContainerRef(),pf(b1(C),y,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=vD(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=tm(this._lContainer,t);r&&(rd(b1(this._lContainer),t),Bg(r[Jt],r))}detach(n){const t=this._adjustIndex(n,-1),r=tm(this._lContainer,t);return r&&null!=rd(b1(this._lContainer),t)?new L_(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function vD(e){return e[8]}function b1(e){return e[8]||(e[8]=[])}function xD(e,n){let t;const r=n[e.index];return To(r)?t=r:(t=YE(r,n,null,e),n[e.index]=t,l0(n,t)),bD(t,n,e,r),new yD(t,e,n)}let bD=function wD(e,n,t,r){if(e[Jr])return;let l;l=8&t.type?Xn(r):function ok(e,n){const t=e[Oe],r=t.createComment(""),l=tr(n,e);return ih(t,nm(t,l),r,function fb(e,n){return e.nextSibling(n)}(t,l),!1),r}(n,t),e[Jr]=l};class w1{constructor(n){this.queryList=n,this.matches=null}clone(){return new w1(this.queryList)}setDirty(){this.queryList.setDirty()}}class E1{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,l=[];for(let d=0;d<r;d++){const y=t.getByIndex(d);l.push(this.queries[y.indexInDeclarationView].clone())}return new E1(l)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==ID(n,t).matches&&this.queries[t].setDirty()}}class ED{constructor(n,t,r=null){this.predicate=n,this.flags=t,this.read=r}}class C1{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const l=null!==t?t.length:0,d=this.getByIndex(r).embeddedTView(n,l);d&&(d.indexInDeclarationView=r,null!==t?t.push(d):t=[d])}return null!==t?new C1(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class T1{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new T1(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let l=0;l<r.length;l++){const d=r[l];this.matchTNodeWithReadOption(n,t,lk(t,d)),this.matchTNodeWithReadOption(n,t,Sc(t,n,d,!1,!1))}else r===bh?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,Sc(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const l=this.metadata.read;if(null!==l)if(l===ha||l===Bc||l===bh&&4&t.type)this.addMatch(t.index,-2);else{const d=Sc(t,n,l,!1,!1);null!==d&&this.addMatch(t.index,d)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function lk(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function uk(e,n,t,r){return-1===t?function ck(e,n){return 11&e.type?Oc(e,n):4&e.type?T0(e,n):null}(n,e):-2===t?function hk(e,n,t){return t===ha?Oc(n,e):t===bh?T0(n,e):t===Bc?xD(n,e):void 0}(e,n,r):gl(e,e[Jt],t,n)}function CD(e,n,t,r){const l=n[Ki].queries[r];if(null===l.matches){const d=e.data,y=t.matches,C=[];for(let D=0;D<y.length;D+=2){const O=y[D];C.push(O<0?null:uk(n,d[O],y[D+1],t.metadata.read))}l.matches=C}return l.matches}function D1(e,n,t,r){const l=e.queries.getByIndex(t),d=l.matches;if(null!==d){const y=CD(e,n,l,t);for(let C=0;C<d.length;C+=2){const D=d[C];if(D>0)r.push(y[C/2]);else{const O=d[C+1],$=n[-D];for(let W=zr;W<$.length;W++){const oe=$[W];oe[Fr]===oe[h]&&D1(oe[Jt],oe,O,r)}if(null!==$[dl]){const W=$[dl];for(let oe=0;oe<W.length;oe++){const be=W[oe];D1(be[Jt],be,O,r)}}}}}return r}function M1(e){const n=vt(),t=ti(),r=Yh();Cc(r+1);const l=ID(t,r);if(e.dirty&&function Gl(e){return 4==(4&e[ft])}(n)===(2==(2&l.metadata.flags))){if(null===l.matches)e.reset([]);else{const d=l.crossesNgTemplate?D1(t,n,r,[]):CD(t,n,l,r);e.reset(d,Td),e.notifyOnChanges()}return!0}return!1}function S1(){return function dk(e,n){return e[Ki].queries[n].queryList}(vt(),Yh())}function MD(e,n,t){const r=new x1(4==(4&t));(function o0(e,n,t,r){const l=JE(n);l.push(t),e.firstCreatePass&&QE(e).push(r,l.length-1)})(e,n,r,r.destroy),null===n[Ki]&&(n[Ki]=new E1),n[Ki].queries.push(new w1(r))}function SD(e,n,t){null===e.queries&&(e.queries=new C1),e.queries.track(new T1(n,t))}function ID(e,n){return e.queries.getByIndex(n)}const k1=new Xt("Application Initializer");let O1=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=tn(k1,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const l of this.appInits){const d=l();if(V_(d))t.push(d);else if(RC(d)){const y=new Promise((C,D)=>{d.subscribe({complete:C,error:D})});t.push(y)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(l=>{this.reject(l)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),qD=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const wh=new Xt("LocaleId",{providedIn:"root",factory:()=>tn(wh,$n.Optional|$n.SkipSelf)||function Ok(){return typeof $localize<"u"&&$localize.locale||zm}()});let S0=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new gn(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class zk{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let ZD=(()=>{class e{compileModuleSync(t){return new m1(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),d=_e(Kr(t).declarations).reduce((y,C)=>{const D=ii(C);return D&&y.push(new k_(D)),y},[]);return new zk(r,d)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const KD=new Xt(""),A0=new Xt("");let V1,z1=(()=>{class e{constructor(t,r,l){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,V1||(function sO(e){V1=e}(l),l.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{v.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,l){let d=-1;r&&r>0&&(d=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==d),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:d,updateCb:l})}whenStable(t,r,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,l){return[]}static#e=this.\u0275fac=function(r){return new(r||e)(sn(v),sn(B1),sn(A0))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})(),B1=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return V1?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),Ad=null;const JD=new Xt("AllowMultipleToken"),U1=new Xt("PlatformDestroyListeners"),j1=new Xt("appBootstrapListener");class eM{constructor(n,t){this.name=n,this.token=t}}function nM(e,n,t=[]){const r=`Platform: ${n}`,l=new Xt(r);return(d=[])=>{let y=$1();if(!y||y.injector.get(JD,!1)){const C=[...t,...d,{provide:l,useValue:!0}];e?e(C):function cO(e){if(Ad&&!Ad.get(JD,!1))throw new Mt(400,!1);(function QD(){!function Et(e){Pe=e}(()=>{throw new Mt(600,!1)})})(),Ad=e;const n=e.get(rM);(function tM(e){e.get(u_,null)?.forEach(t=>t())})(e)}(function iM(e=[],n){return Rs.create({name:n,providers:[{provide:a_,useValue:"platform"},{provide:U1,useValue:new Set([()=>Ad=null])},...e]})}(C,r))}return function hO(e){const n=$1();if(!n)throw new Mt(401,!1);return n}()}}function $1(){return Ad?.get(rM)??null}let rM=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const l=function dO(e="zone.js",n){return"noop"===e?new j:"zone.js"===e?new v(n):e}(r?.ngZone,function oM(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return l.run(()=>{const d=function TL(e,n,t){return new p1(e,n,t)}(t.moduleType,this.injector,function uM(e){return[{provide:v,useFactory:e},{provide:ch,multi:!0,useFactory:()=>{const n=tn(pO,{optional:!0});return()=>n.initialize()}},{provide:cM,useFactory:fO},{provide:q,useFactory:J}]}(()=>l)),y=d.injector.get(tc,null);return l.runOutsideAngular(()=>{const C=l.onError.subscribe({next:D=>{y.handleError(D)}});d.onDestroy(()=>{P0(this._modules,d),C.unsubscribe()})}),function sM(e,n,t){try{const r=t();return V_(r)?r.catch(l=>{throw n.runOutsideAngular(()=>e.handleError(l)),l}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(y,l,()=>{const C=d.injector.get(O1);return C.runInitializers(),C.donePromise.then(()=>(function MT(e){Ur(e,"Expected localeId to be defined"),"string"==typeof e&&(DT=e.toLowerCase().replace(/_/g,"-"))}(d.injector.get(wh,zm)||zm),this._moduleDoBootstrap(d),d))})})}bootstrapModule(t,r=[]){const l=aM({},r);return function aO(e,n,t){const r=new m1(t);return Promise.resolve(r)}(0,0,t).then(d=>this.bootstrapModuleFactory(d,l))}_moduleDoBootstrap(t){const r=t.injector.get(Um);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(l=>r.bootstrap(l));else{if(!t.instance.ngDoBootstrap)throw new Mt(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Mt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(U1,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Rs))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function aM(e,n){return Array.isArray(n)?n.reduce(aM,e):{...e,...n}}let Um=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=tn(cM),this.zoneIsStable=tn(q),this.componentTypes=[],this.components=[],this.isStable=tn(S0).hasPendingTasks.pipe(Wi(t=>t?fn(!1):this.zoneIsStable),function ss(e,n=En){return e=e??Xi,pi((t,r)=>{let l,d=!0;t.subscribe(ln(r,y=>{const C=n(y);(d||!e(l,C))&&(d=!1,l=C,r.next(y))}))})}(),sr()),this._injector=tn(Qo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const l=t instanceof y_;if(!this._injector.get(O1).done)throw!l&&function ul(e){const n=ii(e)||Tr(e)||cr(e);return null!==n&&n.standalone}(t),new Mt(405,!1);let y;y=l?t:this._injector.get(bm).resolveComponentFactory(t),this.componentTypes.push(y.componentType);const C=function lO(e){return e.isBoundToModule}(y)?void 0:this._injector.get(Qf),O=y.create(Rs.NULL,[],r||y.selector,C),$=O.location.nativeElement,W=O.injector.get(KD,null);return W?.registerApplication($),O.onDestroy(()=>{this.detachView(O.hostView),P0(this.components,O),W?.unregisterApplication($)}),this._loadComponent(O),O}tick(){if(this._runningTick)throw new Mt(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;P0(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(j1,[]);r.push(...this._bootstrapListeners),r.forEach(l=>l(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>P0(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Mt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function P0(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}const cM=new Xt("",{providedIn:"root",factory:()=>tn(tc).handleError.bind(void 0)});function fO(){const e=tn(v),n=tn(tc);return t=>e.runOutsideAngular(()=>n.handleError(t))}let pO=(()=>{class e{constructor(){this.zone=tn(v),this.applicationRef=tn(Um)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let Q_=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=gO}return e})();function gO(e){return function _O(e,n,t){if(xc(e)&&!t){const r=Br(e.index,n);return new L_(r,r)}return 47&e.type?new L_(n[xn],n):null}(Vr(),vt(),16==(16&e))}class pM{constructor(){}supports(n){return d0(n)}create(n){return new EO(n)}}const wO=(e,n)=>n;class EO{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||wO}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,r=this._removalsHead,l=0,d=null;for(;t||r;){const y=!r||t&&t.currentIndex<gM(r,l,d)?t:r,C=gM(y,l,d),D=y.currentIndex;if(y===r)l--,r=r._nextRemoved;else if(t=t._next,null==y.previousIndex)l++;else{d||(d=[]);const O=C-l,$=D-l;if(O!=$){for(let oe=0;oe<O;oe++){const be=oe<d.length?d[oe]:d[oe]=0,Ye=be+oe;$<=Ye&&Ye<O&&(d[oe]=be+1)}d[y.previousIndex]=$-O}}C!==D&&n(y,C,D)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!d0(n))throw new Mt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l,d,y,t=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let C=0;C<this.length;C++)d=n[C],y=this._trackByFn(C,d),null!==t&&Object.is(t.trackById,y)?(r&&(t=this._verifyReinsertion(t,d,y,C)),Object.is(t.item,d)||this._addIdentityChange(t,d)):(t=this._mismatch(t,d,y,C),r=!0),t=t._next}else l=0,function iP(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let r;for(;!(r=t.next()).done;)n(r.value)}}(n,C=>{y=this._trackByFn(l,C),null!==t&&Object.is(t.trackById,y)?(r&&(t=this._verifyReinsertion(t,C,y,l)),Object.is(t.item,C)||this._addIdentityChange(t,C)):(t=this._mismatch(t,C,y,l),r=!0),t=t._next,l++}),this.length=l;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,r,l){let d;return null===n?d=this._itTail:(d=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,d,l)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,l))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,d,l)):n=this._addAfter(new CO(t,r),d,l),n}_verifyReinsertion(n,t,r,l){let d=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==d?n=this._reinsertAfter(d,n._prev,l):n.currentIndex!=l&&(n.currentIndex=l,this._addToMoves(n,l)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const l=n._prevRemoved,d=n._nextRemoved;return null===l?this._removalsHead=d:l._nextRemoved=d,null===d?this._removalsTail=l:d._prevRemoved=l,this._insertAfter(n,t,r),this._addToMoves(n,r),n}_moveAfter(n,t,r){return this._unlink(n),this._insertAfter(n,t,r),this._addToMoves(n,r),n}_addAfter(n,t,r){return this._insertAfter(n,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,r){const l=null===t?this._itHead:t._next;return n._next=l,n._prev=t,null===l?this._itTail=n:l._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new mM),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,r=n._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new mM),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class CO{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class TO{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const t=n._prevDup,r=n._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class mM{constructor(){this.map=new Map}put(n){const t=n.trackById;let r=this.map.get(t);r||(r=new TO,this.map.set(t,r)),r.add(n)}get(n,t){const l=this.map.get(n);return l?l.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function gM(e,n,t){const r=e.previousIndex;if(null===r)return r;let l=0;return t&&r<t.length&&(l=t[r]),r+n+l}class _M{constructor(){}supports(n){return n instanceof Map||Zb(n)}create(){return new DO}}class DO{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let t;for(t=this._mapHead;null!==t;t=t._next)n(t)}forEachPreviousItem(n){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)n(t)}forEachChangedItem(n){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}diff(n){if(n){if(!(n instanceof Map||Zb(n)))throw new Mt(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,l)=>{if(t&&t.key===l)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const d=this._getOrCreateRecordForKey(l,r);t=this._insertBeforeOrAppend(t,d)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,t){if(n){const r=n._prev;return t._next=n,t._prev=r,n._prev=t,r&&(r._next=t),n===this._mapHead&&(this._mapHead=t),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(n,t){if(this._records.has(n)){const l=this._records.get(n);this._maybeAddToChanges(l,t);const d=l._prev,y=l._next;return d&&(d._next=y),y&&(y._prev=d),l._next=null,l._prev=null,l}const r=new MO(n);return this._records.set(n,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,t){Object.is(t,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=t,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,t){n instanceof Map?n.forEach(t):Object.keys(n).forEach(r=>t(n[r],r))}}class MO{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function yM(){return new k0([new pM])}let k0=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:yM});constructor(t){this.factories=t}static create(t,r){if(null!=r){const l=r.factories.slice();t=t.concat(l)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||yM()),deps:[[e,new Up,new Vp]]}}find(t){const r=this.factories.find(l=>l.supports(t));if(null!=r)return r;throw new Mt(901,!1)}}return e})();function vM(){return new ey([new _M])}let ey=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:vM});constructor(t){this.factories=t}static create(t,r){if(r){const l=r.factories.slice();t=t.concat(l)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||vM()),deps:[[e,new Up,new Vp]]}}find(t){const r=this.factories.find(l=>l.supports(t));if(r)return r;throw new Mt(901,!1)}}return e})();const AO=nM(null,"core",[]);let PO=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Um))};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();function jm(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let X1=null;function Pd(){return X1}class GO{}const Cl=new Xt("DocumentToken");let Y1=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(ZO)},providedIn:"platform"})}return e})();const qO=new Xt("Location Initialized");let ZO=(()=>{class e extends Y1{constructor(){super(),this._doc=tn(Cl),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Pd().getBaseHref(this._doc)}onPopState(t){const r=Pd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=Pd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,l){this._history.pushState(t,r,l)}replaceState(t,r,l){this._history.replaceState(t,r,l)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function K1(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function SM(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Eh(e){return e&&"?"!==e[0]?"?"+e:e}let tp=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(AM)},providedIn:"root"})}return e})();const IM=new Xt("appBaseHref");let AM=(()=>{class e extends tp{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??tn(Cl).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return K1(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+Eh(this._platformLocation.search),l=this._platformLocation.hash;return l&&t?`${r}${l}`:r}pushState(t,r,l,d){const y=this.prepareExternalUrl(l+Eh(d));this._platformLocation.pushState(t,r,y)}replaceState(t,r,l,d){const y=this.prepareExternalUrl(l+Eh(d));this._platformLocation.replaceState(t,r,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Y1),sn(IM,8))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),WO=(()=>{class e extends tp{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=K1(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,l,d){let y=this.prepareExternalUrl(l+Eh(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(t,r,y)}replaceState(t,r,l,d){let y=this.prepareExternalUrl(l+Eh(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Y1),sn(IM,8))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})(),J1=(()=>{class e{constructor(t){this._subject=new s,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function KO(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(SM(PM(r))),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Eh(r))}normalize(t){return e.stripTrailingSlash(function YO(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,PM(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",l=null){this._locationStrategy.pushState(l,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Eh(r)),l)}replaceState(t,r="",l=null){this._locationStrategy.replaceState(l,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Eh(r)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(l=>l(t,r))}subscribe(t,r,l){return this._subject.subscribe({next:t,error:r,complete:l})}static#e=this.normalizeQueryParams=Eh;static#t=this.joinWithSlash=K1;static#n=this.stripTrailingSlash=SM;static#i=this.\u0275fac=function(r){return new(r||e)(sn(tp))};static#r=this.\u0275prov=an({token:e,factory:function(){return function XO(){return new J1(sn(tp))}()},providedIn:"root"})}return e})();function PM(e){return e.replace(/\/index.html$/,"")}var ma=function(e){return e[e.Format=0]="Format",e[e.Standalone=1]="Standalone",e}(ma||{}),Dr=function(e){return e[e.Narrow=0]="Narrow",e[e.Abbreviated=1]="Abbreviated",e[e.Wide=2]="Wide",e[e.Short=3]="Short",e}(Dr||{}),Tl=function(e){return e[e.Short=0]="Short",e[e.Medium=1]="Medium",e[e.Long=2]="Long",e[e.Full=3]="Full",e}(Tl||{}),Eo=function(e){return e[e.Decimal=0]="Decimal",e[e.Group=1]="Group",e[e.List=2]="List",e[e.PercentSign=3]="PercentSign",e[e.PlusSign=4]="PlusSign",e[e.MinusSign=5]="MinusSign",e[e.Exponential=6]="Exponential",e[e.SuperscriptingExponent=7]="SuperscriptingExponent",e[e.PerMille=8]="PerMille",e[e.Infinity=9]="Infinity",e[e.NaN=10]="NaN",e[e.TimeSeparator=11]="TimeSeparator",e[e.CurrencyDecimal=12]="CurrencyDecimal",e[e.CurrencyGroup=13]="CurrencyGroup",e}(Eo||{});function F0(e,n){return rc(fa(e)[Pr.DateFormat],n)}function z0(e,n){return rc(fa(e)[Pr.TimeFormat],n)}function B0(e,n){return rc(fa(e)[Pr.DateTimeFormat],n)}function ic(e,n){const t=fa(e),r=t[Pr.NumberSymbols][n];if(typeof r>"u"){if(n===Eo.CurrencyDecimal)return t[Pr.NumberSymbols][Eo.Decimal];if(n===Eo.CurrencyGroup)return t[Pr.NumberSymbols][Eo.Group]}return r}function LM(e){if(!e[Pr.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[Pr.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function rc(e,n){for(let t=n;t>-1;t--)if(typeof e[t]<"u")return e[t];throw new Error("Locale data API: locale data undefined")}function ew(e){const[n,t]=e.split(":");return{hours:+n,minutes:+t}}const hN=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ty={},dN=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Ch=function(e){return e[e.Short=0]="Short",e[e.ShortGMT=1]="ShortGMT",e[e.Long=2]="Long",e[e.Extended=3]="Extended",e}(Ch||{}),nr=function(e){return e[e.FullYear=0]="FullYear",e[e.Month=1]="Month",e[e.Date=2]="Date",e[e.Hours=3]="Hours",e[e.Minutes=4]="Minutes",e[e.Seconds=5]="Seconds",e[e.FractionalSeconds=6]="FractionalSeconds",e[e.Day=7]="Day",e}(nr||{}),ir=function(e){return e[e.DayPeriods=0]="DayPeriods",e[e.Days=1]="Days",e[e.Months=2]="Months",e[e.Eras=3]="Eras",e}(ir||{});function fN(e,n,t,r){let l=function wN(e){if(NM(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[l,d=1,y=1]=e.split("-").map(C=>+C);return V0(l,d-1,y)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let r;if(r=e.match(hN))return function EN(e){const n=new Date(0);let t=0,r=0;const l=e[8]?n.setUTCFullYear:n.setFullYear,d=e[8]?n.setUTCHours:n.setHours;e[9]&&(t=Number(e[9]+e[10]),r=Number(e[9]+e[11])),l.call(n,Number(e[1]),Number(e[2])-1,Number(e[3]));const y=Number(e[4]||0)-t,C=Number(e[5]||0)-r,D=Number(e[6]||0),O=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return d.call(n,y,C,D,O),n}(r)}const n=new Date(e);if(!NM(n))throw new Error(`Unable to convert "${e}" into a date`);return n}(e);n=Th(t,n)||n;let C,y=[];for(;n;){if(C=dN.exec(n),!C){y.push(n);break}{y=y.concat(C.slice(1));const $=y.pop();if(!$)break;n=$}}let D=l.getTimezoneOffset();r&&(D=OM(r,D),l=function bN(e,n,t){const r=t?-1:1,l=e.getTimezoneOffset();return function xN(e,n){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+n),e}(e,r*(OM(n,l)-l))}(l,r,!0));let O="";return y.forEach($=>{const W=function vN(e){if(nw[e])return nw[e];let n;switch(e){case"G":case"GG":case"GGG":n=Rr(ir.Eras,Dr.Abbreviated);break;case"GGGG":n=Rr(ir.Eras,Dr.Wide);break;case"GGGGG":n=Rr(ir.Eras,Dr.Narrow);break;case"y":n=So(nr.FullYear,1,0,!1,!0);break;case"yy":n=So(nr.FullYear,2,0,!0,!0);break;case"yyy":n=So(nr.FullYear,3,0,!1,!0);break;case"yyyy":n=So(nr.FullYear,4,0,!1,!0);break;case"Y":n=H0(1);break;case"YY":n=H0(2,!0);break;case"YYY":n=H0(3);break;case"YYYY":n=H0(4);break;case"M":case"L":n=So(nr.Month,1,1);break;case"MM":case"LL":n=So(nr.Month,2,1);break;case"MMM":n=Rr(ir.Months,Dr.Abbreviated);break;case"MMMM":n=Rr(ir.Months,Dr.Wide);break;case"MMMMM":n=Rr(ir.Months,Dr.Narrow);break;case"LLL":n=Rr(ir.Months,Dr.Abbreviated,ma.Standalone);break;case"LLLL":n=Rr(ir.Months,Dr.Wide,ma.Standalone);break;case"LLLLL":n=Rr(ir.Months,Dr.Narrow,ma.Standalone);break;case"w":n=tw(1);break;case"ww":n=tw(2);break;case"W":n=tw(1,!0);break;case"d":n=So(nr.Date,1);break;case"dd":n=So(nr.Date,2);break;case"c":case"cc":n=So(nr.Day,1);break;case"ccc":n=Rr(ir.Days,Dr.Abbreviated,ma.Standalone);break;case"cccc":n=Rr(ir.Days,Dr.Wide,ma.Standalone);break;case"ccccc":n=Rr(ir.Days,Dr.Narrow,ma.Standalone);break;case"cccccc":n=Rr(ir.Days,Dr.Short,ma.Standalone);break;case"E":case"EE":case"EEE":n=Rr(ir.Days,Dr.Abbreviated);break;case"EEEE":n=Rr(ir.Days,Dr.Wide);break;case"EEEEE":n=Rr(ir.Days,Dr.Narrow);break;case"EEEEEE":n=Rr(ir.Days,Dr.Short);break;case"a":case"aa":case"aaa":n=Rr(ir.DayPeriods,Dr.Abbreviated);break;case"aaaa":n=Rr(ir.DayPeriods,Dr.Wide);break;case"aaaaa":n=Rr(ir.DayPeriods,Dr.Narrow);break;case"b":case"bb":case"bbb":n=Rr(ir.DayPeriods,Dr.Abbreviated,ma.Standalone,!0);break;case"bbbb":n=Rr(ir.DayPeriods,Dr.Wide,ma.Standalone,!0);break;case"bbbbb":n=Rr(ir.DayPeriods,Dr.Narrow,ma.Standalone,!0);break;case"B":case"BB":case"BBB":n=Rr(ir.DayPeriods,Dr.Abbreviated,ma.Format,!0);break;case"BBBB":n=Rr(ir.DayPeriods,Dr.Wide,ma.Format,!0);break;case"BBBBB":n=Rr(ir.DayPeriods,Dr.Narrow,ma.Format,!0);break;case"h":n=So(nr.Hours,1,-12);break;case"hh":n=So(nr.Hours,2,-12);break;case"H":n=So(nr.Hours,1);break;case"HH":n=So(nr.Hours,2);break;case"m":n=So(nr.Minutes,1);break;case"mm":n=So(nr.Minutes,2);break;case"s":n=So(nr.Seconds,1);break;case"ss":n=So(nr.Seconds,2);break;case"S":n=So(nr.FractionalSeconds,1);break;case"SS":n=So(nr.FractionalSeconds,2);break;case"SSS":n=So(nr.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=j0(Ch.Short);break;case"ZZZZZ":n=j0(Ch.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=j0(Ch.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=j0(Ch.Long);break;default:return null}return nw[e]=n,n}($);O+=W?W(l,t,D):"''"===$?"'":$.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),O}function V0(e,n,t){const r=new Date(0);return r.setFullYear(e,n,t),r.setHours(0,0,0),r}function Th(e,n){const t=function QO(e){return fa(e)[Pr.LocaleId]}(e);if(ty[t]=ty[t]||{},ty[t][n])return ty[t][n];let r="";switch(n){case"shortDate":r=F0(e,Tl.Short);break;case"mediumDate":r=F0(e,Tl.Medium);break;case"longDate":r=F0(e,Tl.Long);break;case"fullDate":r=F0(e,Tl.Full);break;case"shortTime":r=z0(e,Tl.Short);break;case"mediumTime":r=z0(e,Tl.Medium);break;case"longTime":r=z0(e,Tl.Long);break;case"fullTime":r=z0(e,Tl.Full);break;case"short":const l=Th(e,"shortTime"),d=Th(e,"shortDate");r=U0(B0(e,Tl.Short),[l,d]);break;case"medium":const y=Th(e,"mediumTime"),C=Th(e,"mediumDate");r=U0(B0(e,Tl.Medium),[y,C]);break;case"long":const D=Th(e,"longTime"),O=Th(e,"longDate");r=U0(B0(e,Tl.Long),[D,O]);break;case"full":const $=Th(e,"fullTime"),W=Th(e,"fullDate");r=U0(B0(e,Tl.Full),[$,W])}return r&&(ty[t][n]=r),r}function U0(e,n){return n&&(e=e.replace(/\{([^}]+)}/g,function(t,r){return null!=n&&r in n?n[r]:t})),e}function Vc(e,n,t="-",r,l){let d="";(e<0||l&&e<=0)&&(l?e=1-e:(e=-e,d=t));let y=String(e);for(;y.length<n;)y="0"+y;return r&&(y=y.slice(y.length-n)),d+y}function So(e,n,t=0,r=!1,l=!1){return function(d,y){let C=function mN(e,n){switch(e){case nr.FullYear:return n.getFullYear();case nr.Month:return n.getMonth();case nr.Date:return n.getDate();case nr.Hours:return n.getHours();case nr.Minutes:return n.getMinutes();case nr.Seconds:return n.getSeconds();case nr.FractionalSeconds:return n.getMilliseconds();case nr.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,d);if((t>0||C>-t)&&(C+=t),e===nr.Hours)0===C&&-12===t&&(C=12);else if(e===nr.FractionalSeconds)return function pN(e,n){return Vc(e,3).substring(0,n)}(C,n);const D=ic(y,Eo.MinusSign);return Vc(C,n,D,r,l)}}function Rr(e,n,t=ma.Format,r=!1){return function(l,d){return function gN(e,n,t,r,l,d){switch(t){case ir.Months:return function nN(e,n,t){const r=fa(e),d=rc([r[Pr.MonthsFormat],r[Pr.MonthsStandalone]],n);return rc(d,t)}(n,l,r)[e.getMonth()];case ir.Days:return function tN(e,n,t){const r=fa(e),d=rc([r[Pr.DaysFormat],r[Pr.DaysStandalone]],n);return rc(d,t)}(n,l,r)[e.getDay()];case ir.DayPeriods:const y=e.getHours(),C=e.getMinutes();if(d){const O=function sN(e){const n=fa(e);return LM(n),(n[Pr.ExtraData][2]||[]).map(r=>"string"==typeof r?ew(r):[ew(r[0]),ew(r[1])])}(n),$=function aN(e,n,t){const r=fa(e);LM(r);const d=rc([r[Pr.ExtraData][0],r[Pr.ExtraData][1]],n)||[];return rc(d,t)||[]}(n,l,r),W=O.findIndex(oe=>{if(Array.isArray(oe)){const[be,Ye]=oe,nt=y>=be.hours&&C>=be.minutes,mt=y<Ye.hours||y===Ye.hours&&C<Ye.minutes;if(be.hours<Ye.hours){if(nt&&mt)return!0}else if(nt||mt)return!0}else if(oe.hours===y&&oe.minutes===C)return!0;return!1});if(-1!==W)return $[W]}return function eN(e,n,t){const r=fa(e),d=rc([r[Pr.DayPeriodsFormat],r[Pr.DayPeriodsStandalone]],n);return rc(d,t)}(n,l,r)[y<12?0:1];case ir.Eras:return function iN(e,n){return rc(fa(e)[Pr.Eras],n)}(n,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${t}`)}}(l,d,e,n,t,r)}}function j0(e){return function(n,t,r){const l=-1*r,d=ic(t,Eo.MinusSign),y=l>0?Math.floor(l/60):Math.ceil(l/60);switch(e){case Ch.Short:return(l>=0?"+":"")+Vc(y,2,d)+Vc(Math.abs(l%60),2,d);case Ch.ShortGMT:return"GMT"+(l>=0?"+":"")+Vc(y,1,d);case Ch.Long:return"GMT"+(l>=0?"+":"")+Vc(y,2,d)+":"+Vc(Math.abs(l%60),2,d);case Ch.Extended:return 0===r?"Z":(l>=0?"+":"")+Vc(y,2,d)+":"+Vc(Math.abs(l%60),2,d);default:throw new Error(`Unknown zone width "${e}"`)}}}const _N=0,$0=4;function kM(e){return V0(e.getFullYear(),e.getMonth(),e.getDate()+($0-e.getDay()))}function tw(e,n=!1){return function(t,r){let l;if(n){const d=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,y=t.getDate();l=1+Math.floor((y+d)/7)}else{const d=kM(t),y=function yN(e){const n=V0(e,_N,1).getDay();return V0(e,0,1+(n<=$0?$0:$0+7)-n)}(d.getFullYear()),C=d.getTime()-y.getTime();l=1+Math.round(C/6048e5)}return Vc(l,e,ic(r,Eo.MinusSign))}}function H0(e,n=!1){return function(t,r){return Vc(kM(t).getFullYear(),e,ic(r,Eo.MinusSign),n)}}const nw={};function OM(e,n){e=e.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(t)?n:t}function NM(e){return e instanceof Date&&!isNaN(e.valueOf())}function VM(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[l,d]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(l.trim()===n)return decodeURIComponent(d)}return null}const lw=/\s+/,UM=[];let q0=(()=>{class e{constructor(t,r,l,d){this._iterableDiffers=t,this._keyValueDiffers=r,this._ngEl=l,this._renderer=d,this.initialClasses=UM,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(lw):UM}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(lw):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){const l=this.stateMap.get(t);void 0!==l?(l.enabled!==r&&(l.changed=!0,l.enabled=r),l.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],l=t[1];l.changed?(this._toggleClass(r,l.enabled),l.changed=!1):l.touched||(l.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),l.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split(lw).forEach(l=>{r?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(k0),Qe(ey),Qe(ha),Qe(Za))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class NN{constructor(n,t,r,l){this.$implicit=n,this.ngForOf=t,this.index=r,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Dh=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,l){this._viewContainer=t,this._template=r,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((l,d,y)=>{if(null==l.previousIndex)r.createEmbeddedView(this._template,new NN(l.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)r.remove(null===d?void 0:d);else if(null!==d){const C=r.get(d);r.move(C,y),$M(C,l)}});for(let l=0,d=r.length;l<d;l++){const C=r.get(l).context;C.index=l,C.count=d,C.ngForOf=this._ngForOf}t.forEachIdentityChange(l=>{$M(r.get(l.currentIndex),l)})}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Bc),Qe(bh),Qe(k0))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function $M(e,n){e.context.$implicit=n.item}let Uc=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new FN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){HM("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){HM("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Bc),Qe(bh))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class FN{constructor(){this.$implicit=null,this.ngIf=null}}function HM(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${ar(n)}'.`)}const YN=new Xt("DATE_PIPE_DEFAULT_TIMEZONE"),KN=new Xt("DATE_PIPE_DEFAULT_OPTIONS");let hw=(()=>{class e{constructor(t,r,l){this.locale=t,this.defaultTimezone=r,this.defaultOptions=l}transform(t,r,l,d){if(null==t||""===t||t!=t)return null;try{return fN(t,r??this.defaultOptions?.dateFormat??"mediumDate",d||this.locale,l??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(y){throw function jc(e,n){return new Mt(2100,!1)}()}}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(wh,16),Qe(YN,24),Qe(KN,24))};static#t=this.\u0275pipe=br({name:"date",type:e,pure:!0,standalone:!0})}return e})(),aF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();function WM(e){return"server"===e}let hF=(()=>{class e{static#e=this.\u0275prov=an({token:e,providedIn:"root",factory:()=>new dF(sn(Cl),window)})}return e})();class dF{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function fF(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=r.currentNode;for(;l;){const d=l.shadowRoot;if(d){const y=d.getElementById(n)||d.querySelector(`[name="${n}"]`);if(y)return y}l=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,l=t.top+this.window.pageYOffset,d=this.offset();this.window.scrollTo(r-d[0],l-d[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class XM{}class NF extends GO{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class gw extends NF{static makeCurrent(){!function HO(e){X1||(X1=e)}(new gw)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function FF(){return ry=ry||document.querySelector("base"),ry?ry.getAttribute("href"):null}();return null==t?null:function zF(e){X0=X0||document.createElement("a"),X0.setAttribute("href",e);const n=X0.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){ry=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return VM(document.cookie,n)}}let X0,ry=null,VF=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const _w=new Xt("EventManagerPlugins");let eS=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(l=>{l.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,l){return this._findPluginFor(r).addEventListener(t,r,l)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(d=>d.supports(t)),!r)throw new Mt(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)(sn(_w),sn(v))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();class tS{constructor(n){this._doc=n}}const yw="ng-app-id";let nS=(()=>{class e{constructor(t,r,l,d={}){this.doc=t,this.appId=r,this.nonce=l,this.platformId=d,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=WM(d),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(l=>l.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${yw}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(l=>{null!=l.textContent&&r.set(l.textContent,l)}),r}return null}changeUsageCount(t,r){const l=this.styleRef;if(l.has(t)){const d=l.get(t);return d.usage+=r,d.usage}return l.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const l=this.styleNodesInDOM,d=l?.get(r);if(d?.parentNode===t)return l.delete(r),d.removeAttribute(yw),d;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=r,this.platformIsServer&&y.setAttribute(yw,this.appId),y}}addStyleToHost(t,r){const l=this.getStyleElement(t,r);t.appendChild(l);const d=this.styleRef,y=d.get(r)?.elements;y?y.push(l):d.set(r,{elements:[l],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl),sn(zf),sn(Bf,8),sn(fh))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const vw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},xw=/%COMP%/g,HF=new Xt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function rS(e,n){return n.map(t=>t.replace(xw,e))}let oS=(()=>{class e{constructor(t,r,l,d,y,C,D,O=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=l,this.removeStylesOnCompDestroy=d,this.doc=y,this.platformId=C,this.ngZone=D,this.nonce=O,this.rendererByCompId=new Map,this.platformIsServer=WM(C),this.defaultRenderer=new bw(t,y,D,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===xr.ShadowDom&&(r={...r,encapsulation:xr.Emulated});const l=this.getOrCreateRenderer(t,r);return l instanceof aS?l.applyToHost(t):l instanceof ww&&l.applyStyles(),l}getOrCreateRenderer(t,r){const l=this.rendererByCompId;let d=l.get(r.id);if(!d){const y=this.doc,C=this.ngZone,D=this.eventManager,O=this.sharedStylesHost,$=this.removeStylesOnCompDestroy,W=this.platformIsServer;switch(r.encapsulation){case xr.Emulated:d=new aS(D,O,r,this.appId,$,y,C,W);break;case xr.ShadowDom:return new WF(D,O,t,r,y,C,this.nonce,W);default:d=new ww(D,O,r,$,y,C,W)}l.set(r.id,d)}return d}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)(sn(eS),sn(nS),sn(zf),sn(HF),sn(Cl),sn(fh),sn(v),sn(Bf))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();class bw{constructor(n,t,r,l){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(vw[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(sS(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(sS(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new Mt(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,l){if(l){t=l+":"+t;const d=vw[l];d?n.setAttributeNS(d,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const l=vw[r];l?n.removeAttributeNS(l,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,l){l&(Yl.DashCase|Yl.Important)?n.style.setProperty(t,r,l&Yl.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&Yl.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){n[t]=r}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=Pd().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function sS(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class WF extends bw{constructor(n,t,r,l,d,y,C,D){super(n,d,y,D),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const O=rS(l.id,l.styles);for(const $ of O){const W=document.createElement("style");C&&W.setAttribute("nonce",C),W.textContent=$,this.shadowRoot.appendChild(W)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class ww extends bw{constructor(n,t,r,l,d,y,C,D){super(n,d,y,C),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=l,this.styles=D?rS(D,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class aS extends ww{constructor(n,t,r,l,d,y,C,D){const O=l+"-"+r.id;super(n,t,r,d,y,C,D,O),this.contentAttr=function GF(e){return"_ngcontent-%COMP%".replace(xw,e)}(O),this.hostAttr=function qF(e){return"_nghost-%COMP%".replace(xw,e)}(O)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let XF=(()=>{class e extends tS{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,l){return t.addEventListener(r,l,!1),()=>this.removeEventListener(t,r,l)}removeEventListener(t,r,l){return t.removeEventListener(r,l)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const lS=["alt","control","meta","shift"],YF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},KF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let JF=(()=>{class e extends tS{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,l){const d=e.parseEventName(r),y=e.eventCallback(d.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Pd().onAndCancel(t,d.domEventName,y))}static parseEventName(t){const r=t.toLowerCase().split("."),l=r.shift();if(0===r.length||"keydown"!==l&&"keyup"!==l)return null;const d=e._normalizeKey(r.pop());let y="",C=r.indexOf("code");if(C>-1&&(r.splice(C,1),y="code."),lS.forEach(O=>{const $=r.indexOf(O);$>-1&&(r.splice($,1),y+=O+".")}),y+=d,0!=r.length||0===d.length)return null;const D={};return D.domEventName=l,D.fullKey=y,D}static matchEventFullKeyCode(t,r){let l=YF[t.key]||t.key,d="";return r.indexOf("code.")>-1&&(l=t.code,d="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),lS.forEach(y=>{y!==l&&(0,KF[y])(t)&&(d+=y+".")}),d+=l,d===r)}static eventCallback(t,r,l){return d=>{e.matchEventFullKeyCode(d,t)&&l.runGuarded(()=>r(d))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const nz=nM(AO,"browser",[{provide:fh,useValue:"browser"},{provide:u_,useValue:function QF(){gw.makeCurrent()},multi:!0},{provide:Cl,useFactory:function tz(){return function _b(e){Wg=e}(document),document},deps:[]}]),iz=new Xt(""),hS=[{provide:A0,useClass:class BF{addToWindow(n){Di.getAngularTestability=(r,l=!0)=>{const d=n.findTestabilityInTree(r,l);if(null==d)throw new Mt(5103,!1);return d},Di.getAllAngularTestabilities=()=>n.getAllTestabilities(),Di.getAllAngularRootElements=()=>n.getAllRootElements(),Di.frameworkStabilizers||(Di.frameworkStabilizers=[]),Di.frameworkStabilizers.push(r=>{const l=Di.getAllAngularTestabilities();let d=l.length,y=!1;const C=function(D){y=y||D,d--,0==d&&r(y)};l.forEach(D=>{D.whenStable(C)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?Pd().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:KD,useClass:z1,deps:[v,B1,A0]},{provide:z1,useClass:z1,deps:[v,B1,A0]}],dS=[{provide:a_,useValue:"root"},{provide:tc,useFactory:function ez(){return new tc},deps:[]},{provide:_w,useClass:XF,multi:!0,deps:[Cl,v,fh]},{provide:_w,useClass:JF,multi:!0,deps:[Cl]},oS,nS,eS,{provide:wm,useExisting:oS},{provide:XM,useClass:VF,deps:[]},[]];let rz=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:zf,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)(sn(iz,12))};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({providers:[...dS,...hS],imports:[aF,PO]})}return e})(),fS=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl))};static#t=this.\u0275prov=an({token:e,factory:function(r){let l=null;return l=r?new r:function sz(){return new fS(sn(Cl))}(),l},providedIn:"root"})}return e})();typeof window<"u"&&window;const{isArray:dz}=Array,{getPrototypeOf:fz,prototype:pz,keys:mz}=Object;function _S(e){if(1===e.length){const n=e[0];if(dz(n))return{args:n,keys:null};if(function gz(e){return e&&"object"==typeof e&&fz(e)===pz}(n)){const t=mz(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:_z}=Array;function yS(e){return An(n=>function yz(e,n){return _z(n)?e(...n):e(n)}(e,n))}function vS(e,n){return e.reduce((t,r,l)=>(t[r]=n[l],t),{})}function Cw(...e){const n=_o(e),t=Ta(e),{args:r,keys:l}=_S(e);if(0===r.length)return ot([],n);const d=new In(function vz(e,n,t=En){return r=>{xS(n,()=>{const{length:l}=e,d=new Array(l);let y=l,C=l;for(let D=0;D<l;D++)xS(n,()=>{const O=ot(e[D],n);let $=!1;O.subscribe(ln(r,W=>{d[D]=W,$||($=!0,C--),C||r.next(t(d.slice()))},()=>{--y||r.complete()}))},r)},r)}}(r,n,l?y=>vS(l,y):En));return t?d.pipe(yS(t)):d}function xS(e,n,t){e?Kn(t,e,n):n()}const Y0=u(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Tw(...e){return function xz(){return Ca(1)}()(ot(e,_o(e)))}function bS(e){return new In(n=>{Mi(e()).subscribe(n)})}function Dl(e,n){const t=Me(e)?e:()=>e,r=l=>l.error(t());return new In(n?l=>n.schedule(r,0,l):r)}function Dw(){return pi((e,n)=>{let t=null;e._refCount++;const r=ln(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const l=e._connection,d=t;t=null,l&&(!d||l===d)&&l.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class wS extends In{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,di(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Le;const t=this.getSubject();n.add(this.source.subscribe(ln(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Le.EMPTY)}return n}refCount(){return Dw()(this)}}function Hm(e){return e<=0?()=>oo:pi((n,t)=>{let r=0;n.subscribe(ln(t,l=>{++r<=e&&(t.next(l),e<=r&&t.complete())}))})}function Mh(e,n){return pi((t,r)=>{let l=0;t.subscribe(ln(r,d=>e.call(n,d,l++)&&r.next(d)))})}function K0(e){return pi((n,t)=>{let r=!1;n.subscribe(ln(t,l=>{r=!0,t.next(l)},()=>{r||t.next(e),t.complete()}))})}function ES(e=wz){return pi((n,t)=>{let r=!1;n.subscribe(ln(t,l=>{r=!0,t.next(l)},()=>r?t.complete():t.error(e())))})}function wz(){return new Y0}function np(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Mh((l,d)=>e(l,d,r)):En,Hm(1),t?K0(n):ES(()=>new Y0))}function Gm(e,n){return Me(n)?vr(e,n,1):vr(e,1)}function ts(e,n,t){const r=Me(e)||n||t?{next:e,error:n,complete:t}:e;return r?pi((l,d)=>{var y;null===(y=r.subscribe)||void 0===y||y.call(r);let C=!0;l.subscribe(ln(d,D=>{var O;null===(O=r.next)||void 0===O||O.call(r,D),d.next(D)},()=>{var D;C=!1,null===(D=r.complete)||void 0===D||D.call(r),d.complete()},D=>{var O;C=!1,null===(O=r.error)||void 0===O||O.call(r,D),d.error(D)},()=>{var D,O;C&&(null===(D=r.unsubscribe)||void 0===D||D.call(r)),null===(O=r.finalize)||void 0===O||O.call(r)}))}):En}function ga(e){return pi((n,t)=>{let d,r=null,l=!1;r=n.subscribe(ln(t,void 0,void 0,y=>{d=Mi(e(y,ga(e)(n))),r?(r.unsubscribe(),r=null,d.subscribe(t)):l=!0})),l&&(r.unsubscribe(),r=null,d.subscribe(t))})}function Mw(e){return e<=0?()=>oo:pi((n,t)=>{let r=[];n.subscribe(ln(t,l=>{r.push(l),e<r.length&&r.shift()},()=>{for(const l of r)t.next(l);t.complete()},void 0,()=>{r=null}))})}function oy(e){return pi((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const hi="primary",sy=Symbol("RouteTitle");class Sz{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function qm(e){return new Sz(e)}function Iz(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const l={};for(let d=0;d<r.length;d++){const y=r[d],C=e[d];if(y.startsWith(":"))l[y.substring(1)]=C;else if(y!==C.path)return null}return{consumed:e.slice(0,r.length),posParams:l}}function Tu(e,n){const t=e?Object.keys(e):void 0,r=n?Object.keys(n):void 0;if(!t||!r||t.length!=r.length)return!1;let l;for(let d=0;d<t.length;d++)if(l=t[d],!CS(e[l],n[l]))return!1;return!0}function CS(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((l,d)=>r[d]===l)}return e===n}function TS(e){return e.length>0?e[e.length-1]:null}function Ld(e){return function hz(e){return!!e&&(e instanceof In||Me(e.lift)&&Me(e.subscribe))}(e)?e:V_(e)?ot(Promise.resolve(e)):fn(e)}const Pz={exact:function SS(e,n,t){if(!ip(e.segments,n.segments)||!J0(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!SS(e.children[r],n.children[r],t))return!1;return!0},subset:IS},DS={exact:function Rz(e,n){return Tu(e,n)},subset:function Lz(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>CS(e[t],n[t]))},ignored:()=>!0};function MS(e,n,t){return Pz[t.paths](e.root,n.root,t.matrixParams)&&DS[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function IS(e,n,t){return AS(e,n,n.segments,t)}function AS(e,n,t,r){if(e.segments.length>t.length){const l=e.segments.slice(0,t.length);return!(!ip(l,t)||n.hasChildren()||!J0(l,t,r))}if(e.segments.length===t.length){if(!ip(e.segments,t)||!J0(e.segments,t,r))return!1;for(const l in n.children)if(!e.children[l]||!IS(e.children[l],n.children[l],r))return!1;return!0}{const l=t.slice(0,e.segments.length),d=t.slice(e.segments.length);return!!(ip(e.segments,l)&&J0(e.segments,l,r)&&e.children[hi])&&AS(e.children[hi],n,d,r)}}function J0(e,n,t){return n.every((r,l)=>DS[t](e[l].parameters,r.parameters))}class Zm{constructor(n=new yr([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qm(this.queryParams)),this._queryParamMap}toString(){return Nz.serialize(this)}}class yr{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Q0(this)}}class ay{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=qm(this.parameters)),this._parameterMap}toString(){return LS(this)}}function ip(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let ly=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return new Sw},providedIn:"root"})}return e})();class Sw{parse(n){const t=new Zz(n);return new Zm(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${cy(n.root,!0)}`,r=function Bz(e){const n=Object.keys(e).map(t=>{const r=e[t];return Array.isArray(r)?r.map(l=>`${ex(t)}=${ex(l)}`).join("&"):`${ex(t)}=${ex(r)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function Fz(e){return encodeURI(e)}(n.fragment)}`:""}`}}const Nz=new Sw;function Q0(e){return e.segments.map(n=>LS(n)).join("/")}function cy(e,n){if(!e.hasChildren())return Q0(e);if(n){const t=e.children[hi]?cy(e.children[hi],!1):"",r=[];return Object.entries(e.children).forEach(([l,d])=>{l!==hi&&r.push(`${l}:${cy(d,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function Oz(e,n){let t=[];return Object.entries(e.children).forEach(([r,l])=>{r===hi&&(t=t.concat(n(l,r)))}),Object.entries(e.children).forEach(([r,l])=>{r!==hi&&(t=t.concat(n(l,r)))}),t}(e,(r,l)=>l===hi?[cy(e.children[hi],!1)]:[`${l}:${cy(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[hi]?`${Q0(e)}/${t[0]}`:`${Q0(e)}/(${t.join("//")})`}}function PS(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ex(e){return PS(e).replace(/%3B/gi,";")}function Iw(e){return PS(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function tx(e){return decodeURIComponent(e)}function RS(e){return tx(e.replace(/\+/g,"%20"))}function LS(e){return`${Iw(e.path)}${function zz(e){return Object.keys(e).map(n=>`;${Iw(n)}=${Iw(e[n])}`).join("")}(e.parameters)}`}const Vz=/^[^\/()?;#]+/;function Aw(e){const n=e.match(Vz);return n?n[0]:""}const Uz=/^[^\/()?;=#]+/,$z=/^[^=?&#]+/,Gz=/^[^&#]+/;class Zz{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new yr([],{}):new yr([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[hi]=new yr(n,t)),r}parseSegment(){const n=Aw(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Mt(4009,!1);return this.capture(n),new ay(tx(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function jz(e){const n=e.match(Uz);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const l=Aw(this.remaining);l&&(r=l,this.capture(r))}n[tx(t)]=tx(r)}parseQueryParam(n){const t=function Hz(e){const n=e.match($z);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const y=function qz(e){const n=e.match(Gz);return n?n[0]:""}(this.remaining);y&&(r=y,this.capture(r))}const l=RS(t),d=RS(r);if(n.hasOwnProperty(l)){let y=n[l];Array.isArray(y)||(y=[y],n[l]=y),y.push(d)}else n[l]=d}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Aw(this.remaining),l=this.remaining[r.length];if("/"!==l&&")"!==l&&";"!==l)throw new Mt(4010,!1);let d;r.indexOf(":")>-1?(d=r.slice(0,r.indexOf(":")),this.capture(d),this.capture(":")):n&&(d=hi);const y=this.parseChildren();t[d]=1===Object.keys(y).length?y[hi]:new yr([],y),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Mt(4011,!1)}}function kS(e){return e.segments.length>0?new yr([],{[hi]:e}):e}function OS(e){const n={};for(const r of Object.keys(e.children)){const d=OS(e.children[r]);if(r===hi&&0===d.segments.length&&d.hasChildren())for(const[y,C]of Object.entries(d.children))n[y]=C;else(d.segments.length>0||d.hasChildren())&&(n[r]=d)}return function Wz(e){if(1===e.numberOfChildren&&e.children[hi]){const n=e.children[hi];return new yr(e.segments.concat(n.segments),n.children)}return e}(new yr(e.segments,n))}function rp(e){return e instanceof Zm}function NS(e){let n;const l=kS(function t(d){const y={};for(const D of d.children){const O=t(D);y[D.outlet]=O}const C=new yr(d.url,y);return d===e&&(n=C),C}(e.root));return n??l}function FS(e,n,t,r){let l=e;for(;l.parent;)l=l.parent;if(0===n.length)return Pw(l,l,l,t,r);const d=function Yz(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new BS(!0,0,e);let n=0,t=!1;const r=e.reduce((l,d,y)=>{if("object"==typeof d&&null!=d){if(d.outlets){const C={};return Object.entries(d.outlets).forEach(([D,O])=>{C[D]="string"==typeof O?O.split("/"):O}),[...l,{outlets:C}]}if(d.segmentPath)return[...l,d.segmentPath]}return"string"!=typeof d?[...l,d]:0===y?(d.split("/").forEach((C,D)=>{0==D&&"."===C||(0==D&&""===C?t=!0:".."===C?n++:""!=C&&l.push(C))}),l):[...l,d]},[]);return new BS(t,n,r)}(n);if(d.toRoot())return Pw(l,l,new yr([],{}),t,r);const y=function Kz(e,n,t){if(e.isAbsolute)return new ix(n,!0,0);if(!t)return new ix(n,!1,NaN);if(null===t.parent)return new ix(t,!0,0);const r=nx(e.commands[0])?0:1;return function Jz(e,n,t){let r=e,l=n,d=t;for(;d>l;){if(d-=l,r=r.parent,!r)throw new Mt(4005,!1);l=r.segments.length}return new ix(r,!1,l-d)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(d,l,e),C=y.processChildren?hy(y.segmentGroup,y.index,d.commands):VS(y.segmentGroup,y.index,d.commands);return Pw(l,y.segmentGroup,C,t,r)}function nx(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function uy(e){return"object"==typeof e&&null!=e&&e.outlets}function Pw(e,n,t,r,l){let y,d={};r&&Object.entries(r).forEach(([D,O])=>{d[D]=Array.isArray(O)?O.map($=>`${$}`):`${O}`}),y=e===n?t:zS(e,n,t);const C=kS(OS(y));return new Zm(C,d,l)}function zS(e,n,t){const r={};return Object.entries(e.children).forEach(([l,d])=>{r[l]=d===n?t:zS(d,n,t)}),new yr(e.segments,r)}class BS{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&nx(r[0]))throw new Mt(4003,!1);const l=r.find(uy);if(l&&l!==TS(r))throw new Mt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class ix{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function VS(e,n,t){if(e||(e=new yr([],{})),0===e.segments.length&&e.hasChildren())return hy(e,n,t);const r=function eB(e,n,t){let r=0,l=n;const d={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(r>=t.length)return d;const y=e.segments[l],C=t[r];if(uy(C))break;const D=`${C}`,O=r<t.length-1?t[r+1]:null;if(l>0&&void 0===D)break;if(D&&O&&"object"==typeof O&&void 0===O.outlets){if(!jS(D,O,y))return d;r+=2}else{if(!jS(D,{},y))return d;r++}l++}return{match:!0,pathIndex:l,commandIndex:r}}(e,n,t),l=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const d=new yr(e.segments.slice(0,r.pathIndex),{});return d.children[hi]=new yr(e.segments.slice(r.pathIndex),e.children),hy(d,0,l)}return r.match&&0===l.length?new yr(e.segments,{}):r.match&&!e.hasChildren()?Rw(e,n,t):r.match?hy(e,0,l):Rw(e,n,t)}function hy(e,n,t){if(0===t.length)return new yr(e.segments,{});{const r=function Qz(e){return uy(e[0])?e[0].outlets:{[hi]:e}}(t),l={};if(Object.keys(r).some(d=>d!==hi)&&e.children[hi]&&1===e.numberOfChildren&&0===e.children[hi].segments.length){const d=hy(e.children[hi],n,t);return new yr(e.segments,d.children)}return Object.entries(r).forEach(([d,y])=>{"string"==typeof y&&(y=[y]),null!==y&&(l[d]=VS(e.children[d],n,y))}),Object.entries(e.children).forEach(([d,y])=>{void 0===r[d]&&(l[d]=y)}),new yr(e.segments,l)}}function Rw(e,n,t){const r=e.segments.slice(0,n);let l=0;for(;l<t.length;){const d=t[l];if(uy(d)){const D=tB(d.outlets);return new yr(r,D)}if(0===l&&nx(t[0])){r.push(new ay(e.segments[n].path,US(t[0]))),l++;continue}const y=uy(d)?d.outlets[hi]:`${d}`,C=l<t.length-1?t[l+1]:null;y&&C&&nx(C)?(r.push(new ay(y,US(C))),l+=2):(r.push(new ay(y,{})),l++)}return new yr(r,{})}function tB(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=Rw(new yr([],{}),0,r))}),n}function US(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function jS(e,n,t){return e==t.path&&Tu(n,t.parameters)}const dy="imperative";class Du{constructor(n,t){this.id=n,this.url=t}}class rx extends Du{constructor(n,t,r="imperative",l=null){super(n,t),this.type=0,this.navigationTrigger=r,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class kd extends Du{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class fy extends Du{constructor(n,t,r,l){super(n,t),this.reason=r,this.code=l,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Wm extends Du{constructor(n,t,r,l){super(n,t),this.reason=r,this.code=l,this.type=16}}class ox extends Du{constructor(n,t,r,l){super(n,t),this.error=r,this.target=l,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class $S extends Du{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class nB extends Du{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iB extends Du{constructor(n,t,r,l,d){super(n,t),this.urlAfterRedirects=r,this.state=l,this.shouldActivate=d,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class rB extends Du{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class oB extends Du{constructor(n,t,r,l){super(n,t),this.urlAfterRedirects=r,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class sB{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class aB{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class lB{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cB{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uB{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hB{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HS{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Lw{}class kw{constructor(n){this.url=n}}class dB{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new py,this.attachRef=null}}let py=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const l=this.getOrCreateContext(t);l.outlet=r,this.contexts.set(t,l)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new dB,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class GS{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=Ow(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=Ow(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=Nw(n,this._root);return t.length<2?[]:t[t.length-2].children.map(l=>l.value).filter(l=>l!==n)}pathFromRoot(n){return Nw(n,this._root).map(t=>t.value)}}function Ow(e,n){if(e===n.value)return n;for(const t of n.children){const r=Ow(e,t);if(r)return r}return null}function Nw(e,n){if(e===n.value)return[n];for(const t of n.children){const r=Nw(e,t);if(r.length)return r.unshift(n),r}return[]}class Sh{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Xm(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class qS extends GS{constructor(n,t){super(n),this.snapshot=t,Fw(this,n)}toString(){return this.snapshot.toString()}}function ZS(e,n){const t=function fB(e,n){const y=new sx([],{},{},"",{},hi,n,null,{});return new XS("",new Sh(y,[]))}(0,n),r=new gn([new ay("",{})]),l=new gn({}),d=new gn({}),y=new gn({}),C=new gn(""),D=new Ih(r,l,y,C,d,hi,n,t.root);return D.snapshot=t.root,new qS(new Sh(D,[]),t)}class Ih{constructor(n,t,r,l,d,y,C,D){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=l,this.dataSubject=d,this.outlet=y,this.component=C,this._futureSnapshot=D,this.title=this.dataSubject?.pipe(An(O=>O[sy]))??fn(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=l,this.data=d}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(An(n=>qm(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(An(n=>qm(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function WS(e,n="emptyOnly"){const t=e.pathFromRoot;let r=0;if("always"!==n)for(r=t.length-1;r>=1;){const l=t[r],d=t[r-1];if(l.routeConfig&&""===l.routeConfig.path)r--;else{if(d.component)break;r--}}return function pB(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class sx{get title(){return this.data?.[sy]}constructor(n,t,r,l,d,y,C,D,O){this.url=n,this.params=t,this.queryParams=r,this.fragment=l,this.data=d,this.outlet=y,this.component=C,this.routeConfig=D,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=qm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class XS extends GS{constructor(n,t){super(t),this.url=n,Fw(this,t)}toString(){return YS(this._root)}}function Fw(e,n){n.value._routerState=e,n.children.forEach(t=>Fw(e,t))}function YS(e){const n=e.children.length>0?` { ${e.children.map(YS).join(", ")} } `:"";return`${e.value}${n}`}function zw(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Tu(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Tu(n.params,t.params)||e.paramsSubject.next(t.params),function Az(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Tu(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Tu(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function Bw(e,n){const t=Tu(e.params,n.params)&&function kz(e,n){return ip(e,n)&&e.every((t,r)=>Tu(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||Bw(e.parent,n.parent))}let Vw=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=hi,this.activateEvents=new s,this.deactivateEvents=new s,this.attachEvents=new s,this.detachEvents=new s,this.parentContexts=tn(py),this.location=tn(Bc),this.changeDetector=tn(Q_),this.environmentInjector=tn(Qo),this.inputBinder=tn(ax,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:l}=t.name;if(r)return;this.isTrackedInParentContexts(l)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(l)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Mt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Mt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Mt(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Mt(4013,!1);this._activatedRoute=t;const l=this.location,y=t.snapshot.component,C=this.parentContexts.getOrCreateContext(this.name).children,D=new mB(t,C,l.injector);this.activated=l.createComponent(y,{index:l.length,injector:D,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Rn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Kt]})}return e})();class mB{constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===Ih?this.route:n===py?this.childContexts:this.parent.get(n,t)}}const ax=new Xt("");let KS=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,l=Cw([r.queryParams,r.params,r.data]).pipe(Wi(([d,y,C],D)=>(C={...d,...y,...C},0===D?fn(C):Promise.resolve(C)))).subscribe(d=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const y=function $O(e){const n=ii(e);if(!n)return null;const t=new k_(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(y)for(const{templateName:C}of y.inputs)t.activatedComponentRef.setInput(C,d[C]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,l)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function my(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const l=function _B(e,n,t){return n.children.map(r=>{for(const l of t.children)if(e.shouldReuseRoute(r.value,l.value.snapshot))return my(e,r,l);return my(e,r)})}(e,n,t);return new Sh(r,l)}{if(e.shouldAttach(n.value)){const d=e.retrieve(n.value);if(null!==d){const y=d.route;return y.value._futureSnapshot=n.value,y.children=n.children.map(C=>my(e,C)),y}}const r=function yB(e){return new Ih(new gn(e.url),new gn(e.params),new gn(e.queryParams),new gn(e.fragment),new gn(e.data),e.outlet,e.component,e)}(n.value),l=n.children.map(d=>my(e,d));return new Sh(r,l)}}const Uw="ngNavigationCancelingError";function JS(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=rp(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,l=QS(!1,0,n);return l.url=t,l.navigationBehaviorOptions=r,l}function QS(e,n,t){const r=new Error("NavigationCancelingError: "+(e||""));return r[Uw]=!0,r.cancellationCode=n,t&&(r.url=t),r}function eI(e){return e&&e[Uw]}let tI=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=er({type:e,selectors:[["ng-component"]],standalone:!0,features:[eD],decls:1,vars:0,template:function(r,l){1&r&&wo(0,"router-outlet")},dependencies:[Vw],encapsulation:2})}return e})();function jw(e){const n=e.children&&e.children.map(jw),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==hi&&(t.component=tI),t}function $c(e){return e.outlet||hi}function gy(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class DB{constructor(n,t,r,l,d){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=l,this.inputBindingEnabled=d}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),zw(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const l=Xm(t);n.children.forEach(d=>{const y=d.value.outlet;this.deactivateRoutes(d,l[y],r),delete l[y]}),Object.values(l).forEach(d=>{this.deactivateRouteAndItsChildren(d,r)})}deactivateRoutes(n,t,r){const l=n.value,d=t?t.value:null;if(l===d)if(l.component){const y=r.getContext(l.outlet);y&&this.deactivateChildRoutes(n,t,y.children)}else this.deactivateChildRoutes(n,t,r);else d&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),l=r&&n.value.component?r.children:t,d=Xm(n);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);if(r&&r.outlet){const y=r.outlet.detach(),C=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:y,route:n,contexts:C})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),l=r&&n.value.component?r.children:t,d=Xm(n);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const l=Xm(t);n.children.forEach(d=>{this.activateRoutes(d,l[d.value.outlet],r),this.forwardEvent(new hB(d.value.snapshot))}),n.children.length&&this.forwardEvent(new cB(n.value.snapshot))}activateRoutes(n,t,r){const l=n.value,d=t?t.value:null;if(zw(l),l===d)if(l.component){const y=r.getOrCreateContext(l.outlet);this.activateChildRoutes(n,t,y.children)}else this.activateChildRoutes(n,t,r);else if(l.component){const y=r.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const C=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(C.contexts),y.attachRef=C.componentRef,y.route=C.route.value,y.outlet&&y.outlet.attach(C.componentRef,C.route.value),zw(C.route.value),this.activateChildRoutes(n,null,y.children)}else{const C=gy(l.snapshot);y.attachRef=null,y.route=l,y.injector=C,y.outlet&&y.outlet.activateWith(l,y.injector),this.activateChildRoutes(n,null,y.children)}}else this.activateChildRoutes(n,null,r)}}class nI{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class lx{constructor(n,t){this.component=n,this.route=t}}function MB(e,n,t){const r=e._root;return _y(r,n?n._root:null,t,[r.value])}function Ym(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function Rl(e){return null!==Gs(e)}(e)?n.get(e):e:r}function _y(e,n,t,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=Xm(n);return e.children.forEach(y=>{(function IB(e,n,t,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=e.value,y=n?n.value:null,C=t?t.getContext(e.value.outlet):null;if(y&&d.routeConfig===y.routeConfig){const D=function AB(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!ip(e.url,n.url);case"pathParamsOrQueryParamsChange":return!ip(e.url,n.url)||!Tu(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Bw(e,n)||!Tu(e.queryParams,n.queryParams);default:return!Bw(e,n)}}(y,d,d.routeConfig.runGuardsAndResolvers);D?l.canActivateChecks.push(new nI(r)):(d.data=y.data,d._resolvedData=y._resolvedData),_y(e,n,d.component?C?C.children:null:t,r,l),D&&C&&C.outlet&&C.outlet.isActivated&&l.canDeactivateChecks.push(new lx(C.outlet.component,y))}else y&&yy(n,C,l),l.canActivateChecks.push(new nI(r)),_y(e,null,d.component?C?C.children:null:t,r,l)})(y,d[y.value.outlet],t,r.concat([y.value]),l),delete d[y.value.outlet]}),Object.entries(d).forEach(([y,C])=>yy(C,t.getContext(y),l)),l}function yy(e,n,t){const r=Xm(e),l=e.value;Object.entries(r).forEach(([d,y])=>{yy(y,l.component?n?n.children.getContext(d):null:n,t)}),t.canDeactivateChecks.push(new lx(l.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,l))}function vy(e){return"function"==typeof e}function iI(e){return e instanceof Y0||"EmptyError"===e?.name}const cx=Symbol("INITIAL_VALUE");function Km(){return Wi(e=>Cw(e.map(n=>n.pipe(Hm(1),function bz(...e){const n=_o(e);return pi((t,r)=>{(n?Tw(e,t,n):Tw(e,t)).subscribe(r)})}(cx)))).pipe(An(n=>{for(const t of n)if(!0!==t){if(t===cx)return cx;if(!1===t||t instanceof Zm)return t}return!0}),Mh(n=>n!==cx),Hm(1)))}function rI(e){return function rr(...e){return dn(e)}(ts(n=>{if(rp(n))throw JS(0,n)}),An(n=>!0===n))}class ux{constructor(n){this.segmentGroup=n||null}}class oI{constructor(n){this.urlTree=n}}function Jm(e){return Dl(new ux(e))}function sI(e){return Dl(new oI(e))}class YB{constructor(n,t){this.urlSerializer=n,this.urlTree=t}noMatchError(n){return new Mt(4002,!1)}lineralizeSegments(n,t){let r=[],l=t.root;for(;;){if(r=r.concat(l.segments),0===l.numberOfChildren)return fn(r);if(l.numberOfChildren>1||!l.children[hi])return Dl(new Mt(4e3,!1));l=l.children[hi]}}applyRedirectCommands(n,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r)}applyRedirectCreateUrlTree(n,t,r,l){const d=this.createSegmentGroup(n,t.root,r,l);return new Zm(d,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([l,d])=>{if("string"==typeof d&&d.startsWith(":")){const C=d.substring(1);r[l]=t[C]}else r[l]=d}),r}createSegmentGroup(n,t,r,l){const d=this.createSegments(n,t.segments,r,l);let y={};return Object.entries(t.children).forEach(([C,D])=>{y[C]=this.createSegmentGroup(n,D,r,l)}),new yr(d,y)}createSegments(n,t,r,l){return t.map(d=>d.path.startsWith(":")?this.findPosParam(n,d,l):this.findOrReturn(d,r))}findPosParam(n,t,r){const l=r[t.path.substring(1)];if(!l)throw new Mt(4001,!1);return l}findOrReturn(n,t){let r=0;for(const l of t){if(l.path===n.path)return t.splice(r),l;r++}return n}}const $w={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function KB(e,n,t,r,l){const d=Hw(e,n,t);return d.matched?(r=function xB(e,n){return e.providers&&!e._injector&&(e._injector=g1(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function ZB(e,n,t,r){const l=n.canMatch;return l&&0!==l.length?fn(l.map(y=>{const C=Ym(y,e);return Ld(function NB(e){return e&&vy(e.canMatch)}(C)?C.canMatch(n,t):e.runInContext(()=>C(n,t)))})).pipe(Km(),rI()):fn(!0)}(r,n,t).pipe(An(y=>!0===y?d:{...$w}))):fn(d)}function Hw(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...$w}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const l=(n.matcher||Iz)(t,e,n);if(!l)return{...$w};const d={};Object.entries(l.posParams??{}).forEach(([C,D])=>{d[C]=D.path});const y=l.consumed.length>0?{...d,...l.consumed[l.consumed.length-1].parameters}:d;return{matched:!0,consumedSegments:l.consumed,remainingSegments:t.slice(l.consumed.length),parameters:y,positionalParamSegments:l.posParams??{}}}function aI(e,n,t,r){return t.length>0&&function e3(e,n,t){return t.some(r=>hx(e,n,r)&&$c(r)!==hi)}(e,t,r)?{segmentGroup:new yr(n,QB(r,new yr(t,e.children))),slicedSegments:[]}:0===t.length&&function t3(e,n,t){return t.some(r=>hx(e,n,r))}(e,t,r)?{segmentGroup:new yr(e.segments,JB(e,0,t,r,e.children)),slicedSegments:t}:{segmentGroup:new yr(e.segments,e.children),slicedSegments:t}}function JB(e,n,t,r,l){const d={};for(const y of r)if(hx(e,t,y)&&!l[$c(y)]){const C=new yr([],{});d[$c(y)]=C}return{...l,...d}}function QB(e,n){const t={};t[hi]=n;for(const r of e)if(""===r.path&&$c(r)!==hi){const l=new yr([],{});t[$c(r)]=l}return t}function hx(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class o3{constructor(n,t,r,l,d,y,C){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=l,this.urlTree=d,this.paramsInheritanceStrategy=y,this.urlSerializer=C,this.allowRedirects=!0,this.applyRedirects=new YB(this.urlSerializer,this.urlTree)}noMatchError(n){return new Mt(4002,!1)}recognize(){const n=aI(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,hi).pipe(ga(t=>{if(t instanceof oI)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof ux?this.noMatchError(t):t}),An(t=>{const r=new sx([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},hi,this.rootComponentType,null,{}),l=new Sh(r,t),d=new XS("",l),y=function Xz(e,n,t=null,r=null){return FS(NS(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,d.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(d._root),{state:d,tree:y}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,hi).pipe(ga(r=>{throw r instanceof ux?this.noMatchError(r):r}))}inheritParamsAndData(n){const t=n.value,r=WS(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),n.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(n,t,r,l){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r):this.processSegment(n,t,r,r.segments,l,!0)}processChildren(n,t,r){const l=[];for(const d of Object.keys(r.children))"primary"===d?l.unshift(d):l.push(d);return ot(l).pipe(Gm(d=>{const y=r.children[d],C=function CB(e,n){const t=e.filter(r=>$c(r)===n);return t.push(...e.filter(r=>$c(r)!==n)),t}(t,d);return this.processSegmentGroup(n,C,y,d)}),function Cz(e,n){return pi(function Ez(e,n,t,r,l){return(d,y)=>{let C=t,D=n,O=0;d.subscribe(ln(y,$=>{const W=O++;D=C?e(D,$,W):(C=!0,$),r&&y.next(D)},l&&(()=>{C&&y.next(D),y.complete()})))}}(e,n,arguments.length>=2,!0))}((d,y)=>(d.push(...y),d)),K0(null),function Tz(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Mh((l,d)=>e(l,d,r)):En,Mw(1),t?K0(n):ES(()=>new Y0))}(),vr(d=>{if(null===d)return Jm(r);const y=lI(d);return function s3(e){e.sort((n,t)=>n.value.outlet===hi?-1:t.value.outlet===hi?1:n.value.outlet.localeCompare(t.value.outlet))}(y),fn(y)}))}processSegment(n,t,r,l,d,y){return ot(t).pipe(Gm(C=>this.processSegmentAgainstRoute(C._injector??n,t,C,r,l,d,y).pipe(ga(D=>{if(D instanceof ux)return fn(null);throw D}))),np(C=>!!C),ga(C=>{if(iI(C))return function i3(e,n,t){return 0===n.length&&!e.children[t]}(r,l,d)?fn([]):Jm(r);throw C}))}processSegmentAgainstRoute(n,t,r,l,d,y,C){return function n3(e,n,t,r){return!!($c(e)===r||r!==hi&&hx(n,t,e))&&("**"===e.path||Hw(n,e,t).matched)}(r,l,d,y)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,l,r,d,y,C):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,l,t,r,d,y):Jm(l):Jm(l)}expandSegmentAgainstRouteUsingRedirect(n,t,r,l,d,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,l,d,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,r,l){const d=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?sI(d):this.applyRedirects.lineralizeSegments(r,d).pipe(vr(y=>{const C=new yr(y,{});return this.processSegment(n,t,C,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,l,d,y){const{matched:C,consumedSegments:D,remainingSegments:O,positionalParamSegments:$}=Hw(t,l,d);if(!C)return Jm(t);const W=this.applyRedirects.applyRedirectCommands(D,l.redirectTo,$);return l.redirectTo.startsWith("/")?sI(W):this.applyRedirects.lineralizeSegments(l,W).pipe(vr(oe=>this.processSegment(n,r,t,oe.concat(O),y,!1)))}matchSegmentAgainstRoute(n,t,r,l,d,y){let C;if("**"===r.path){const D=l.length>0?TS(l).parameters:{};C=fn({snapshot:new sx(l,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,cI(r),$c(r),r.component??r._loadedComponent??null,r,uI(r)),consumedSegments:[],remainingSegments:[]}),t.children={}}else C=KB(t,r,l,n).pipe(An(({matched:D,consumedSegments:O,remainingSegments:$,parameters:W})=>D?{snapshot:new sx(O,W,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,cI(r),$c(r),r.component??r._loadedComponent??null,r,uI(r)),consumedSegments:O,remainingSegments:$}:null));return C.pipe(Wi(D=>null===D?Jm(t):this.getChildConfig(n=r._injector??n,r,l).pipe(Wi(({routes:O})=>{const $=r._loadedInjector??n,{snapshot:W,consumedSegments:oe,remainingSegments:be}=D,{segmentGroup:Ye,slicedSegments:nt}=aI(t,oe,be,O);if(0===nt.length&&Ye.hasChildren())return this.processChildren($,O,Ye).pipe(An(Ut=>null===Ut?null:[new Sh(W,Ut)]));if(0===O.length&&0===nt.length)return fn([new Sh(W,[])]);const mt=$c(r)===d;return this.processSegment($,O,Ye,nt,mt?hi:d,!0).pipe(An(Ut=>[new Sh(W,Ut)]))}))))}getChildConfig(n,t,r){return t.children?fn({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?fn({routes:t._loadedRoutes,injector:t._loadedInjector}):function qB(e,n,t,r){const l=n.canLoad;return void 0===l||0===l.length?fn(!0):fn(l.map(y=>{const C=Ym(y,e);return Ld(function RB(e){return e&&vy(e.canLoad)}(C)?C.canLoad(n,t):e.runInContext(()=>C(n,t)))})).pipe(Km(),rI())}(n,t,r).pipe(vr(l=>l?this.configLoader.loadChildren(n,t).pipe(ts(d=>{t._loadedRoutes=d.routes,t._loadedInjector=d.injector})):function XB(e){return Dl(QS(!1,3))}())):fn({routes:[],injector:n})}}function a3(e){const n=e.value.routeConfig;return n&&""===n.path}function lI(e){const n=[],t=new Set;for(const r of e){if(!a3(r)){n.push(r);continue}const l=n.find(d=>r.value.routeConfig===d.value.routeConfig);void 0!==l?(l.children.push(...r.children),t.add(l)):n.push(r)}for(const r of t){const l=lI(r.children);n.push(new Sh(r.value,l))}return n.filter(r=>!t.has(r))}function cI(e){return e.data||{}}function uI(e){return e.resolve||{}}function hI(e){return"string"==typeof e.title||null===e.title}function Gw(e){return Wi(n=>{const t=e(n);return t?ot(t).pipe(An(()=>n)):fn(n)})}const Qm=new Xt("ROUTES");let qw=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=tn(ZD)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return fn(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=Ld(t.loadComponent()).pipe(An(dI),ts(d=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=d}),oy(()=>{this.componentLoaders.delete(t)})),l=new wS(r,()=>new Mn).pipe(Dw());return this.componentLoaders.set(t,l),l}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return fn({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const d=function p3(e,n,t,r){return Ld(e.loadChildren()).pipe(An(dI),vr(l=>l instanceof JT||Array.isArray(l)?fn(l):ot(n.compileModuleAsync(l))),An(l=>{r&&r(e);let d,y,C=!1;return Array.isArray(l)?(y=l,!0):(d=l.create(t).injector,y=d.get(Qm,[],{optional:!0,self:!0}).flat()),{routes:y.map(jw),injector:d}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(oy(()=>{this.childrenLoaders.delete(r)})),y=new wS(d,()=>new Mn).pipe(Dw());return this.childrenLoaders.set(r,y),y}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function dI(e){return function m3(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let dx=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Mn,this.transitionAbortSubject=new Mn,this.configLoader=tn(qw),this.environmentInjector=tn(Qo),this.urlSerializer=tn(ly),this.rootContexts=tn(py),this.inputBindingEnabled=null!==tn(ax,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>fn(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=l=>this.events.next(new aB(l)),this.configLoader.onLoadStartListener=l=>this.events.next(new sB(l))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,l){return this.transitions=new gn({id:0,currentUrlTree:r,currentRawUrl:r,currentBrowserUrl:r,extractedUrl:t.urlHandlingStrategy.extract(r),urlAfterRedirects:t.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:dy,restoredState:null,currentSnapshot:l.snapshot,targetSnapshot:null,currentRouterState:l,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Mh(d=>0!==d.id),An(d=>({...d,extractedUrl:t.urlHandlingStrategy.extract(d.rawUrl)})),Wi(d=>{this.currentTransition=d;let y=!1,C=!1;return fn(d).pipe(ts(D=>{this.currentNavigation={id:D.id,initialUrl:D.rawUrl,extractedUrl:D.extractedUrl,trigger:D.source,extras:D.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Wi(D=>{const O=D.currentBrowserUrl.toString(),$=!t.navigated||D.extractedUrl.toString()!==O||O!==D.currentUrlTree.toString();if(!$&&"reload"!==(D.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const oe="";return this.events.next(new Wm(D.id,this.urlSerializer.serialize(D.rawUrl),oe,0)),D.resolve(null),oo}if(t.urlHandlingStrategy.shouldProcessUrl(D.rawUrl))return fn(D).pipe(Wi(oe=>{const be=this.transitions?.getValue();return this.events.next(new rx(oe.id,this.urlSerializer.serialize(oe.extractedUrl),oe.source,oe.restoredState)),be!==this.transitions?.getValue()?oo:Promise.resolve(oe)}),function l3(e,n,t,r,l,d){return vr(y=>function r3(e,n,t,r,l,d,y="emptyOnly"){return new o3(e,n,t,r,l,y,d).recognize()}(e,n,t,r,y.extractedUrl,l,d).pipe(An(({state:C,tree:D})=>({...y,targetSnapshot:C,urlAfterRedirects:D}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),ts(oe=>{d.targetSnapshot=oe.targetSnapshot,d.urlAfterRedirects=oe.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:oe.urlAfterRedirects};const be=new $S(oe.id,this.urlSerializer.serialize(oe.extractedUrl),this.urlSerializer.serialize(oe.urlAfterRedirects),oe.targetSnapshot);this.events.next(be)}));if($&&t.urlHandlingStrategy.shouldProcessUrl(D.currentRawUrl)){const{id:oe,extractedUrl:be,source:Ye,restoredState:nt,extras:mt}=D,Ut=new rx(oe,this.urlSerializer.serialize(be),Ye,nt);this.events.next(Ut);const dt=ZS(0,this.rootComponentType).snapshot;return this.currentTransition=d={...D,targetSnapshot:dt,urlAfterRedirects:be,extras:{...mt,skipLocationChange:!1,replaceUrl:!1}},fn(d)}{const oe="";return this.events.next(new Wm(D.id,this.urlSerializer.serialize(D.extractedUrl),oe,1)),D.resolve(null),oo}}),ts(D=>{const O=new nB(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(O)}),An(D=>(this.currentTransition=d={...D,guards:MB(D.targetSnapshot,D.currentSnapshot,this.rootContexts)},d)),function zB(e,n){return vr(t=>{const{targetSnapshot:r,currentSnapshot:l,guards:{canActivateChecks:d,canDeactivateChecks:y}}=t;return 0===y.length&&0===d.length?fn({...t,guardsResult:!0}):function BB(e,n,t,r){return ot(e).pipe(vr(l=>function GB(e,n,t,r,l){const d=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return d&&0!==d.length?fn(d.map(C=>{const D=gy(n)??l,O=Ym(C,D);return Ld(function OB(e){return e&&vy(e.canDeactivate)}(O)?O.canDeactivate(e,n,t,r):D.runInContext(()=>O(e,n,t,r))).pipe(np())})).pipe(Km()):fn(!0)}(l.component,l.route,t,n,r)),np(l=>!0!==l,!0))}(y,r,l,e).pipe(vr(C=>C&&function PB(e){return"boolean"==typeof e}(C)?function VB(e,n,t,r){return ot(n).pipe(Gm(l=>Tw(function jB(e,n){return null!==e&&n&&n(new lB(e)),fn(!0)}(l.route.parent,r),function UB(e,n){return null!==e&&n&&n(new uB(e)),fn(!0)}(l.route,r),function HB(e,n,t){const r=n[n.length-1],d=n.slice(0,n.length-1).reverse().map(y=>function SB(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(y)).filter(y=>null!==y).map(y=>bS(()=>fn(y.guards.map(D=>{const O=gy(y.node)??t,$=Ym(D,O);return Ld(function kB(e){return e&&vy(e.canActivateChild)}($)?$.canActivateChild(r,e):O.runInContext(()=>$(r,e))).pipe(np())})).pipe(Km())));return fn(d).pipe(Km())}(e,l.path,t),function $B(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return fn(!0);const l=r.map(d=>bS(()=>{const y=gy(n)??t,C=Ym(d,y);return Ld(function LB(e){return e&&vy(e.canActivate)}(C)?C.canActivate(n,e):y.runInContext(()=>C(n,e))).pipe(np())}));return fn(l).pipe(Km())}(e,l.route,t))),np(l=>!0!==l,!0))}(r,d,e,n):fn(C)),An(C=>({...t,guardsResult:C})))})}(this.environmentInjector,D=>this.events.next(D)),ts(D=>{if(d.guardsResult=D.guardsResult,rp(D.guardsResult))throw JS(0,D.guardsResult);const O=new iB(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot,!!D.guardsResult);this.events.next(O)}),Mh(D=>!!D.guardsResult||(this.cancelNavigationTransition(D,"",3),!1)),Gw(D=>{if(D.guards.canActivateChecks.length)return fn(D).pipe(ts(O=>{const $=new rB(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next($)}),Wi(O=>{let $=!1;return fn(O).pipe(function c3(e,n){return vr(t=>{const{targetSnapshot:r,guards:{canActivateChecks:l}}=t;if(!l.length)return fn(t);let d=0;return ot(l).pipe(Gm(y=>function u3(e,n,t,r){const l=e.routeConfig,d=e._resolve;return void 0!==l?.title&&!hI(l)&&(d[sy]=l.title),function h3(e,n,t,r){const l=function d3(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===l.length)return fn({});const d={};return ot(l).pipe(vr(y=>function f3(e,n,t,r){const l=gy(n)??r,d=Ym(e,l);return Ld(d.resolve?d.resolve(n,t):l.runInContext(()=>d(n,t)))}(e[y],n,t,r).pipe(np(),ts(C=>{d[y]=C}))),Mw(1),function Dz(e){return An(()=>e)}(d),ga(y=>iI(y)?oo:Dl(y)))}(d,e,n,r).pipe(An(y=>(e._resolvedData=y,e.data=WS(e,t).resolve,l&&hI(l)&&(e.data[sy]=l.title),null)))}(y.route,r,e,n)),ts(()=>d++),Mw(1),vr(y=>d===l.length?fn(t):oo))})}(t.paramsInheritanceStrategy,this.environmentInjector),ts({next:()=>$=!0,complete:()=>{$||this.cancelNavigationTransition(O,"",2)}}))}),ts(O=>{const $=new oB(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next($)}))}),Gw(D=>{const O=$=>{const W=[];$.routeConfig?.loadComponent&&!$.routeConfig._loadedComponent&&W.push(this.configLoader.loadComponent($.routeConfig).pipe(ts(oe=>{$.component=oe}),An(()=>{})));for(const oe of $.children)W.push(...O(oe));return W};return Cw(O(D.targetSnapshot.root)).pipe(K0(),Hm(1))}),Gw(()=>this.afterPreactivation()),An(D=>{const O=function gB(e,n,t){const r=my(e,n._root,t?t._root:void 0);return new qS(r,n)}(t.routeReuseStrategy,D.targetSnapshot,D.currentRouterState);return this.currentTransition=d={...D,targetRouterState:O},d}),ts(()=>{this.events.next(new Lw)}),((e,n,t,r)=>An(l=>(new DB(n,l.targetRouterState,l.currentRouterState,t,r).activate(e),l)))(this.rootContexts,t.routeReuseStrategy,D=>this.events.next(D),this.inputBindingEnabled),Hm(1),ts({next:D=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new kd(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects))),t.titleStrategy?.updateTitle(D.targetRouterState.snapshot),D.resolve(!0)},complete:()=>{y=!0}}),function Mz(e){return pi((n,t)=>{Mi(e).subscribe(ln(t,()=>t.complete(),Ft)),!t.closed&&n.subscribe(t)})}(this.transitionAbortSubject.pipe(ts(D=>{throw D}))),oy(()=>{y||C||this.cancelNavigationTransition(d,"",1),this.currentNavigation?.id===d.id&&(this.currentNavigation=null)}),ga(D=>{if(C=!0,eI(D))this.events.next(new fy(d.id,this.urlSerializer.serialize(d.extractedUrl),D.message,D.cancellationCode)),function vB(e){return eI(e)&&rp(e.url)}(D)?this.events.next(new kw(D.url)):d.resolve(!1);else{this.events.next(new ox(d.id,this.urlSerializer.serialize(d.extractedUrl),D,d.targetSnapshot??void 0));try{d.resolve(t.errorHandler(D))}catch(O){d.reject(O)}}return oo}))}))}cancelNavigationTransition(t,r,l){const d=new fy(t.id,this.urlSerializer.serialize(t.extractedUrl),r,l);this.events.next(d),t.resolve(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function fI(e){return e!==dy}let pI=(()=>{class e{buildTitle(t){let r,l=t.root;for(;void 0!==l;)r=this.getResolvedTitleForRoute(l)??r,l=l.children.find(d=>d.outlet===hi);return r}getResolvedTitleForRoute(t){return t.data[sy]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(g3)},providedIn:"root"})}return e})(),g3=(()=>{class e extends pI{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(fS))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(v3)},providedIn:"root"})}return e})();class y3{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let v3=(()=>{class e extends y3{static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const fx=new Xt("",{providedIn:"root",factory:()=>({})});let x3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:function(){return tn(b3)},providedIn:"root"})}return e})(),b3=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var xy=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(xy||{});function mI(e,n){e.events.pipe(Mh(t=>t instanceof kd||t instanceof fy||t instanceof ox||t instanceof Wm),An(t=>t instanceof kd||t instanceof Wm?xy.COMPLETE:t instanceof fy&&(0===t.code||1===t.code)?xy.REDIRECTING:xy.FAILED),Mh(t=>t!==xy.REDIRECTING),Hm(1)).subscribe(()=>{n()})}function w3(e){throw e}function E3(e,n,t){return n.parse("/")}const C3={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},T3={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let _s=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=tn(qD),this.isNgZoneEnabled=!1,this._events=new Mn,this.options=tn(fx,{optional:!0})||{},this.pendingTasks=tn(S0),this.errorHandler=this.options.errorHandler||w3,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||E3,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=tn(x3),this.routeReuseStrategy=tn(_3),this.titleStrategy=tn(pI),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=tn(Qm,{optional:!0})?.flat()??[],this.navigationTransitions=tn(dx),this.urlSerializer=tn(ly),this.location=tn(J1),this.componentInputBindingEnabled=!!tn(ax,{optional:!0}),this.eventsSubscription=new Le,this.isNgZoneEnabled=tn(v)instanceof v&&v.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Zm,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=ZS(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const{currentTransition:l}=this.navigationTransitions;if(null===l)return void(gI(r)&&this._events.next(r));if(r instanceof rx)fI(l.source)&&(this.browserUrlTree=l.extractedUrl);else if(r instanceof Wm)this.rawUrlTree=l.rawUrl;else if(r instanceof $S){if("eager"===this.urlUpdateStrategy){if(!l.extras.skipLocationChange){const d=this.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl);this.setBrowserUrl(d,l)}this.browserUrlTree=l.urlAfterRedirects}}else if(r instanceof Lw)this.currentUrlTree=l.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl),this.routerState=l.targetRouterState,"deferred"===this.urlUpdateStrategy&&(l.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,l),this.browserUrlTree=l.urlAfterRedirects);else if(r instanceof fy)0!==r.code&&1!==r.code&&(this.navigated=!0),(3===r.code||2===r.code)&&this.restoreHistory(l);else if(r instanceof kw){const d=this.urlHandlingStrategy.merge(r.url,l.currentRawUrl),y={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||fI(l.source)};this.scheduleNavigation(d,dy,null,y,{resolve:l.resolve,reject:l.reject,promise:l.promise})}r instanceof ox&&this.restoreHistory(l,!0),r instanceof kd&&(this.navigated=!0),gI(r)&&this._events.next(r)}catch(l){this.navigationTransitions.transitionAbortSubject.next(l)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),dy,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,l){const d={replaceUrl:!0},y=l?.navigationId?l:null;if(l){const D={...l};delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(d.state=D)}const C=this.parseUrl(t);this.scheduleNavigation(C,r,y,d)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(jw),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:l,queryParams:d,fragment:y,queryParamsHandling:C,preserveFragment:D}=r,O=D?this.currentUrlTree.fragment:y;let W,$=null;switch(C){case"merge":$={...this.currentUrlTree.queryParams,...d};break;case"preserve":$=this.currentUrlTree.queryParams;break;default:$=d||null}null!==$&&($=this.removeEmptyProps($));try{W=NS(l?l.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),W=this.currentUrlTree.root}return FS(W,t,$,O??null)}navigateByUrl(t,r={skipLocationChange:!1}){const l=rp(t)?t:this.parseUrl(t),d=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(d,dy,null,r)}navigate(t,r={skipLocationChange:!1}){return function D3(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new Mt(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(l){r=this.malformedUriErrorHandler(l,this.urlSerializer,t)}return r}isActive(t,r){let l;if(l=!0===r?{...C3}:!1===r?{...T3}:r,rp(t))return MS(this.currentUrlTree,t,l);const d=this.parseUrl(t);return MS(this.currentUrlTree,d,l)}removeEmptyProps(t){return Object.keys(t).reduce((r,l)=>{const d=t[l];return null!=d&&(r[l]=d),r},{})}scheduleNavigation(t,r,l,d,y){if(this.disposed)return Promise.resolve(!1);let C,D,O;y?(C=y.resolve,D=y.reject,O=y.promise):O=new Promise((W,oe)=>{C=W,D=oe});const $=this.pendingTasks.add();return mI(this,()=>{queueMicrotask(()=>this.pendingTasks.remove($))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:d,resolve:C,reject:D,promise:O,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),O.catch(W=>Promise.reject(W))}setBrowserUrl(t,r){const l=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(l)||r.extras.replaceUrl){const y={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(l,"",y)}else{const d={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(l,"",d)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-this.browserPageId;0!==d?this.location.historyGo(d):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===d&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function gI(e){return!(e instanceof Lw||e instanceof kw)}let px=(()=>{class e{constructor(t,r,l,d,y,C){this.router=t,this.route=r,this.tabIndexAttribute=l,this.renderer=d,this.el=y,this.locationStrategy=C,this.href=null,this.commands=null,this.onChanges=new Mn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const D=y.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===D||"area"===D,this.isAnchorElement?this.subscription=t.events.subscribe(O=>{O instanceof kd&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,r,l,d,y){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||r||l||d||y||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function jv(e,n,t){return function Ab(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?Lf:pm}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,r){const l=this.renderer,d=this.el.nativeElement;null!==r?l.setAttribute(d,t,r):l.removeAttribute(d,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(_s),Qe(Ih),function su(e){return function Xy(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let l=0;for(;l<r;){const d=t[l];if(Ks(d))break;if(0===d)l+=2;else if("number"==typeof d)for(l++;l<r&&"string"==typeof t[l];)l++;else{if(d===n)return t[l+1];l+=2}}}return null}(Vr(),e)}("tabindex"),Qe(Za),Qe(ha),Qe(tp))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,l){1&r&&mn("click",function(y){return l.onClick(y.button,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey)}),2&r&&wu("target",l.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",jm],skipLocationChange:["skipLocationChange","skipLocationChange",jm],replaceUrl:["replaceUrl","replaceUrl",jm],routerLink:"routerLink"},standalone:!0,features:[pC,Kt]})}return e})(),_I=(()=>{class e{get isActive(){return this._isActive}constructor(t,r,l,d,y){this.router=t,this.element=r,this.renderer=l,this.cdr=d,this.link=y,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new s,this.routerEventsSubscription=t.events.subscribe(C=>{C instanceof kd&&this.update()})}ngAfterContentInit(){fn(this.links.changes,fn(null)).pipe(Ca()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=ot(t).pipe(Ca()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(t){const r=Array.isArray(t)?t:t.split(" ");this.classes=r.filter(l=>!!l)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.classes.forEach(r=>{t?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(t))})}isLinkActive(t){const r=function M3(e){return!!e.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return l=>!!l.urlTree&&t.isActive(l.urlTree,r)}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(_s),Qe(ha),Qe(Za),Qe(Q_),Qe(px,8))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(r,l,d){if(1&r&&function DD(e,n,t,r){const l=ti();if(l.firstCreatePass){const d=Vr();SD(l,new ED(n,t,r),d.index),function fk(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(l,e),2==(2&t)&&(l.staticContentQueries=!0)}MD(l,vt(),t)}(d,px,5),2&r){let y;M1(y=S1())&&(l.links=y)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[Kt]})}return e})();class yI{}let S3=(()=>{class e{constructor(t,r,l,d,y){this.router=t,this.injector=l,this.preloadingStrategy=d,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(Mh(t=>t instanceof kd),Gm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const l=[];for(const d of r){d.providers&&!d._injector&&(d._injector=g1(d.providers,t,`Route: ${d.path}`));const y=d._injector??t,C=d._loadedInjector??y;(d.loadChildren&&!d._loadedRoutes&&void 0===d.canLoad||d.loadComponent&&!d._loadedComponent)&&l.push(this.preloadConfig(y,d)),(d.children||d._loadedRoutes)&&l.push(this.processRoutes(C,d.children??d._loadedRoutes))}return ot(l).pipe(Ca())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let l;l=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):fn(null);const d=l.pipe(vr(y=>null===y?fn(void 0):(r._loadedRoutes=y.routes,r._loadedInjector=y.injector,this.processRoutes(y.injector??t,y.routes))));return r.loadComponent&&!r._loadedComponent?ot([d,this.loader.loadComponent(r)]).pipe(Ca()):d})}static#e=this.\u0275fac=function(r){return new(r||e)(sn(_s),sn(ZD),sn(Qo),sn(yI),sn(qw))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Zw=new Xt("");let vI=(()=>{class e{constructor(t,r,l,d,y={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=l,this.zone=d,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof rx?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof kd?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Wm&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof HS&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new HS(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function Ir(){throw new Error("invalid")}()};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function Ah(e,n){return{\u0275kind:e,\u0275providers:n}}function bI(){const e=tn(Rs);return n=>{const t=e.get(Um);if(n!==t.components[0])return;const r=e.get(_s),l=e.get(wI);1===e.get(Ww)&&r.initialNavigation(),e.get(EI,null,$n.Optional)?.setUpPreloading(),e.get(Zw,null,$n.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),l.closed||(l.next(),l.complete(),l.unsubscribe())}}const wI=new Xt("",{factory:()=>new Mn}),Ww=new Xt("",{providedIn:"root",factory:()=>1}),EI=new Xt("");function R3(e){return Ah(0,[{provide:EI,useExisting:S3},{provide:yI,useExisting:e}])}const CI=new Xt("ROUTER_FORROOT_GUARD"),k3=[J1,{provide:ly,useClass:Sw},_s,py,{provide:Ih,useFactory:function xI(e){return e.routerState.root},deps:[_s]},qw,[]];function O3(){return new eM("Router",_s)}let TI=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[k3,[],{provide:Qm,multi:!0,useValue:t},{provide:CI,useFactory:B3,deps:[[_s,new Vp,new Up]]},{provide:fx,useValue:r||{}},r?.useHash?{provide:tp,useClass:WO}:{provide:tp,useClass:AM},{provide:Zw,useFactory:()=>{const e=tn(hF),n=tn(v),t=tn(fx),r=tn(dx),l=tn(ly);return t.scrollOffset&&e.setOffset(t.scrollOffset),new vI(l,r,e,n,t)}},r?.preloadingStrategy?R3(r.preloadingStrategy).\u0275providers:[],{provide:eM,multi:!0,useFactory:O3},r?.initialNavigation?V3(r):[],r?.bindToComponentInputs?Ah(8,[KS,{provide:ax,useExisting:KS}]).\u0275providers:[],[{provide:DI,useFactory:bI},{provide:j1,multi:!0,useExisting:DI}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Qm,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)(sn(CI,8))};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();function B3(e){return"guarded"}function V3(e){return["disabled"===e.initialNavigation?Ah(3,[{provide:k1,multi:!0,useFactory:()=>{const n=tn(_s);return()=>{n.setUpLocationChangeListener()}}},{provide:Ww,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Ah(2,[{provide:Ww,useValue:0},{provide:k1,multi:!0,deps:[Rs],useFactory:n=>{const t=n.get(qO,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const l=n.get(_s),d=n.get(wI);mI(l,()=>{r(!0)}),n.get(dx).afterPreactivation=()=>(r(!0),d.closed?fn(void 0):d),l.initialNavigation()}))}}]).\u0275providers:[]]}const DI=new Xt(""),Ph_urlApi="https://api-back-service-3uomm4d6da-uc.a.run.app/localizador";class mx{}class gx{}class Mu{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const l=t.slice(0,r),d=l.toLowerCase(),y=t.slice(r+1).trim();this.maybeSetNormalizedName(l,d),this.headers.has(d)?this.headers.get(d).push(y):this.headers.set(d,[y])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof Mu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new Mu;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Mu?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const l=("a"===n.op?this.headers.get(t):void 0)||[];l.push(...r),this.headers.set(t,l);break;case"d":const d=n.value;if(d){let y=this.headers.get(t);if(!y)return;y=y.filter(C=>-1===d.indexOf(C)),0===y.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,y)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(n,t){const r=(Array.isArray(t)?t:[t]).map(d=>d.toString()),l=n.toLowerCase();this.headers.set(l,r),this.maybeSetNormalizedName(n,l)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class j3{encodeKey(n){return MI(n)}encodeValue(n){return MI(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const H3=/%(\d[a-f0-9])/gi,G3={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function MI(e){return encodeURIComponent(e).replace(H3,(n,t)=>G3[t]??n)}function _x(e){return`${e}`}class Od{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new j3,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function $3(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const d=l.indexOf("="),[y,C]=-1==d?[n.decodeKey(l),""]:[n.decodeKey(l.slice(0,d)),n.decodeValue(l.slice(d+1))],D=t.get(y)||[];D.push(C),t.set(y,D)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],l=Array.isArray(r)?r.map(_x):[_x(r)];this.map.set(t,l)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const l=n[r];Array.isArray(l)?l.forEach(d=>{t.push({param:r,value:d,op:"a"})}):t.push({param:r,value:l,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new Od({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(_x(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const l=r.indexOf(_x(n.value));-1!==l&&r.splice(l,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class q3{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function SI(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function II(e){return typeof Blob<"u"&&e instanceof Blob}function AI(e){return typeof FormData<"u"&&e instanceof FormData}class by{constructor(n,t,r,l){let d;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function Z3(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==r?r:null,d=l):d=r,d&&(this.reportProgress=!!d.reportProgress,this.withCredentials=!!d.withCredentials,d.responseType&&(this.responseType=d.responseType),d.headers&&(this.headers=d.headers),d.context&&(this.context=d.context),d.params&&(this.params=d.params)),this.headers||(this.headers=new Mu),this.context||(this.context=new q3),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=t;else{const C=t.indexOf("?");this.urlWithParams=t+(-1===C?"?":C<t.length-1?"&":"")+y}}else this.params=new Od,this.urlWithParams=t}serializeBody(){return null===this.body?null:SI(this.body)||II(this.body)||AI(this.body)||function W3(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Od?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||AI(this.body)?null:II(this.body)?this.body.type||null:SI(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Od?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,l=n.responseType||this.responseType,d=void 0!==n.body?n.body:this.body,y=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,C=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let D=n.headers||this.headers,O=n.params||this.params;const $=n.context??this.context;return void 0!==n.setHeaders&&(D=Object.keys(n.setHeaders).reduce((W,oe)=>W.set(oe,n.setHeaders[oe]),D)),n.setParams&&(O=Object.keys(n.setParams).reduce((W,oe)=>W.set(oe,n.setParams[oe]),O)),new by(t,r,d,{params:O,headers:D,context:$,reportProgress:C,responseType:l,withCredentials:y})}}var eg=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(eg||{});class Xw{constructor(n,t=200,r="OK"){this.headers=n.headers||new Mu,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class Yw extends Xw{constructor(n={}){super(n),this.type=eg.ResponseHeader}clone(n={}){return new Yw({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class tg extends Xw{constructor(n={}){super(n),this.type=eg.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new tg({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class PI extends Xw{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function Kw(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let Nd=(()=>{class e{constructor(t){this.handler=t}request(t,r,l={}){let d;if(t instanceof by)d=t;else{let D,O;D=l.headers instanceof Mu?l.headers:new Mu(l.headers),l.params&&(O=l.params instanceof Od?l.params:new Od({fromObject:l.params})),d=new by(t,r,void 0!==l.body?l.body:null,{headers:D,context:l.context,params:O,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=fn(d).pipe(Gm(D=>this.handler.handle(D)));if(t instanceof by||"events"===l.observe)return y;const C=y.pipe(Mh(D=>D instanceof tg));switch(l.observe||"body"){case"body":switch(d.responseType){case"arraybuffer":return C.pipe(An(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return C.pipe(An(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return C.pipe(An(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return C.pipe(An(D=>D.body))}case"response":return C;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new Od).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,l={}){return this.request("PATCH",t,Kw(l,r))}post(t,r,l={}){return this.request("POST",t,Kw(l,r))}put(t,r,l={}){return this.request("PUT",t,Kw(l,r))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(mx))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function kI(e,n){return n(e)}function Y3(e,n){return(t,r)=>n.intercept(t,{handle:l=>e(l,r)})}const J3=new Xt(""),wy=new Xt(""),OI=new Xt("");function Q3(){let e=null;return(n,t)=>{null===e&&(e=(tn(J3,{optional:!0})??[]).reduceRight(Y3,kI));const r=tn(S0),l=r.add();return e(n,t).pipe(oy(()=>r.remove(l)))}}let NI=(()=>{class e extends mx{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=tn(S0)}handle(t){if(null===this.chain){const l=Array.from(new Set([...this.injector.get(wy),...this.injector.get(OI,[])]));this.chain=l.reduceRight((d,y)=>function K3(e,n,t){return(r,l)=>t.runInContext(()=>n(r,d=>e(d,l)))}(d,y,this.injector),kI)}const r=this.pendingTasks.add();return this.chain(t,l=>this.backend.handle(l)).pipe(oy(()=>this.pendingTasks.remove(r)))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(gx),sn(Qo))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const iV=/^\)\]\}',?\n/;let zI=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Mt(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?ot(r.\u0275loadImpl()):fn(null)).pipe(Wi(()=>new In(d=>{const y=r.build();if(y.open(t.method,t.urlWithParams),t.withCredentials&&(y.withCredentials=!0),t.headers.forEach((nt,mt)=>y.setRequestHeader(nt,mt.join(","))),t.headers.has("Accept")||y.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const nt=t.detectContentTypeHeader();null!==nt&&y.setRequestHeader("Content-Type",nt)}if(t.responseType){const nt=t.responseType.toLowerCase();y.responseType="json"!==nt?nt:"text"}const C=t.serializeBody();let D=null;const O=()=>{if(null!==D)return D;const nt=y.statusText||"OK",mt=new Mu(y.getAllResponseHeaders()),Ut=function rV(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(y)||t.url;return D=new Yw({headers:mt,status:y.status,statusText:nt,url:Ut}),D},$=()=>{let{headers:nt,status:mt,statusText:Ut,url:dt}=O(),hn=null;204!==mt&&(hn=typeof y.response>"u"?y.responseText:y.response),0===mt&&(mt=hn?200:0);let Un=mt>=200&&mt<300;if("json"===t.responseType&&"string"==typeof hn){const wi=hn;hn=hn.replace(iV,"");try{hn=""!==hn?JSON.parse(hn):null}catch(ns){hn=wi,Un&&(Un=!1,hn={error:ns,text:hn})}}Un?(d.next(new tg({body:hn,headers:nt,status:mt,statusText:Ut,url:dt||void 0})),d.complete()):d.error(new PI({error:hn,headers:nt,status:mt,statusText:Ut,url:dt||void 0}))},W=nt=>{const{url:mt}=O(),Ut=new PI({error:nt,status:y.status||0,statusText:y.statusText||"Unknown Error",url:mt||void 0});d.error(Ut)};let oe=!1;const be=nt=>{oe||(d.next(O()),oe=!0);let mt={type:eg.DownloadProgress,loaded:nt.loaded};nt.lengthComputable&&(mt.total=nt.total),"text"===t.responseType&&y.responseText&&(mt.partialText=y.responseText),d.next(mt)},Ye=nt=>{let mt={type:eg.UploadProgress,loaded:nt.loaded};nt.lengthComputable&&(mt.total=nt.total),d.next(mt)};return y.addEventListener("load",$),y.addEventListener("error",W),y.addEventListener("timeout",W),y.addEventListener("abort",W),t.reportProgress&&(y.addEventListener("progress",be),null!==C&&y.upload&&y.upload.addEventListener("progress",Ye)),y.send(C),d.next({type:eg.Sent}),()=>{y.removeEventListener("error",W),y.removeEventListener("abort",W),y.removeEventListener("load",$),y.removeEventListener("timeout",W),t.reportProgress&&(y.removeEventListener("progress",be),null!==C&&y.upload&&y.upload.removeEventListener("progress",Ye)),y.readyState!==y.DONE&&y.abort()}})))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(XM))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const Jw=new Xt("XSRF_ENABLED"),BI=new Xt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),VI=new Xt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class UI{}let aV=(()=>{class e{constructor(t,r,l){this.doc=t,this.platform=r,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=VM(t,this.cookieName),this.lastCookieString=t),this.lastToken}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Cl),sn(fh),sn(BI))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function lV(e,n){const t=e.url.toLowerCase();if(!tn(Jw)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const r=tn(UI).getToken(),l=tn(VI);return null!=r&&!e.headers.has(l)&&(e=e.clone({headers:e.headers.set(l,r)})),n(e)}var Fd=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(Fd||{});function cV(...e){const n=[Nd,zI,NI,{provide:mx,useExisting:NI},{provide:gx,useExisting:zI},{provide:wy,useValue:lV,multi:!0},{provide:Jw,useValue:!0},{provide:UI,useClass:aV}];for(const t of e)n.push(...t.\u0275providers);return function Of(e){return{\u0275providers:e}}(n)}const jI=new Xt("LEGACY_INTERCEPTOR_FN");function uV(){return function op(e,n){return{\u0275kind:e,\u0275providers:n}}(Fd.LegacyInterceptors,[{provide:jI,useFactory:Q3},{provide:wy,useExisting:jI,multi:!0}])}let hV=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({providers:[cV(uV())]})}return e})(),Hc=(()=>{class e{constructor(t){this.http=t,this.userEmail=new gn(""),this.userEmail$=this.userEmail.asObservable(),this.userId=new gn(0),this.userId$=this.userId.asObservable(),this.userName=new gn(""),this.userName$=this.userName.asObservable(),this.userIdentificacion=new gn(""),this.userIdentificacion$=this.userIdentificacion.asObservable(),this.currentUserLoginOn=new gn(!1),this.currentUserData=new gn({id:0,nombres:"",email:"",password:"",rol:0,identificacion:"",tipoIdentificacion:""}),this.API_ENDPOINT_USER=Ph_urlApi+"/usuario"}setUserEmail(t){this.userEmail.next(t)}setUserId(t){this.userId.next(t)}setUserName(t){this.userName.next(t)}setUserIdentificacion(t){this.userIdentificacion.next(t)}login(t,r){return this.http.post(this.API_ENDPOINT_USER+"/login",{email:t,password:r}).pipe(ts(d=>{this.currentUserData.next(d),this.currentUserLoginOn.next(!0)}),An(d=>{if(!d)throw new Error("Credenciales inv\xe1lidas o usuario no encontrado");return d}),ga(this.handleError))}crearUsuario(t,r){return this.http.post(`${this.API_ENDPOINT_USER}/crear`,{usuario:t,perfil:r}).pipe(ga(this.handleCreUsuarioError))}consultaNombreUsuario(t){return this.http.get(`${this.API_ENDPOINT_USER}/nombreusuario/${t}`).pipe(An(r=>r.nombre))}obtenerUsuarioPorEmail(t){return this.http.get(`${this.API_ENDPOINT_USER}/emailUsuario/${t}`)}handleError(t){let r="Error en la conexi\xf3n o la consulta ";return 401===t.status?r="Credenciales inv\xe1lidas":402===t.status?r="Usuario no existe.":500===t.status&&(r="Error al verificar la contrase\xf1a"),Dl(()=>new Error(r))}handleCreUsuarioError(t){let r="Error en la conexi\xf3n para crear el usuario ";return 500===t.status&&(r="Error al crear el usuario con su perfil"),Dl(()=>new Error(r))}get usuarioData(){return this.currentUserData.asObservable()}get usuarioLoginOn(){return this.currentUserLoginOn.asObservable()}initializeUserDetails(){this.setUserEmail(""),this.setUserId(0),this.setUserName(""),this.setUserIdentificacion(""),this.currentUserLoginOn.next(!1),this.currentUserData.next({id:0,nombres:"",email:"",password:"",rol:0,identificacion:"",tipoIdentificacion:""})}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var vx=ve(433);let $I=(()=>{class e{constructor(t){this.http=t,this.API_ENDPOINT_USER=Ph_urlApi+"/usuario"}obtenerUbicacionUsuarioPorEmail(t){return t?this.http.get(`${this.API_ENDPOINT_USER}/ubicacion/${t}`).pipe(ga(this.handleUbicacionError)):Dl(()=>new Error("Email no puede ser nulo o vac\xedo"))}guardaActualizaUbicacion(t){return this.http.post(this.API_ENDPOINT_USER+"/ubicacion",t).pipe(ga(this.handleUbicacionError))}handleUbicacionError(t){return Dl(()=>new Error("Error en ubicaci\xf3n: "+t.message))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Qw=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ph_urlApi+"/perfilestrabajo"}obtenerPerfilesPorProfesion(t){return this.http.get(`${this.API_URL}/${t}`)}obtenerPerfilesProfesion(){return this.http.get(`${this.API_URL}`)}obtenerPerfilesPorIdUsuario(t){return this.http.get(`${this.API_URL}/usuario/${t}`)}guardaActualizaPerfil(t){return this.http.post(this.API_URL+"/usuario/registra_actualiza_perfil",t).pipe(ts(r=>{r.id_perfil&&!t.id_perfil&&(t.id_perfil=r.id_perfil)}),ga(this.handlePerfilError))}handlePerfilError(t){return Dl(()=>new Error("Error en perfil: "+t.message))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),HI=(()=>{class e{constructor(){this.navigateToContrato=new s}triggerNavigation(t,r){this.navigateToContrato.emit({idcontratante:t,idtrabajador:r})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_V=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ph_urlApi+"/profesion"}obtenerAreaYProfesion(){return this.http.get(`${this.API_URL}`)}obtenerAreaProfesionPorId(t){return this.http.get(`${this.API_URL}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),GI=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Za),Qe(ha))};static#t=this.\u0275dir=Rn({type:e})}return e})(),sp=(()=>{class e extends GI{static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Rn({type:e,features:[_r]})}return e})();const Su=new Xt("NgValueAccessor"),xV={provide:Su,useExisting:Ei(()=>Iu),multi:!0},wV=new Xt("CompositionEventMode");let Iu=(()=>{class e extends GI{constructor(t,r,l){super(t,r),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function bV(){const e=Pd()?Pd().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Za),Qe(ha),Qe(wV,8))};static#t=this.\u0275dir=Rn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,l){1&r&&mn("input",function(y){return l._handleInput(y.target.value)})("blur",function(){return l.onTouched()})("compositionstart",function(){return l._compositionStart()})("compositionend",function(y){return l._compositionEnd(y.target.value)})},features:[Gr([xV]),_r]})}return e})();function zd(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function ZI(e){return null!=e&&"number"==typeof e.length}const Os=new Xt("NgValidators"),Bd=new Xt("NgAsyncValidators"),EV=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class eE{static min(n){return function WI(e){return n=>{if(zd(n.value)||zd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function XI(e){return n=>{if(zd(n.value)||zd(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return YI(n)}static requiredTrue(n){return function KI(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function JI(e){return zd(e.value)||EV.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function QI(e){return n=>zd(n.value)||!ZI(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return eA(n)}static pattern(n){return tA(n)}static nullValidator(n){return null}static compose(n){return aA(n)}static composeAsync(n){return lA(n)}}function YI(e){return zd(e.value)?{required:!0}:null}function eA(e){return n=>ZI(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}function tA(e){if(!e)return xx;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),r=>{if(zd(r.value))return null;const l=r.value;return n.test(l)?null:{pattern:{requiredPattern:t,actualValue:l}}}}function xx(e){return null}function nA(e){return null!=e}function iA(e){return V_(e)?ot(e):e}function rA(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function oA(e,n){return n.map(t=>t(e))}function sA(e){return e.map(n=>function CV(e){return!e.validate}(n)?n:t=>n.validate(t))}function aA(e){if(!e)return null;const n=e.filter(nA);return 0==n.length?null:function(t){return rA(oA(t,n))}}function tE(e){return null!=e?aA(sA(e)):null}function lA(e){if(!e)return null;const n=e.filter(nA);return 0==n.length?null:function(t){return function yV(...e){const n=Ta(e),{args:t,keys:r}=_S(e),l=new In(d=>{const{length:y}=t;if(!y)return void d.complete();const C=new Array(y);let D=y,O=y;for(let $=0;$<y;$++){let W=!1;Mi(t[$]).subscribe(ln(d,oe=>{W||(W=!0,O--),C[$]=oe},()=>D--,void 0,()=>{(!D||!W)&&(O||d.next(r?vS(r,C):C),d.complete())}))}});return n?l.pipe(yS(n)):l}(oA(t,n).map(iA)).pipe(An(rA))}}function nE(e){return null!=e?lA(sA(e)):null}function cA(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function uA(e){return e._rawValidators}function hA(e){return e._rawAsyncValidators}function iE(e){return e?Array.isArray(e)?e:[e]:[]}function bx(e,n){return Array.isArray(e)?e.includes(n):e===n}function dA(e,n){const t=iE(n);return iE(e).forEach(l=>{bx(t,l)||t.push(l)}),t}function fA(e,n){return iE(n).filter(t=>!bx(e,t))}class pA{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=tE(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=nE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class _a extends pA{get formDirective(){return null}get path(){return null}}class Vd extends pA{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class mA{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Rh=(()=>{class e extends mA{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Vd,2))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,l){2&r&&y0("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)},features:[_r]})}return e})(),ap=(()=>{class e extends mA{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(_a,10))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,l){2&r&&y0("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)("ng-submitted",l.isSubmitted)},features:[_r]})}return e})();const Ey="VALID",Ex="INVALID",ng="PENDING",Cy="DISABLED";function sE(e){return(Cx(e)?e.validators:e)||null}function aE(e,n){return(Cx(n)?n.asyncValidators:e)||null}function Cx(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function _A(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new Mt(1e3,"");if(!r[t])throw new Mt(1001,"")}function yA(e,n,t){e._forEachChild((r,l)=>{if(void 0===t[l])throw new Mt(1002,"")})}class Tx{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===Ey}get invalid(){return this.status===Ex}get pending(){return this.status==ng}get disabled(){return this.status===Cy}get enabled(){return this.status!==Cy}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(dA(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(dA(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(fA(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(fA(n,this._rawAsyncValidators))}hasValidator(n){return bx(this._rawValidators,n)}hasAsyncValidator(n){return bx(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=ng,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Cy,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Ey,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ey||this.status===ng)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Cy:Ey}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=ng,this._hasOwnPendingAsyncValidator=!0;const t=iA(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,l)=>r&&r._find(l),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new s,this.statusChanges=new s}_calculateStatus(){return this._allControlsDisabled()?Cy:this.errors?Ex:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ng)?ng:this._anyControlsHaveStatus(Ex)?Ex:Ey}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Cx(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function SV(e){return Array.isArray(e)?tE(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function IV(e){return Array.isArray(e)?nE(e):e||null}(this._rawAsyncValidators)}}class Ty extends Tx{constructor(n,t,r){super(sE(t),aE(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){yA(this,0,n),Object.keys(n).forEach(r=>{_A(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const l=this.controls[r];l&&l.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,l)=>{r.reset(n?n[l]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,l)=>((r.enabled||this.disabled)&&(t[l]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((l,d)=>{r=t(r,l,d)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class vA extends Ty{}const lp=new Xt("CallSetDisabledState",{providedIn:"root",factory:()=>Dy}),Dy="always";function Dx(e,n){return[...n.path,e]}function My(e,n,t=Dy){lE(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function PV(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&xA(e,n)})}(e,n),function LV(e,n){const t=(r,l)=>{n.valueAccessor.writeValue(r),l&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function RV(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&xA(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function AV(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function Mx(e,n,t=!0){const r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),Ix(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function Sx(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function lE(e,n){const t=uA(e);null!==n.validator?e.setValidators(cA(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=hA(e);null!==n.asyncValidator?e.setAsyncValidators(cA(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const l=()=>e.updateValueAndValidity();Sx(n._rawValidators,l),Sx(n._rawAsyncValidators,l)}function Ix(e,n){let t=!1;if(null!==e){if(null!==n.validator){const l=uA(e);if(Array.isArray(l)&&l.length>0){const d=l.filter(y=>y!==n.validator);d.length!==l.length&&(t=!0,e.setValidators(d))}}if(null!==n.asyncValidator){const l=hA(e);if(Array.isArray(l)&&l.length>0){const d=l.filter(y=>y!==n.asyncValidator);d.length!==l.length&&(t=!0,e.setAsyncValidators(d))}}}const r=()=>{};return Sx(n._rawValidators,r),Sx(n._rawAsyncValidators,r),t}function xA(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function bA(e,n){lE(e,n)}function uE(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}function wA(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function hE(e,n){if(!n)return null;let t,r,l;return Array.isArray(n),n.forEach(d=>{d.constructor===Iu?t=d:function NV(e){return Object.getPrototypeOf(e.constructor)===sp}(d)?r=d:l=d}),l||r||t||null}const zV={provide:_a,useExisting:Ei(()=>Ud)},Sy=(()=>Promise.resolve())();let Ud=(()=>{class e extends _a{constructor(t,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._directives=new Set,this.ngSubmit=new s,this.form=new Ty({},tE(t),nE(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Sy.then(()=>{const r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),My(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Sy.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Sy.then(()=>{const r=this._findContainer(t.path),l=new Ty({});bA(l,t),r.registerControl(t.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Sy.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){Sy.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,wA(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Os,10),Qe(Bd,10),Qe(lp,8))};static#t=this.\u0275dir=Rn({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,l){1&r&&mn("submit",function(y){return l.onSubmit(y)})("reset",function(){return l.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gr([zV]),_r]})}return e})();function EA(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function CA(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const Iy=class extends Tx{constructor(n=null,t,r){super(sE(t),aE(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Cx(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=CA(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){EA(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){EA(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){CA(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},UV={provide:Vd,useExisting:Ei(()=>Lh)},MA=(()=>Promise.resolve())();let Lh=(()=>{class e extends Vd{constructor(t,r,l,d,y,C){super(),this._changeDetectorRef=y,this.callSetDisabledState=C,this.control=new Iy,this._registered=!1,this.name="",this.update=new s,this._parent=t,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=hE(0,d)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),uE(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){My(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){MA.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const r=t.isDisabled.currentValue,l=0!==r&&jm(r);MA.then(()=>{l&&!this.control.disabled?this.control.disable():!l&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Dx(t,this._parent):[t]}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(_a,9),Qe(Os,10),Qe(Bd,10),Qe(Su,10),Qe(Q_,8),Qe(lp,8))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Gr([UV]),_r,Kt]})}return e})(),cp=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Rn({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})(),IA=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({})}return e})();const dE=new Xt("NgModelWithFormControlWarning"),ZV={provide:_a,useExisting:Ei(()=>Ax)};let Ax=(()=>{class e extends _a{constructor(t,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new s,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ix(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return My(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){Mx(t.control||null,t,!1),function FV(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,wA(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,l=this.form.get(t.path);r!==l&&(Mx(r||null,t),(e=>e instanceof Iy)(l)&&(My(l,t,this.callSetDisabledState),t.control=l))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);bA(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function kV(e,n){return Ix(e,n)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){lE(this.form,this),this._oldForm&&Ix(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Os,10),Qe(Bd,10),Qe(lp,8))};static#t=this.\u0275dir=Rn({type:e,selectors:[["","formGroup",""]],hostBindings:function(r,l){1&r&&mn("submit",function(y){return l.onSubmit(y)})("reset",function(){return l.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gr([ZV]),_r,Kt]})}return e})();const YV={provide:Vd,useExisting:Ei(()=>mE)};let mE=(()=>{class e extends Vd{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,r,l,d,y){super(),this._ngModelWarningConfig=y,this._added=!1,this.name=null,this.update=new s,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=hE(0,d)}ngOnChanges(t){this._added||this._setUpControl(),uE(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Dx(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(r){return new(r||e)(Qe(_a,13),Qe(Os,10),Qe(Bd,10),Qe(Su,10),Qe(dE,8))};static#n=this.\u0275dir=Rn({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Gr([YV]),_r,Kt]})}return e})();const KV={provide:Su,useExisting:Ei(()=>kh),multi:!0};function kA(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let kh=(()=>{class e extends sp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const l=kA(this._getOptionId(t),t);this.setProperty("value",l)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function JV(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Rn({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,l){1&r&&mn("change",function(y){return l.onChange(y.target.value)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[Gr([KV]),_r]})}return e})(),up=(()=>{class e{constructor(t,r,l){this._element=t,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(kA(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(ha),Qe(Za),Qe(kh,9))};static#t=this.\u0275dir=Rn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();const QV={provide:Su,useExisting:Ei(()=>gE),multi:!0};function OA(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let gE=(()=>{class e extends sp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const l=t.map(d=>this._getOptionId(d));r=(d,y)=>{d._setSelected(l.indexOf(y.toString())>-1)}}else r=(l,d)=>{l._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const l=[],d=r.selectedOptions;if(void 0!==d){const y=d;for(let C=0;C<y.length;C++){const O=this._getOptionValue(y[C].value);l.push(O)}}else{const y=r.options;for(let C=0;C<y.length;C++){const D=y[C];if(D.selected){const O=this._getOptionValue(D.value);l.push(O)}}}this.value=l,t(l)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function eU(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Rn({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,l){1&r&&mn("change",function(y){return l.onChange(y.target)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[Gr([QV]),_r]})}return e})(),hp=(()=>{class e{constructor(t,r,l){this._element=t,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(OA(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(OA(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(ha),Qe(Za),Qe(gE,9))};static#t=this.\u0275dir=Rn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();let dp=(()=>{class e{constructor(){this._validator=xx}ngOnChanges(t){if(this.inputName in t){const r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):xx,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return null!=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Rn({type:e,features:[Kt]})}return e})();const iU={provide:Os,useExisting:Ei(()=>Oh),multi:!0};let Oh=(()=>{class e extends dp{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=jm,this.createValidator=t=>YI}enabled(t){return t}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Rn({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,l){2&r&&wu("required",l._enabled?"":null)},inputs:{required:"required"},features:[Gr([iU]),_r]})}return e})();const aU={provide:Os,useExisting:Ei(()=>_E),multi:!0};let _E=(()=>{class e extends dp{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=t=>function NA(e){return"number"==typeof e?e:parseInt(e,10)}(t),this.createValidator=t=>eA(t)}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Rn({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(r,l){2&r&&wu("maxlength",l._enabled?l.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Gr([aU]),_r]})}return e})();const lU={provide:Os,useExisting:Ei(()=>yE),multi:!0};let yE=(()=>{class e extends dp{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=t=>t,this.createValidator=t=>tA(t)}static#e=this.\u0275fac=function(){let t;return function(l){return(t||(t=xo(e)))(l||e)}}();static#t=this.\u0275dir=Rn({type:e,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(r,l){2&r&&wu("pattern",l._enabled?l.pattern:null)},inputs:{pattern:"pattern"},features:[Gr([lU]),_r]})}return e})(),$A=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[IA]})}return e})();class HA extends Tx{constructor(n,t,r){super(sE(t),aE(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,r={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,t={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,r={}){let l=this._adjustIndex(n);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),t&&(this.controls.splice(l,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){yA(this,0,n),n.forEach((r,l)=>{_A(this,!1,l),this.at(l).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((r,l)=>{this.at(l)&&this.at(l).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((r,l)=>{r.reset(n[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,r)=>{n(t,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function GA(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let cU=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,r=null){const l=this._reduceControls(t);let d={};return GA(r)?d=r:null!==r&&(d.validators=r.validator,d.asyncValidators=r.asyncValidator),new Ty(l,d)}record(t,r=null){const l=this._reduceControls(t);return new vA(l,r)}control(t,r,l){let d={};return this.useNonNullable?(GA(r)?d=r:(d.validators=r,d.asyncValidators=l),new Iy(t,{...d,nonNullable:!0})):new Iy(t,r,l)}array(t,r,l){const d=t.map(y=>this._createControl(y));return new HA(d,r,l)}_reduceControls(t){const r={};return Object.keys(t).forEach(l=>{r[l]=this._createControl(t[l])}),r}_createControl(t){return t instanceof Iy||t instanceof Tx?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),uU=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:lp,useValue:t.callSetDisabledState??Dy}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[$A]})}return e})(),hU=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:dE,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:lp,useValue:t.callSetDisabledState??Dy}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[$A]})}return e})();function dU(e,n){1&e&&(pe(0,"div",7),Fe(1," NO TIENE UBICACI\xd3N REGISTRADA, FAVOR INGRESAR SUS DATOS DE UBICACI\xd3N. "),me())}function fU(e,n){if(1&e&&(pe(0,"div",7),Fe(1),me()),2&e){const t=Yn();$e(1),es(" ",t.mensaje," ")}}function pU(e,n){if(1&e&&(pe(0,"option",8),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id_area),$e(1),es(" ",t.nombre_area_profesion," ")}}let mU=(()=>{class e{constructor(t,r,l,d,y,C,D){this.ubicacionService=t,this.perfiltrabajoService=r,this.router=l,this.navegacionService=d,this.zone=y,this.usuarioServicio=C,this.areaProfesionService=D,this.latUser=0,this.lonUser=0,this.profesionBuscada="",this.mimapa=null,this.marcadores=[],this.userId=0,this.profesiones=[],this.areaProfesionPersona="",this.noTieneUbicacion=!1,this.mensaje=""}ngOnInit(){this.areaProfesionSubscrition=this.areaProfesionService.obtenerAreaYProfesion().subscribe({next:t=>{this.profesiones=t},error:t=>{console.error("Error al obtener profesiones",t)}})}cargarUbicacionUsuarioLogin(t){this.ubicacionSubscription=this.ubicacionService.obtenerUbicacionUsuarioPorEmail(t).subscribe({next:r=>{r?(this.latUser=r.latitud,this.lonUser=r.longitud,this.inicializarMapaUsuarioLogin()):this.noTieneUbicacion=!0},error:r=>{console.log("UBICACION ::: algo paso :( ",r)}})}inicializarMapaUsuarioLogin(){this.mimapa||(this.mimapa=new vx.Map("mapUOC").setView([this.latUser,this.lonUser],10),(0,vx.tileLayer)("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:30,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(this.mimapa),(0,vx.marker)([this.latUser,this.lonUser]).addTo(this.mimapa).bindPopup(`${this.usuarioServicio.userName$}`))}ngAfterViewInit(){this.mapaSubscription=this.usuarioServicio.userEmail$.subscribe(t=>{this.usuarioServicio.usuarioLoginOn&&this.cargarUbicacionUsuarioLogin(t)}),this.usuarioServicio.userId$.subscribe(t=>{this.usuarioServicio.usuarioLoginOn&&(this.userId=t)})}buscarProfesion(){this.mensaje="",this.profesionBuscada&&(this.marcadores.forEach(t=>{this.mimapa?.removeLayer(t)}),this.marcadores=[],this.perfiltrabajoSubscription=this.perfiltrabajoService.obtenerPerfilesPorProfesion(this.profesionBuscada).subscribe({next:t=>{0===t.length?(this.mensaje="No se encontraron personas disponibles para esa area",console.log("No se encontraron personas disponibles para esa area")):t.forEach(r=>{const l=Number(r.latitud),d=Number(r.longitud);if(!isNaN(l)&&!isNaN(d)&&this.mimapa){const y=`<div>\n               <p>${r.nombres} :: Profesi\xf3n: ${r.introduccion}</p>\n               <div class="d-flex justify-content-center"><button class="btn btn-primary me-3" id="contratar${r.id}">Contratar</button>\n               <button class="btn btn-primary" id="perfil${r.id}">Perfil</button> </div>               \n               </div>`,C=(0,vx.marker)([l,d]).addTo(this.mimapa).bindPopup(y);C.on("popupopen",()=>{const D=document.getElementById(`contratar${r.id}`);D&&D.addEventListener("click",()=>{this.navegarAContrato(this.userId,r.id)});const O=document.getElementById(`perfil${r.id}`);O&&O.addEventListener("click",()=>{this.navegarAVerPerfilTrabajador(r.id)})}),this.marcadores.push(C)}})},error:t=>{console.error(t)}}))}onProfesionChange(){this.buscarProfesion()}navegarAContrato(t,r){this.router.navigate(["/crear-contrato",t,r])}navegarAVerPerfilTrabajador(t){this.router.navigate(["/ver-perfil",t])}ngOnDestroy(){console.log("destroy de mapa subscribe"),this.ubicacionSubscription&&this.ubicacionSubscription.unsubscribe(),this.mapaSubscription&&this.mapaSubscription.unsubscribe(),this.perfiltrabajoSubscription&&this.perfiltrabajoSubscription.unsubscribe(),this.areaProfesionSubscrition&&this.areaProfesionSubscrition.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(Qe($I),Qe(Qw),Qe(_s),Qe(HI),Qe(v),Qe(Hc),Qe(_V))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-mapa"]],decls:11,vars:4,consts:[[1,"custom-container","my-5"],[1,"mb-3"],["for","profesional",1,"form-label"],["class","alert alert-danger","style","text-align: center; font-weight: bold;",4,"ngIf"],["name","profesional",1,"form-select",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["id","mapUOC",1,"map-container"],[1,"alert","alert-danger",2,"text-align","center","font-weight","bold"],[3,"value"]],template:function(r,l){1&r&&(pe(0,"div",0)(1,"div",1)(2,"label",2),Fe(3,"Buscar Profesional"),me(),pe(4,"div"),Qn(5,dU,2,0,"div",3),me(),pe(6,"div"),Qn(7,fU,2,1,"div",3),me(),pe(8,"select",4),mn("ngModelChange",function(y){return l.profesionBuscada=y})("change",function(){return l.buscarProfesion()}),Qn(9,pU,2,2,"option",5),me()(),wo(10,"div",6),me()),2&r&&($e(5),At("ngIf",l.noTieneUbicacion),$e(2),At("ngIf",l.mensaje),$e(1),At("ngModel",l.profesionBuscada),$e(1),At("ngForOf",l.profesiones))},dependencies:[Dh,Uc,up,hp,kh,Rh,Lh],styles:["#mapUOC[_ngcontent-%COMP%]{height:590px}.custom-container[_ngcontent-%COMP%]{max-width:60%;margin-right:auto;margin-left:auto}.map-container[_ngcontent-%COMP%]{width:100%;height:400px}@media (max-width: 768px){.custom-container[_ngcontent-%COMP%]{max-width:100%}}"]})}return e})();function gU(e,n){1&e&&(pe(0,"p"),Fe(1,"Usuario No autenticado"),me())}function _U(e,n){if(1&e&&(pe(0,"p"),Fe(1),me()),2&e){const t=Yn();$e(1),es("Usuario ",null==t.userDatos?null:t.userDatos.nombres," Autenticado")}}function yU(e,n){1&e&&wo(0,"img",2)}function vU(e,n){1&e&&wo(0,"app-mapa")}let qA=(()=>{class e{constructor(t,r){this.usuarioServer=t,this.route=r,this.userLoginOn=!1}ngOnInit(){this.route.params.subscribe(t=>{"outsesion"===t.outsesion?(this.usuarioServer.initializeUserDetails(),this.userLoginOn=!1,this.userDatos={id:0,nombres:"",email:"",password:"",rol:0,estado:"",identificacion:"",tipoIdentificacion:""},this.subscription1?.unsubscribe(),this.subscription2?.unsubscribe()):this.subscribeToUserData()})}subscribeToUserData(){this.subscription1=this.usuarioServer.currentUserLoginOn.subscribe({next:t=>{this.userLoginOn=t}}),this.subscription2=this.usuarioServer.currentUserData.subscribe({next:t=>{this.userDatos=t}})}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Hc),Qe(Ih))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-dashboard"]],decls:4,vars:4,consts:[[4,"ngIf"],["src","assets/images/Youtube-Finance.png","alt","Portada","class","img-portada",4,"ngIf"],["src","assets/images/Youtube-Finance.png","alt","Portada",1,"img-portada"]],template:function(r,l){1&r&&(Qn(0,gU,2,0,"p",0),Qn(1,_U,2,1,"p",0),Qn(2,yU,1,0,"img",1),Qn(3,vU,1,0,"app-mapa",0)),2&r&&(At("ngIf",!l.userLoginOn),$e(1),At("ngIf",l.userLoginOn),$e(1),At("ngIf",!l.userLoginOn),$e(1),At("ngIf",l.userLoginOn))},dependencies:[Uc,mU],styles:[".img-portada[_ngcontent-%COMP%]{width:100%;height:auto;display:block;margin:0 auto}"]})}return e})();function xU(e,n){1&e&&(pe(0,"div"),Fe(1," Email es requerido. "),me())}function bU(e,n){1&e&&(pe(0,"div"),Fe(1," Email tiene formato invalido. "),me())}function wU(e,n){if(1&e&&(pe(0,"div",14),Qn(1,xU,2,0,"div",15),Qn(2,bU,2,0,"div",15),me()),2&e){const t=Yn();$e(1),At("ngIf",null==t.user.errors?null:t.user.errors.required),$e(1),At("ngIf",null==t.user.errors?null:t.user.errors.email)}}function EU(e,n){1&e&&(pe(0,"div"),Fe(1," Pasword es requerido. "),me())}function CU(e,n){if(1&e&&(pe(0,"div",14),Qn(1,EU,2,0,"div",15),me()),2&e){const t=Yn();$e(1),At("ngIf",null==t.pasword.errors?null:t.pasword.errors.required)}}let TU=(()=>{class e{constructor(t,r,l){this.formBuilder=t,this.router=r,this.usuarioService=l,this.loginError="",this.loginForm=this.formBuilder.group({email:["",[eE.required,eE.email]],password:["",eE.required]})}ngOnInit(){}get user(){return this.loginForm.controls.email}get pasword(){return this.loginForm.controls.password}login(){if(this.loginForm.valid){const t=this.loginForm.get("email")?.value||"",r=this.loginForm.get("password")?.value||"";this.loginSubscription=this.usuarioService.login(t,r).subscribe({next:l=>{this.usuarioService.setUserEmail(t),this.usuarioService.setUserId(l.id),this.usuarioService.setUserName(l.nombres),this.usuarioService.setUserIdentificacion(l.identificacion)},error:l=>{this.loginError=l},complete:()=>{this.router.navigateByUrl("/inicio"),this.loginForm.reset()}})}else this.loginForm.markAllAsTouched()}ngOnDestroy(){this.loginSubscription&&this.loginSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(cU),Qe(_s),Qe(Hc))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-login"]],decls:22,vars:4,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[3,"formGroup"],[1,"text-danger"],[1,"mb-3"],["for","inputEmail1",1,"form-label"],["formControlName","email","type","email","id","inputEmail1","aria-describedby","emailHelp",1,"form-control"],["id","emailHelp",1,"form-text"],["class","alert alert-danger",4,"ngIf"],["for","inputPassword1",1,"form-label"],["formControlName","password","type","password","id","inputPassword1",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"alert","alert-danger"],[4,"ngIf"]],template:function(r,l){1&r&&(pe(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Fe(4,"Inicie Sesi\xf3n"),me(),pe(5,"form",4)(6,"p",5),Fe(7),me(),pe(8,"div",6)(9,"label",7),Fe(10,"Email"),me(),wo(11,"input",8),pe(12,"div",9),Fe(13,"Nunca compartiremos sus datos personales con nadie m\xe1s.."),me(),Qn(14,wU,3,2,"div",10),me(),pe(15,"div",6)(16,"label",11),Fe(17,"Contrase\xf1a"),me(),wo(18,"input",12),Qn(19,CU,2,1,"div",10),me(),pe(20,"button",13),mn("click",function(){return l.login()}),Fe(21,"Iniciar Sesi\xf3n"),me()()()()()),2&r&&($e(5),At("formGroup",l.loginForm),$e(2),oi(l.loginError),$e(7),At("ngIf",l.user.invalid&&(l.user.dirty||l.user.touched)),$e(5),At("ngIf",l.pasword.invalid&&(l.pasword.dirty||l.pasword.touched)))},dependencies:[Uc,cp,Iu,Rh,ap,Ax,mE],styles:["form[_ngcontent-%COMP%]{margin:20px}"]})}return e})(),vE=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ph_urlApi}crearContrato(t){return this.http.post(`${this.API_URL}/contrato/crear`,t)}consultaContratoUsuario(t){return this.http.get(`${this.API_URL}/contrato/usuario/${t}`).pipe(ga(r=>404===r.status?fn(null):Dl(()=>new Error("Error al consultar contrato: "+r.message))))}consultaContratoUsuarioRelacionado(t){return this.http.get(`${this.API_URL}/contrato/relacionado/${t}`)}consultaContratoGeneralRelacionado(t){return this.http.get(`${this.API_URL}/contrato/general/${t}`)}editarContrato(t){return this.http.put(`${this.API_URL}/contrato/editar`,t).pipe(ga(r=>Dl(()=>new Error("Error al actualizar contrato: "+r.message))))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),ig=(()=>{class e{constructor(){this.tiposIdentificacion=[{id:"CEDULA",nombre:"C\xe9dula"},{id:"PASAPORTE",nombre:"Pasaporte"},{id:"OTRO",nombre:"Otro"}],this.tiposRol=[{id:"1",nombre:"Contratista"},{id:"2",nombre:"Trabajador"}],this.areaprofesione=[{id:1,nombre:"TECNOLOGIA"},{id:2,nombre:"ABOGACIA"},{id:3,nombre:"ELECTRONICO"},{id:4,nombre:"CONSTRUCCION"},{id:5,nombre:"DISE\xd1O DIGITAL"},{id:6,nombre:"ALBA\xd1IL"},{id:7,nombre:"PLOMERO"},{id:8,nombre:"CLASES MATEMATICAS"},{id:9,nombre:"ELECTRICO"},{id:10,nombre:"CONTRATISTA"},{id:11,nombre:"REDES DE COMNICACION"},{id:12,nombre:"BASE DE DATOS"}],this.tiposContrato=[{id:1,nombre:"Por Dia"},{id:2,nombre:"Por Hora"},{id:3,nombre:"M\xe1s de 5 Dias"}],this.estadosContrato=[{id:"CONTRATADO",nombre:"CONTRATADO"},{id:"TERMINADO",nombre:"TERMINADO"},{id:"CANCELADO",nombre:"CANCELADO"}],this.nivelCalificacion=[{id:1,nombre:"1- NO RECOMIEDO"},{id:2,nombre:"2- MALO"},{id:3,nombre:"3- MALO"},{id:4,nombre:"4- NO SE"},{id:5,nombre:"5- BUENO"},{id:6,nombre:"6- BUENO"},{id:7,nombre:"7- MUY BUENO"},{id:8,nombre:"8- MUY BUENO"},{id:9,nombre:"9- EXCELENTE"},{id:10,nombre:"10-EXCELENTE"}]}getTiposIdentificacion(){return this.tiposIdentificacion}getTiposRol(){return this.tiposRol}getAreProfesiones(){return this.areaprofesione}getTiposContrato(){return this.tiposContrato}getEstadosContrato(){return this.estadosContrato}getNivelCalificacion(){return this.nivelCalificacion}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),ZA=(()=>{class e{constructor(t){this.http=t,this.API_URL=Ph_urlApi}crearCalificacionContrato(t){return this.http.post(`${this.API_URL}/calificacion/crear`,t)}consultaCalificacionesContratante(t){return this.http.get(`${this.API_URL}/calificacion/${t}`).pipe(An(r=>r.map(l=>({id_calificacion:l.ID_CALIFICACION,nivel_calificacion:l.NIVEL_CALIFICACION,comentario:l.COMENTARIO,id_usuario_trabajador:l.ID_USUARIO_TRABAJADOR,id_contrato:l.ID_CONTRATO}))))}consultaCalificacionesGeneral(){return this.http.get(`${this.API_URL}/calificacion/todos`).pipe(An(t=>t.map(r=>({id_calificacion:r.ID_CALIFICACION,nivel_calificacion:r.NIVEL_CALIFICACION,comentario:r.COMENTARIO,id_usuario_trabajador:r.ID_USUARIO_TRABAJADOR,id_contrato:r.ID_CONTRATO}))))}editarCalificacion(t){return this.http.put(`${this.API_URL}/calificacion/editar`,t).pipe(ga(r=>Dl(()=>new Error("Error al actualizar calificacionContrato: "+r.message))))}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function DU(e,n){if(1&e&&(pe(0,"option",20),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}const MU=function(e,n){return{"alert-success":e,"alert-danger":n}};function SU(e,n){if(1&e&&(pe(0,"div",21),Fe(1),me()),2&e){const t=Yn();At("ngClass",function lD(e,n,t,r,l){return uD(vt(),ds(),e,n,t,r,l)}(2,MU,t.mensaje.includes("exito"),t.mensaje.includes("Error"))),$e(1),es(" ",t.mensaje," ")}}let IU=(()=>{class e{constructor(t,r,l,d,y,C){this.navegacionService=t,this.router=r,this.route=l,this.contratoService=d,this.selectores=y,this.calificacionContratoService=C,this.contrato={id_usuario_contratante:0,id_usuario_trabajador:0,tipo_contrato:0,fecha_inicio:"",fecha_fin:"",descripcion:"",comentario:""},this.mensajeClass="",this.deshabilitaContratar=!1}guardarContrato(){this.mensaje="",this.contratoSubscription=this.contratoService.crearContrato(this.contrato).subscribe({next:t=>{this.mensaje="Contrato creado con exito:",this.deshabilitaContratar=!0,this.calificacionContratoService.crearCalificacionContrato({nivel_calificacion:0,comentario:"",id_usuario_trabajador:this.contrato.id_usuario_trabajador,id_contrato:t.id_contrato}).subscribe({next:l=>{console.log("Registro de Calificaion correcta ")},error:l=>{this.mensaje="Registro de Calificacion Presenta inconvenientes: "}})},error:t=>{this.mensaje="Registro de Contrato Presenta inconvenientes: "}})}cancelarRegistro(){this.route.navigate(["/inicio"])}ngOnInit(){this.mensaje="",this.deshabilitaContratar=!1,this.tipoContrato=this.selectores.getTiposContrato(),this.router.params.subscribe(t=>{this.contrato.id_usuario_contratante=+t.idcontratante,this.contrato.id_usuario_trabajador=+t.idtrabajador,this.contrato.estado="CONTRATADO"}),this.contratoService.consultaContratoUsuario(this.contrato.id_usuario_trabajador).subscribe({next:t=>{t&&(this.mensaje="Error: El usuario tiene contrato vigente",this.deshabilitaContratar=!0)},error:t=>{console.log("Entro por error",t)}})}ngOnDestroy(){this.contratoSubscription&&this.contratoSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(HI),Qe(Ih),Qe(_s),Qe(vE),Qe(ig),Qe(ZA))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-contrato"]],decls:31,vars:9,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[1,"card","p-4",3,"ngSubmit"],["type","hidden","name","id_usuario_contratante",3,"ngModel","ngModelChange"],["type","hidden","name","id_usuario_trabajador",3,"ngModel","ngModelChange"],[1,"form-group","mb-3"],["for","tipo_contrato"],["name","tipo_contrato","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","fecha_inicio"],["type","date","name","fecha_inicio",1,"form-control",3,"ngModel","ngModelChange"],["for","fecha_fin"],["type","date","name","fecha_fin",1,"form-control",3,"ngModel","ngModelChange"],["for","descripcion"],["name","descripcion","placeholder","Descripci\xf3n",1,"form-control",3,"ngModel","ngModelChange"],["class","alert",3,"ngClass",4,"ngIf"],["type","submit",1,"btn","btn-primary","mb-3",3,"disabled"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],[3,"value"],[1,"alert",3,"ngClass"]],template:function(r,l){1&r&&(pe(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Fe(4,"Registro de Contrato"),me(),pe(5,"form",4),mn("ngSubmit",function(){return l.guardarContrato()}),pe(6,"input",5),mn("ngModelChange",function(y){return l.contrato.id_usuario_contratante=y}),me(),pe(7,"input",6),mn("ngModelChange",function(y){return l.contrato.id_usuario_trabajador=y}),me(),pe(8,"div",7)(9,"label",8),Fe(10,"Tipo de Contrato"),me(),pe(11,"select",9),mn("ngModelChange",function(y){return l.contrato.tipo_contrato=y}),Qn(12,DU,2,2,"option",10),me()(),pe(13,"div",7)(14,"label",11),Fe(15,"Fecha de Inicio"),me(),pe(16,"input",12),mn("ngModelChange",function(y){return l.contrato.fecha_inicio=y}),me()(),pe(17,"div",7)(18,"label",13),Fe(19,"Fecha de Fin"),me(),pe(20,"input",14),mn("ngModelChange",function(y){return l.contrato.fecha_fin=y}),me()(),pe(21,"div",7)(22,"label",15),Fe(23,"Descripci\xf3n"),me(),pe(24,"textarea",16),mn("ngModelChange",function(y){return l.contrato.descripcion=y}),me()(),pe(25,"div",7),Qn(26,SU,2,5,"div",17),me(),pe(27,"button",18),Fe(28,"Genera Contrato"),me(),pe(29,"button",19),mn("click",function(){return l.cancelarRegistro()}),Fe(30,"Cancelar"),me()()()()()),2&r&&($e(6),At("ngModel",l.contrato.id_usuario_contratante),$e(1),At("ngModel",l.contrato.id_usuario_trabajador),$e(4),At("ngModel",l.contrato.tipo_contrato),$e(1),At("ngForOf",l.tipoContrato),$e(4),At("ngModel",l.contrato.fecha_inicio),$e(4),At("ngModel",l.contrato.fecha_fin),$e(4),At("ngModel",l.contrato.descripcion),$e(2),At("ngIf",l.mensaje),$e(1),At("disabled",l.deshabilitaContratar))},dependencies:[q0,Dh,Uc,cp,up,hp,Iu,kh,Rh,ap,Oh,Lh,Ud]})}return e})();function WA(e,n,t,r,l,d,y){try{var C=e[d](y),D=C.value}catch(O){return void t(O)}C.done?n(D):Promise.resolve(D).then(r,l)}function XA(e){return function(){var n=this,t=arguments;return new Promise(function(r,l){var d=e.apply(n,t);function y(D){WA(d,r,l,y,C,"next",D)}function C(D){WA(d,r,l,y,C,"throw",D)}y(void 0)})}}var rg=ve(574),AU=ve(904);let PU=(()=>{class e{constructor(t){this.httpClient=t,this.cbAddres=new s,this.mapbox=rg,this.map=null,this.style="mapbox://styles/mapbox/streets-v12",this.lat=-2.275817,this.lng=-79.875993,this.zoom=14,this.wayPoint=[],this.markerDriver=null,this.mapbox.accessToken="pk.eyJ1IjoiY3ZpbGVsYTE5NzkiLCJhIjoiY2xuYWljM2x2MDJ6bTJzbzF1bzhxOWM1aiJ9.L8Me7xG665eiS43VvjW03A"}buildMap(t,r){return new Promise((l,d)=>{try{this.lng=Number(t),this.lat=Number(r),this.map=new rg.Map({container:"map",style:this.style,zoom:this.zoom,center:[this.lat,this.lng]});const y=new AU({accessToken:rg.accessToken,mapboxgl:rg});y.on("result",C=>{const{result:D}=C,O=C.result.geometry.coordinates;this.lat=O[0],this.lng=O[1],y.clear(),this.marker.setLngLat([Number(this.lat),Number(this.lng)]),this.cbAddres.emit(D)}),this.marker=new rg.Marker({draggable:!0}).setLngLat([Number(this.lat),Number(this.lng)]).addTo(this.map),this.marker.on("dragend",()=>{const C=this.marker.getLngLat();this.cbAddres.emit({geometry:{coordinates:[C.lng,C.lat]}})}),l({map:this.map,geocoder:y})}catch(y){d(y)}})}addMarkerCustom(t){const r=document.createElement("div");r.className="marker",this.markerDriver?this.markerDriver.setLngLat(t).addTo(this.map):this.markerDriver=new rg.Marker(r)}static#e=this.\u0275fac=function(r){return new(r||e)(sn(Nd))};static#t=this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Au=Object.create(null);Au.open="0",Au.close="1",Au.ping="2",Au.pong="3",Au.message="4",Au.upgrade="5",Au.noop="6";const Px=Object.create(null);Object.keys(Au).forEach(e=>{Px[Au[e]]=e});const xE={type:"error",data:"parser error"},YA="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),KA="function"==typeof ArrayBuffer,JA=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,bE=({type:e,data:n},t,r)=>YA&&n instanceof Blob?t?r(n):QA(n,r):KA&&(n instanceof ArrayBuffer||JA(n))?t?r(n):QA(new Blob([n]),r):r(Au[e]+(n||"")),QA=(e,n)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];n("b"+(r||""))},t.readAsDataURL(e)};function e2(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let wE;const Ay=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<64;e++)Ay["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const kU="function"==typeof ArrayBuffer,EE=(e,n)=>{if("string"!=typeof e)return{type:"message",data:t2(e,n)};const t=e.charAt(0);return"b"===t?{type:"message",data:OU(e.substring(1),n)}:Px[t]?e.length>1?{type:Px[t],data:e.substring(1)}:{type:Px[t]}:xE},OU=(e,n)=>{if(kU){const t=(e=>{let r,d,y,C,D,n=.75*e.length,t=e.length,l=0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);const O=new ArrayBuffer(n),$=new Uint8Array(O);for(r=0;r<t;r+=4)d=Ay[e.charCodeAt(r)],y=Ay[e.charCodeAt(r+1)],C=Ay[e.charCodeAt(r+2)],D=Ay[e.charCodeAt(r+3)],$[l++]=d<<2|y>>4,$[l++]=(15&y)<<4|C>>2,$[l++]=(3&C)<<6|63&D;return O})(e);return t2(t,n)}return{base64:!0,data:e}},t2=(e,n)=>"blob"===n?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,n2=String.fromCharCode(30);let CE;function Rx(e){return e.reduce((n,t)=>n+t.length,0)}function Lx(e,n){if(e[0].length===n)return e.shift();const t=new Uint8Array(n);let r=0;for(let l=0;l<n;l++)t[l]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),t}function Io(e){if(e)return function VU(e){for(var n in Io.prototype)e[n]=Io.prototype[n];return e}(e)}Io.prototype.on=Io.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(n),this},Io.prototype.once=function(e,n){function t(){this.off(e,t),n.apply(this,arguments)}return t.fn=n,this.on(e,t),this},Io.prototype.off=Io.prototype.removeListener=Io.prototype.removeAllListeners=Io.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+e];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,l=0;l<t.length;l++)if((r=t[l])===n||r.fn===n){t.splice(l,1);break}return 0===t.length&&delete this._callbacks["$"+e],this},Io.prototype.emitReserved=Io.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),t=this._callbacks["$"+e],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(t){r=0;for(var l=(t=t.slice(0)).length;r<l;++r)t[r].apply(this,n)}return this},Io.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Io.prototype.hasListeners=function(e){return!!this.listeners(e).length};const oc=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function r2(e,...n){return n.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const UU=oc.setTimeout,jU=oc.clearTimeout;function kx(e,n){n.useNativeTimers?(e.setTimeoutFn=UU.bind(oc),e.clearTimeoutFn=jU.bind(oc)):(e.setTimeoutFn=oc.setTimeout.bind(oc),e.clearTimeoutFn=oc.clearTimeout.bind(oc))}function HU(e){return"string"==typeof e?function GU(e){let n=0,t=0;for(let r=0,l=e.length;r<l;r++)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:n<55296||n>=57344?t+=3:(r++,t+=4);return t}(e):Math.ceil(1.33*(e.byteLength||e.size))}class WU extends Error{constructor(n,t,r){super(n),this.description=t,this.context=r,this.type="TransportError"}}class TE extends Io{constructor(n){super(),this.writable=!1,kx(this,n),this.opts=n,this.query=n.query,this.socket=n.socket}onError(n,t,r){return super.emitReserved("error",new WU(n,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(n){"open"===this.readyState&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const t=EE(n,this.socket.binaryType);this.onPacket(t)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,t={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const n=this.opts.hostname;return-1===n.indexOf(":")?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(n){const t=function qU(e){let n="";for(let t in e)e.hasOwnProperty(t)&&(n.length&&(n+="&"),n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n}(n);return t.length?"?"+t:""}}const o2="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ox=64,s2={};let l2,a2=0,jd=0;function c2(e){let n="";do{n=o2[e%Ox]+n,e=Math.floor(e/Ox)}while(e>0);return n}function u2(){const e=c2(+new Date);return e!==l2?(a2=0,l2=e):e+"."+c2(a2++)}for(;jd<Ox;jd++)s2[o2[jd]]=jd;let h2=!1;try{h2=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const XU=h2;function d2(e){const n=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||XU))return new XMLHttpRequest}catch{}if(!n)try{return new(oc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function YU(){}const KU=null!=new d2({xdomain:!1}).responseType;let Nx=(()=>{class e extends Io{constructor(t,r){super(),kx(this,r),this.opts=r,this.method=r.method||"GET",this.uri=t,this.data=void 0!==r.data?r.data:null,this.create()}create(){var t;const r=r2(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;const l=this.xhr=new d2(r);try{l.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let d in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(d)&&l.setRequestHeader(d,this.opts.extraHeaders[d])}}catch{}if("POST"===this.method)try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(l),"withCredentials"in l&&(l.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(l.timeout=this.opts.requestTimeout),l.onreadystatechange=()=>{var d;3===l.readyState&&(null===(d=this.opts.cookieJar)||void 0===d||d.parseCookies(l)),4===l.readyState&&(200===l.status||1223===l.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof l.status?l.status:0)},0))},l.send(this.data)}catch(d){return void this.setTimeoutFn(()=>{this.onError(d)},0)}typeof document<"u"&&(this.index=e.requestsCount++,e.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=YU,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete e.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return e.requestsCount=0,e.requests={},e})();function f2(){for(let e in Nx.requests)Nx.requests.hasOwnProperty(e)&&Nx.requests[e].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",f2):"function"==typeof addEventListener&&addEventListener("onpagehide"in oc?"pagehide":"unload",f2,!1));const DE="function"==typeof Promise&&"function"==typeof Promise.resolve?n=>Promise.resolve().then(n):(n,t)=>t(n,0),Fx=oc.WebSocket||oc.MozWebSocket,p2=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),nj={websocket:class ej extends TE{constructor(n){super(n),this.supportsBinary=!n.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const n=this.uri(),t=this.opts.protocols,r=p2?{}:r2(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=p2?new Fx(n,t,r):t?new Fx(n,t):new Fx(n)}catch(l){return this.emitReserved("error",l)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const l=t===n.length-1;bE(n[t],this.supportsBinary,d=>{try{this.ws.send(d)}catch{}l&&DE(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=u2()),this.supportsBinary||(t.b64=1),this.createUri(n,t)}check(){return!!Fx}},webtransport:class tj extends TE{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(n=>{const t=function BU(e,n){CE||(CE=new TextDecoder);const t=[];let r=0,l=-1,d=!1;return new TransformStream({transform(y,C){for(t.push(y);;){if(0===r){if(Rx(t)<1)break;const D=Lx(t,1);d=128==(128&D[0]),l=127&D[0],r=l<126?3:126===l?1:2}else if(1===r){if(Rx(t)<2)break;const D=Lx(t,2);l=new DataView(D.buffer,D.byteOffset,D.length).getUint16(0),r=3}else if(2===r){if(Rx(t)<8)break;const D=Lx(t,8),O=new DataView(D.buffer,D.byteOffset,D.length),$=O.getUint32(0);if($>Math.pow(2,21)-1){C.enqueue(xE);break}l=$*Math.pow(2,32)+O.getUint32(4),r=3}else{if(Rx(t)<l)break;const D=Lx(t,l);C.enqueue(EE(d?D:CE.decode(D),n)),r=0}if(0===l||l>e){C.enqueue(xE);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=n.readable.pipeThrough(t).getReader(),l=function zU(){return new TransformStream({transform(e,n){!function RU(e,n){YA&&e.data instanceof Blob?e.data.arrayBuffer().then(e2).then(n):KA&&(e.data instanceof ArrayBuffer||JA(e.data))?n(e2(e.data)):bE(e,!1,t=>{wE||(wE=new TextEncoder),n(wE.encode(t))})}(e,t=>{const r=t.length;let l;if(r<126)l=new Uint8Array(1),new DataView(l.buffer).setUint8(0,r);else if(r<65536){l=new Uint8Array(3);const d=new DataView(l.buffer);d.setUint8(0,126),d.setUint16(1,r)}else{l=new Uint8Array(9);const d=new DataView(l.buffer);d.setUint8(0,127),d.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(l[0]|=128),n.enqueue(l),n.enqueue(t)})}})}();l.readable.pipeTo(n.writable),this.writer=l.writable.getWriter();const d=()=>{r.read().then(({done:C,value:D})=>{C||(this.onPacket(D),d())}).catch(C=>{})};d();const y={type:"open"};this.query.sid&&(y.data=`{"sid":"${this.query.sid}"}`),this.writer.write(y).then(()=>this.onOpen())})}))}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const l=t===n.length-1;this.writer.write(n[t]).then(()=>{l&&DE(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;null===(n=this.transport)||void 0===n||n.close()}},polling:class JU extends TE{constructor(n){if(super(n),this.polling=!1,typeof location<"u"){const r="https:"===location.protocol;let l=location.port;l||(l=r?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||l!==n.port}this.supportsBinary=KU&&!(n&&n.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(n){this.readyState="pausing";const t=()=>{this.readyState="paused",n()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){((e,n)=>{const t=e.split(n2),r=[];for(let l=0;l<t.length;l++){const d=EE(t[l],n);if(r.push(d),"error"===d.type)break}return r})(n,this.socket.binaryType).forEach(r=>{if("opening"===this.readyState&&"open"===r.type&&this.onOpen(),"close"===r.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const n=()=>{this.write([{type:"close"}])};"open"===this.readyState?n():this.once("open",n)}write(n){this.writable=!1,((e,n)=>{const t=e.length,r=new Array(t);let l=0;e.forEach((d,y)=>{bE(d,!1,C=>{r[y]=C,++l===t&&n(r.join(n2))})})})(n,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=u2()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(n,t)}request(n={}){return Object.assign(n,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Nx(this.uri(),n)}doWrite(n,t){const r=this.request({method:"POST",data:n});r.on("success",t),r.on("error",(l,d)=>{this.onError("xhr post error",l,d)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=n}}},ij=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,rj=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function SE(e){const n=e,t=e.indexOf("["),r=e.indexOf("]");-1!=t&&-1!=r&&(e=e.substring(0,t)+e.substring(t,r).replace(/:/g,";")+e.substring(r,e.length));let l=ij.exec(e||""),d={},y=14;for(;y--;)d[rj[y]]=l[y]||"";return-1!=t&&-1!=r&&(d.source=n,d.host=d.host.substring(1,d.host.length-1).replace(/;/g,":"),d.authority=d.authority.replace("[","").replace("]","").replace(/;/g,":"),d.ipv6uri=!0),d.pathNames=function oj(e,n){const r=n.replace(/\/{2,9}/g,"/").split("/");return("/"==n.slice(0,1)||0===n.length)&&r.splice(0,1),"/"==n.slice(-1)&&r.splice(r.length-1,1),r}(0,d.path),d.queryKey=function sj(e,n){const t={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,l,d){l&&(t[l]=d)}),t}(0,d.query),d}let m2=(()=>{class e extends Io{constructor(t,r={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(r=t,t=null),t?(t=SE(t),r.hostname=t.host,r.secure="https"===t.protocol||"wss"===t.protocol,r.port=t.port,t.query&&(r.query=t.query)):r.host&&(r.hostname=SE(r.host).host),kx(this,r),this.secure=null!=r.secure?r.secure:typeof location<"u"&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=r.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function ZU(e){let n={},t=e.split("&");for(let r=0,l=t.length;r<l;r++){let d=t[r].split("=");n[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return n}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=4,r.transport=t,this.id&&(r.sid=this.id);const l=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new nj[t](l)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch{return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",r=>this.onClose("transport close",r))}probe(t){let r=this.createTransport(t),l=!1;e.priorWebsocketSuccess=!1;const d=()=>{l||(r.send([{type:"ping",data:"probe"}]),r.once("packet",oe=>{if(!l)if("pong"===oe.type&&"probe"===oe.data){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;e.priorWebsocketSuccess="websocket"===r.name,this.transport.pause(()=>{l||"closed"!==this.readyState&&(W(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const be=new Error("probe error");be.transport=r.name,this.emitReserved("upgradeError",be)}}))};function y(){l||(l=!0,W(),r.close(),r=null)}const C=oe=>{const be=new Error("probe error: "+oe);be.transport=r.name,y(),this.emitReserved("upgradeError",be)};function D(){C("transport closed")}function O(){C("socket closed")}function $(oe){r&&oe.name!==r.name&&y()}const W=()=>{r.removeListener("open",d),r.removeListener("error",C),r.removeListener("close",D),this.off("close",O),this.off("upgrading",$)};r.once("open",d),r.once("error",C),r.once("close",D),this.once("close",O),this.once("upgrading",$),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn(()=>{l||r.open()},200):r.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const r=this.upgrades.length;for(;t<r;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const r=new Error("server error");r.code=t.data,this.onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let l=0;l<this.writeBuffer.length;l++){const d=this.writeBuffer[l].data;if(d&&(r+=HU(d)),l>0&&r>this.maxPayload)return this.writeBuffer.slice(0,l);r+=2}return this.writeBuffer}write(t,r,l){return this.sendPacket("message",t,r,l),this}send(t,r,l){return this.sendPacket("message",t,r,l),this}sendPacket(t,r,l,d){if("function"==typeof r&&(d=r,r=void 0),"function"==typeof l&&(d=l,l=null),"closing"===this.readyState||"closed"===this.readyState)return;(l=l||{}).compress=!1!==l.compress;const y={type:t,data:r,options:l};this.emitReserved("packetCreate",y),this.writeBuffer.push(y),d&&this.once("flush",d),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},l=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():t()}):this.upgrading?l():t()),this}onError(t){e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,r){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const r=[];let l=0;const d=t.length;for(;l<d;l++)~this.transports.indexOf(t[l])&&r.push(t[l]);return r}}return e.protocol=4,e})();const lj="function"==typeof ArrayBuffer,cj=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,g2=Object.prototype.toString,uj="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===g2.call(Blob),hj="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===g2.call(File);function IE(e){return lj&&(e instanceof ArrayBuffer||cj(e))||uj&&e instanceof Blob||hj&&e instanceof File}function zx(e,n){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(zx(e[t]))return!0;return!1}if(IE(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return zx(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&zx(e[t]))return!0;return!1}function dj(e){const n=[],r=e;return r.data=AE(e.data,n),r.attachments=n.length,{packet:r,buffers:n}}function AE(e,n){if(!e)return e;if(IE(e)){const t={_placeholder:!0,num:n.length};return n.push(e),t}if(Array.isArray(e)){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=AE(e[r],n);return t}if("object"==typeof e&&!(e instanceof Date)){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=AE(e[r],n));return t}return e}function fj(e,n){return e.data=PE(e.data,n),delete e.attachments,e}function PE(e,n){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<n.length)return n[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=PE(e[t],n);else if("object"==typeof e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=PE(e[t],n));return e}const pj=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],_2=5;var Vi=function(e){return e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK",e}(Vi||{});class mj{constructor(n){this.replacer=n}encode(n){return n.type!==Vi.EVENT&&n.type!==Vi.ACK||!zx(n)?[this.encodeAsString(n)]:this.encodeAsBinary({type:n.type===Vi.EVENT?Vi.BINARY_EVENT:Vi.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id})}encodeAsString(n){let t=""+n.type;return(n.type===Vi.BINARY_EVENT||n.type===Vi.BINARY_ACK)&&(t+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(t+=n.nsp+","),null!=n.id&&(t+=n.id),null!=n.data&&(t+=JSON.stringify(n.data,this.replacer)),t}encodeAsBinary(n){const t=dj(n),r=this.encodeAsString(t.packet),l=t.buffers;return l.unshift(r),l}}function y2(e){return"[object Object]"===Object.prototype.toString.call(e)}class RE extends Io{constructor(n){super(),this.reviver=n}add(n){let t;if("string"==typeof n){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(n);const r=t.type===Vi.BINARY_EVENT;r||t.type===Vi.BINARY_ACK?(t.type=r?Vi.EVENT:Vi.ACK,this.reconstructor=new gj(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!IE(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(n),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(n){let t=0;const r={type:Number(n.charAt(0))};if(void 0===Vi[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Vi.BINARY_EVENT||r.type===Vi.BINARY_ACK){const d=t+1;for(;"-"!==n.charAt(++t)&&t!=n.length;);const y=n.substring(d,t);if(y!=Number(y)||"-"!==n.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(y)}if("/"===n.charAt(t+1)){const d=t+1;for(;++t&&","!==n.charAt(t)&&t!==n.length;);r.nsp=n.substring(d,t)}else r.nsp="/";const l=n.charAt(t+1);if(""!==l&&Number(l)==l){const d=t+1;for(;++t;){const y=n.charAt(t);if(null==y||Number(y)!=y){--t;break}if(t===n.length)break}r.id=Number(n.substring(d,t+1))}if(n.charAt(++t)){const d=this.tryParse(n.substr(t));if(!RE.isPayloadValid(r.type,d))throw new Error("invalid payload");r.data=d}return r}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,t){switch(n){case Vi.CONNECT:return y2(t);case Vi.DISCONNECT:return void 0===t;case Vi.CONNECT_ERROR:return"string"==typeof t||y2(t);case Vi.EVENT:case Vi.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===pj.indexOf(t[0]));case Vi.ACK:case Vi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class gj{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const t=fj(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Gc(e,n,t){return e.on(n,t),function(){e.off(n,t)}}const _j=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class LE extends Io{constructor(n,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[Gc(n,"open",this.onopen.bind(this)),Gc(n,"packet",this.onpacket.bind(this)),Gc(n,"error",this.onerror.bind(this)),Gc(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...t){if(_j.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(t.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Vi.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const y=this.ids++,C=t.pop();this._registerAckCallback(y,C),r.id=y}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(n,t){var r;const l=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===l)return void(this.acks[n]=t);const d=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let y=0;y<this.sendBuffer.length;y++)this.sendBuffer[y].id===n&&this.sendBuffer.splice(y,1);t.call(this,new Error("operation has timed out"))},l);this.acks[n]=(...y)=>{this.io.clearTimeoutFn(d),t.apply(this,[null,...y])}}emitWithAck(n,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((l,d)=>{t.push((y,C)=>r?y?d(y):l(C):l(y)),this.emit(n,...t)})}_addToQueue(n){let t;"function"==typeof n[n.length-1]&&(t=n.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((l,...d)=>r!==this._queue[0]?void 0:(null!==l?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(l)):(this._queue.shift(),t&&t(null,...d)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!n||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){"function"==typeof this.auth?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:Vi.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,t)}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case Vi.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Vi.EVENT:case Vi.BINARY_EVENT:this.onevent(n);break;case Vi.ACK:case Vi.BINARY_ACK:this.onack(n);break;case Vi.DISCONNECT:this.ondisconnect();break;case Vi.CONNECT_ERROR:this.destroy();const r=new Error(n.data.message);r.data=n.data.data,this.emitReserved("connect_error",r)}}onevent(n){const t=n.data||[];null!=n.id&&t.push(this.ack(n.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&"string"==typeof n[n.length-1]&&(this._lastOffset=n[n.length-1])}ack(n){const t=this;let r=!1;return function(...l){r||(r=!0,t.packet({type:Vi.ACK,id:n,data:l}))}}onack(n){const t=this.acks[n.id];"function"==typeof t&&(t.apply(this,n.data),delete this.acks[n.id])}onconnect(n,t){this.id=n,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Vi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,n.data)}}}function sg(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}sg.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),t=Math.floor(n*this.jitter*e);e=1&Math.floor(10*n)?e+t:e-t}return 0|Math.min(e,this.max)},sg.prototype.reset=function(){this.attempts=0},sg.prototype.setMin=function(e){this.ms=e},sg.prototype.setMax=function(e){this.max=e},sg.prototype.setJitter=function(e){this.jitter=e};class Bx extends Io{constructor(n,t){var r;super(),this.nsps={},this.subs=[],n&&"object"==typeof n&&(t=n,n=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,kx(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new sg({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=n;const l=t.parser||gt;this.encoder=new l.Encoder,this.decoder=new l.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection}reconnectionAttempts(n){return void 0===n?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var t;return void 0===n?this._reconnectionDelay:(this._reconnectionDelay=n,null===(t=this.backoff)||void 0===t||t.setMin(n),this)}randomizationFactor(n){var t;return void 0===n?this._randomizationFactor:(this._randomizationFactor=n,null===(t=this.backoff)||void 0===t||t.setJitter(n),this)}reconnectionDelayMax(n){var t;return void 0===n?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,null===(t=this.backoff)||void 0===t||t.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new m2(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const l=Gc(t,"open",function(){r.onopen(),n&&n()}),d=C=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",C),n?n(C):this.maybeReconnectOnOpen()},y=Gc(t,"error",d);if(!1!==this._timeout){const D=this.setTimeoutFn(()=>{l(),d(new Error("timeout")),t.close()},this._timeout);this.opts.autoUnref&&D.unref(),this.subs.push(()=>{this.clearTimeoutFn(D)})}return this.subs.push(l),this.subs.push(y),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push(Gc(n,"ping",this.onping.bind(this)),Gc(n,"data",this.ondata.bind(this)),Gc(n,"error",this.onerror.bind(this)),Gc(n,"close",this.onclose.bind(this)),Gc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(t){this.onclose("parse error",t)}}ondecoded(n){DE(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,t){let r=this.nsps[n];return r?this._autoConnect&&!r.active&&r.connect():(r=new LE(this,n,t),this.nsps[n]=r),r}_destroy(n){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(n){const t=this.encoder.encode(n);for(let r=0;r<t.length;r++)this.engine.write(t[r],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(n,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(l=>{l?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",l)):n.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}}const Py={};function $d(e,n){"object"==typeof e&&(n=e,e=void 0);const t=function aj(e,n="",t){let r=e;t=t||typeof location<"u"&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(e=typeof t<"u"?t.protocol+"//"+e:"https://"+e),r=SE(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const d=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+d+":"+r.port+n,r.href=r.protocol+"://"+d+(t&&t.port===r.port?"":":"+r.port),r}(e,(n=n||{}).path||"/socket.io"),r=t.source,l=t.id;let D;return n.forceNew||n["force new connection"]||!1===n.multiplex||Py[l]&&t.path in Py[l].nsps?D=new Bx(r,n):(Py[l]||(Py[l]=new Bx(r,n)),D=Py[l]),t.query&&!n.query&&(n.query=t.queryKey),D.socket(t.path,n)}Object.assign($d,{Manager:Bx,Socket:LE,io:$d,connect:$d});class kE{constructor(n){this.config=n,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===n&&(n=this.emptyConfig),this.ioSocket=($d||Ue)(n.url,n.options)}of(n){this.ioSocket.of(n)}on(n,t){this.ioSocket.on(n,t)}once(n,t){this.ioSocket.once(n,t)}connect(){return this.ioSocket.connect()}disconnect(n){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(n,...t){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(n,t){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(n){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(n){return this.subscribersCounter[n]||(this.subscribersCounter[n]=0),this.subscribersCounter[n]++,this.eventObservables$[n]||(this.eventObservables$[n]=new In(t=>{const r=l=>{t.next(l)};return this.ioSocket.on(n,r),()=>{this.subscribersCounter[n]--,0===this.subscribersCounter[n]&&(this.ioSocket.removeListener(n,r),delete this.eventObservables$[n])}}).pipe(sr())),this.eventObservables$[n]}fromOneTimeEvent(n){return new Promise(t=>this.once(n,t))}listeners(n){return this.ioSocket.listeners(n)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(n,t){return n?n&&!t?this.ioSocket.off(n):this.ioSocket.off(n,t):this.ioSocket.offAny()}onAny(n){return this.ioSocket.onAny(n)}onAnyOutgoing(n){return this.ioSocket.onAnyOutgoing(n)}prependAny(n){return this.ioSocket.prependAny(n)}prependAnyOutgoing(n){return this.ioSocket.prependAnyOutgoing(n)}timeout(n){return this.ioSocket.timeout(n)}volatile(){return this.ioSocket.volatile}}function yj(e){return new kE(e)}const v2=new Xt("__SOCKET_IO_CONFIG__");let vj=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[{provide:v2,useValue:t},{provide:kE,useFactory:yj,deps:[v2]}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Nn({type:e}),e.\u0275inj=Nr({}),e})();const xj=["asGeoCoder"];function bj(e,n){1&e&&(pe(0,"div",17),Fe(1," La descripci\xf3n es requerida. "),me())}function wj(e,n){1&e&&(pe(0,"div",17),Fe(1," Descripci\xf3n con caracteres no permitidos "),me())}function Ej(e,n){1&e&&(pe(0,"div",17),Fe(1," Tel\xe9fono es requerido. "),me())}function Cj(e,n){1&e&&(pe(0,"div",17),Fe(1," Tel\xe9fono inv\xe1lido, ingrese solo n\xfameros. "),me())}const Tj=function(e,n,t){return{"alert-success":e,"alert-danger":n,"fade-out":t}};function Dj(e,n){if(1&e&&(pe(0,"div",18),Fe(1),me()),2&e){const t=Yn();At("ngClass",v1(2,Tj,t.mensaje.includes("\xe9xito"),t.mensaje.includes("Error"),"fade-out"===t.mensajeClass)),$e(1),es(" ",t.mensaje," ")}}const Mj=function(e){return{"active-way":e}};let Sj=(()=>{class e{constructor(t,r,l,d,y){this.mapCustonService=t,this.renderer2=r,this.socket=l,this.ubicacionService=d,this.usuarioServicio=y,this.modeInput="start",this.wayPoints={start:null,end:null},this.mensajeClass="",this.ubicacion={identificacion_usuario:"",telefono:"",latitud:"",longitud:"",estado:"",descripcion:""}}ngOnInit(){this.usuarioServicio.userEmail$.subscribe(l=>{this.usuarioServicio.usuarioLoginOn&&(this.email=l)}),this.ubicacionService.obtenerUbicacionUsuarioPorEmail(this.email).subscribe({next:l=>{l?(this.ubicacion=l,this.mapCustonService.buildMap(this.ubicacion.latitud,this.ubicacion.longitud).then(({geocoder:d,map:y})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,d.onAdd(y))}).catch(d=>{console.log("***** ERROR ****",d)})):(this.usuarioServicio.userIdentificacion$.subscribe(d=>{this.ubicacion.identificacion_usuario=d}),this.mapCustonService.buildMap("41.398176","2.170946").then(({geocoder:d,map:y})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,d.onAdd(y))}).catch(d=>{console.log("***** ERROR ****",d)}))},error:l=>{console.log("UBICACION ::: algo paso :( ",l)}}),this.mapCustonService.cbAddres.subscribe(l=>{"start"===this.modeInput&&(this.wayPoints.start=l,this.ubicacion.longitud=this.wayPoints.start.geometry.coordinates[0],this.ubicacion.latitud=this.wayPoints.start.geometry.coordinates[1])}),this.socket.fromEvent("position").subscribe(({coords:l})=>{this.mapCustonService.addMarkerCustom(l)})}changeMode(t){this.modeInput=t}actualizaUbicacion(){var t=this;return XA(function*(){t.mensaje="",t.mensajeClass="",t.mensaje="Guardado con \xe9xito",t.ubicacionService.guardaActualizaUbicacion(t.ubicacion).subscribe({next:r=>{t.mensaje="Guardado con \xe9xito",t.ocultarMensajeSegunTiempo()},error:r=>{t.mensaje="Presentamos inconvenientes: "+r,t.ocultarMensajeSegunTiempo()}})})()}ocultarMensajeSegunTiempo(){setTimeout(()=>{this.mensaje="",this.mensajeClass="fade-out"},5e3),setTimeout(()=>{this.mensajeClass="fade-out"},3e3)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(PU),Qe(Za),Qe(kE),Qe($I),Qe(Hc))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-trabajador"]],viewQuery:function(r,l){if(1&r&&function TD(e,n,t){const r=ti();r.firstCreatePass&&(SD(r,new ED(e,n,t),-1),2==(2&n)&&(r.staticViewQueries=!0)),MD(r,vt(),n)}(xj,5),2&r){let d;M1(d=S1())&&(l.asGeoCoder=d.first)}},decls:43,vars:14,consts:[[1,"text-center"],[1,"wrapper"],[1,"box-inputs"],["id","geocoder",1,"geocoder"],["asGeoCoder",""],[3,"ngClass","click"],[1,"mock-label"],[1,"mock-input"],["type","text","pattern","^[a-zA-Z0-9.,;'\\s\xf1\xd1]*$","maxlength","200","required","true","placeholder","Ingresa una descripci\xf3n",1,"mock-input","form-control",3,"ngModel","ngModelChange"],["descripcion","ngModel"],["class","alert alert-danger",4,"ngIf"],["type","tel","pattern","[0-9]*","maxlength","15","required","true","placeholder","Ingresa un n\xfamero de tel\xe9fono",1,"mock-input","form-control",3,"ngModel","ngModelChange"],["telefono","ngModel"],["class","alert",3,"ngClass",4,"ngIf"],["id","map",1,"map-container-trabajador"],["asMap",""],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[1,"alert",3,"ngClass"]],template:function(r,l){if(1&r&&(pe(0,"h1",0),Fe(1,"Actualice Datos de Ubicaci\xf3n"),me(),pe(2,"div",1)(3,"div",2)(4,"div"),wo(5,"div",3,4),me(),pe(7,"div",5),mn("click",function(){return l.changeMode("start")}),pe(8,"div",6),Fe(9,"Ubicaci\xf3n"),me(),pe(10,"div",7),Fe(11),me()(),pe(12,"div")(13,"div",6),Fe(14,"Longitud"),me(),pe(15,"div",7),Fe(16),me()(),pe(17,"div")(18,"div",6),Fe(19,"Latitud"),me(),pe(20,"div",7),Fe(21),me()(),pe(22,"div")(23,"div",6),Fe(24,"Descripci\xf3n del Lugar"),me(),pe(25,"textarea",8,9),mn("ngModelChange",function(y){return l.ubicacion.descripcion=y}),me(),Qn(27,bj,2,0,"div",10),Qn(28,wj,2,0,"div",10),me(),pe(29,"div")(30,"div",6),Fe(31,"Tel\xe9fono de Ubicaci\xf3n"),me(),pe(32,"input",11,12),mn("ngModelChange",function(y){return l.ubicacion.telefono=y}),me(),Qn(34,Ej,2,0,"div",10),Qn(35,Cj,2,0,"div",10),Qn(36,Dj,2,6,"div",13),me()()(),pe(37,"div",1),wo(38,"div",14,15),me(),pe(40,"div",0)(41,"button",16),mn("click",function(){return l.actualizaUbicacion()}),Fe(42,"Guardar"),me()()),2&r){const d=B_(26),y=B_(33);$e(7),At("ngClass",y1(12,Mj,"start"===l.modeInput)),$e(4),oi(null==l.wayPoints.start?null:l.wayPoints.start.place_name),$e(5),oi(l.ubicacion.longitud),$e(5),oi(l.ubicacion.latitud),$e(4),At("ngModel",l.ubicacion.descripcion),$e(2),At("ngIf",(null==d.errors?null:d.errors.required)&&(d.dirty||d.touched)),$e(1),At("ngIf",(null==d.errors?null:d.errors.pattern)&&(d.dirty||d.touched)),$e(4),At("ngModel",l.ubicacion.telefono),$e(2),At("ngIf",(null==y.errors?null:y.errors.required)&&(y.dirty||y.touched)),$e(1),At("ngIf",(null==y.errors?null:y.errors.pattern)&&(y.dirty||y.touched)),$e(1),At("ngIf",l.mensaje),$e(5),At("disabled",d.invalid||y.invalid)}},dependencies:[q0,Uc,Iu,Rh,Oh,_E,yE,Lh],styles:[".map-container-trabajador[_ngcontent-%COMP%]{width:52%;height:500px;border-radius:1rem;border:solid 10px white;box-shadow:0 12.5px 10px #00000009,0 100px 80px #00000012}.marker[_ngcontent-%COMP%]{width:50px;height:50px;background-image:url(maps-and-location.1cc4b9a453b3e1ef.png);background-size:contain;background-repeat:no-repeat;background-position:center}.box-inputs[_ngcontent-%COMP%]{background-color:#fff;width:52%;border-radius:.5rem;border:solid 2px #00000008;padding:1rem;box-shadow:0 12.5px 10px #00000009,0 100px 80px #00000012}.mock-input[_ngcontent-%COMP%]{width:100%;background:white;padding:.5rem;margin-bottom:.5rem;box-shadow:0 0 10px #0000001a;color:gray;min-height:18px}.mock-label[_ngcontent-%COMP%]{padding:.25rem;font-weight:600}.geocoder[_ngcontent-%COMP%]{margin-bottom:.5rem}.active-way[_ngcontent-%COMP%]{border:solid 2px #09c509;box-shadow:0 0 10px #09c5094a}.btn-route[_ngcontent-%COMP%]{background-color:#fff;padding:.5rem 1rem;border:solid 2px gray}.wrapper[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:center}.fade-out[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOut 2s;-webkit-animation:_ngcontent-%COMP%_fadeOut 2s}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1}to{opacity:0}}"]})}return e})();function Ij(e,n){if(1&e){const t=Sd();pe(0,"tr")(1,"td"),Fe(2),me(),pe(3,"td"),Fe(4),me(),pe(5,"td"),Fe(6),me(),pe(7,"td"),Fe(8),me(),pe(9,"td")(10,"button",11),mn("click",function(){const d=yi(t).$implicit;return vi(Yn(2).editarPerfil(d.id_perfil))}),Fe(11,"Editar"),me()()()}if(2&e){const t=n.$implicit,r=Yn(2);$e(2),oi(t.id_usuario),$e(2),oi(r.getProfesionDescripcion(t.profesion)),$e(2),oi(t.tiempo_experiencia),$e(2),oi(t.introduccion)}}function Aj(e,n){if(1&e){const t=Sd();pe(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),Fe(4,"Mi Perfil Laboral"),me()(),pe(5,"div",6)(6,"button",7),mn("click",function(){return yi(t),vi(Yn().agregarPerfil())}),Fe(7,"Agregar Perfil"),me(),pe(8,"table",8)(9,"thead",9)(10,"tr")(11,"th"),Fe(12,"ID-USUARIO"),me(),pe(13,"th"),Fe(14,"Profesi\xf3n"),me(),pe(15,"th"),Fe(16,"Tiempo de Experiencia"),me(),pe(17,"th"),Fe(18,"Introducci\xf3n"),me(),pe(19,"th"),Fe(20,"Acciones"),me()()(),pe(21,"tbody"),Qn(22,Ij,12,4,"tr",10),me()()()()()}if(2&e){const t=Yn();$e(22),At("ngForOf",t.perfiles)}}function Pj(e,n){if(1&e&&(pe(0,"option",27),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}function Rj(e,n){if(1&e){const t=Sd();pe(0,"div",12)(1,"h2"),Fe(2),me(),pe(3,"form",13,14),mn("ngSubmit",function(){return yi(t),vi(Yn().guardarPerfil())}),pe(5,"input",15),mn("ngModelChange",function(l){return yi(t),vi(Yn().perfil.id_perfil=l)}),me(),pe(6,"div",16)(7,"label"),Fe(8,"ID Usuario"),me(),pe(9,"input",17),mn("ngModelChange",function(l){return yi(t),vi(Yn().perfil.id_usuario=l)}),me()(),pe(10,"div",16)(11,"label",18),Fe(12,"Profesi\xf3n"),me(),pe(13,"select",19),mn("ngModelChange",function(l){return yi(t),vi(Yn().perfil.profesion=l)}),pe(14,"option",20),Fe(15,"Seleccione una profesi\xf3n"),me(),Qn(16,Pj,2,2,"option",21),me()(),pe(17,"div",16)(18,"label"),Fe(19,"Tiempo de Experiencia"),me(),pe(20,"input",22),mn("ngModelChange",function(l){return yi(t),vi(Yn().perfil.tiempo_experiencia=l)}),me()(),pe(21,"div",16)(22,"label"),Fe(23,"Introducci\xf3n"),me(),pe(24,"textarea",23),mn("ngModelChange",function(l){return yi(t),vi(Yn().perfil.introduccion=l)}),me()(),pe(25,"div",24)(26,"button",25),Fe(27,"Guardar"),me(),pe(28,"button",26),mn("click",function(){return yi(t),vi(Yn().cancelar())}),Fe(29,"Cancelar"),me()()()()}if(2&e){const t=B_(4),r=Yn();$e(2),es("",r.perfil.id_perfil?"Editar":"Agregar"," Perfil"),$e(3),At("ngModel",r.perfil.id_perfil),$e(4),At("ngModel",r.perfil.id_usuario),$e(4),At("ngModel",r.perfil.profesion),$e(1),At("ngValue",null),$e(2),At("ngForOf",r.profesiones),$e(4),At("ngModel",r.perfil.tiempo_experiencia),$e(4),At("ngModel",r.perfil.introduccion),$e(2),At("disabled",!t.form.valid)}}let Lj=(()=>{class e{constructor(t,r,l){this.perfilesServices=t,this.usuarioServices=r,this.selectores=l,this.perfil={id_perfil:0,id_usuario:0,profesion:0,tiempo_experiencia:"",introduccion:""},this.editaRegistraVisible=!1}ngOnInit(){this.profesiones=this.selectores.getAreProfesiones(),this.usuarioSubscription=this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t),this.cargarPerfilesUsuario()})}agregarPerfil(){this.inicializaPerfil(),this.editaRegistraVisible=!0}editarPerfil(t){const r=this.perfiles.find(l=>l.id_perfil===t);r&&(this.perfil={...r},this.editaRegistraVisible=!0),this.editaRegistraVisible=!0}guardarPerfil(){this.perfilesServices.guardaActualizaPerfil(this.perfil).subscribe({next:t=>{this.mensaje="Perfil registrada/actualizada con \xe9xito",this.cargarPerfilesUsuario()},error:t=>{this.mensaje="Registra de Perfil Presenta inconvenientes: "+t}}),this.editaRegistraVisible=!1}cargarPerfilesUsuario(){this.perfilesSubscrition=this.perfilesServices.obtenerPerfilesPorIdUsuario(`${this.id_usuario}`).subscribe(t=>{this.perfiles=t})}getProfesionDescripcion(t){const r=this.profesiones.find(l=>{if(l.id===t)return l});return r?r.nombre:"Desconocido"}cancelar(){this.editaRegistraVisible=!1}ngOnDestroy(){this.perfilesSubscrition&&this.perfilesSubscrition.unsubscribe(),this.usuarioSubscription&&this.usuarioSubscription.unsubscribe()}inicializaPerfil(){this.perfil={id_perfil:0,id_usuario:this.id_usuario,profesion:0,tiempo_experiencia:"",introduccion:""}}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Qw),Qe(Hc),Qe(ig))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-perfil"]],decls:2,vars:2,consts:[["id","listado","class","container mt-3",4,"ngIf"],["id","registro","class","container mt-3",4,"ngIf"],["id","listado",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"btn","btn-primary","mb-3",3,"click"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click"],["id","registro",1,"container","mt-3"],[3,"ngSubmit"],["perfilForm","ngForm"],["type","hidden","name","id_perfil",3,"ngModel","ngModelChange"],[1,"form-group"],["name","id_usuario","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["for","profesion"],["name","profesion","required","true",1,"form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["name","tiempo_experiencia","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","introduccion","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","d-flex","justify-content-center","mt-3"],["type","submit",1,"btn","btn-primary","me-2",3,"disabled"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"]],template:function(r,l){1&r&&(Qn(0,Aj,23,1,"div",0),Qn(1,Rj,30,9,"div",1)),2&r&&(At("ngIf",!l.editaRegistraVisible),$e(1),At("ngIf",l.editaRegistraVisible))},dependencies:[Dh,Uc,cp,up,hp,Iu,kh,Rh,ap,Oh,Lh,Ud]})}return e})();function kj(e,n){if(1&e&&(pe(0,"option",33),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}function Oj(e,n){if(1&e&&(pe(0,"option",33),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}function Nj(e,n){if(1&e&&(pe(0,"option",33),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}const Fj=function(e,n,t){return{"alert-success":e,"alert-danger":n,"fade-out":t}};function zj(e,n){if(1&e&&(pe(0,"div",34),Fe(1),me()),2&e){const t=Yn();At("ngClass",v1(2,Fj,t.mensaje.includes("\xe9xito"),t.mensaje.includes("Error"),"fade-out"===t.mensajeClass)),$e(1),es(" ",t.mensaje," ")}}let Bj=(()=>{class e{constructor(t,r,l){this.selectores=t,this.usuarioServicio=r,this.cdRef=l,this.mensajeClass="",this.usuario={id:0,nombres:"",email:"",password:"",rol:null,estado:"INACTIVO",identificacion:"",tipoIdentificacion:""},this.perfilTrabajo={id_perfil:0,id_usuario:0,profesion:0,tiempo_experiencia:"",introduccion:""}}ngOnInit(){this.tiposIdentificaciones=this.selectores.getTiposIdentificacion(),this.tiposRoles=this.selectores.getTiposRol(),this.profesiones=this.selectores.getAreProfesiones()}registrarUsuario(){var t=this;return XA(function*(){t.usuarioServicio.obtenerUsuarioPorEmail(t.usuario.email).subscribe({next:r=>{r&&r.length>0?(t.mensaje="El email ya est\xe1 registrado.",t.cdRef.detectChanges(),t.ocultarMensajeSegunTiempoRegistro()):t.crearNuevoUsuario()},error:r=>{console.error("Error al verificar el email:",r)}})})()}crearNuevoUsuario(){this.usuarioServicio.crearUsuario(this.usuario,this.perfilTrabajo).subscribe({next:t=>{this.mensaje="Registro con \xe9xito",this.cdRef.detectChanges(),this.ocultarMensajeSegunTiempoRegistro()},error:t=>{this.mensaje="Presentamos inconvenientes: "+t,this.cdRef.detectChanges(),this.ocultarMensajeSegunTiempoRegistro()}})}cancelarRegistro(){console.log("Cancelacion registro usuario para guardar :: ")}ocultarMensajeSegunTiempoRegistro(){setTimeout(()=>{this.mensaje="",this.mensajeClass="fade-out"},5e3),setTimeout(()=>{this.mensajeClass="fade-out"},3e3)}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(ig),Qe(Hc),Qe(Q_))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-registro"]],decls:57,vars:17,consts:[[1,"container","my-5"],[1,"row","justify-content-center"],[1,"col-lg-6"],[1,"text-center"],[1,"card","p-4",3,"ngSubmit"],["registroForm","ngForm"],["type","hidden","name","id_usuario",3,"ngModel","ngModelChange"],[1,"form-group","mb-3"],["for","nombres"],["type","text","name","nombres","placeholder","Nombres completo","required","true",1,"form-control",3,"ngModel","ngModelChange"],["for","email"],["type","email","name","email","placeholder","Email","required","true",1,"form-control",3,"ngModel","ngModelChange"],["for","password"],["type","password","name","password","placeholder","******","required","true",1,"form-control",3,"ngModel","ngModelChange"],["for","rol"],["name","rol","required","true",1,"form-select",3,"ngModel","ngModelChange"],["disabled","","selected","",3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["for","tipoidentificacion"],["name","tipoidentificacion","required","true",1,"form-select",3,"ngModel","ngModelChange"],["value","","disabled","","selected",""],["for","identificacion"],["type","text","name","identificacion","placeholder","0172621900","required","true",1,"form-control",3,"ngModel","ngModelChange"],["type","hidden","name","id_perfil",3,"ngModel","ngModelChange"],["for","profesion"],["name","profesion",1,"form-select",3,"ngModel","ngModelChange"],["for","tiempoTrabajo"],["type","text","name","tiempoTrabajo","placeholder","1 a\xf1o 3 meses","required","true",1,"form-control",3,"ngModel","ngModelChange"],["for","introduccion"],["type","text","name","introduccion","placeholder","introduccion","required","true",1,"form-control",3,"ngModel","ngModelChange"],["class","alert",3,"ngClass",4,"ngIf"],["type","submit",1,"btn","btn-primary","mb-3",3,"disabled"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],[3,"value"],[1,"alert",3,"ngClass"]],template:function(r,l){if(1&r&&(pe(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Fe(4,"Registro de Usuario"),me(),pe(5,"form",4,5),mn("ngSubmit",function(){return l.registrarUsuario()}),pe(7,"input",6),mn("ngModelChange",function(y){return l.usuario.id=y}),me(),pe(8,"div",7)(9,"label",8),Fe(10,"Nombres"),me(),pe(11,"input",9),mn("ngModelChange",function(y){return l.usuario.nombres=y}),me()(),pe(12,"div",7)(13,"label",10),Fe(14,"Email"),me(),pe(15,"input",11),mn("ngModelChange",function(y){return l.usuario.email=y}),me()(),pe(16,"div",7)(17,"label",12),Fe(18,"Password"),me(),pe(19,"input",13),mn("ngModelChange",function(y){return l.usuario.password=y}),me()(),pe(20,"div",7)(21,"label",14),Fe(22,"Rol"),me(),pe(23,"select",15),mn("ngModelChange",function(y){return l.usuario.rol=y}),pe(24,"option",16),Fe(25,"Seleccione un rol"),me(),Qn(26,kj,2,2,"option",17),me()(),pe(27,"div",7)(28,"label",18),Fe(29,"Tipo Identificaci\xf3n"),me(),pe(30,"select",19),mn("ngModelChange",function(y){return l.usuario.tipoIdentificacion=y}),pe(31,"option",20),Fe(32,"Seleccione un tipo de identificaci\xf3n"),me(),Qn(33,Oj,2,2,"option",17),me()(),pe(34,"div",7)(35,"label",21),Fe(36,"Identificacion"),me(),pe(37,"input",22),mn("ngModelChange",function(y){return l.usuario.identificacion=y}),me()(),pe(38,"input",23),mn("ngModelChange",function(y){return l.perfilTrabajo.id_perfil=y}),me(),pe(39,"div",7)(40,"label",24),Fe(41,"Profesi\xf3n"),me(),pe(42,"select",25),mn("ngModelChange",function(y){return l.perfilTrabajo.profesion=y}),Qn(43,Nj,2,2,"option",17),me()(),pe(44,"div",7)(45,"label",26),Fe(46,"Tiempo Experiencia"),me(),pe(47,"input",27),mn("ngModelChange",function(y){return l.perfilTrabajo.tiempo_experiencia=y}),me()(),pe(48,"div",7)(49,"label",28),Fe(50,"Actividades Profesionales"),me(),pe(51,"input",29),mn("ngModelChange",function(y){return l.perfilTrabajo.introduccion=y}),me()(),Qn(52,zj,2,6,"div",30),pe(53,"button",31),Fe(54,"Guardar"),me(),pe(55,"button",32),mn("click",function(){return l.cancelarRegistro()}),Fe(56,"Cancelar"),me()()()()()),2&r){const d=B_(6);$e(7),At("ngModel",l.usuario.id),$e(4),At("ngModel",l.usuario.nombres),$e(4),At("ngModel",l.usuario.email),$e(4),At("ngModel",l.usuario.password),$e(4),At("ngModel",l.usuario.rol),$e(1),At("ngValue",null),$e(2),At("ngForOf",l.tiposRoles),$e(4),At("ngModel",l.usuario.tipoIdentificacion),$e(3),At("ngForOf",l.tiposIdentificaciones),$e(4),At("ngModel",l.usuario.identificacion),$e(1),At("ngModel",l.perfilTrabajo.id_perfil),$e(4),At("ngModel",l.perfilTrabajo.profesion),$e(1),At("ngForOf",l.profesiones),$e(4),At("ngModel",l.perfilTrabajo.tiempo_experiencia),$e(4),At("ngModel",l.perfilTrabajo.introduccion),$e(1),At("ngIf",l.mensaje),$e(1),At("disabled",!d.form.valid)}},dependencies:[q0,Dh,Uc,cp,up,hp,Iu,kh,Rh,ap,Oh,Lh,Ud]})}return e})();function Vj(e,n){if(1&e){const t=Sd();pe(0,"tr")(1,"td"),Fe(2),me(),pe(3,"td"),Fe(4),me(),pe(5,"td"),Fe(6),me(),pe(7,"td"),Fe(8),me(),pe(9,"td"),Fe(10),me(),pe(11,"td"),Fe(12),me(),pe(13,"td"),Fe(14),me(),pe(15,"td"),Fe(16),W_(17,"date"),me(),pe(18,"td"),Fe(19),W_(20,"date"),me(),pe(21,"td"),Fe(22),me(),pe(23,"td"),Fe(24),me(),pe(25,"td")(26,"button",10),mn("click",function(){const d=yi(t).$implicit;return vi(Yn(2).editarContrato(d.id_contrato))}),Fe(27," Editar "),me()()()}if(2&e){const t=n.$implicit,r=Yn(2);$e(2),oi(t.id_contrato),$e(2),oi(t.id_usuario_contratante),$e(2),oi(t.id_contrato?r.nombreUsuarioContratistaLocal(t.id_contrato):""),$e(2),oi(t.estado),$e(2),oi(t.tipo_contrato),$e(2),oi(t.id_usuario_trabajador),$e(2),oi(t.id_contrato?r.nombreUsuarioTrabajdor(t.id_contrato):""),$e(2),oi(X_(17,12,t.fecha_inicio,"yyyy-MM-dd HH:mm:ss")),$e(3),oi(X_(20,15,t.fecha_fin,"yyyy-MM-dd HH:mm:ss")),$e(3),oi(t.descripcion),$e(2),oi(t.comentario),$e(2),At("disabled","CONTRATADO"!==t.estado)}}function Uj(e,n){if(1&e&&(pe(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),Fe(4,"Mis Contratos Vigentes"),me()(),pe(5,"div",6)(6,"table",7)(7,"thead",8)(8,"tr")(9,"th"),Fe(10,"ID-CONTRATO"),me(),pe(11,"th"),Fe(12,"ID CONTRATANTE"),me(),pe(13,"th"),Fe(14,"NOMBRE CONTRATANTE"),me(),pe(15,"th"),Fe(16,"ESTADO"),me(),pe(17,"th"),Fe(18,"TIPO CONTRATO"),me(),pe(19,"th"),Fe(20,"ID CONTRATADO"),me(),pe(21,"th"),Fe(22,"NOMBRE CONTRATANTE"),me(),pe(23,"th"),Fe(24,"FECHA INICIO"),me(),pe(25,"th"),Fe(26,"FECHA FIN"),me(),pe(27,"th"),Fe(28,"DESCRIPCION DEL TRABAJO"),me(),pe(29,"th"),Fe(30,"COMENTARIO"),me(),pe(31,"th"),Fe(32,"Acciones"),me()()(),pe(33,"tbody"),Qn(34,Vj,28,18,"tr",9),me()()()()()),2&e){const t=Yn();$e(34),At("ngForOf",t.contratos)}}function jj(e,n){if(1&e&&(pe(0,"option",29),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}function $j(e,n){if(1&e&&(pe(0,"option",29),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}function Hj(e,n){if(1&e){const t=Sd();pe(0,"div",11)(1,"h2"),Fe(2),me(),pe(3,"form",12),mn("ngSubmit",function(){return yi(t),vi(Yn().guardarEditContrato())}),pe(4,"input",13),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.id_contrato=l)}),me(),pe(5,"div",14)(6,"label"),Fe(7,"ID Usuario Contratante"),me(),pe(8,"input",15),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.id_usuario_contratante=l)}),me()(),pe(9,"div",14)(10,"label",16),Fe(11,"Estado"),me(),pe(12,"select",17),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.estado=l)}),Qn(13,jj,2,2,"option",18),me()(),pe(14,"div",14)(15,"label",19),Fe(16,"Tipo Contrato"),me(),pe(17,"select",20),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.tipo_contrato=l)}),Qn(18,$j,2,2,"option",18),me()(),pe(19,"div",14)(20,"label"),Fe(21,"ID Usuario Contratado"),me(),pe(22,"input",21),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.id_usuario_trabajador=l)}),me()(),pe(23,"div",14)(24,"label"),Fe(25,"Fecha Inicio"),me(),pe(26,"input",22),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.fecha_inicio=l)}),me()(),pe(27,"div",14)(28,"label"),Fe(29,"Fecha Fin"),me(),pe(30,"input",23),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.fecha_fin=l)}),me()(),pe(31,"div",14)(32,"label"),Fe(33,"Descripci\xf3n del trabajo"),me(),pe(34,"textarea",24),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.descripcion=l)}),me()(),pe(35,"div",14)(36,"label"),Fe(37,"Comentario"),me(),pe(38,"textarea",25),mn("ngModelChange",function(l){return yi(t),vi(Yn().contrato.comentario=l)}),me()(),pe(39,"div",26)(40,"button",27),Fe(41,"Guardar"),me(),pe(42,"button",28),mn("click",function(){return yi(t),vi(Yn().cancelar())}),Fe(43,"Cancelar"),me()()()()}if(2&e){const t=Yn();$e(2),x0("",t.contrato.id_contrato?"Editar":"Agregar"," Contrato # ",t.contrato.id_contrato,""),$e(2),At("ngModel",t.contrato.id_contrato),$e(4),At("ngModel",t.contrato.id_usuario_contratante),$e(4),At("ngModel",t.contrato.estado),$e(1),At("ngForOf",t.estadosContrato),$e(4),At("ngModel",t.contrato.tipo_contrato),$e(1),At("ngForOf",t.tiposContrato),$e(4),At("ngModel",t.contrato.id_usuario_trabajador),$e(4),At("ngModel",t.contrato.fecha_inicio),$e(4),At("ngModel",t.contrato.fecha_fin),$e(4),At("ngModel",t.contrato.descripcion),$e(4),At("ngModel",t.contrato.comentario)}}let Gj=(()=>{class e{constructor(t,r,l){this.contratoService=t,this.usuarioServices=r,this.selectores=l,this.contratosConNombres=[],this.contrato={id_contrato:0,id_usuario_contratante:0,estado:"",tipo_contrato:0,id_usuario_trabajador:0,fecha_inicio:"",fecha_fin:"",descripcion:"",comentario:""},this.editaContratoVisible=!1}ngOnInit(){this.estadosContrato=this.selectores.getEstadosContrato(),this.tiposContrato=this.selectores.getTiposContrato(),this.usuarioAdminSubscripcion=this.contratoAdminSubscription=this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t)}),this.contratosConNombres=[],this.contratoAdminSubscription=this.contratoService.consultaContratoUsuarioRelacionado(this.id_usuario).subscribe(t=>{t&&(this.contratos=t,this.cargarContratosConNombres())})}editarContrato(t){const r=this.contratos.find(l=>l.id_contrato===t);r&&(this.contrato={...r},this.contrato.fecha_inicio=new Date(this.contrato.fecha_inicio).toISOString().slice(0,19).replace("T"," "),this.contrato.fecha_fin=new Date(this.contrato.fecha_fin).toISOString().slice(0,19).replace("T"," "),this.editaContratoVisible=!0),this.editaContratoVisible=!0}guardarEditContrato(){if(this.contrato){const t=new Date(this.contrato.fecha_fin);this.contrato.fecha_fin=t.toISOString().slice(0,19).replace("T"," ")}this.contratoService.editarContrato(this.contrato).subscribe({next:t=>{this.mensaje="Contrato actualizada con \xe9xito";const r=this.contratos.findIndex(l=>l.id_contrato===this.contrato.id_contrato);-1!==r&&(this.contratos[r]=this.contrato)},error:t=>{this.mensaje="Actualizaci\xf3n  de contrato presenta inconvenientes: "+t}}),this.editaContratoVisible=!1}cargarContratosConNombres(){this.contratosConNombres=[],this.contratos.forEach(t=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_contratante).subscribe(r=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_trabajador).subscribe(l=>{this.contratosConNombres.push({id_contrato:t.id_contrato,id_usuario_contratante:t.id_usuario_contratante,nombre_usuario_contratante:r,id_usuario_trabajador:t.id_usuario_trabajador,nombre_usuario_trabajador:l})})})})}nombreUsuarioContratistaLocal(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_contratante||" "}nombreUsuarioTrabajdor(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_trabajador||" "}cancelar(){this.editaContratoVisible=!1}ngOnDestroy(){this.usuarioAdminSubscripcion&&this.usuarioAdminSubscripcion.unsubscribe(),this.contratoAdminSubscription&&this.contratoAdminSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(vE),Qe(Hc),Qe(ig))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-admincontrato"]],decls:2,vars:2,consts:[["id","listadoContrato","class","container mt-3",4,"ngIf"],["id","editar","class","container mt-3",4,"ngIf"],["id","listadoContrato",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"disabled","click"],["id","editar",1,"container","mt-3"],[3,"ngSubmit"],["type","hidden","name","id_contrato",3,"ngModel","ngModelChange"],[1,"form-group"],["name","id_usuario_contratante","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["for","estado"],["name","estado","required","",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","tipocontrato"],["name","tipocontrato","required","",1,"form-select",3,"ngModel","ngModelChange"],["name","id_usuario_trabajador","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["name","fecha_inicio","required","","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["name","fecha_fin","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","descripcion","required","","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["name","comentario","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","d-flex","justify-content-center","mt-3"],["type","submit",1,"btn","btn-primary","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"]],template:function(r,l){1&r&&(Qn(0,Uj,35,1,"div",0),Qn(1,Hj,44,13,"div",1)),2&r&&(At("ngIf",!l.editaContratoVisible),$e(1),At("ngIf",l.editaContratoVisible))},dependencies:[Dh,Uc,cp,up,hp,Iu,kh,Rh,ap,Oh,Lh,Ud,hw]})}return e})();function qj(e,n){if(1&e&&(pe(0,"tr")(1,"td"),Fe(2),me(),pe(3,"td"),Fe(4),me(),pe(5,"td"),Fe(6),me(),pe(7,"td"),Fe(8),me(),pe(9,"td"),Fe(10),me(),pe(11,"td"),Fe(12),me(),pe(13,"td"),Fe(14),me(),pe(15,"td"),Fe(16),W_(17,"date"),me(),pe(18,"td"),Fe(19),W_(20,"date"),me(),pe(21,"td"),Fe(22),me(),pe(23,"td"),Fe(24),me()()),2&e){const t=n.$implicit,r=Yn();$e(2),oi(t.id_contrato),$e(2),oi(t.id_usuario_contratante),$e(2),oi(t.id_contrato?r.nombreUsuarioContratistaLocal(t.id_contrato):""),$e(2),oi(t.estado),$e(2),oi(r.nombreTipoContrato(t.tipo_contrato)),$e(2),oi(t.id_usuario_trabajador),$e(2),oi(t.id_contrato?r.nombreUsuarioTrabajdor(t.id_contrato):""),$e(2),oi(X_(17,11,t.fecha_inicio,"yyyy-MM-dd HH:mm:ss")),$e(3),oi(X_(20,14,t.fecha_fin,"yyyy-MM-dd HH:mm:ss")),$e(3),oi(t.descripcion),$e(2),oi(t.comentario)}}let Zj=(()=>{class e{constructor(t,r){this.contratoService=t,this.usuarioServices=r,this.contratosConNombres=[],this.tiposContrato=[{id:1,nombre:"Por D\xeda"},{id:2,nombre:"Por Hora"},{id:3,nombre:"M\xe1s de 5 D\xedas"}]}ngOnInit(){this.usuarioContratoSubscripcion=this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t)}),this.contratosConNombres=[],this.contratoConsultaSubscription=this.contratoService.consultaContratoGeneralRelacionado(this.id_usuario).subscribe(t=>{t&&(this.contratos=t,this.cargarContratosConNombres())})}cargarContratosConNombres(){this.contratosConNombres=[],this.contratos.forEach(t=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_contratante).subscribe(r=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_trabajador).subscribe(l=>{this.contratosConNombres.push({id_contrato:t.id_contrato,id_usuario_contratante:t.id_usuario_contratante,nombre_usuario_contratante:r,id_usuario_trabajador:t.id_usuario_trabajador,nombre_usuario_trabajador:l})})})})}nombreUsuarioContratistaLocal(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_contratante||" "}nombreUsuarioTrabajdor(t){return this.contratosConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_trabajador||" "}nombreTipoContrato(t){const r=this.tiposContrato.find(l=>l.id===t);return r?r.nombre:"Desconocido"}ngOnDestroy(){this.usuarioContratoSubscripcion&&this.usuarioContratoSubscripcion.unsubscribe(),this.contratoConsultaSubscription&&this.contratoConsultaSubscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(vE),Qe(Hc))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-historico"]],decls:33,vars:1,consts:[["id","listadoContrato",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"]],template:function(r,l){1&r&&(pe(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),Fe(4,"Mis Contratos Historicos"),me()(),pe(5,"div",4)(6,"table",5)(7,"thead",6)(8,"tr")(9,"th"),Fe(10,"# CONTRATO"),me(),pe(11,"th"),Fe(12,"ID CONTRATANTE"),me(),pe(13,"th"),Fe(14,"NOMBRE CONTRATANTE"),me(),pe(15,"th"),Fe(16,"ESTADO"),me(),pe(17,"th"),Fe(18,"TIPO CONTRATO"),me(),pe(19,"th"),Fe(20,"ID CONTRATADO"),me(),pe(21,"th"),Fe(22,"NOMBRE CONTRATADO"),me(),pe(23,"th"),Fe(24,"FECHA INICIO"),me(),pe(25,"th"),Fe(26,"FECHA FIN"),me(),pe(27,"th"),Fe(28,"DESCRIPCION DEL TRABAJO"),me(),pe(29,"th"),Fe(30,"COMENTARIO"),me()()(),pe(31,"tbody"),Qn(32,qj,25,17,"tr",7),me()()()()()),2&r&&($e(32),At("ngForOf",l.contratos))},dependencies:[Dh,hw]})}return e})();function Wj(e,n){if(1&e){const t=Sd();pe(0,"tr")(1,"td"),Fe(2),me(),pe(3,"td"),Fe(4),me(),pe(5,"td"),Fe(6),me(),pe(7,"td"),Fe(8),me(),pe(9,"td"),Fe(10),me(),pe(11,"td")(12,"button",11),mn("click",function(){const d=yi(t).$implicit;return vi(Yn(2).editarCalificacion(d.id_calificacion))}),Fe(13," Calificar "),me()()()}if(2&e){const t=n.$implicit,r=Yn(2);$e(2),oi(t.id_calificacion),$e(2),oi(r.getNivelNombre(t.nivel_calificacion)),$e(2),oi(t.comentario),$e(2),oi(t.id_usuario_trabajador),$e(2),oi(t.id_contrato?r.nombreUsuarioTrabajador(t.id_contrato):"")}}function Xj(e,n){if(1&e&&(pe(0,"option",26),Fe(1),me()),2&e){const t=n.$implicit;At("value",t.id),$e(1),es(" ",t.nombre," ")}}function Yj(e,n){if(1&e){const t=Sd();pe(0,"div",12)(1,"h2"),Fe(2),me(),pe(3,"form",13),mn("ngSubmit",function(){return yi(t),vi(Yn(2).guardarCalificacion())}),pe(4,"input",14),mn("ngModelChange",function(l){return yi(t),vi(Yn(2).calificacionContrato.id_calificacion=l)}),me(),pe(5,"div",15)(6,"label",16),Fe(7,"Nivel Calificacion"),me(),pe(8,"select",17),mn("ngModelChange",function(l){return yi(t),vi(Yn(2).calificacionContrato.nivel_calificacion=l)}),pe(9,"option",18),Fe(10,"Seleccione un nivel"),me(),Qn(11,Xj,2,2,"option",19),me()(),pe(12,"div",15)(13,"label"),Fe(14,"Comentario"),me(),pe(15,"textarea",20),mn("ngModelChange",function(l){return yi(t),vi(Yn(2).calificacionContrato.comentario=l)}),me()(),pe(16,"div",15)(17,"label"),Fe(18,"ID Usuario Contratado"),me(),pe(19,"input",21),mn("ngModelChange",function(l){return yi(t),vi(Yn(2).calificacionContrato.id_usuario_trabajador=l)}),me()(),pe(20,"div",15)(21,"label"),Fe(22,"ID Contrato"),me(),pe(23,"textarea",22),mn("ngModelChange",function(l){return yi(t),vi(Yn(2).calificacionContrato.id_contrato=l)}),me()(),pe(24,"div",23)(25,"button",24),Fe(26,"Guardar"),me(),pe(27,"button",25),mn("click",function(){return yi(t),vi(Yn(2).cancelar())}),Fe(28,"Cancelar"),me()()()()}if(2&e){const t=Yn(2);$e(2),x0("",t.calificacionContrato.id_calificacion?"Editar":"Agregar"," Calificacion # ",t.calificacionContrato.id_calificacion,""),$e(2),At("ngModel",t.calificacionContrato.id_calificacion),$e(4),At("ngModel",t.calificacionContrato.nivel_calificacion)("disabled",!t.esEditar),$e(3),At("ngForOf",t.nivelesCalificacion),$e(4),At("ngModel",t.calificacionContrato.comentario)("disabled",!t.esEditar),$e(4),At("ngModel",t.calificacionContrato.id_usuario_trabajador),$e(4),At("ngModel",t.calificacionContrato.id_contrato),$e(2),At("disabled",!t.esEditar),$e(2),At("disabled",!t.esEditar)}}function Kj(e,n){if(1&e&&(pe(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),Fe(4,"Califica Tus Contratos"),me()(),pe(5,"div",6)(6,"table",7)(7,"thead",8)(8,"tr")(9,"th"),Fe(10,"RESE\xd1A N\xb0"),me(),pe(11,"th"),Fe(12,"NIVEL CALIFICACION"),me(),pe(13,"th"),Fe(14,"COMENTARIO"),me(),pe(15,"th"),Fe(16,"ID RESPONSABLE"),me(),pe(17,"th"),Fe(18,"RESPONSABLE DEL TRABAJO"),me(),pe(19,"th"),Fe(20,"ACCION"),me()()(),pe(21,"tbody"),Qn(22,Wj,14,5,"tr",9),me()()()(),Qn(23,Yj,29,12,"div",10),me()),2&e){const t=Yn();$e(22),At("ngForOf",t.listaCalificacionContrato),$e(1),At("ngIf",t.logeado)}}function Jj(e,n){if(1&e&&(pe(0,"tr")(1,"td"),Fe(2),me(),pe(3,"td"),Fe(4),me(),pe(5,"td"),Fe(6),me(),pe(7,"td"),Fe(8),me()()),2&e){const t=n.$implicit,r=Yn(2);$e(2),oi(t.id_calificacion),$e(2),oi(r.getNivelNombre(t.nivel_calificacion)),$e(2),oi(t.comentario),$e(2),oi(t.id_contrato?r.nombreUsuarioTrabajador(t.id_contrato):"")}}function Qj(e,n){if(1&e&&(pe(0,"div",27)(1,"div",3)(2,"div",4)(3,"h2",5),Fe(4,"Trabajos realizados localizados por esta aplicacion"),me()(),pe(5,"div",6)(6,"table",7)(7,"thead",8)(8,"tr")(9,"th"),Fe(10,"RESE\xd1A N\xb0"),me(),pe(11,"th"),Fe(12,"NIVEL CALIFICACION"),me(),pe(13,"th"),Fe(14,"COMENTARIO"),me(),pe(15,"th"),Fe(16,"RESPONSABLE"),me()()(),pe(17,"tbody"),Qn(18,Jj,9,4,"tr",9),me()()()()()),2&e){const t=Yn();$e(18),At("ngForOf",t.listaCalificacionContrato)}}let e4=(()=>{class e{constructor(t,r,l){this.calificacionService=t,this.usuarioServices=r,this.selectores=l,this.listaCalificacionContrato=[],this.contratosCalificadoConNombres=[],this.calificacionContrato={id_calificacion:0,nivel_calificacion:0,comentario:"",id_usuario_trabajador:0,id_contrato:0},this.logeado=!1,this.esEditar=!1}ngOnInit(){this.nivelesCalificacion=this.selectores.getNivelCalificacion(),this.usuarioServices.userId$.subscribe(t=>{this.usuarioServices.usuarioLoginOn&&(this.id_usuario=t,t>0?(this.logeado=!0,this.calificacionService.consultaCalificacionesContratante(this.id_usuario).subscribe({next:r=>{this.listaCalificacionContrato=r,this.cargarContratosConNombres()},error:r=>{this.mensaje="Lista de calificacion de contratistas no exiten: "+r}})):this.calificacionService.consultaCalificacionesGeneral().subscribe({next:r=>{console.log("Datos del Response:",r),this.listaCalificacionContrato=r,this.cargarContratosConNombres()},error:r=>{this.mensaje="Lista de calificacion general no exiten: "+r}}))})}cargarContratosConNombres(){this.contratosCalificadoConNombres=[],this.listaCalificacionContrato.forEach(t=>{this.usuarioServices.consultaNombreUsuario(t.id_usuario_trabajador).subscribe(r=>{this.contratosCalificadoConNombres.push({id_contrato:t.id_contrato,id_usuario_contratante:0,nombre_usuario_contratante:"",id_usuario_trabajador:t.id_usuario_trabajador,nombre_usuario_trabajador:r})})})}nombreUsuarioTrabajador(t){return this.contratosCalificadoConNombres.find(l=>l.id_contrato===t)?.nombre_usuario_trabajador||" "}editarCalificacion(t){const r=this.listaCalificacionContrato.find(l=>l.id_calificacion===t);r&&(this.calificacionContrato={...r},this.esEditar=!0)}guardarCalificacion(){this.calificacionContrato&&this.calificacionService.editarCalificacion({id_calificacion:this.calificacionContrato.id_calificacion,nivel_calificacion:this.calificacionContrato.nivel_calificacion,comentario:this.calificacionContrato.comentario}).subscribe({next:r=>{this.mensaje="Calificacion actualizada con \xe9xito";const l=this.listaCalificacionContrato.findIndex(d=>d.id_contrato===this.calificacionContrato.id_contrato);-1!==l&&(this.listaCalificacionContrato[l]=this.calificacionContrato),this.inicializaCalificacion(),this.esEditar=!1},error:r=>{this.mensaje="Actualizaci\xf3n  de contrato presenta inconvenientes: "}})}inicializaCalificacion(){this.calificacionContrato={id_calificacion:0,nivel_calificacion:0,comentario:"",id_usuario_trabajador:0,id_contrato:0}}cancelar(){this.inicializaCalificacion(),this.esEditar=!1}getNivelNombre(t){const r=this.nivelesCalificacion.find(l=>l.id===t);return r?r.nombre:"0 - No calificado"}ngOnDestroy(){}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(ZA),Qe(Hc),Qe(ig))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-califica-contrato"]],decls:2,vars:2,consts:[["id","listadoContrato","class","container mt-3",4,"ngIf"],["id","listadoContratoGeneral","class","container mt-3",4,"ngIf"],["id","listadoContrato",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"],["id","editar","class","container mt-3",4,"ngIf"],[1,"btn","btn-primary",3,"click"],["id","editar",1,"container","mt-3"],[3,"ngSubmit"],["type","hidden","name","id_calificacion",3,"ngModel","ngModelChange"],[1,"form-group"],["for","tipocontrato"],["name","nivelcalificacion","required","",1,"form-select",3,"ngModel","disabled","ngModelChange"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["name","comentario","required","",1,"form-control",3,"ngModel","disabled","ngModelChange"],["name","id_usuario_trabajador","disabled","true",1,"form-control",3,"ngModel","ngModelChange"],["name","id_contrato","required","","readonly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group","d-flex","justify-content-center","mt-3"],["type","submit",1,"btn","btn-primary","me-2",3,"disabled"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[3,"value"],["id","listadoContratoGeneral",1,"container","mt-3"]],template:function(r,l){1&r&&(Qn(0,Kj,24,2,"div",0),Qn(1,Qj,19,1,"div",1)),2&r&&(At("ngIf",l.logeado),$e(1),At("ngIf",!l.logeado))},dependencies:[Dh,Uc,cp,up,hp,Iu,kh,Rh,ap,Oh,Lh,Ud]})}return e})();function t4(e,n){if(1&e&&(pe(0,"tr")(1,"td"),Fe(2),me(),pe(3,"td"),Fe(4),me(),pe(5,"td"),Fe(6),me(),pe(7,"td"),Fe(8),me()()),2&e){const t=n.$implicit,r=Yn();$e(2),oi(r.nombre_usuario),$e(2),oi(r.getProfesionDescripcion(t.profesion)),$e(2),oi(t.tiempo_experiencia),$e(2),oi(t.introduccion)}}const n4=[{path:"",redirectTo:"/inicio",pathMatch:"full"},{path:"inicio",component:qA},{path:"inicio/:outsesion",component:qA},{path:"iniciar-sesion",component:TU},{path:"crear-contrato/:idcontratante/:idtrabajador",component:IU},{path:"ubicacion",component:Sj},{path:"registro",component:Bj},{path:"perfil",component:Lj},{path:"ver-perfil/:perfilTrabajador",component:(()=>{class e{constructor(t,r,l,d,y){this.perfilesServices=t,this.usuarioServices=r,this.selectores=l,this.router=d,this.route=y}ngOnInit(){this.router.params.subscribe(t=>{this.id_usuario=+t.perfilTrabajador,this.usuarioServices.consultaNombreUsuario(this.id_usuario).subscribe(r=>{this.nombre_usuario=r})}),this.profesiones=this.selectores.getAreProfesiones(),this.perfilesServices.obtenerPerfilesPorIdUsuario(`${this.id_usuario}`).subscribe(t=>{this.perfiles=t})}getProfesionDescripcion(t){const r=this.profesiones.find(l=>{if(l.id===t)return l});return r?r.nombre:"Desconocido"}cancelarRegistro(){this.route.navigate(["/inicio"])}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Qw),Qe(Hc),Qe(ig),Qe(Ih),Qe(_s))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-perfil-trabajador"]],decls:21,vars:1,consts:[["id","listadoConsultaPerfil",1,"container","mt-3"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-body"],[1,"table","table-striped"],[1,"thead-dark"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary","mb-3",3,"click"]],template:function(r,l){1&r&&(pe(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),Fe(4,"Perfil Laboral"),me()(),pe(5,"div",4)(6,"table",5)(7,"thead",6)(8,"tr")(9,"th"),Fe(10,"USUARIO"),me(),pe(11,"th"),Fe(12,"PROFESI\xd3N"),me(),pe(13,"th"),Fe(14,"EXPERIENCIA"),me(),pe(15,"th"),Fe(16,"DESCIPCI\xd3N LABORAL"),me()()(),pe(17,"tbody"),Qn(18,t4,9,4,"tr",7),me()(),pe(19,"button",8),mn("click",function(){return l.cancelarRegistro()}),Fe(20,"Regresar"),me()()()()),2&r&&($e(18),At("ngForOf",l.perfiles))},dependencies:[Dh]})}return e})()},{path:"admin-contrato",component:Gj},{path:"historico-contrato",component:Zj},{path:"califica-contrato",component:e4}];let i4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e});static#n=this.\u0275inj=Nr({imports:[TI.forRoot(n4),TI]})}return e})(),r4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=er({type:e,selectors:[["app-header"]],decls:6,vars:0,consts:[[1,"jumotron","bg-cover","text-white"],[1,"container","py-5","text-center"],[1,"display-4","font-weight-bold"]],template:function(r,l){1&r&&(pe(0,"header",0)(1,"div",1)(2,"h1",2),Fe(3,"Soluciones Inmediatas"),me(),pe(4,"h1",2),Fe(5,"Conectamos Expertos de su area."),me()()())},styles:["header[_ngcontent-%COMP%]{background:url(question-mark-1872665_640.fcfd18a32560cc9e.jpg)}"]})}return e})(),o4=(()=>{class e{getIconSvgPath(){return`assets/icons/${this.iconName}.svg`}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=er({type:e,selectors:[["app-icon"]],inputs:{iconName:"iconName"},decls:1,vars:2,consts:[[3,"src","alt"]],template:function(r,l){1&r&&wo(0,"img",0),2&r&&(n1("alt",l.iconName),At("src",l.getIconSvgPath(),pm))},styles:["a[_ngcontent-%COMP%]{text-decoration:none;display:inline-block;margin:0 10px}img[_ngcontent-%COMP%]{width:24px;height:auto}"]})}return e})(),s4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=er({type:e,selectors:[["app-footer"]],decls:20,vars:0,consts:[[1,"jumotron"],[1,"text-center","text-white"],[1,"container-fluid"],[1,"row","justify-content-center"],[1,"col-lg-8","mt-2"],[1,"text-center","mb-2"],["href","",1,"text-white","me-4"],["iconName","facebook-logo-svgrepo-com"],["iconName","twitter-social-logotype-svgrepo-com"],["iconName","google-logo-fill-svgrepo-com"],["iconName","instagram-logo-svgrepo-com"],["iconName","linkedin-logo-svgrepo-com"],["iconName","github-142-svgrepo-com"]],template:function(r,l){1&r&&(pe(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"p"),Fe(6," Este sitio tiene como objetivo facilitar la distribuci\xf3n laboral a corto plazo para personas sin trabajo fijo y emprendedores, sitio web sin fines de lucro "),me()()(),pe(7,"div",5)(8,"a",6),wo(9,"app-icon",7),me(),pe(10,"a",6),wo(11,"app-icon",8),me(),pe(12,"a",6),wo(13,"app-icon",9),me(),pe(14,"a",6),wo(15,"app-icon",10),me(),pe(16,"a",6),wo(17,"app-icon",11),me(),pe(18,"a",6),wo(19,"app-icon",12),me()()()()())},dependencies:[o4],styles:["footer[_ngcontent-%COMP%]{background-color:#646262}.app-footer[_ngcontent-%COMP%]{height:60px}"]})}return e})();function a4(e,n){1&e&&(pe(0,"li",7)(1,"a",11),Fe(2,"Inicio Sesi\xf3n"),me()())}function l4(e,n){1&e&&(pe(0,"li",7)(1,"a",12),Fe(2,"Registrarse"),me()())}function c4(e,n){1&e&&(pe(0,"li",7)(1,"a",13),Fe(2,"Mi Ubicaci\xf3n"),me()())}function u4(e,n){1&e&&(pe(0,"li",7)(1,"a",14),Fe(2,"Mi Perfil"),me()())}function h4(e,n){1&e&&(pe(0,"li",7)(1,"a",15),Fe(2,"Administrar Contratos Vigente"),me()())}function d4(e,n){1&e&&(pe(0,"li",7)(1,"a",16),Fe(2,"Contratos Hist\xf3rico"),me()())}const f4=function(){return{outsesion:"outsesion"}},p4=function(e){return["/inicio",e]};function m4(e,n){1&e&&(pe(0,"li",7)(1,"a",17),Fe(2,"Cerrar Sesi\xf3n"),me()()),2&e&&($e(1),At("routerLink",y1(2,p4,function aD(e,n,t){const r=ds()+e,l=vt();return l[r]===pn?bu(l,r,t?n.call(t):n()):function O_(e,n){return e[n]}(l,r)}(1,f4))))}let g4=(()=>{class e{constructor(t,r){this.usuarioServer=t,this.router=r,this.userLoginOn=!1}ngOnInit(){this.usuarioServer.currentUserLoginOn.subscribe({next:t=>{this.userLoginOn=t}})}static#e=this.\u0275fac=function(r){return new(r||e)(Qe(Hc),Qe(_s))};static#t=this.\u0275cmp=er({type:e,selectors:[["app-nav"]],decls:21,vars:7,consts:[[1,"navbar","navbar-expand-lg","bg-body-tertiary"],[1,"container-fluid"],[1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],[1,"nav-item"],["aria-current","page","routerLink","/inicio","routerLinkActive","active",1,"nav-link"],["class","nav-item",4,"ngIf"],["routerLink","/califica-contrato","aria-disabled","true","routerLinkActive","active",1,"nav-link"],["routerLink","/iniciar-sesion","routerLinkActive","active",1,"nav-link"],["routerLink","/registro","aria-disabled","true","routerLinkActive","active",1,"nav-link"],["routerLink","/ubicacion","aria-disabled","true","routerLinkActive","active",1,"nav-link"],["routerLink","/perfil","aria-disabled","true","routerLinkActive","active",1,"nav-link"],["routerLink","/admin-contrato","aria-disabled","true","routerLinkActive","active",1,"nav-link"],["routerLink","/historico-contrato","aria-disabled","true","routerLinkActive","active",1,"nav-link"],["aria-disabled","true",1,"nav-link",3,"routerLink"]],template:function(r,l){1&r&&(pe(0,"nav",0)(1,"div",1)(2,"a",2),Fe(3,"Localizador"),me(),pe(4,"button",3),wo(5,"span",4),me(),pe(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),Fe(10,"Inicio"),me()(),Qn(11,a4,3,0,"li",9),Qn(12,l4,3,0,"li",9),Qn(13,c4,3,0,"li",9),Qn(14,u4,3,0,"li",9),Qn(15,h4,3,0,"li",9),Qn(16,d4,3,0,"li",9),pe(17,"li",7)(18,"a",10),Fe(19,"Rese\xf1a de Servicios"),me()(),Qn(20,m4,3,4,"li",9),me()()()()),2&r&&($e(11),At("ngIf",!l.userLoginOn),$e(1),At("ngIf",!l.userLoginOn),$e(1),At("ngIf",l.userLoginOn),$e(1),At("ngIf",l.userLoginOn),$e(1),At("ngIf",l.userLoginOn),$e(1),At("ngIf",l.userLoginOn),$e(4),At("ngIf",l.userLoginOn))},dependencies:[Uc,px,_I],styles:["button[_ngcontent-%COMP%]:hover{background-color:#4caf50;color:#fff}"]})}return e})(),_4=(()=>{class e{constructor(){this.title="buscaPersonaFree"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=er({type:e,selectors:[["app-root"]],decls:7,vars:0,consts:[[1,"main-container"],[1,"content-wrapper"],[1,"app-footer"]],template:function(r,l){1&r&&(pe(0,"div",0),wo(1,"app-header")(2,"app-nav"),pe(3,"div",1),wo(4,"router-outlet"),me(),pe(5,"div",2),wo(6,"app-footer"),me()())},dependencies:[Vw,r4,s4,g4]})}return e})();const y4={url:"https://api-back-service-3uomm4d6da-uc.a.run.app",options:{}};let v4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Nn({type:e,bootstrap:[_4]});static#n=this.\u0275inj=Nr({imports:[rz,i4,hU,hV,vj.forRoot(y4),uU]})}return e})();nz().bootstrapModule(v4).catch(e=>console.error(e))},391:function(Zt,qt,ve){var gt;Zt=ve.nmd(Zt),function(Ue){"object"==typeof global&&global;var Ie=function(Ft){this.message=Ft};(Ie.prototype=new Error).name="InvalidCharacterError";var Le=function(Ft){throw new Ie(Ft)},Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Re=/[\t\n\f\r ]/g,Vt={encode:function(Ft){Ft=String(Ft),/[^\0-\xFF]/.test(Ft)&&Le("The string to be encoded contains characters outside of the Latin1 range.");for(var bt,Ge,ke,ze,Ot=Ft.length%3,he="",tt=-1,Nt=Ft.length-Ot;++tt<Nt;)bt=Ft.charCodeAt(tt)<<16,Ge=Ft.charCodeAt(++tt)<<8,ke=Ft.charCodeAt(++tt),he+=Ae.charAt((ze=bt+Ge+ke)>>18&63)+Ae.charAt(ze>>12&63)+Ae.charAt(ze>>6&63)+Ae.charAt(63&ze);return 2==Ot?(bt=Ft.charCodeAt(tt)<<8,Ge=Ft.charCodeAt(++tt),he+=Ae.charAt((ze=bt+Ge)>>10)+Ae.charAt(ze>>4&63)+Ae.charAt(ze<<2&63)+"="):1==Ot&&(ze=Ft.charCodeAt(tt),he+=Ae.charAt(ze>>2)+Ae.charAt(ze<<4&63)+"=="),he},decode:function(Ft){var Ot=(Ft=String(Ft).replace(Re,"")).length;Ot%4==0&&(Ot=(Ft=Ft.replace(/==?$/,"")).length),(Ot%4==1||/[^+a-zA-Z0-9/]/.test(Ft))&&Le("Invalid character: the string to be decoded is not correctly encoded.");for(var tt,bt,he=0,Ge="",ke=-1;++ke<Ot;)bt=Ae.indexOf(Ft.charAt(ke)),tt=he%4?64*tt+bt:bt,he++%4&&(Ge+=String.fromCharCode(255&tt>>(-2*he&6)));return Ge},version:"0.1.0"};void 0!==(gt=function(){return Vt}.call(qt,ve,qt,Zt))&&(Zt.exports=gt)}()},16:Zt=>{"use strict";var gt,qt="object"==typeof Reflect?Reflect:null,ve=qt&&"function"==typeof qt.apply?qt.apply:function(ke,at,ze){return Function.prototype.apply.call(ke,at,ze)};gt=qt&&"function"==typeof qt.ownKeys?qt.ownKeys:Object.getOwnPropertySymbols?function(ke){return Object.getOwnPropertyNames(ke).concat(Object.getOwnPropertySymbols(ke))}:function(ke){return Object.getOwnPropertyNames(ke)};var Me=Number.isNaN||function(ke){return ke!=ke};function u(){u.init.call(this)}Zt.exports=u,Zt.exports.once=function he(Ge,ke){return new Promise(function(at,ze){function Nt(kt){Ge.removeListener(ke,Wt),ze(kt)}function Wt(){"function"==typeof Ge.removeListener&&Ge.removeListener("error",Nt),at([].slice.call(arguments))}bt(Ge,ke,Wt,{once:!0}),"error"!==ke&&function tt(Ge,ke,at){"function"==typeof Ge.on&&bt(Ge,"error",ke,at)}(Ge,Nt,{once:!0})})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var Q=10;function Ie(Ge){if("function"!=typeof Ge)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ge)}function Le(Ge){return void 0===Ge._maxListeners?u.defaultMaxListeners:Ge._maxListeners}function Ae(Ge,ke,at,ze){var Nt,Wt,kt;if(Ie(at),void 0===(Wt=Ge._events)?(Wt=Ge._events=Object.create(null),Ge._eventsCount=0):(void 0!==Wt.newListener&&(Ge.emit("newListener",ke,at.listener?at.listener:at),Wt=Ge._events),kt=Wt[ke]),void 0===kt)kt=Wt[ke]=at,++Ge._eventsCount;else if("function"==typeof kt?kt=Wt[ke]=ze?[at,kt]:[kt,at]:ze?kt.unshift(at):kt.push(at),(Nt=Le(Ge))>0&&kt.length>Nt&&!kt.warned){kt.warned=!0;var Tn=new Error("Possible EventEmitter memory leak detected. "+kt.length+" "+String(ke)+" listeners added. Use emitter.setMaxListeners() to increase limit");Tn.name="MaxListenersExceededWarning",Tn.emitter=Ge,Tn.type=ke,Tn.count=kt.length,function Ue(Ge){console&&console.warn&&console.warn(Ge)}(Tn)}return Ge}function Re(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yt(Ge,ke,at){var ze={fired:!1,wrapFn:void 0,target:Ge,type:ke,listener:at},Nt=Re.bind(ze);return Nt.listener=at,ze.wrapFn=Nt,Nt}function Yt(Ge,ke,at){var ze=Ge._events;if(void 0===ze)return[];var Nt=ze[ke];return void 0===Nt?[]:"function"==typeof Nt?at?[Nt.listener||Nt]:[Nt]:at?function Ot(Ge){for(var ke=new Array(Ge.length),at=0;at<ke.length;++at)ke[at]=Ge[at].listener||Ge[at];return ke}(Nt):St(Nt,Nt.length)}function Vt(Ge){var ke=this._events;if(void 0!==ke){var at=ke[Ge];if("function"==typeof at)return 1;if(void 0!==at)return at.length}return 0}function St(Ge,ke){for(var at=new Array(ke),ze=0;ze<ke;++ze)at[ze]=Ge[ze];return at}function bt(Ge,ke,at,ze){if("function"==typeof Ge.on)ze.once?Ge.once(ke,at):Ge.on(ke,at);else{if("function"!=typeof Ge.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ge);Ge.addEventListener(ke,function Nt(Wt){ze.once&&Ge.removeEventListener(ke,Nt),at(Wt)})}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function(Ge){if("number"!=typeof Ge||Ge<0||Me(Ge))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ge+".");Q=Ge}}),u.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(ke){if("number"!=typeof ke||ke<0||Me(ke))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ke+".");return this._maxListeners=ke,this},u.prototype.getMaxListeners=function(){return Le(this)},u.prototype.emit=function(ke){for(var at=[],ze=1;ze<arguments.length;ze++)at.push(arguments[ze]);var Nt="error"===ke,Wt=this._events;if(void 0!==Wt)Nt=Nt&&void 0===Wt.error;else if(!Nt)return!1;if(Nt){var kt;if(at.length>0&&(kt=at[0]),kt instanceof Error)throw kt;var Tn=new Error("Unhandled error."+(kt?" ("+kt.message+")":""));throw Tn.context=kt,Tn}var ki=Wt[ke];if(void 0===ki)return!1;if("function"==typeof ki)ve(ki,this,at);else{var qi=ki.length,qr=St(ki,qi);for(ze=0;ze<qi;++ze)ve(qr[ze],this,at)}return!0},u.prototype.on=u.prototype.addListener=function(ke,at){return Ae(this,ke,at,!1)},u.prototype.prependListener=function(ke,at){return Ae(this,ke,at,!0)},u.prototype.once=function(ke,at){return Ie(at),this.on(ke,yt(this,ke,at)),this},u.prototype.prependOnceListener=function(ke,at){return Ie(at),this.prependListener(ke,yt(this,ke,at)),this},u.prototype.off=u.prototype.removeListener=function(ke,at){var ze,Nt,Wt,kt,Tn;if(Ie(at),void 0===(Nt=this._events))return this;if(void 0===(ze=Nt[ke]))return this;if(ze===at||ze.listener===at)0==--this._eventsCount?this._events=Object.create(null):(delete Nt[ke],Nt.removeListener&&this.emit("removeListener",ke,ze.listener||at));else if("function"!=typeof ze){for(Wt=-1,kt=ze.length-1;kt>=0;kt--)if(ze[kt]===at||ze[kt].listener===at){Tn=ze[kt].listener,Wt=kt;break}if(Wt<0)return this;0===Wt?ze.shift():function Ft(Ge,ke){for(;ke+1<Ge.length;ke++)Ge[ke]=Ge[ke+1];Ge.pop()}(ze,Wt),1===ze.length&&(Nt[ke]=ze[0]),void 0!==Nt.removeListener&&this.emit("removeListener",ke,Tn||at)}return this},u.prototype.removeAllListeners=function(ke){var at,ze,Nt;if(void 0===(ze=this._events))return this;if(void 0===ze.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==ze[ke]&&(0==--this._eventsCount?this._events=Object.create(null):delete ze[ke]),this;if(0===arguments.length){var kt,Wt=Object.keys(ze);for(Nt=0;Nt<Wt.length;++Nt)"removeListener"!==(kt=Wt[Nt])&&this.removeAllListeners(kt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(at=ze[ke]))this.removeListener(ke,at);else if(void 0!==at)for(Nt=at.length-1;Nt>=0;Nt--)this.removeListener(ke,at[Nt]);return this},u.prototype.listeners=function(ke){return Yt(this,ke,!0)},u.prototype.rawListeners=function(ke){return Yt(this,ke,!1)},u.listenerCount=function(Ge,ke){return"function"==typeof Ge.listenerCount?Ge.listenerCount(ke):Vt.call(Ge,ke)},u.prototype.listenerCount=Vt,u.prototype.eventNames=function(){return this._eventsCount>0?gt(this._events):[]}},424:Zt=>{var ve;Zt.exports=ve={},ve.simpleFilter=function(gt,Ue){return Ue.filter(function(Me){return ve.test(gt,Me)})},ve.test=function(gt,Ue){return null!==ve.match(gt,Ue)},ve.match=function(gt,Ue,Me){var Vt,u=0,Q=[],Ie=Ue.length,Le=0,Ae=0,Re=(Me=Me||{}).pre||"",yt=Me.post||"",Yt=Me.caseSensitive&&Ue||Ue.toLowerCase();gt=Me.caseSensitive&&gt||gt.toLowerCase();for(var St=0;St<Ie;St++)Vt=Ue[St],Yt[St]===gt[u]?(Vt=Re+Vt+yt,u+=1,Ae+=1+Ae):Ae=0,Le+=Ae,Q[Q.length]=Vt;return u===gt.length?(Le=Yt===gt?1/0:Le,{rendered:Q.join(""),score:Le}):null},ve.filter=function(gt,Ue,Me){return Ue&&0!==Ue.length?"string"!=typeof gt?Ue:(Me=Me||{},Ue.reduce(function(u,Q,Ie,Le){var Ae=Q;Me.extract&&(Ae=Me.extract(Q));var Re=ve.match(gt,Ae,Me);return null!=Re&&(u[u.length]={string:Re.rendered,score:Re.score,index:Ie,original:Q}),u},[]).sort(function(u,Q){return Q.score-u.score||u.index-Q.index})):[]}},433:function(Zt,qt){!function(ve){"use strict";function Ue(h){var x,M,k,U;for(M=1,k=arguments.length;M<k;M++)for(x in U=arguments[M])h[x]=U[x];return h}var Me=Object.create||function(){function h(){}return function(x){return h.prototype=x,new h}}();function u(h,x){var M=Array.prototype.slice;if(h.bind)return h.bind.apply(h,M.call(arguments,1));var k=M.call(arguments,2);return function(){return h.apply(x,k.length?k.concat(M.call(arguments)):arguments)}}var Q=0;function Ie(h){return"_leaflet_id"in h||(h._leaflet_id=++Q),h._leaflet_id}function Le(h,x,M){var k,U,X,we;return we=function(){k=!1,U&&(X.apply(M,U),U=!1)},X=function(){k?U=arguments:(h.apply(M,arguments),setTimeout(we,x),k=!0)},X}function Ae(h,x,M){var k=x[1],U=x[0],X=k-U;return h===k&&M?h:((h-U)%X+X)%X+U}function Re(){return!1}function yt(h,x){if(!1===x)return h;var M=Math.pow(10,void 0===x?6:x);return Math.round(h*M)/M}function Yt(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function Vt(h){return Yt(h).split(/\s+/)}function St(h,x){for(var M in Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?Me(h.options):{}),x)h.options[M]=x[M];return h.options}function Ft(h,x,M){var k=[];for(var U in h)k.push(encodeURIComponent(M?U.toUpperCase():U)+"="+encodeURIComponent(h[U]));return(x&&-1!==x.indexOf("?")?"&":"?")+k.join("&")}var Ot=/\{ *([\w_ -]+) *\}/g;function he(h,x){return h.replace(Ot,function(M,k){var U=x[k];if(void 0===U)throw new Error("No value provided for variable "+M);return"function"==typeof U&&(U=U(x)),U})}var tt=Array.isArray||function(h){return"[object Array]"===Object.prototype.toString.call(h)};function bt(h,x){for(var M=0;M<h.length;M++)if(h[M]===x)return M;return-1}var Ge="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ke(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var at=0;function ze(h){var x=+new Date,M=Math.max(0,16-(x-at));return at=x+M,window.setTimeout(h,M)}var Nt=window.requestAnimationFrame||ke("RequestAnimationFrame")||ze,Wt=window.cancelAnimationFrame||ke("CancelAnimationFrame")||ke("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function kt(h,x,M){if(!M||Nt!==ze)return Nt.call(window,u(h,x));h.call(x)}function Tn(h){h&&Wt.call(window,h)}var ki={__proto__:null,extend:Ue,create:Me,bind:u,get lastId(){return Q},stamp:Ie,throttle:Le,wrapNum:Ae,falseFn:Re,formatNum:yt,trim:Yt,splitWords:Vt,setOptions:St,getParamString:Ft,template:he,isArray:tt,indexOf:bt,emptyImageUrl:Ge,requestFn:Nt,cancelFn:Wt,requestAnimFrame:kt,cancelAnimFrame:Tn};function qi(){}qi.extend=function(h){var x=function(){St(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},M=x.__super__=this.prototype,k=Me(M);for(var U in k.constructor=x,x.prototype=k,this)Object.prototype.hasOwnProperty.call(this,U)&&"prototype"!==U&&"__super__"!==U&&(x[U]=this[U]);return h.statics&&Ue(x,h.statics),h.includes&&(function qr(h){if(!(typeof L>"u")&&L&&L.Mixin){h=tt(h)?h:[h];for(var x=0;x<h.length;x++)h[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(h.includes),Ue.apply(null,[k].concat(h.includes))),Ue(k,h),delete k.statics,delete k.includes,k.options&&(k.options=M.options?Me(M.options):{},Ue(k.options,h.options)),k._initHooks=[],k.callInitHooks=function(){if(!this._initHooksCalled){M.callInitHooks&&M.callInitHooks.call(this),this._initHooksCalled=!0;for(var X=0,we=k._initHooks.length;X<we;X++)k._initHooks[X].call(this)}},x},qi.include=function(h){var x=this.prototype.options;return Ue(this.prototype,h),h.options&&(this.prototype.options=x,this.mergeOptions(h.options)),this},qi.mergeOptions=function(h){return Ue(this.prototype.options,h),this},qi.addInitHook=function(h){var x=Array.prototype.slice.call(arguments,1),M="function"==typeof h?h:function(){this[h].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(M),this};var Er={on:function(h,x,M){if("object"==typeof h)for(var k in h)this._on(k,h[k],x);else for(var U=0,X=(h=Vt(h)).length;U<X;U++)this._on(h[U],x,M);return this},off:function(h,x,M){if(arguments.length)if("object"==typeof h)for(var k in h)this._off(k,h[k],x);else{h=Vt(h);for(var U=1===arguments.length,X=0,we=h.length;X<we;X++)U?this._off(h[X]):this._off(h[X],x,M)}else delete this._events;return this},_on:function(h,x,M,k){if("function"==typeof x){if(!1===this._listens(h,x,M)){M===this&&(M=void 0);var U={fn:x,ctx:M};k&&(U.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(U)}}else console.warn("wrong listener type: "+typeof x)},_off:function(h,x,M){var k,U,X;if(this._events&&(k=this._events[h])){if(1===arguments.length){if(this._firingCount)for(U=0,X=k.length;U<X;U++)k[U].fn=Re;return void delete this._events[h]}if("function"!=typeof x)return void console.warn("wrong listener type: "+typeof x);var we=this._listens(h,x,M);!1!==we&&(this._firingCount&&(k[we].fn=Re,this._events[h]=k=k.slice()),k.splice(we,1))}},fire:function(h,x,M){if(!this.listens(h,M))return this;var k=Ue({},x,{type:h,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var U=this._events[h];if(U){this._firingCount=this._firingCount+1||1;for(var X=0,we=U.length;X<we;X++){var qe=U[X],Oe=qe.fn;qe.once&&this.off(h,Oe,qe.ctx),Oe.call(qe.ctx||this,k)}this._firingCount--}}return M&&this._propagateEvent(k),this},listens:function(h,x,M,k){"string"!=typeof h&&console.warn('"string" type argument expected');var U=x;"function"!=typeof x&&(k=!!x,U=void 0,M=void 0);var X=this._events&&this._events[h];if(X&&X.length&&!1!==this._listens(h,U,M))return!0;if(k)for(var we in this._eventParents)if(this._eventParents[we].listens(h,x,M,k))return!0;return!1},_listens:function(h,x,M){if(!this._events)return!1;var k=this._events[h]||[];if(!x)return!!k.length;M===this&&(M=void 0);for(var U=0,X=k.length;U<X;U++)if(k[U].fn===x&&k[U].ctx===M)return U;return!1},once:function(h,x,M){if("object"==typeof h)for(var k in h)this._on(k,h[k],x,!0);else for(var U=0,X=(h=Vt(h)).length;U<X;U++)this._on(h[U],x,M,!0);return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[Ie(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[Ie(h)],this},_propagateEvent:function(h){for(var x in this._eventParents)this._eventParents[x].fire(h.type,Ue({layer:h.target,propagatedFrom:h.target},h),!0)}};Er.addEventListener=Er.on,Er.removeEventListener=Er.clearAllEventListeners=Er.off,Er.addOneTimeEventListener=Er.once,Er.fireEvent=Er.fire,Er.hasEventListeners=Er.listens;var Dn=qi.extend(Er);function En(h,x,M){this.x=M?Math.round(h):h,this.y=M?Math.round(x):x}var rr=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};function dn(h,x,M){return h instanceof En?h:tt(h)?new En(h[0],h[1]):null==h?h:"object"==typeof h&&"x"in h&&"y"in h?new En(h.x,h.y):new En(h,x,M)}function In(h,x){if(h)for(var M=x?[h,x]:h,k=0,U=M.length;k<U;k++)this.extend(M[k])}function si(h,x){return!h||h instanceof In?h:new In(h,x)}function Zi(h,x){if(h)for(var M=x?[h,x]:h,k=0,U=M.length;k<U;k++)this.extend(M[k])}function Oi(h,x){return h instanceof Zi?h:new Zi(h,x)}function li(h,x,M){if(isNaN(h)||isNaN(x))throw new Error("Invalid LatLng object: ("+h+", "+x+")");this.lat=+h,this.lng=+x,void 0!==M&&(this.alt=+M)}function Mn(h,x,M){return h instanceof li?h:tt(h)&&"object"!=typeof h[0]?3===h.length?new li(h[0],h[1],h[2]):2===h.length?new li(h[0],h[1]):null:null==h?h:"object"==typeof h&&"lat"in h?new li(h.lat,"lng"in h?h.lng:h.lon,h.alt):void 0===x?null:new li(h,x,M)}En.prototype={clone:function(){return new En(this.x,this.y)},add:function(h){return this.clone()._add(dn(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(dn(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new En(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new En(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=rr(this.x),this.y=rr(this.y),this},distanceTo:function(h){var x=(h=dn(h)).x-this.x,M=h.y-this.y;return Math.sqrt(x*x+M*M)},equals:function(h){return(h=dn(h)).x===this.x&&h.y===this.y},contains:function(h){return h=dn(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+yt(this.x)+", "+yt(this.y)+")"}},In.prototype={extend:function(h){var x,M;if(!h)return this;if(h instanceof En||"number"==typeof h[0]||"x"in h)x=M=dn(h);else if(M=(h=si(h)).max,!(x=h.min)||!M)return this;return this.min||this.max?(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(M.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(M.y,this.max.y)):(this.min=x.clone(),this.max=M.clone()),this},getCenter:function(h){return dn((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return dn(this.min.x,this.max.y)},getTopRight:function(){return dn(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var x,M;return(h="number"==typeof h[0]||h instanceof En?dn(h):si(h))instanceof In?(x=h.min,M=h.max):x=M=h,x.x>=this.min.x&&M.x<=this.max.x&&x.y>=this.min.y&&M.y<=this.max.y},intersects:function(h){h=si(h);var x=this.min,M=this.max,k=h.min,U=h.max;return U.x>=x.x&&k.x<=M.x&&U.y>=x.y&&k.y<=M.y},overlaps:function(h){h=si(h);var x=this.min,M=this.max,k=h.min,U=h.max;return U.x>x.x&&k.x<M.x&&U.y>x.y&&k.y<M.y},isValid:function(){return!(!this.min||!this.max)},pad:function(h){var x=this.min,M=this.max,k=Math.abs(x.x-M.x)*h,U=Math.abs(x.y-M.y)*h;return si(dn(x.x-k,x.y-U),dn(M.x+k,M.y+U))},equals:function(h){return!!h&&(h=si(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight()))}},Zi.prototype={extend:function(h){var k,U,x=this._southWest,M=this._northEast;if(h instanceof li)k=h,U=h;else{if(!(h instanceof Zi))return h?this.extend(Mn(h)||Oi(h)):this;if(U=h._northEast,!(k=h._southWest)||!U)return this}return x||M?(x.lat=Math.min(k.lat,x.lat),x.lng=Math.min(k.lng,x.lng),M.lat=Math.max(U.lat,M.lat),M.lng=Math.max(U.lng,M.lng)):(this._southWest=new li(k.lat,k.lng),this._northEast=new li(U.lat,U.lng)),this},pad:function(h){var x=this._southWest,M=this._northEast,k=Math.abs(x.lat-M.lat)*h,U=Math.abs(x.lng-M.lng)*h;return new Zi(new li(x.lat-k,x.lng-U),new li(M.lat+k,M.lng+U))},getCenter:function(){return new li((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new li(this.getNorth(),this.getWest())},getSouthEast:function(){return new li(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){h="number"==typeof h[0]||h instanceof li||"lat"in h?Mn(h):Oi(h);var k,U,x=this._southWest,M=this._northEast;return h instanceof Zi?(k=h.getSouthWest(),U=h.getNorthEast()):k=U=h,k.lat>=x.lat&&U.lat<=M.lat&&k.lng>=x.lng&&U.lng<=M.lng},intersects:function(h){h=Oi(h);var x=this._southWest,M=this._northEast,k=h.getSouthWest(),U=h.getNorthEast();return U.lat>=x.lat&&k.lat<=M.lat&&U.lng>=x.lng&&k.lng<=M.lng},overlaps:function(h){h=Oi(h);var x=this._southWest,M=this._northEast,k=h.getSouthWest(),U=h.getNorthEast();return U.lat>x.lat&&k.lat<M.lat&&U.lng>x.lng&&k.lng<M.lng},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,x){return!!h&&(h=Oi(h),this._southWest.equals(h.getSouthWest(),x)&&this._northEast.equals(h.getNorthEast(),x))},isValid:function(){return!(!this._southWest||!this._northEast)}},li.prototype={equals:function(h,x){return!!h&&(h=Mn(h),Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng))<=(void 0===x?1e-9:x))},toString:function(h){return"LatLng("+yt(this.lat,h)+", "+yt(this.lng,h)+")"},distanceTo:function(h){return di.distance(this,Mn(h))},wrap:function(){return di.wrapLatLng(this)},toBounds:function(h){var x=180*h/40075017,M=x/Math.cos(Math.PI/180*this.lat);return Oi([this.lat-x,this.lng-M],[this.lat+x,this.lng+M])},clone:function(){return new li(this.lat,this.lng,this.alt)}};var h,Zr={latLngToPoint:function(h,x){var M=this.projection.project(h),k=this.scale(x);return this.transformation._transform(M,k)},pointToLatLng:function(h,x){var M=this.scale(x),k=this.transformation.untransform(h,M);return this.projection.unproject(k)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var x=this.projection.bounds,M=this.scale(h);return new In(this.transformation.transform(x.min,M),this.transformation.transform(x.max,M))},infinite:!1,wrapLatLng:function(h){var x=this.wrapLng?Ae(h.lng,this.wrapLng,!0):h.lng;return new li(this.wrapLat?Ae(h.lat,this.wrapLat,!0):h.lat,x,h.alt)},wrapLatLngBounds:function(h){var x=h.getCenter(),M=this.wrapLatLng(x),k=x.lat-M.lat,U=x.lng-M.lng;if(0===k&&0===U)return h;var X=h.getSouthWest(),we=h.getNorthEast();return new Zi(new li(X.lat-k,X.lng-U),new li(we.lat-k,we.lng-U))}},di=Ue({},Zr,{wrapLng:[-180,180],R:6371e3,distance:function(h,x){var M=Math.PI/180,k=h.lat*M,U=x.lat*M,X=Math.sin((x.lat-h.lat)*M/2),we=Math.sin((x.lng-h.lng)*M/2),qe=X*X+Math.cos(k)*Math.cos(U)*we*we,Oe=2*Math.atan2(Math.sqrt(qe),Math.sqrt(1-qe));return this.R*Oe}}),ln={R:6378137,MAX_LATITUDE:85.0511287798,project:function(h){var x=Math.PI/180,M=this.MAX_LATITUDE,k=Math.max(Math.min(M,h.lat),-M),U=Math.sin(k*x);return new En(this.R*h.lng*x,this.R*Math.log((1+U)/(1-U))/2)},unproject:function(h){var x=180/Math.PI;return new li((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*x,h.x*x/this.R)},bounds:(h=6378137*Math.PI,new In([-h,-h],[h,h]))};function is(h,x,M,k){if(tt(h))return this._a=h[0],this._b=h[1],this._c=h[2],void(this._d=h[3]);this._a=h,this._b=x,this._c=M,this._d=k}function An(h,x,M,k){return new is(h,x,M,k)}is.prototype={transform:function(h,x){return this._transform(h.clone(),x)},_transform:function(h,x){return h.x=(x=x||1)*(this._a*h.x+this._b),h.y=x*(this._c*h.y+this._d),h},untransform:function(h,x){return new En((h.x/(x=x||1)-this._b)/this._a,(h.y/x-this._d)/this._c)}};var Ns=Ue({},di,{code:"EPSG:3857",projection:ln,transformation:function(){var h=.5/(Math.PI*ln.R);return An(h,.5,-h,.5)}()}),Ji=Ue({},Ns,{code:"EPSG:900913"});function go(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function sc(h,x){var k,U,X,we,qe,Oe,M="";for(k=0,X=h.length;k<X;k++){for(U=0,we=(qe=h[k]).length;U<we;U++)M+=(U?"L":"M")+(Oe=qe[U]).x+" "+Oe.y;M+=x?Bt.svg?"z":"x":""}return M||"M0 0"}var rs=document.documentElement.style,no="ActiveXObject"in window,qc=no&&!document.addEventListener,Ml="msLaunchUri"in navigator&&!("documentMode"in document),Sl=Sn("webkit"),ya=Sn("android"),Ya=Sn("android 2")||Sn("android 3"),ac=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Zc=ya&&Sn("Google")&&ac<537&&!("AudioNode"in window),io=!!window.opera,Fs=!Ml&&Sn("chrome"),va=Sn("gecko")&&!Sl&&!io&&!no,xa=!Fs&&Sn("safari"),Ka=Sn("phantom"),Il="OTransition"in rs,Ja=0===navigator.platform.indexOf("Win"),ro=no&&"transition"in rs,ys="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ya,ba="MozPerspective"in rs,Qa=!window.L_DISABLE_3D&&(ro||ys||ba)&&!Il&&!Ka,wa=typeof orientation<"u"||Sn("mobile"),fe=wa&&Sl,Z=wa&&ys,Y=!window.PointerEvent&&window.MSPointerEvent,ue=!(!window.PointerEvent&&!Y),xe="ontouchstart"in window||!!window.TouchEvent,Se=!window.L_NO_TOUCH&&(xe||ue),Ve=wa&&io,Be=wa&&va,De=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Je=function(){var h=!1;try{var x=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",Re,x),window.removeEventListener("testPassiveEventSupport",Re,x)}catch{}return h}(),Rt=!!document.createElement("canvas").getContext,zt=!(!document.createElementNS||!go("svg").createSVGRect),Ct=!!zt&&function(){var h=document.createElement("div");return h.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(h.firstChild&&h.firstChild.namespaceURI)}(),kn=!zt&&function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var x=h.firstChild;return x.style.behavior="url(#default#VML)",x&&"object"==typeof x.adj}catch{return!1}}();function Sn(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var Bt={ie:no,ielt9:qc,edge:Ml,webkit:Sl,android:ya,android23:Ya,androidStock:Zc,opera:io,chrome:Fs,gecko:va,safari:xa,phantom:Ka,opera12:Il,win:Ja,ie3d:ro,webkit3d:ys,gecko3d:ba,any3d:Qa,mobile:wa,mobileWebkit:fe,mobileWebkit3d:Z,msPointer:Y,pointer:ue,touch:Se,touchNative:xe,mobileOpera:Ve,mobileGecko:Be,retina:De,passiveEvents:Je,canvas:Rt,svg:zt,vml:kn,inlineSvg:Ct,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Ui=Bt.msPointer?"MSPointerDown":"pointerdown",pr=Bt.msPointer?"MSPointerMove":"pointermove",Mi=Bt.msPointer?"MSPointerUp":"pointerup",Cr=Bt.msPointer?"MSPointerCancel":"pointercancel",jo={touchstart:Ui,touchmove:pr,touchend:Mi,touchcancel:Cr},Lr={touchstart:function zs(h,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&Ci(x),oo(h,x)},touchmove:oo,touchend:oo,touchcancel:oo},Mr={},Ea=!1;function Hd(h,x,M){return"touchstart"===x&&function Ca(){Ea||(document.addEventListener(Ui,Kn,!0),document.addEventListener(pr,Ru,!0),document.addEventListener(Mi,vr,!0),document.addEventListener(Cr,vr,!0),Ea=!0)}(),Lr[x]?(M=Lr[x].bind(this,M),h.addEventListener(jo[x],M,!1),M):(console.warn("wrong event specified:",x),Re)}function Kn(h){Mr[h.pointerId]=h}function Ru(h){Mr[h.pointerId]&&(Mr[h.pointerId]=h)}function vr(h){delete Mr[h.pointerId]}function oo(h,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){for(var M in x.touches=[],Mr)x.touches.push(Mr[M]);x.changedTouches=[x],h(x)}}var Lu=200;var gi,ar,Po,tl,$s,_o=Wi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Vs=Wi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),it="webkitTransition"===Vs||"OTransition"===Vs?Vs+"End":"transitionend";function os(h){return"string"==typeof h?document.getElementById(h):h}function Qi(h,x){var M=h.style[x]||h.currentStyle&&h.currentStyle[x];if((!M||"auto"===M)&&document.defaultView){var k=document.defaultView.getComputedStyle(h,null);M=k?k[x]:null}return"auto"===M?null:M}function On(h,x,M){var k=document.createElement(h);return k.className=x||"",M&&M.appendChild(k),k}function or(h){var x=h.parentNode;x&&x.removeChild(h)}function Ao(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Us(h){var x=h.parentNode;x&&x.lastChild!==h&&x.appendChild(h)}function el(h){var x=h.parentNode;x&&x.firstChild!==h&&x.insertBefore(h,x.firstChild)}function Da(h,x){if(void 0!==h.classList)return h.classList.contains(x);var M=fn(h);return M.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(M)}function ot(h,x){if(void 0!==h.classList)for(var M=Vt(x),k=0,U=M.length;k<U;k++)h.classList.add(M[k]);else if(!Da(h,x)){var X=fn(h);gn(h,(X?X+" ":"")+x)}}function vn(h,x){void 0!==h.classList?h.classList.remove(x):gn(h,Yt((" "+fn(h)+" ").replace(" "+x+" "," ")))}function gn(h,x){void 0===h.className.baseVal?h.className=x:h.className.baseVal=x}function fn(h){return h.correspondingElement&&(h=h.correspondingElement),void 0===h.className.baseVal?h.className:h.className.baseVal}function sr(h,x){"opacity"in h.style?h.style.opacity=x:"filter"in h.style&&function qn(h,x){var M=!1,k="DXImageTransform.Microsoft.Alpha";try{M=h.filters.item(k)}catch{if(1===x)return}x=Math.round(100*x),M?(M.Enabled=100!==x,M.Opacity=x):h.style.filter+=" progid:"+k+"(opacity="+x+")"}(h,x)}function Wi(h){for(var x=document.documentElement.style,M=0;M<h.length;M++)if(h[M]in x)return h[M];return!1}function ss(h,x,M){var k=x||new En(0,0);h.style[_o]=(Bt.ie3d?"translate("+k.x+"px,"+k.y+"px)":"translate3d("+k.x+"px,"+k.y+"px,0)")+(M?" scale("+M+")":"")}function Xi(h,x){h._leaflet_pos=x,Bt.any3d?ss(h,x):(h.style.left=x.x+"px",h.style.top=x.y+"px")}function jn(h){return h._leaflet_pos||new En(0,0)}if("onselectstart"in document)gi=function(){on(window,"selectstart",Ci)},ar=function(){ai(window,"selectstart",Ci)};else{var js=Wi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);gi=function(){if(js){var h=document.documentElement.style;Po=h[js],h[js]="none"}},ar=function(){js&&(document.documentElement.style[js]=Po,Po=void 0)}}function Ei(){on(window,"dragstart",Ci)}function Pn(){ai(window,"dragstart",Ci)}function Al(h){for(;-1===h.tabIndex;)h=h.parentNode;h.style&&(Ma(),tl=h,$s=h.style.outlineStyle,h.style.outlineStyle="none",on(window,"keydown",Ma))}function Ma(){tl&&(tl.style.outlineStyle=$s,tl=void 0,$s=void 0,ai(window,"keydown",Ma))}function Mt(h){do{h=h.parentNode}while(!(h.offsetWidth&&h.offsetHeight||h===document.body));return h}function kr(h){var x=h.getBoundingClientRect();return{x:x.width/h.offsetWidth||1,y:x.height/h.offsetHeight||1,boundingClientRect:x}}var cn={__proto__:null,TRANSFORM:_o,TRANSITION:Vs,TRANSITION_END:it,get:os,getStyle:Qi,create:On,remove:or,empty:Ao,toFront:Us,toBack:el,hasClass:Da,addClass:ot,removeClass:vn,setClass:gn,getClass:fn,setOpacity:sr,testProp:Wi,setTransform:ss,setPosition:Xi,getPosition:jn,get disableTextSelection(){return gi},get enableTextSelection(){return ar},disableImageDrag:Ei,enableImageDrag:Pn,preventOutline:Al,restoreOutline:Ma,getSizedParentNode:Mt,getScale:kr};function on(h,x,M,k){if(x&&"object"==typeof x)for(var U in x)Or(h,U,x[U],M);else for(var X=0,we=(x=Vt(x)).length;X<we;X++)Or(h,x[X],M,k);return this}var $o="_leaflet_events";function ai(h,x,M,k){if(1===arguments.length)Ro(h),delete h[$o];else if(x&&"object"==typeof x)for(var U in x)lr(h,U,x[U],M);else if(x=Vt(x),2===arguments.length)Ro(h,function(qe){return-1!==bt(x,qe)});else for(var X=0,we=x.length;X<we;X++)lr(h,x[X],M,k);return this}function Ro(h,x){for(var M in h[$o]){var k=M.split(/\d/)[0];(!x||x(k))&&lr(h,k,null,null,M)}}var Pl={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Or(h,x,M,k){var U=x+Ie(M)+(k?"_"+Ie(k):"");if(h[$o]&&h[$o][U])return this;var X=function(qe){return M.call(k||h,qe||window.event)},we=X;!Bt.touchNative&&Bt.pointer&&0===x.indexOf("touch")?X=Hd(h,x,X):Bt.touch&&"dblclick"===x?X=function lc(h,x){h.addEventListener("dblclick",x);var k,M=0;function U(X){if(1===X.detail){if("mouse"!==X.pointerType&&(!X.sourceCapabilities||X.sourceCapabilities.firesTouchEvents)){var we=ku(X);if(!we.some(function(Oe){return Oe instanceof HTMLLabelElement&&Oe.attributes.for})||we.some(function(Oe){return Oe instanceof HTMLInputElement||Oe instanceof HTMLSelectElement})){var qe=Date.now();qe-M<=Lu?2==++k&&x(function Bs(h){var M,k,x={};for(k in h)x[k]=(M=h[k])&&M.bind?M.bind(h):M;return h=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}(X)):k=1,M=qe}}}else k=X.detail}return h.addEventListener("click",U),{dblclick:x,simDblclick:U}}(h,X):"addEventListener"in h?"touchstart"===x||"touchmove"===x||"wheel"===x||"mousewheel"===x?h.addEventListener(Pl[x]||x,X,!!Bt.passiveEvents&&{passive:!1}):"mouseenter"===x||"mouseleave"===x?h.addEventListener(Pl[x],X=function(qe){qe=qe||window.event,Ou(h,qe)&&we(qe)},!1):h.addEventListener(x,we,!1):h.attachEvent("on"+x,X),h[$o]=h[$o]||{},h[$o][U]=X}function lr(h,x,M,k,U){U=U||x+Ie(M)+(k?"_"+Ie(k):"");var X=h[$o]&&h[$o][U];if(!X)return this;!Bt.touchNative&&Bt.pointer&&0===x.indexOf("touch")?function Nh(h,x,M){jo[x]?h.removeEventListener(jo[x],M,!1):console.warn("wrong event specified:",x)}(h,x,X):Bt.touch&&"dblclick"===x?function Ta(h,x){h.removeEventListener("dblclick",x.dblclick),h.removeEventListener("click",x.simDblclick)}(h,X):"removeEventListener"in h?h.removeEventListener(Pl[x]||x,X,!1):h.detachEvent("on"+x,X),h[$o][U]=null}function as(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function Wc(h){return Or(h,"wheel",as),this}function Wr(h){return on(h,"mousedown touchstart dblclick contextmenu",as),h._leaflet_disable_click=!0,this}function Ci(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function Sa(h){return Ci(h),as(h),this}function ku(h){if(h.composedPath)return h.composedPath();for(var x=[],M=h.target;M;)x.push(M),M=M.parentNode;return x}function Hs(h,x){if(!x)return new En(h.clientX,h.clientY);var M=kr(x),k=M.boundingClientRect;return new En((h.clientX-k.left)/M.x-x.clientLeft,(h.clientY-k.top)/M.y-x.clientTop)}var Ia=Bt.linux&&Bt.chrome?window.devicePixelRatio:Bt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Xc(h){return Bt.edge?h.wheelDeltaY/2:h.deltaY&&0===h.deltaMode?-h.deltaY/Ia:h.deltaY&&1===h.deltaMode?20*-h.deltaY:h.deltaY&&2===h.deltaMode?60*-h.deltaY:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?20*-h.detail:h.detail?h.detail/-32765*60:0}function Ou(h,x){var M=x.relatedTarget;if(!M)return!0;try{for(;M&&M!==h;)M=M.parentNode}catch{return!1}return M!==h}var Fh={__proto__:null,on,off:ai,stopPropagation:as,disableScrollPropagation:Wc,disableClickPropagation:Wr,preventDefault:Ci,stop:Sa,getPropagationPath:ku,getMousePosition:Hs,getWheelDelta:Xc,isExternalTarget:Ou,addListener:on,removeListener:ai},Ur=Dn.extend({run:function(h,x,M,k){this.stop(),this._el=h,this._inProgress=!0,this._duration=M||.25,this._easeOutPower=1/Math.max(k||.5,.2),this._startPos=jn(h),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=kt(this._animate,this),this._step()},_step:function(h){var x=+new Date-this._startTime,M=1e3*this._duration;x<M?this._runFrame(this._easeOut(x/M),h):(this._runFrame(1),this._complete())},_runFrame:function(h,x){var M=this._startPos.add(this._offset.multiplyBy(h));x&&M._round(),Xi(this._el,M),this.fire("step")},_complete:function(){Tn(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),jt=Dn.extend({options:{crs:Ns,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,x){x=St(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),void 0!==x.zoom&&(this._zoom=this._limitZoom(x.zoom)),x.center&&void 0!==x.zoom&&this.setView(Mn(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Vs&&Bt.any3d&&!Bt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),on(this._proxy,it,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,x,M){return x=void 0===x?this._zoom:this._limitZoom(x),h=this._limitCenter(Mn(h),x,this.options.maxBounds),M=M||{},this._stop(),this._loaded&&!M.reset&&!0!==M&&(void 0!==M.animate&&(M.zoom=Ue({animate:M.animate},M.zoom),M.pan=Ue({animate:M.animate,duration:M.duration},M.pan)),this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,x,M.zoom):this._tryAnimatedPan(h,M.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(h,x,M.pan&&M.pan.noMoveStart),this)},setZoom:function(h,x){return this._loaded?this.setView(this.getCenter(),h,{zoom:x}):(this._zoom=h,this)},zoomIn:function(h,x){return this.setZoom(this._zoom+(h=h||(Bt.any3d?this.options.zoomDelta:1)),x)},zoomOut:function(h,x){return this.setZoom(this._zoom-(h=h||(Bt.any3d?this.options.zoomDelta:1)),x)},setZoomAround:function(h,x,M){var k=this.getZoomScale(x),U=this.getSize().divideBy(2),we=(h instanceof En?h:this.latLngToContainerPoint(h)).subtract(U).multiplyBy(1-1/k),qe=this.containerPointToLatLng(U.add(we));return this.setView(qe,x,{zoom:M})},_getBoundsCenterZoom:function(h,x){x=x||{},h=h.getBounds?h.getBounds():Oi(h);var M=dn(x.paddingTopLeft||x.padding||[0,0]),k=dn(x.paddingBottomRight||x.padding||[0,0]),U=this.getBoundsZoom(h,!1,M.add(k));if((U="number"==typeof x.maxZoom?Math.min(x.maxZoom,U):U)===1/0)return{center:h.getCenter(),zoom:U};var X=k.subtract(M).divideBy(2),we=this.project(h.getSouthWest(),U),qe=this.project(h.getNorthEast(),U);return{center:this.unproject(we.add(qe).divideBy(2).add(X),U),zoom:U}},fitBounds:function(h,x){if(!(h=Oi(h)).isValid())throw new Error("Bounds are not valid.");var M=this._getBoundsCenterZoom(h,x);return this.setView(M.center,M.zoom,x)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,x){return this.setView(h,this._zoom,{pan:x})},panBy:function(h,x){if(x=x||{},!(h=dn(h).round()).x&&!h.y)return this.fire("moveend");if(!0!==x.animate&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ur,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),!1!==x.animate){ot(this._mapPane,"leaflet-pan-anim");var M=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,M,x.duration||.25,x.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,x,M){if(!1===(M=M||{}).animate||!Bt.any3d)return this.setView(h,x,M);this._stop();var k=this.project(this.getCenter()),U=this.project(h),X=this.getSize(),we=this._zoom;h=Mn(h),x=void 0===x?we:x;var qe=Math.max(X.x,X.y),Oe=qe*this.getZoomScale(we,x),Tt=U.distanceTo(k)||1,rn=1.42,bn=rn*rn;function xn(hr){var fl=(Oe*Oe-qe*qe+(hr?-1:1)*bn*bn*Tt*Tt)/(2*(hr?Oe:qe)*bn*Tt),zr=Math.sqrt(fl*fl+1)-fl;return zr<1e-9?-18:Math.log(zr)}function Fr(hr){return(Math.exp(hr)-Math.exp(-hr))/2}function ur(hr){return(Math.exp(hr)+Math.exp(-hr))/2}var Sr=xn(0);function Cs(hr){return qe*(ur(Sr)*function Ki(hr){return Fr(hr)/ur(hr)}(Sr+rn*hr)-Fr(Sr))/bn}var ea=Date.now(),Ts=(xn(1)-Sr)/rn,ri=M.duration?1e3*M.duration:1e3*Ts*.8;return this._moveStart(!0,M.noMoveStart),function $h(){var hr=(Date.now()-ea)/ri,$l=function Xo(hr){return 1-Math.pow(1-hr,1.5)}(hr)*Ts;hr<=1?(this._flyToFrame=kt($h,this),this._move(this.unproject(k.add(U.subtract(k).multiplyBy(Cs($l)/Tt)),we),this.getScaleZoom(qe/function Qs(hr){return qe*(ur(Sr)/ur(Sr+rn*hr))}($l),we),{flyTo:!0})):this._move(h,x)._moveEnd(!0)}.call(this),this},flyToBounds:function(h,x){var M=this._getBoundsCenterZoom(h,x);return this.flyTo(M.center,M.zoom,x)},setMaxBounds:function(h){return h=Oi(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var x=this.options.minZoom;return this.options.minZoom=h,this._loaded&&x!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var x=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&x!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,x){this._enforcingBounds=!0;var M=this.getCenter(),k=this._limitCenter(M,this._zoom,Oi(h));return M.equals(k)||this.panTo(k,x),this._enforcingBounds=!1,this},panInside:function(h,x){var M=dn((x=x||{}).paddingTopLeft||x.padding||[0,0]),k=dn(x.paddingBottomRight||x.padding||[0,0]),U=this.project(this.getCenter()),X=this.project(h),we=this.getPixelBounds(),qe=si([we.min.add(M),we.max.subtract(k)]),Oe=qe.getSize();if(!qe.contains(X)){this._enforcingBounds=!0;var Tt=X.subtract(qe.getCenter()),rn=qe.extend(X).getSize().subtract(Oe);U.x+=Tt.x<0?-rn.x:rn.x,U.y+=Tt.y<0?-rn.y:rn.y,this.panTo(this.unproject(U),x),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=Ue({animate:!1,pan:!0},!0===h?{animate:!0}:h);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var M=this.getSize(),k=x.divideBy(2).round(),U=M.divideBy(2).round(),X=k.subtract(U);return X.x||X.y?(h.animate&&h.pan?this.panBy(X):(h.pan&&this._rawPanBy(X),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:M})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=Ue({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=u(this._handleGeolocationResponse,this),M=u(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,M,h):navigator.geolocation.getCurrentPosition(x,M,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var x=h.code,M=h.message||(1===x?"permission denied":2===x?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+M+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var k=new li(h.coords.latitude,h.coords.longitude),U=k.toBounds(2*h.coords.accuracy),X=this._locateOptions;if(X.setView){var we=this.getBoundsZoom(U);this.setView(k,X.maxZoom?Math.min(we,X.maxZoom):we)}var qe={latlng:k,bounds:U,timestamp:h.timestamp};for(var Oe in h.coords)"number"==typeof h.coords[Oe]&&(qe[Oe]=h.coords[Oe]);this.fire("locationfound",qe)}},addHandler:function(h,x){if(!x)return this;var M=this[h]=new x(this);return this._handlers.push(M),this.options[h]&&M.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}var h;for(h in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),or(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Tn(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[h].remove();for(h in this._panes)or(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,x){var k=On("div","leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),x||this._mapPane);return h&&(this._panes[h]=k),k},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds();return new Zi(this.unproject(h.getBottomLeft()),this.unproject(h.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,x,M){h=Oi(h),M=dn(M||[0,0]);var k=this.getZoom()||0,U=this.getMinZoom(),X=this.getMaxZoom(),we=h.getNorthWest(),qe=h.getSouthEast(),Oe=this.getSize().subtract(M),Tt=si(this.project(qe,k),this.project(we,k)).getSize(),rn=Bt.any3d?this.options.zoomSnap:1,bn=Oe.x/Tt.x,xn=Oe.y/Tt.y,Fr=x?Math.max(bn,xn):Math.min(bn,xn);return k=this.getScaleZoom(Fr,k),rn&&(k=Math.round(k/(rn/100))*(rn/100),k=x?Math.ceil(k/rn)*rn:Math.floor(k/rn)*rn),Math.max(U,Math.min(X,k))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new En(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,x){var M=this._getTopLeftPoint(h,x);return new In(M,M.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(void 0===h?this.getZoom():h)},getPane:function(h){return"string"==typeof h?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,x){var M=this.options.crs;return x=void 0===x?this._zoom:x,M.scale(h)/M.scale(x)},getScaleZoom:function(h,x){var M=this.options.crs,k=M.zoom(h*M.scale(x=void 0===x?this._zoom:x));return isNaN(k)?1/0:k},project:function(h,x){return x=void 0===x?this._zoom:x,this.options.crs.latLngToPoint(Mn(h),x)},unproject:function(h,x){return x=void 0===x?this._zoom:x,this.options.crs.pointToLatLng(dn(h),x)},layerPointToLatLng:function(h){var x=dn(h).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(h){return this.project(Mn(h))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(Mn(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(Oi(h))},distance:function(h,x){return this.options.crs.distance(Mn(h),Mn(x))},containerPointToLayerPoint:function(h){return dn(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return dn(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var x=this.containerPointToLayerPoint(dn(h));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Mn(h)))},mouseEventToContainerPoint:function(h){return Hs(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var x=this._container=os(h);if(!x)throw new Error("Map container not found.");if(x._leaflet_id)throw new Error("Map container is already initialized.");on(x,"scroll",this._onScroll,this),this._containerId=Ie(x)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&Bt.any3d,ot(h,"leaflet-container"+(Bt.touch?" leaflet-touch":"")+(Bt.retina?" leaflet-retina":"")+(Bt.ielt9?" leaflet-oldie":"")+(Bt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=Qi(h,"position");"absolute"!==x&&"relative"!==x&&"fixed"!==x&&"sticky"!==x&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Xi(this._mapPane,new En(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ot(h.markerPane,"leaflet-zoom-hide"),ot(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,x,M){Xi(this._mapPane,new En(0,0));var k=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var U=this._zoom!==x;this._moveStart(U,M)._move(h,x)._moveEnd(U),this.fire("viewreset"),k&&this.fire("load")},_moveStart:function(h,x){return h&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(h,x,M,k){void 0===x&&(x=this._zoom);var U=this._zoom!==x;return this._zoom=x,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),k?M&&M.pinch&&this.fire("zoom",M):((U||M&&M.pinch)&&this.fire("zoom",M),this.fire("move",M)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Tn(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){Xi(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[Ie(this._container)]=this;var x=h?ai:on;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),Bt.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Tn(this._resizeRequest),this._resizeRequest=kt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,x){for(var k,M=[],U="mouseout"===x||"mouseover"===x,X=h.target||h.srcElement,we=!1;X;){if((k=this._targets[Ie(X)])&&("click"===x||"preclick"===x)&&this._draggableMoved(k)){we=!0;break}if(k&&k.listens(x,!0)&&(U&&!Ou(X,h)||(M.push(k),U))||X===this._container)break;X=X.parentNode}return!M.length&&!we&&!U&&this.listens(x,!0)&&(M=[this]),M},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var x=h.target||h.srcElement;if(!(!this._loaded||x._leaflet_disable_events||"click"===h.type&&this._isClickDisabled(x))){var M=h.type;"mousedown"===M&&Al(x),this._fireDOMEvent(h,M)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,x,M){if("click"===h.type){var k=Ue({},h);k.type="preclick",this._fireDOMEvent(k,k.type,M)}var U=this._findEventTargets(h,x);if(M){for(var X=[],we=0;we<M.length;we++)M[we].listens(x,!0)&&X.push(M[we]);U=X.concat(U)}if(U.length){"contextmenu"===x&&Ci(h);var qe=U[0],Oe={originalEvent:h};if("keypress"!==h.type&&"keydown"!==h.type&&"keyup"!==h.type){var Tt=qe.getLatLng&&(!qe._radius||qe._radius<=10);Oe.containerPoint=Tt?this.latLngToContainerPoint(qe.getLatLng()):this.mouseEventToContainerPoint(h),Oe.layerPoint=this.containerPointToLayerPoint(Oe.containerPoint),Oe.latlng=Tt?qe.getLatLng():this.layerPointToLatLng(Oe.layerPoint)}for(we=0;we<U.length;we++)if(U[we].fire(x,Oe,!0),Oe.originalEvent._stopped||!1===U[we].options.bubblingMouseEvents&&-1!==bt(this._mouseEvents,x))return}},_draggableMoved:function(h){return(h=h.dragging&&h.dragging.enabled()?h:this).dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,x=this._handlers.length;h<x;h++)this._handlers[h].disable()},whenReady:function(h,x){return this._loaded?h.call(x||this,{target:this}):this.on("load",h,x),this},_getMapPanePos:function(){return jn(this._mapPane)||new En(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,x){return(h&&void 0!==x?this._getNewPixelOrigin(h,x):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,x){var M=this.getSize()._divideBy(2);return this.project(h,x)._subtract(M)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,x,M){var k=this._getNewPixelOrigin(M,x);return this.project(h,x)._subtract(k)},_latLngBoundsToNewLayerBounds:function(h,x,M){var k=this._getNewPixelOrigin(M,x);return si([this.project(h.getSouthWest(),x)._subtract(k),this.project(h.getNorthWest(),x)._subtract(k),this.project(h.getSouthEast(),x)._subtract(k),this.project(h.getNorthEast(),x)._subtract(k)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,x,M){if(!M)return h;var k=this.project(h,x),U=this.getSize().divideBy(2),X=new In(k.subtract(U),k.add(U)),we=this._getBoundsOffset(X,M,x);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?h:this.unproject(k.add(we),x)},_limitOffset:function(h,x){if(!x)return h;var M=this.getPixelBounds(),k=new In(M.min.add(h),M.max.add(h));return h.add(this._getBoundsOffset(k,x))},_getBoundsOffset:function(h,x,M){var k=si(this.project(x.getNorthEast(),M),this.project(x.getSouthWest(),M)),U=k.min.subtract(h.min),X=k.max.subtract(h.max);return new En(this._rebound(U.x,-X.x),this._rebound(U.y,-X.y))},_rebound:function(h,x){return h+x>0?Math.round(h-x)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(x))},_limitZoom:function(h){var x=this.getMinZoom(),M=this.getMaxZoom(),k=Bt.any3d?this.options.zoomSnap:1;return k&&(h=Math.round(h/k)*k),Math.max(x,Math.min(M,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){vn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,x){var M=this._getCenterOffset(h)._trunc();return!(!0!==(x&&x.animate)&&!this.getSize().contains(M)||(this.panBy(M,x),0))},_createAnimProxy:function(){var h=this._proxy=On("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(x){var M=_o,k=this._proxy.style[M];ss(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),k===this._proxy.style[M]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){or(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),x=this.getZoom();ss(this._proxy,this.project(h,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,x,M){if(this._animatingZoom)return!0;if(M=M||{},!this._zoomAnimated||!1===M.animate||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var k=this.getZoomScale(x),U=this._getCenterOffset(h)._divideBy(1-1/k);return!(!0!==M.animate&&!this.getSize().contains(U)||(kt(function(){this._moveStart(!0,M.noMoveStart||!1)._animateZoom(h,x,!0)},this),0))},_animateZoom:function(h,x,M,k){this._mapPane&&(M&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=x,ot(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:x,noUpdate:k}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&vn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var so=qi.extend({options:{position:"topright"},initialize:function(h){St(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var x=this._map;return x&&x.removeControl(this),this.options.position=h,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var x=this._container=this.onAdd(h),M=this.getPosition(),k=h._controlCorners[M];return ot(x,"leaflet-control"),-1!==M.indexOf("bottom")?k.insertBefore(x,k.firstChild):k.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(or(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),Ho=function(h){return new so(h)};jt.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},x="leaflet-",M=this._controlContainer=On("div",x+"control-container",this._container);function k(U,X){h[U+X]=On("div",x+U+" "+x+X,M)}k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)or(this._controlCorners[h]);or(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var an=so.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,x,M,k){return M<k?-1:k<M?1:0}},initialize:function(h,x,M){for(var k in St(this,M),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,h)this._addLayer(h[k],k);for(k in x)this._addLayer(x[k],k,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return so.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,x){return this._addLayer(h,x),this._map?this._update():this},addOverlay:function(h,x){return this._addLayer(h,x,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var x=this._getLayer(Ie(h));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){ot(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(ot(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):vn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return vn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",x=this._container=On("div",h),M=this.options.collapsed;x.setAttribute("aria-haspopup",!0),Wr(x),Wc(x);var k=this._section=On("section",h+"-list");M&&(this._map.on("click",this.collapse,this),on(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var U=this._layersLink=On("a",h+"-toggle",x);U.href="#",U.title="Layers",U.setAttribute("role","button"),on(U,{keydown:function(X){13===X.keyCode&&this._expandSafely()},click:function(X){Ci(X),this._expandSafely()}},this),M||this.expand(),this._baseLayersList=On("div",h+"-base",k),this._separator=On("div",h+"-separator",k),this._overlaysList=On("div",h+"-overlays",k),x.appendChild(k)},_getLayer:function(h){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&Ie(this._layers[x].layer)===h)return this._layers[x]},_addLayer:function(h,x,M){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:x,overlay:M}),this.options.sortLayers&&this._layers.sort(u(function(k,U){return this.options.sortFunction(k.layer,U.layer,k.name,U.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ao(this._baseLayersList),Ao(this._overlaysList),this._layerControlInputs=[];var h,x,M,k,U=0;for(M=0;M<this._layers.length;M++)this._addItem(k=this._layers[M]),x=x||k.overlay,h=h||!k.overlay,U+=k.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(h=h&&U>1)?"":"none"),this._separator.style.display=x&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var x=this._getLayer(Ie(h.target)),M=x.overlay?"add"===h.type?"overlayadd":"overlayremove":"add"===h.type?"baselayerchange":null;M&&this._map.fire(M,x)},_createRadioElement:function(h,x){var M='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(x?' checked="checked"':"")+"/>",k=document.createElement("div");return k.innerHTML=M,k.firstChild},_addItem:function(h){var k,x=document.createElement("label"),M=this._map.hasLayer(h.layer);h.overlay?((k=document.createElement("input")).type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=M):k=this._createRadioElement("leaflet-base-layers_"+Ie(this),M),this._layerControlInputs.push(k),k.layerId=Ie(h.layer),on(k,"click",this._onInputClick,this);var U=document.createElement("span");U.innerHTML=" "+h.name;var X=document.createElement("span");return x.appendChild(X),X.appendChild(k),X.appendChild(U),(h.overlay?this._overlaysList:this._baseLayersList).appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var x,M,h=this._layerControlInputs,k=[],U=[];this._handlingClick=!0;for(var X=h.length-1;X>=0;X--)M=this._getLayer((x=h[X]).layerId).layer,x.checked?k.push(M):x.checked||U.push(M);for(X=0;X<U.length;X++)this._map.hasLayer(U[X])&&this._map.removeLayer(U[X]);for(X=0;X<k.length;X++)this._map.hasLayer(k[X])||this._map.addLayer(k[X]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var x,M,h=this._layerControlInputs,k=this._map.getZoom(),U=h.length-1;U>=0;U--)M=this._getLayer((x=h[U]).layerId).layer,x.disabled=void 0!==M.options.minZoom&&k<M.options.minZoom||void 0!==M.options.maxZoom&&k>M.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,on(h,"click",Ci),this.expand();var x=this;setTimeout(function(){ai(h,"click",Ci),x._preventClick=!1})}}),Nr=so.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var x="leaflet-control-zoom",M=On("div",x+" leaflet-bar"),k=this.options;return this._zoomInButton=this._createButton(k.zoomInText,k.zoomInTitle,x+"-in",M,this._zoomIn),this._zoomOutButton=this._createButton(k.zoomOutText,k.zoomOutTitle,x+"-out",M,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),M},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,x,M,k,U){var X=On("a",M,k);return X.innerHTML=h,X.href="#",X.title=x,X.setAttribute("role","button"),X.setAttribute("aria-label",x),Wr(X),on(X,"click",Sa),on(X,"click",U,this),on(X,"click",this._refocusOnMap,this),X},_updateDisabled:function(){var h=this._map,x="leaflet-disabled";vn(this._zoomInButton,x),vn(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(ot(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(ot(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});jt.mergeOptions({zoomControl:!0}),jt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Nr,this.addControl(this.zoomControl))});var Rl=so.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var x="leaflet-control-scale",M=On("div",x),k=this.options;return this._addScales(k,x+"-line",M),h.on(k.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),M},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,x,M){h.metric&&(this._mScale=On("div",x,M)),h.imperial&&(this._iScale=On("div",x,M))},_update:function(){var h=this._map,x=h.getSize().y/2,M=h.distance(h.containerPointToLatLng([0,x]),h.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(M)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var x=this._getRoundNum(h);this._updateScale(this._mScale,x<1e3?x+" m":x/1e3+" km",x/h)},_updateImperial:function(h){var M,k,U,x=3.2808399*h;x>5280?(k=this._getRoundNum(M=x/5280),this._updateScale(this._iScale,k+" mi",k/M)):(U=this._getRoundNum(x),this._updateScale(this._iScale,U+" ft",U/x))},_updateScale:function(h,x,M){h.style.width=Math.round(this.options.maxWidth*M)+"px",h.innerHTML=x},_getRoundNum:function(h){var x=Math.pow(10,(Math.floor(h)+"").length-1),M=h/x;return x*(M>=10?10:M>=5?5:M>=3?3:M>=2?2:1)}}),Pa=so.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Bt.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(h){St(this,h),this._attributions={}},onAdd:function(h){for(var x in h.attributionControl=this,this._container=On("div","leaflet-control-attribution"),Wr(this._container),h._layers)h._layers[x].getAttribution&&this.addAttribution(h._layers[x].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var x in this._attributions)this._attributions[x]&&h.push(x);var M=[];this.options.prefix&&M.push(this.options.prefix),h.length&&M.push(h.join(", ")),this._container.innerHTML=M.join(' <span aria-hidden="true">|</span> ')}}});jt.mergeOptions({attributionControl:!0}),jt.addInitHook(function(){this.options.attributionControl&&(new Pa).addTo(this)});so.Layers=an,so.Zoom=Nr,so.Scale=Rl,so.Attribution=Pa,Ho.layers=function(h,x,M){return new an(h,x,M)},Ho.zoom=function(h){return new Nr(h)},Ho.scale=function(h){return new Rl(h)},Ho.attribution=function(h){return new Pa(h)};var Xr=qi.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Xr.addTo=function(h,x){return h.addHandler(x,this),this};var fi={Events:Er},Bh=Bt.touch?"touchstart mousedown":"mousedown",$n=Dn.extend({options:{clickTolerance:3},initialize:function(h,x,M,k){St(this,k),this._element=h,this._dragStartTarget=x||h,this._preventOutline=M},enable:function(){this._enabled||(on(this._dragStartTarget,Bh,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&($n._dragging===this&&this.finishDrag(!0),ai(this._dragStartTarget,Bh,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!Da(this._element,"leaflet-zoom-anim"))){if(h.touches&&1!==h.touches.length)return void($n._dragging===this&&this.finishDrag());if(!($n._dragging||h.shiftKey||1!==h.which&&1!==h.button&&!h.touches||($n._dragging=this,this._preventOutline&&Al(this._element),Ei(),gi(),this._moving))){this.fire("down");var x=h.touches?h.touches[0]:h,M=Mt(this._element);this._startPoint=new En(x.clientX,x.clientY),this._startPos=jn(this._element),this._parentScale=kr(M);var k="mousedown"===h.type;on(document,k?"mousemove":"touchmove",this._onMove,this),on(document,k?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1)return void(this._moved=!0);var x=h.touches&&1===h.touches.length?h.touches[0]:h,M=new En(x.clientX,x.clientY)._subtract(this._startPoint);!M.x&&!M.y||Math.abs(M.x)+Math.abs(M.y)<this.options.clickTolerance||(M.x/=this._parentScale.x,M.y/=this._parentScale.y,Ci(h),this._moved||(this.fire("dragstart"),this._moved=!0,ot(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ot(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(M),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),Xi(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){vn(document.body,"leaflet-dragging"),this._lastTarget&&(vn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ai(document,"mousemove touchmove",this._onMove,this),ai(document,"mouseup touchend touchcancel",this._onUp,this),Pn(),ar();var x=this._moved&&this._moving;this._moving=!1,$n._dragging=!1,x&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function cc(h,x,M){var k,X,we,qe,Oe,Tt,rn,bn,xn,U=[1,4,2,8];for(X=0,rn=h.length;X<rn;X++)h[X]._code=qs(h[X],x);for(qe=0;qe<4;qe++){for(bn=U[qe],k=[],X=0,we=(rn=h.length)-1;X<rn;we=X++)Tt=h[we],(Oe=h[X])._code&bn?Tt._code&bn||((xn=La(Tt,Oe,bn,x,M))._code=qs(xn,x),k.push(xn)):(Tt._code&bn&&((xn=La(Tt,Oe,bn,x,M))._code=qs(xn,x),k.push(xn)),k.push(Oe));h=k}return h}function uc(h,x){var M,k,U,X,we,qe,Oe,Tt;if(!h||0===h.length)throw new Error("latlngs not passed");Lo(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var bn=Mn([0,0]),xn=Oi(h);xn.getNorthWest().distanceTo(xn.getSouthWest())*xn.getNorthEast().distanceTo(xn.getNorthWest())<1700&&(bn=Yr(h));var ur=h.length,Ki=[];for(M=0;M<ur;M++){var Sr=Mn(h[M]);Ki.push(x.project(Mn([Sr.lat-bn.lat,Sr.lng-bn.lng])))}for(qe=Oe=Tt=0,M=0,k=ur-1;M<ur;k=M++)Oe+=((U=Ki[M]).x+(X=Ki[k]).x)*(we=U.y*X.x-X.y*U.x),Tt+=(U.y+X.y)*we,qe+=3*we;var Qs=x.unproject(dn(0===qe?Ki[0]:[Oe/qe,Tt/qe]));return Mn([Qs.lat+bn.lat,Qs.lng+bn.lng])}function Yr(h){for(var x=0,M=0,k=0,U=0;U<h.length;U++){var X=Mn(h[U]);x+=X.lat,M+=X.lng,k++}return Mn([x/k,M/k])}var dc,Kc={__proto__:null,clipPolygon:cc,polygonCenter:uc,centroid:Yr};function kl(h,x){if(!x||!h.length)return h.slice();var M=x*x;return function Ra(h,x){var M=h.length,U=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(M);U[0]=U[M-1]=1,Xt(h,U,x,0,M-1);var X,we=[];for(X=0;X<M;X++)U[X]&&we.push(h[X]);return we}(h=function Ol(h,x){for(var M=[h[0]],k=1,U=0,X=h.length;k<X;k++)Nl(h[k],h[U])>x&&(M.push(h[k]),U=k);return U<X-1&&M.push(h[X-1]),M}(h,M),M)}function Di(h,x,M){return Math.sqrt(il(h,x,M,!0))}function Xt(h,x,M,k,U){var we,qe,Oe,X=0;for(qe=k+1;qe<=U-1;qe++)(Oe=il(h[qe],h[k],h[U],!0))>X&&(we=qe,X=Oe);X>M&&(x[we]=1,Xt(h,x,M,k,we),Xt(h,x,M,we,U))}function nl(h,x,M,k,U){var qe,Oe,Tt,X=k?dc:qs(h,M),we=qs(x,M);for(dc=we;;){if(!(X|we))return[h,x];if(X&we)return!1;Tt=qs(Oe=La(h,x,qe=X||we,M,U),M),qe===X?(h=Oe,X=Tt):(x=Oe,we=Tt)}}function La(h,x,M,k,U){var Tt,rn,X=x.x-h.x,we=x.y-h.y,qe=k.min,Oe=k.max;return 8&M?(Tt=h.x+X*(Oe.y-h.y)/we,rn=Oe.y):4&M?(Tt=h.x+X*(qe.y-h.y)/we,rn=qe.y):2&M?(Tt=Oe.x,rn=h.y+we*(Oe.x-h.x)/X):1&M&&(Tt=qe.x,rn=h.y+we*(qe.x-h.x)/X),new En(Tt,rn,U)}function qs(h,x){var M=0;return h.x<x.min.x?M|=1:h.x>x.max.x&&(M|=2),h.y<x.min.y?M|=4:h.y>x.max.y&&(M|=8),M}function Nl(h,x){var M=x.x-h.x,k=x.y-h.y;return M*M+k*k}function il(h,x,M,k){var Tt,U=x.x,X=x.y,we=M.x-U,qe=M.y-X,Oe=we*we+qe*qe;return Oe>0&&((Tt=((h.x-U)*we+(h.y-X)*qe)/Oe)>1?(U=M.x,X=M.y):Tt>0&&(U+=we*Tt,X+=qe*Tt)),we=h.x-U,qe=h.y-X,k?we*we+qe*qe:new En(U,X)}function Lo(h){return!tt(h[0])||"object"!=typeof h[0][0]&&typeof h[0][0]<"u"}function ci(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Lo(h)}function fc(h,x){var M,k,U,X,we,qe,Oe,Tt;if(!h||0===h.length)throw new Error("latlngs not passed");Lo(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var rn=Mn([0,0]),bn=Oi(h);bn.getNorthWest().distanceTo(bn.getSouthWest())*bn.getNorthEast().distanceTo(bn.getNorthWest())<1700&&(rn=Yr(h));var Fr=h.length,ur=[];for(M=0;M<Fr;M++){var Ki=Mn(h[M]);ur.push(x.project(Mn([Ki.lat-rn.lat,Ki.lng-rn.lng])))}for(M=0,k=0;M<Fr-1;M++)k+=ur[M].distanceTo(ur[M+1])/2;if(0===k)Tt=ur[0];else for(M=0,X=0;M<Fr-1;M++)if((X+=U=(we=ur[M]).distanceTo(qe=ur[M+1]))>k){Tt=[qe.x-(Oe=(X-k)/U)*(qe.x-we.x),qe.y-Oe*(qe.y-we.y)];break}var Sr=x.unproject(dn(Tt));return Mn([Sr.lat+rn.lat,Sr.lng+rn.lng])}var Gd={__proto__:null,simplify:kl,pointToSegmentDistance:Di,closestPointOnSegment:function hc(h,x,M){return il(h,x,M)},clipSegment:nl,_getEdgeIntersection:La,_getBitCode:qs,_sqClosestPointOnSegment:il,isFlat:Lo,_flat:ci,polylineCenter:fc},Zs={project:function(h){return new En(h.lng,h.lat)},unproject:function(h){return new li(h.y,h.x)},bounds:new In([-180,-90],[180,90])},Fl={R:6378137,R_MINOR:6356752.314245179,bounds:new In([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(h){var x=Math.PI/180,M=this.R,k=h.lat*x,U=this.R_MINOR/M,X=Math.sqrt(1-U*U),we=X*Math.sin(k),qe=Math.tan(Math.PI/4-k/2)/Math.pow((1-we)/(1+we),X/2);return k=-M*Math.log(Math.max(qe,1e-10)),new En(h.lng*x*M,k)},unproject:function(h){for(var Tt,x=180/Math.PI,M=this.R,k=this.R_MINOR/M,U=Math.sqrt(1-k*k),X=Math.exp(-h.y/M),we=Math.PI/2-2*Math.atan(X),qe=0,Oe=.1;qe<15&&Math.abs(Oe)>1e-7;qe++)Tt=U*Math.sin(we),Tt=Math.pow((1-Tt)/(1+Tt),U/2),we+=Oe=Math.PI/2-2*Math.atan(X*Tt)-we;return new li(we*x,h.x*x/M)}},vs={__proto__:null,LonLat:Zs,Mercator:Fl,SphericalMercator:ln},Fu=Ue({},di,{code:"EPSG:3395",projection:Fl,transformation:function(){var h=.5/(Math.PI*Fl.R);return An(h,.5,-h,.5)}()}),Vh=Ue({},di,{code:"EPSG:4326",projection:Zs,transformation:An(1/180,1,-1/180,.5)}),qd=Ue({},Zr,{projection:Zs,transformation:An(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,x){var M=x.lng-h.lng,k=x.lat-h.lat;return Math.sqrt(M*M+k*k)},infinite:!0});Zr.Earth=di,Zr.EPSG3395=Fu,Zr.EPSG3857=Ns,Zr.EPSG900913=Ji,Zr.EPSG4326=Vh,Zr.Simple=qd;var Go=Dn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[Ie(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[Ie(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var x=h.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var M=this.getEvents();x.on(M,this),this.once("remove",function(){x.off(M,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});jt.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var x=Ie(h);return this._layers[x]||(this._layers[x]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h)),this},removeLayer:function(h){var x=Ie(h);return this._layers[x]?(this._loaded&&h.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return Ie(h)in this._layers},eachLayer:function(h,x){for(var M in this._layers)h.call(x,this._layers[M]);return this},_addLayers:function(h){for(var x=0,M=(h=h?tt(h)?h:[h]:[]).length;x<M;x++)this.addLayer(h[x])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[Ie(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var x=Ie(h);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,x=-1/0,M=this._getZoomSpan();for(var k in this._zoomBoundLayers){var U=this._zoomBoundLayers[k].options;h=void 0===U.minZoom?h:Math.min(h,U.minZoom),x=void 0===U.maxZoom?x:Math.max(x,U.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=h===1/0?void 0:h,M!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ko=Go.extend({initialize:function(h,x){var M,k;if(St(this,x),this._layers={},h)for(M=0,k=h.length;M<k;M++)this.addLayer(h[M])},addLayer:function(h){var x=this.getLayerId(h);return this._layers[x]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var x=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(h){return("number"==typeof h?h:this.getLayerId(h))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var M,k,x=Array.prototype.slice.call(arguments,1);for(M in this._layers)(k=this._layers[M])[h]&&k[h].apply(k,x);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,x){for(var M in this._layers)h.call(x,this._layers[M]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return Ie(h)}}),jr=ko.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),ko.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),ko.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new Zi;for(var x in this._layers){var M=this._layers[x];h.extend(M.getBounds?M.getBounds():M.getLatLng())}return h}}),sn=qi.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){St(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,x){var M=this._getIconUrl(h);if(!M){if("icon"===h)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var k=this._createImg(M,x&&"IMG"===x.tagName?x:null);return this._setIconStyles(k,h),(this.options.crossOrigin||""===this.options.crossOrigin)&&(k.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),k},_setIconStyles:function(h,x){var M=this.options,k=M[x+"Size"];"number"==typeof k&&(k=[k,k]);var U=dn(k),X=dn("shadow"===x&&M.shadowAnchor||M.iconAnchor||U&&U.divideBy(2,!0));h.className="leaflet-marker-"+x+" "+(M.className||""),X&&(h.style.marginLeft=-X.x+"px",h.style.marginTop=-X.y+"px"),U&&(h.style.width=U.x+"px",h.style.height=U.y+"px")},_createImg:function(h,x){return(x=x||document.createElement("img")).src=h,x},_getIconUrl:function(h){return Bt.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});var tn=sn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return"string"!=typeof tn.imagePath&&(tn.imagePath=this._detectIconPath()),(this.options.imagePath||tn.imagePath)+sn.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var x=function(M,k,U){var X=k.exec(M);return X&&X[U]};return(h=x(h,/^url\((['"])?(.+)\1\)$/,2))&&x(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=On("div","leaflet-default-icon-path",document.body),x=Qi(h,"background-image")||Qi(h,"backgroundImage");if(document.body.removeChild(h),x=this._stripUrl(x))return x;var M=document.querySelector('link[href$="leaflet.css"]');return M?M.href.substring(0,M.href.length-11-1):""}}),Ws=Xr.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new $n(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ot(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&vn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var x=this._marker,M=x._map,k=this._marker.options.autoPanSpeed,U=this._marker.options.autoPanPadding,X=jn(x._icon),we=M.getPixelBounds(),qe=M.getPixelOrigin(),Oe=si(we.min._subtract(qe).add(U),we.max._subtract(qe).subtract(U));if(!Oe.contains(X)){var Tt=dn((Math.max(Oe.max.x,X.x)-Oe.max.x)/(we.max.x-Oe.max.x)-(Math.min(Oe.min.x,X.x)-Oe.min.x)/(we.min.x-Oe.min.x),(Math.max(Oe.max.y,X.y)-Oe.max.y)/(we.max.y-Oe.max.y)-(Math.min(Oe.min.y,X.y)-Oe.min.y)/(we.min.y-Oe.min.y)).multiplyBy(k);M.panBy(Tt,{animate:!1}),this._draggable._newPos._add(Tt),this._draggable._startPos._add(Tt),Xi(x._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=kt(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(Tn(this._panRequest),this._panRequest=kt(this._adjustPan.bind(this,h)))},_onDrag:function(h){var x=this._marker,M=x._shadow,k=jn(x._icon),U=x._map.layerPointToLatLng(k);M&&Xi(M,k),x._latlng=U,h.latlng=U,h.oldLatLng=this._oldLatLng,x.fire("move",h).fire("drag",h)},_onDragEnd:function(h){Tn(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),ls=Go.extend({options:{icon:new tn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,x){St(this,x),this._latlng=Mn(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var x=this._latlng;return this._latlng=Mn(h),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),M=h.icon.createIcon(this._icon),k=!1;M!==this._icon&&(this._icon&&this._removeIcon(),k=!0,h.title&&(M.title=h.title),"IMG"===M.tagName&&(M.alt=h.alt||"")),ot(M,x),h.keyboard&&(M.tabIndex="0",M.setAttribute("role","button")),this._icon=M,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&on(M,"focus",this._panOnFocus,this);var U=h.icon.createShadow(this._shadow),X=!1;U!==this._shadow&&(this._removeShadow(),X=!0),U&&(ot(U,x),U.alt=""),this._shadow=U,h.opacity<1&&this._updateOpacity(),k&&this.getPane().appendChild(this._icon),this._initInteraction(),U&&X&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ai(this._icon,"focus",this._panOnFocus,this),or(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&or(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&Xi(this._icon,h),this._shadow&&Xi(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(ot(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ws)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ws(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&sr(this._icon,h),this._shadow&&sr(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var x=this.options.icon.options,M=x.iconSize?dn(x.iconSize):dn(0,0),k=x.iconAnchor?dn(x.iconAnchor):dn(0,0);h.panInside(this._latlng,{paddingTopLeft:k,paddingBottomRight:M.subtract(k)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var qo=Go.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return St(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),zl=qo.extend({options:{fill:!0,radius:10},initialize:function(h,x){St(this,x),this._latlng=Mn(h),this._radius=this.options.radius},setLatLng:function(h){var x=this._latlng;return this._latlng=Mn(h),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var x=h&&h.radius||this._radius;return qo.prototype.setStyle.call(this,h),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,x=this._radiusY||h,M=this._clickTolerance(),k=[h+M,x+M];this._pxBounds=new In(this._point.subtract(k),this._point.add(k))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Co=zl.extend({initialize:function(h,x,M){if("number"==typeof x&&(x=Ue({},M,{radius:x})),St(this,x),this._latlng=Mn(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new Zi(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:qo.prototype.setStyle,_project:function(){var h=this._latlng.lng,x=this._latlng.lat,M=this._map,k=M.options.crs;if(k.distance===di.distance){var U=Math.PI/180,X=this._mRadius/di.R/U,we=M.project([x+X,h]),qe=M.project([x-X,h]),Oe=we.add(qe).divideBy(2),Tt=M.unproject(Oe).lat,rn=Math.acos((Math.cos(X*U)-Math.sin(x*U)*Math.sin(Tt*U))/(Math.cos(x*U)*Math.cos(Tt*U)))/U;(isNaN(rn)||0===rn)&&(rn=X/Math.cos(Math.PI/180*x)),this._point=Oe.subtract(M.getPixelOrigin()),this._radius=isNaN(rn)?0:Oe.x-M.project([Tt,h-rn]).x,this._radiusY=Oe.y-we.y}else{var bn=k.unproject(k.project(this._latlng).subtract([this._mRadius,0]));this._point=M.latLngToLayerPoint(this._latlng),this._radius=this._point.x-M.latLngToLayerPoint(bn).x}this._updateBounds()}});var xr=qo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,x){St(this,x),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var U,X,x=1/0,M=null,k=il,we=0,qe=this._parts.length;we<qe;we++)for(var Oe=this._parts[we],Tt=1,rn=Oe.length;Tt<rn;Tt++){var bn=k(h,U=Oe[Tt-1],X=Oe[Tt],!0);bn<x&&(x=bn,M=k(h,U,X))}return M&&(M.distance=Math.sqrt(x)),M},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return fc(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,x){return x=x||this._defaultShape(),h=Mn(h),x.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new Zi,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Lo(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var x=[],M=Lo(h),k=0,U=h.length;k<U;k++)M?(x[k]=Mn(h[k]),this._bounds.extend(x[k])):x[k]=this._convertLatLngs(h[k]);return x},_project:function(){var h=new In;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),x=new En(h,h);this._rawPxBounds&&(this._pxBounds=new In([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(h,x,M){var X,we,U=h.length;if(h[0]instanceof li){for(we=[],X=0;X<U;X++)we[X]=this._map.latLngToLayerPoint(h[X]),M.extend(we[X]);x.push(we)}else for(X=0;X<U;X++)this._projectLatlngs(h[X],x,M)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(h)){if(this.options.noClip)return void(this._parts=this._rings);var M,k,U,X,we,qe,Oe,x=this._parts;for(M=0,U=0,X=this._rings.length;M<X;M++)for(k=0,we=(Oe=this._rings[M]).length;k<we-1;k++)(qe=nl(Oe[k],Oe[k+1],h,k,!0))&&(x[U]=x[U]||[],x[U].push(qe[0]),(qe[1]!==Oe[k+1]||k===we-2)&&(x[U].push(qe[1]),U++))}},_simplifyPoints:function(){for(var h=this._parts,x=this.options.smoothFactor,M=0,k=h.length;M<k;M++)h[M]=kl(h[M],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,x){var M,k,U,X,we,qe,Oe=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(M=0,X=this._parts.length;M<X;M++)for(k=0,U=(we=(qe=this._parts[M]).length)-1;k<we;U=k++)if((x||0!==k)&&Di(h,qe[U],qe[k])<=Oe)return!0;return!1}});xr._flat=ci;var ni=xr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return uc(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var x=xr.prototype._convertLatLngs.call(this,h),M=x.length;return M>=2&&x[0]instanceof li&&x[0].equals(x[M-1])&&x.pop(),x},_setLatLngs:function(h){xr.prototype._setLatLngs.call(this,h),Lo(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Lo(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,x=this.options.weight,M=new En(x,x);if(h=new In(h.min.subtract(M),h.max.add(M)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(h)){if(this.options.noClip)return void(this._parts=this._rings);for(var X,k=0,U=this._rings.length;k<U;k++)(X=cc(this._rings[k],h,!0)).length&&this._parts.push(X)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var M,k,U,X,we,qe,Oe,Tt,x=!1;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(X=0,Oe=this._parts.length;X<Oe;X++)for(we=0,qe=(Tt=(M=this._parts[X]).length)-1;we<Tt;qe=we++)(k=M[we]).y>h.y!=(U=M[qe]).y>h.y&&h.x<(U.x-k.x)*(h.y-k.y)/(U.y-k.y)+k.x&&(x=!x);return x||xr.prototype._containsPoint.call(this,h,!0)}});var Oo=jr.extend({initialize:function(h,x){St(this,x),this._layers={},h&&this.addData(h)},addData:function(h){var M,k,U,x=tt(h)?h:h.features;if(x){for(M=0,k=x.length;M<k;M++)((U=x[M]).geometries||U.geometry||U.features||U.coordinates)&&this.addData(U);return this}var X=this.options;if(X.filter&&!X.filter(h))return this;var we=Xs(h,X);return we?(we.feature=Ks(h),we.defaultOptions=we.options,this.resetStyle(we),X.onEachFeature&&X.onEachFeature(h,we),this.addLayer(we)):this},resetStyle:function(h){return void 0===h?this.eachLayer(this.resetStyle,this):(h.options=Ue({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(x){this._setLayerStyle(x,h)},this)},_setLayerStyle:function(h,x){h.setStyle&&("function"==typeof x&&(x=x(h.feature)),h.setStyle(x))}});function Xs(h,x){var qe,Oe,Tt,rn,M="Feature"===h.type?h.geometry:h,k=M?M.coordinates:null,U=[],X=x&&x.pointToLayer,we=x&&x.coordsToLatLng||Zo;if(!k&&!M)return null;switch(M.type){case"Point":return ol(X,h,qe=we(k),x);case"MultiPoint":for(Tt=0,rn=k.length;Tt<rn;Tt++)qe=we(k[Tt]),U.push(ol(X,h,qe,x));return new jr(U);case"LineString":case"MultiLineString":return Oe=bs(k,"LineString"===M.type?0:1,we),new xr(Oe,x);case"Polygon":case"MultiPolygon":return Oe=bs(k,"Polygon"===M.type?1:2,we),new ni(Oe,x);case"GeometryCollection":for(Tt=0,rn=M.geometries.length;Tt<rn;Tt++){var bn=Xs({geometry:M.geometries[Tt],type:"Feature",properties:h.properties},x);bn&&U.push(bn)}return new jr(U);case"FeatureCollection":for(Tt=0,rn=M.features.length;Tt<rn;Tt++){var xn=Xs(M.features[Tt],x);xn&&U.push(xn)}return new jr(U);default:throw new Error("Invalid GeoJSON object.")}}function ol(h,x,M,k){return h?h(x,M):new ls(M,k&&k.markersInheritOptions&&k)}function Zo(h){return new li(h[1],h[0],h[2])}function bs(h,x,M){for(var we,k=[],U=0,X=h.length;U<X;U++)we=x?bs(h[U],x-1,M):(M||Zo)(h[U]),k.push(we);return k}function eu(h,x){return void 0!==(h=Mn(h)).alt?[yt(h.lng,x),yt(h.lat,x),yt(h.alt,x)]:[yt(h.lng,x),yt(h.lat,x)]}function sl(h,x,M,k){for(var U=[],X=0,we=h.length;X<we;X++)U.push(x?sl(h[X],Lo(h[X])?0:x-1,M,k):eu(h[X],k));return!x&&M&&U.length>0&&U.push(U[0].slice()),U}function Ys(h,x){return h.feature?Ue({},h.feature,{geometry:x}):Ks(x)}function Ks(h){return"Feature"===h.type||"FeatureCollection"===h.type?h:{type:"Feature",properties:{},geometry:h}}var pc={toGeoJSON:function(h){return Ys(this,{type:"Point",coordinates:eu(this.getLatLng(),h)})}};function Js(h,x){return new Oo(h,x)}ls.include(pc),Co.include(pc),zl.include(pc),xr.include({toGeoJSON:function(h){var x=!Lo(this._latlngs);return Ys(this,{type:(x?"Multi":"")+"LineString",coordinates:sl(this._latlngs,x?1:0,!1,h)})}}),ni.include({toGeoJSON:function(h){var x=!Lo(this._latlngs),M=x&&!Lo(this._latlngs[0]),k=sl(this._latlngs,M?2:x?1:0,!0,h);return x||(k=[k]),Ys(this,{type:(M?"Multi":"")+"Polygon",coordinates:k})}}),ko.include({toMultiPoint:function(h){var x=[];return this.eachLayer(function(M){x.push(M.toGeoJSON(h).geometry.coordinates)}),Ys(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(h){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===x)return this.toMultiPoint(h);var M="GeometryCollection"===x,k=[];return this.eachLayer(function(U){if(U.toGeoJSON){var X=U.toGeoJSON(h);if(M)k.push(X.geometry);else{var we=Ks(X);"FeatureCollection"===we.type?k.push.apply(k,we.features):k.push(we)}}}),M?Ys(this,{geometries:k,type:"GeometryCollection"}):{type:"FeatureCollection",features:k}}});var Vu=Js,ws=Go.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,x,M){this._url=h,this._bounds=Oi(x),St(this,M)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ot(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){or(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Us(this._image),this},bringToBack:function(){return this._map&&el(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=Oi(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h="IMG"===this._url.tagName,x=this._image=h?this._url:On("img");ot(x,"leaflet-image-layer"),this._zoomAnimated&&ot(x,"leaflet-zoom-animated"),this.options.className&&ot(x,this.options.className),x.onselectstart=Re,x.onmousemove=Re,x.onload=u(this.fire,this,"load"),x.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(x.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h?this._url=x.src:(x.src=this._url,x.alt=this.options.alt)},_animateZoom:function(h){var x=this._map.getZoomScale(h.zoom),M=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;ss(this._image,M,x)},_reset:function(){var h=this._image,x=new In(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),M=x.getSize();Xi(h,x.min),h.style.width=M.x+"px",h.style.height=M.y+"px"},_updateOpacity:function(){sr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&null!=this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),Uu=ws.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h="VIDEO"===this._url.tagName,x=this._image=h?this._url:On("video");if(ot(x,"leaflet-image-layer"),this._zoomAnimated&&ot(x,"leaflet-zoom-animated"),this.options.className&&ot(x,this.options.className),x.onselectstart=Re,x.onmousemove=Re,x.onloadeddata=u(this.fire,this,"load"),h){for(var M=x.getElementsByTagName("source"),k=[],U=0;U<M.length;U++)k.push(M[U].src);this._url=M.length>0?k:[x.src]}else{tt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var X=0;X<this._url.length;X++){var we=On("source");we.src=this._url[X],x.appendChild(we)}}}});var Uh=ws.extend({_initImage:function(){var h=this._image=this._url;ot(h,"leaflet-image-layer"),this._zoomAnimated&&ot(h,"leaflet-zoom-animated"),this.options.className&&ot(h,this.options.className),h.onselectstart=Re,h.onmousemove=Re}});var hs=Go.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,x){h&&(h instanceof li||tt(h))?(this._latlng=Mn(h),St(this,x)):(St(this,h),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(h){return(h=arguments.length?h:this._source._map).hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&sr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&sr(this._container,1),this.bringToFront(),this.options.interactive&&(ot(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(sr(this._container,0),this._removeTimeout=setTimeout(u(or,void 0,this._container),200)):or(this._container),this.options.interactive&&(vn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=Mn(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Us(this._container),this},bringToBack:function(){return this._map&&el(this._container),this},_prepareOpen:function(h){var x=this._source;if(!x._map)return!1;if(x instanceof jr){x=null;var M=this._source._layers;for(var k in M)if(M[k]._map){x=M[k];break}if(!x)return!1;this._source=x}if(!h)if(x.getCenter)h=x.getCenter();else if(x.getLatLng)h=x.getLatLng();else{if(!x.getBounds)throw new Error("Unable to get source layer LatLng.");h=x.getBounds().getCenter()}return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,x="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof x)h.innerHTML=x;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),x=dn(this.options.offset),M=this._getAnchor();this._zoomAnimated?Xi(this._container,h.add(M)):x=x.add(h).add(M);var k=this._containerBottom=-x.y,U=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=k+"px",this._container.style.left=U+"px"}},_getAnchor:function(){return[0,0]}});jt.include({_initOverlay:function(h,x,M,k){var U=x;return U instanceof h||(U=new h(k).setContent(x)),M&&U.setLatLng(M),U}}),Go.include({_initOverlay:function(h,x,M,k){var U=M;return U instanceof h?(St(U,k),U._source=this):(U=x&&!k?x:new h(k,this)).setContent(M),U}});var ka=hs.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return!(h=arguments.length?h:this._source._map).hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,hs.prototype.openOn.call(this,h)},onAdd:function(h){hs.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof qo||this._source.on("preclick",as))},onRemove:function(h){hs.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof qo||this._source.off("preclick",as))},getEvents:function(){var h=hs.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",x=this._container=On("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),M=this._wrapper=On("div",h+"-content-wrapper",x);if(this._contentNode=On("div",h+"-content",M),Wr(x),Wc(this._contentNode),on(x,"contextmenu",as),this._tipContainer=On("div",h+"-tip-container",x),this._tip=On("div",h+"-tip",this._tipContainer),this.options.closeButton){var k=this._closeButton=On("a",h+"-close-button",x);k.setAttribute("role","button"),k.setAttribute("aria-label","Close popup"),k.href="#close",k.innerHTML='<span aria-hidden="true">&#215;</span>',on(k,"click",function(U){Ci(U),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,x=h.style;x.width="",x.whiteSpace="nowrap";var M=h.offsetWidth;M=Math.min(M,this.options.maxWidth),M=Math.max(M,this.options.minWidth),x.width=M+1+"px",x.whiteSpace="",x.height="";var U=this.options.maxHeight,X="leaflet-popup-scrolled";U&&h.offsetHeight>U?(x.height=U+"px",ot(h,X)):vn(h,X),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),M=this._getAnchor();Xi(this._container,x.add(M))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)return void(this._autopanning=!1);var h=this._map,x=parseInt(Qi(this._container,"marginBottom"),10)||0,M=this._container.offsetHeight+x,k=this._containerWidth,U=new En(this._containerLeft,-M-this._containerBottom);U._add(jn(this._container));var X=h.layerPointToContainerPoint(U),we=dn(this.options.autoPanPadding),qe=dn(this.options.autoPanPaddingTopLeft||we),Oe=dn(this.options.autoPanPaddingBottomRight||we),Tt=h.getSize(),rn=0,bn=0;X.x+k+Oe.x>Tt.x&&(rn=X.x+k-Tt.x+Oe.x),X.x-rn-qe.x<0&&(rn=X.x-qe.x),X.y+M+Oe.y>Tt.y&&(bn=X.y+M-Tt.y+Oe.y),X.y-bn-qe.y<0&&(bn=X.y-qe.y),(rn||bn)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([rn,bn]))}},_getAnchor:function(){return dn(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});jt.mergeOptions({closePopupOnClick:!0}),jt.include({openPopup:function(h,x,M){return this._initOverlay(ka,h,x,M).openOn(this),this},closePopup:function(h){return(h=arguments.length?h:this._popup)&&h.close(),this}}),Go.include({bindPopup:function(h,x){return this._popup=this._initOverlay(ka,this._popup,h,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof jr||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(this._popup&&this._map){Sa(h);var x=h.layer||h.target;if(this._popup._source===x&&!(x instanceof qo))return void(this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng));this._popup._source=x,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){13===h.originalEvent.keyCode&&this._openPopup(h)}});var mc=hs.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){hs.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){hs.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=hs.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){this._contentNode=this._container=On("div","leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide")),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+Ie(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var x,M,k=this._map,U=this._container,X=k.latLngToContainerPoint(k.getCenter()),we=k.layerPointToContainerPoint(h),qe=this.options.direction,Oe=U.offsetWidth,Tt=U.offsetHeight,rn=dn(this.options.offset),bn=this._getAnchor();"top"===qe?(x=Oe/2,M=Tt):"bottom"===qe?(x=Oe/2,M=0):"center"===qe?(x=Oe/2,M=Tt/2):"right"===qe?(x=0,M=Tt/2):"left"===qe?(x=Oe,M=Tt/2):we.x<X.x?(qe="right",x=0,M=Tt/2):(qe="left",x=Oe+2*(rn.x+bn.x),M=Tt/2),h=h.subtract(dn(x,M,!0)).add(rn).add(bn),vn(U,"leaflet-tooltip-right"),vn(U,"leaflet-tooltip-left"),vn(U,"leaflet-tooltip-top"),vn(U,"leaflet-tooltip-bottom"),ot(U,"leaflet-tooltip-"+qe),Xi(U,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&sr(this._container,h)},_animateZoom:function(h){var x=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(x)},_getAnchor:function(){return dn(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});jt.include({openTooltip:function(h,x,M){return this._initOverlay(mc,h,x,M).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Go.include({bindTooltip:function(h,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(mc,this._tooltip,h,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(h||!this._tooltipHandlersAdded){var x=h?"off":"on",M={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?M.add=this._openTooltip:(M.mouseover=this._openTooltip,M.mouseout=this.closeTooltip,M.click=this._openTooltip,this._map?this._addFocusListeners():M.add=this._addFocusListeners),this._tooltip.options.sticky&&(M.mousemove=this._moveTooltip),this[x](M),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof jr||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var x="function"==typeof h.getElement&&h.getElement();x&&(on(x,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),on(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var x="function"==typeof h.getElement&&h.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(this._tooltip&&this._map){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;return void this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(h)})}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var M,k,x=h.latlng;this._tooltip.options.sticky&&h.originalEvent&&(M=this._map.mouseEventToContainerPoint(h.originalEvent),k=this._map.containerPointToLayerPoint(M),x=this._map.layerPointToLatLng(k)),this._tooltip.setLatLng(x)}});var Es=sn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var x=h&&"DIV"===h.tagName?h:document.createElement("div"),M=this.options;if(M.html instanceof Element?(Ao(x),x.appendChild(M.html)):x.innerHTML=!1!==M.html?M.html:"",M.bgPos){var k=dn(M.bgPos);x.style.backgroundPosition=-k.x+"px "+-k.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});sn.Default=tn;var ao=Go.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Bt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){St(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),or(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Us(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(el(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Le(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof En?h:new En(h,h)},_updateZIndex:function(){this._container&&null!=this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var X,x=this.getPane().children,M=-h(-1/0,1/0),k=0,U=x.length;k<U;k++)X=x[k].style.zIndex,x[k]!==this._container&&X&&(M=h(M,+X));isFinite(M)&&(this.options.zIndex=M+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Bt.ielt9){sr(this._container,this.options.opacity);var h=+new Date,x=!1,M=!1;for(var k in this._tiles){var U=this._tiles[k];if(U.current&&U.loaded){var X=Math.min(1,(h-U.loaded)/200);sr(U.el,X),X<1?x=!0:(U.active?M=!0:this._onOpaqueTile(U),U.active=!0)}}M&&!this._noPrune&&this._pruneTiles(),x&&(Tn(this._fadeFrame),this._fadeFrame=kt(this._updateOpacity,this))}},_onOpaqueTile:Re,_initContainer:function(){this._container||(this._container=On("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,x=this.options.maxZoom;if(void 0!==h){for(var M in this._levels)M=Number(M),this._levels[M].el.children.length||M===h?(this._levels[M].el.style.zIndex=x-Math.abs(h-M),this._onUpdateLevel(M)):(or(this._levels[M].el),this._removeTilesAtZoom(M),this._onRemoveLevel(M),delete this._levels[M]);var k=this._levels[h],U=this._map;return k||((k=this._levels[h]={}).el=On("div","leaflet-tile-container leaflet-zoom-animated",this._container),k.el.style.zIndex=x,k.origin=U.project(U.unproject(U.getPixelOrigin()),h).round(),k.zoom=h,this._setZoomTransform(k,U.getCenter(),U.getZoom()),this._onCreateLevel(k)),this._level=k,k}},_onUpdateLevel:Re,_onRemoveLevel:Re,_onCreateLevel:Re,_pruneTiles:function(){if(this._map){var h,x,M=this._map.getZoom();if(M>this.options.maxZoom||M<this.options.minZoom)return void this._removeAllTiles();for(h in this._tiles)(x=this._tiles[h]).retain=x.current;for(h in this._tiles)if((x=this._tiles[h]).current&&!x.active){var k=x.coords;this._retainParent(k.x,k.y,k.z,k.z-5)||this._retainChildren(k.x,k.y,k.z,k.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var x in this._tiles)this._tiles[x].coords.z===h&&this._removeTile(x)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)or(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,x,M,k){var U=Math.floor(h/2),X=Math.floor(x/2),we=M-1,qe=new En(+U,+X);qe.z=+we;var Oe=this._tileCoordsToKey(qe),Tt=this._tiles[Oe];return Tt&&Tt.active?(Tt.retain=!0,!0):(Tt&&Tt.loaded&&(Tt.retain=!0),we>k&&this._retainParent(U,X,we,k))},_retainChildren:function(h,x,M,k){for(var U=2*h;U<2*h+2;U++)for(var X=2*x;X<2*x+2;X++){var we=new En(U,X);we.z=M+1;var qe=this._tileCoordsToKey(we),Oe=this._tiles[qe];Oe&&Oe.active?Oe.retain=!0:(Oe&&Oe.loaded&&(Oe.retain=!0),M+1<k&&this._retainChildren(U,X,M+1,k))}},_resetView:function(h){var x=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var x=this.options;return void 0!==x.minNativeZoom&&h<x.minNativeZoom?x.minNativeZoom:void 0!==x.maxNativeZoom&&x.maxNativeZoom<h?x.maxNativeZoom:h},_setView:function(h,x,M,k){var U=Math.round(x);U=void 0!==this.options.maxZoom&&U>this.options.maxZoom||void 0!==this.options.minZoom&&U<this.options.minZoom?void 0:this._clampZoom(U),(!k||this.options.updateWhenZooming&&U!==this._tileZoom)&&(this._tileZoom=U,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==U&&this._update(h),M||this._pruneTiles(),this._noPrune=!!M),this._setZoomTransforms(h,x)},_setZoomTransforms:function(h,x){for(var M in this._levels)this._setZoomTransform(this._levels[M],h,x)},_setZoomTransform:function(h,x,M){var k=this._map.getZoomScale(M,h.zoom),U=h.origin.multiplyBy(k).subtract(this._map._getNewPixelOrigin(x,M)).round();Bt.any3d?ss(h.el,U,k):Xi(h.el,U)},_resetGrid:function(){var h=this._map,x=h.options.crs,M=this._tileSize=this.getTileSize(),k=this._tileZoom,U=this._map.getPixelWorldBounds(this._tileZoom);U&&(this._globalTileRange=this._pxBoundsToTileRange(U)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,x.wrapLng[0]],k).x/M.x),Math.ceil(h.project([0,x.wrapLng[1]],k).x/M.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([x.wrapLat[0],0],k).y/M.x),Math.ceil(h.project([x.wrapLat[1],0],k).y/M.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var x=this._map,M=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),k=x.getZoomScale(M,this._tileZoom),U=x.project(h,this._tileZoom).floor(),X=x.getSize().divideBy(2*k);return new In(U.subtract(X),U.add(X))},_update:function(h){var x=this._map;if(x){var M=this._clampZoom(x.getZoom());if(void 0===h&&(h=x.getCenter()),void 0!==this._tileZoom){var k=this._getTiledPixelBounds(h),U=this._pxBoundsToTileRange(k),X=U.getCenter(),we=[],qe=this.options.keepBuffer,Oe=new In(U.getBottomLeft().subtract([qe,-qe]),U.getTopRight().add([qe,-qe]));if(!(isFinite(U.min.x)&&isFinite(U.min.y)&&isFinite(U.max.x)&&isFinite(U.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Tt in this._tiles){var rn=this._tiles[Tt].coords;(rn.z!==this._tileZoom||!Oe.contains(new En(rn.x,rn.y)))&&(this._tiles[Tt].current=!1)}if(Math.abs(M-this._tileZoom)>1)return void this._setView(h,M);for(var bn=U.min.y;bn<=U.max.y;bn++)for(var xn=U.min.x;xn<=U.max.x;xn++){var Fr=new En(xn,bn);if(Fr.z=this._tileZoom,this._isValidTile(Fr)){var ur=this._tiles[this._tileCoordsToKey(Fr)];ur?ur.current=!0:we.push(Fr)}}if(we.sort(function(Sr,Qs){return Sr.distanceTo(X)-Qs.distanceTo(X)}),0!==we.length){this._loading||(this._loading=!0,this.fire("loading"));var Ki=document.createDocumentFragment();for(xn=0;xn<we.length;xn++)this._addTile(we[xn],Ki);this._level.el.appendChild(Ki)}}}},_isValidTile:function(h){var x=this._map.options.crs;if(!x.infinite){var M=this._globalTileRange;if(!x.wrapLng&&(h.x<M.min.x||h.x>M.max.x)||!x.wrapLat&&(h.y<M.min.y||h.y>M.max.y))return!1}if(!this.options.bounds)return!0;var k=this._tileCoordsToBounds(h);return Oi(this.options.bounds).overlaps(k)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var x=this._map,M=this.getTileSize(),k=h.scaleBy(M),U=k.add(M);return[x.unproject(k,h.z),x.unproject(U,h.z)]},_tileCoordsToBounds:function(h){var x=this._tileCoordsToNwSe(h),M=new Zi(x[0],x[1]);return this.options.noWrap||(M=this._map.wrapLatLngBounds(M)),M},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var x=h.split(":"),M=new En(+x[0],+x[1]);return M.z=+x[2],M},_removeTile:function(h){var x=this._tiles[h];x&&(or(x.el),delete this._tiles[h],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){ot(h,"leaflet-tile");var x=this.getTileSize();h.style.width=x.x+"px",h.style.height=x.y+"px",h.onselectstart=Re,h.onmousemove=Re,Bt.ielt9&&this.options.opacity<1&&sr(h,this.options.opacity)},_addTile:function(h,x){var M=this._getTilePos(h),k=this._tileCoordsToKey(h),U=this.createTile(this._wrapCoords(h),u(this._tileReady,this,h));this._initTile(U),this.createTile.length<2&&kt(u(this._tileReady,this,h,null,U)),Xi(U,M),this._tiles[k]={el:U,coords:h,current:!0},x.appendChild(U),this.fire("tileloadstart",{tile:U,coords:h})},_tileReady:function(h,x,M){x&&this.fire("tileerror",{error:x,tile:M,coords:h});var k=this._tileCoordsToKey(h);(M=this._tiles[k])&&(M.loaded=+new Date,this._map._fadeAnimated?(sr(M.el,0),Tn(this._fadeFrame),this._fadeFrame=kt(this._updateOpacity,this)):(M.active=!0,this._pruneTiles()),x||(ot(M.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:M.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Bt.ielt9||!this._map._fadeAnimated?kt(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var x=new En(this._wrapX?Ae(h.x,this._wrapX):h.x,this._wrapY?Ae(h.y,this._wrapY):h.y);return x.z=h.z,x},_pxBoundsToTileRange:function(h){var x=this.getTileSize();return new In(h.min.unscaleBy(x).floor(),h.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});var al=ao.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,x){this._url=h,(x=St(this,x)).detectRetina&&Bt.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),"string"==typeof x.subdomains&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,x){return this._url===h&&void 0===x&&(x=!0),this._url=h,x||this.redraw(),this},createTile:function(h,x){var M=document.createElement("img");return on(M,"load",u(this._tileOnLoad,this,x,M)),on(M,"error",u(this._tileOnError,this,x,M)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(M.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(M.referrerPolicy=this.options.referrerPolicy),M.alt="",M.src=this.getTileUrl(h),M},getTileUrl:function(h){var x={r:Bt.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var M=this._globalTileRange.max.y-h.y;this.options.tms&&(x.y=M),x["-y"]=M}return he(this._url,Ue(x,this.options))},_tileOnLoad:function(h,x){Bt.ielt9?setTimeout(u(h,this,null,x),0):h(null,x)},_tileOnError:function(h,x,M){var k=this.options.errorTileUrl;k&&x.getAttribute("src")!==k&&(x.src=k),h(M,x)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom;return this.options.zoomReverse&&(h=this.options.maxZoom-h),h+this.options.zoomOffset},_getSubdomain:function(h){var x=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var h,x;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&((x=this._tiles[h].el).onload=Re,x.onerror=Re,!x.complete)){x.src=Ge;var M=this._tiles[h].coords;or(x),delete this._tiles[h],this.fire("tileabort",{tile:x,coords:M})}},_removeTile:function(h){var x=this._tiles[h];if(x)return x.el.setAttribute("src",Ge),ao.prototype._removeTile.call(this,h)},_tileReady:function(h,x,M){if(this._map&&(!M||M.getAttribute("src")!==Ge))return ao.prototype._tileReady.call(this,h,x,M)}});function er(h,x){return new al(h,x)}var ll=al.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,x){this._url=h;var M=Ue({},this.defaultWmsParams);for(var k in x)k in this.options||(M[k]=x[k]);var U=(x=St(this,x)).detectRetina&&Bt.retina?2:1,X=this.getTileSize();M.width=X.x*U,M.height=X.y*U,this.wmsParams=M},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version),this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=this._crs.code,al.prototype.onAdd.call(this,h)},getTileUrl:function(h){var x=this._tileCoordsToNwSe(h),M=this._crs,k=si(M.project(x[0]),M.project(x[1])),U=k.min,X=k.max,we=(this._wmsVersion>=1.3&&this._crs===Vh?[U.y,U.x,X.y,X.x]:[U.x,U.y,X.x,X.y]).join(","),qe=al.prototype.getTileUrl.call(this,h);return qe+Ft(this.wmsParams,qe,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(h,x){return Ue(this.wmsParams,h),x||this.redraw(),this}});al.WMS=ll,er.wms=function tu(h,x){return new ll(h,x)};var Wo=Go.extend({options:{padding:.1},initialize:function(h){St(this,h),Ie(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ot(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,x){var M=this._map.getZoomScale(x,this._zoom),k=this._map.getSize().multiplyBy(.5+this.options.padding),U=this._map.project(this._center,x),X=k.multiplyBy(-M).add(U).subtract(this._map._getNewPixelOrigin(h,x));Bt.any3d?ss(this._container,X,M):Xi(this._container,X)},_reset:function(){for(var h in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,x=this._map.getSize(),M=this._map.containerPointToLayerPoint(x.multiplyBy(-h)).round();this._bounds=new In(M,M.add(x.multiplyBy(1+2*h)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Nn=Wo.extend({options:{tolerance:0},getEvents:function(){var h=Wo.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Wo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");on(h,"mousemove",this._onMouseMove,this),on(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),on(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){Tn(this._redrawRequest),delete this._ctx,or(this._container),ai(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var x in this._redrawBounds=null,this._layers)this._layers[x]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Wo.prototype._update.call(this);var h=this._bounds,x=this._container,M=h.getSize(),k=Bt.retina?2:1;Xi(x,h.min),x.width=k*M.x,x.height=k*M.y,x.style.width=M.x+"px",x.style.height=M.y+"px",Bt.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){Wo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[Ie(h)]=h;var x=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var x=h._order,M=x.next,k=x.prev;M?M.prev=k:this._drawLast=k,k?k.next=M:this._drawFirst=M,delete h._order,delete this._layers[Ie(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if("string"==typeof h.options.dashArray){var k,U,x=h.options.dashArray.split(/[, ]+/),M=[];for(U=0;U<x.length;U++){if(k=Number(x[U]),isNaN(k))return;M.push(k)}h.options._dashArray=M}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||kt(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var x=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new In,this._redrawBounds.extend(h._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(h._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var x=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,x=this._redrawBounds;if(this._ctx.save(),x){var M=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,M.x,M.y),this._ctx.clip()}this._drawing=!0;for(var k=this._drawFirst;k;k=k.next)h=k.layer,(!x||h._pxBounds&&h._pxBounds.intersects(x))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,x){if(this._drawing){var M,k,U,X,we=h._parts,qe=we.length,Oe=this._ctx;if(qe){for(Oe.beginPath(),M=0;M<qe;M++){for(k=0,U=we[M].length;k<U;k++)Oe[k?"lineTo":"moveTo"]((X=we[M][k]).x,X.y);x&&Oe.closePath()}this._fillStroke(Oe,h)}}},_updateCircle:function(h){if(this._drawing&&!h._empty()){var x=h._point,M=this._ctx,k=Math.max(Math.round(h._radius),1),U=(Math.max(Math.round(h._radiusY),1)||k)/k;1!==U&&(M.save(),M.scale(1,U)),M.beginPath(),M.arc(x.x,x.y/U,k,0,2*Math.PI,!1),1!==U&&M.restore(),this._fillStroke(M,h)}},_fillStroke:function(h,x){var M=x.options;M.fill&&(h.globalAlpha=M.fillOpacity,h.fillStyle=M.fillColor||M.color,h.fill(M.fillRule||"evenodd")),M.stroke&&0!==M.weight&&(h.setLineDash&&h.setLineDash(x.options&&x.options._dashArray||[]),h.globalAlpha=M.opacity,h.lineWidth=M.weight,h.strokeStyle=M.color,h.lineCap=M.lineCap,h.lineJoin=M.lineJoin,h.stroke())},_onClick:function(h){for(var M,k,x=this._map.mouseEventToLayerPoint(h),U=this._drawFirst;U;U=U.next)(M=U.layer).options.interactive&&M._containsPoint(x)&&("click"!==h.type&&"preclick"!==h.type||!this._map._draggableMoved(M))&&(k=M);this._fireEvent(!!k&&[k],h)},_onMouseMove:function(h){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var x=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,x)}},_handleMouseOut:function(h){var x=this._hoveredLayer;x&&(vn(this._container,"leaflet-interactive"),this._fireEvent([x],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,x){if(!this._mouseHoverThrottled){for(var M,k,U=this._drawFirst;U;U=U.next)(M=U.layer).options.interactive&&M._containsPoint(x)&&(k=M);k!==this._hoveredLayer&&(this._handleMouseOut(h),k&&(ot(this._container,"leaflet-interactive"),this._fireEvent([k],h,"mouseover"),this._hoveredLayer=k)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],h),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,x,M){this._map._fireDOMEvent(x,M||x.type,h)},_bringToFront:function(h){var x=h._order;if(x){var M=x.next,k=x.prev;if(!M)return;M.prev=k,k?k.next=M:M&&(this._drawFirst=M),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(h)}},_bringToBack:function(h){var x=h._order;if(x){var M=x.next,k=x.prev;if(!k)return;k.next=M,M?M.prev=k:k&&(this._drawLast=k),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(h)}}});function Ul(h){return Bt.canvas?new Nn(h):null}var cl=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Rn={_initContainer:function(){this._container=On("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Wo.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var x=h._container=cl("shape");ot(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",h._path=cl("path"),x.appendChild(h._path),this._updateStyle(h),this._layers[Ie(h)]=h},_addPath:function(h){var x=h._container;this._container.appendChild(x),h.options.interactive&&h.addInteractiveTarget(x)},_removePath:function(h){var x=h._container;or(x),h.removeInteractiveTarget(x),delete this._layers[Ie(h)]},_updateStyle:function(h){var x=h._stroke,M=h._fill,k=h.options,U=h._container;U.stroked=!!k.stroke,U.filled=!!k.fill,k.stroke?(x||(x=h._stroke=cl("stroke")),U.appendChild(x),x.weight=k.weight+"px",x.color=k.color,x.opacity=k.opacity,x.dashStyle=k.dashArray?tt(k.dashArray)?k.dashArray.join(" "):k.dashArray.replace(/( *, *)/g," "):"",x.endcap=k.lineCap.replace("butt","flat"),x.joinstyle=k.lineJoin):x&&(U.removeChild(x),h._stroke=null),k.fill?(M||(M=h._fill=cl("fill")),U.appendChild(M),M.color=k.fillColor||k.color,M.opacity=k.fillOpacity):M&&(U.removeChild(M),h._fill=null)},_updateCircle:function(h){var x=h._point.round(),M=Math.round(h._radius),k=Math.round(h._radiusY||M);this._setPath(h,h._empty()?"M0 0":"AL "+x.x+","+x.y+" "+M+","+k+" 0,23592600")},_setPath:function(h,x){h._path.v=x},_bringToFront:function(h){Us(h._container)},_bringToBack:function(h){el(h._container)}},br=Bt.vml?cl:go,ii=Wo.extend({_initContainer:function(){this._container=br("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=br("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){or(this._container),ai(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Wo.prototype._update.call(this);var h=this._bounds,x=h.getSize(),M=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,M.setAttribute("width",x.x),M.setAttribute("height",x.y)),Xi(M,h.min),M.setAttribute("viewBox",[h.min.x,h.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(h){var x=h._path=br("path");h.options.className&&ot(x,h.options.className),h.options.interactive&&ot(x,"leaflet-interactive"),this._updateStyle(h),this._layers[Ie(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){or(h._path),h.removeInteractiveTarget(h._path),delete this._layers[Ie(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var x=h._path,M=h.options;x&&(M.stroke?(x.setAttribute("stroke",M.color),x.setAttribute("stroke-opacity",M.opacity),x.setAttribute("stroke-width",M.weight),x.setAttribute("stroke-linecap",M.lineCap),x.setAttribute("stroke-linejoin",M.lineJoin),M.dashArray?x.setAttribute("stroke-dasharray",M.dashArray):x.removeAttribute("stroke-dasharray"),M.dashOffset?x.setAttribute("stroke-dashoffset",M.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),M.fill?(x.setAttribute("fill",M.fillColor||M.color),x.setAttribute("fill-opacity",M.fillOpacity),x.setAttribute("fill-rule",M.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(h,x){this._setPath(h,sc(h._parts,x))},_updateCircle:function(h){var x=h._point,M=Math.max(Math.round(h._radius),1),U="a"+M+","+(Math.max(Math.round(h._radiusY),1)||M)+" 0 1,0 ",X=h._empty()?"M0 0":"M"+(x.x-M)+","+x.y+U+2*M+",0 "+U+2*-M+",0 ";this._setPath(h,X)},_setPath:function(h,x){h._path.setAttribute("d",x)},_bringToFront:function(h){Us(h._path)},_bringToBack:function(h){el(h._path)}});function Tr(h){return Bt.svg||Bt.vml?new ii(h):null}Bt.vml&&ii.include(Rn),jt.include({getRenderer:function(h){var x=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(h){if("overlayPane"===h||void 0===h)return!1;var x=this._paneRenderers[h];return void 0===x&&(x=this._createRenderer({pane:h}),this._paneRenderers[h]=x),x},_createRenderer:function(h){return this.options.preferCanvas&&Ul(h)||Tr(h)}});var cr=ni.extend({initialize:function(h,x){ni.prototype.initialize.call(this,this._boundsToLatLngs(h),x)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return[(h=Oi(h)).getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});ii.create=br,ii.pointsToPath=sc,Oo.geometryToLayer=Xs,Oo.coordsToLatLng=Zo,Oo.coordsToLatLngs=bs,Oo.latLngToCoords=eu,Oo.latLngsToCoords=sl,Oo.getFeature=Ys,Oo.asFeature=Ks,jt.mergeOptions({boxZoom:!0});var Kr=Xr.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ai(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){or(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||1!==h.which&&1!==h.button)return!1;this._clearDeferredResetState(),this._resetState(),gi(),Ei(),this._startPoint=this._map.mouseEventToContainerPoint(h),on(document,{contextmenu:Sa,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=On("div","leaflet-zoom-box",this._container),ot(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var x=new In(this._point,this._startPoint),M=x.getSize();Xi(this._box,x.min),this._box.style.width=M.x+"px",this._box.style.height=M.y+"px"},_finish:function(){this._moved&&(or(this._box),vn(this._container,"leaflet-crosshair")),ar(),Pn(),ai(document,{contextmenu:Sa,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if((1===h.which||1===h.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var x=new Zi(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(h){27===h.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});jt.addInitHook("addHandler","boxZoom",Kr),jt.mergeOptions({doubleClickZoom:!0});var Oa=Xr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var x=this._map,M=x.getZoom(),k=x.options.zoomDelta,U=h.originalEvent.shiftKey?M-k:M+k;"center"===x.options.doubleClickZoom?x.setZoom(U):x.setZoomAround(h.containerPoint,U)}});jt.addInitHook("addHandler","doubleClickZoom",Oa),jt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Na=Xr.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new $n(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}ot(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){vn(this._map._container,"leaflet-grab"),vn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=Oi(this._map.options.maxBounds);this._offsetLimit=si(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var x=this._lastTime=+new Date,M=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(M),this._times.push(x),this._prunePositions(x)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,x){return h-(h-x)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var h=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;h.x<x.min.x&&(h.x=this._viscousLimit(h.x,x.min.x)),h.y<x.min.y&&(h.y=this._viscousLimit(h.y,x.min.y)),h.x>x.max.x&&(h.x=this._viscousLimit(h.x,x.max.x)),h.y>x.max.y&&(h.y=this._viscousLimit(h.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,x=Math.round(h/2),M=this._initialWorldOffset,k=this._draggable._newPos.x,U=(k-x+M)%h+x-M,X=(k+x+M)%h-x-M,we=Math.abs(U+M)<Math.abs(X+M)?U:X;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(h){var x=this._map,M=x.options,k=!M.inertia||h.noInertia||this._times.length<2;if(x.fire("dragend",h),k)x.fire("moveend");else{this._prunePositions(+new Date);var U=this._lastPos.subtract(this._positions[0]),we=M.easeLinearity,qe=U.multiplyBy(we/((this._lastTime-this._times[0])/1e3)),Oe=qe.distanceTo([0,0]),Tt=Math.min(M.inertiaMaxSpeed,Oe),rn=qe.multiplyBy(Tt/Oe),bn=Tt/(M.inertiaDeceleration*we),xn=rn.multiplyBy(-bn/2).round();xn.x||xn.y?(xn=x._limitOffset(xn,x.options.maxBounds),kt(function(){x.panBy(xn,{duration:bn,easeLinearity:we,noMoveStart:!0,animate:!0})})):x.fire("moveend")}}});jt.addInitHook("addHandler","dragging",Na),jt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var hl=Xr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),on(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ai(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,x=document.documentElement,M=h.scrollTop||x.scrollTop,k=h.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(k,M)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var k,U,x=this._panKeys={},M=this.keyCodes;for(k=0,U=M.left.length;k<U;k++)x[M.left[k]]=[-1*h,0];for(k=0,U=M.right.length;k<U;k++)x[M.right[k]]=[h,0];for(k=0,U=M.down.length;k<U;k++)x[M.down[k]]=[0,h];for(k=0,U=M.up.length;k<U;k++)x[M.up[k]]=[0,-1*h]},_setZoomDelta:function(h){var k,U,x=this._zoomKeys={},M=this.keyCodes;for(k=0,U=M.zoomIn.length;k<U;k++)x[M.zoomIn[k]]=h;for(k=0,U=M.zoomOut.length;k<U;k++)x[M.zoomOut[k]]=-h},_addHooks:function(){on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ai(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var k,x=h.keyCode,M=this._map;if(x in this._panKeys){if(!M._panAnim||!M._panAnim._inProgress)if(k=this._panKeys[x],h.shiftKey&&(k=dn(k).multiplyBy(3)),M.options.maxBounds&&(k=M._limitOffset(dn(k),M.options.maxBounds)),M.options.worldCopyJump){var U=M.wrapLatLng(M.unproject(M.project(M.getCenter()).add(k)));M.panTo(U)}else M.panBy(k)}else if(x in this._zoomKeys)M.setZoom(M.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[x]);else{if(27!==x||!M._popup||!M._popup.options.closeOnEscapeKey)return;M.closePopup()}Sa(h)}}});jt.addInitHook("addHandler","keyboard",hl),jt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var jl=Xr.extend({addHooks:function(){on(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ai(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var x=Xc(h),M=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var k=Math.max(M-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),k),Sa(h)},_performZoom:function(){var h=this._map,x=h.getZoom(),M=this._map.options.zoomSnap||0;h._stop();var U=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,X=M?Math.ceil(U/M)*M:U,we=h._limitZoom(x+(this._delta>0?X:-X))-x;this._delta=0,this._startTime=null,we&&("center"===h.options.scrollWheelZoom?h.setZoom(x+we):h.setZoomAround(this._lastMousePos,x+we))}});jt.addInitHook("addHandler","scrollWheelZoom",jl);jt.mergeOptions({tapHold:Bt.touchNative&&Bt.safari&&Bt.mobile,tapTolerance:15});var Yi=Xr.extend({addHooks:function(){on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ai(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),1===h.touches.length){var x=h.touches[0];this._startPos=this._newPos=new En(x.clientX,x.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(on(document,"touchend",Ci),on(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),600),on(document,"touchend touchcancel contextmenu",this._cancel,this),on(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){ai(document,"touchend",Ci),ai(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),ai(document,"touchend touchcancel contextmenu",this._cancel,this),ai(document,"touchmove",this._onMove,this)},_onMove:function(h){var x=h.touches[0];this._newPos=new En(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,x){var M=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});M._simulated=!0,x.target.dispatchEvent(M)}});jt.addInitHook("addHandler","tapHold",Yi),jt.mergeOptions({touchZoom:Bt.touch,bounceAtZoomLimits:!0});var Jt=Xr.extend({addHooks:function(){ot(this._map._container,"leaflet-touch-zoom"),on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){vn(this._map._container,"leaflet-touch-zoom"),ai(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var x=this._map;if(h.touches&&2===h.touches.length&&!x._animatingZoom&&!this._zooming){var M=x.mouseEventToContainerPoint(h.touches[0]),k=x.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),"center"!==x.options.touchZoom&&(this._pinchStartLatLng=x.containerPointToLatLng(M.add(k)._divideBy(2))),this._startDist=M.distanceTo(k),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),on(document,"touchmove",this._onTouchMove,this),on(document,"touchend touchcancel",this._onTouchEnd,this),Ci(h)}},_onTouchMove:function(h){if(h.touches&&2===h.touches.length&&this._zooming){var x=this._map,M=x.mouseEventToContainerPoint(h.touches[0]),k=x.mouseEventToContainerPoint(h.touches[1]),U=M.distanceTo(k)/this._startDist;if(this._zoom=x.getScaleZoom(U,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&U<1||this._zoom>x.getMaxZoom()&&U>1)&&(this._zoom=x._limitZoom(this._zoom)),"center"===x.options.touchZoom){if(this._center=this._startLatLng,1===U)return}else{var X=M._add(k)._divideBy(2)._subtract(this._centerPoint);if(1===U&&0===X.x&&0===X.y)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(X),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),Tn(this._animRequest);var we=u(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=kt(we,this,!0),Ci(h)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,Tn(this._animRequest),ai(document,"touchmove",this._onTouchMove,this),ai(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});jt.addInitHook("addHandler","touchZoom",Jt),jt.BoxZoom=Kr,jt.DoubleClickZoom=Oa,jt.Drag=Na,jt.Keyboard=hl,jt.ScrollWheelZoom=jl,jt.TapHold=Yi,jt.TouchZoom=Jt,ve.Bounds=In,ve.Browser=Bt,ve.CRS=Zr,ve.Canvas=Nn,ve.Circle=Co,ve.CircleMarker=zl,ve.Class=qi,ve.Control=so,ve.DivIcon=Es,ve.DivOverlay=hs,ve.DomEvent=Fh,ve.DomUtil=cn,ve.Draggable=$n,ve.Evented=Dn,ve.FeatureGroup=jr,ve.GeoJSON=Oo,ve.GridLayer=ao,ve.Handler=Xr,ve.Icon=sn,ve.ImageOverlay=ws,ve.LatLng=li,ve.LatLngBounds=Zi,ve.Layer=Go,ve.LayerGroup=ko,ve.LineUtil=Gd,ve.Map=jt,ve.Marker=ls,ve.Mixin=fi,ve.Path=qo,ve.Point=En,ve.PolyUtil=Kc,ve.Polygon=ni,ve.Polyline=xr,ve.Popup=ka,ve.PosAnimation=Ur,ve.Projection=vs,ve.Rectangle=cr,ve.Renderer=Wo,ve.SVG=ii,ve.SVGOverlay=Uh,ve.TileLayer=al,ve.Tooltip=mc,ve.Transformation=is,ve.Util=ki,ve.VideoOverlay=Uu,ve.bind=u,ve.bounds=si,ve.canvas=Ul,ve.circle=function Bl(h,x,M){return new Co(h,x,M)},ve.circleMarker=function xs(h,x){return new zl(h,x)},ve.control=Ho,ve.divIcon=function gc(h){return new Es(h)},ve.extend=Ue,ve.featureGroup=function(h,x){return new jr(h,x)},ve.geoJSON=Js,ve.geoJson=Vu,ve.gridLayer=function _c(h){return new ao(h)},ve.icon=function Bu(h){return new sn(h)},ve.imageOverlay=function(h,x,M){return new ws(h,x,M)},ve.latLng=Mn,ve.latLngBounds=Oi,ve.layerGroup=function(h,x){return new ko(h,x)},ve.map=function zh(h,x){return new jt(h,x)},ve.marker=function rl(h,x){return new ls(h,x)},ve.point=dn,ve.polygon=function Qc(h,x){return new ni(h,x)},ve.polyline=function cs(h,x){return new xr(h,x)},ve.popup=function(h,x){return new ka(h,x)},ve.rectangle=function ul(h,x){return new cr(h,x)},ve.setOptions=St,ve.stamp=Ie,ve.svg=Tr,ve.svgOverlay=function us(h,x,M){return new Uh(h,x,M)},ve.tileLayer=er,ve.tooltip=function(h,x){return new mc(h,x)},ve.transformation=An,ve.version="1.9.4",ve.videoOverlay=function Wd(h,x,M){return new Uu(h,x,M)};var ft=window.L;ve.noConflict=function(){return window.L=ft,this},window.L=ve}(qt)},220:Zt=>{var Ue=/^\s+|\s+$/g,Me=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,Q=/^0o[0-7]+$/i,Ie=parseInt,Le="object"==typeof global&&global&&global.Object===Object&&global,Ae="object"==typeof self&&self&&self.Object===Object&&self,Re=Le||Ae||Function("return this")(),Yt=Object.prototype.toString,Vt=Math.max,St=Math.min,Ft=function(){return Re.Date.now()};function he(ke){var at=typeof ke;return!!ke&&("object"==at||"function"==at)}function Ge(ke){if("number"==typeof ke)return ke;if(function bt(ke){return"symbol"==typeof ke||function tt(ke){return!!ke&&"object"==typeof ke}(ke)&&"[object Symbol]"==Yt.call(ke)}(ke))return NaN;if(he(ke)){var at="function"==typeof ke.valueOf?ke.valueOf():ke;ke=he(at)?at+"":at}if("string"!=typeof ke)return 0===ke?ke:+ke;ke=ke.replace(Ue,"");var ze=u.test(ke);return ze||Q.test(ke)?Ie(ke.slice(2),ze?2:8):Me.test(ke)?NaN:+ke}Zt.exports=function Ot(ke,at,ze){var Nt,Wt,kt,Tn,ki,qi,qr=0,Er=!1,Dn=!1,En=!0;if("function"!=typeof ke)throw new TypeError("Expected a function");function rr(di){var pi=Nt,ln=Wt;return Nt=Wt=void 0,qr=di,Tn=ke.apply(ln,pi)}function si(di){var pi=di-qi;return void 0===qi||pi>=at||pi<0||Dn&&di-qr>=kt}function Zi(){var di=Ft();if(si(di))return Oi(di);ki=setTimeout(Zi,function In(di){var is=at-(di-qi);return Dn?St(is,kt-(di-qr)):is}(di))}function Oi(di){return ki=void 0,En&&Nt?rr(di):(Nt=Wt=void 0,Tn)}function Zr(){var di=Ft(),pi=si(di);if(Nt=arguments,Wt=this,qi=di,pi){if(void 0===ki)return function dn(di){return qr=di,ki=setTimeout(Zi,at),Er?rr(di):Tn}(qi);if(Dn)return ki=setTimeout(Zi,at),rr(qi)}return void 0===ki&&(ki=setTimeout(Zi,at)),Tn}return at=Ge(at)||0,he(ze)&&(Er=!!ze.leading,kt=(Dn="maxWait"in ze)?Vt(Ge(ze.maxWait)||0,at):kt,En="trailing"in ze?!!ze.trailing:En),Zr.cancel=function li(){void 0!==ki&&clearTimeout(ki),qr=0,Nt=qi=Wt=ki=void 0},Zr.flush=function Mn(){return void 0===ki?Tn:Oi(Ft())},Zr}},574:function(Zt){Zt.exports=function(){"use strict";var qt,ve,gt;function Ue(u,Q){if(qt)if(ve){var Ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+qt+")(sharedChunk); ("+ve+")(sharedChunk); self.onerror = null;",Le={};qt(Le),gt=Q(Le),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(gt.workerUrl=window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"})))}else ve=Q;else qt=Q}return Ue(0,function(u){var Q=typeof self<"u"?self:{},Ie="2.15.0";let Le;const Ae={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Le){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Le=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{Le=o}}return Le},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ae.API_URL)return null;try{const o=new URL(Ae.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Re={supported:!1,testSupport:function(o){!Vt&&Yt&&(St?Ft(o):yt=o)}};let yt,Yt,Vt=!1,St=!1;function Ft(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Yt),o.isContextLost())return;Re.supported=!0}catch{}o.deleteTexture(i),Vt=!0}Q.document&&(Yt=Q.document.createElement("img"),Yt.onload=function(){yt&&Ft(yt),yt=null,St=!0},Yt.onerror=function(){Vt=!0,yt=null},Yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ot="01";function he(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var tt=bt;function bt(o,i,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=s,this.p2y=c}bt.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(void 0===i&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var p=this.sampleCurveX(s)-o;if(Math.abs(p)<i)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=p/g}var v=0,w=1;for(s=o,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-o)<i));c++)o>p?v=s:w=s,s=.5*(w-v)+v;return s},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var Ge=he(tt),ke=at;function at(o,i){this.x=o,this.y=i}at.prototype={clone:function(){return new at(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,s=o.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),s=Math.sin(o),c=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,i){var s=Math.cos(o),c=Math.sin(o),p=i.y+c*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-c*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},at.convert=function(o){return o instanceof at?o:Array.isArray(o)?new at(o[0],o[1]):o};var ze=he(ke);const Nt=Math.PI/180,Wt=180/Math.PI;function kt(o){return o*Nt}function Tn(o){return o*Wt}const ki=[[0,0],[1,0],[1,1],[0,1]];function qi(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,s=i*o;return 4*(o<.5?s:3*(o-i)+s-.75)}function qr(o,i,s,c){const p=new Ge(o,i,s,c);return function(g){return p.solve(g)}}const Er=qr(.25,.1,.25,1);function Dn(o,i,s){return Math.min(s,Math.max(i,o))}function En(o,i,s){return(s=Dn((s-o)/(i-o),0,1))*s*(3-2*s)}function rr(o,i,s){const c=s-i,p=((o-i)%c+c)%c+i;return p===i?s:p}function dn(o,i,s){if(!o.length)return s(null,[]);let c=o.length;const p=new Array(o.length);let g=null;o.forEach((v,w)=>{i(v,(T,S)=>{T&&(g=T),p[w]=S,0==--c&&s(g,p)})})}function In(o){const i=[];for(const s in o)i.push(o[s]);return i}function si(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}let Zi=1;function Oi(){return Zi++}function li(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Mn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Zr(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function di(o,i){o.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function pi(o,i){return-1!==o.indexOf(i,o.length-i.length)}function ln(o,i,s){const c={};for(const p in o)c[p]=i.call(s||this,o[p],p,o);return c}function is(o,i,s){const c={};for(const p in o)i.call(s||this,o[p],p,o)&&(c[p]=o[p]);return c}function An(o){return Array.isArray(o)?o.map(An):"object"==typeof o&&o?ln(o,An):o}const Ns={};function Ji(o){Ns[o]||(typeof console<"u"&&console.warn(o),Ns[o]=!0)}function go(o,i,s){return(s.y-o.y)*(i.x-o.x)>(i.y-o.y)*(s.x-o.x)}function sc(o){let i=0;for(let s,c,p=0,g=o.length,v=g-1;p<g;v=p++)s=o[p],c=o[v],i+=(c.x-s.x)*(s.y+c.y);return i}function rs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function no(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,g)=>{const v=p||g;return i[c]=!v||v.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let qc=null;function Ml(o){if(null==qc){const i=o.navigator?o.navigator.userAgent:null;qc=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return qc}function Sl(o){try{const i=Q[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function ya(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}const Ya="mapbox-tiles";let io,Fs,ac=500,Zc=50;function va(){try{return Q.caches}catch{}}function xa(){va()&&!io&&(io=Q.caches.open(Ya))}function Ka(o){const i=o.indexOf("?");if(i<0)return o;const c=function(p){const g=p.indexOf("?");return g>0?p.slice(g+1).split("&"):[]}(o).filter(p=>{const g=p.split("=");return"language"===g[0]||"worldview"===g[0]});return c.length?`${o.slice(0,i)}?${c.join("&")}`:o.slice(0,i)}let Il=1/0;const Ja={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ja);class ro extends Error{constructor(i,s,c){401===s&&Ve(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ys=rs()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Q.location.protocol?Q.parent:Q).location.href,ba=function(o,i){if(!(/^file:/.test(s=o.url)||/^file:/.test(ys())&&!/^\w+:/.test(s))){if(Q.fetch&&Q.Request&&Q.AbortController&&Q.Request.prototype.hasOwnProperty("signal"))return function(c,p){const g=new Q.AbortController,v=new Q.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:ys(),referrerPolicy:c.referrerPolicy,signal:g.signal});let w=!1,T=!1;const S=(P=v.url).indexOf("sku=")>0&&Ve(P);var P;"json"===c.type&&v.headers.set("Accept","application/json");const N=(V,j,q)=>{if(T)return;if(V&&"SecurityError"!==V.message&&Ji(V.toString()),j&&q)return F(j);const J=Date.now();Q.fetch(v).then(se=>{if(se.ok){const ge=S?se.clone():null;return F(se,ge,J)}return p(new ro(se.statusText,se.status,c.url))}).catch(se=>{"AbortError"!==se.name&&p(new Error(`${se.message} ${c.url}`))})},F=(V,j,q)=>{("arrayBuffer"===c.type?V.arrayBuffer():"json"===c.type?V.json():V.text()).then(J=>{T||(j&&q&&function(se,ge,ae){if(xa(),!io)return;const de={status:ge.status,statusText:ge.statusText,headers:new Q.Headers};ge.headers.forEach((Ze,He)=>de.headers.set(He,Ze));const ye=no(ge.headers.get("Cache-Control")||"");if(ye["no-store"])return;ye["max-age"]&&de.headers.set("Expires",new Date(ae+1e3*ye["max-age"]).toUTCString());const _e=de.headers.get("Expires");_e&&(new Date(_e).getTime()-ae<42e4||function(Ze,He){if(void 0===Fs)try{new Response(new ReadableStream),Fs=!0}catch{Fs=!1}Fs?He(Ze.body):Ze.blob().then(He)}(ge,Ze=>{const He=new Q.Response(Ze,de);xa(),io&&io.then(st=>st.put(Ka(se.url),He)).catch(st=>Ji(st.message))}))}(v,j,q),w=!0,p(null,J,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(J=>{T||p(new Error(J.message))})};return S?function(V,j){if(xa(),!io)return j(null);const q=Ka(V.url);io.then(J=>{J.match(q).then(se=>{const ge=function(ae){if(!ae)return!1;const de=new Date(ae.headers.get("Expires")||0),ye=no(ae.headers.get("Cache-Control")||"");return de>Date.now()&&!ye["no-cache"]}(se);J.delete(q),ge&&J.put(q,se.clone()),j(null,se,ge)}).catch(j)}).catch(j)}(v,N):N(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(o,i);if(rs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var s;return function(c,p){const g=new Q.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(g.responseType="arraybuffer");for(const v in c.headers)g.setRequestHeader(v,c.headers[v]);return"json"===c.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===c.credentials,g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let v=g.response;if("json"===c.type)try{v=JSON.parse(g.response)}catch(w){return p(w)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new ro(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,i)},Qa=function(o,i){return ba(si(o,{type:"arrayBuffer"}),i)};function wa(o){const i=Q.document.createElement("a");return i.href=o,i.protocol===Q.document.location.protocol&&i.host===Q.document.location.host}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Z,Y;Z=[],Y=0;const ue=function(o,i){if(Re.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Y>=Ae.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Z.push(g),g}Y++;let s=!1;const c=()=>{if(!s)for(s=!0,Y--;Z.length&&Y<Ae.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Z.shift(),{requestParameters:v,callback:w,cancelled:T}=g;T||(g.cancel=ue(v,w).cancel)}},p=Qa(o,(g,v,w,T)=>{c(),g?i(g):v&&(Q.createImageBitmap?function(S,P){const N=new Q.Blob([new Uint8Array(S)],{type:"image/png"});Q.createImageBitmap(N).then(F=>{P(null,F)}).catch(F=>{P(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(S,P)=>i(S,P,w,T)):function(S,P){const N=new Q.Image,F=Q.URL;N.onload=()=>{P(null,N),F.revokeObjectURL(N.src),N.onload=null,Q.requestAnimationFrame(()=>{N.src=fe})},N.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Q.Blob([new Uint8Array(S)],{type:"image/png"});N.src=S.byteLength?F.createObjectURL(V):fe}(v,(S,P)=>i(S,P,w,T)))});return{cancel:()=>{p.cancel(),c()}}},xe="NO_ACCESS_TOKEN";function Se(o){return 0===o.indexOf("mapbox:")}function Ve(o){return Ae.API_URL_REGEX.test(o)}function Be(o){return Ae.API_CDN_URL_REGEX.test(o)}function De(o){return Ae.API_STYLE_REGEX.test(o)&&!Je(o)}function Je(o){return Ae.API_SPRITE_REGEX.test(o)}const Rt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zt(o){const i=o.match(Rt);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Ct(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}const kn="mapbox.eventData";function Gn(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Q.atob(i[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class zn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=Gn(Ae.ACCESS_TOKEN);let c="";return c=s&&s.u?Q.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(+("0x"+g)))):Ae.ACCESS_TOKEN||"",i?`${kn}.${i}:${c}`:`${kn}:${c}`}fetchEventData(){const i=Sl("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const p=Q.localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));const g=Q.localStorage.getItem(c);g&&(this.anonId=g)}catch{Ji("Unable to read from LocalStorage")}}saveEventData(){const i=Sl("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{Q.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Q.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{Ji("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,c,p){if(!Ae.EVENTS_URL)return;const g=zt(Ae.EVENTS_URL);g.params.push(`access_token=${p||Ae.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(i).toISOString()},w=s?si(v,s):v,T={url:Ct(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var P;this.pendingRequest=(P=S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(p)},ba(si(T,{method:"POST"}),P))}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const Sn=new class extends zn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){Ae.EVENTS_URL&&Ae.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Se(s)||Ve(s))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Gn(Ae.ACCESS_TOKEN),s=i?i.u:Ae.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Zr(this.anonId)||(this.anonId=li(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;c=c||w>=1||w<-1||g.getDate()!==v.getDate()}else c=!0;c?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ie,skuId:Ot,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=s)},o):this.processRequests()}},Bt=Sn.postTurnstileEvent.bind(Sn),Ui=new class extends zn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,s,c){this.skuToken=i,this.errorCb=c,Ae.EVENTS_URL&&(s||Ae.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(xe)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Zr(this.anonId)||(this.anonId=li()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ie,skuId:Ot,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o))}},pr=Ui.postMapLoadEvent.bind(Ui),Mi=new class extends zn{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){Ae.EVENTS_URL&&(o||Ae.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:s}=this.queue.shift(),c=function(p){const g=Q.performance.getEntriesByType("resource"),v=Q.performance.getEntriesByType("mark"),w=function(F){const V={};if(F)for(const j in F)if("other"!==j)for(const q of F[j]){const J=`${j}ResolveRangeMin`,se=`${j}ResolveRangeMax`,ge=`${j}RequestCount`,ae=`${j}RequestCachedCount`;V[J]=Math.min(V[J]||1/0,q.startTime),V[se]=Math.max(V[se]||-1/0,q.responseEnd);const de=ye=>{void 0===V[ye]&&(V[ye]=0),++V[ye]};void 0!==q.transferSize&&0===q.transferSize&&de(ae),de(ge)}return V}(function(F,V){const j={};if(F)for(const q of F){const J=V(q);void 0===j[J]&&(j[J]=[]),j[J].push(q)}return j}(g,Nh)),T=Q.devicePixelRatio,S=Q.navigator.connection||Q.navigator.mozConnection||Q.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},N=(F,V,j)=>{null!=j&&F.push({name:V,value:j.toString()})};for(const F in w)N(P.counters,F,w[F]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(N(P.counters,"interactionRangeMin",p.interactionRange[0]),N(P.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const F of Object.keys(Ea)){const V=Ea[F],j=v.find(q=>q.name===V);j&&N(P.counters,V,j.startTime)}return N(P.counters,"visibilityHidden",p.visibilityHidden),N(P.attributes,"style",function(F){if(F)for(const V of F){const j=V.name.split("?")[0];if(De(j)){const q=j.split("/").slice(-2);if(2===q.length)return`mapbox://styles/${q[0]}/${q[1]}`}}}(g)),N(P.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),N(P.attributes,"fogEnabled",p.fogEnabled?"true":"false"),N(P.attributes,"projection",p.projection),N(P.attributes,"zoom",p.zoom),N(P.metadata,"devicePixelRatio",T),N(P.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),N(P.metadata,"navigatorUserAgent",Q.navigator.userAgent),N(P.metadata,"screenWidth",Q.screen.width),N(P.metadata,"screenHeight",Q.screen.height),N(P.metadata,"windowWidth",Q.innerWidth),N(P.metadata,"windowHeight",Q.innerHeight),N(P.metadata,"mapWidth",p.width/T),N(P.metadata,"mapHeight",p.height/T),N(P.metadata,"webglRenderer",p.renderer),N(P.metadata,"webglVendor",p.vendor),N(P.metadata,"sdkVersion",Ie),N(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(s);for(const p of c.metadata);for(const p of c.counters);for(const p of c.attributes);this.postEvent(i,c,()=>{},o)}},Cr=Mi.postPerformanceEvent.bind(Mi),jo=new class extends zn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,s,c){if(!Ae.API_URL||!Ae.SESSION_PATH)return;const p=zt(Ae.API_URL+Ae.SESSION_PATH);p.params.push(`sku=${i||""}`),p.params.push(`access_token=${c||Ae.ACCESS_TOKEN||""}`);const g={url:Ct(p),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(c)},ba(si(g,{method:"GET"}),w))}getSessionAPI(o,i,s,c){this.skuToken=i,this.errorCb=c,Ae.SESSION_PATH&&Ae.API_URL&&(s||Ae.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(xe)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o)}},Lr=jo.getSessionAPI.bind(jo),Mr=new Set,Ea={create:"create",load:"load",fullLoad:"fullLoad"},Hd={mark(o){Q.performance.mark(o)},measure(o,i,s){Q.performance.measure(o,i,s)}};function Nh(o){const i=o.name.split("?")[0];return Be(i)&&i.includes("mapbox-gl.js")?"javascript":Be(i)&&i.includes("mapbox-gl.css")?"css":Ae.API_FONTS_REGEX.test(i)?"fontRange":Je(i)?"sprite":De(i)?"style":Ae.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const Kn=Q.performance;function Ru(o){const i=o?o.url.toString():void 0;return Kn.getEntriesByName(i)}let vr,Ca,oo,zs;const Bs={now:()=>void 0!==oo?oo:Q.performance.now(),setNow(o){oo=o},restoreNow(){oo=void 0},frame(o){const i=Q.requestAnimationFrame(o);return{cancel:()=>Q.cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:s,height:c}=o;zs||(zs=Q.document.createElement("canvas"));const p=zs.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(s>zs.width||c>zs.height)&&(zs.width=s,zs.height=c),p.clearRect(-i,-i,s+2*i,c+2*i),p.drawImage(o,0,0,s,c),p.getImageData(-i,-i,s+2*i,c+2*i)},resolveURL:o=>(vr||(vr=Q.document.createElement("a")),vr.href=o,vr.href),get devicePixelRatio(){return Q.devicePixelRatio},get prefersReducedMotion(){return!!Q.matchMedia&&(null==Ca&&(Ca=Q.matchMedia("(prefers-reduced-motion: reduce)")),Ca.matches)}};function Lu(o,i,s){s[o]&&-1!==s[o].indexOf(i)||(s[o]=s[o]||[],s[o].push(i))}function lc(o,i,s){if(s&&s[o]){const c=s[o].indexOf(i);-1!==c&&s[o].splice(c,1)}}class Ta{constructor(i,s={}){si(this,s),this.type=i}}class _o extends Ta{constructor(i,s={}){super("error",si({error:i},s))}}class Vs{on(i,s){return this._listeners=this._listeners||{},Lu(i,s,this._listeners),this}off(i,s){return lc(i,s,this._listeners),lc(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Lu(i,s,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,s){"string"==typeof i&&(i=new Ta(i,s||{}));const c=i.type;if(this.listens(c)){i.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of g)lc(c,w,this._oneTimeListeners),w.call(this,i);const v=this._eventedParent;v&&(si(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(i))}else i instanceof _o&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}var it=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function os(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}function Qi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function On(o){if(Array.isArray(o))return o.map(On);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const s in o)i[s]=On(o[s]);return i}return Qi(o)}class or extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}var Ao=or;class Us{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(i){return new Us(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var el=Us;const Da={kind:"null"},ot={kind:"number"},vn={kind:"string"},gn={kind:"boolean"},fn={kind:"color"},sr={kind:"object"},qn={kind:"value"},Wi={kind:"collator"},ss={kind:"formatted"},Xi={kind:"resolvedImage"};function jn(o,i){return{kind:"array",itemType:o,N:i}}function gi(o){if("array"===o.kind){const i=gi(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const ar=[Da,ot,vn,gn,fn,ss,sr,jn(qn),Xi];function Po(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!Po(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const s of ar)if(!Po(s,i))return null}return`Expected ${gi(o)} but found ${gi(i)} instead.`}function js(o,i){return i.some(s=>s.kind===o.kind)}function Ei(o,i){return i.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}var Pn,tl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function $s(o){return(o=Math.round(o))<0?0:o>255?255:o}function Al(o){return $s("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function Ma(o){return(i="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function Mt(o,i,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(i-o)*s*6:2*s<1?i:3*s<2?o+(i-o)*(2/3-s)*6:o}try{Pn={}.parseCSSColor=function(o){var i,s=o.replace(/ /g,"").toLowerCase();if(s in tl)return tl[s].slice();if("#"===s[0])return 4===s.length?(i=parseInt(s.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===s.length&&(i=parseInt(s.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var c=s.indexOf("("),p=s.indexOf(")");if(-1!==c&&p+1===s.length){var g=s.substr(0,c),v=s.substr(c+1,p-(c+1)).split(","),w=1;switch(g){case"rgba":if(4!==v.length)return null;w=Ma(v.pop());case"rgb":return 3!==v.length?null:[Al(v[0]),Al(v[1]),Al(v[2]),w];case"hsla":if(4!==v.length)return null;w=Ma(v.pop());case"hsl":if(3!==v.length)return null;var T=(parseFloat(v[0])%360+360)%360/360,S=Ma(v[1]),P=Ma(v[2]),N=P<=.5?P*(S+1):P+S-P*S,F=2*P-N;return[$s(255*Mt(F,N,T+1/3)),$s(255*Mt(F,N,T)),$s(255*Mt(F,N,T-1/3)),w];default:return null}}return null}}catch{}class kr{constructor(i,s,c,p=1){this.r=i,this.g=s,this.b=c,this.a=p}static parse(i){if(!i)return;if(i instanceof kr)return i;if("string"!=typeof i)return;const s=Pn(i);return s?new kr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[i,s,c,p]=this.toArray();return`rgba(${Math.round(i)},${Math.round(s)},${Math.round(c)},${p})`}toArray(){const{r:i,g:s,b:c,a:p}=this;return 0===p?[0,0,0,0]:[255*i/p,255*s/p,255*c/p,p]}toArray01(){const{r:i,g:s,b:c,a:p}=this;return 0===p?[0,0,0,0]:[i/p,s/p,c/p,p]}toArray01PremultipliedAlpha(){const{r:i,g:s,b:c,a:p}=this;return[i,s,c,p]}}kr.black=new kr(0,0,0,1),kr.white=new kr(1,1,1,1),kr.transparent=new kr(0,0,0,0),kr.red=new kr(1,0,0,1),kr.blue=new kr(0,0,1,1);var cn=kr;class on{constructor(i,s,c){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $o{constructor(i,s,c,p,g){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=c,this.fontStack=p,this.textColor=g}}class ai{constructor(i){this.sections=i}static fromString(i){return new ai([new $o(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof ai?i:ai.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){i.push(["image",s.image.name]);continue}i.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),i.push(c)}return i}}class Ro{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ro({name:i,available:!1}):null}serialize(){return["image",this.name]}}function Pl(o,i,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,i,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,i,s,c]:[o,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Or(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof cn||o instanceof on||o instanceof ai||o instanceof Ro)return!0;if(Array.isArray(o)){for(const i of o)if(!Or(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!Or(o[i]))return!1;return!0}return!1}function lr(o){if(null===o)return Da;if("string"==typeof o)return vn;if("boolean"==typeof o)return gn;if("number"==typeof o)return ot;if(o instanceof cn)return fn;if(o instanceof on)return Wi;if(o instanceof ai)return ss;if(o instanceof Ro)return Xi;if(Array.isArray(o)){const i=o.length;let s;for(const c of o){const p=lr(c);if(s){if(s===p)continue;s=qn;break}s=p}return jn(s||qn,i)}return sr}function as(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof cn||o instanceof ai||o instanceof Ro?o.toString():JSON.stringify(o)}class Wc{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(2!==i.length)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Or(i[1]))return s.error("invalid value");const c=i[1];let p=lr(c);const g=s.expectedType;return"array"!==p.kind||0!==p.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(p=g),new Wc(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof cn?["rgba"].concat(this.value.toArray()):this.value instanceof ai?this.value.serialize():this.value}}var Wr=Wc,Ci=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const Sa={string:vn,number:ot,boolean:gn,object:sr};class ku{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let c,p=1;const g=i[0];if("array"===g){let w,T;if(i.length>2){const S=i[1];if("string"!=typeof S||!(S in Sa)||"object"===S)return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=Sa[S],p++}else w=qn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=i[2],p++}c=jn(w,T)}else c=Sa[g];const v=[];for(;p<i.length;p++){const w=s.parse(i[p],p,qn);if(!w)return null;v.push(w)}return new ku(c,v)}evaluate(i){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(i);if(!Po(this.type,lr(c)))return c;if(s===this.args.length-1)throw new Ci(`Expected value to be of type ${gi(this.type)}, but found ${gi(lr(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const p=i.N;("number"==typeof p||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(c=>c.serialize()))}}var Hs=ku;class Ia{constructor(i){this.type=ss,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=i.length-1;++v){const w=i[v];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=s.parse(w["font-scale"],1,ot),!T))return null;let S=null;if(w["text-font"]&&(S=s.parse(w["text-font"],1,jn(vn)),!S))return null;let P=null;if(w["text-color"]&&(P=s.parse(w["text-color"],1,fn),!P))return null;const N=p[p.length-1];N.scale=T,N.font=S,N.textColor=P}else{const T=s.parse(i[v],1,qn);if(!T)return null;const S=T.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new Ia(p)}evaluate(i){return new ai(this.sections.map(s=>{const c=s.content.evaluate(i);return lr(c)===Xi?new $o("",c,null,null,null):new $o(as(c),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),i.push(c)}return i}}class Xc{constructor(i){this.type=Xi,this.input=i}static parse(i,s){if(2!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,vn);return c?new Xc(c):s.error("No image name provided.")}evaluate(i){const s=this.input.evaluate(i),c=Ro.fromString(s);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(s)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ou={"to-boolean":gn,"to-color":fn,"to-number":ot,"to-string":vn};class Fh{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return s.error("Expected one argument.");const p=Ou[c],g=[];for(let v=1;v<i.length;v++){const w=s.parse(i[v],v,qn);if(!w)return null;g.push(w)}return new Fh(p,g)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let s,c;for(const p of this.args){if(s=p.evaluate(i),c=null,s instanceof cn)return s;if("string"==typeof s){const g=i.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Pl(s[0],s[1],s[2],s[3]),!c))return new cn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ci(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(i),null===s)return 0;const p=Number(s);if(!isNaN(p))return p}throw new Ci(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?ai.fromString(as(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Ro.fromString(as(this.args[0].evaluate(i))):as(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ia([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Xc(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Ur=Fh;const jt=["Unknown","Point","LineString","Polygon"];var zh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?jt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-o[0])+this.featureDistanceData.bearing[1]*(c*i-o[1])}return 0}parseColor(o){let i=this._parseColorCache[o];return i||(i=this._parseColorCache[o]=cn.parse(o)),i}};class so{constructor(i,s,c,p){this.name=i,this.type=s,this._evaluate=c,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const c=i[0],p=so.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=v.filter(([S])=>!Array.isArray(S)||S.length===i.length-1);let T=null;for(const[S,P]of w){T=new La(s.registry,s.path,null,s.scope);const N=[];let F=!1;for(let V=1;V<i.length;V++){const j=i[V],q=Array.isArray(S)?S[V-1]:S.type,J=T.parse(j,1+N.length,q);if(!J){F=!0;break}N.push(J)}if(!F)if(Array.isArray(S)&&S.length!==N.length)T.error(`Expected ${S.length} arguments, but found ${N.length} instead.`);else{for(let V=0;V<N.length;V++){const j=Array.isArray(S)?S[V]:S.type,q=N[V];T.concat(V+1).checkSubtype(j,q.type)}if(0===T.errors.length)return new so(c,g,P,N)}}if(1===w.length)s.errors.push(...T.errors);else{const S=(w.length?w:v).map(([N])=>{return F=N,Array.isArray(F)?`(${F.map(gi).join(", ")})`:`(${gi(F.type)}...)`;var F}).join(" | "),P=[];for(let N=1;N<i.length;N++){const F=s.parse(i[N],1+P.length);if(!F)return null;P.push(gi(F.type))}s.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(i,s){so.definitions=s;for(const c in s)i[c]=so}}var Ho=so;class an{constructor(i,s,c){this.type=Wi,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(2!==i.length)return s.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,gn);if(!p)return null;const g=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,gn);if(!g)return null;let v=null;return c.locale&&(v=s.parse(c.locale,1,vn),!v)?null:new an(p,g,v)}evaluate(i){return new on(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Aa=8192;function Nr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Gs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Rl(o,i){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(s*p*Aa),Math.round(c*p*Aa)]}function Nu(o,i,s){const c=o[0]-i[0],p=o[1]-i[1],g=o[0]-s[0],v=o[1]-s[1];return c*v-g*p==0&&c*g<=0&&p*v<=0}function Yc(o,i){let s=!1;for(let v=0,w=i.length;v<w;v++){const T=i[v];for(let S=0,P=T.length;S<P-1;S++){if(Nu(o,T[S],T[S+1]))return!1;(p=T[S])[1]>(c=o)[1]!=(g=T[S+1])[1]>c[1]&&c[0]<(g[0]-p[0])*(c[1]-p[1])/(g[1]-p[1])+p[0]&&(s=!s)}}var c,p,g;return s}function Pa(o,i){for(let s=0;s<i.length;s++)if(Yc(o,i[s]))return!0;return!1}function Ll(o,i,s,c){const p=c[0]-s[0],g=c[1]-s[1],v=(o[0]-s[0])*g-p*(o[1]-s[1]),w=(i[0]-s[0])*g-p*(i[1]-s[1]);return v>0&&w<0||v<0&&w>0}function Xr(o,i,s){for(const S of s)for(let P=0;P<S.length-1;++P)if((w=[(v=S[P+1])[0]-(g=S[P])[0],v[1]-g[1]])[0]*(T=[(p=i)[0]-(c=o)[0],p[1]-c[1]])[1]-w[1]*T[0]!=0&&Ll(c,p,g,v)&&Ll(g,v,c,p))return!0;var c,p,g,v,w,T;return!1}function fi(o,i){for(let s=0;s<o.length;++s)if(!Yc(o[s],i))return!1;for(let s=0;s<o.length-1;++s)if(Xr(o[s],o[s+1],i))return!1;return!0}function Bh(o,i){for(let s=0;s<i.length;s++)if(fi(o,i[s]))return!0;return!1}function $n(o,i,s){const c=[];for(let p=0;p<o.length;p++){const g=[];for(let v=0;v<o[p].length;v++){const w=Rl(o[p][v],s);Nr(i,w),g.push(w)}c.push(g)}return c}function cc(o,i,s){const c=[];for(let p=0;p<o.length;p++){const g=$n(o[p],i,s);c.push(g)}return c}function uc(o,i,s,c){if(o[0]<s[0]||o[0]>s[2]){const p=.5*c;let g=o[0]-s[0]>p?-c:s[0]-o[0]>p?c:0;0===g&&(g=o[0]-s[2]>p?-c:s[2]-o[0]>p?c:0),o[0]+=g}Nr(i,o)}function Yr(o,i,s,c){const p=Math.pow(2,c.z)*Aa,g=[c.x*Aa,c.y*Aa],v=[];if(!o)return v;for(const w of o)for(const T of w){const S=[T.x+g[0],T.y+g[1]];uc(S,i,s,p),v.push(S)}return v}function Kc(o,i,s,c){const p=Math.pow(2,c.z)*Aa,g=[c.x*Aa,c.y*Aa],v=[];if(!o)return v;for(const T of o){const S=[];for(const P of T){const N=[P.x+g[0],P.y+g[1]];Nr(i,N),S.push(N)}v.push(S)}if(i[2]-i[0]<=p/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of v)for(const S of T)uc(S,i,s,p)}var w;return v}class kl{constructor(i,s){this.type=gn,this.geojson=i,this.geometries=s}static parse(i,s){if(2!==i.length)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Or(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let p=0;p<c.features.length;++p){const g=c.features[p].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new kl(c,c.features[p].geometry)}else if("Feature"===c.type){const p=c.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new kl(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new kl(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if("Polygon"===c.type){const w=$n(c.coordinates,g,v),T=Yr(s.geometry(),p,g,v);if(!Gs(p,g))return!1;for(const S of T)if(!Yc(S,w))return!1}if("MultiPolygon"===c.type){const w=cc(c.coordinates,g,v),T=Yr(s.geometry(),p,g,v);if(!Gs(p,g))return!1;for(const S of T)if(!Pa(S,w))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if("Polygon"===c.type){const w=$n(c.coordinates,g,v),T=Kc(s.geometry(),p,g,v);if(!Gs(p,g))return!1;for(const S of T)if(!fi(S,w))return!1}if("MultiPolygon"===c.type){const w=cc(c.coordinates,g,v),T=Kc(s.geometry(),p,g,v);if(!Gs(p,g))return!1;for(const S of T)if(!Bh(S,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Di=kl;function hc(o){if(o instanceof Ho&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Di)return!1;let i=!0;return o.eachChild(s=>{i&&!hc(s)&&(i=!1)}),i}function Ra(o){if(o instanceof Ho&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(s=>{i&&!Ra(s)&&(i=!1)}),i}function Xt(o,i){if(o instanceof Ho&&i.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!Xt(c,i)&&(s=!1)}),s}class Ol{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(2!==i.length||"string"!=typeof i[1])return s.error("'var' expression requires exactly one string literal argument.");const c=i[1];return s.scope.has(c)?new Ol(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var dc=Ol;class nl{constructor(i,s=[],c,p=new el,g=[]){this.registry=i,this.path=s,this.key=s.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=c}parse(i,s,c,p,g={}){return s?this.concat(s,c,p)._parse(i,g):this._parse(i,g)}_parse(i,s){function c(p,g,v){return"assert"===v?new Hs(g,[p]):"coerce"===v?new Ur(g,[p]):p}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(i,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,T=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else v=c(v,w,s.typeAnnotation||"coerce");else v=c(v,w,s.typeAnnotation||"assert")}if(!(v instanceof Wr)&&"resolvedImage"!==v.type.kind&&qs(v)){const w=new zh;try{v=new Wr(v.type,v.evaluate(w))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,c){const p="number"==typeof i?this.path.concat(i):this.path,g=c?this.scope.concat(c):this.scope;return new nl(this.registry,p,s||null,g,this.errors)}error(i,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ao(c,i))}checkSubtype(i,s){const c=Po(i,s);return c&&this.error(c),c}}var La=nl;function qs(o){if(o instanceof dc)return qs(o.boundExpression);if(o instanceof Ho&&"error"===o.name||o instanceof an||o instanceof Di)return!1;const i=o instanceof Ur||o instanceof Hs;let s=!0;return o.eachChild(c=>{s=i?s&&qs(c):s&&c instanceof Wr}),!!s&&hc(o)&&Xt(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Nl(o,i){const s=o.length-1;let c,p,g=0,v=s,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),c=o[w],p=o[w+1],c<=i){if(w===s||i<p)return w;g=w+1}else{if(!(c>i))throw new Ci("Input is not a number.");v=w-1}return 0}class il{constructor(i,s,c){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[p,g]of c)this.labels.push(p),this.outputs.push(g)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(i[1],1,ot);if(!c)return null;const p=[];let g=null;s.expectedType&&"value"!==s.expectedType.kind&&(g=s.expectedType);for(let v=1;v<i.length;v+=2){const w=1===v?-1/0:i[v],T=i[v+1],S=v,P=v+1;if("number"!=typeof w)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const N=s.parse(T,P,g);if(!N)return null;g=g||N.type,p.push([w,N])}return new il(g,c,p)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=s[0])return c[0].evaluate(i);const g=s.length;return p>=s[g-1]?c[g-1].evaluate(i):c[Nl(s,p)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}var Lo=il;function ci(o,i,s){return o*(1-s)+i*s}var fc=Object.freeze({__proto__:null,array:function(o,i,s){return o.map((c,p)=>ci(c,i[p],s))},color:function(o,i,s){return new cn(ci(o.r,i.r,s),ci(o.g,i.g,s),ci(o.b,i.b,s),ci(o.a,i.a,s))},number:ci});const Fl=4/29,vs=6/29,Fu=3*vs*vs,Vh=vs*vs*vs,qd=Math.PI/180,Go=180/Math.PI;function ko(o){return o>Vh?Math.pow(o,1/3):o/Fu+Fl}function zu(o){return o>vs?o*o*o:Fu*(o-Fl)}function jr(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Jc(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function sn(o){const i=Jc(o.r),s=Jc(o.g),c=Jc(o.b),p=ko((.4124564*i+.3575761*s+.1804375*c)/.95047),g=ko((.2126729*i+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-ko((.0193339*i+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function Bu(o){let i=(o.l+16)/116,s=isNaN(o.a)?i:i+o.a/500,c=isNaN(o.b)?i:i-o.b/200;return i=1*zu(i),s=.95047*zu(s),c=1.08883*zu(c),new cn(jr(3.2404542*s-1.5371385*i-.4985314*c),jr(-.969266*s+1.8760108*i+.041556*c),jr(.0556434*s-.2040259*i+1.0572252*c),o.alpha)}function tn(o,i,s){const c=i-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Ws={forward:sn,reverse:Bu,interpolate:function(o,i,s){return{l:ci(o.l,i.l,s),a:ci(o.a,i.a,s),b:ci(o.b,i.b,s),alpha:ci(o.alpha,i.alpha,s)}}},ls={forward:function(o){const{l:i,a:s,b:c}=sn(o),p=Math.atan2(c,s)*Go;return{h:p<0?p+360:p,c:Math.sqrt(s*s+c*c),l:i,alpha:o.a}},reverse:function(o){const i=o.h*qd,s=o.c;return Bu({l:o.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:o.alpha})},interpolate:function(o,i,s){return{h:tn(o.h,i.h,s),c:ci(o.c,i.c,s),l:ci(o.l,i.l,s),alpha:ci(o.alpha,i.alpha,s)}}};var rl=Object.freeze({__proto__:null,hcl:ls,lab:Ws});class qo{constructor(i,s,c,p,g){this.type=i,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(i,s,c,p){let g=0;if("exponential"===i.name)g=zl(s,i.base,c,p);else if("linear"===i.name)g=zl(s,1,c,p);else if("cubic-bezier"===i.name){const v=i.controlPoints;g=new Ge(v[0],v[1],v[2],v[3]).solve(zl(s,1,c,p))}return g}static parse(i,s){let[c,p,g,...v]=i;if(!Array.isArray(p)||0===p.length)return s.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const S=p[1];if("number"!=typeof S)return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if("cubic-bezier"!==p[0])return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(4!==S.length||S.some(P=>"number"!=typeof P||P<0||P>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,ot),!g)return null;const w=[];let T=null;"interpolate-hcl"===c||"interpolate-lab"===c?T=fn:s.expectedType&&"value"!==s.expectedType.kind&&(T=s.expectedType);for(let S=0;S<v.length;S+=2){const P=v[S],N=v[S+1],F=S+3,V=S+4;if("number"!=typeof P)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=P)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const j=s.parse(N,V,T);if(!j)return null;T=T||j.type,w.push([P,j])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new qo(T,c,p,g,w):s.error(`Type ${gi(T)} is not interpolatable.`)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const p=this.input.evaluate(i);if(p<=s[0])return c[0].evaluate(i);const g=s.length;if(p>=s[g-1])return c[g-1].evaluate(i);const v=Nl(s,p),w=qo.interpolationFactor(this.interpolation,p,s[v],s[v+1]),T=c[v].evaluate(i),S=c[v+1].evaluate(i);return"interpolate"===this.operator?fc[this.type.kind.toLowerCase()](T,S,w):"interpolate-hcl"===this.operator?ls.reverse(ls.interpolate(ls.forward(T),ls.forward(S),w)):Ws.reverse(Ws.interpolate(Ws.forward(T),Ws.forward(S),w))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function zl(o,i,s,c){const p=c-s,g=o-s;return 0===p?0:1===i?g/p:(Math.pow(i,g)-1)/(Math.pow(i,p)-1)}var xs=qo;class Co{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&"value"!==p.kind&&(c=p);const g=[];for(const w of i.slice(1)){const T=s.parse(w,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,g.push(T)}const v=p&&g.some(w=>Po(p,w.type));return new Co(v?qn:c,g)}evaluate(i){let s,c=null,p=0;for(const g of this.args){if(p++,c=g.evaluate(i),c&&c instanceof Ro&&!c.available&&(s||(s=c),c=null,p===this.args.length))return s;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Bl=Co;class xr{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let g=1;g<i.length-1;g+=2){const v=i[g];if("string"!=typeof v)return s.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=s.parse(i[g+1],g+1);if(!w)return null;c.push([v,w])}const p=s.parse(i[i.length-1],i.length-1,s.expectedType,c);return p?new xr(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,c]of this.bindings)i.push(s,c.serialize());return i.push(this.result.serialize()),i}}var cs=xr;class ni{constructor(i,s,c){this.type=i,this.index=s,this.input=c}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,ot),p=s.parse(i[2],2,jn(s.expectedType||qn));return c&&p?new ni(p.type.itemType,c,p):null}evaluate(i){const s=this.index.evaluate(i),c=this.input.evaluate(i);if(s<0)throw new Ci(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Ci(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Ci(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Qc=ni;class Oo{constructor(i,s){this.type=gn,this.needle=i,this.haystack=s}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,qn),p=s.parse(i[2],2,qn);return c&&p?js(c.type,[gn,vn,ot,Da,qn])?new Oo(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(c.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!Ei(s,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${gi(lr(s))} instead.`);if(!Ei(c,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${gi(lr(c))} instead.`);return c.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Xs=Oo;class ol{constructor(i,s,c){this.type=ot,this.needle=i,this.haystack=s,this.fromIndex=c}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,qn),p=s.parse(i[2],2,qn);if(!c||!p)return null;if(!js(c.type,[gn,vn,ot,Da,qn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(c.type)} instead`);if(4===i.length){const g=s.parse(i[3],3,ot);return g?new ol(c,p,g):null}return new ol(c,p)}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!Ei(s,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${gi(lr(s))} instead.`);if(!Ei(c,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${gi(lr(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zo=ol;class bs{constructor(i,s,c,p,g,v){this.inputType=i,this.type=s,this.input=c,this.cases=p,this.outputs=g,this.otherwise=v}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);const g={},v=[];for(let S=2;S<i.length-1;S+=2){let P=i[S];const N=i[S+1];Array.isArray(P)||(P=[P]);const F=s.concat(S);if(0===P.length)return F.error("Expected at least one branch label.");for(const j of P){if("number"!=typeof j&&"string"!=typeof j)return F.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return F.error("Numeric branch labels must be integer values.");if(c){if(F.checkSubtype(c,lr(j)))return null}else c=lr(j);if(void 0!==g[String(j)])return F.error("Branch labels must be unique.");g[String(j)]=v.length}const V=s.parse(N,S,p);if(!V)return null;p=p||V.type,v.push(V)}const w=s.parse(i[1],1,qn);if(!w)return null;const T=s.parse(i[i.length-1],i.length-1,p);return T?"value"!==w.type.kind&&s.concat(1).checkSubtype(c,w.type)?null:new bs(c,p,w,g,v,T):null}evaluate(i){const s=this.input.evaluate(i);return(lr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],p={};for(const v of s){const w=p[this.cases[v]];void 0===w?(p[this.cases[v]]=c.length,c.push([this.cases[v],[v]])):c[w][1].push(v)}const g=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of c)i.push(1===w.length?g(w[0]):w.map(g)),i.push(this.outputs[v].serialize());return i.push(this.otherwise.serialize()),i}}var eu=bs;class sl{constructor(i,s,c){this.type=i,this.branches=s,this.otherwise=c}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const p=[];for(let v=1;v<i.length-1;v+=2){const w=s.parse(i[v],v,gn);if(!w)return null;const T=s.parse(i[v+1],v+1,c);if(!T)return null;p.push([w,T]),c=c||T.type}const g=s.parse(i[i.length-1],i.length-1,c);return g?new sl(c,p,g):null}evaluate(i){for(const[s,c]of this.branches)if(s.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,c]of this.branches)i(s),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var Ys=sl;class Ks{constructor(i,s,c,p){this.type=i,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,qn),p=s.parse(i[2],2,ot);if(!c||!p)return null;if(!js(c.type,[jn(qn),vn,qn]))return s.error(`Expected first argument to be of type array or string, but found ${gi(c.type)} instead`);if(4===i.length){const g=s.parse(i[3],3,ot);return g?new Ks(c.type,c,p,g):null}return new Ks(c.type,c,p)}evaluate(i){const s=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!Ei(s,["string","array"]))throw new Ci(`Expected first argument to be of type array or string, but found ${gi(lr(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return s.slice(c,p)}return s.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var pc=Ks;function Js(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Vu(o,i,s,c){return 0===c.compare(i,s)}function ws(o,i,s){const c="=="!==o&&"!="!==o;return class x2{constructor(g,v,w){this.type=gn,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}static parse(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");const w=g[0];let T=v.parse(g[1],1,qn);if(!T)return null;if(!Js(w,T.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${gi(T.type)}'.`);let S=v.parse(g[2],2,qn);if(!S)return null;if(!Js(w,S.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${gi(S.type)}'.`);if(T.type.kind!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return v.error(`Cannot compare types '${gi(T.type)}' and '${gi(S.type)}'.`);c&&("value"===T.type.kind&&"value"!==S.type.kind?T=new Hs(S.type,[T]):"value"!==T.type.kind&&"value"===S.type.kind&&(S=new Hs(T.type,[S])));let P=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(g[3],3,Wi),!P)return null}return new x2(T,S,P)}evaluate(g){const v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const T=lr(v),S=lr(w);if(T.kind!==S.kind||"string"!==T.kind&&"number"!==T.kind)throw new Ci(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=lr(v),S=lr(w);if("string"!==T.kind||"string"!==S.kind)return i(g,v,w)}return this.collator?s(g,v,w,this.collator.evaluate(g)):i(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(v=>{g.push(v.serialize())}),g}}}const Zd=ws("==",function(o,i,s){return i===s},Vu),Uu=ws("!=",function(o,i,s){return i!==s},function(o,i,s,c){return!Vu(0,i,s,c)}),Wd=ws("<",function(o,i,s){return i<s},function(o,i,s,c){return c.compare(i,s)<0}),Uh=ws(">",function(o,i,s){return i>s},function(o,i,s,c){return c.compare(i,s)>0}),us=ws("<=",function(o,i,s){return i<=s},function(o,i,s,c){return c.compare(i,s)<=0}),hs=ws(">=",function(o,i,s){return i>=s},function(o,i,s,c){return c.compare(i,s)>=0});class ka{constructor(i,s,c,p,g,v){this.type=vn,this.number=i,this.locale=s,this.currency=c,this.unit=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,s){if(3!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,ot);if(!c)return null;const p=i[2];if("object"!=typeof p||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=s.parse(p.locale,1,vn),!g))return null;let v=null;if(p.currency&&(v=s.parse(p.currency,1,vn),!v))return null;let w=null;if(p.unit&&(w=s.parse(p.unit,1,vn),!w))return null;let T=null;if(p["min-fraction-digits"]&&(T=s.parse(p["min-fraction-digits"],1,ot),!T))return null;let S=null;return p["max-fraction-digits"]&&(S=s.parse(p["max-fraction-digits"],1,ot),!S)?null:new ka(c,g,v,w,T,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Vl{constructor(i){this.type=ot,this.input=i}static parse(i,s){if(2!==i.length)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=s.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${gi(c.type)} instead.`):new Vl(c):null}evaluate(i){const s=this.input.evaluate(i);if("string"==typeof s||Array.isArray(s))return s.length;throw new Ci(`Expected value to be of type string or array, but found ${gi(lr(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}const mc={"==":Zd,"!=":Uu,">":Uh,"<":Wd,">=":hs,"<=":us,array:Hs,at:Qc,boolean:Hs,case:Ys,coalesce:Bl,collator:an,format:Ia,image:Xc,in:Xs,"index-of":Zo,interpolate:xs,"interpolate-hcl":xs,"interpolate-lab":xs,length:Vl,let:cs,literal:Wr,match:eu,number:Hs,"number-format":ka,object:Hs,slice:pc,step:Lo,string:Hs,"to-boolean":Ur,"to-color":Ur,"to-number":Ur,"to-string":Ur,var:dc,within:Di};function jh(o,[i,s,c,p]){i=i.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const g=p?p.evaluate(o):1,v=Pl(i,s,c,g);if(v)throw new Ci(v);return new cn(i/255*g,s/255*g,c/255*g,g)}function Es(o,i){return o in i}function gc(o,i){const s=i[o];return void 0===s?null:s}function ao(o){return{type:o}}Ho.register(mc,{error:[{kind:"error"},[vn],(o,[i])=>{throw new Ci(i.evaluate(o))}],typeof:[vn,[qn],(o,[i])=>gi(lr(i.evaluate(o)))],"to-rgba":[jn(ot,4),[fn],(o,[i])=>i.evaluate(o).toArray()],rgb:[fn,[ot,ot,ot],jh],rgba:[fn,[ot,ot,ot,ot],jh],has:{type:gn,overloads:[[[vn],(o,[i])=>Es(i.evaluate(o),o.properties())],[[vn,sr],(o,[i,s])=>Es(i.evaluate(o),s.evaluate(o))]]},get:{type:qn,overloads:[[[vn],(o,[i])=>gc(i.evaluate(o),o.properties())],[[vn,sr],(o,[i,s])=>gc(i.evaluate(o),s.evaluate(o))]]},"feature-state":[qn,[vn],(o,[i])=>gc(i.evaluate(o),o.featureState||{})],properties:[sr,[],o=>o.properties()],"geometry-type":[vn,[],o=>o.geometryType()],id:[qn,[],o=>o.id()],zoom:[ot,[],o=>o.globals.zoom],pitch:[ot,[],o=>o.globals.pitch||0],"distance-from-center":[ot,[],o=>o.distanceFromCenter()],"heatmap-density":[ot,[],o=>o.globals.heatmapDensity||0],"line-progress":[ot,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[ot,[],o=>o.globals.skyRadialProgress||0],accumulated:[qn,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[ot,ao(ot),(o,i)=>{let s=0;for(const c of i)s+=c.evaluate(o);return s}],"*":[ot,ao(ot),(o,i)=>{let s=1;for(const c of i)s*=c.evaluate(o);return s}],"-":{type:ot,overloads:[[[ot,ot],(o,[i,s])=>i.evaluate(o)-s.evaluate(o)],[[ot],(o,[i])=>-i.evaluate(o)]]},"/":[ot,[ot,ot],(o,[i,s])=>i.evaluate(o)/s.evaluate(o)],"%":[ot,[ot,ot],(o,[i,s])=>i.evaluate(o)%s.evaluate(o)],ln2:[ot,[],()=>Math.LN2],pi:[ot,[],()=>Math.PI],e:[ot,[],()=>Math.E],"^":[ot,[ot,ot],(o,[i,s])=>Math.pow(i.evaluate(o),s.evaluate(o))],sqrt:[ot,[ot],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[ot,[ot],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[ot,[ot],(o,[i])=>Math.log(i.evaluate(o))],log2:[ot,[ot],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[ot,[ot],(o,[i])=>Math.sin(i.evaluate(o))],cos:[ot,[ot],(o,[i])=>Math.cos(i.evaluate(o))],tan:[ot,[ot],(o,[i])=>Math.tan(i.evaluate(o))],asin:[ot,[ot],(o,[i])=>Math.asin(i.evaluate(o))],acos:[ot,[ot],(o,[i])=>Math.acos(i.evaluate(o))],atan:[ot,[ot],(o,[i])=>Math.atan(i.evaluate(o))],min:[ot,ao(ot),(o,i)=>Math.min(...i.map(s=>s.evaluate(o)))],max:[ot,ao(ot),(o,i)=>Math.max(...i.map(s=>s.evaluate(o)))],abs:[ot,[ot],(o,[i])=>Math.abs(i.evaluate(o))],round:[ot,[ot],(o,[i])=>{const s=i.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[ot,[ot],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[ot,[ot],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[gn,[vn,qn],(o,[i,s])=>o.properties()[i.value]===s.value],"filter-id-==":[gn,[qn],(o,[i])=>o.id()===i.value],"filter-type-==":[gn,[vn],(o,[i])=>o.geometryType()===i.value],"filter-<":[gn,[vn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[gn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<c}],"filter->":[gn,[vn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[gn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>c}],"filter-<=":[gn,[vn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[gn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<=c}],"filter->=":[gn,[vn,qn],(o,[i,s])=>{const c=o.properties()[i.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[gn,[qn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>=c}],"filter-has":[gn,[qn],(o,[i])=>i.value in o.properties()],"filter-has-id":[gn,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[gn,[jn(vn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[gn,[jn(qn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[gn,[vn,jn(qn)],(o,[i,s])=>s.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[gn,[vn,jn(qn)],(o,[i,s])=>function(c,p,g,v){for(;g<=v;){const w=g+v>>1;if(p[w]===c)return!0;p[w]>c?v=w-1:g=w+1}return!1}(o.properties()[i.value],s.value,0,s.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(o,[i,s])=>i.evaluate(o)&&s.evaluate(o)],[ao(gn),(o,i)=>{for(const s of i)if(!s.evaluate(o))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(o,[i,s])=>i.evaluate(o)||s.evaluate(o)],[ao(gn),(o,i)=>{for(const s of i)if(s.evaluate(o))return!0;return!1}]]},"!":[gn,[gn],(o,[i])=>!i.evaluate(o)],"is-supported-script":[gn,[vn],(o,[i])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(i.evaluate(o))}],upcase:[vn,[vn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[vn,[vn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[vn,ao(qn),(o,i)=>i.map(s=>as(s.evaluate(o))).join("")],"resolved-locale":[vn,[Wi],(o,[i])=>i.evaluate(o).resolvedLocale()]});var _c=mc;function al(o){return{result:"success",value:o}}function er(o){return{result:"error",value:o}}function ll(o){return"data-driven"===o["property-type"]}function tu(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Wo(o){return!!o.expression&&o.expression.interpolated}function Nn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Ul(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function cl(o){return o}function Rn(o,i){const s="color"===i.type,c=o.stops&&"object"==typeof o.stops[0][0],p=c||!(c||void 0!==o.property),g=o.type||(Wo(i)?"exponential":"interval");if(s&&((o=os({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],cn.parse(S[1])])),o.default=cn.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!rl[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let v,w,T;if("exponential"===g)v=cr;else if("interval"===g)v=Tr;else if("categorical"===g){v=ii,w=Object.create(null);for(const S of o.stops)w[S[0]]=S[1];T=typeof o.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);v=ul}if(c){const S={},P=[];for(let V=0;V<o.stops.length;V++){const j=o.stops[V],q=j[0].zoom;void 0===S[q]&&(S[q]={zoom:q,type:o.type,property:o.property,default:o.default,stops:[]},P.push(q)),S[q].stops.push([j[0].value,j[1]])}const N=[];for(const V of P)N.push([S[V].zoom,Rn(S[V],i)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:xs.interpolationFactor.bind(void 0,F),zoomStops:N.map(V=>V[0]),evaluate:({zoom:V},j)=>cr({stops:N,base:o.base},i,V).evaluate(V,j)}}if(p){const S="exponential"===g?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:xs.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(o,i,P,w,T)}}return{kind:"source",evaluate(S,P){const N=P&&P.properties?P.properties[o.property]:void 0;return void 0===N?br(o.default,i.default):v(o,i,N,w,T)}}}function br(o,i,s){return void 0!==o?o:void 0!==i?i:void 0!==s?s:void 0}function ii(o,i,s,c,p){return br(typeof s===p?c[s]:void 0,o.default,i.default)}function Tr(o,i,s){if("number"!==Nn(s))return br(o.default,i.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const p=Nl(o.stops.map(g=>g[0]),s);return o.stops[p][1]}function cr(o,i,s){const c=void 0!==o.base?o.base:1;if("number"!==Nn(s))return br(o.default,i.default);const p=o.stops.length;if(1===p||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[p-1][0])return o.stops[p-1][1];const g=Nl(o.stops.map(P=>P[0]),s),v=function(P,N,F,V){const j=V-F,q=P-F;return 0===j?0:1===N?q/j:(Math.pow(N,q)-1)/(Math.pow(N,j)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),w=o.stops[g][1],T=o.stops[g+1][1];let S=fc[i.type]||cl;if(o.colorSpace&&"rgb"!==o.colorSpace){const P=rl[o.colorSpace];S=(N,F)=>P.reverse(P.interpolate(P.forward(N),P.forward(F),v))}return"function"==typeof w.evaluate?{evaluate(...P){const N=w.evaluate.apply(void 0,P),F=T.evaluate.apply(void 0,P);if(void 0!==N&&void 0!==F)return S(N,F,v)}}:S(w,T,v)}function ul(o,i,s){return"color"===i.type?s=cn.parse(s):"formatted"===i.type?s=ai.fromString(s.toString()):"resolvedImage"===i.type?s=Ro.fromString(s.toString()):Nn(s)===i.type||"enum"===i.type&&i.values[s]||(s=void 0),br(s,o.default,i.default)}class Kr{constructor(i,s){var c;this.expression=i,this._warningHistory={},this._evaluator=new zh,this._defaultValue=s?"color"===(c=s).type&&(Ul(c.default)||Array.isArray(c.default))?new cn(0,0,0,0):"color"===c.type?cn.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(i,s,c,p,g,v,w,T){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,c,p,g,v,w,T){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ci(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Oa(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in _c}function Na(o,i){const s=new La(_c,[],i?function(p){const g={color:fn,string:vn,number:ot,enum:vn,boolean:gn,formatted:ss,resolvedImage:Xi};return"array"===p.type?jn(g[p.value]||qn,p.length):g[p.type]}(i):void 0),c=s.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?al(new Kr(c,i)):er(s.errors)}class hl{constructor(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent="constant"!==i&&!Ra(s.expression)}evaluateWithoutErrorHandling(i,s,c,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,p,g,v)}evaluate(i,s,c,p,g,v){return this._styleExpression.evaluate(i,s,c,p,g,v)}}class jl{constructor(i,s,c,p){this.kind=i,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==i&&!Ra(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,s,c,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,p,g,v)}evaluate(i,s,c,p,g,v){return this._styleExpression.evaluate(i,s,c,p,g,v)}interpolationFactor(i,s,c){return this.interpolationType?xs.interpolationFactor(this.interpolationType,i,s,c):0}}function yc(o,i){if("error"===(o=Na(o,i)).result)return o;const s=o.value.expression,c=hc(s);if(!c&&!ll(i))return er([new Ao("","data expressions not supported")]);const p=Xt(s,["zoom","pitch","distance-from-center"]);if(!p&&!tu(i))return er([new Ao("","zoom expressions not supported")]);const g=Jt(s);return g||p?g instanceof Ao?er([g]):g instanceof xs&&!Wo(i)?er([new Ao("",'"interpolate" expressions cannot be used with this property')]):al(g?new jl(c?"camera":"composite",o.value,g.labels,g instanceof xs?g.interpolation:void 0):new hl(c?"constant":"source",o.value)):er([new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yi{constructor(i,s){this._parameters=i,this._specification=s,os(this,Rn(this._parameters,this._specification))}static deserialize(i){return new Yi(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Jt(o){let i=null;if(o instanceof cs)i=Jt(o.result);else if(o instanceof Bl){for(const s of o.args)if(i=Jt(s),i)break}else(o instanceof Lo||o instanceof xs)&&o.input instanceof Ho&&"zoom"===o.input.name&&(i=o);return i instanceof Ao||o.eachChild(s=>{const c=Jt(s);c instanceof Ao?i=c:!i&&c?i=new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new Ao("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class ft{constructor(i,s,c,p){this.message=(i?`${i}: `:"")+c,p&&(this.identifier=p),null!=s&&s.__line__&&(this.line=s.__line__)}}function h(o){const i=o.key,s=o.value,c=o.valueSpec||{},p=o.objectElementValidators||{},g=o.style,v=o.styleSpec;let w=[];const T=Nn(s);if("object"!==T)return[new ft(i,s,`object expected, ${T} found`)];for(const S in s){const P=S.split(".")[0];let N;p[P]?N=p[P]:c[P]?N=lo:p["*"]?N=p["*"]:c["*"]&&(N=lo),N?w=w.concat(N({key:(i&&`${i}.`)+S,value:s[S],valueSpec:c[P]||c["*"],style:g,styleSpec:v,object:s,objectKey:S},s)):w.push(new ft(i,s[S],`unknown property "${S}"`))}for(const S in c)p[S]||c[S].required&&void 0===c[S].default&&void 0===s[S]&&w.push(new ft(i,s,`missing required property "${S}"`));return w}function x(o){const i=o.value,s=o.valueSpec,c=o.style,p=o.styleSpec,g=o.key,v=o.arrayElementValidator||lo;if("array"!==Nn(i))return[new ft(g,i,`array expected, ${Nn(i)} found`)];if(s.length&&i.length!==s.length)return[new ft(g,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new ft(g,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let w={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};p.$version<7&&(w.function=s.function),"object"===Nn(s.value)&&(w=s.value);let T=[];for(let S=0;S<i.length;S++)T=T.concat(v({array:i,arrayIndex:S,value:i[S],valueSpec:w,style:c,styleSpec:p,key:`${g}[${S}]`}));return T}function M(o){const i=o.key,s=o.value,c=o.valueSpec;let p=Nn(s);if("number"===p&&s!=s&&(p="NaN"),"number"!==p)return[new ft(i,s,`number expected, ${p} found`)];if("minimum"in c){let g=c.minimum;if("array"===Nn(c.minimum)&&(g=c.minimum[o.arrayIndex]),s<g)return[new ft(i,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if("array"===Nn(c.maximum)&&(g=c.maximum[o.arrayIndex]),s>g)return[new ft(i,s,`${s} is greater than the maximum value ${g}`)]}return[]}function k(o){const i=o.valueSpec,s=Qi(o.value.type);let c,p,g,v={};const w="categorical"!==s&&void 0===o.value.property,T=!w,S="array"===Nn(o.value.stops)&&"array"===Nn(o.value.stops[0])&&"object"===Nn(o.value.stops[0][0]),P=h({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(V){if("identity"===s)return[new ft(V.key,V.value,'identity function may not have a "stops" property')];let j=[];const q=V.value;return j=j.concat(x({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),"array"===Nn(q)&&0===q.length&&j.push(new ft(V.key,q,"array must have at least one stop")),j},default:function(V){return lo({key:V.key,value:V.value,valueSpec:i,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===s&&w&&P.push(new ft(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||P.push(new ft(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!Wo(o.valueSpec)&&P.push(new ft(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(T&&!ll(o.valueSpec)?P.push(new ft(o.key,o.value,"property functions not supported")):w&&!tu(o.valueSpec)&&P.push(new ft(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!S||void 0!==o.value.property||P.push(new ft(o.key,o.value,'"property" property is required')),P;function N(V){let j=[];const q=V.value,J=V.key;if("array"!==Nn(q))return[new ft(J,q,`array expected, ${Nn(q)} found`)];if(2!==q.length)return[new ft(J,q,`array length 2 expected, length ${q.length} found`)];if(S){if("object"!==Nn(q[0]))return[new ft(J,q,`object expected, ${Nn(q[0])} found`)];if(void 0===q[0].zoom)return[new ft(J,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new ft(J,q,"object stop key must have value")];const se=Qi(q[0].zoom);if("number"!=typeof se)return[new ft(J,q[0].zoom,"stop zoom values must be numbers")];if(g&&g>se)return[new ft(J,q[0].zoom,"stop zoom values must appear in ascending order")];se!==g&&(g=se,p=void 0,v={}),j=j.concat(h({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:M,value:F}}))}else j=j.concat(F({key:`${J}[0]`,value:q[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},q));return Oa(On(q[1]))?j.concat([new ft(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(lo({key:`${J}[1]`,value:q[1],valueSpec:i,style:V.style,styleSpec:V.styleSpec}))}function F(V,j){const q=Nn(V.value),J=Qi(V.value),se=null!==V.value?V.value:j;if(c){if(q!==c)return[new ft(V.key,se,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new ft(V.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==s){let ge=`number expected, ${q} found`;return ll(i)&&void 0===s&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(V.key,se,ge)]}return"categorical"!==s||"number"!==q||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==s&&"number"===q&&"number"==typeof J&&"number"==typeof p&&void 0!==p&&J<p?[new ft(V.key,se,"stop domain values must appear in ascending order")]:(p=J,"categorical"===s&&J in v?[new ft(V.key,se,"stop domain values must be unique")]:(v[J]=!0,[])):[new ft(V.key,se,`integer expected, found ${String(J)}`)]}}function U(o){const i=("property"===o.expressionContext?yc:Na)(On(o.value),o.valueSpec);if("error"===i.result)return i.value.map(c=>new ft(`${o.key}${c.key}`,o.value,c.message));const s=i.value.expression||i.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new ft(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Ra(s))return[new ft(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return X(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Xt(s,["zoom","feature-state"]))return[new ft(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!hc(s))return[new ft(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function X(o,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const p of i.valueSpec.expression.parameters)s.delete(p);if(0===s.size)return[];const c=[];return o instanceof Ho&&s.has(o.name)?[new ft(i.key,i.value,`["${o.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(o.eachChild(p=>{c.push(...X(p,i))}),c)}function we(o){const i=o.key,s=o.value,c=o.valueSpec,p=[];return Array.isArray(c.values)?-1===c.values.indexOf(Qi(s))&&p.push(new ft(i,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Qi(s))&&p.push(new ft(i,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function qe(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!qe(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Oe(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qe(o)||(o=Ki(o));const s=o;let c=!0;try{c=function(S){if(!bn(S))return S;let P=On(S);return rn(P),P=Tt(P),P}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const p=it[`filter_${i}`],g=Na(c,p);let v=null;if("error"===g.result)throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));v=(S,P,N)=>g.value.evaluate(S,P,{},N);let w=null,T=null;if(c!==s){const S=Na(s,p);if("error"===S.result)throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,N,F,V,j)=>S.value.evaluate(P,N,{},F,void 0,void 0,V,j),T=!hc(S.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:ur(c),needFeature:!!T}}function Tt(o){if(!Array.isArray(o))return o;const i=function(s){if(xn.has(s[0]))for(let c=1;c<s.length;c++)if(bn(s[c]))return!0;return s}(o);return!0===i?i:i.map(s=>Tt(s))}function rn(o){let i=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)i=i||bn(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){i=i||bn(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){i=i||bn(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}i&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)rn(o[c])}function bn(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let s=1;s<o.length;s++)if(bn(o[s]))return!0;return!1}const xn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fr(o,i){return o<i?-1:o>i?1:0}function ur(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let i=1;i<o.length;i++)if(ur(o[i]))return!0;return!1}function Ki(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?Sr(o[1],o[2],"=="):"!="===i?Xo(Sr(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Sr(o[1],o[2],i):"any"===i?(s=o.slice(1),["any"].concat(s.map(Ki))):"all"===i?["all"].concat(o.slice(1).map(Ki)):"none"===i?["all"].concat(o.slice(1).map(Ki).map(Xo)):"in"===i?Qs(o[1],o.slice(2)):"!in"===i?Xo(Qs(o[1],o.slice(2))):"has"===i?Cs(o[1]):"!has"===i?Xo(Cs(o[1])):"within"!==i||o;var s}function Sr(o,i,s){switch(o){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,o,i]}}function Qs(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Fr)]]:["filter-in-small",o,["literal",i]]}}function Cs(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Xo(o){return["!",o]}function ea(o){return qe(On(o.value))?U(os({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):Ts(o)}function Ts(o){const i=o.value,s=o.key;if("array"!==Nn(i))return[new ft(s,i,`array expected, ${Nn(i)} found`)];const c=o.styleSpec;let p,g=[];if(i.length<1)return[new ft(s,i,"filter array must have at least 1 element")];switch(g=g.concat(we({key:`${s}[0]`,value:i[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Qi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Qi(i[1])&&g.push(new ft(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&g.push(new ft(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=Nn(i[1]),"string"!==p&&g.push(new ft(`${s}[1]`,i[1],`string expected, ${p} found`)));for(let v=2;v<i.length;v++)p=Nn(i[v]),"$type"===Qi(i[1])?g=g.concat(we({key:`${s}[${v}]`,value:i[v],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&g.push(new ft(`${s}[${v}]`,i[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<i.length;v++)g=g.concat(Ts({key:`${s}[${v}]`,value:i[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=Nn(i[1]),2!==i.length?g.push(new ft(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==p&&g.push(new ft(`${s}[1]`,i[1],`string expected, ${p} found`));break;case"within":p=Nn(i[1]),2!==i.length?g.push(new ft(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==p&&g.push(new ft(`${s}[1]`,i[1],`object expected, ${p} found`))}return g}function ri(o,i){const s=o.key,c=o.style,p=o.styleSpec,g=o.value,v=o.objectKey,w=p[`${i}_${o.layerType}`];if(!w)return[];const T=v.match(/^(.*)-transition$/);if("paint"===i&&T&&w[T[1]]&&w[T[1]].transition)return lo({key:s,value:g,valueSpec:p.transition,style:c,styleSpec:p});const S=o.valueSpec||w[v];if(!S)return[new ft(s,g,`unknown property "${v}"`)];let P;if("string"===Nn(g)&&ll(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(g))){const F=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new ft(s,g,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${F}.`)]}const N=[];return"symbol"===o.layerType&&("text-field"===v&&c&&!c.glyphs&&N.push(new ft(s,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Ul(On(g))&&"identity"===Qi(g.type)&&N.push(new ft(s,g,'"text-font" does not support identity functions'))),N.concat(lo({key:o.key,value:g,valueSpec:S,style:c,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:v}))}function $h(o){return ri(o,"paint")}function hr(o){return ri(o,"layout")}function $l(o){let i=[];const s=o.value,c=o.key,p=o.style,g=o.styleSpec;s.type||s.ref||i.push(new ft(c,s,'either "type" or "ref" is required'));let v=Qi(s.type);const w=Qi(s.ref);if(s.id){const T=Qi(s.id);for(let S=0;S<o.arrayIndex;S++){const P=p.layers[S];Qi(P.id)===T&&i.push(new ft(c,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(S=>{S in s&&i.push(new ft(c,s[S],`"${S}" is prohibited for ref layers`))}),p.layers.forEach(S=>{Qi(S.id)===w&&(T=S)}),T?T.ref?i.push(new ft(c,s.ref,"ref cannot reference another ref layer")):v=Qi(T.type):"string"==typeof w&&i.push(new ft(c,s.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(s.source){const T=p.sources&&p.sources[s.source],S=T&&Qi(T.type);T?"vector"===S&&"raster"===v?i.push(new ft(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===S&&"raster"!==v?i.push(new ft(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==S||s["source-layer"]?"raster-dem"===S&&"hillshade"!==v?i.push(new ft(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||"geojson"===S&&T.lineMetrics||i.push(new ft(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ft(c,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new ft(c,s.source,`source "${s.source}" not found`))}else i.push(new ft(c,s,'missing required property "source"'));return i=i.concat(h({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lo({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:T=>ea(os({layerType:v},T)),layout:T=>h({layer:s,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>hr(os({layerType:v},S))}}),paint:T=>h({layer:s,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>$h(os({layerType:v},S))}})}})),i}function Jr(o){const i=o.value,s=o.key,c=Nn(i);return"string"!==c?[new ft(s,i,`string expected, ${c} found`)]:[]}const vc={promoteId:function({key:o,value:i}){if("string"===Nn(i))return Jr({key:o,value:i});{const s=[];for(const c in i)s.push(...Jr({key:`${o}.${c}`,value:i[c]}));return s}}};function dl(o){const i=o.value,s=o.key,c=o.styleSpec,p=o.style;if(!i.type)return[new ft(s,i,'"type" is required')];const g=Qi(i.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=h({key:s,value:i,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:vc}),v;case"geojson":if(v=h({key:s,value:i,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:vc}),i.cluster)for(const w in i.clusterProperties){const[T,S]=i.clusterProperties[w],P="string"==typeof T?[T,["accumulated"],["get",w]]:T;v.push(...U({key:`${s}.${w}.map`,value:S,expressionContext:"cluster-map"})),v.push(...U({key:`${s}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return h({key:s,value:i,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return h({key:s,value:i,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new ft(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return we({key:`${s}.type`,value:i.type,valueSpec:{values:fl(c)},style:p,styleSpec:c})}}function fl(o){return o.source.reduce((i,s)=>{const c=o[s];return"enum"===c.type.type&&(i=i.concat(Object.keys(c.type.values))),i},[])}function zr(o){const i=o.value,s=o.styleSpec,c=s.light,p=o.style;let g=[];const v=Nn(i);if(void 0===i)return g;if("object"!==v)return g=g.concat([new ft("light",i,`object expected, ${v} found`)]),g;for(const w in i){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&c[T[1]]&&c[T[1]].transition?lo({key:w,value:i[w],valueSpec:s.transition,style:p,styleSpec:s}):c[w]?lo({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:s}):[new ft(w,i[w],`unknown property "${w}"`)])}return g}function Hh(o){const i=o.value,s=o.key,c=o.style,p=o.styleSpec,g=p.terrain;let v=[];const w=Nn(i);if(void 0===i)return v;if("object"!==w)return v=v.concat([new ft("terrain",i,`object expected, ${w} found`)]),v;for(const T in i){const S=T.match(/^(.*)-transition$/);v=v.concat(S&&g[S[1]]&&g[S[1]].transition?lo({key:T,value:i[T],valueSpec:p.transition,style:c,styleSpec:p}):g[T]?lo({key:T,value:i[T],valueSpec:g[T],style:c,styleSpec:p}):[new ft(T,i[T],`unknown property "${T}"`)])}if(i.source){const T=c.sources&&c.sources[i.source],S=T&&Qi(T.type);T?"raster-dem"!==S&&v.push(new ft(s,i.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):v.push(new ft(s,i.source,`source "${i.source}" not found`))}else v.push(new ft(s,i,'terrain is missing required property "source"'));return v}function No(o){const i=o.value,s=o.style,c=o.styleSpec,p=c.fog;let g=[];const v=Nn(i);if(void 0===i)return g;if("object"!==v)return g=g.concat([new ft("fog",i,`object expected, ${v} found`)]),g;for(const w in i){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&p[T[1]]&&p[T[1]].transition?lo({key:w,value:i[w],valueSpec:c.transition,style:s,styleSpec:c}):p[w]?lo({key:w,value:i[w],valueSpec:p[w],style:s,styleSpec:c}):[new ft(w,i[w],`unknown property "${w}"`)])}return g}const To={"*":()=>[],array:x,boolean:function(o){const i=o.value,s=o.key,c=Nn(i);return"boolean"!==c?[new ft(s,i,`boolean expected, ${c} found`)]:[]},number:M,color:function(o){const i=o.key,s=o.value,c=Nn(s);return"string"!==c?[new ft(i,s,`color expected, ${c} found`)]:null===Pn(s)?[new ft(i,s,`color expected, "${s}" found`)]:[]},enum:we,filter:ea,function:k,layer:$l,object:h,source:dl,light:zr,terrain:Hh,fog:No,string:Jr,formatted:function(o){return 0===Jr(o).length?[]:U(o)},resolvedImage:function(o){return 0===Jr(o).length?[]:U(o)},projection:function(o){const i=o.value,s=o.styleSpec,c=s.projection,p=o.style;let g=[];const v=Nn(i);if("object"===v)for(const w in i)g=g.concat(lo({key:w,value:i[w],valueSpec:c[w],style:p,styleSpec:s}));else"string"!==v&&(g=g.concat([new ft("projection",i,`object or string expected, ${v} found`)]));return g}};function lo(o){const i=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Ul(Qi(i))?k(o):s.expression&&Oa(On(i))?U(o):s.type&&To[s.type]?To[s.type](o):h(os({},o,{valueSpec:s.type?c[s.type]:s}))}function xc(o){const i=o.value,s=o.key,c=Jr(o);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new ft(s,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new ft(s,i,'"glyphs" url must include a "{range}" token'))),c}function ju(o,i=it){return Ds(lo({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:xc,"*":()=>[]}}))}const ta=o=>Ds($h(o)),Xd=o=>Ds(hr(o));function Ds(o){return o.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function pp(o,i){let s=!1;if(i&&i.length)for(const c of i)o.fire(new _o(new Error(c.message))),s=!0;return s}var Ry=Fa,na=3;function Fa(o,i,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var p=new Int32Array(this.arrayBuffer);o=p[0],this.d=(i=p[1])+2*(s=p[2]);for(var g=0;g<this.d*this.d;g++){var v=p[na+g],w=p[na+g+1];c.push(v===w?null:p.subarray(v,w))}var T=p[na+c.length+1];this.keys=p.subarray(p[na+c.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=i+2*s;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=s,this.scale=i/o,this.uid=0;var P=s/i*o;this.min=-P,this.max=o+P}Fa.prototype.insert=function(o,i,s,c,p){this._forEachCell(i,s,c,p,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)},Fa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fa.prototype._insertCell=function(o,i,s,c,p,g){this.cells[p].push(g)},Fa.prototype.query=function(o,i,s,c,p){var g=this.min,v=this.max;if(o<=g&&i<=g&&v<=s&&v<=c&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(o,i,s,c,this._queryCell,w,{},p),w},Fa.prototype._queryCell=function(o,i,s,c,p,g,v,w){var T=this.cells[p];if(null!==T)for(var S=this.keys,P=this.bboxes,N=0;N<T.length;N++){var F=T[N];if(void 0===v[F]){var V=4*F;(w?w(P[V+0],P[V+1],P[V+2],P[V+3]):o<=P[V+2]&&i<=P[V+3]&&s>=P[V+0]&&c>=P[V+1])?(v[F]=!0,g.push(S[F])):v[F]=!1}}},Fa.prototype._forEachCell=function(o,i,s,c,p,g,v,w){for(var T=this._convertToCellCoord(o),S=this._convertToCellCoord(i),P=this._convertToCellCoord(s),N=this._convertToCellCoord(c),F=T;F<=P;F++)for(var V=S;V<=N;V++){var j=this.d*V+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&p.call(this,o,i,s,c,j,g,v,w))return}},Fa.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Fa.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Fa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=na+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var p=new Int32Array(i+s+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=i,v=0;v<o.length;v++){var w=o[v];p[na+v]=g,p.set(w,g),g+=w.length}return p[na+o.length]=g,p.set(this.keys,g),p[na+o.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};var nu=he(Ry);const Yd={};function Qt(o,i,s={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writeable:!1}),Yd[i]={klass:o,omit:s.omit||[]}}Qt(Object,"Object"),nu.serialize=function(o,i){const s=o.toArrayBuffer();return i&&i.push(s),{buffer:s}},nu.deserialize=function(o){return new nu(o.buffer)},Object.defineProperty(nu,"name",{value:"Grid"}),Qt(nu,"Grid"),Qt(cn,"Color"),Qt(Error,"Error"),Qt(ro,"AJAXError"),Qt(Ro,"ResolvedImage"),Qt(Yi,"StylePropertyFunction"),Qt(Kr,"StyleExpression",{omit:["_evaluator"]}),Qt(jl,"ZoomDependentExpression"),Qt(hl,"ZoomConstantExpression"),Qt(Ho,"CompoundExpression",{omit:["_evaluate"]});for(const o in _c)Yd[_c[o]._classRegistryKey]||Qt(_c[o],`Expression${o}`);function mp(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function gp(o){return Q.ImageBitmap&&o instanceof Q.ImageBitmap}function $u(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(mp(o)||gp(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return i&&i.push(s.buffer),s}if(o instanceof Q.ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push($u(c,i));return s}if("object"==typeof o){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=s.serialize?s.serialize(o,i):{};if(!s.serialize){for(const g in o)o.hasOwnProperty(g)&&(Yd[c].omit.indexOf(g)>=0||(p[g]=$u(o[g],i)));o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof o)}function iu(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||mp(o)||gp(o)||ArrayBuffer.isView(o)||o instanceof Q.ImageData)return o;if(Array.isArray(o))return o.map(iu);if("object"==typeof o){const i=o.$name||"Object",{klass:s}=Yd[i];if(!s)throw new Error(`can't deserialize unregistered class ${i}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const p of Object.keys(o))"$name"!==p&&(c[p]=iu(o[p]));return c}throw new Error("can't deserialize object of type "+typeof o)}const Gt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function _p(o){for(const i of o)if(yp(i.charCodeAt(0)))return!0;return!1}function Ly(o){for(const i of o)if(!ag(i.charCodeAt(0)))return!1;return!0}function ag(o){return!(Gt.Arabic(o)||Gt["Arabic Supplement"](o)||Gt["Arabic Extended-A"](o)||Gt["Arabic Presentation Forms-A"](o)||Gt["Arabic Presentation Forms-B"](o))}function yp(o){return!(746!==o&&747!==o&&(o<4352||!(Gt["Bopomofo Extended"](o)||Gt.Bopomofo(o)||Gt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Gt["CJK Compatibility Ideographs"](o)||Gt["CJK Compatibility"](o)||Gt["CJK Radicals Supplement"](o)||Gt["CJK Strokes"](o)||!(!Gt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Gt["CJK Unified Ideographs Extension A"](o)||Gt["CJK Unified Ideographs"](o)||Gt["Enclosed CJK Letters and Months"](o)||Gt["Hangul Compatibility Jamo"](o)||Gt["Hangul Jamo Extended-A"](o)||Gt["Hangul Jamo Extended-B"](o)||Gt["Hangul Jamo"](o)||Gt["Hangul Syllables"](o)||Gt.Hiragana(o)||Gt["Ideographic Description Characters"](o)||Gt.Kanbun(o)||Gt["Kangxi Radicals"](o)||Gt["Katakana Phonetic Extensions"](o)||Gt.Katakana(o)&&12540!==o||!(!Gt["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Gt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Gt["Unified Canadian Aboriginal Syllabics"](o)||Gt["Unified Canadian Aboriginal Syllabics Extended"](o)||Gt["Vertical Forms"](o)||Gt["Yijing Hexagram Symbols"](o)||Gt["Yi Syllables"](o)||Gt["Yi Radicals"](o))))}function Kd(o){return!(yp(o)||(i=o,Gt["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Gt["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Gt["Letterlike Symbols"](i)||Gt["Number Forms"](i)||Gt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Gt["Control Pictures"](i)&&9251!==i||Gt["Optical Character Recognition"](i)||Gt["Enclosed Alphanumerics"](i)||Gt["Geometric Shapes"](i)||Gt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Gt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Gt["CJK Symbols and Punctuation"](i)||Gt.Katakana(i)||Gt["Private Use Area"](i)||Gt["CJK Compatibility Forms"](i)||Gt["Small Form Variants"](i)||Gt["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Jd(o){return o>=1424&&o<=2303||Gt["Arabic Presentation Forms-A"](o)||Gt["Arabic Presentation Forms-B"](o)}function ky(o,i){return!(!i&&Jd(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Gt.Khmer(o))}function Oy(o){for(const i of o)if(Jd(i.charCodeAt(0)))return!0;return!1}const vp="deferred",pl="loading",za="loaded";let Hu=null,m="unavailable",a=null;const f=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(m="error"),Hu&&Hu(o)};function _(){b.fire(new Ta("pluginStateChange",{pluginStatus:m,pluginURL:a}))}const b=new Vs,E=function(){return m},I=function(){if(m!==vp||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=pl,_(),a&&Qa({url:a},o=>{o?f(o):(m=za,_())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===za||null!=A.applyArabicShaping,isLoading:()=>m===pl,setState(o){m=o.pluginStatus,a=o.pluginURL},isParsed:()=>null!=A.applyArabicShaping&&null!=A.processBidirectionalText&&null!=A.processStyledBidirectionalText,getPluginURL:()=>a};class R{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(s,c){for(const p of s)if(!ky(p.charCodeAt(0),c))return!1;return!0}(i,A.isLoaded())}}class B{constructor(i,s){this.property=i,this.value=s,this.expression=function(c,p){if(Ul(c))return new Yi(c,p);if(Oa(c)){const g=yc(c,p);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=c;return"string"==typeof c&&"color"===p.type&&(g=cn.parse(c)),{kind:"constant",evaluate:()=>g}}}(void 0===s?i.specification.default:s,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,s,c){return this.property.possiblyEvaluate(this,i,s,c)}}class z{constructor(i){this.property=i,this.value=new B(i,void 0)}transitioned(i,s){return new K(this.property,this.value,s,si({},i.transition,this.transition),i.now)}untransitioned(){return new K(this.property,this.value,null,{},0)}}class H{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return An(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new z(this._values[i].property)),this._values[i].value=new B(this._values[i].property,null===s?void 0:An(s))}getTransition(i){return An(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new z(this._values[i].property)),this._values[i].transition=An(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c);const p=this.getTransition(s);void 0!==p&&(i[`${s}-transition`]=p)}return i}transitioned(i,s){const c=new te(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(i,s._values[p]);return c}untransitioned(){const i=new te(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class K{constructor(i,s,c,p,g){const v=p.delay||0,w=p.duration||0;g=g||0,this.property=i,this.value=s,this.begin=g+v,this.end=this.begin+w,i.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(i,s,c){const p=i.now||0,g=this.value.possiblyEvaluate(i,s,c),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(i,s,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(i,s,c),g,qi(w))}}return g}}class te{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,c){const p=new re(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,s,c);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ie{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return An(this._values[i].value)}setValue(i,s){this._values[i]=new B(this._values[i].property,null===s?void 0:An(s))}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c)}return i}possiblyEvaluate(i,s,c){const p=new re(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,s,c);return p}}class ne{constructor(i,s,c){this.property=i,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,s,c,p){return this.property.evaluate(this.value,this.parameters,i,s,c,p)}}class re{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class G{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,c){const p=fc[this.specification.type];return p?p(i,s,c):i}}class ee{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,c,p){return new ne(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(s,null,{},c,p)}:i.expression,s)}interpolate(i,s,c){if("constant"!==i.value.kind||"constant"!==s.value.kind)return i;if(void 0===i.value.value||void 0===s.value.value)return new ne(this,{kind:"constant",value:void 0},i.parameters);const p=fc[this.specification.type];return p?new ne(this,{kind:"constant",value:p(i.value.value,s.value.value,c)},i.parameters):i}evaluate(i,s,c,p,g,v){return"constant"===i.kind?i.value:i.evaluate(s,c,p,g,v)}}class le{constructor(i){this.specification=i}possiblyEvaluate(i,s,c,p){return!!i.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class ce{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new R(0,{});for(const c in i){const p=i[c];p.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new B(p,void 0),v=this.defaultTransitionablePropertyValues[c]=new z(p);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(s)}}}function Ee(o,i){return 256*(o=Dn(Math.floor(o),0,255))+Dn(Math.floor(i),0,255)}Qt(ee,"DataDrivenProperty"),Qt(G,"DataConstantProperty"),Qt(le,"ColorRampProperty");const Te={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ce{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ne{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pe(o,i=1){let s=0,c=0;return{members:o.map(p=>{const g=Te[p.type].BYTES_PER_ELEMENT,v=s=Xe(s,Math.max(i,g)),w=p.components||1;return c=Math.max(c,g),s+=g*w,{name:p.name,type:p.type,components:w,offset:v}}),size:Xe(s,Math.max(c,i)),alignment:i}}function Xe(o,i){return Math.ceil(o/i)*i}class Et extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.int16[p+0]=s,this.int16[p+1]=c,i}}Et.prototype.bytesPerElement=4,Qt(Et,"StructArrayLayout2i4");class je extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=p,i}}je.prototype.bytesPerElement=6,Qt(je,"StructArrayLayout3i6");class ut extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=p,this.int16[v+3]=g,i}}ut.prototype.bytesPerElement=8,Qt(ut,"StructArrayLayout4i8");class et extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,c,p,g,v,w)}emplace(i,s,c,p,g,v,w,T){const S=6*i,P=12*i,N=3*i;return this.int16[S+0]=s,this.int16[S+1]=c,this.uint8[P+4]=p,this.uint8[P+5]=g,this.uint8[P+6]=v,this.uint8[P+7]=w,this.float32[N+2]=T,i}}et.prototype.bytesPerElement=12,Qt(et,"StructArrayLayout2i4ub1f12");class xt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=p,this.float32[v+3]=g,i}}xt.prototype.bytesPerElement=16,Qt(xt,"StructArrayLayout4f16");class We extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=6*i,T=3*i;return this.uint16[w+0]=s,this.uint16[w+1]=c,this.uint16[w+2]=p,this.uint16[w+3]=g,this.float32[T+2]=v,i}}We.prototype.bytesPerElement=12,Qt(We,"StructArrayLayout4ui1f12");class lt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=4*i;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=p,this.uint16[v+3]=g,i}}lt.prototype.bytesPerElement=8,Qt(lt,"StructArrayLayout4ui8");class Dt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,p,g,v)}emplace(i,s,c,p,g,v,w){const T=6*i;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=g,this.int16[T+4]=v,this.int16[T+5]=w,i}}Dt.prototype.bytesPerElement=12,Qt(Dt,"StructArrayLayout6i12");class pt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F){const V=this.length;return this.resize(V+1),this.emplace(V,i,s,c,p,g,v,w,T,S,P,N,F)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V){const j=12*i;return this.int16[j+0]=s,this.int16[j+1]=c,this.int16[j+2]=p,this.int16[j+3]=g,this.uint16[j+4]=v,this.uint16[j+5]=w,this.uint16[j+6]=T,this.uint16[j+7]=S,this.int16[j+8]=P,this.int16[j+9]=N,this.int16[j+10]=F,this.int16[j+11]=V,i}}pt.prototype.bytesPerElement=24,Qt(pt,"StructArrayLayout4i4ui4i24");class It extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,p,g,v)}emplace(i,s,c,p,g,v,w){const T=10*i,S=5*i;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.float32[S+2]=g,this.float32[S+3]=v,this.float32[S+4]=w,i}}It.prototype.bytesPerElement=20,Qt(It,"StructArrayLayout3i3f20");class un extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}un.prototype.bytesPerElement=4,Qt(un,"StructArrayLayout1ul4");class Ln extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V){const j=this.length;return this.resize(j+1),this.emplace(j,i,s,c,p,g,v,w,T,S,P,N,F,V)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=20*i,J=10*i;return this.int16[q+0]=s,this.int16[q+1]=c,this.int16[q+2]=p,this.int16[q+3]=g,this.int16[q+4]=v,this.float32[J+3]=w,this.float32[J+4]=T,this.float32[J+5]=S,this.float32[J+6]=P,this.int16[q+14]=N,this.uint32[J+8]=F,this.uint16[q+18]=V,this.uint16[q+19]=j,i}}Ln.prototype.bytesPerElement=40,Qt(Ln,"StructArrayLayout5i4f1i1ul2ui40");class en extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,c,p,g,v,w)}emplace(i,s,c,p,g,v,w,T){const S=8*i;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+4]=g,this.int16[S+5]=v,this.int16[S+6]=w,this.int16[S+7]=T,i}}en.prototype.bytesPerElement=16,Qt(en,"StructArrayLayout3i2i2i16");class wn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=4*i,T=8*i;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[T+6]=g,this.int16[T+7]=v,i}}wn.prototype.bytesPerElement=16,Qt(wn,"StructArrayLayout2f1f2i16");class ei extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=12*i,w=3*i;return this.uint8[v+0]=s,this.uint8[v+1]=c,this.float32[w+1]=p,this.float32[w+2]=g,i}}ei.prototype.bytesPerElement=12,Qt(ei,"StructArrayLayout2ub2f12");class Jn extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=p,i}}Jn.prototype.bytesPerElement=12,Qt(Jn,"StructArrayLayout3f12");class Kt extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c)}emplace(i,s,c,p){const g=3*i;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=p,i}}Kt.prototype.bytesPerElement=6,Qt(Kt,"StructArrayLayout3ui6");class Ti extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,ge,ae,de,ye){const _e=this.length;return this.resize(_e+1),this.emplace(_e,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,ge,ae,de,ye)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,ge,ae,de,ye,_e){const Ze=30*i,He=15*i,st=60*i;return this.int16[Ze+0]=s,this.int16[Ze+1]=c,this.int16[Ze+2]=p,this.float32[He+2]=g,this.float32[He+3]=v,this.uint16[Ze+8]=w,this.uint16[Ze+9]=T,this.uint32[He+5]=S,this.uint32[He+6]=P,this.uint32[He+7]=N,this.uint16[Ze+16]=F,this.uint16[Ze+17]=V,this.uint16[Ze+18]=j,this.float32[He+10]=q,this.float32[He+11]=J,this.uint8[st+48]=se,this.uint8[st+49]=ge,this.uint8[st+50]=ae,this.uint32[He+13]=de,this.int16[Ze+28]=ye,this.uint8[st+58]=_e,i}}Ti.prototype.bytesPerElement=60,Qt(Ti,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ni extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,ge,ae,de,ye,_e,Ze,He,st,wt,Ke,ht,ct,_t){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,ge,ae,de,ye,_e,Ze,He,st,wt,Ke,ht,ct,_t)}emplace(i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J,se,ge,ae,de,ye,_e,Ze,He,st,wt,Ke,ht,ct,_t,Pt){const rt=38*i,$t=19*i;return this.int16[rt+0]=s,this.int16[rt+1]=c,this.int16[rt+2]=p,this.float32[$t+2]=g,this.float32[$t+3]=v,this.int16[rt+8]=w,this.int16[rt+9]=T,this.int16[rt+10]=S,this.int16[rt+11]=P,this.int16[rt+12]=N,this.int16[rt+13]=F,this.uint16[rt+14]=V,this.uint16[rt+15]=j,this.uint16[rt+16]=q,this.uint16[rt+17]=J,this.uint16[rt+18]=se,this.uint16[rt+19]=ge,this.uint16[rt+20]=ae,this.uint16[rt+21]=de,this.uint16[rt+22]=ye,this.uint16[rt+23]=_e,this.uint16[rt+24]=Ze,this.uint16[rt+25]=He,this.uint16[rt+26]=st,this.uint16[rt+27]=wt,this.uint16[rt+28]=Ke,this.uint32[$t+15]=ht,this.float32[$t+16]=ct,this.float32[$t+17]=_t,this.float32[$t+18]=Pt,i}}Ni.prototype.bytesPerElement=76,Qt(Ni,"StructArrayLayout3i2f6i15ui1ul3f76");class Fi extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}Fi.prototype.bytesPerElement=4,Qt(Fi,"StructArrayLayout1f4");class Si extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,p,g)}emplace(i,s,c,p,g,v){const w=5*i;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=p,this.float32[w+3]=g,this.float32[w+4]=v,i}}Si.prototype.bytesPerElement=20,Qt(Si,"StructArrayLayout5f20");class yo extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,c,p)}emplace(i,s,c,p,g){const v=6*i;return this.uint32[3*i+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=p,this.uint16[v+4]=g,i}}yo.prototype.bytesPerElement=12,Qt(yo,"StructArrayLayout1ul3ui12");class co extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.uint16[p+0]=s,this.uint16[p+1]=c,i}}co.prototype.bytesPerElement=4,Qt(co,"StructArrayLayout2ui4");class Yo extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}Yo.prototype.bytesPerElement=2,Qt(Yo,"StructArrayLayout1ui2");class Ba extends Ne{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const p=2*i;return this.float32[p+0]=s,this.float32[p+1]=c,i}}Ba.prototype.bytesPerElement=8,Qt(Ba,"StructArrayLayout2f8");class _i extends Ce{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_i.prototype.size=40;class Ii extends Ln{get(i){return new _i(this,i)}}Qt(Ii,"CollisionBoxArray");class mi extends Ce{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}mi.prototype.size=60;class Xn extends Ti{get(i){return new mi(this,i)}}Qt(Xn,"PlacedSymbolArray");class vo extends Ce{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vo.prototype.size=76;class zi extends Ni{get(i){return new vo(this,i)}}Qt(zi,"SymbolInstanceArray");class tr extends Fi{getoffsetX(i){return this.float32[1*i+0]}}Qt(tr,"GlyphOffsetArray");class Gh extends Et{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Qt(Gh,"SymbolLineVertexArray");class Hl extends Ce{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Hl.prototype.size=12;class Va extends yo{get(i){return new Hl(this,i)}}Qt(Va,"FeatureIndexArray");class Br extends co{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Qt(Br,"FillExtrusionCentroidArray");const Gl=Pe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),bc=Pe([{name:"a_dash",components:4,type:"Uint16"}]);var qh={exports:{}},lg=function(o,i){var s,c,p,g,v,w,T,S;for(c=o.length-(s=3&o.length),p=i,v=3432918353,w=461845907,S=0;S<c;)T=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,p=27492+(65535&(g=5*(65535&(p=(p^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&o.charCodeAt(S+2))<<16;case 2:T^=(255&o.charCodeAt(S+1))<<8;case 1:p^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(S)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return p^=o.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},Fy=function(o,i){for(var s,c=o.length,p=i^c,g=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:p^=(255&o.charCodeAt(g+2))<<16;case 2:p^=(255&o.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&o.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};qh.exports=lg,qh.exports.murmur3=lg,qh.exports.murmur2=Fy;var xp=he(qh.exports);class bp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,s,c,p){this.ids.push(Zn(i)),this.positions.push(s,c,p)}getPositions(i){const s=Zn(i);let c=0,p=this.ids.length-1;for(;c<p;){const v=c+p>>1;this.ids[v]>=s?p=v:c=v+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(i,s){const c=new Float64Array(i.ids),p=new Uint32Array(i.positions);return wp(c,p,0,c.length-1),s&&s.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(i){const s=new bp;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s}}function Zn(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:xp(String(o))}function wp(o,i,s,c){for(;s<c;){const p=o[s+c>>1];let g=s-1,v=c+1;for(;;){do{g++}while(o[g]<p);do{v--}while(o[v]>p);if(g>=v)break;cg(o,g,v),cg(i,3*g,3*v),cg(i,3*g+1,3*v+1),cg(i,3*g+2,3*v+2)}v-s<c-v?(wp(o,i,s,v),s=v+1):(wp(o,i,v+1,c),c=v)}}function cg(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}Qt(bp,"FeaturePositionMap");class wc{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}}class Ep extends wc{constructor(i){super(i),this.current=0}set(i,s,c){this.fetchUniformLocation(i,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class zy extends wc{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class ug extends wc{constructor(i){super(i),this.current=cn.transparent}set(i,s,c){this.fetchUniformLocation(i,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Wh=new Float32Array(16),Vx=new Float32Array(9),Ux=new Float32Array(4);function hg(o){return[Ee(255*o.r,255*o.g),Ee(255*o.b,255*o.a)]}class Qd{constructor(i,s,c){this.value=i,this.uniformNames=s.map(p=>`u_${p}`),this.type=c}setUniform(i,s,c,p,g){s.set(i,g,p.constantOr(this.value))}getBinding(i,s){return"color"===this.type?new ug(i):new Ep(i)}}class Xh{constructor(i,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,s,c,p,g){const v="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;v&&s.set(i,g,v)}getBinding(i,s){return"u_pattern"===s||"u_dash"===s?new zy(i):new Ep(i)}}class vt{constructor(i,s,c,p){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,s,c,p,g,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new R(0),s,{},g,p,v);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,s,c,p,g){const v=this.expression.evaluate({zoom:0},c,p,void 0,g);this._setPaintValue(i,s,v)}_setPaintValue(i,s,c){if("color"===this.type){const p=hg(c);for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=i;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ti{constructor(i,s,c,p,g,v){this.expression=i,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,s,c,p,g,v){const w=this.expression.evaluate(new R(this.zoom),s,{},g,p,v),T=this.expression.evaluate(new R(this.zoom+1),s,{},g,p,v),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,w,T)}updatePaintArray(i,s,c,p,g){const v=this.expression.evaluate({zoom:this.zoom},c,p,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,g);this._setPaintValue(i,s,v,w)}_setPaintValue(i,s,c,p){if("color"===this.type){const g=hg(c),v=hg(p);for(let w=i;w<s;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,c,p,g){const v=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,w=Dn(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);s.set(i,g,w)}getBinding(i,s){return new Ep(i)}}class yi{constructor(i,s,c,p,g){this.expression=i,this.layerId=g,this.paintVertexAttributes=("array"===c?bc:Gl).members;for(let v=0;v<s.length;++v);this.paintVertexArray=new p}populatePaintArray(i,s,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(p,i,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(i,s,c,p,g,v){this._setPaintValues(i,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(i,s,c,p){if(!p||!c)return;const g=p[c];if(!g)return;const{tl:v,br:w,pixelRatio:T}=g;for(let S=i;S<s;S++)this.paintVertexArray.emplace(S,v[0],v[1],w[0],w[1],T)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vi{constructor(i,s,c=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const g in i.paint._values){if(!c(g))continue;const v=i.paint.get(g);if(!(v instanceof ne&&ll(v.property.specification)))continue;const w=ef(g,i.type),T=v.value,S=v.property.specification.type,P=!!v.property.useIntegerZoom,N="line-dasharray"===g||g.endsWith("pattern"),F="line-dasharray"===g&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==T.kind||F)if("source"===T.kind||F||N){const V=Cp(g,S,"source");this.binders[g]=N?new yi(T,w,S,V,i.id):new vt(T,w,S,V),p.push(`/a_${g}`)}else{const V=Cp(g,S,"composite");this.binders[g]=new ti(T,w,S,P,s,V),p.push(`/z_${g}`)}else this.binders[g]=N?new Xh(T.value,w):new Qd(T.value,w,S),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof vt||s instanceof ti?s.maxValue:0}populatePaintArrays(i,s,c,p,g,v){for(const w in this.binders){const T=this.binders[w];(T instanceof vt||T instanceof ti||T instanceof yi)&&T.populatePaintArray(i,s,c,p,g,v)}}setConstantPatternPositions(i){for(const s in this.binders){const c=this.binders[s];c instanceof Xh&&c.setConstantPatternPositions(i)}}updatePaintArrays(i,s,c,p,g,v){let w=!1;for(const T in i){const S=s.getPositions(T);for(const P of S){const N=c.feature(P.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof vt||V instanceof ti||V instanceof yi)&&!0===V.expression.isStateDependent){const j=p.paint.get(F);V.expression=j.value,V.updatePaintArray(P.start,P.end,N,i[T],g,v),w=!0}}}}return w}defines(){const i=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Qd||c instanceof Xh)&&i.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof vt||c instanceof ti||c instanceof yi)for(let p=0;p<c.paintVertexAttributes.length;p++)i.push(c.paintVertexAttributes[p].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Qd||c instanceof Xh||c instanceof ti)for(const p of c.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Qd||p instanceof Xh||p instanceof ti)for(const g of p.uniformNames)s.push({name:g,property:c,binding:p.getBinding(i,g)})}return s}setUniforms(i,s,c,p,g){for(const{name:v,property:w,binding:T}of c)this.binders[w].setUniform(i,T,g,p.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof vt||s instanceof ti||s instanceof yi)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(i){for(const s in this.binders){const c=this.binders[s];(c instanceof vt||c instanceof ti||c instanceof yi)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof vt||s instanceof ti||s instanceof yi)&&s.destroy()}}}class Vr{constructor(i,s,c=(()=>!0)){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new vi(p,s,c);this.needsUpload=!1,this._featureMap=new bp,this._bufferOffset=0}populatePaintArrays(i,s,c,p,g,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,s,p,g,v,w);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,c,p,g){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,s,v,p,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const By={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ef(o,i){return By[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const ql={"line-pattern":{source:We,composite:We},"fill-pattern":{source:We,composite:We},"fill-extrusion-pattern":{source:We,composite:We},"line-dasharray":{source:lt,composite:lt}},dg={color:{source:Ba,composite:xt},number:{source:Fi,composite:Ba}};function Cp(o,i,s){const c=ql[o];return c&&c[s]||dg[i][s]}Qt(Qd,"ConstantBinder"),Qt(Xh,"PatternConstantBinder"),Qt(vt,"SourceExpressionBinder"),Qt(yi,"PatternCompositeBinder"),Qt(ti,"CompositeExpressionBinder"),Qt(vi,"ProgramConfiguration",{omit:["_buffers"]}),Qt(Vr,"ProgramConfigurationSet");const Vy="-transition";class Zl extends Vs{constructor(i,s){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),s.layout&&(this._unevaluatedLayout=new ie(s.layout)),s.paint)){this._transitionablePaint=new H(s.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new re(s.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s,c={}){null!=s&&this._validate(Xd,`layers.${this.id}.layout.${i}`,i,s,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,s):this.visibility=s)}getPaintProperty(i){return pi(i,Vy)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s,c={}){if(null!=s&&this._validate(ta,`layers.${this.id}.paint.${i}`,i,s,c))return!1;if(pi(i,Vy))return this._transitionablePaint.setTransition(i.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[i],g=p.value.isDataDriven(),v=p.value;this._transitionablePaint.setValue(i,s),this._handleSpecialPaintPropertyUpdate(i);const w=this._transitionablePaint._values[i].value,T=w.isDataDriven(),S=pi(i,"pattern")||"line-dasharray"===i;return T||g||S||this._handleOverridablePaintPropertyUpdate(i,v,w)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,s,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),is(i,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(i,s,c,p,g={}){return(!g||!1!==g.validate)&&pp(this,i.call(ju,{key:s,layerType:this.type,objectKey:c,value:p,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof ne&&ll(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Oe(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Uy=Pe([{name:"a_pos",components:2,type:"Int16"}],4),ds=Pe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ji{constructor(i=[]){this.segments=i}prepareSegment(i,s,c,p){let g=this.segments[this.segments.length-1];return i>ji.MAX_VERTEX_ARRAY_LENGTH&&Ji(`Max vertices per segment is ${ji.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>ji.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==p&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,c,p){return new ji([{vertexOffset:i,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}ji.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt(ji,"SegmentVector");var _n=8192;class ia{constructor(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof xi?new xi(i.lng,i.lat):xi.convert(i),this}setSouthWest(i){return this._sw=i instanceof xi?new xi(i.lng,i.lat):xi.convert(i),this}extend(i){const s=this._sw,c=this._ne;let p,g;if(i instanceof xi)p=i,g=i;else{if(!(i instanceof ia))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(ia.convert(i)):this.extend(xi.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(xi.convert(i)):this;if(p=i._sw,g=i._ne,!p||!g)return this}return s||c?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new xi(p.lng,p.lat),this._ne=new xi(g.lng,g.lat)),this}getCenter(){return new xi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xi(this.getWest(),this.getNorth())}getSouthEast(){return new xi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:c}=xi.convert(i);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(i){return!i||i instanceof ia?i:new ia(i)}}var Ua=1e-6,Ss=typeof Float32Array<"u"?Float32Array:Array;function fg(){var o=new Ss(9);return Ss!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function jy(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=s[0],V=s[1],j=s[2],q=s[3],J=s[4],se=s[5],ge=s[6],ae=s[7],de=s[8];return o[0]=F*c+V*v+j*S,o[1]=F*p+V*w+j*P,o[2]=F*g+V*T+j*N,o[3]=q*c+J*v+se*S,o[4]=q*p+J*w+se*P,o[5]=q*g+J*T+se*N,o[6]=ge*c+ae*v+de*S,o[7]=ge*p+ae*w+de*P,o[8]=ge*g+ae*T+de*N,o}function ml(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function tf(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=i[4],w=i[5],T=i[6],S=i[7],P=i[8],N=i[9],F=i[10],V=i[11],j=i[12],q=i[13],J=i[14],se=i[15],ge=s*w-c*v,ae=s*T-p*v,de=s*S-g*v,ye=c*T-p*w,_e=c*S-g*w,Ze=p*S-g*T,He=P*q-N*j,st=P*J-F*j,wt=P*se-V*j,Ke=N*J-F*q,ht=N*se-V*q,ct=F*se-V*J,_t=ge*ct-ae*ht+de*Ke+ye*wt-_e*st+Ze*He;return _t?(o[0]=(w*ct-T*ht+S*Ke)*(_t=1/_t),o[1]=(p*ht-c*ct-g*Ke)*_t,o[2]=(q*Ze-J*_e+se*ye)*_t,o[3]=(F*_e-N*Ze-V*ye)*_t,o[4]=(T*wt-v*ct-S*st)*_t,o[5]=(s*ct-p*wt+g*st)*_t,o[6]=(J*de-j*Ze-se*ae)*_t,o[7]=(P*Ze-F*de+V*ae)*_t,o[8]=(v*ht-w*wt+S*He)*_t,o[9]=(c*wt-s*ht-g*He)*_t,o[10]=(j*_e-q*de+se*ge)*_t,o[11]=(N*de-P*_e-V*ge)*_t,o[12]=(w*st-v*Ke-T*He)*_t,o[13]=(s*Ke-c*st+p*He)*_t,o[14]=(q*ae-j*ye-J*ge)*_t,o[15]=(P*ye-N*ae+F*ge)*_t,o):null}function Ec(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=i[9],V=i[10],j=i[11],q=i[12],J=i[13],se=i[14],ge=i[15],ae=s[0],de=s[1],ye=s[2],_e=s[3];return o[0]=ae*c+de*w+ye*N+_e*q,o[1]=ae*p+de*T+ye*F+_e*J,o[2]=ae*g+de*S+ye*V+_e*se,o[3]=ae*v+de*P+ye*j+_e*ge,o[4]=(ae=s[4])*c+(de=s[5])*w+(ye=s[6])*N+(_e=s[7])*q,o[5]=ae*p+de*T+ye*F+_e*J,o[6]=ae*g+de*S+ye*V+_e*se,o[7]=ae*v+de*P+ye*j+_e*ge,o[8]=(ae=s[8])*c+(de=s[9])*w+(ye=s[10])*N+(_e=s[11])*q,o[9]=ae*p+de*T+ye*F+_e*J,o[10]=ae*g+de*S+ye*V+_e*se,o[11]=ae*v+de*P+ye*j+_e*ge,o[12]=(ae=s[12])*c+(de=s[13])*w+(ye=s[14])*N+(_e=s[15])*q,o[13]=ae*p+de*T+ye*F+_e*J,o[14]=ae*g+de*S+ye*V+_e*se,o[15]=ae*v+de*P+ye*j+_e*ge,o}function Yh(o,i,s){var c,p,g,v,w,T,S,P,N,F,V,j,q=s[0],J=s[1],se=s[2];return i===o?(o[12]=i[0]*q+i[4]*J+i[8]*se+i[12],o[13]=i[1]*q+i[5]*J+i[9]*se+i[13],o[14]=i[2]*q+i[6]*J+i[10]*se+i[14],o[15]=i[3]*q+i[7]*J+i[11]*se+i[15]):(p=i[1],g=i[2],v=i[3],w=i[4],T=i[5],S=i[6],P=i[7],N=i[8],F=i[9],V=i[10],j=i[11],o[0]=c=i[0],o[1]=p,o[2]=g,o[3]=v,o[4]=w,o[5]=T,o[6]=S,o[7]=P,o[8]=N,o[9]=F,o[10]=V,o[11]=j,o[12]=c*q+w*J+N*se+i[12],o[13]=p*q+T*J+F*se+i[13],o[14]=g*q+S*J+V*se+i[14],o[15]=v*q+P*J+j*se+i[15]),o}function Cc(o,i,s){var c=s[0],p=s[1],g=s[2];return o[0]=i[0]*c,o[1]=i[1]*c,o[2]=i[2]*c,o[3]=i[3]*c,o[4]=i[4]*p,o[5]=i[5]*p,o[6]=i[6]*p,o[7]=i[7]*p,o[8]=i[8]*g,o[9]=i[9]*g,o[10]=i[10]*g,o[11]=i[11]*g,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o}function pg(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[4],v=i[5],w=i[6],T=i[7],S=i[8],P=i[9],N=i[10],F=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=g*p+S*c,o[5]=v*p+P*c,o[6]=w*p+N*c,o[7]=T*p+F*c,o[8]=S*p-g*c,o[9]=P*p-v*c,o[10]=N*p-w*c,o[11]=F*p-T*c,o}function nf(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[0],v=i[1],w=i[2],T=i[3],S=i[8],P=i[9],N=i[10],F=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*p-S*c,o[1]=v*p-P*c,o[2]=w*p-N*c,o[3]=T*p-F*c,o[8]=g*c+S*p,o[9]=v*c+P*p,o[10]=w*c+N*p,o[11]=T*c+F*p,o}function Tp(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function mg(o,i,s){var c,p,g,v=s[0],w=s[1],T=s[2],S=Math.hypot(v,w,T);return S<Ua?null:(v*=S=1/S,w*=S,T*=S,c=Math.sin(i),p=Math.cos(i),o[0]=v*v*(g=1-p)+p,o[1]=w*v*g+T*c,o[2]=T*v*g-w*c,o[3]=0,o[4]=v*w*g-T*c,o[5]=w*w*g+p,o[6]=T*w*g+v*c,o[7]=0,o[8]=v*T*g+w*c,o[9]=w*T*g-v*c,o[10]=T*T*g+p,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var $y=Ec;function Dp(){var o=new Ss(3);return Ss!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function gg(o){var i=new Ss(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i}function Gu(o){return Math.hypot(o[0],o[1],o[2])}function Kh(o,i,s){var c=new Ss(3);return c[0]=o,c[1]=i,c[2]=s,c}function Tc(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o}function Fo(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o}function ru(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o[2]=i[2]*s[2],o}function mr(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o[2]=Math.min(i[2],s[2]),o}function rf(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o[2]=Math.max(i[2],s[2]),o}function ra(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o}function sf(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o}function Ko(o,i){var s=i[0],c=i[1],p=i[2],g=s*s+c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o}function oa(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}function Mp(o,i,s){var c=i[0],p=i[1],g=i[2],v=s[0],w=s[1],T=s[2];return o[0]=p*T-g*w,o[1]=g*v-c*T,o[2]=c*w-p*v,o}function gr(o,i,s){var c=i[0],p=i[1],g=i[2],v=s[3]*c+s[7]*p+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*p+s[8]*g+s[12])/(v=v||1),o[1]=(s[1]*c+s[5]*p+s[9]*g+s[13])/v,o[2]=(s[2]*c+s[6]*p+s[10]*g+s[14])/v,o}function Dc(o,i,s){var c=s[0],p=s[1],g=s[2],v=i[0],w=i[1],T=i[2],S=p*T-g*w,P=g*v-c*T,N=c*w-p*v,F=p*N-g*P,V=g*S-c*N,j=c*P-p*S,q=2*s[3];return P*=q,N*=q,V*=2,j*=2,o[0]=v+(S*=q)+(F*=2),o[1]=w+P+V,o[2]=T+N+j,o}var af,Is=Fo,Sp=ru,Ip=Gu;function Ap(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o}function _g(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=s*s+c*c+p*p+g*g;return v>0&&(v=1/Math.sqrt(v)),o[0]=s*v,o[1]=c*v,o[2]=p*v,o[3]=g*v,o}function ou(o,i,s){var c=i[0],p=i[1],g=i[2],v=i[3];return o[0]=s[0]*c+s[4]*p+s[8]*g+s[12]*v,o[1]=s[1]*c+s[5]*p+s[9]*g+s[13]*v,o[2]=s[2]*c+s[6]*p+s[10]*g+s[14]*v,o[3]=s[3]*c+s[7]*p+s[11]*g+s[15]*v,o}function Hy(){var o=new Ss(4);return Ss!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function qu(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Jh(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T+v*w,o[1]=p*T+g*w,o[2]=g*T-p*w,o[3]=v*T-c*w,o}function Gy(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T-g*w,o[1]=p*T+v*w,o[2]=g*T+c*w,o[3]=v*T-p*w,o}Dp(),af=new Ss(4),Ss!=Float32Array&&(af[0]=0,af[1]=0,af[2]=0,af[3]=0);var NE=_g;Dp(),Kh(1,0,0),Kh(0,1,0),Hy(),Hy(),fg();const yg=Pe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jx}=yg,qy=Pe([{name:"a_pos_3",components:3,type:"Int16"}]);var lf=Pe([{name:"a_pos",type:"Int16",components:2}]);class Zy{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,c){const p=oa(s,this.dir);if(Math.abs(p)<1e-6)return!1;const g=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/p;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,s,c){if(q=(V=this.pos)[0],J=V[1],se=V[2],ge=(j=i)[0],ae=j[1],de=j[2],Math.abs(q-ge)<=Ua*Math.max(1,Math.abs(q),Math.abs(ge))&&Math.abs(J-ae)<=Ua*Math.max(1,Math.abs(J),Math.abs(ae))&&Math.abs(se-de)<=Ua*Math.max(1,Math.abs(se),Math.abs(de))||0===s)return c[0]=c[1]=c[2]=0,!1;var V,j,q,J,se,ge,ae,de;const[p,g,v]=this.dir,w=this.pos[0]-i[0],T=this.pos[1]-i[1],S=this.pos[2]-i[2],P=p*p+g*g+v*v,N=2*(w*p+T*g+S*v),F=N*N-4*P*(w*w+T*T+S*S-s*s);if(F<0){const V=Math.max(-N/2,0),j=w+p*V,q=T+g*V,J=S+v*V,se=Math.hypot(j,q,J);return c[0]=j*s/se,c[1]=q*s/se,c[2]=J*s/se,!1}{const V=(-N-Math.sqrt(F))/(2*P);if(V<0){const j=Math.hypot(w,T,S);return c[0]=w*s/j,c[1]=T*s/j,c[2]=S*s/j,!1}return c[0]=w+p*V,c[1]=T+g*V,c[2]=S+v*V,!0}}}class Wy{constructor(i,s,c,p,g){this.TL=i,this.TR=s,this.BR=c,this.BL=p,this.horizon=g}static fromInvProjectionMatrix(i,s,c){const p=[-1,1,1],g=[1,1,1],v=[1,-1,1],w=[-1,-1,1],T=gr(p,p,i),S=gr(g,g,i),P=gr(v,v,i),N=gr(w,w,i);return new Wy(T,S,P,N,s/c)}}class cf{constructor(i,s){this.points=i,this.planes=s}static fromInvProjectionMatrix(i,s,c,p){const g=Math.pow(2,c),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const S=ou([],T,i),P=1/S[3]/s*g;return(N=S)[0]=(F=S)[0]*(V=[P,P,p?1/S[3]:P,P])[0],N[1]=F[1]*V[1],N[2]=F[2]*V[2],N[3]=F[3]*V[3],N;var N,F,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const S=Ko([],Mp([],Is([],v[T[0]],v[T[1]]),Is([],v[T[2]],v[T[1]]))),P=-oa(S,v[T[1]]);return S.concat(P)});return new cf(v,w)}}class uo{static fromPoints(i){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of i)mr(s,s,p),rf(c,c,p);return new uo(s,c)}static applyTransform(i,s){const c=i.getCorners();for(let p=0;p<c.length;++p)gr(c[p],c[p],s);return uo.fromPoints(c)}constructor(i,s){this.min=i,this.max=s,this.center=ra([],Tc([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],c=gg(this.min),p=gg(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new uo(c,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){const s=this.getCorners();let c=!0;for(let p=0;p<i.planes.length;p++){const g=i.planes[p];let v=0;for(let w=0;w<s.length;w++)v+=oa(g,s[w])+g[3]>=0;if(0===v)return 0;v!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<i.points.length;w++){const T=i.points[w][p]-this.min[p];g=Math.min(g,T),v=Math.max(v,T)}if(v<0||g>this.max[p]-this.min[p])return 0}return 1}}const vg=5,Qh=6,ja=_n/Math.PI/2,Pp=16383,td=[64,32,16],sa=-ja,$a=ja,Wl=[new uo([sa,sa,sa],[$a,$a,$a]),new uo([sa,sa,sa],[0,0,$a]),new uo([0,sa,sa],[$a,0,$a]),new uo([sa,0,sa],[0,$a,$a]),new uo([0,0,sa],[$a,$a,$a])];function Rp(o){return o*ja/su}function uf(o,i,s,c=!0){const p=ra([],o._camera.position,o.worldSize),g=[i,s,1,1];ou(g,g,o.pixelMatrixInverse),Ap(g,g,1/g[3]);const v=Ko([],Is([],g,p)),w=o.globeMatrix,T=[w[12],w[13],w[14]],S=Is([],T,p),P=Gu(S),N=Ko([],S),F=o.worldSize/(2*Math.PI),V=oa(N,v),j=Math.asin(F/P);if(j<Math.acos(V)){if(!c)return null;const wt=[],Ke=[];ra(wt,v,P/V),Ko(Ke,Is(Ke,wt,S)),Ko(v,Tc(v,S,ra(v,Ke,Math.tan(j)*P)))}const q=[];new Zy(p,v).closestPointOnSphere(T,F,q);const J=Ko([],ya(w,0)),se=Ko([],ya(w,1)),ge=Ko([],ya(w,2)),ae=oa(J,q),de=oa(se,q),ye=oa(ge,q),_e=Tn(Math.asin(-de/F));let Ze=Tn(Math.atan2(ae,ye));Ze=o.center.lng+function(wt,Ke){const ht=(Ke-wt+180)%360-180;return ht<-180?ht+360:ht}(o.center.lng,Ze);const He=Ha(Ze),st=Dn(fs(_e),0,1);return new df(He,st)}class xg{constructor(i,s,c){this.a=Is([],i,c),this.b=Is([],s,c),this.center=c;const p=Ko([],this.a),g=Ko([],this.b);this.angle=Math.acos(oa(p,g))}}function Lp(o,i){if(0===o.angle)return null;let s;return s=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,p,g,v){const w=Math.sin(g);return c*(Math.sin((1-v)*g)/w)+p*(Math.sin(v*g)/w)}(o.a[i],o.b[i],o.angle,Dn(s,0,1))+o.center[i]}function aa(o){if(o.z<=1)return Wl[o.z+2*o.y+o.x];const i=kp(hf(o));return uo.fromPoints(i)}function Mc(o,i,s){return ra(o,o,1-s),sf(o,o,i,s)}function Xy(o,i){const s=ho(i.zoom);if(0===s)return aa(o);const c=hf(o),p=kp(c),g=Ha(c.getWest())*i.worldSize,v=Ha(c.getEast())*i.worldSize,w=fs(c.getNorth())*i.worldSize,T=fs(c.getSouth())*i.worldSize,S=[g,w,0],P=[v,w,0],N=[g,T,0],F=[v,T,0],V=tf([],i.globeMatrix);return gr(S,S,V),gr(P,P,V),gr(N,N,V),gr(F,F,V),p[0]=Mc(p[0],N,s),p[1]=Mc(p[1],F,s),p[2]=Mc(p[2],P,s),p[3]=Mc(p[3],S,s),uo.fromPoints(p)}function bg(o,i,s){for(const c of o)gr(c,c,i),ra(c,c,s)}function hf({x:o,y:i,z:s}){const c=1/(1<<s),p=new xi(ca(o*c),zo((i+1)*c)),g=new xi(ca((o+1)*c),zo(i*c));return new ia(p,g)}function kp(o){const i=kt(o.getNorth()),s=kt(o.getSouth()),c=Math.cos(i),p=Math.cos(s),g=Math.sin(i),v=Math.sin(s),w=o.getWest(),T=o.getEast();return[nd(p,v,w),nd(p,v,T),nd(c,g,T),nd(c,g,w)]}function nd(o,i,s,c=ja){return s=kt(s),[o*Math.sin(s)*c,-i*c,o*Math.cos(s)*c]}function Sc(o,i,s){return nd(Math.cos(kt(o)),Math.sin(kt(o)),i,s)}function gl(o,i,s,c){const p=1<<s.z,g=(o/_n+s.x)/p;return Sc(zo((i/_n+s.y)/p),ca(g),c)}function Op({min:o,max:i}){return Pp/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const wg=new Float64Array(16);function id(o){const i=Op(o),s=Tp(wg,[i,i,i]);return Yh(s,s,((c=[])[0]=-(p=o.min)[0],c[1]=-p[1],c[2]=-p[2],c));var c,p}function Zu(o){const i=(c=o.min,(s=wg)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;const p=1/Op(o);return Cc(i,i,[p,p,p])}function Ky(o,i,s,c,p){const g=function(T){const S=_n/(2*Math.PI);return T/(2*Math.PI)/S}(s),v=[o,i,-s/(2*Math.PI)],w=ml(new Float64Array(16));return Yh(w,w,v),Cc(w,w,[g,g,g]),pg(w,w,kt(-p)),nf(w,w,kt(-c)),w}function ho(o){return En(vg,Qh,o)}function Jy(o,i){const s=Sc(i.lat,i.lng);return v=(p=Fo([],function(j){const q=Sc(j._center.lat,j._center.lng);let J=Mp([],Kh(0,1,0),q);const se=mg([],-j.angle,q);J=gr(J,J,se),mg(se,-j._pitch,J);const ge=Ko([],q);return ra(ge,ge,Rp(j.cameraToCenterDistance/j.pixelsPerMeter)),gr(ge,ge,se),Tc([],q,ge)}(o),s))[0],w=p[1],T=p[2],S=(g=s)[0],P=g[1],N=g[2],V=(F=Math.sqrt(v*v+w*w+T*T)*Math.sqrt(S*S+P*P+N*N))&&oa(p,g)/F,Math.acos(Math.min(Math.max(V,-1),1));var p,g,v,w,T,S,P,N,F,V}function xo(o,i){return Jy(o,i)>Math.PI/2*1.01}const Np=kt(85),$x=Math.cos(Np),Qy=Math.sin(Np),su=6371008.8,Wu=2*Math.PI*su;class la{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new la(rr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,c=this.lat*s,p=i.lat*s,g=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((i.lng-this.lng)*s);return su*Math.acos(Math.min(g,1))}toBounds(i=0){const s=360*i/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new ia(new la(this.lng-c,this.lat-s),new la(this.lng+c,this.lat+s))}toEcef(i){const s=Rp(i);return Sc(this.lat,this.lng,ja+s)}static convert(i){if(i instanceof la)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new la(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new la(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var xi=la;function Fp(o){return Wu*Math.cos(o*Math.PI/180)}function Ha(o){return(180+o)/360}function fs(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Xl(o,i){return o/Fp(i)}function ca(o){return 360*o-180}function zo(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Hx(o,i){return o*Fp(zo(i))}const Bo=85.051129;function Gx(o){return 1/Math.cos(o*Math.PI/180)}class df{constructor(i,s,c=0){this.x=+i,this.y=+s,this.z=+c}static fromLngLat(i,s=0){const c=xi.convert(i);return new df(Ha(c.lng),fs(c.lat),Xl(s,c.lat))}toLngLat(){return new xi(ca(this.x),zo(this.y))}toAltitude(){return Hx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Wu*Gx(zo(this.y))}}function ev(o,i,s,c,p,g,v,w,T){const S=(i+c)/2,P=(s+p)/2,N=new ze(S,P);w(N),function(F,V,j,q,J,se){const ge=j-J,ae=q-se;return Math.abs((q-V)*ge-(j-F)*ae)/Math.hypot(ge,ae)}(N.x,N.y,g.x,g.y,v.x,v.y)>=T?(ev(o,i,s,S,P,g,N,w,T),ev(o,S,P,c,p,N,v,w,T)):o.push(v)}function Xu(o,i,s){let c=o[0],p=c.x,g=c.y;i(c);const v=[c];for(let w=1;w<o.length;w++){const T=o[w],{x:S,y:P}=T;i(T),ev(v,p,g,S,P,c,T,i,s),p=S,g=P,c=T}return v}function Eg(o,i,s,c){if(c(i,s)){const p=i.add(s)._mult(.5);Eg(o,i,p,c),Eg(o,p,s,c)}else o.push(s)}function qx(o,i){let s=o[0];const c=[s];for(let p=1;p<o.length;p++){const g=o[p];Eg(c,s,g,i),s=g}return c}const Qr=Math.pow(2,14)-1,tv=-Qr-1;function ff(o,i){const s=Math.round(o.x*i),c=Math.round(o.y*i);return o.x=Dn(s,tv,Qr),o.y=Dn(c,tv,Qr),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&Ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ic(o,i,s){const c=o.loadGeometry(),p=o.extent,g=_n/p;if(i&&s&&s.projection.isReprojectedInTileSpace){const v=1<<i.z,{scale:w,x:T,y:S,projection:P}=s,N=F=>{const V=ca((i.x+F.x/p)/v),j=zo((i.y+F.y/p)/v),q=P.project(V,j);F.x=(q.x*w-T)*p,F.y=(q.y*w-S)*p};for(let F=0;F<c.length;F++)if(1!==o.type)c[F]=Xu(c[F],N,1);else{const V=[];for(const j of c[F])j.x<0||j.x>=p||j.y<0||j.y>=p||(N(j),V.push(j));c[F]=V}}for(const v of c)for(const w of v)ff(w,g);return c}function Do(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Ic(o):[]}}function Ac(o,i,s,c,p){o.emplaceBack(2*i+(c+1)/2,2*s+(p+1)/2)}function pf(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class rd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Et,this.indexArray=new Kt,this.segments=new ji,this.programConfigurations=new Vr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,p){const g=this.layers[0],v=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:N,sourceLayerIndex:F}of i){const V=this.layers[0]._featureFilter.needGeometry,j=Do(S,V);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),j,c))continue;const q=w?w.evaluate(j,{},c):void 0,J={id:P,properties:S.properties,type:S.type,sourceLayerIndex:F,index:N,geometry:V?j.geometry:Ic(S,c,p),patterns:{},sortKey:q};v.push(J)}w&&v.sort((S,P)=>S.sortKey-P.sortKey);let T=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new Dt,T=p.projection);for(const S of v){const{geometry:P,index:N,sourceLayerIndex:F}=S,V=i[N].feature;this.addFeature(S,P,N,s.availableImages,c,T),s.featureIndex.insert(V,P,N,F,this.index)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Uy.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,ds.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,s,c,p,g,v){for(const w of s)for(const T of w){const S=T.x,P=T.y;if(S<0||S>=_n||P<0||P>=_n)continue;if(v){const V=v.projectTilePoint(S,P,g),j=v.upVector(g,S,P),q=this.globeExtVertexArray;pf(q,V,j),pf(q,V,j),pf(q,V,j),pf(q,V,j)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),F=N.vertexLength;Ac(this.layoutVertexArray,S,P,-1,-1),Ac(this.layoutVertexArray,S,P,1,-1),Ac(this.layoutVertexArray,S,P,1,1),Ac(this.layoutVertexArray,S,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},p,g)}}function od(o,i){for(let s=0;s<o.length;s++)if(au(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(au(o,i[s]))return!0;return!!nv(o,i)}function Zx(o,i,s){return!!au(o,i)||!!mf(i,o,s)}function Wx(o,i){if(1===o.length)return Yx(i,o[0]);for(let s=0;s<i.length;s++){const c=i[s];for(let p=0;p<c.length;p++)if(au(o,c[p]))return!0}for(let s=0;s<o.length;s++)if(Yx(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(nv(o,i[s]))return!0;return!1}function Xx(o,i,s){if(o.length>1){if(nv(o,i))return!0;for(let c=0;c<i.length;c++)if(mf(i[c],o,s))return!0}for(let c=0;c<o.length;c++)if(mf(o[c],i,s))return!0;return!1}function nv(o,i){if(0===o.length||0===i.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],p=o[s+1];for(let g=0;g<i.length-1;g++)if(ua(c,p,i[g],i[g+1]))return!0}return!1}function ua(o,i,s,c){return go(o,s,c)!==go(i,s,c)&&go(o,i,s)!==go(o,i,c)}function mf(o,i,s){const c=s*s;if(1===i.length)return o.distSqr(i[0])<c;for(let p=1;p<i.length;p++)if(Yu(o,i[p-1],i[p])<c)return!0;return!1}function Yu(o,i,s){const c=i.distSqr(s);if(0===c)return o.distSqr(i);const p=((o.x-i.x)*(s.x-i.x)+(o.y-i.y)*(s.y-i.y))/c;return o.distSqr(p<0?i:p>1?s:s.sub(i)._mult(p)._add(i))}function Yx(o,i){let s,c,p,g=!1;for(let v=0;v<o.length;v++){s=o[v];for(let w=0,T=s.length-1;w<s.length;T=w++)c=s[w],p=s[T],c.y>i.y!=p.y>i.y&&i.x<(p.x-c.x)*(i.y-c.y)/(p.y-c.y)+c.x&&(g=!g)}return g}function au(o,i){let s=!1;for(let c=0,p=o.length-1;c<o.length;p=c++){const g=o[c],v=o[p];g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(s=!s)}return s}function iv(o,i,s,c,p){for(const v of o)if(i<=v.x&&s<=v.y&&c>=v.x&&p>=v.y)return!0;const g=[new ze(i,s),new ze(i,p),new ze(c,p),new ze(c,s)];if(o.length>2)for(const v of g)if(au(o,v))return!0;for(let v=0;v<o.length-1;v++)if(Kx(o[v],o[v+1],g))return!0;return!1}function Kx(o,i,s){const c=s[0],p=s[2];if(o.x<c.x&&i.x<c.x||o.x>p.x&&i.x>p.x||o.y<c.y&&i.y<c.y||o.y>p.y&&i.y>p.y)return!1;const g=go(o,i,s[0]);return g!==go(o,i,s[1])||g!==go(o,i,s[2])||g!==go(o,i,s[3])}function sd(o,i,s){const c=i.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(i.id).getMaxValue(o)}function zp(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function rv(o,i,s,c,p){if(!i[0]&&!i[1])return o;const g=ze.convert(i)._mult(p);"viewport"===s&&g._rotate(-c);const v=[];for(let w=0;w<o.length;w++)v.push(o[w].sub(g));return v}function ov(o,i,s,c){const p=ze.convert(o)._mult(c);return"viewport"===i&&p._rotate(-s),p}Qt(rd,"CircleBucket",{omit:["layers"]});const Cg=new ce({"circle-sort-key":new ee(it.layout_circle["circle-sort-key"])});var Bp={paint:new ce({"circle-radius":new ee(it.paint_circle["circle-radius"]),"circle-color":new ee(it.paint_circle["circle-color"]),"circle-blur":new ee(it.paint_circle["circle-blur"]),"circle-opacity":new ee(it.paint_circle["circle-opacity"]),"circle-translate":new G(it.paint_circle["circle-translate"]),"circle-translate-anchor":new G(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new G(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new G(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(it.paint_circle["circle-stroke-opacity"])}),layout:Cg};function sv(o,i,s,c,p,g,v,w,T){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(T*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,P=s.projection.upVectorScale(S,s.center.lat,s.worldSize).metersToTile;for(const N of i)for(const F of N){const V=F.add(w),j=p&&s.elevation?s.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,q=s.projection.projectTilePoint(V.x,V.y,S);if(j>0){const ae=s.projection.upVector(S,V.x,V.y);q.x+=ae[0]*P*j,q.y+=ae[1]*P*j,q.z+=ae[2]*P*j}const J=g?V:Vp(q.x,q.y,q.z,c),se=g?o.tilespaceRays.map(ae=>Jx(ae,j)):o.queryGeometry.screenGeometry,ge=ou([],[q.x,q.y,q.z,1],c);if(!v&&g?T*=ge[3]/s.cameraToCenterDistance:v&&!g&&(T*=s.cameraToCenterDistance/ge[3]),g){const ae=zo((F.y/_n+S.y)/(1<<S.z));T/=s.projection.pixelsPerMeter(ae,1)/Xl(1,ae)}if(Zx(se,J,T))return!0}return!1}function Vp(o,i,s,c){const p=ou([],[o,i,s,1],c);return new ze(p[0]/p[3],p[1]/p[3])}const av=Kh(0,0,0),Up=Kh(0,0,1);function Jx(o,i){const s=Dp();return av[2]=i,o.intersectsPlane(av,Up,s),new ze(s[0],s[1])}class Tg extends rd{}function jp(o,{width:i,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*s*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*s*c);return o.width=i,o.height=s,o.data=p,o}function gf(o,i,s){const{width:c,height:p}=i;c===o.width&&p===o.height||($p(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,p)},s),o.width=c,o.height=p,o.data=i.data)}function $p(o,i,s,c,p,g){if(0===p.width||0===p.height)return i;if(p.width>o.width||p.height>o.height||s.x>o.width-p.width||s.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||c.x>i.width-p.width||c.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,w=i.data;for(let T=0;T<p.height;T++){const S=((s.y+T)*o.width+s.x)*g,P=((c.y+T)*i.width+c.x)*g;for(let N=0;N<p.width*g;N++)w[P+N]=v[S+N]}return i}Qt(Tg,"HeatmapBucket",{omit:["layers"]});class Pc{constructor(i,s){jp(this,i,1,s)}resize(i){gf(this,new Pc(i),1)}clone(){return new Pc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,p,g){$p(i,s,c,p,g,1)}}class As{constructor(i,s){jp(this,i,4,s)}resize(i){gf(this,new As(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new As({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,p,g){$p(i,s,c,p,g,4)}}Qt(Pc,"AlphaImage"),Qt(As,"RGBAImage");var ad={paint:new ce({"heatmap-radius":new ee(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new G(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new le(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new G(it.paint_heatmap["heatmap-opacity"])})};function Ku(o){const i={},s=o.resolution||256,c=o.clips?o.clips.length:1,p=o.image||new As({width:s,height:c}),g=(v,w,T)=>{i[o.evaluationKey]=T;const S=o.expression.evaluate(i);p.data[v+w+0]=Math.floor(255*S.r/S.a),p.data[v+w+1]=Math.floor(255*S.g/S.a),p.data[v+w+2]=Math.floor(255*S.b/S.a),p.data[v+w+3]=Math.floor(255*S.a)};if(o.clips)for(let v=0,w=0;v<c;++v,w+=4*s)for(let T=0,S=0;T<s;T++,S+=4){const P=T/(s-1),{start:N,end:F}=o.clips[v];g(w,S,N*(1-P)+F*P)}else for(let v=0,w=0;v<s;v++,w+=4)g(0,w,v/(s-1));return p}var Qx={paint:new ce({"hillshade-illumination-direction":new G(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new G(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new G(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new G(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new G(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new G(it.paint_hillshade["hillshade-accent-color"])})};const FE=Pe([{name:"a_pos",components:2,type:"Int16"}],4),{members:lv}=FE;var Dg={exports:{}};function Mg(o,i,s){s=s||2;var c,p,g,v,w,T,S,P=i&&i.length,N=P?i[0]*s:o.length,F=cv(o,0,N,s,!0),V=[];if(!F||F.next===F.prev)return V;if(P&&(F=function(q,J,se,ge){var ae,de,ye,_e=[];for(ae=0,de=J.length;ae<de;ae++)(ye=cv(q,J[ae]*ge,ae<de-1?J[ae+1]*ge:q.length,ge,!1))===ye.next&&(ye.steiner=!0),_e.push(tb(ye));for(_e.sort(zE),ae=0;ae<_e.length;ae++)se=dv(_e[ae],se);return se}(o,i,F,s)),o.length>80*s){c=g=o[0],p=v=o[1];for(var j=s;j<N;j+=s)(w=o[j])<c&&(c=w),(T=o[j+1])<p&&(p=T),w>g&&(g=w),T>v&&(v=T);S=0!==(S=Math.max(g-c,v-p))?32767/S:0}return _f(F,V,s,c,p,S,0),V}function cv(o,i,s,c,p){var g,v;if(p===qp(o,i,s,c)>0)for(g=i;g<s;g+=c)v=fv(g,o[g],o[g+1],v);else for(g=s-c;g>=i;g-=c)v=fv(g,o[g],o[g+1],v);return v&&ld(v,v.next)&&(cu(v),v=v.next),v}function Ju(o,i){if(!o)return o;i||(i=o);var s,c=o;do{if(s=!1,c.steiner||!ld(c,c.next)&&0!==$r(c.prev,c,c.next))c=c.next;else{if(cu(c),(c=i=c.prev)===c.next)break;s=!0}}while(s||c!==i);return i}function _f(o,i,s,c,p,g,v){if(o){!v&&g&&function(P,N,F,V){var j=P;do{0===j.z&&(j.z=Sg(j.x,j.y,N,F,V)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function(q){var J,se,ge,ae,de,ye,_e,Ze,He=1;do{for(se=q,q=null,de=null,ye=0;se;){for(ye++,ge=se,_e=0,J=0;J<He&&(_e++,ge=ge.nextZ);J++);for(Ze=He;_e>0||Ze>0&&ge;)0!==_e&&(0===Ze||!ge||se.z<=ge.z)?(ae=se,se=se.nextZ,_e--):(ae=ge,ge=ge.nextZ,Ze--),de?de.nextZ=ae:q=ae,ae.prevZ=de,de=ae;se=ge}de.nextZ=null,He*=2}while(ye>1)}(j)}(o,c,p,g);for(var w,T,S=o;o.prev!==o.next;)if(w=o.prev,T=o.next,g?uv(o,c,p,g):Hp(o))i.push(w.i/s|0),i.push(o.i/s|0),i.push(T.i/s|0),cu(o),o=T.next,S=T.next;else if((o=T)===S){v?1===v?_f(o=eb(Ju(o),i,s),i,s,c,p,g,2):2===v&&hv(o,i,s,c,p,g):_f(Ju(o),i,s,c,p,g,1);break}}}function Hp(o){var i=o.prev,s=o,c=o.next;if($r(i,s,c)>=0)return!1;for(var p=i.x,g=s.x,v=c.x,w=i.y,T=s.y,S=c.y,P=p<g?p<v?p:v:g<v?g:v,N=w<T?w<S?w:S:T<S?T:S,F=p>g?p>v?p:v:g>v?g:v,V=w>T?w>S?w:S:T>S?T:S,j=c.next;j!==i;){if(j.x>=P&&j.x<=F&&j.y>=N&&j.y<=V&&lu(p,w,g,T,v,S,j.x,j.y)&&$r(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function uv(o,i,s,c){var p=o.prev,g=o,v=o.next;if($r(p,g,v)>=0)return!1;for(var w=p.x,T=g.x,S=v.x,P=p.y,N=g.y,F=v.y,V=w<T?w<S?w:S:T<S?T:S,j=P<N?P<F?P:F:N<F?N:F,q=w>T?w>S?w:S:T>S?T:S,J=P>N?P>F?P:F:N>F?N:F,se=Sg(V,j,i,s,c),ge=Sg(q,J,i,s,c),ae=o.prevZ,de=o.nextZ;ae&&ae.z>=se&&de&&de.z<=ge;){if(ae.x>=V&&ae.x<=q&&ae.y>=j&&ae.y<=J&&ae!==p&&ae!==v&&lu(w,P,T,N,S,F,ae.x,ae.y)&&$r(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=V&&de.x<=q&&de.y>=j&&de.y<=J&&de!==p&&de!==v&&lu(w,P,T,N,S,F,de.x,de.y)&&$r(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=se;){if(ae.x>=V&&ae.x<=q&&ae.y>=j&&ae.y<=J&&ae!==p&&ae!==v&&lu(w,P,T,N,S,F,ae.x,ae.y)&&$r(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=ge;){if(de.x>=V&&de.x<=q&&de.y>=j&&de.y<=J&&de!==p&&de!==v&&lu(w,P,T,N,S,F,de.x,de.y)&&$r(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function eb(o,i,s){var c=o;do{var p=c.prev,g=c.next.next;!ld(p,g)&&nb(p,c,c.next,g)&&Gp(p,g)&&Gp(g,p)&&(i.push(p.i/s|0),i.push(c.i/s|0),i.push(g.i/s|0),cu(c),cu(c.next),c=o=g),c=c.next}while(c!==o);return Ju(c)}function hv(o,i,s,c,p,g){var v=o;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&VE(v,w)){var T=ib(v,w);return v=Ju(v,v.next),T=Ju(T,T.next),_f(v,i,s,c,p,g,0),void _f(T,i,s,c,p,g,0)}w=w.next}v=v.next}while(v!==o)}function zE(o,i){return o.x-i.x}function dv(o,i){var s=function(p,g){var v,w=g,T=p.x,S=p.y,P=-1/0;do{if(S<=w.y&&S>=w.next.y&&w.next.y!==w.y){var N=w.x+(S-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(N<=T&&N>P&&(P=N,v=w.x<w.next.x?w:w.next,N===T))return v}w=w.next}while(w!==g);if(!v)return null;var F,V=v,j=v.x,q=v.y,J=1/0;w=v;do{T>=w.x&&w.x>=j&&T!==w.x&&lu(S<q?T:P,S,j,q,S<q?P:T,S,w.x,w.y)&&(F=Math.abs(S-w.y)/(T-w.x),Gp(w,p)&&(F<J||F===J&&(w.x>v.x||w.x===v.x&&BE(v,w)))&&(v=w,J=F)),w=w.next}while(w!==V);return v}(o,i);if(!s)return i;var c=ib(s,o);return Ju(c,c.next),Ju(s,s.next)}function BE(o,i){return $r(o.prev,o,i.prev)<0&&$r(i.next,o,o.next)<0}function Sg(o,i,s,c,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-c)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function tb(o){var i=o,s=o;do{(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next}while(i!==o);return s}function lu(o,i,s,c,p,g,v,w){return(p-v)*(i-w)>=(o-v)*(g-w)&&(o-v)*(c-w)>=(s-v)*(i-w)&&(s-v)*(g-w)>=(p-v)*(c-w)}function VE(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(s,c){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&nb(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(o,i)&&(Gp(o,i)&&Gp(i,o)&&function(s,c){var p=s,g=!1,v=(s.x+c.x)/2,w=(s.y+c.y)/2;do{p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next}while(p!==s);return g}(o,i)&&($r(o.prev,o,i.prev)||$r(o,i.prev,i))||ld(o,i)&&$r(o.prev,o,o.next)>0&&$r(i.prev,i,i.next)>0)}function $r(o,i,s){return(i.y-o.y)*(s.x-i.x)-(i.x-o.x)*(s.y-i.y)}function ld(o,i){return o.x===i.x&&o.y===i.y}function nb(o,i,s,c){var p=Ag($r(o,i,s)),g=Ag($r(o,i,c)),v=Ag($r(s,c,o)),w=Ag($r(s,c,i));return p!==g&&v!==w||!(0!==p||!Ig(o,s,i))||!(0!==g||!Ig(o,c,i))||!(0!==v||!Ig(s,o,c))||!(0!==w||!Ig(s,i,c))}function Ig(o,i,s){return i.x<=Math.max(o.x,s.x)&&i.x>=Math.min(o.x,s.x)&&i.y<=Math.max(o.y,s.y)&&i.y>=Math.min(o.y,s.y)}function Ag(o){return o>0?1:o<0?-1:0}function Gp(o,i){return $r(o.prev,o,o.next)<0?$r(o,i,o.next)>=0&&$r(o,o.prev,i)>=0:$r(o,i,o.prev)<0||$r(o,o.next,i)<0}function ib(o,i){var s=new cd(o.i,o.x,o.y),c=new cd(i.i,i.x,i.y),p=o.next,g=i.prev;return o.next=i,i.prev=o,s.next=p,p.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function fv(o,i,s,c){var p=new cd(o,i,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function cu(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function cd(o,i,s){this.i=o,this.x=i,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qp(o,i,s,c){for(var p=0,g=i,v=s-c;g<s;g+=c)p+=(o[v]-o[g])*(o[g+1]+o[v+1]),v=g;return p}Dg.exports=Mg,Dg.exports.default=Mg,Mg.deviation=function(o,i,s,c){var p=i&&i.length,g=Math.abs(qp(o,0,p?i[0]*s:o.length,s));if(p)for(var v=0,w=i.length;v<w;v++)g-=Math.abs(qp(o,i[v]*s,v<w-1?i[v+1]*s:o.length,s));var T=0;for(v=0;v<c.length;v+=3){var S=c[v]*s,P=c[v+1]*s,N=c[v+2]*s;T+=Math.abs((o[S]-o[N])*(o[P+1]-o[S+1])-(o[S]-o[P])*(o[N+1]-o[S+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},Mg.flatten=function(o){for(var i=o[0][0].length,s={vertices:[],holes:[],dimensions:i},c=0,p=0;p<o.length;p++){for(var g=0;g<o[p].length;g++)for(var v=0;v<i;v++)s.vertices.push(o[p][g][v]);p>0&&s.holes.push(c+=o[p-1].length)}return s};var Zp=he(Dg.exports);function pv(o,i,s,c,p){Qu(o,i,s||0,c||o.length-1,p||mv)}function Qu(o,i,s,c,p){for(;c>s;){if(c-s>600){var g=c-s+1,v=i-s+1,w=Math.log(g),T=.5*Math.exp(2*w/3),S=.5*Math.sqrt(w*T*(g-T)/g)*(v-g/2<0?-1:1);Qu(o,i,Math.max(s,Math.floor(i-v*T/g+S)),Math.min(c,Math.floor(i+(g-v)*T/g+S)),p)}var P=o[i],N=s,F=c;for(ud(o,s,i),p(o[c],P)>0&&ud(o,s,c);N<F;){for(ud(o,N,F),N++,F--;p(o[N],P)<0;)N++;for(;p(o[F],P)>0;)F--}0===p(o[s],P)?ud(o,s,F):ud(o,++F,c),F<=i&&(s=F+1),i<=F&&(c=F-1)}}function ud(o,i,s){var c=o[i];o[i]=o[s],o[s]=c}function mv(o,i){return o<i?-1:o>i?1:0}function hd(o,i){const s=o.length;if(s<=1)return[o];const c=[];let p,g;for(let v=0;v<s;v++){const w=sc(o[v]);0!==w&&(o[v].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(p&&c.push(p),p=[o[v]]):p.push(o[v]))}if(p&&c.push(p),i>1)for(let v=0;v<c.length;v++)c[v].length<=i||(pv(c[v],i,1,c[v].length-1,Wp),c[v]=c[v].slice(0,i));return c}function Wp(o,i){return i.area-o.area}function Yl(o,i,s){const c=s.patternDependencies;let p=!1;for(const g of i){const v=g.paint.get(`${o}-pattern`);v.isConstant()||(p=!0);const w=v.constantOr(null);w&&(p=!0,c[w]=!0)}return p}function Pg(o,i,s,c,p){const g=p.patternDependencies;for(const v of i){const w=v.paint.get(`${o}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:c},s,{},p.availableImages);T=T&&T.name?T.name:T,g[T]=!0,s.patterns[v.id]=T}}return s}class Xp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Et,this.indexArray=new Kt,this.indexArray2=new co,this.programConfigurations=new Vr(i.layers,i.zoom),this.segments=new ji,this.segments2=new ji,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection}populate(i,s,c,p){this.hasPattern=Yl("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:T,index:S,sourceLayerIndex:P}of i){const N=this.layers[0]._featureFilter.needGeometry,F=Do(w,N);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),F,c))continue;const V=g?g.evaluate(F,{},c,s.availableImages):void 0,j={id:T,properties:w.properties,type:w.type,sourceLayerIndex:P,index:S,geometry:N?F.geometry:Ic(w,c,p),patterns:{},sortKey:V};v.push(j)}g&&v.sort((w,T)=>w.sortKey-T.sortKey);for(const w of v){const{geometry:T,index:S,sourceLayerIndex:P}=w;if(this.hasPattern){const N=Pg("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(w,T,S,c,{},s.availableImages);s.featureIndex.insert(i[S].feature,T,S,P,this.index)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}addFeatures(i,s,c,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,lv),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,s,c,p,g,v=[]){for(const w of hd(s,500)){let T=0;for(const j of w)T+=j.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=S.vertexLength,N=[],F=[];for(const j of w){if(0===j.length)continue;j!==w[0]&&F.push(N.length/2);const q=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(J+j.length-1,J),N.push(j[0].x),N.push(j[0].y);for(let se=1;se<j.length;se++)this.layoutVertexArray.emplaceBack(j[se].x,j[se].y),this.indexArray2.emplaceBack(J+se-1,J+se),N.push(j[se].x),N.push(j[se].y);q.vertexLength+=j.length,q.primitiveLength+=j.length}const V=Zp(N,F);for(let j=0;j<V.length;j+=3)this.indexArray.emplaceBack(P+V[j],P+V[j+1],P+V[j+2]);S.vertexLength+=T,S.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}}Qt(Xp,"FillBucket",{omit:["layers","patternFeatures"]});const rb=new ce({"fill-sort-key":new ee(it.layout_fill["fill-sort-key"])});var gv={paint:new ce({"fill-antialias":new G(it.paint_fill["fill-antialias"]),"fill-opacity":new ee(it.paint_fill["fill-opacity"]),"fill-color":new ee(it.paint_fill["fill-color"]),"fill-outline-color":new ee(it.paint_fill["fill-outline-color"]),"fill-translate":new G(it.paint_fill["fill-translate"]),"fill-translate-anchor":new G(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new ee(it.paint_fill["fill-pattern"])}),layout:rb};const Rg=Pe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ob=Pe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),sb=Pe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ab}=Rg;var yf={},lb=ke,_v=bo;function bo(o,i,s,c,p){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=p,o.readFields(Lg,this,i)}function Lg(o,i,s){1==o?i.id=s.readVarint():2==o?function(c,p){for(var g=c.readVarint()+c.pos;c.pos<g;){var v=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[v]=w}}(s,i):3==o?i.type=s.readVarint():4==o&&(i._geometry=s.pos)}function yv(o){for(var i,s,c=0,p=0,g=o.length,v=g-1;p<g;v=p++)c+=((s=o[v]).x-(i=o[p]).x)*(i.y+s.y);return c}bo.types=["Unknown","Point","LineString","Polygon"],bo.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,s=o.readVarint()+o.pos,c=1,p=0,g=0,v=0,w=[];o.pos<s;){if(p<=0){var T=o.readVarint();c=7&T,p=T>>3}if(p--,1===c||2===c)g+=o.readSVarint(),v+=o.readSVarint(),1===c&&(i&&w.push(i),i=[]),i.push(new lb(g,v));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&w.push(i),w},bo.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,s=1,c=0,p=0,g=0,v=1/0,w=-1/0,T=1/0,S=-1/0;o.pos<i;){if(c<=0){var P=o.readVarint();s=7&P,c=P>>3}if(c--,1===s||2===s)(p+=o.readSVarint())<v&&(v=p),p>w&&(w=p),(g+=o.readSVarint())<T&&(T=g),g>S&&(S=g);else if(7!==s)throw new Error("unknown command "+s)}return[v,T,w,S]},bo.prototype.toGeoJSON=function(o,i,s){var c,p,g=this.extent*Math.pow(2,s),v=this.extent*o,w=this.extent*i,T=this.loadGeometry(),S=bo.types[this.type];function P(V){for(var j=0;j<V.length;j++){var q=V[j];V[j]=[360*(q.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(c=0;c<T.length;c++)N[c]=T[c][0];P(T=N);break;case 2:for(c=0;c<T.length;c++)P(T[c]);break;case 3:for(T=function(V){var j=V.length;if(j<=1)return[V];for(var q,J,se=[],ge=0;ge<j;ge++){var ae=yv(V[ge]);0!==ae&&(void 0===J&&(J=ae<0),J===ae<0?(q&&se.push(q),q=[V[ge]]):q.push(V[ge]))}return q&&se.push(q),se}(T),c=0;c<T.length;c++)for(p=0;p<T[c].length;p++)P(T[c][p])}1===T.length?T=T[0]:S="Multi"+S;var F={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(F.id=this.id),F};var kg=_v,Vo=dd;function dd(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(vv,this,i),this.length=this._features.length}function vv(o,i,s){15===o?i.version=s.readVarint():1===o?i.name=s.readString():5===o?i.extent=s.readVarint():2===o?i._features.push(s.pos):3===o?i._keys.push(s.readString()):4===o&&i._values.push(function(c){for(var p=null,g=c.readVarint()+c.pos;c.pos<g;){var v=c.readVarint()>>3;p=1===v?c.readString():2===v?c.readFloat():3===v?c.readDouble():4===v?c.readVarint64():5===v?c.readVarint():6===v?c.readSVarint():7===v?c.readBoolean():null}return p}(s))}dd.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new kg(this._pbf,i,this.extent,this._keys,this._values)};var xv=Vo;function cb(o,i,s){if(3===o){var c=new xv(s,s.readVarint()+s.pos);c.length&&(i[c.name]=c)}}var Yp=yf.VectorTile=function(o,i){this.layers=o.readFields(cb,{},i)},Kp=yf.VectorTileFeature=_v;function vf(o,i,s,c){const p=[],g=0===c?(v,w,T,S,P,N)=>{v.push(new ze(N,T+(N-w)/(S-w)*(P-T)))}:(v,w,T,S,P,N)=>{v.push(new ze(w+(N-T)/(P-T)*(S-w),N))};for(const v of o){const w=[];for(const T of v){if(T.length<=2)continue;const S=[];for(let F=0;F<T.length-1;F++){const V=T[F].x,j=T[F].y,q=T[F+1].x,J=T[F+1].y,se=0===c?V:j,ge=0===c?q:J;se<i?ge>i&&g(S,V,j,q,J,i):se>s?ge<s&&g(S,V,j,q,J,s):S.push(T[F]),ge<i&&se>=i&&g(S,V,j,q,J,i),ge>s&&se<=s&&g(S,V,j,q,J,s)}let P=T[T.length-1];const N=0===c?P.x:P.y;N>=i&&N<=s&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),w.push(S))}w.length&&p.push(w)}return p}yf.VectorTileLayer=Vo;const ub=Kp.types,bv=Math.pow(2,13);function xf(o,i,s,c,p,g,v,w){o.emplaceBack((i<<1)+v,(s<<1)+g,(Math.floor(c*bv)<<1)+p,Math.round(w))}function bf(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Jp{constructor(){this.acc=new ze(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ze(i.x,i.y),this.max=new ze(i.x,i.y))}append(i,s){this.currentPolyCount.edges++,this.acc._add(i);const c=this.min,p=this.max;i.x<c.x?c.x=i.x:i.x>p.x&&(p.x=i.x),i.y<c.y?c.y=i.y:i.y>p.y&&(p.y=i.y),((0===i.x||i.x===_n)&&i.x===s.x)!=((0===i.y||i.y===_n)&&i.y===s.y)&&this.processBorderOverlap(i,s),s.x<0!=i.x<0&&this.addBorderIntersection(0,ci(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>_n!=i.x>_n&&this.addBorderIntersection(1,ci(s.y,i.y,(_n-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,ci(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>_n!=i.y>_n&&this.addBorderIntersection(3,ci(s.x,i.x,(_n-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==i?this.acc.div(i)._round():new ze(0,0)}span(){return new ze(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0)}}class eh{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new ut,this.centroidVertexArray=new Br,this.indexArray=new Kt,this.programConfigurations=new Vr(i.layers,i.zoom),this.segments=new ji,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=i.enableTerrain}populate(i,s,c,p){this.features=[],this.hasPattern=Yl("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const v=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*v/(v*v+1)/_n/(1<<g.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:v,index:w,sourceLayerIndex:T}of i){const S=this.layers[0]._featureFilter.needGeometry,P=Do(g,S);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),P,c))continue;const N={id:v,sourceLayerIndex:T,index:w,geometry:S?P.geometry:Ic(g,c,p),properties:g.properties,type:g.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pg("fill-extrusion",this.layers,N,this.zoom,s)):this.addFeature(N,N.geometry,w,c,{},s.availableImages,p),s.featureIndex.insert(g,N.geometry,w,T,this.index,F)}this.sortBorders()}addFeatures(i,s,c,p,g){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,s,c,p,g)}this.sortBorders()}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ab),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,sb.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,ob.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,c,p,g,v,w){const T=[new ze(0,0),new ze(_n,_n)],S=w.projection,P="globe"===S.name,N=this.enableTerrain&&!P?new Jp:null,F="Polygon"===ub[i.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dt);const V=hd(s,500);for(let se=V.length-1;se>=0;se--){const ge=V[se];(0===ge.length||(j=ge[0]).every(ae=>ae.x<=0)||j.every(ae=>ae.x>=_n)||j.every(ae=>ae.y<=0)||j.every(ae=>ae.y>=_n))&&V.splice(se,1)}var j;let q;if(P)q=th(V,T,p);else{q=[];for(const se of V)q.push({polygon:se,bounds:T})}const J=F?this.edgeRadius:0;for(const{polygon:se,bounds:ge}of q){let ae=0,de=0;for(const _e of se)F&&!_e[0].equals(_e[_e.length-1])&&_e.push(_e[0]),de+=F?_e.length-1:_e.length;const ye=this.segments.prepareSegment((F?5:4)*de,this.layoutVertexArray,this.indexArray);if(F){const _e=[],Ze=[];ae=ye.vertexLength;for(const st of se){let wt,Ke;st.length&&st!==se[0]&&Ze.push(_e.length/2),wt=st[1].sub(st[0])._perp()._unit();for(let ht=1;ht<st.length;ht++){const ct=st[ht],_t=st[ht===st.length-1?1:ht+1];let{x:Pt,y:rt}=ct;if(J){Ke=_t.sub(ct)._perp()._unit();const $t=wt.add(Ke)._unit(),nn=J*Math.min(4,1/(wt.x*$t.x+wt.y*$t.y));Pt+=nn*$t.x,rt+=nn*$t.y,wt=Ke}xf(this.layoutVertexArray,Pt,rt,0,0,1,1,0),ye.vertexLength++,_e.push(ct.x,ct.y),P&&bf(this.layoutVertexExtArray,S.projectTilePoint(Pt,rt,p),S.upVector(p,Pt,rt))}}const He=Zp(_e,Ze);for(let st=0;st<He.length;st+=3)this.indexArray.emplaceBack(ae+He[st],ae+He[st+2],ae+He[st+1]),ye.primitiveLength++}for(const _e of se){N&&_e.length&&N.startRing(_e[0]);let Ze,He,st,wt=_e.length>4&&Og(_e[_e.length-2],_e[0],_e[1]),Ke=J?wf(_e[_e.length-2],_e[0],_e[1],J):0;He=_e[1].sub(_e[0])._perp()._unit();let ht=!0;for(let ct=1,_t=0;ct<_e.length;ct++){let Pt=_e[ct-1],rt=_e[ct];const $t=_e[ct===_e.length-1?1:ct+1];if(N&&F&&N.currentPolyCount.top++,Cv(rt,Pt,ge)){J&&(He=$t.sub(rt)._perp()._unit(),ht=!ht);continue}N&&N.append(rt,Pt);const nn=rt.sub(Pt)._perp(),Ht=nn.x/(Math.abs(nn.x)+Math.abs(nn.y)),Bn=nn.y>0?1:0,Lt=Pt.dist(rt);if(_t+Lt>32768&&(_t=0),J){st=$t.sub(rt)._perp()._unit();let Hn=Ev(Pt,rt,$t,wv(He,st),J);isNaN(Hn)&&(Hn=0);const Cn=rt.sub(Pt)._unit();Pt=Pt.add(Cn.mult(Ke))._round(),rt=rt.add(Cn.mult(-Hn))._round(),Ke=Hn,He=st}const yn=ye.vertexLength,Vn=_e.length>4&&Og(Pt,rt,$t);let bi=Ng(_t,wt,ht);if(xf(this.layoutVertexArray,Pt.x,Pt.y,Ht,Bn,0,0,bi),xf(this.layoutVertexArray,Pt.x,Pt.y,Ht,Bn,0,1,bi),_t+=Lt,bi=Ng(_t,Vn,!ht),wt=Vn,xf(this.layoutVertexArray,rt.x,rt.y,Ht,Bn,0,0,bi),xf(this.layoutVertexArray,rt.x,rt.y,Ht,Bn,0,1,bi),ye.vertexLength+=4,this.indexArray.emplaceBack(yn+0,yn+1,yn+2),this.indexArray.emplaceBack(yn+1,yn+3,yn+2),ye.primitiveLength+=2,J){const Hn=ae+(1===ct?_e.length-2:ct-2),Cn=1===ct?ae:Hn+1;if(this.indexArray.emplaceBack(yn+1,Hn,yn+3),this.indexArray.emplaceBack(Hn,Cn,yn+3),ye.primitiveLength+=2,void 0===Ze&&(Ze=yn),!Cv($t,_e[ct],ge)){const Hi=ct===_e.length-1?Ze:ye.vertexLength;this.indexArray.emplaceBack(yn+2,yn+3,Hi),this.indexArray.emplaceBack(yn+3,Hi+1,Hi),this.indexArray.emplaceBack(yn+3,Cn,Hi+1),ye.primitiveLength+=3}ht=!ht}if(P){const Hn=this.layoutVertexExtArray,Cn=S.projectTilePoint(Pt.x,Pt.y,p),Hi=S.projectTilePoint(rt.x,rt.y,p),Wn=S.upVector(p,Pt.x,Pt.y),Fn=S.upVector(p,rt.x,rt.y);bf(Hn,Cn,Wn),bf(Hn,Cn,Wn),bf(Hn,Hi,Fn),bf(Hn,Hi,Fn)}}F&&(ae+=_e.length-1)}}if(N&&N.polyCount.length>0){if(N.borders){N.vertexArrayOffset=this.centroidVertexArray.length;const se=N.borders,ge=this.featuresOnBorder.push(N)-1;for(let ae=0;ae<4;ae++)se[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(ge)}this.encodeCentroid(N.borders?void 0:N.centroid(),N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((s,c)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,s,c=!0){let p,g;if(i)if(0!==i.y){const w=s.span()._mult(this.tileToMeter);p=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else p=Math.ceil(7*(i.x+450)),g=0;else p=0,g=+c;let v=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const w of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(v++,p,g);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(v++,0,g),this.centroidVertexArray.emplace(v++,p,g)}}}function wv(o,i){const s=o.add(i)._unit();return o.x*s.x+o.y*s.y}function wf(o,i,s,c){const p=i.sub(o)._perp()._unit(),g=s.sub(i)._perp()._unit();return Ev(o,i,s,wv(p,g),c)}function Ev(o,i,s,c,p){const g=Math.sqrt(1-c*c);return Math.min(o.dist(i)/3,i.dist(s)/3,p*g/c)}function Cv(o,i,s){return o.x<s[0].x&&i.x<s[0].x||o.x>s[1].x&&i.x>s[1].x||o.y<s[0].y&&i.y<s[0].y||o.y>s[1].y&&i.y>s[1].y}function Og(o,i,s){if(o.x<0||o.x>=_n||i.x<0||i.x>=_n||s.x<0||s.x>=_n)return!1;const c=s.sub(i),p=c.perp(),g=o.sub(i);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&p.x*g.x+p.y*g.y<0}function Ng(o,i,s){const c=i?2|o:-3&o;return s?1|c:-2&c}function Fg(){const o=Math.PI/32,i=Math.tan(o),s=su;return s*Math.sqrt(1+2*i*i)-s}function th(o,i,s){const c=1<<s.z,p=ca(s.x/c),g=ca((s.x+1)/c),v=zo(s.y/c),w=zo((s.y+1)/c);return function(T,S,P,N,F=0,V){const j=[];if(!T.length||!P||!N)return j;const q=(_e,Ze)=>{for(const He of _e)j.push({polygon:He,bounds:Ze})},J=Math.ceil(Math.log2(P)),se=Math.ceil(Math.log2(N)),ge=J-se,ae=[];for(let _e=0;_e<Math.abs(ge);_e++)ae.push(ge>0?0:1);for(let _e=0;_e<Math.min(J,se);_e++)ae.push(0),ae.push(1);let de=T;if(de=vf(de,S[0].y-F,S[1].y+F,1),de=vf(de,S[0].x-F,S[1].x+F,0),!de.length)return j;const ye=[];for(ae.length?ye.push({polygons:de,bounds:S,depth:0}):q(de,S);ye.length;){const _e=ye.pop(),Ze=_e.depth,He=ae[Ze],st=_e.bounds[0],wt=_e.bounds[1],Ke=0===He?st.x:st.y,ht=0===He?wt.x:wt.y,ct=V?V(He,Ke,ht):.5*(Ke+ht),_t=vf(_e.polygons,Ke-F,ct+F,He),Pt=vf(_e.polygons,ct-F,ht+F,He);if(_t.length){const rt=[st,new ze(0===He?ct:wt.x,1===He?ct:wt.y)];ae.length>Ze+1?ye.push({polygons:_t,bounds:rt,depth:Ze+1}):q(_t,rt)}if(Pt.length){const rt=[new ze(0===He?ct:st.x,1===He?ct:st.y),wt];ae.length>Ze+1?ye.push({polygons:Pt,bounds:rt,depth:Ze+1}):q(Pt,rt)}}return j}(o,i,Math.ceil((g-p)/11.25),Math.ceil((v-w)/11.25),1,(T,S,P)=>{if(0===T)return.5*(S+P);{const N=zo((s.y+S/_n)/c);return(fs(.5*(zo((s.y+P/_n)/c)+N))*c-s.y)*_n}})}Qt(eh,"FillExtrusionBucket",{omit:["layers","features"]}),Qt(Jp,"PartMetadata");const Qp=new ce({"fill-extrusion-edge-radius":new G(it["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Tv={paint:new ce({"fill-extrusion-opacity":new G(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new G(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new G(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ee(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new G(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new G(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new G(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new G(it["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Qp};function em(o,i,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class nh{constructor(i,s,c){this.z=i,this.x=s,this.y=c,this.key=Ef(0,i,i,s,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,s){const c=(v=this.y,w=this.z,T=em(256*(g=this.x),256*(v=Math.pow(2,w)-v-1),w),S=em(256*(g+1),256*(v+1),w),T[0]+","+T[1]+","+S[0]+","+S[1]),p=function(g,v,w){let T,S="";for(let P=g;P>0;P--)T=1<<P-1,S+=(v&T?1:0)+(w&T?2:0);return S}(this.z,this.x,this.y);var g,v,w,T,S;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dv{constructor(i,s){this.wrap=i,this.canonical=s,this.key=Ef(i,s.z,s.z,s.x,s.y)}}class Jo{constructor(i,s,c,p,g){this.overscaledZ=i,this.wrap=s,this.canonical=new nh(c,+p,+g),this.key=0===s&&i===c?this.canonical.key:Ef(s,i,c,p,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new Jo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jo(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return Ef(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return Ef(this.wrap*+s,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new Jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Jo(s,this.wrap,s,c,p),new Jo(s,this.wrap,s,c+1,p),new Jo(s,this.wrap,s,c,p+1),new Jo(s,this.wrap,s,c+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Jo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ef(o,i,s,c,p){const g=1<<Math.min(s,22);let v=g*(p%g)+c%g;return o&&s<22&&(v+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*v+s)+(i-s)}Qt(nh,"CanonicalTileID"),Qt(Jo,"OverscaledTileID",{omit:["projMatrix"]});class fd extends ze{constructor(i,s,c){super(i,s),this.z=c}}function Cf(o,i){return o.x*i.x+o.y*i.y}function Mv(o,i){if(1===o.length){let s=0;const c=i[s++];let p;for(;!p||c.equals(p);)if(p=i[s++],!p)return 1/0;for(;s<i.length;s++){const g=i[s],v=o[0],w=p.sub(c),T=g.sub(c),S=v.sub(c),P=Cf(w,w),N=Cf(w,T),F=Cf(T,T),V=Cf(S,w),j=Cf(S,T),q=P*F-N*N,J=(F*V-N*j)/q,se=(P*j-N*V)/q,ge=c.z*(1-J-se)+p.z*J+g.z*se;if(isFinite(ge))return ge}return 1/0}{let s=1/0;for(const c of i)s=Math.min(s,c.z);return s}}function zg(o,i,s,c,p,g,v,w){const T=v*p.getElevationAt(o,i,!0,!0),S=0!==g[0],P=S?0===g[1]?v*(g[0]/7-450):v*function(N,F,V){const j=Math.floor(F[0]/8),q=Math.floor(F[1]/8),J=10*(F[0]-8*j),se=10*(F[1]-8*q),ge=N.getElevationAt(j,q,!0,!0),ae=N.getMeterToDEM(V),de=Math.floor(.5*(J*ae-1)),ye=Math.floor(.5*(se*ae-1)),_e=N.tileCoordToPixel(j,q),Ze=2*de+1,He=2*ye+1,st=(nn=Ze,Ht=He,[(Pt=N).getElevationAtPixel(rt=_e.x-de,$t=_e.y-ye,!0),Pt.getElevationAtPixel(rt+Ht,$t,!0),Pt.getElevationAtPixel(rt,$t+Ht,!0),Pt.getElevationAtPixel(rt+nn,$t+Ht,!0)]),wt=Math.abs(st[0]-st[1]),Ke=Math.abs(st[2]-st[3]),ht=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),ct=Math.min(.25,.5*ae*(wt+Ke)/Ze),_t=Math.min(.25,.5*ae*ht/He);var Pt,rt,$t,nn,Ht;return ge+Math.max(ct*J,_t*se)}(p,g,w):T;return{base:T+(0===s)?-1:s,top:S?Math.max(P+c,T+s+2):T+c}}const tm=Pe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Bg}=tm,Vg=Pe([{name:"a_packed",components:4,type:"Float32"}]),{members:hb}=Vg,db=Kp.types,Ug=Math.cos(Math.PI/180*37.5);class Tf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new et,this.layoutVertexArray2=new xt,this.indexArray=new Kt,this.programConfigurations=new Vr(i.layers,i.zoom),this.segments=new ji,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,p){this.hasPattern=Yl("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:P,id:N,index:F,sourceLayerIndex:V}of i){const j=this.layers[0]._featureFilter.needGeometry,q=Do(P,j);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),q,c))continue;const J=g?g.evaluate(q,{},c):void 0,se={id:N,properties:P.properties,type:P.type,sourceLayerIndex:V,index:F,geometry:j?q.geometry:Ic(P,c,p),patterns:{},sortKey:J};v.push(se)}g&&v.sort((P,N)=>P.sortKey-N.sortKey);const{lineAtlas:w,featureIndex:T}=s,S=this.addConstantDashes(w);for(const P of v){const{geometry:N,index:F,sourceLayerIndex:V}=P;if(S&&this.addFeatureDashes(P,w),this.hasPattern){const j=Pg("line",this.layers,P,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(P,N,F,c,w.positions,s.availableImages);T.insert(i[F].feature,N,F,V,this.index)}}addConstantDashes(i){let s=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==g.kind)s=!0;else{const v=g.value,w=p.value;if(!w)continue;i.addDash(w,v)}}return s}addFeatureDashes(i,s){const c=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===v.kind)continue;let w,T;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:c},i);T="constant"===v.kind?v.value:v.evaluate({zoom:c},i),s.addDash(w,T),i.patterns[p.id]=s.getKey(w,T)}}update(i,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,p)}addFeatures(i,s,c,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,hb)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Bg),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,c,p,g,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),S=w.get("line-cap").evaluate(i,{}),P=w.get("line-miter-limit"),N=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const F of s)this.addLine(F,i,T,S,P,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,v,p)}addLine(i,s,c,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<i.length-1;se++)this.totalDistance+=i[se].dist(i[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===db[s.type];let T=i.length;for(;T>=2&&i[T-1].equals(i[T-2]);)T--;let S=0;for(;S<T-1&&i[S].equals(i[S+1]);)S++;if(T<(w?3:2))return;"bevel"===c&&(g=1.05);const P=this.overscaling<=16?15*_n/(512*this.overscaling):0,N=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let F,V,j,q,J;this.e1=this.e2=-1,w&&(F=i[T-2],J=i[S].sub(F)._unit()._perp());for(let se=S;se<T;se++){if(j=se===T-1?w?i[S+1]:void 0:i[se+1],j&&i[se].equals(j))continue;J&&(q=J),F&&(V=F),F=i[se],J=j?j.sub(F)._unit()._perp():q,q=q||J;let ge=q.add(J);0===ge.x&&0===ge.y||ge._unit();const ae=q.x*J.x+q.y*J.y,de=ge.x*J.x+ge.y*J.y,ye=0!==de?1/de:1/0,_e=2*Math.sqrt(2-2*de),Ze=de<Ug&&V&&j,He=q.x*J.y-q.y*J.x>0;if(Ze&&se>S){const Ke=F.dist(V);if(Ke>2*P){const ht=F.sub(F.sub(V)._mult(P/Ke)._round());this.updateDistance(V,ht),this.addCurrentVertex(ht,q,0,0,N),V=ht}}const st=V&&j;let wt=st?c:w?"butt":p;if(st&&"round"===wt&&(ye<v?wt="miter":ye<=2&&(wt="fakeround")),"miter"===wt&&ye>g&&(wt="bevel"),"bevel"===wt&&(ye>2&&(wt="flipbevel"),ye<g&&(wt="miter")),V&&this.updateDistance(V,F),"miter"===wt)ge._mult(ye),this.addCurrentVertex(F,ge,0,0,N);else if("flipbevel"===wt){if(ye>100)ge=J.mult(-1);else{const Ke=ye*q.add(J).mag()/q.sub(J).mag();ge._perp()._mult(Ke*(He?-1:1))}this.addCurrentVertex(F,ge,0,0,N),this.addCurrentVertex(F,ge.mult(-1),0,0,N)}else if("bevel"===wt||"fakeround"===wt){const Ke=-Math.sqrt(ye*ye-1),ht=He?Ke:0,ct=He?0:Ke;if(V&&this.addCurrentVertex(F,q,ht,ct,N),"fakeround"===wt){const _t=Math.round(180*_e/Math.PI/20);for(let Pt=1;Pt<_t;Pt++){let rt=Pt/_t;if(.5!==rt){const nn=rt-.5;rt+=rt*nn*(rt-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*nn*nn+(.848013+ae*(.215638*ae-1.06021)))}const $t=J.sub(q)._mult(rt)._add(q)._unit()._mult(He?-1:1);this.addHalfVertex(F,$t.x,$t.y,!1,He,0,N)}}j&&this.addCurrentVertex(F,J,-ht,-ct,N)}else if("butt"===wt)this.addCurrentVertex(F,ge,0,0,N);else if("square"===wt){const Ke=V?1:-1;V||this.addCurrentVertex(F,ge,Ke,Ke,N),this.addCurrentVertex(F,ge,0,0,N),V&&this.addCurrentVertex(F,ge,Ke,Ke,N)}else"round"===wt&&(V&&(this.addCurrentVertex(F,q,0,0,N),this.addCurrentVertex(F,q,1,1,N,!0)),j&&(this.addCurrentVertex(F,J,-1,-1,N,!0),this.addCurrentVertex(F,J,0,0,N)));if(Ze&&se<T-1){const Ke=F.dist(j);if(Ke>2*P){const ht=F.add(j.sub(F)._mult(P/Ke)._round());this.updateDistance(F,ht),this.addCurrentVertex(ht,J,0,0,N),F=ht}}}}addCurrentVertex(i,s,c,p,g,v=!1){const w=s.y*p-s.x,T=-s.y-s.x*p;this.addHalfVertex(i,s.x+s.y*c,s.y-s.x*c,v,!1,c,g),this.addHalfVertex(i,w,T,v,!0,-p,g)}addHalfVertex({x:i,y:s},c,p,g,v,w,T){this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(s<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),T.primitiveLength++),v?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,s){this.distance+=i.dist(s),this.updateScaledDistance()}}Qt(Tf,"LineBucket",{omit:["layers","patternFeatures"]});const ih=new ce({"line-cap":new ee(it.layout_line["line-cap"]),"line-join":new ee(it.layout_line["line-join"]),"line-miter-limit":new G(it.layout_line["line-miter-limit"]),"line-round-limit":new G(it.layout_line["line-round-limit"]),"line-sort-key":new ee(it.layout_line["line-sort-key"])});var jg={paint:new ce({"line-opacity":new ee(it.paint_line["line-opacity"]),"line-color":new ee(it.paint_line["line-color"]),"line-translate":new G(it.paint_line["line-translate"]),"line-translate-anchor":new G(it.paint_line["line-translate-anchor"]),"line-width":new ee(it.paint_line["line-width"]),"line-gap-width":new ee(it.paint_line["line-gap-width"]),"line-offset":new ee(it.paint_line["line-offset"]),"line-blur":new ee(it.paint_line["line-blur"]),"line-dasharray":new ee(it.paint_line["line-dasharray"]),"line-pattern":new ee(it.paint_line["line-pattern"]),"line-gradient":new le(it.paint_line["line-gradient"]),"line-trim-offset":new G(it.paint_line["line-trim-offset"])}),layout:ih};const $g=new class extends ee{possiblyEvaluate(o,i){return i=new R(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,s,c){return i=si({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,s,c)}}(jg.paint.properties["line-width"].specification);function Sv(o,i){return i>0?i+2*o:o}$g.useIntegerZoom=!0;const UE=Pe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nm=Pe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),fb=Pe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Iv=Pe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Av=Pe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hg=Pe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gg=Pe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pe([{name:"triangle",components:3,type:"Uint16"}]),Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pe([{type:"Float32",name:"offsetX"}]),Pe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fo=24;const Ps=128;function rh(o,i){const{expression:s}=i;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new R(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let v=g;for(;v<c.length&&c[v]<o+1;)v++;v=Math.min(c.length-1,v);const w=c[g],T=c[v];return"composite"===s.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:T,minSize:s.evaluate(new R(w)),maxSize:s.evaluate(new R(T)),interpolationType:p}}}function Df(o,{uSize:i,uSizeT:s},{lowerSize:c,upperSize:p}){return"source"===o.kind?c/Ps:"composite"===o.kind?ci(c/Ps,p/Ps,s):i}function uu(o,i){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:p,minZoom:g,maxZoom:v}=o,w=p?Dn(xs.interpolationFactor(p,i,g,v),0,1):0;"camera"===o.kind?c=ci(o.minSize,o.maxSize,w):s=w}return{uSizeT:s,uSize:c}}var im=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ps,evaluateSizeForFeature:Df,evaluateSizeForZoom:uu,getSizeData:rh});function Pv(o,i,s){return o.sections.forEach(c=>{c.text=function(p,g,v){const w=g.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?p=p.toLocaleUpperCase():"lowercase"===w&&(p=p.toLocaleLowerCase()),A.applyArabicShaping&&(p=A.applyArabicShaping(p)),p}(c.text,i,s)}),o}const oh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Mf(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function pb(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var qg=$i,Rv=function(o,i,s,c,p){var g,v,w=8*p-c-1,T=(1<<w)-1,S=T>>1,P=-7,N=s?p-1:0,F=s?-1:1,V=o[i+N];for(N+=F,g=V&(1<<-P)-1,V>>=-P,P+=w;P>0;g=256*g+o[i+N],N+=F,P-=8);for(v=g&(1<<-P)-1,g>>=-P,P+=c;P>0;v=256*v+o[i+N],N+=F,P-=8);if(0===g)g=1-S;else{if(g===T)return v?NaN:1/0*(V?-1:1);v+=Math.pow(2,c),g-=S}return(V?-1:1)*v*Math.pow(2,g-c)},Lv=function(o,i,s,c,p,g){var v,w,T,S=8*g-p-1,P=(1<<S)-1,N=P>>1,F=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,V=c?0:g-1,j=c?1:-1,q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,v=P):(v=Math.floor(Math.log(i)/Math.LN2),i*(T=Math.pow(2,-v))<1&&(v--,T*=2),(i+=v+N>=1?F/T:F*Math.pow(2,1-N))*T>=2&&(v++,T/=2),v+N>=P?(w=0,v=P):v+N>=1?(w=(i*T-1)*Math.pow(2,p),v+=N):(w=i*Math.pow(2,N-1)*Math.pow(2,p),v=0));p>=8;o[s+V]=255&w,V+=j,w/=256,p-=8);for(v=v<<p|w,S+=p;S>0;o[s+V]=255&v,V+=j,v/=256,S-=8);o[s+V-j]|=128*q};function $i(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}$i.Varint=0,$i.Fixed64=1,$i.Bytes=2,$i.Fixed32=5;var rm=4294967296,Zg=1/rm,Sf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _l(o){return o.type===$i.Bytes?o.readVarint()+o.pos:o.pos+1}function kv(o,i,s){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(c);for(var p=s.pos-1;p>=o;p--)s.buf[p+c]=s.buf[p]}function mb(o,i){for(var s=0;s<o.length;s++)i.writeVarint(o[s])}function jE(o,i){for(var s=0;s<o.length;s++)i.writeSVarint(o[s])}function gb(o,i){for(var s=0;s<o.length;s++)i.writeFloat(o[s])}function Wg(o,i){for(var s=0;s<o.length;s++)i.writeDouble(o[s])}function _b(o,i){for(var s=0;s<o.length;s++)i.writeBoolean(o[s])}function pd(o,i){for(var s=0;s<o.length;s++)i.writeFixed32(o[s])}function om(o,i){for(var s=0;s<o.length;s++)i.writeSFixed32(o[s])}function Xg(o,i){for(var s=0;s<o.length;s++)i.writeFixed64(o[s])}function Ov(o,i){for(var s=0;s<o.length;s++)i.writeSFixed64(o[s])}function If(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function sh(o,i,s){o[s]=i,o[s+1]=i>>>8,o[s+2]=i>>>16,o[s+3]=i>>>24}function Yg(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}$i.prototype={destroy:function(){this.buf=null},readFields:function(o,i,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),p=c>>3,g=this.pos;this.type=7&c,o(p,i,this),this.pos===g&&this.skip(c)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=If(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Yg(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=If(this.buf,this.pos)+If(this.buf,this.pos+4)*rm;return this.pos+=8,o},readSFixed64:function(){var o=If(this.buf,this.pos)+Yg(this.buf,this.pos+4)*rm;return this.pos+=8,o},readFloat:function(){var o=Rv(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Rv(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,s,c=this.buf;return i=127&(s=c[this.pos++]),s<128?i:(i|=(127&(s=c[this.pos++]))<<7,s<128?i:(i|=(127&(s=c[this.pos++]))<<14,s<128?i:(i|=(127&(s=c[this.pos++]))<<21,s<128?i:function(p,g,v){var w,T,S=v.buf;if(w=(112&(T=S[v.pos++]))>>4,T<128||(w|=(127&(T=S[v.pos++]))<<3,T<128)||(w|=(127&(T=S[v.pos++]))<<10,T<128)||(w|=(127&(T=S[v.pos++]))<<17,T<128)||(w|=(127&(T=S[v.pos++]))<<24,T<128)||(w|=(1&(T=S[v.pos++]))<<31,T<128))return function yl(o,i,s){return s?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(p,w,g);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Sf?Sf.decode(this.buf.subarray(i,o)):function(s,c,p){for(var g="",v=c;v<p;){var w,T,S,P=s[v],N=null,F=P>239?4:P>223?3:P>191?2:1;if(v+F>p)break;1===F?P<128&&(N=P):2===F?128==(192&(w=s[v+1]))&&(N=(31&P)<<6|63&w)<=127&&(N=null):3===F?(T=s[v+2],128==(192&(w=s[v+1]))&&128==(192&T)&&((N=(15&P)<<12|(63&w)<<6|63&T)<=2047||N>=55296&&N<=57343)&&(N=null)):4===F&&(T=s[v+2],S=s[v+3],128==(192&(w=s[v+1]))&&128==(192&T)&&128==(192&S)&&((N=(15&P)<<18|(63&w)<<12|(63&T)<<6|63&S)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,F=1):N>65535&&(N-=65536,g+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),g+=String.fromCharCode(N),v+=F}return g}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==$i.Bytes)return o.push(this.readVarint(i));var s=_l(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==$i.Bytes)return o.push(this.readSVarint());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==$i.Bytes)return o.push(this.readBoolean());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==$i.Bytes)return o.push(this.readFloat());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==$i.Bytes)return o.push(this.readDouble());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==$i.Bytes)return o.push(this.readFixed32());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==$i.Bytes)return o.push(this.readSFixed32());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==$i.Bytes)return o.push(this.readFixed64());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==$i.Bytes)return o.push(this.readSFixed64());var i=_l(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===$i.Varint)for(;this.buf[this.pos++]>127;);else if(i===$i.Bytes)this.pos=this.readVarint()+this.pos;else if(i===$i.Fixed32)this.pos+=4;else{if(i!==$i.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),sh(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),sh(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),sh(this.buf,-1&o,this.pos),sh(this.buf,Math.floor(o*Zg),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),sh(this.buf,-1&o,this.pos),sh(this.buf,Math.floor(o*Zg),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,s){var c,p,g,w;if(i>=0?(c=i%4294967296|0,p=i/4294967296|0):(p=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,p=p+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),g=c,(w=s).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(c,p,g){for(var v,w,T=0;T<p.length;T++){if((v=p.charCodeAt(T))>55295&&v<57344){if(!w){v>56319||T+1===p.length?(c[g++]=239,c[g++]=191,c[g++]=189):w=v;continue}if(v<56320){c[g++]=239,c[g++]=191,c[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(c[g++]=239,c[g++]=191,c[g++]=189,w=null);v<128?c[g++]=v:(v<2048?c[g++]=v>>6|192:(v<65536?c[g++]=v>>12|224:(c[g++]=v>>18|240,c[g++]=v>>12&63|128),c[g++]=v>>6&63|128),c[g++]=63&v|128)}return g}(this.buf,o,this.pos);var s=this.pos-i;s>=128&&kv(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Lv(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Lv(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var s=0;s<i;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,i){this.pos++;var s=this.pos;o(i,this);var c=this.pos-s;c>=128&&kv(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,i,s){this.writeTag(o,$i.Bytes),this.writeRawMessage(i,s)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,mb,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,jE,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,_b,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,gb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,Wg,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,pd,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,om,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,Xg,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,Ov,i)},writeBytesField:function(o,i){this.writeTag(o,$i.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,$i.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,$i.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,$i.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,$i.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,$i.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,$i.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,$i.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,$i.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,$i.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var sm=he(qg);const Kg=3;function yb(o,i,s){i.glyphs=[],1===o&&s.readMessage(vb,i)}function vb(o,i,s){if(3===o){const{id:c,bitmap:p,width:g,height:v,left:w,top:T,advance:S}=s.readMessage(xb,{});i.glyphs.push({id:c,bitmap:new Pc({width:g+2*Kg,height:v+2*Kg},p),metrics:{width:g,height:v,left:w,top:T,advance:S}})}else 4===o?i.ascender=s.readSVarint():5===o&&(i.descender=s.readSVarint())}function xb(o,i,s){1===o?i.id=s.readVarint():2===o?i.bitmap=s.readBytes():3===o?i.width=s.readVarint():4===o?i.height=s.readVarint():5===o?i.left=s.readSVarint():6===o?i.top=s.readSVarint():7===o&&(i.advance=s.readVarint())}const Rc=Kg;function ah(o){let i=0,s=0;for(const v of o)i+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,w)=>w.h-v.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let p=0,g=0;for(const v of o)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===T.w&&v.h===T.h){const S=c.pop();w<c.length&&(c[w]=S)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(c.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:p,h:g,fill:i/(p*g)||0}}const ps=1;class Nv{constructor(i,{pixelRatio:s,version:c,stretchX:p,stretchY:g,content:v}){this.paddedRect=i,this.pixelRatio=s,this.stretchX=p,this.stretchY=g,this.content=v,this.version=c}get tl(){return[this.paddedRect.x+ps,this.paddedRect.y+ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-ps,this.paddedRect.y+this.paddedRect.h-ps]}get displaySize(){return[(this.paddedRect.w-2*ps)/this.pixelRatio,(this.paddedRect.h-2*ps)/this.pixelRatio]}}class bb{constructor(i,s){const c={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,c,g),this.addImages(s,p,g);const{w:v,h:w}=ah(g),T=new As({width:v||1,height:w||1});for(const S in i){const P=i[S],N=c[S].paddedRect;As.copy(P.data,T,{x:0,y:0},{x:N.x+ps,y:N.y+ps},P.data)}for(const S in s){const P=s[S],N=p[S].paddedRect,F=N.x+ps,V=N.y+ps,j=P.data.width,q=P.data.height;As.copy(P.data,T,{x:0,y:0},{x:F,y:V},P.data),As.copy(P.data,T,{x:0,y:q-1},{x:F,y:V-1},{width:j,height:1}),As.copy(P.data,T,{x:0,y:0},{x:F,y:V+q},{width:j,height:1}),As.copy(P.data,T,{x:j-1,y:0},{x:F-1,y:V},{width:1,height:q}),As.copy(P.data,T,{x:0,y:0},{x:F+j,y:V},{width:1,height:q})}this.image=T,this.iconPositions=c,this.patternPositions=p}addImages(i,s,c){for(const p in i){const g=i[p],v={x:0,y:0,w:g.data.width+2*ps,h:g.data.height+2*ps};c.push(v),s[p]=new Nv(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>i.hasImage(c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),s)}patchUpdatedImage(i,s,c){if(!i||!s||i.version===s.version)return;i.version=s.version;const[p,g]=i.tl;c.update(s.data,void 0,{x:p,y:g})}}Qt(Nv,"ImagePosition"),Qt(bb,"ImageAtlas");const Ga={horizontal:1,vertical:2,horizontalOnly:3},wb=-17;class am{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,s){const c=new am;return c.scale=i||1,c.fontStack=s,c}static forImage(i){const s=new am;return s.imageName=i,s}}class lh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s){const c=new lh;for(let p=0;p<i.sections.length;p++){const g=i.sections[p];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(s,c){let p="";for(let g=0;g<s.length;g++){const v=s.charCodeAt(g+1)||null,w=s.charCodeAt(g-1)||null;p+=!c&&(v&&Kd(v)&&!oh[s[g+1]]||w&&Kd(w)&&!oh[s[g-1]])||!oh[s[g]]?s[g]:oh[s[g]]}return p}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&lm[this.text.charCodeAt(c)];c++)i++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&lm[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const c=new lh;return c.text=this.text.substring(i,s),c.sectionIndex=this.sectionIndex.slice(i,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(am.forText(i.scale,i.fontStack||s));const c=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(c)}addImageSection(i){const s=i.image?i.image.name:"";if(0===s.length)return void Ji("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(am.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jg(o,i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=lh.fromFeature(o,p);N===Ga.vertical&&q.verticalizePunctuation(F);let J=[];const se=function(_e,Ze,He,st,wt,Ke){if(!_e)return[];const ht=[],ct=function($t,nn,Ht,Bn,Lt,yn){let Vn=0;for(let bi=0;bi<$t.length();bi++){const Hn=$t.getSection(bi);Vn+=Fv($t.getCharCode(bi),Hn,Bn,Lt,nn,yn)}return Vn/Math.max(1,Math.ceil(Vn/Ht))}(_e,Ze,He,st,wt,Ke),_t=_e.text.indexOf("\u200b")>=0;let Pt=0;for(let $t=0;$t<_e.length();$t++){const nn=_e.getSection($t),Ht=_e.getCharCode($t);if(lm[Ht]||(Pt+=Fv(Ht,nn,st,wt,Ze,Ke)),$t<_e.length()-1){const Bn=!((rt=Ht)<11904||!(Gt["Bopomofo Extended"](rt)||Gt.Bopomofo(rt)||Gt["CJK Compatibility Forms"](rt)||Gt["CJK Compatibility Ideographs"](rt)||Gt["CJK Compatibility"](rt)||Gt["CJK Radicals Supplement"](rt)||Gt["CJK Strokes"](rt)||Gt["CJK Symbols and Punctuation"](rt)||Gt["CJK Unified Ideographs Extension A"](rt)||Gt["CJK Unified Ideographs"](rt)||Gt["Enclosed CJK Letters and Months"](rt)||Gt["Halfwidth and Fullwidth Forms"](rt)||Gt.Hiragana(rt)||Gt["Ideographic Description Characters"](rt)||Gt["Kangxi Radicals"](rt)||Gt["Katakana Phonetic Extensions"](rt)||Gt.Katakana(rt)||Gt["Vertical Forms"](rt)||Gt["Yi Radicals"](rt)||Gt["Yi Syllables"](rt)));(Eb[Ht]||Bn||nn.imageName)&&ht.push(md($t+1,Pt,ct,ht,Lc(Ht,_e.getCharCode($t+1),Bn&&_t),!1))}}var rt;return Qg(md(_e.length(),Pt,ct,ht,0,!0))}(q,S,g,i,c,V),{processBidirectionalText:ge,processStyledBidirectionalText:ae}=A;if(ge&&1===q.sections.length){const _e=ge(q.toString(),se);for(const Ze of _e){const He=new lh;He.text=Ze,He.sections=q.sections;for(let st=0;st<Ze.length;st++)He.sectionIndex.push(0);J.push(He)}}else if(ae){const _e=ae(q.text,q.sectionIndex,se);for(const Ze of _e){const He=new lh;He.text=Ze[0],He.sectionIndex=Ze[1],He.sections=q.sections,J.push(He)}}else J=function(_e,Ze){const He=[],st=_e.text;let wt=0;for(const Ke of Ze)He.push(_e.substring(wt,Ke)),wt=Ke;return wt<st.length&&He.push(_e.substring(wt,st.length)),He}(q,se);const de=[],ye={positionedLines:de,text:q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,Ze,He,st,wt,Ke,ht,ct,_t,Pt,rt,$t){let nn=0,Ht=0,Bn=0;const Lt="right"===ct?1:"left"===ct?0:.5;let yn=!1;for(const Wn of wt){const Fn=Wn.getSections();for(const Ai of Fn){if(Ai.imageName)continue;const Bi=Ze[Ai.fontStack];if(Bi&&(yn=void 0!==Bi.ascender&&void 0!==Bi.descender,!yn))break}if(!yn)break}let Vn=0;for(const Wn of wt){Wn.trim();const Fn=Wn.getMaxScale(),Ai=(Fn-1)*fo,Bi={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Vn]=Bi;const Gi=Bi.positionedGlyphs;let Pi=0;if(!Wn.length()){Ht+=Ke,++Vn;continue}let dr=0,pn=0;for(let Ri=0;Ri<Wn.length();Ri++){const Qe=Wn.getSection(Ri),Ir=Wn.getSectionIndex(Ri),wr=Wn.getCharCode(Ri);let ui=Qe.scale,fr=null,Li=null,po=null,Ar=fo,eo=0;const Hr=!(_t===Ga.horizontal||!rt&&!yp(wr)||rt&&(lm[wr]||(bi=wr,Gt.Arabic(bi)||Gt["Arabic Supplement"](bi)||Gt["Arabic Extended-A"](bi)||Gt["Arabic Presentation Forms-A"](bi)||Gt["Arabic Presentation Forms-B"](bi))));if(Qe.imageName){const Mo=st[Qe.imageName];if(!Mo)continue;po=Qe.imageName,_e.iconsInText=_e.iconsInText||!0,Li=Mo.paddedRect;const to=Mo.displaySize;ui=ui*fo/$t,fr={width:to[0],height:to[1],left:ps,top:-Rc,advance:Hr?to[1]:to[0],localGlyph:!1},eo=yn?-fr.height*ui:wb+Fn*fo-to[1]*ui,Ar=fr.advance;const da=(Hr?to[0]:to[1])*ui-fo*Fn;da>0&&da>Pi&&(Pi=da)}else{const Mo=He[Qe.fontStack];if(!Mo)continue;Mo[wr]&&(Li=Mo[wr]);const to=Ze[Qe.fontStack];if(!to)continue;const da=to.glyphs[wr];if(!da)continue;if(fr=da.metrics,Ar=8203!==wr?fo:0,yn){const Md=void 0!==to.ascender?Math.abs(to.ascender):0,Zf=void 0!==to.descender?Math.abs(to.descender):0,Wf=(Md+Zf)*ui;dr<Wf&&(dr=Wf,pn=(Md-Zf)/2*ui),eo=-Md*ui}else eo=wb+(Fn-ui)*fo}Hr?(_e.verticalizable=!0,Gi.push({glyph:wr,imageName:po,x:nn,y:Ht+eo,vertical:Hr,scale:ui,localGlyph:fr.localGlyph,fontStack:Qe.fontStack,sectionIndex:Ir,metrics:fr,rect:Li}),nn+=Ar*ui+Pt):(Gi.push({glyph:wr,imageName:po,x:nn,y:Ht+eo,vertical:Hr,scale:ui,localGlyph:fr.localGlyph,fontStack:Qe.fontStack,sectionIndex:Ir,metrics:fr,rect:Li}),nn+=fr.advance*ui+Pt)}0!==Gi.length&&(Bn=Math.max(nn-Pt,Bn),yn?e_(Gi,Lt,Pi,pn,Ke*Fn/2):e_(Gi,Lt,Pi,0,Ke/2)),nn=0;const $e=Ke*Fn+Pi;Bi.lineOffset=Math.max(Pi,Ai),Ht+=$e,++Vn}var bi;const Hn=Ht,{horizontalAlign:Cn,verticalAlign:Hi}=um(ht);(function(Wn,Fn,Ai,Bi,Gi,Pi){const dr=(Fn-Ai)*Gi,pn=-Pi*Bi;for(const $e of Wn)for(const Ri of $e.positionedGlyphs)Ri.x+=dr,Ri.y+=pn})(_e.positionedLines,Lt,Cn,Hi,Bn,Hn),_e.top+=-Hi*Hn,_e.bottom=_e.top+Hn,_e.left+=-Cn*Bn,_e.right=_e.left+Bn,_e.hasBaseline=yn}(ye,i,s,c,J,v,w,T,N,S,F,j),!function(_e){for(const Ze of _e)if(0!==Ze.positionedGlyphs.length)return!1;return!0}(de)&&ye}const lm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Eb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fv(o,i,s,c,p,g){if(i.imageName){const v=c[i.imageName];return v?v.displaySize[0]*i.scale*fo/g+p:0}{const v=s[i.fontStack],w=v&&v.glyphs[o];return w?w.metrics.advance*i.scale+p:0}}function cm(o,i,s,c){const p=Math.pow(o-i,2);return c?o<i?p/2:2*p:p+Math.abs(s)*s}function Lc(o,i,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==i&&65289!==i||(c+=50),c}function md(o,i,s,c,p,g){let v=null,w=cm(i,s,p,g);for(const T of c){const S=cm(i-T.x,s,p,g)+T.badness;S<=w&&(v=T,w=S)}return{index:o,x:i,priorBreak:v,badness:w}}function Qg(o){return o?Qg(o.priorBreak).concat(o.index):[]}function um(o){let i=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function e_(o,i,s,c,p){if(!(i||s||c||p))return;const g=o.length-1,v=o[g],w=(v.x+v.metrics.advance*v.scale)*i;for(let T=0;T<=g;T++)o[T].x-=w,o[T].y+=s+c+p}function $E(o,i,s){const{horizontalAlign:c,verticalAlign:p}=um(s),g=i[0]-o.displaySize[0]*c,v=i[1]-o.displaySize[1]*p;return{image:o,top:v,bottom:v+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function Cb(o,i,s,c,p,g){const v=o.image;let w;if(v.content){const J=v.content,se=v.pixelRatio||1;w=[J[0]/se,J[1]/se,v.displaySize[0]-J[2]/se,v.displaySize[1]-J[3]/se]}const T=i.left*g,S=i.right*g;let P,N,F,V;"width"===s||"both"===s?(V=p[0]+T-c[3],N=p[0]+S+c[1]):(V=p[0]+(T+S-v.displaySize[0])/2,N=V+v.displaySize[0]);const j=i.top*g,q=i.bottom*g;return"height"===s||"both"===s?(P=p[1]+j-c[0],F=p[1]+q+c[2]):(P=p[1]+(j+q-v.displaySize[1])/2,F=P+v.displaySize[1]),{image:v,top:P,right:N,bottom:F,left:V,collisionPadding:w}}class hu extends ze{constructor(i,s,c,p,g){super(i,s),this.angle=p,this.z=c,void 0!==g&&(this.segment=g)}clone(){return new hu(this.x,this.y,this.z,this.angle,this.segment)}}function hm(o,i,s,c,p){if(void 0===i.segment)return!0;let g=i,v=i.segment+1,w=0;for(;w>-s/2;){if(v--,v<0)return!1;w-=o[v].dist(g),g=o[v]}w+=o[v].dist(o[v+1]),v++;const T=[];let S=0;for(;w<s/2;){const P=o[v],N=o[v+1];if(!N)return!1;let F=o[v-1].angleTo(P)-P.angleTo(N);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:F}),S+=F;w-T[0].distance>c;)S-=T.shift().angleDelta;if(S>p)return!1;v++,w+=P.dist(N)}return!0}function dm(o){let i=0;for(let s=0;s<o.length-1;s++)i+=o[s].dist(o[s+1]);return i}function Tb(o,i,s){return o?.6*i*s:0}function Db(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function zv(o,i,s,c,p,g){const v=Tb(s,p,g),w=Db(s,c)*g;let T=0;const S=dm(o)/2;for(let P=0;P<o.length-1;P++){const N=o[P],F=o[P+1],V=N.dist(F);if(T+V>S){const j=(S-T)/V,q=ci(N.x,F.x,j),J=ci(N.y,F.y,j),se=new hu(q,J,0,F.angleTo(N),P);return!v||hm(o,se,w,v,i)?se:void 0}T+=V}}function Mb(o,i,s,c,p,g,v,w,T){const S=Tb(c,g,v),P=Db(c,p),N=P*v,F=0===o[0].x||o[0].x===T||0===o[0].y||o[0].y===T;return i-N<i/4&&(i=N+i/4),Bv(o,F?i/2*w%i:(P/2+2*g)*v*w%i,i,S,s,N,F,!1,T)}function Bv(o,i,s,c,p,g,v,w,T){const S=g/2,P=dm(o);let N=0,F=i-s,V=[];for(let j=0;j<o.length-1;j++){const q=o[j],J=o[j+1],se=q.dist(J),ge=J.angleTo(q);for(;F+s<N+se;){F+=s;const ae=(F-N)/se,de=ci(q.x,J.x,ae),ye=ci(q.y,J.y,ae);if(de>=0&&de<T&&ye>=0&&ye<T&&F-S>=0&&F+S<=P){const _e=new hu(de,ye,0,ge,j);_e._round(),c&&!hm(o,_e,g,c,p)||V.push(_e)}}N+=se}return w||V.length||v||(V=Bv(o,N/2,s,c,p,g,v,!0,T)),V}function Vv(o,i,s,c,p){const g=[];for(let v=0;v<o.length;v++){const w=o[v];let T;for(let S=0;S<w.length-1;S++){let P=w[S],N=w[S+1];P.x<i&&N.x<i||(P.x<i?P=new ze(i,P.y+(i-P.x)/(N.x-P.x)*(N.y-P.y))._round():N.x<i&&(N=new ze(i,P.y+(i-P.x)/(N.x-P.x)*(N.y-P.y))._round()),P.y<s&&N.y<s||(P.y<s?P=new ze(P.x+(s-P.y)/(N.y-P.y)*(N.x-P.x),s)._round():N.y<s&&(N=new ze(P.x+(s-P.y)/(N.y-P.y)*(N.x-P.x),s)._round()),P.x>=c&&N.x>=c||(P.x>=c?P=new ze(c,P.y+(c-P.x)/(N.x-P.x)*(N.y-P.y))._round():N.x>=c&&(N=new ze(c,P.y+(c-P.x)/(N.x-P.x)*(N.y-P.y))._round()),P.y>=p&&N.y>=p||(P.y>=p?P=new ze(P.x+(p-P.y)/(N.y-P.y)*(N.x-P.x),p)._round():N.y>=p&&(N=new ze(P.x+(p-P.y)/(N.y-P.y)*(N.x-P.x),p)._round()),T&&P.equals(T[T.length-1])||(T=[P],g.push(T)),T.push(N)))))}}return g}Qt(hu,"Anchor");const Af=1e20;function t_(o,i,s,c,p,g,v,w,T){for(let S=i;S<i+c;S++)Pf(o,s*g+S,g,p,v,w,T);for(let S=s;S<s+p;S++)Pf(o,S*g+i,1,c,v,w,T)}function Pf(o,i,s,c,p,g,v){g[0]=0,v[0]=-Af,v[1]=Af,p[0]=o[i];for(let w=1,T=0,S=0;w<c;w++){p[w]=o[i+w*s];const P=w*w;do{const N=g[T];S=(p[w]-p[N]+P-N*N)/(w-N)/2}while(S<=v[T]&&--T>-1);T++,g[T]=w,v[T]=S,v[T+1]=Af}for(let w=0,T=0;w<c;w++){for(;v[T+1]<w;)T++;const S=g[T],P=w-S;o[i+w*s]=p[S]+P*P}}const vl=2,Rf={none:0,ideographs:1,all:2};class gd{constructor(i,s,c){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,s){const c=[];for(const p in i)for(const g of i[p])c.push({stack:p,id:g});dn(c,({stack:p,id:g},v)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(void 0!==T)return void v(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(w,p,g),T)return w.glyphs[g]=T,void v(null,{stack:p,id:g,glyph:T});const S=Math.floor(g/256);if(256*S>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[S])return void v(null,{stack:p,id:g,glyph:T});let P=w.requests[S];P||(P=w.requests[S]=[],gd.loadGlyphRange(p,S,this.url,this.requestManager,(N,F)=>{if(F){w.ascender=F.ascender,w.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=F.glyphs[+V]);w.ranges[S]=!0}for(const V of P)V(N,F);delete w.requests[S]})),P.push((N,F)=>{N?v(N):F&&v(null,{stack:p,id:g,glyph:F.glyphs[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const v={};for(const{stack:w,id:T,glyph:S}of g)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[T]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;s(null,v)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Rf.none&&(this.localGlyphMode===Rf.all?!!this.localFontFamily:!!this.localFontFamily&&(Gt["CJK Unified Ideographs"](i)||Gt["Hangul Syllables"](i)||Gt.Hiragana(i)||Gt.Katakana(i)||Gt["CJK Symbols and Punctuation"](i)))}_tinySDF(i,s,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=i.tinySDF;if(!g){let q="400";/bold/i.test(s)?q="900":/medium/i.test(s)?q="500":/light/i.test(s)&&(q="200"),g=i.tinySDF=new gd.TinySDF({fontFamily:p,fontWeight:q,fontSize:24*vl,buffer:3*vl,radius:8*vl}),g.fontWeight=q}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const v=String.fromCharCode(c),{data:w,width:T,height:S,glyphWidth:P,glyphHeight:N,glyphLeft:F,glyphTop:V,glyphAdvance:j}=g.draw(v);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Pc({width:T,height:S},w),metrics:{width:P/vl,height:N/vl,left:F/vl,top:V/vl-27,advance:j/vl,localGlyph:!0}}}}gd.loadGlyphRange=function(o,i,s,c,p){const g=256*i,v=g+255,w=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${v}`),Ja.Glyphs);Qa(w,(T,S)=>{if(T)p(T);else if(S){const P={},N=new sm(S).readFields(yb,{});for(const F of N.glyphs)P[F.id]=F;p(null,{glyphs:P,ascender:N.ascender,descender:N.descender})}})},gd.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=s;const w=this.size=o+4*i,T=this._createCanvas(w),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${v} ${g} ${o}px ${p}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(o),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),T=Math.min(this.size-this.buffer,v+Math.ceil(c)),S=w+2*this.buffer,P=T+2*this.buffer,N=Math.max(S*P,0),F=new Uint8ClampedArray(N),V={data:F,width:S,height:P,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:i};if(0===w||0===T)return V;const{ctx:j,buffer:q,gridInner:J,gridOuter:se}=this;j.clearRect(q,q,w,T),j.fillText(o,q,q+v);const ge=j.getImageData(q,q,w,T);se.fill(Af,0,N),J.fill(0,0,N);for(let ae=0;ae<T;ae++)for(let de=0;de<w;de++){const ye=ge.data[4*(ae*w+de)+3]/255;if(0===ye)continue;const _e=(ae+q)*S+de+q;if(1===ye)se[_e]=0,J[_e]=Af;else{const Ze=.5-ye;se[_e]=Ze>0?Ze*Ze:0,J[_e]=Ze<0?Ze*Ze:0}}t_(se,0,0,S,P,S,this.f,this.v,this.z),t_(J,q,q,w,T,S,this.f,this.v,this.z);for(let ae=0;ae<N;ae++){const de=Math.sqrt(se[ae])-Math.sqrt(J[ae]);F[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return V}};const xl=ps;function Uv(o,i,s,c){const p=[],g=o.image,v=g.pixelRatio,w=g.paddedRect.w-2*xl,T=g.paddedRect.h-2*xl,S=o.right-o.left,P=o.bottom-o.top,N=g.stretchX||[[0,w]],F=g.stretchY||[[0,T]],V=(Ke,ht)=>Ke+ht[1]-ht[0],j=N.reduce(V,0),q=F.reduce(V,0),J=w-j,se=T-q;let ge=0,ae=j,de=0,ye=q,_e=0,Ze=J,He=0,st=se;if(g.content&&c){const Ke=g.content;ge=fm(N,0,Ke[0]),de=fm(F,0,Ke[1]),ae=fm(N,Ke[0],Ke[2]),ye=fm(F,Ke[1],Ke[3]),_e=Ke[0]-ge,He=Ke[1]-de,Ze=Ke[2]-Ke[0]-ae,st=Ke[3]-Ke[1]-ye}const wt=(Ke,ht,ct,_t)=>{const Pt=Lf(Ke.stretch-ge,ae,S,o.left),rt=mm(Ke.fixed-_e,Ze,Ke.stretch,j),$t=Lf(ht.stretch-de,ye,P,o.top),nn=mm(ht.fixed-He,st,ht.stretch,q),Ht=Lf(ct.stretch-ge,ae,S,o.left),Bn=mm(ct.fixed-_e,Ze,ct.stretch,j),Lt=Lf(_t.stretch-de,ye,P,o.top),yn=mm(_t.fixed-He,st,_t.stretch,q),Vn=new ze(Pt,$t),bi=new ze(Ht,$t),Hn=new ze(Ht,Lt),Cn=new ze(Pt,Lt),Hi=new ze(rt/v,nn/v),Wn=new ze(Bn/v,yn/v),Fn=i*Math.PI/180;if(Fn){const Gi=Math.sin(Fn),Pi=Math.cos(Fn),dr=[Pi,-Gi,Gi,Pi];Vn._matMult(dr),bi._matMult(dr),Cn._matMult(dr),Hn._matMult(dr)}const Ai=Ke.stretch+Ke.fixed,Bi=ht.stretch+ht.fixed;return{tl:Vn,tr:bi,bl:Cn,br:Hn,tex:{x:g.paddedRect.x+xl+Ai,y:g.paddedRect.y+xl+Bi,w:ct.stretch+ct.fixed-Ai,h:_t.stretch+_t.fixed-Bi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:Wn,minFontScaleX:Ze/v/S,minFontScaleY:st/v/P,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const Ke=pm(N,J,j),ht=pm(F,se,q);for(let ct=0;ct<Ke.length-1;ct++){const _t=Ke[ct],Pt=Ke[ct+1];for(let rt=0;rt<ht.length-1;rt++)p.push(wt(_t,ht[rt],Pt,ht[rt+1]))}}else p.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return p}function fm(o,i,s){let c=0;for(const p of o)c+=Math.max(i,Math.min(s,p[1]))-Math.max(i,Math.min(s,p[0]));return c}function pm(o,i,s){const c=[{fixed:-xl,stretch:0}];for(const[p,g]of o){const v=c[c.length-1];c.push({fixed:p-v.stretch,stretch:v.stretch}),c.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return c.push({fixed:i+xl,stretch:s}),c}function Lf(o,i,s,c){return o/i*s+c}function mm(o,i,s,c){return o-i*s/c}function Sb(o,i,s,c){const p=i+o.positionedLines[c].lineOffset;return 0===c?s+p/2:s+(p+(i+o.positionedLines[c-1].lineOffset))/2}class Ib{constructor(i=[],s=Ab){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:c}=this,p=s[i];for(;i>0;){const g=i-1>>1,v=s[g];if(c(p,v)>=0)break;s[i]=v,i=g}s[i]=p}_down(i){const{data:s,compare:c}=this,p=this.length>>1,g=s[i];for(;i<p;){let v=1+(i<<1),w=s[v];const T=v+1;if(T<this.length&&c(s[T],w)<0&&(v=T,w=s[T]),c(w,g)>=0)break;s[i]=w,i=v}s[i]=g}}function Ab(o,i){return o<i?-1:o>i?1:0}function jv(o,i=1,s=!1){let c=1/0,p=1/0,g=-1/0,v=-1/0;const w=o[0];for(let V=0;V<w.length;V++){const j=w[V];(!V||j.x<c)&&(c=j.x),(!V||j.y<p)&&(p=j.y),(!V||j.x>g)&&(g=j.x),(!V||j.y>v)&&(v=j.y)}const T=Math.min(g-c,v-p);let S=T/2;const P=new Ib([],HE);if(0===T)return new ze(c,p);for(let V=c;V<g;V+=T)for(let j=p;j<v;j+=T)P.push(new kf(V+S,j+S,S,o));let N=function(V){let j=0,q=0,J=0;const se=V[0];for(let ge=0,ae=se.length,de=ae-1;ge<ae;de=ge++){const ye=se[ge],_e=se[de],Ze=ye.x*_e.y-_e.x*ye.y;q+=(ye.x+_e.x)*Ze,J+=(ye.y+_e.y)*Ze,j+=3*Ze}return new kf(q/j,J/j,0,V)}(o),F=P.length;for(;P.length;){const V=P.pop();(V.d>N.d||!N.d)&&(N=V,s&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-N.d<=i||(S=V.h/2,P.push(new kf(V.p.x-S,V.p.y-S,S,o)),P.push(new kf(V.p.x+S,V.p.y-S,S,o)),P.push(new kf(V.p.x-S,V.p.y+S,S,o)),P.push(new kf(V.p.x+S,V.p.y+S,S,o)),F+=4)}return s&&(console.log(`num probes: ${F}`),console.log(`best distance: ${N.d}`)),N.p}function HE(o,i){return i.max-o.max}class kf{constructor(i,s,c,p){this.p=new ze(i,s),this.h=c,this.d=function(g,v){let w=!1,T=1/0;for(let S=0;S<v.length;S++){const P=v[S];for(let N=0,F=P.length,V=F-1;N<F;V=N++){const j=P[N],q=P[V];j.y>g.y!=q.y>g.y&&g.x<(q.x-j.x)*(g.y-j.y)/(q.y-j.y)+j.x&&(w=!w),T=Math.min(T,Yu(g,j,q))}}return(w?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Kl=7,ch=Number.POSITIVE_INFINITY,$v=Math.sqrt(2);function n_(o,[i,s]){let c=0,p=0;if(s===ch){i<0&&(i=0);const g=i/$v;switch(o){case"top-right":case"top-left":p=g-Kl;break;case"bottom-right":case"bottom-left":p=-g+Kl;break;case"bottom":p=-i+Kl;break;case"top":p=i-Kl}switch(o){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=i;break;case"right":c=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),o){case"top-right":case"top-left":case"top":p=s-Kl;break;case"bottom-right":case"bottom-left":case"bottom":p=-s+Kl}switch(o){case"top-right":case"bottom-right":case"right":c=-i;break;case"top-left":case"bottom-left":case"left":c=i}}return[c,p]}function i_(o,i,s,c,p,g,v,w,T,S){o.createArrays(),o.tilePixelRatio=_n/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const P=o.layers[0].layout,N=o.layers[0]._unevaluatedLayout._values,F={};if("composite"===o.textSizeData.kind){const{minZoom:q,maxZoom:J}=o.textSizeData;F.compositeTextSizes=[N["text-size"].possiblyEvaluate(new R(q),w),N["text-size"].possiblyEvaluate(new R(J),w)]}if("composite"===o.iconSizeData.kind){const{minZoom:q,maxZoom:J}=o.iconSizeData;F.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new R(q),w),N["icon-size"].possiblyEvaluate(new R(J),w)]}F.layoutTextSize=N["text-size"].possiblyEvaluate(new R(T+1),w),F.layoutIconSize=N["icon-size"].possiblyEvaluate(new R(T+1),w),F.textMaxSize=N["text-size"].possiblyEvaluate(new R(18),w);const V="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),j=P.get("text-size");for(const q of o.features){const J=P.get("text-font").evaluate(q,{},w).join(","),se=j.evaluate(q,{},w),ge=F.layoutTextSize.evaluate(q,{},w),ae=(F.layoutIconSize.evaluate(q,{},w),{horizontal:{},vertical:void 0}),de=q.text;let ye,_e=[0,0];if(de){const st=de.toString(),wt=P.get("text-letter-spacing").evaluate(q,{},w)*fo,Ke=P.get("text-line-height").evaluate(q,{},w)*fo,ht=Ly(st)?wt:0,ct=P.get("text-anchor").evaluate(q,{},w),_t=P.get("text-variable-anchor");if(!_t){const Ht=P.get("text-radial-offset").evaluate(q,{},w);_e=Ht?n_(ct,[Ht*fo,ch]):P.get("text-offset").evaluate(q,{},w).map(Bn=>Bn*fo)}let Pt=V?"center":P.get("text-justify").evaluate(q,{},w);const rt="point"===P.get("symbol-placement"),$t=rt?P.get("text-max-width").evaluate(q,{},w)*fo:1/0,nn=Ht=>{o.allowVerticalPlacement&&_p(st)&&(ae.vertical=Jg(de,i,s,p,J,$t,Ke,ct,Ht,ht,_e,Ga.vertical,!0,ge,se))};if(!V&&_t){const Ht="auto"===Pt?_t.map(Lt=>Of(Lt)):[Pt];let Bn=!1;for(let Lt=0;Lt<Ht.length;Lt++){const yn=Ht[Lt];if(!ae.horizontal[yn])if(Bn)ae.horizontal[yn]=ae.horizontal[0];else{const Vn=Jg(de,i,s,p,J,$t,Ke,"center",yn,ht,_e,Ga.horizontal,!1,ge,se);Vn&&(ae.horizontal[yn]=Vn,Bn=1===Vn.positionedLines.length)}}nn("left")}else{if("auto"===Pt&&(Pt=Of(ct)),rt||P.get("text-writing-mode").indexOf("horizontal")>=0||!_p(st)){const Ht=Jg(de,i,s,p,J,$t,Ke,ct,Pt,ht,_e,Ga.horizontal,!1,ge,se);Ht&&(ae.horizontal[Pt]=Ht)}nn(rt?"left":Pt)}}let Ze=!1;if(q.icon&&q.icon.name){const st=c[q.icon.name];st&&(ye=$E(p[q.icon.name],P.get("icon-offset").evaluate(q,{},w),P.get("icon-anchor").evaluate(q,{},w)),Ze=st.sdf,void 0===o.sdfIcons?o.sdfIcons=st.sdf:o.sdfIcons!==st.sdf&&Ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==o.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const He=Rb(ae.horizontal)||ae.vertical;o.iconsInText||(o.iconsInText=!!He&&He.iconsInText),(He||ye)&&Pb(o,q,ae,ye,c,F,ge,0,_e,Ze,v,w,S)}g&&o.generateCollisionDebugBuffers(T,o.collisionBoxArray)}function Of(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pb(o,i,s,c,p,g,v,w,T,S,P,N,F){let V=g.textMaxSize.evaluate(i,{},N);void 0===V&&(V=v);const j=o.layers[0].layout,q=j.get("icon-offset").evaluate(i,{},N),J=Rb(s.horizontal)||s.vertical,se="globe"===F.name,ge=fo,ae=v/ge,de=o.tilePixelRatio*V/ge,ye=(ct=o.overscaling,o.zoom>18&&ct>2&&(ct>>=1),Math.max(_n/(512*ct),1)*j.get("symbol-spacing")),_e=j.get("text-padding")*o.tilePixelRatio,Ze=j.get("icon-padding")*o.tilePixelRatio,He=kt(j.get("text-max-angle")),st="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),wt="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ke=j.get("symbol-placement"),ht=ye/2;var ct;const _t=j.get("icon-text-fit");let Pt;c&&"none"!==_t&&(o.allowVerticalPlacement&&s.vertical&&(Pt=Cb(c,s.vertical,_t,j.get("icon-text-fit-padding"),q,ae)),J&&(c=Cb(c,J,_t,j.get("icon-text-fit-padding"),q,ae)));const rt=($t,nn,Ht)=>{if(nn.x<0||nn.x>=_n||nn.y<0||nn.y>=_n)return;let Bn=null;if(se){const{x:Lt,y:yn,z:Vn}=F.projectTilePoint(nn.x,nn.y,Ht);Bn={anchor:new hu(Lt,yn,Vn,0,void 0),up:F.upVector(Ht,nn.x,nn.y)}}!function(Lt,yn,Vn,bi,Hn,Cn,Hi,Wn,Fn,Ai,Bi,Gi,Pi,dr,pn,$e,Ri,Qe,Ir,wr,ui,fr,Li,po,Ar){const eo=Lt.addToLineVertexArray(yn,bi);let Hr,Mo,to,da,Md,Zf,Wf,D_=0,n0=0,r0=0,o0=0,M_=-1,Dm=-1;const El={};let s0=xp("");const yh=Vn?Vn.anchor:yn;let ms=0,S_=0;if(void 0===Fn._unevaluatedLayout.getValue("text-radial-offset")?[ms,S_]=Fn.layout.get("text-offset").evaluate(ui,{},Ar).map(gs=>gs*fo):(ms=Fn.layout.get("text-radial-offset").evaluate(ui,{},Ar)*fo,S_=ch),Lt.allowVerticalPlacement&&Hn.vertical){const gs=Hn.vertical;if(pn)Zf=r_(gs),Wn&&(Wf=r_(Wn));else{const Ls=Fn.layout.get("text-rotate").evaluate(ui,{},Ar)+90;to=yd(Ai,yh,yn,Bi,Gi,Pi,gs,dr,Ls,$e),Wn&&(da=yd(Ai,yh,yn,Bi,Gi,Pi,Wn,Qe,Ls))}}if(Cn){const gs=Fn.layout.get("icon-rotate").evaluate(ui,{},Ar),Ls="none"!==Fn.layout.get("icon-text-fit"),Xf=Uv(Cn,gs,Li,Ls),A_=Wn?Uv(Wn,gs,Li,Ls):void 0;Mo=yd(Ai,yh,yn,Bi,Gi,Pi,Cn,Qe,gs),D_=4*Xf.length;const P_=Lt.iconSizeData;let vh=null;"source"===P_.kind?(vh=[Ps*Fn.layout.get("icon-size").evaluate(ui,{},Ar)],vh[0]>kc&&Ji(`${Lt.layerIds[0]}: Value for "icon-size" is >= ${_d}. Reduce your "icon-size".`)):"composite"===P_.kind&&(vh=[Ps*fr.compositeIconSizes[0].evaluate(ui,{},Ar),Ps*fr.compositeIconSizes[1].evaluate(ui,{},Ar)],(vh[0]>kc||vh[1]>kc)&&Ji(`${Lt.layerIds[0]}: Value for "icon-size" is >= ${_d}. Reduce your "icon-size".`)),Lt.addSymbols(Lt.icon,Xf,vh,wr,Ir,ui,!1,Vn,yn,eo.lineStartIndex,eo.lineLength,-1,po,Ar),M_=Lt.icon.placedSymbolArray.length-1,A_&&(n0=4*A_.length,Lt.addSymbols(Lt.icon,A_,vh,wr,Ir,ui,Ga.vertical,Vn,yn,eo.lineStartIndex,eo.lineLength,-1,po,Ar),Dm=Lt.icon.placedSymbolArray.length-1)}for(const gs in Hn.horizontal){const Ls=Hn.horizontal[gs];Hr||(s0=xp(Ls.text),pn?Md=r_(Ls):Hr=yd(Ai,yh,yn,Bi,Gi,Pi,Ls,dr,Fn.layout.get("text-rotate").evaluate(ui,{},Ar),$e));const Xf=1===Ls.positionedLines.length;if(r0+=Nf(Lt,Vn,yn,Ls,Hi,Fn,pn,ui,$e,eo,Hn.vertical?Ga.horizontal:Ga.horizontalOnly,Xf?Object.keys(Hn.horizontal):[gs],El,M_,fr,po,Ar),Xf)break}Hn.vertical&&(o0+=Nf(Lt,Vn,yn,Hn.vertical,Hi,Fn,pn,ui,$e,eo,Ga.vertical,["vertical"],El,Dm,fr,po,Ar));let vu=-1;const a0=(gs,Ls)=>gs?Math.max(gs,Ls):Ls;vu=a0(Md,vu),vu=a0(Zf,vu),vu=a0(Wf,vu);const I_=vu>-1?1:0;Lt.glyphOffsetArray.length>=gu.MAX_GLYPHS&&Ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ui.sortKey&&Lt.addToSortKeyRanges(Lt.symbolInstances.length,ui.sortKey),Lt.symbolInstances.emplaceBack(yh.x,yh.y,yh.z,yn.x,yn.y,El.right>=0?El.right:-1,El.center>=0?El.center:-1,El.left>=0?El.left:-1,El.vertical>=0?El.vertical:-1,M_,Dm,s0,void 0!==Hr?Hr:Lt.collisionBoxArray.length,void 0!==Hr?Hr+1:Lt.collisionBoxArray.length,void 0!==to?to:Lt.collisionBoxArray.length,void 0!==to?to+1:Lt.collisionBoxArray.length,void 0!==Mo?Mo:Lt.collisionBoxArray.length,void 0!==Mo?Mo+1:Lt.collisionBoxArray.length,da||Lt.collisionBoxArray.length,da?da+1:Lt.collisionBoxArray.length,Bi,r0,o0,D_,n0,I_,0,ms,S_,vu)}(o,nn,Bn,$t,s,c,p,Pt,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,_e,st,T,0,Ze,wt,q,i,g,S,P,N)};if("line"===Ke)for(const $t of Vv(i.geometry,0,0,_n,_n)){const nn=Mb($t,ye,He,s.vertical||J,c,ge,de,o.overscaling,_n);for(const Ht of nn)J&&o_(o,J.text,ht,Ht)||rt($t,Ht,N)}else if("line-center"===Ke){for(const $t of i.geometry)if($t.length>1){const nn=zv($t,He,s.vertical||J,c,ge,de);nn&&rt($t,nn,N)}}else if("Polygon"===i.type)for(const $t of hd(i.geometry,0)){const nn=jv($t,16);rt($t[0],new hu(nn.x,nn.y,0,0,void 0),N)}else if("LineString"===i.type)for(const $t of i.geometry)rt($t,new hu($t[0].x,$t[0].y,0,0,void 0),N);else if("Point"===i.type)for(const $t of i.geometry)for(const nn of $t)rt([nn],new hu(nn.x,nn.y,0,0,void 0),N)}const _d=255,kc=_d*Ps;function Nf(o,i,s,c,p,g,v,w,T,S,P,N,F,V,j,q,J){const se=function(de,ye,_e,Ze,He,st,wt,Ke){const ht=[];if(0===ye.positionedLines.length)return ht;const ct=Ze.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,_t=function(Ht){const Bn=Ht[0],Lt=Ht[1],yn=Bn*Lt;return yn>0?[Bn,-Lt]:yn<0?[-Bn,Lt]:0===Bn?[Lt,Bn]:[Lt,-Bn]}(_e);let Pt=Math.abs(ye.top-ye.bottom);for(const Ht of ye.positionedLines)Pt-=Ht.lineOffset;const rt=ye.positionedLines.length,$t=Pt/rt;let nn=ye.top-_e[1];for(let Ht=0;Ht<rt;++Ht){const Bn=ye.positionedLines[Ht];nn=Sb(ye,$t,nn,Ht);for(const Lt of Bn.positionedGlyphs){if(!Lt.rect)continue;const yn=Lt.rect||{};let Vn=Rc+1,bi=!0,Hn=1,Cn=0;if(Lt.imageName){const Li=wt[Lt.imageName];if(!Li)continue;if(Li.sdf){Ji("SDF images are not supported in formatted text and will be ignored.");continue}bi=!1,Hn=Li.pixelRatio,Vn=ps/Hn}const Hi=(He||Ke)&&Lt.vertical,Wn=Lt.metrics.advance*Lt.scale/2,Fn=Lt.metrics,Ai=Lt.rect;if(null===Ai)continue;Ke&&ye.verticalizable&&(Cn=Lt.imageName?Wn-Lt.metrics.width*Lt.scale/2:0);const Bi=He?[Lt.x+Wn,Lt.y]:[0,0];let Gi=[0,0],Pi=[0,0],dr=!1;He||(Hi?(Pi=[Lt.x+Wn+_t[0],Lt.y+_t[1]-Cn],dr=!0):Gi=[Lt.x+Wn+_e[0],Lt.y+_e[1]-Cn]);const pn=Ai.w*Lt.scale/(Hn*(Lt.localGlyph?vl:1)),$e=Ai.h*Lt.scale/(Hn*(Lt.localGlyph?vl:1));let Ri,Qe,Ir,wr;if(Hi){const Li=Lt.y-nn,po=new ze(-Wn,Wn-Li),Ar=-Math.PI/2,eo=new ze(...Pi);Ri=new ze(-Wn+Gi[0],Gi[1]),Ri._rotateAround(Ar,po)._add(eo),Ri.x+=-Li+Wn,Ri.y-=(Fn.left-Vn)*Lt.scale;const Hr=Lt.imageName?Fn.advance*Lt.scale:fo*Lt.scale,Mo=String.fromCharCode(Lt.glyph);Mf(Mo)?Ri.x+=(1-Vn)*Lt.scale:pb(Mo)?Ri.x+=Hr-Fn.height*Lt.scale+(-Vn-1)*Lt.scale:Ri.x+=Lt.imageName||Fn.width+2*Vn===Ai.w&&Fn.height+2*Vn===Ai.h?(Hr-$e)/2:(Hr-(Fn.height+2*Vn)*Lt.scale)/2,Qe=new ze(Ri.x,Ri.y-pn),Ir=new ze(Ri.x+$e,Ri.y),wr=new ze(Ri.x+$e,Ri.y-pn)}else{const Li=(Fn.left-Vn)*Lt.scale-Wn+Gi[0],po=(-Fn.top-Vn)*Lt.scale+Gi[1],Ar=Li+pn,eo=po+$e;Ri=new ze(Li,po),Qe=new ze(Ar,po),Ir=new ze(Li,eo),wr=new ze(Ar,eo)}if(ct){let Li;Li=He?new ze(0,0):dr?new ze(_t[0],_t[1]):new ze(_e[0],_e[1]),Ri._rotateAround(ct,Li),Qe._rotateAround(ct,Li),Ir._rotateAround(ct,Li),wr._rotateAround(ct,Li)}const ui=new ze(0,0),fr=new ze(0,0);ht.push({tl:Ri,tr:Qe,bl:Ir,br:wr,tex:yn,writingMode:ye.writingMode,glyphOffset:Bi,sectionIndex:Lt.sectionIndex,isSDF:bi,pixelOffsetTL:ui,pixelOffsetBR:fr,minFontScaleX:0,minFontScaleY:0})}}return ht}(0,c,T,g,v,w,p,o.allowVerticalPlacement),ge=o.textSizeData;let ae=null;"source"===ge.kind?(ae=[Ps*g.layout.get("text-size").evaluate(w,{},J)],ae[0]>kc&&Ji(`${o.layerIds[0]}: Value for "text-size" is >= ${_d}. Reduce your "text-size".`)):"composite"===ge.kind&&(ae=[Ps*j.compositeTextSizes[0].evaluate(w,{},J),Ps*j.compositeTextSizes[1].evaluate(w,{},J)],(ae[0]>kc||ae[1]>kc)&&Ji(`${o.layerIds[0]}: Value for "text-size" is >= ${_d}. Reduce your "text-size".`)),o.addSymbols(o.text,se,ae,T,v,w,P,i,s,S.lineStartIndex,S.lineLength,V,q,J);for(const de of N)F[de]=o.text.placedSymbolArray.length-1;return 4*se.length}function Rb(o){for(const i in o)return o[i];return null}function yd(o,i,s,c,p,g,v,w,T,S){let P=v.top,N=v.bottom,F=v.left,V=v.right;const j=v.collisionPadding;if(j&&(F-=j[0],P-=j[1],V+=j[2],N+=j[3]),T){const q=new ze(F,P),J=new ze(V,P),se=new ze(F,N),ge=new ze(V,N),ae=kt(T);let de=new ze(0,0);S&&(de=new ze(S[0],S[1])),q._rotateAround(ae,de),J._rotateAround(ae,de),se._rotateAround(ae,de),ge._rotateAround(ae,de),F=Math.min(q.x,J.x,se.x,ge.x),V=Math.max(q.x,J.x,se.x,ge.x),P=Math.min(q.y,J.y,se.y,ge.y),N=Math.max(q.y,J.y,se.y,ge.y)}return o.emplaceBack(i.x,i.y,i.z,s.x,s.y,F,P,V,N,w,c,p,g),o.length-1}function r_(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function o_(o,i,s,c){const p=o.compareText;if(i in p){const g=p[i];for(let v=g.length-1;v>=0;v--)if(c.dist(g[v])<s)return!0}else p[i]=[];return p[i].push(c),!1}function s_(o,i){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,p=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),g=Math.sin(s)*p/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),v=Math.sin(o._pitch)*g+p;return Math.min(1.01*v,p*(1/o._horizonShift))}function du(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const s=Math.pow(2,-o.z),c=o.x*s,p=(o.x+1)*s,g=o.y*s,v=(o.y+1)*s,w=ca(c),T=ca(p),S=zo(g),P=zo(v),N=i.project(w,S),F=i.project(T,S),V=i.project(T,P),j=i.project(w,P);let q=Math.min(N.x,F.x,V.x,j.x),J=Math.min(N.y,F.y,V.y,j.y),se=Math.max(N.x,F.x,V.x,j.x),ge=Math.max(N.y,F.y,V.y,j.y);const ae=s/16;function de(_e,Ze,He,st,wt,Ke){const ht=(He+wt)/2,ct=(st+Ke)/2,_t=i.project(ca(ht),zo(ct)),Pt=Math.max(0,q-_t.x,J-_t.y,_t.x-se,_t.y-ge);q=Math.min(q,_t.x),se=Math.max(se,_t.x),J=Math.min(J,_t.y),ge=Math.max(ge,_t.y),Pt>ae&&(de(_e,_t,He,st,ht,ct),de(_t,Ze,ht,ct,wt,Ke))}de(N,F,c,g,p,g),de(F,V,p,g,p,v),de(V,j,p,v,c,v),de(j,N,c,v,c,g),q-=ae,J-=ae,se+=ae,ge+=ae;const ye=1/Math.max(se-q,ge-J);return{scale:ye,x:q*ye,y:J*ye,x2:se*ye,y2:ge*ye,projection:i}}const uh=ml(new Float32Array(16));class fu{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new xi(0,0)}projectTilePoint(i,s,c){return{x:i,y:s,z:0}}locationPoint(i,s,c=!0){return i._coordinatePoint(i.locationCoordinate(s),c)}pixelsPerMeter(i,s){return Xl(1,i)*s}pixelSpaceConversion(i,s,c){return 1}farthestPixelDistance(i){return s_(i,i.pixelsPerMeter)}pointCoordinate(i,s,c,p){const g=i.horizonLineFromTop(!1),v=new ze(s,Math.max(g,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(v,p))}pointCoordinate3D(i,s,c){const p=new ze(s,c);if(i.elevation)return i.elevation.pointCoordinate(p);{const g=this.pointCoordinate(i,p.x,p.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,s){if(i.elevation)return!this.pointCoordinate3D(i,s.x,s.y);const c=i.horizonLineFromTop();return s.y<c}createInversionMatrix(i,s){return uh}createTileMatrix(i,s,c){let p,g,v;const w=c.canonical,T=ml(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=du(w,this);p=1,g=S.x+c.wrap*S.scale,v=S.y,Cc(T,T,[p/S.scale,p/S.scale,i.pixelsPerMeter/s])}else p=s/i.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*c.wrap)*p,v=w.y*p;return Yh(T,T,[g,v,0]),Cc(T,T,[p/_n,p/_n,1]),T}upVector(i,s,c){return[0,0,1]}upVectorScale(i,s,c){return{metersToTile:1}}}class a_ extends fu{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,c]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(kt(s));this.n=(p+Math.sin(kt(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:c,c:p,r0:g}=this,v=kt(i-this.center[0]),w=kt(s),T=Math.sqrt(p-2*c*Math.sin(w))/c;return{x:T*Math.sin(v*c),y:T*Math.cos(v*c)-g,z:0}}unproject(i,s){const{n:c,c:p,r0:g}=this,v=g+s;let w=Math.atan2(i,Math.abs(v))*Math.sign(v);v*c<0&&(w-=Math.PI*Math.sign(i)*Math.sign(v));const T=kt(this.center[0])*c;w=rr(w,-Math.PI-T,Math.PI-T);const S=Dn(Tn(w/c)+this.center[0],-180,180),P=Math.asin(Dn((p-(i*i+v*v)*c*c)/(2*c),-1,1)),N=Dn(Tn(P),-Bo,Bo);return new xi(S,N)}}const pu=1.340264,Ff=-.081106,hh=893e-6,mu=.003796,Qo=Math.sqrt(3)/2;class vd extends fu{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(Qo*Math.sin(s)),p=c*c,g=p*p*p;return{x:.5*(i*Math.cos(c)/(Qo*(pu+3*Ff*p+g*(7*hh+9*mu*p)))/Math.PI+.5),y:1-.5*(c*(pu+Ff*p+g*(hh+mu*p))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=c*c,g=p*p*p;for(let P,N,F,V=0;V<12&&(N=c*(pu+Ff*p+g*(hh+mu*p))-s,F=pu+3*Ff*p+g*(7*hh+9*mu*p),P=N/F,c=Dn(c-P,-Math.PI/3,Math.PI/3),p=c*c,g=p*p*p,!(Math.abs(P)<1e-12));++V);const v=Qo*i*(pu+3*Ff*p+g*(7*hh+9*mu*p))/Math.cos(c),w=Math.asin(Math.sin(c)/Qo),T=Dn(180*v/Math.PI,-180,180),S=Dn(180*w/Math.PI,-Bo,Bo);return new xi(T,S)}}class l_ extends fu{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const c=360*(i-.5),p=Dn(360*(.5-s),-Bo,Bo);return new xi(c,p)}}const xd=Math.PI/2;function gm(o){return Math.tan((xd+o)/2)}class Hv extends fu{constructor(i){super(i),this.center=i.center||[0,30];const[s,c]=this.parallels=i.parallels||[30,30];let p=kt(s),g=kt(c);this.southernCenter=p+g<0,this.southernCenter&&(p=-p,g=-g);const v=Math.cos(p),w=gm(p);this.n=p===g?Math.sin(p):Math.log(v/Math.cos(g))/Math.log(gm(g)/w),this.f=v*Math.pow(gm(p),this.n)/this.n}project(i,s){s=kt(s),this.southernCenter&&(s=-s),i=kt(i-this.center[0]);const c=1e-6,{n:p,f:g}=this;g>0?s<-xd+c&&(s=-xd+c):s>xd-c&&(s=xd-c);const v=g/Math.pow(gm(s),p);let w=v*Math.sin(p*i),T=g-v*Math.cos(p*i);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:p}=this,g=p-s,v=Math.sign(g),w=Math.sign(c)*Math.sqrt(i*i+g*g);let T=Math.atan2(i,Math.abs(g))*v;g*c<0&&(T-=Math.PI*Math.sign(i)*v);const S=Dn(Tn(T/c)+this.center[0],-180,180),P=Dn(Tn(2*Math.atan(Math.pow(p/w,1/c))-xd),-Bo,Bo);return new xi(S,this.southernCenter?-P:P)}}class dh extends fu{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:Ha(i),y:fs(s),z:0}}unproject(i,s){const c=ca(i),p=zo(s);return new xi(c,p)}}const Gv=kt(Bo);class Lb extends fu{project(i,s){const c=(s=kt(s))*s,p=c*c;return{x:.5*((i=kt(i))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=25,g=0,v=c*c;do{v=c*c;const S=v*v;g=(c*(1.007226+v*(.015085+S*(.028874*v-.044475-.005916*S)))-s)/(1.007226+v*(.045255+S*(.259866*v-.311325-.005916*11*S))),c=Dn(c-g,-Gv,Gv)}while(Math.abs(g)>1e-6&&--p>0);v=c*c;const w=Dn(Tn(i/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),T=Tn(c);return new xi(w,T)}}const qv=kt(Bo);class c_ extends fu{project(i,s){s=kt(s),i=kt(i);const c=Math.cos(s),p=2/Math.PI,g=Math.acos(c*Math.cos(i/2)),v=Math.sin(g)/g,w=.5*(i*p+2*c*Math.sin(i/2)/v)||0,T=.5*(s+Math.sin(s)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,s){let c=i=(2*i-.5)*Math.PI,p=s=(2*(1-s)-1)*Math.PI,g=25;const v=1e-6;let w=0,T=0;do{const S=Math.cos(p),P=Math.sin(p),N=2*P*S,F=P*P,V=S*S,j=Math.cos(c/2),q=Math.sin(c/2),J=2*j*q,se=q*q,ge=1-V*j*j,ae=ge?1/ge:0,de=ge?Math.acos(S*j)*Math.sqrt(1/ge):0,ye=.5*(2*de*S*q+2*c/Math.PI)-i,_e=.5*(de*P+p)-s,Ze=.5*ae*(V*se+de*S*j*F)+1/Math.PI,He=ae*(J*N/4-de*P*q),st=.125*ae*(N*q-de*P*V*J),wt=.5*ae*(F*j+de*se*S)+.5,Ke=He*st-wt*Ze;w=(_e*He-ye*wt)/Ke,T=(ye*st-_e*Ze)/Ke,c=Dn(c-w,-Math.PI,Math.PI),p=Dn(p-T,-qv,qv)}while((Math.abs(w)>v||Math.abs(T)>v)&&--g>0);return new xi(Tn(c),Tn(p))}}class zf extends fu{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(kt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:c,cosPhi:p}=this;return{x:kt(i)*p*c+.5,y:-Math.sin(kt(s))/p*c+.5,z:0}}unproject(i,s){const{scale:c,cosPhi:p}=this,g=-(s-.5)/c,v=Dn(Tn((i-.5)/c)/p,-180,180),w=Math.asin(Dn(g*p,-1,1)),T=Dn(Tn(w),-Bo,Bo);return new xi(v,T)}}class kb extends dh{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,c){const p=gl(i,s,c);return gr(p,p,id(aa(c))),{x:p[0],y:p[1],z:p[2]}}locationPoint(i,s){const c=Sc(s.lat,s.lng),p=Ko([],c),g=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude;sf(c,c,p,Xl(1,0)*_n*g);const v=ml(new Float64Array(16));return Ec(v,i.pixelMatrix,i.globeMatrix),gr(c,c,v),new ze(c[0],c[1])}pixelsPerMeter(i,s){return Xl(1,0)*s}pixelSpaceConversion(i,s,c){const p=Xl(1,i)*s,g=ci(Xl(1,45)*s,p,c);return this.pixelsPerMeter(i,s)/g}createTileMatrix(i,s,c){const p=Zu(aa(c.canonical));return Ec(new Float64Array(16),i.globeMatrix,p)}createInversionMatrix(i,s){const{center:c}=i,p=id(aa(s));return nf(p,p,kt(c.lng)),pg(p,p,kt(c.lat)),Cc(p,p,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(i,s,c,p){return uf(i,s,c,!0)||new df(0,0)}pointCoordinate3D(i,s,c){const p=this.pointCoordinate(i,s,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(i,s){return!uf(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(p,g){const v=p.cameraToCenterDistance,w=p._centerAltitude*g,T=p._camera,S=p._camera.forward(),P=Tc([],ra([],S,-v),[0,0,w]),N=p.worldSize/(2*Math.PI),F=[0,0,-N],V=p.width/p.height,j=Math.tan(p.fovAboveCenter),q=ra([],T.up(),j),J=ra([],T.right(),j*V),se=Ko([],Tc([],Tc([],S,q),J)),ge=[];let ae;if(new Zy(P,se).closestPointOnSphere(F,N,ge)){const de=Tc([],ge,F),ye=Is([],de,P);ae=Math.cos(p.fovAboveCenter)*Gu(ye)}else{const de=Is([],P,F),ye=Is([],F,P);Ko(ye,ye);const _e=Gu(de)-N;ae=Math.sqrt(_e*(_e+2*N));const Ze=Math.acos(ae/(N+_e))-Math.acos(oa(S,ye));ae*=Math.cos(Ze)}return 1.01*ae}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=ho(i.zoom);if(c>0){const p=s_(i,Xl(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),v=Math.max(i.width,i.height)/i.worldSize*Math.PI;return ci(s,p+g*(1-Math.cos(v)),Math.pow(c,10))}return s}upVector(i,s,c){return gl(s,c,i,1)}upVectorScale(i){return{metersToTile:Rp(Op(aa(i)))}}}function u_(o){const i=o.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new dh(o);case"equirectangular":return new l_(o);case"naturalEarth":return new Lb(o);case"equalEarth":return new vd(o);case"winkelTripel":return new c_(o);case"albers":return s?new zf(o):new a_(o);case"lambertConformalConic":return s?new zf(o):new Hv(o);case"globe":return new kb(o)}throw new Error(`Invalid projection name: ${o.name}`)}const fh=Kp.types,GE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function h_(o,i,s,c,p,g,v,w,T,S,P,N,F){const V=w?Math.min(kc,Math.round(w[0])):0,j=w?Math.min(kc,Math.round(w[1])):0;o.emplaceBack(i,s,Math.round(32*c),Math.round(32*p),g,v,(V<<1)+(T?1:0),j,16*S,16*P,256*N,256*F)}function Bf(o,i,s,c,p,g,v){o.emplaceBack(i,s,c,p,g,v)}function _m(o,i,s,c,p){o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p),o.emplaceBack(i,s,c,p)}function qE(o){for(const i of o.sections)if(Oy(i.text))return!0;return!1}class Zv{constructor(i){this.layoutVertexArray=new pt,this.indexArray=new Kt,this.programConfigurations=i,this.segments=new ji,this.dynamicLayoutVertexArray=new xt,this.opacityVertexArray=new un,this.placedSymbolArray=new Xn,this.globeExtVertexArray=new It}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,s,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,UE.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,fb.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,GE,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,nm.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Qt(Zv,"SymbolBuffers");class bd{constructor(i,s,c){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ji,this.collisionVertexArray=new ei,this.collisionVertexArrayExt=new Jn}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Iv.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Av.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Qt(bd,"CollisionBuffers");class gu{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(v=>v.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ml([]),this.placementViewportMatrix=ml([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rh(this.zoom,s["text-size"]),this.iconSizeData=rh(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(v=>Ga[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Zv(new Vr(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Zv(new Vr(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new tr,this.lineVertexArray=new Gh,this.symbolInstances=new zi}calculateGlyphDependencies(i,s,c,p,g){for(let v=0;v<i.length;v++)if(s[i.charCodeAt(v)]=!0,p&&g){const w=oh[i.charAt(v)];w&&(s[w.charCodeAt(0)]=!0)}}populate(i,s,c,p){const g=this.layers[0],v=g.layout,w="globe"===this.projection.name,T=v.get("text-font"),S=v.get("text-field"),P=v.get("icon-image"),N=("constant"!==S.value.kind||S.value.value instanceof ai&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),F="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,V=v.get("symbol-sort-key");if(this.features=[],!N&&!F)return;const j=s.iconDependencies,q=s.glyphDependencies,J=s.availableImages,se=new R(this.zoom);for(const{feature:ge,id:ae,index:de,sourceLayerIndex:ye}of i){const _e=g._featureFilter.needGeometry,Ze=Do(ge,_e);if(!g._featureFilter.filter(se,Ze,c))continue;if(_e||(Ze.geometry=Ic(ge,c,p)),w&&1!==ge.type&&c.z<=5){const Ke=Ze.geometry,ht=.98078528056,ct=(_t,Pt)=>oa(gl(_t.x,_t.y,c,1),gl(Pt.x,Pt.y,c,1))<ht;for(let _t=0;_t<Ke.length;_t++)Ke[_t]=qx(Ke[_t],ct)}let He,st;if(N){const Ke=g.getValueAndResolveTokens("text-field",Ze,c,J),ht=ai.factory(Ke);qE(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===E()||this.hasRTLText&&A.isParsed())&&(He=Pv(ht,g,Ze))}if(F){const Ke=g.getValueAndResolveTokens("icon-image",Ze,c,J);st=Ke instanceof Ro?Ke:Ro.fromString(Ke)}if(!He&&!st)continue;const wt=this.sortFeaturesByKey?V.evaluate(Ze,{},c):void 0;if(this.features.push({id:ae,text:He,icon:st,index:de,sourceLayerIndex:ye,geometry:Ze.geometry,properties:ge.properties,type:fh[ge.type],sortKey:wt}),st&&(j[st.name]=!0),He){const Ke=T.evaluate(Ze,{},c).join(","),ht="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ga.vertical)>=0;for(const ct of He.sections)if(ct.image)j[ct.image.name]=!0;else{const _t=_p(He.toString()),Pt=ct.fontStack||Ke,rt=q[Pt]=q[Pt]||{};this.calculateGlyphDependencies(ct.text,rt,ht,this.allowVerticalPlacement,_t)}}}"line"===v.get("symbol-placement")&&(this.features=function(ge){const ae={},de={},ye=[];let _e=0;function Ze(Ke){ye.push(ge[Ke]),_e++}function He(Ke,ht,ct){const _t=de[Ke];return delete de[Ke],de[ht]=_t,ye[_t].geometry[0].pop(),ye[_t].geometry[0]=ye[_t].geometry[0].concat(ct[0]),_t}function st(Ke,ht,ct){const _t=ae[ht];return delete ae[ht],ae[Ke]=_t,ye[_t].geometry[0].shift(),ye[_t].geometry[0]=ct[0].concat(ye[_t].geometry[0]),_t}function wt(Ke,ht,ct){const _t=ct?ht[0][ht[0].length-1]:ht[0][0];return`${Ke}:${_t.x}:${_t.y}`}for(let Ke=0;Ke<ge.length;Ke++){const ht=ge[Ke],ct=ht.geometry,_t=ht.text?ht.text.toString():null;if(!_t){Ze(Ke);continue}const Pt=wt(_t,ct),rt=wt(_t,ct,!0);if(Pt in de&&rt in ae&&de[Pt]!==ae[rt]){const $t=st(Pt,rt,ct),nn=He(Pt,rt,ye[$t].geometry);delete ae[Pt],delete de[rt],de[wt(_t,ye[nn].geometry,!0)]=nn,ye[$t].geometry=null}else Pt in de?He(Pt,rt,ct):rt in ae?st(Pt,rt,ct):(Ze(Ke),ae[Pt]=_e-1,de[rt]=_e-1)}return ye.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,ae)=>ge.sortKey-ae.sortKey)}update(i,s,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,c,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=u_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const c=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:p,y:g}of s)this.lineVertexArray.emplaceBack(p,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,s,c,p,g,v,w,T,S,P,N,F,V,j){const q=i.indexArray,J=i.layoutVertexArray,se=i.globeExtVertexArray,ge=i.segments.prepareSegment(4*s.length,J,q,this.canOverlap?v.sortKey:void 0),ae=this.glyphOffsetArray.length,de=ge.vertexLength,ye=this.allowVerticalPlacement&&w===Ga.vertical?Math.PI/2:0,_e=v.text&&v.text.sections;for(let He=0;He<s.length;He++){const{tl:st,tr:wt,bl:Ke,br:ht,tex:ct,pixelOffsetTL:_t,pixelOffsetBR:Pt,minFontScaleX:rt,minFontScaleY:$t,glyphOffset:nn,isSDF:Ht,sectionIndex:Bn}=s[He],Lt=ge.vertexLength,yn=nn[1];if(h_(J,S.x,S.y,st.x,yn+st.y,ct.x,ct.y,c,Ht,_t.x,_t.y,rt,$t),h_(J,S.x,S.y,wt.x,yn+wt.y,ct.x+ct.w,ct.y,c,Ht,Pt.x,_t.y,rt,$t),h_(J,S.x,S.y,Ke.x,yn+Ke.y,ct.x,ct.y+ct.h,c,Ht,_t.x,Pt.y,rt,$t),h_(J,S.x,S.y,ht.x,yn+ht.y,ct.x+ct.w,ct.y+ct.h,c,Ht,Pt.x,Pt.y,rt,$t),T){const{x:Vn,y:bi,z:Hn}=T.anchor,[Cn,Hi,Wn]=T.up;Bf(se,Vn,bi,Hn,Cn,Hi,Wn),Bf(se,Vn,bi,Hn,Cn,Hi,Wn),Bf(se,Vn,bi,Hn,Cn,Hi,Wn),Bf(se,Vn,bi,Hn,Cn,Hi,Wn),_m(i.dynamicLayoutVertexArray,Vn,bi,Hn,ye)}else _m(i.dynamicLayoutVertexArray,S.x,S.y,S.z,ye);q.emplaceBack(Lt,Lt+1,Lt+2),q.emplaceBack(Lt+1,Lt+2,Lt+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nn[0]),He!==s.length-1&&Bn===s[He+1].sectionIndex||i.programConfigurations.populatePaintArrays(J.length,v,v.index,{},V,j,_e&&_e[Bn])}const Ze=T?T.anchor:S;i.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,S.x,S.y,ae,this.glyphOffsetArray.length-ae,de,P,N,S.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,F,0)}_commitLayoutVertex(i,s,c,p,g,v,w){i.emplaceBack(s,c,p,g,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,s,c,p,g,v,w){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=T.vertexLength,P=w.tileAnchorX,N=w.tileAnchorY;for(let V=0;V<4;V++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(s,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new ze(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new ze(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new ze(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,g,v,P,N,new ze(i.x1,i.y2)),T.vertexLength+=4;const F=c.indexArray;F.emplaceBack(S,S+1),F.emplaceBack(S+1,S+2),F.emplaceBack(S+2,S+3),F.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceTextSize(i,v,s,w);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceIconSize(i,s,v.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}generateCollisionDebugBuffers(i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bd(en,Hg.members,co),this.iconCollisionBox=new bd(en,Hg.members,co);const c=uu(this.iconSizeData,i),p=uu(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,i,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,i,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,i,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,i,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(i,s,c,p){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:p),v=Df(this.textSizeData,i,g)/fo;return this.tilePixelRatio*v}getSymbolInstanceIconSize(i,s,c){const p=this.icon.placedSymbolArray.get(c),g=Df(this.iconSizeData,i,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,s,c){i.emplaceBack(s,-c,-c),i.emplaceBack(s,c,-c),i.emplaceBack(s,c,c),i.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceTextSize(i,v,s,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding)}}_updateIconDebugCollisionBoxes(i,s,c,p,g,v){for(let w=p;w<g;w++){const T=c.get(w),S=this.getSymbolInstanceIconSize(i,s,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding)}}updateCollisionDebugBuffers(i,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=uu(this.iconSizeData,i),p=uu(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,i,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(p,i,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(c,i,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,i,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,c,p,g,v,w,T,S){const P={};if(s<c){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=i.get(s);P.textBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},P.textFeatureIndex=ye}if(p<g){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=i.get(p);P.verticalTextBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},P.verticalTextFeatureIndex=ye}if(v<w){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=i.get(v);P.iconBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},P.iconFeatureIndex=ye}if(T<S){const{x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=i.get(T);P.verticalIconBox={x1:N,y1:F,x2:V,y2:j,padding:q,projectedAnchorX:J,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:ae,tileAnchorY:de},P.verticalIconFeatureIndex=ye}return P}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,s){const c=i.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<p;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(i),c=Math.cos(i),p=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const T=this.symbolInstances.get(w);p.push(0|Math.round(s*T.tileAnchorX+c*T.tileAnchorY)),g.push(T.featureIndex)}return v.sort((w,T)=>p[w]-p[T]||g[T]-g[w]),v}addToSortKeyRanges(i,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&v!==g&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Qt(gu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),gu.MAX_GLYPHS=65535,gu.addDynamicAttributes=_m;const d_=new ce({"symbol-placement":new G(it.layout_symbol["symbol-placement"]),"symbol-spacing":new G(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new G(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new G(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new G(it.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new G(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new G(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new G(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(it.layout_symbol["icon-size"]),"icon-text-fit":new G(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new G(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(it.layout_symbol["icon-image"]),"icon-rotate":new ee(it.layout_symbol["icon-rotate"]),"icon-padding":new G(it.layout_symbol["icon-padding"]),"icon-keep-upright":new G(it.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(it.layout_symbol["icon-offset"]),"icon-anchor":new ee(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new G(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new G(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new G(it.layout_symbol["text-rotation-alignment"]),"text-field":new ee(it.layout_symbol["text-field"]),"text-font":new ee(it.layout_symbol["text-font"]),"text-size":new ee(it.layout_symbol["text-size"]),"text-max-width":new ee(it.layout_symbol["text-max-width"]),"text-line-height":new ee(it.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(it.layout_symbol["text-letter-spacing"]),"text-justify":new ee(it.layout_symbol["text-justify"]),"text-radial-offset":new ee(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new G(it.layout_symbol["text-variable-anchor"]),"text-anchor":new ee(it.layout_symbol["text-anchor"]),"text-max-angle":new G(it.layout_symbol["text-max-angle"]),"text-writing-mode":new G(it.layout_symbol["text-writing-mode"]),"text-rotate":new ee(it.layout_symbol["text-rotate"]),"text-padding":new G(it.layout_symbol["text-padding"]),"text-keep-upright":new G(it.layout_symbol["text-keep-upright"]),"text-transform":new ee(it.layout_symbol["text-transform"]),"text-offset":new ee(it.layout_symbol["text-offset"]),"text-allow-overlap":new G(it.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new G(it.layout_symbol["text-ignore-placement"]),"text-optional":new G(it.layout_symbol["text-optional"])});var Vf={paint:new ce({"icon-opacity":new ee(it.paint_symbol["icon-opacity"]),"icon-color":new ee(it.paint_symbol["icon-color"]),"icon-halo-color":new ee(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(it.paint_symbol["icon-halo-blur"]),"icon-translate":new G(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new G(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(it.paint_symbol["text-opacity"]),"text-color":new ee(it.paint_symbol["text-color"],{runtimeType:fn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ee(it.paint_symbol["text-halo-color"]),"text-halo-width":new ee(it.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(it.paint_symbol["text-halo-blur"]),"text-translate":new G(it.paint_symbol["text-translate"]),"text-translate-anchor":new G(it.paint_symbol["text-translate-anchor"])}),layout:d_};class ph{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Da,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt(ph,"FormatSectionOverride",{omit:["defaultValue"]});class wd extends Zl{constructor(i){super(i,Vf)}recalculate(i,s){super.recalculate(i,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const g of c)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,s,c,p){const g=this.layout.get(i).evaluate(s,{},c,p),v=this._unevaluatedLayout._values[i];return v.isDataDriven()||Oa(v.value)||!g?g:(w=s.properties,g.replace(/{([^{}]+)}/g,(S,P)=>P in w?String(w[P]):""));var w}createBucket(i){return new gu(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Vf.paint.overridableProperties){if(!wd.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),c=new ph(s),p=new Kr(c,s.property.specification);let g=null;g="constant"===s.value.kind||"source"===s.value.kind?new hl("source",p):new jl("composite",p,s.value.zoomStops,s.value._interpolationType),this.paint._values[i]=new ne(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&wd.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const c=i.get("text-field"),p=Vf.paint.properties[s];let g=!1;const v=w=>{for(const T of w)if(p.overrides&&p.overrides.hasOverride(T))return void(g=!0)};if("constant"===c.value.kind&&c.value.value instanceof ai)v(c.value.value.sections);else if("source"===c.value.kind){const w=S=>{g||(S instanceof Wr&&lr(S.value)===ss?v(S.value.sections):S instanceof Ia?v(S.sections):S.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramConfiguration(i){return new vi(this,i)}}var f_={paint:new ce({"background-color":new G(it.paint_background["background-color"]),"background-pattern":new G(it.paint_background["background-pattern"]),"background-opacity":new G(it.paint_background["background-opacity"])})},Uf={paint:new ce({"raster-opacity":new G(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new G(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new G(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new G(it.paint_raster["raster-brightness-max"]),"raster-saturation":new G(it.paint_raster["raster-saturation"]),"raster-contrast":new G(it.paint_raster["raster-contrast"]),"raster-resampling":new G(it.paint_raster["raster-resampling"]),"raster-fade-duration":new G(it.paint_raster["raster-fade-duration"])})};class ym extends Zl{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var Ed={paint:new ce({"sky-type":new G(it.paint_sky["sky-type"]),"sky-atmosphere-sun":new G(it.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new G(it.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new G(it.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new G(it.paint_sky["sky-gradient-radius"]),"sky-gradient":new le(it.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new G(it.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new G(it.paint_sky["sky-atmosphere-color"]),"sky-opacity":new G(it.paint_sky["sky-opacity"])})};function jf(o,i,s){const c=[0,0,1],p=qu([]);return Gy(p,p,s?-kt(o)+Math.PI:kt(o)),Jh(p,p,-kt(i)),Dc(c,c,p),Ko(c,c)}const p_={circle:class extends Zl{constructor(o){super(o,Bp)}createBucket(o){return new rd(o)}queryRadius(o){const i=o;return sd("circle-radius",this,i)+sd("circle-stroke-width",this,i)+zp(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,s,c,p,g,v,w){const T=ov(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return sv(o,c,g,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,S)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new vi(this,o)}},heatmap:class extends Zl{createBucket(o){return new Tg(o)}constructor(o){super(o,ad),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ku({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return sd("heatmap-radius",this,o)}queryIntersectsFeature(o,i,s,c,p,g,v,w){const T=this.paint.get("heatmap-radius").evaluate(i,s);return sv(o,c,g,v,w,!0,!0,new ze(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new vi(this,o)}},hillshade:class extends Zl{constructor(o){super(o,Qx)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Zl{constructor(o){super(o,gv)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new vi(this,o)}recalculate(o,i){super.recalculate(o,i);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Xp(o)}queryRadius(){return zp(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,s,c,p,g){return!o.queryGeometry.isAboveHorizon&&Wx(rv(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Zl{constructor(o){super(o,Tv)}createBucket(o){return new eh(o)}queryRadius(){return zp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new vi(this,o)}queryIntersectsFeature(o,i,s,c,p,g,v,w,T){const S=ov(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(i,s),N=this.paint.get("fill-extrusion-base").evaluate(i,s),F=[0,0],V=w&&g.elevation,j=g.elevation?g.elevation.exaggeration():1,q=o.tile.getBucket(this);if(V&&q instanceof eh){const de=q.centroidVertexArray,ye=T+1;ye<de.length&&(F[0]=de.geta_centroid_pos0(ye),F[1]=de.geta_centroid_pos1(ye))}if(0===F[0]&&1===F[1])return!1;"globe"===g.projection.name&&(c=th([c],[new ze(0,0),new ze(_n,_n)],o.tileID.canonical).map(de=>de.polygon).flat());const J=V?w:null,[se,ge]=(ye=c,_e=N,Ze=P,He=S,st=v,wt=J,Ke=F,ht=j,ct=g.center.lat,"globe"===(de=g).projection.name?function(Pt,rt,$t,nn,Ht,Bn,Lt,yn,Vn,bi,Hn){const Cn=[],Hi=[],Wn=Pt.projection.upVectorScale(Hn,Pt.center.lat,Pt.worldSize).metersToTile,Fn=[0,0,0,1],Ai=[0,0,0,1],Bi=(Pi,dr,pn,$e)=>{Pi[0]=dr,Pi[1]=pn,Pi[2]=$e,Pi[3]=1},Gi=Fg();$t>0&&($t+=Gi),nn+=Gi;for(const Pi of rt){const dr=[],pn=[];for(const $e of Pi){const Ri=$e.x+Ht.x,Qe=$e.y+Ht.y,Ir=Pt.projection.projectTilePoint(Ri,Qe,Hn),wr=Pt.projection.upVector(Hn,$e.x,$e.y);let ui=$t,fr=nn;if(Lt){const Li=zg(Ri,Qe,$t,nn,Lt,yn,Vn,bi);ui+=Li.base,fr+=Li.top}0!==$t?Bi(Fn,Ir.x+wr[0]*Wn*ui,Ir.y+wr[1]*Wn*ui,Ir.z+wr[2]*Wn*ui):Bi(Fn,Ir.x,Ir.y,Ir.z),Bi(Ai,Ir.x+wr[0]*Wn*fr,Ir.y+wr[1]*Wn*fr,Ir.z+wr[2]*Wn*fr),gr(Fn,Fn,Bn),gr(Ai,Ai,Bn),dr.push(new fd(Fn[0],Fn[1],Fn[2])),pn.push(new fd(Ai[0],Ai[1],Ai[2]))}Cn.push(dr),Hi.push(pn)}return[Cn,Hi]}(de,ye,_e,Ze,He,st,wt,Ke,ht,ct,o.tileID.canonical):wt?function(Pt,rt,$t,nn,Ht,Bn,Lt,yn,Vn){const bi=[],Hn=[],Cn=[0,0,0,1];for(const Hi of Pt){const Wn=[],Fn=[];for(const Ai of Hi){const Bi=Ai.x+nn.x,Gi=Ai.y+nn.y,Pi=zg(Bi,Gi,rt,$t,Bn,Lt,yn,Vn);Cn[0]=Bi,Cn[1]=Gi,Cn[2]=Pi.base,Cn[3]=1,ou(Cn,Cn,Ht),Cn[3]=Math.max(Cn[3],1e-5);const dr=new fd(Cn[0]/Cn[3],Cn[1]/Cn[3],Cn[2]/Cn[3]);Cn[0]=Bi,Cn[1]=Gi,Cn[2]=Pi.top,Cn[3]=1,ou(Cn,Cn,Ht),Cn[3]=Math.max(Cn[3],1e-5);const pn=new fd(Cn[0]/Cn[3],Cn[1]/Cn[3],Cn[2]/Cn[3]);Wn.push(dr),Fn.push(pn)}bi.push(Wn),Hn.push(Fn)}return[bi,Hn]}(ye,_e,Ze,He,st,wt,Ke,ht,ct):function(Pt,rt,$t,nn,Ht){const Bn=[],Lt=[],yn=Ht[8]*rt,Vn=Ht[9]*rt,bi=Ht[10]*rt,Hn=Ht[11]*rt,Cn=Ht[8]*$t,Hi=Ht[9]*$t,Wn=Ht[10]*$t,Fn=Ht[11]*$t;for(const Ai of Pt){const Bi=[],Gi=[];for(const Pi of Ai){const dr=Pi.x+nn.x,pn=Pi.y+nn.y,$e=Ht[0]*dr+Ht[4]*pn+Ht[12],Ri=Ht[1]*dr+Ht[5]*pn+Ht[13],Qe=Ht[2]*dr+Ht[6]*pn+Ht[14],Ir=Ht[3]*dr+Ht[7]*pn+Ht[15],wr=$e+yn,ui=Ri+Vn,fr=Qe+bi,Li=Math.max(Ir+Hn,1e-5),po=$e+Cn,Ar=Ri+Hi,eo=Qe+Wn,Hr=Math.max(Ir+Fn,1e-5);Bi.push(new fd(wr/Li,ui/Li,fr/Li)),Gi.push(new fd(po/Hr,Ar/Hr,eo/Hr))}Bn.push(Bi),Lt.push(Gi)}return[Bn,Lt]}(ye,_e,Ze,He,st)),ae=o.queryGeometry;var de,ye,_e,Ze,He,st,wt,Ke,ht,ct;return function(de,ye,_e){let Ze=1/0;Wx(_e,ye)&&(Ze=Mv(_e,ye[0]));for(let He=0;He<ye.length;He++){const st=ye[He],wt=de[He];for(let Ke=0;Ke<st.length-1;Ke++){const ht=st[Ke],ct=[ht,st[Ke+1],wt[Ke+1],wt[Ke],ht];od(_e,ct)&&(Ze=Math.min(Ze,Mv(_e,ct)))}}return Ze!==1/0&&Ze}(se,ge,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Zl{constructor(o){super(o,jg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Lo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=$g.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Tf(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new vi(this,o)}queryRadius(o){const i=o,s=Sv(sd("line-width",this,i),sd("line-gap-width",this,i)),c=sd("line-offset",this,i);return s/2+Math.abs(c)+zp(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,s,c,p,g){if(o.queryGeometry.isAboveHorizon)return!1;const v=rv(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),w=o.pixelToTileUnitsFactor/2*Sv(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),T=this.paint.get("line-offset").evaluate(i,s);return T&&(c=function(S,P){const N=[],F=new ze(0,0);for(let V=0;V<S.length;V++){const j=S[V],q=[];for(let J=0;J<j.length;J++){const se=j[J],ge=j[J+1],ae=0===J?F:se.sub(j[J-1])._unit()._perp(),de=J===j.length-1?F:ge.sub(se)._unit()._perp(),ye=ae._add(de)._unit();ye._mult(1/(ye.x*de.x+ye.y*de.y)),q.push(ye._mult(P)._add(se))}N.push(q)}return N}(c,T*o.pixelToTileUnitsFactor)),function(S,P,N){for(let F=0;F<P.length;F++){const V=P[F];if(S.length>=3)for(let j=0;j<V.length;j++)if(au(S,V[j]))return!0;if(Xx(S,V,N))return!0}return!1}(v,c,w)}isTileClipped(){return!0}},symbol:wd,background:class extends Zl{constructor(o){super(o,f_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Zl{constructor(o){super(o,Uf)}getProgramIds(){return["raster"]}},sky:class extends Zl{constructor(o){super(o,Ed),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ku({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),p=!c,g=o.style.light,v=g.properties.get("position");return p&&"viewport"===g.properties.get("anchor")&&Ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?jf(v.azimuthal,90-v.polar,i):jf(c[0],90-c[1],i)}const s=this.paint.get("sky-gradient-center");return jf(s[0],90-s[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class _u{constructor(i,s,c,p){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(s,p)}update(i,s,c){const{width:p,height:g}=i,{context:v}=this,{gl:w}=v,{HTMLImageElement:T,HTMLCanvasElement:S,HTMLVideoElement:P,ImageData:N,ImageBitmap:F}=Q;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!s||!1!==s.premultiply)),c||this.size&&this.size[0]===p&&this.size[1]===g){const{x:V,y:j}=c||{x:0,y:0};i instanceof T||i instanceof S||i instanceof P||i instanceof N||F&&i instanceof F?w.texSubImage2D(w.TEXTURE_2D,0,V,j,w.RGBA,w.UNSIGNED_BYTE,i):w.texSubImage2D(w.TEXTURE_2D,0,V,j,p,g,w.RGBA,w.UNSIGNED_BYTE,i.data)}else this.size=[p,g],i instanceof T||i instanceof S||i instanceof P||i instanceof N||F&&i instanceof F?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,i):w.texImage2D(w.TEXTURE_2D,0,this.format,p,g,0,this.format,w.UNSIGNED_BYTE,i.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(i,s){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?i===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:i),this.filter=i),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class ZE{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class m_{constructor(){this.tasks={},this.taskQueue=[],di(["process"],this),this.invoker=new ZE(this.process),this.nextId=0}add(i,s){const c=this.nextId++,p=function({type:g,isSymbolTile:v,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||v?"parseTile"!==g||v?"parseTile"===g&&v?300-w:"maybePrepare"===g&&v?400-w:500:200-w:100-w}(s);if(0===p){rs();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:s,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){rs();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<s&&(s=g.priority,i=p)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class Cd{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const c=i[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const Ob=["tile","layer","source","sourceLayer","state"];class g_{constructor(i,s,c,p,g){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=c,this._y=p,this.properties=i.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const s of Ob)void 0!==this[s]&&(i[s]=this[s]);return i}}const Ql=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,s=0,c=0,p=0,g=0,v=0,w=0;for(1&i?p=g=v=32:s=c=w=32;(i>>=1)>1;){const S=s+p>>1,P=c+g>>1;1&i?(p=s,g=c,s=v,c=w):(s=p,c=g,p=v,g=w),v=S,w=P}const T=4*o;Ql[T+0]=s,Ql[T+1]=c,Ql[T+2]=p,Ql[T+3]=g}const bl=new Uint16Array(2178),yu=new Uint8Array(1089),vm=new Uint16Array(1089);function Nb(o){return 0===o?-.03125:32===o?.03125:0}var Wv=Pe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $f={type:2,extent:_n,loadGeometry:()=>[[new ze(0,0),new ze(_n+1,0),new ze(_n+1,_n+1),new ze(0,_n+1),new ze(0,0)]]};class Hf{constructor(i,s,c,p,g){this.tileID=i,this.uid=Oi(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<Bs.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=du(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,g){const v={};if(!g)return v;for(const w of p){const T=w.layerIds.map(S=>g.getLayer(S)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(S=>T.filter(P=>P.id===S)[0]));for(const S of T)v[S.id]=w}}return v}(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof gu){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof gu&&g.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||"deferred"!==E()||I();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Ii}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(i)}const s=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _u(i,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _u(i,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new _u(i,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,s,c,p,g,v,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:w,transform:v,params:g,tileTransform:this.tileTransform},i,s,c):{}}querySourceFeatures(i,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;const w=Oe(s&&s.filter),{z:T,x:S,y:P}=this.tileID.canonical,N={z:T,x:S,y:P};for(let F=0;F<v.length;F++){const V=v.feature(F);if(w.needGeometry){const J=Do(V,!0);if(!w.filter(new R(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!w.filter(new R(this.tileID.overscaledZ),V))continue;const j=c.getId(V,g),q=new g_(V,T,S,P,j);q.tile=N,i.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const c=no(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),p=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const v=this.buckets[g],w=v.layers[0].sourceLayer||"_geojsonTileLayer",T=c[w],S=i[w];if(!T||!S||0===Object.keys(S).length)continue;if(v.update(S,T,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof Tf||v instanceof Xp){const N=s.style._getSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&N&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(N.id,this.tileID)}const P=s&&s.style&&s.style.getLayer(g);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Bs.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Bs.now()+i}setTexture(i,s){const c=s.context,p=c.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new _u(c,i,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(i,s){const c={};for(const p of s)c[p]=!0;this.dependencies[i]=c}hasDependency(i,s){for(const c of i){const p=this.dependencies[c];if(p)for(const g of s)if(p[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=Ic($f,this.tileID.canonical,this.tileTransform)[0],p=new Et,g=new Yo;for(let v=0;v<c.length;v++){const{x:w,y:T}=c[v];p.emplaceBack(w,T),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(p,lf.members),this._tileDebugSegments=ji.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=Ic($f,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const v=function(w,T){const S=du(w,T),P=Math.pow(2,w.z);for(let J=0;J<33;J++)for(let se=0;se<33;se++){const ge=ca((w.x+(se+Nb(se))/32)/P),ae=zo((w.y+(J+Nb(J))/32)/P),de=T.project(ge,ae),ye=33*J+se;bl[2*ye+0]=Math.round((de.x*S.scale-S.x)*_n),bl[2*ye+1]=Math.round((de.y*S.scale-S.y)*_n)}yu.fill(0),vm.fill(0);for(let J=2045;J>=0;J--){const se=4*J,ge=Ql[se+0],ae=Ql[se+1],de=Ql[se+2],ye=Ql[se+3],_e=ge+de>>1,Ze=ae+ye>>1,He=_e+Ze-ae,st=Ze+ge-_e,wt=33*ae+ge,Ke=33*ye+de,ht=33*Ze+_e,ct=Math.hypot((bl[2*wt+0]+bl[2*Ke+0])/2-bl[2*ht+0],(bl[2*wt+1]+bl[2*Ke+1])/2-bl[2*ht+1])>=16;yu[ht]=yu[ht]||(ct?1:0),J<1022&&(yu[ht]=yu[ht]||yu[33*(ae+st>>1)+(ge+He>>1)]||yu[33*(ye+st>>1)+(de+He>>1)])}const N=new ut,F=new Kt;let V=0;function j(J,se){const ge=33*se+J;return 0===vm[ge]&&(N.emplaceBack(bl[2*ge+0],bl[2*ge+1],J*_n/32,se*_n/32),vm[ge]=++V),vm[ge]-1}function q(J,se,ge,ae,de,ye){const _e=J+ge>>1,Ze=se+ae>>1;if(Math.abs(J-de)+Math.abs(se-ye)>1&&yu[33*Ze+_e])q(de,ye,J,se,_e,Ze),q(ge,ae,de,ye,_e,Ze);else{const He=j(J,se),st=j(ge,ae),wt=j(de,ye);F.emplaceBack(He,st,wt)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:N,indices:F}}(this.tileID.canonical,s);p=v.vertices,g=v.indices}else{p=new ut,g=new Kt;for(const{x:w,y:T}of c)p.emplaceBack(w,T,0,0);const v=Zp(p.int16,void 0,4);for(let w=0;w<v.length;w+=3)g.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=i.createVertexBuffer(p,Wv.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(g),this._tileBoundsSegments=ji.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(i,s){const c=s.projection;if(!c||"globe"!==c.name||s.freezeTileCoverage)return;const p=this.tileID.canonical,g=id(Xy(p,s)),v=ho(s.zoom);let w;v>0&&(w=tf(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,p,s,g,w,v),this._makeGlobeTileDebugTextBuffer(i,p,s,g,w,v)}_globePoint(i,s,c,p,g,v,w){let T=gl(i,s,c);if(v){const S=1<<c.z,P=Ha(p.center.lng),N=fs(p.center.lat),F=(c.x+.5)/S-P;let V=0;F>.5?V=-1:F<-.5&&(V=1);let j=(i/_n+c.x)/S+V,q=(s/_n+c.y)/S;j=(j-P)*p._pixelsPerMercatorPixel+P,q=(q-N)*p._pixelsPerMercatorPixel+N;const J=[j*p.worldSize,q*p.worldSize,0];gr(J,J,v),T=Mc(T,J,w)}return gr(T,T,g)}_makeGlobeTileDebugBorderBuffer(i,s,c,p,g,v){const w=new Et,T=new Yo,S=new je,P=(F,V,j,q,J)=>{const se=(j-F)/(J-1),ge=(q-V)/(J-1),ae=w.length;for(let de=0;de<J;de++){const ye=F+de*se,_e=V+de*ge;w.emplaceBack(ye,_e);const Ze=this._globePoint(ye,_e,s,c,p,g,v);S.emplaceBack(Ze[0],Ze[1],Ze[2]),T.emplaceBack(ae+de)}},N=_n;P(0,0,N,0,16),P(N,0,N,N,16),P(N,N,0,N,16),P(0,N,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(T),this._tileDebugBuffer=i.createVertexBuffer(w,lf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(S,qy.members),this._tileDebugSegments=ji.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(i,s,c,p,g,v){const w=_n/4,T=new Et,S=new Kt,P=new je,N=25;S.reserve(32),T.reserve(N),P.reserve(N);const F=(V,j)=>N*V+j;for(let V=0;V<N;V++){const j=V*w;for(let q=0;q<N;q++){const J=q*w;T.emplaceBack(J,j);const se=this._globePoint(J,j,s,c,p,g,v);P.emplaceBack(se[0],se[1],se[2])}}for(let V=0;V<4;V++)for(let j=0;j<4;j++){const q=F(V,j),J=F(V,j+1),se=F(V+1,j),ge=F(V+1,j+1);S.emplaceBack(q,J,se),S.emplaceBack(se,J,ge)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(S),this._tileDebugTextBuffer=i.createVertexBuffer(T,lf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(P,qy.members),this._tileDebugTextSegments=ji.simpleSegment(0,0,N,32)}}class Fb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,c){const p=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},si(this.stateChanges[i][p],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const g in this.state[i])g!==p&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][p]){this.deletedStates[i][p]={};for(const g in this.state[i][p])c[g]||(this.deletedStates[i][p][g]=null)}else for(const g in c)this.deletedStates[i]&&this.deletedStates[i][p]&&null===this.deletedStates[i][p][g]&&delete this.deletedStates[i][p][g]}removeFeatureState(i,s,c){if(null===this.deletedStates[i])return;const p=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==s)null!==this.deletedStates[i][p]&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][c]=null);else if(void 0!==s)if(this.stateChanges[i]&&this.stateChanges[i][p])for(c in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][c]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,s){const c=String(s),p=si({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const g=this.deletedStates[i][s];if(null===g)return{};for(const v in g)delete p[v]}return p}initializeTileState(i,s){i.setFeatureState(this.state,s)}coalesceChanges(i,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),si(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(null===this.deletedStates[p])for(const v in this.state[p])g[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(null===this.deletedStates[p][v])this.state[p][v]={};else if(this.state[p][v])for(const w of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][w];g[v]=this.state[p][v]}c[p]=c[p]||{},si(c[p],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const p in i)i[p].setFeatureState(c,s)}}class __{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const c=this.toIdx(i,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function xm(o,i,s,c){let p=0,g=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(c[v])<1e-15){if(s[v]<o[v]||s[v]>i[v])return null}else{const w=1/c[v];let T=(o[v]-s[v])*w,S=(i[v]-s[v])*w;if(T>S){const P=T;T=S,S=P}if(T>p&&(p=T),S<g&&(g=S),p>g)return null}return p}function Gf(o,i,s,c,p,g,v,w,T,S,P){const N=c-o,F=p-i,V=g-s,j=v-o,q=w-i,J=T-s,se=P[1]*J-P[2]*q,ge=P[2]*j-P[0]*J,ae=P[0]*q-P[1]*j,de=N*se+F*ge+V*ae;if(Math.abs(de)<1e-15)return null;const ye=1/de,_e=S[0]-o,Ze=S[1]-i,He=S[2]-s,st=(_e*se+Ze*ge+He*ae)*ye;if(st<0||st>1)return null;const wt=Ze*V-He*F,Ke=He*N-_e*V,ht=_e*F-Ze*N,ct=(P[0]*wt+P[1]*Ke+P[2]*ht)*ye;return ct<0||st+ct>1?null:(j*wt+q*Ke+J*ht)*ye}function Xv(o,i,s){return(o-i)/(s-i)}function y_(o,i,s,c,p,g,v,w,T){const S=1<<s,P=g-c,N=v-p,F=(o+1)/S*P+c,V=(i+0)/S*N+p,j=(i+1)/S*N+p;w[0]=(o+0)/S*P+c,w[1]=V,T[0]=F,T[1]=j}class Yv{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const v=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,v));const S=1/T,P=(V,j,q,J,se)=>{const ge=J?1:0,ae=(V+1)*q-ge,de=j*q,ye=(j+1)*q-ge;se[0]=V*q,se[1]=de,se[2]=ae,se[3]=ye};let N=new __(T);const F=[];for(let V=0;V<T*T;V++){P(V%T,Math.floor(V/T),S,!1,F);const j=mh(F[0],F[1],g),q=mh(F[2],F[1],g),J=mh(F[2],F[3],g),se=mh(F[0],F[3],g);N.minimums.push(Math.min(j,q,J,se)),N.maximums.push(Math.max(j,q,J,se)),N.leaves.push(1)}for(w.push(N),T/=2;T>=1;T/=2){const V=w[w.length-1];N=new __(T);for(let j=0;j<T*T;j++){P(j%T,Math.floor(j/T),2,!0,F);const q=V.getElevation(F[0],F[1]),J=V.getElevation(F[2],F[1]),se=V.getElevation(F[2],F[3]),ge=V.getElevation(F[0],F[3]),ae=V.isLeaf(F[0],F[1]),de=V.isLeaf(F[2],F[1]),ye=V.isLeaf(F[2],F[3]),_e=V.isLeaf(F[0],F[3]),Ze=Math.min(q.min,J.min,se.min,ge.min),He=Math.max(q.max,J.max,se.max,ge.max),st=ae&&de&&ye&&_e;N.maximums.push(He),N.minimums.push(Ze),N.leaves.push(He-Ze<=5&&st?1:0)}w.push(N)}return w}(this.dem),c=s.length-1,p=s[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(i,s,c,p,g,v,w=1){return xm([i,s,-100],[c,p,this.maximums[0]*w],g,v)}raycast(i,s,c,p,g,v,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,s,c,p,g,v,w);if(null==T)return null;const S=[],P=[],N=[],F=[],V=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:j,t:q,nodex:J,nodey:se,depth:ge}=V.pop();if(this.leaves[j]){y_(J,se,ge,i,s,c,p,N,F);const de=1<<ge,ye=(J+0)/de,_e=(J+1)/de,Ze=(se+0)/de,He=(se+1)/de,st=mh(ye,Ze,this.dem)*w,wt=mh(_e,Ze,this.dem)*w,Ke=mh(_e,He,this.dem)*w,ht=mh(ye,He,this.dem)*w,ct=Gf(N[0],N[1],st,F[0],N[1],wt,F[0],F[1],Ke,g,v),_t=Gf(F[0],F[1],Ke,N[0],F[1],ht,N[0],N[1],st,g,v),Pt=Math.min(null!==ct?ct:Number.MAX_VALUE,null!==_t?_t:Number.MAX_VALUE);if(Pt!==Number.MAX_VALUE)return Pt;{const rt=sf([],g,v,q);if(v_(st,wt,ht,Ke,Xv(rt[0],N[0],F[0]),Xv(rt[1],N[1],F[1]))>=rt[2])return q}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){y_((J<<1)+this._siblingOffset[de][0],(se<<1)+this._siblingOffset[de][1],ge+1,i,s,c,p,N,F),N[2]=-100,F[2]=this.maximums[this.childOffsets[j]+de]*w;const ye=xm(N,F,g,v);if(null!=ye){const _e=ye;S[de]=_e;let Ze=!1;for(let He=0;He<ae&&!Ze;He++)_e>=S[P[He]]&&(P.splice(He,0,de),Ze=!0);Ze||(P[ae]=de),ae++}}for(let de=0;de<ae;de++){const ye=P[de];V.push({idx:this.childOffsets[j]+ye,t:S[ye],nodex:(J<<1)+this._siblingOffset[ye][0],nodey:(se<<1)+this._siblingOffset[ye][1],depth:ge+1})}}return null}_addNode(i,s,c){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,c,p,g){if(1===i[p].isLeaf(s,c))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const v=p-1,w=i[v];let T=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const N=2*s+this._siblingOffset[P][0],F=2*c+this._siblingOffset[P][1],V=w.getElevation(N,F),j=w.isLeaf(N,F),q=this._addNode(V.min,V.max,j);j&&(T|=1<<P),S||(S=q)}for(let P=0;P<this._siblingOffset.length;P++)T&1<<P||this._construct(i,2*s+this._siblingOffset[P][0],2*c+this._siblingOffset[P][1],v,S+P)}}function v_(o,i,s,c,p,g){return ci(ci(o,s,g),ci(i,c,g),p)}function mh(o,i,s){const c=s.dim,p=Dn(o*c-.5,0,c-1),g=Dn(i*c-.5,0,c-1),v=Math.floor(p),w=Math.floor(g),T=Math.min(v+1,c-1),S=Math.min(w+1,c-1);return v_(s.get(v,w),s.get(T,w),s.get(v,S),s.get(T,S),p-v,g-w)}const Kv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function bm(o,i,s){return(256*o*256+256*i+s)/10-1e4}function zb(o,i,s){return 256*o+i+s/256-32768}class Oc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,c,p=!1,g=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return Ji(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const v=this.dim=s.height-2,w=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let T=0;T<v;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(v,T)]=w[this._idx(v-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,v)]=w[this._idx(T,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Yv(this)}get(i,s,c=!1){c&&(i=Dn(i,-1,this.dim),s=Dn(s,-1,this.dim));const p=4*this._idx(i,s);return("terrarium"===this.encoding?zb:bm)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(i){return Kv[i]}get unpackVector(){return Kv[this.encoding]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const c=[0,0,0,0],p=Oc.getUnpackVector(s);let g=Math.floor((i+p[3])/p[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new As({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,g=s*this.dim+this.dim,v=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:p=g-1;break;case 1:g=p+1}switch(c){case-1:v=w-1;break;case 1:w=v+1}const T=-s*this.dim,S=-c*this.dim;for(let P=v;P<w;P++)for(let N=p;N<g;N++){const F=4*this._idx(N,P),V=4*this._idx(N+T,P+S);this.pixels[F+0]=i.pixels[V+0],this.pixels[F+1]=i.pixels[V+1],this.pixels[F+2]=i.pixels[V+2],this.pixels[F+3]=i.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Qt(Oc,"DEMData"),Qt(Yv,"DemMinMaxQuadTree",{omit:["dem"]});class ha{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,c){const p=i.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(void 0!==c&&(g.timeout=setTimeout(()=>{this.remove(i,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const c=i.wrapped().key,p=void 0===s?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const c in this.data)for(const p of this.data[c])i(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class Td{constructor(i,s,c){this.func=i,this.mask=s,this.range=c}}Td.ReadOnly=!1,Td.ReadWrite=!0,Td.disabled=new Td(519,Td.ReadOnly,[0,1]);class Za{constructor(i,s,c,p,g,v){this.test=i,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=v}}Za.disabled=new Za({func:519,mask:0},0,0,7680,7680,7680);class ec{constructor(i,s,c){this.blendFunction=i,this.blendColor=s,this.mask=c}}ec.Replace=[1,0],ec.disabled=new ec(ec.Replace,cn.transparent,[!1,!1,!1,!1]),ec.unblended=new ec(ec.Replace,cn.transparent,[!0,!0,!0,!0]),ec.alphaBlended=new ec([1,771],cn.transparent,[!0,!0,!0,!0]);class wl{constructor(i,s,c){this.enable=i,this.mode=s,this.frontFace=c}}wl.disabled=new wl(!1,1029,2305),wl.backCCW=new wl(!0,1029,2305),wl.backCW=new wl(!0,1029,2304),wl.frontCW=new wl(!0,1028,2304),wl.frontCCW=new wl(!0,1028,2305);class Nc extends Vs{constructor(i,s,c){super(),this.id=i,this._onlySymbols=c,s.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new ha(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fb,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return In(this._tiles).map(i=>i.tileID).sort(Bb).map(i=>i.key)}getRenderableIds(i){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&s.push(this._tiles[c]);return i?s.sort((c,p)=>{const g=c.tileID,v=p.tileID,w=new ze(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new ze(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Bb).map(c=>c.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,i,s)))}_tileLoaded(i,s,c,p){if(p)if(i.state="errored",404!==p.status)this._source.fire(new _o(p,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Bs.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Ta("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(i.neighboringTiles&&i.neighboringTiles[g]){const v=this.getTileByID(g);c(i,v),c(v,i)}}function c(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),S=g.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+T)?v+=T:1===Math.abs(v-T)&&(v-=T)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,w),p.neighboringTiles&&p.neighboringTiles[S]&&(p.neighboringTiles[S].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,c,p){for(const g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>c)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const S=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[S.key],v&&v.hasData()&&(w=S)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){p[w.key]=w;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=i.overscaledZ-1;c>=s;c--){const p=i.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const c=Math.ceil(i.width/s)+1,p=Math.ceil(i.height/s)+1,g=Math.floor(c*p*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(i){const s=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(i,s,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(i,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Jo(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(p=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(w=>this._source.hasTile(w)))):p=[];const g=this._updateRetainedTiles(p);if(Em(this._source.type)&&0!==p.length){const w={},T={},S=Object.keys(g);for(const N of S){const F=g[N],V=this._tiles[N];if(!V||V.fadeEndTime&&V.fadeEndTime<=Bs.now())continue;const j=this.findLoadedParent(F,Math.max(F.overscaledZ-Nc.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),w[j.tileID.key]=j.tileID),T[N]=F}const P=p[p.length-1].overscaledZ;for(const N in this._tiles){const F=this._tiles[N];if(g[N]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>P;){V=V.scaledTo(V.overscaledZ-1);const j=this._tiles[V.key];if(j&&j.hasData()&&T[V.key]){g[N]=F.tileID;break}}}for(const N in w)g[N]||(this._coveredTiles[N]=!0,g[N]=w[N])}for(const w in g)this._tiles[w].clearFadeHold();const v=function(w,T){const S=[];for(const P in w)P in T||S.push(P);return S}(this._tiles,g);for(const w of v){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(0===i.length)return s;const c={},p=i.reduce((S,P)=>Math.min(S,P.overscaledZ),1/0),g=i[0].overscaledZ,v=Math.max(g-Nc.maxOverzooming,this._source.minzoom),w=Math.max(g+Nc.maxUnderzooming,this._source.minzoom),T={};for(const S of i){const P=this._addTile(S);s[S.key]=S,P.hasData()||p<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,p,w,s);for(const S of i){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const F=S.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){s[F.key]=F;continue}}else{const F=S.children(this._source.maxzoom);if(s[F[0].key]&&s[F[1].key]&&s[F[2].key]&&s[F[3].key])continue}let N=P.wasRequested();for(let F=S.overscaledZ-1;F>=v;--F){const V=S.scaledTo(F);if(c[V.key]||(c[V.key]=!0,P=this.getTile(V),!P&&N&&(P=this._addTile(V)),P&&(s[V.key]=V,N=P.wasRequested(),P.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let c,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(i){let s=this._tiles[i.key];if(s)return s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const c=!!s;if(!c){const p=this.map?this.map.painter:null;s=new Hf(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,c||this._source.fire(new Ta("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=s.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,c){const p=[],g=this.transform;if(!g)return p;const v="globe"===g.projection.name,w=Ha(g.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(v){const N=S.tileID.canonical;if(0===N.z){const F=[Math.abs(Dn(w,...Dd(N,-1))-w),Math.abs(Dn(w,...Dd(N,1))-w)];P=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(Dn(w,...Dd(N,-1))-w),Math.abs(Dn(w,...Dd(N,0))-w),Math.abs(Dn(w,...Dd(N,1))-w)];P=[F.indexOf(Math.min(...F))-1]}}else P=[0];for(const N of P){const F=i.containsTile(S,g,s,N);F&&p.push(F)}}return p}getVisibleCoordinates(i){const s=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Em(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=Bs.now())return!0}return!1}setFeatureState(i,s,c){this._state.updateState(i=i||"_geojsonTileLayer",s,c)}removeFeatureState(i,s,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,c)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,c){const p=this._tiles[i];p&&p.setDependencies(s,c)}reloadTilesForDependencies(i,s){for(const c in this._tiles)this._tiles[c].hasDependency(i,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(i,s))};return void this._source.on("data",w)}const c=new Map,p=Array.isArray(i)?i:[i],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of p){const T=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)c.set(S.key,S);this.usedForTerrain&&w.updateElevation(!1)}dn(Array.from(c.values()),(w,T)=>{const S=new Hf(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,P=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),T(P,S)})},s)}}function Bb(o,i){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||c-s||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function Em(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function Dd(o,i){const s=1<<o.z;return[o.x/s+i,(o.x+1)/s+i]}Nc.maxOverzooming=10,Nc.maxUnderzooming=3;class Cm{constructor(i,s,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(i,s,c){const p=c||i.findDEMTileFor(s);if(!p||!p.dem)return;const g=p.dem,v=p.tileID,w=1<<s.canonical.z-v.canonical.z;return new Cm(p,p.tileSize/_n/w,[(s.canonical.x/w-v.canonical.x)*g.dim,(s.canonical.y/w-v.canonical.y)*g.dim])}tileCoordToPixel(i,s){const c=s*this._scale+this._offset[1],p=Math.floor(i*this._scale+this._offset[0]),g=Math.floor(c);return new ze(p,g)}getElevationAt(i,s,c,p){const g=i*this._scale+this._offset[0],v=s*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(v),S=this._dem;return p=!!p,c?ci(ci(S.get(w,T,p),S.get(w,T+1,p),v-T),ci(S.get(w+1,T,p),S.get(w+1,T+1,p),v-T),g-w):S.get(w,T,p)}getElevationAtPixel(i,s,c){return this._dem.get(i,s,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Xl(1,i)*this._dem.stride}}class Jv{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new nu(_n,16,0),this.featureIndexArray=new Va,this.promoteId=s}insert(i,s,c,p,g,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,g,v);const T=this.grid;for(let S=0;S<s.length;S++){const P=s[S],N=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){const V=P[F];N[0]=Math.min(N[0],V.x),N[1]=Math.min(N[1],V.y),N[2]=Math.max(N[2],V.x),N[3]=Math.max(N[3],V.y)}N[0]<_n&&N[1]<_n&&N[2]>=0&&N[3]>=0&&T.insert(w,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Yp(new sm(this.rawTileData)).layers,this.sourceLayerCoder=new Cd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s,c,p){this.loadVTLayers();const g=i.params||{},v=Oe(g.filter),w=i.tileResult,T=i.transform,S=w.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(j,q,J,se)=>iv(w.bufferedTilespaceGeometry,j,q,J,se));P.sort(Vb);let N=null;T.elevation&&P.length>0&&(N=Cm.create(T.elevation,this.tileID));const F={};let V;for(let j=0;j<P.length;j++){const q=P[j];if(q===V)continue;V=q;const J=this.featureIndexArray.get(q);let se=null;this.loadMatchingFeature(F,J,v,g.layers,g.availableImages,s,c,p,(ge,ae,de,ye=0)=>(se||(se=Ic(ge,this.tileID.canonical,i.tileTransform)),ae.queryIntersectsFeature(w,ge,de,se,this.z,i.transform,i.pixelPosMatrix,N,ye)))}return F}loadMatchingFeature(i,s,c,p,g,v,w,T,S){const{featureIndex:P,bucketIndex:N,sourceLayerIndex:F,layoutVertexArrayOffset:V}=s,j=this.bucketLayerIDs[N];if(p&&!function(ge,ae){for(let de=0;de<ge.length;de++)if(ae.indexOf(ge[de])>=0)return!0;return!1}(p,j))return;const q=this.sourceLayerCoder.decode(F),J=this.vtLayers[q].feature(P);if(c.needGeometry){const ge=Do(J,!0);if(!c.filter(new R(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!c.filter(new R(this.tileID.overscaledZ),J))return;const se=this.getId(J,q);for(let ge=0;ge<j.length;ge++){const ae=j[ge];if(p&&p.indexOf(ae)<0)continue;const de=v[ae];if(!de)continue;let ye={};void 0!==se&&T&&(ye=T.getState(de.sourceLayer||"_geojsonTileLayer",se));const _e=si({},w[ae]);_e.paint=b_(_e.paint,de.paint,J,ye,g),_e.layout=b_(_e.layout,de.layout,J,ye,g);const Ze=!S||S(J,de,ye,V);if(!Ze)continue;const He=new g_(J,this.z,this.x,this.y,se);He.layer=_e;let st=i[ae];void 0===st&&(st=i[ae]=[]),st.push({featureIndex:P,feature:He,intersectionZ:Ze})}}lookupSymbolFeatures(i,s,c,p,g,v,w,T){const S={};this.loadVTLayers();const P=Oe(g);for(const N of i)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:p,featureIndex:N,layoutVertexArrayOffset:0},P,v,w,T,s);return S}loadFeature(i){const{featureIndex:s,sourceLayerIndex:c}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),g=this.vtFeatures[p];if(g[s])return g[s];const v=this.vtLayers[p].feature(s);return g[s]=v,v}hasLayer(i){for(const s of this.bucketLayerIDs)for(const c of s)if(i===c)return!0;return!1}getId(i,s){let c=i.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[s];null!=p&&(c=i.properties[p]),"boolean"==typeof c&&(c=Number(c))}return c}}function b_(o,i,s,c,p){return ln(o,(g,v)=>{const w=i instanceof re?i.get(v):null;return w&&w.evaluate?w.evaluate(s,c,p):w})}function Vb(o,i){return i-o}Qt(Jv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class w_{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new Pc({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const c=this.getKey(i,s);return this.positions[c]}trim(){const i=this.width,s=this.height=Mn(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,c){const p=[];let g=i.length%2==1?-i[i.length-1]*c:0,v=i[0]*c,w=!0;p.push({left:g,right:v,isDash:w,zeroLength:0===i[0]});let T=i[0];for(let S=1;S<i.length;S++){w=!w;const P=i[S];g=T*c,T+=P,v=T*c,p.push({left:g,right:v,isDash:w,zeroLength:0===P})}return p}addRoundDash(i,s,c){const p=s/2;for(let g=-c;g<=c;g++){const v=this.width*(this.nextRow+c+g);let w=0,T=i[w];for(let S=0;S<this.width;S++){S/T.right>1&&(T=i[++w]);const P=Math.abs(S-T.left),N=Math.abs(S-T.right),F=Math.min(P,N);let V;const j=g/c*(p+1);if(T.isDash){const q=p-Math.abs(j);V=Math.sqrt(F*F+q*q)}else V=p-Math.sqrt(F*F+j*j);this.image.data[v+S]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(i,s){for(let T=i.length-1;T>=0;--T){const S=i[T],P=i[T+1];S.zeroLength?i.splice(T,1):P&&P.isDash===S.isDash&&(P.left=S.left,i.splice(T,1))}const c=i[0],p=i[i.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const g=this.width*this.nextRow;let v=0,w=i[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=i[++v]);const S=Math.abs(T-w.left),P=Math.abs(T-w.right),N=Math.min(S,P);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?N:-N)+s+128))}}addDash(i,s){const c=this.getKey(i,s);if(this.positions[c])return this.positions[c];const p="round"===s,g=p?7:0,v=2*g+1;if(this.nextRow+v>this.height)return Ji("LineAtlas out of space"),null;0===i.length&&i.push(1);let w=0;for(let P=0;P<i.length;P++)i[P]<0&&(Ji("Negative value is found in line dasharray, replacing values with 0"),i[P]=0),w+=i[P];if(0!==w){const P=this.width/w,N=this.getDashRanges(i,this.width,P);p?this.addRoundDash(N,P,g):this.addRegularDash(N,"square"===s?.5*P:0)}const T=this.nextRow+g;this.nextRow+=v;const S={tl:[T,g],br:[w,0]};return this.positions[c]=S,S}}Qt(w_,"LineAtlas");const Qv=1*vl;class e0{constructor(i){const s={},c=[];for(const w in i){const T=i[w],S=s[w]={};for(const P in T.glyphs){const N=T.glyphs[+P];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const F=N.metrics.localGlyph?Qv:1,V={x:0,y:0,w:N.bitmap.width+2*F,h:N.bitmap.height+2*F};c.push(V),S[P]=V}}const{w:p,h:g}=ah(c),v=new Pc({width:p||1,height:g||1});for(const w in i){const T=i[w];for(const S in T.glyphs){const P=T.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const N=s[w][S],F=P.metrics.localGlyph?Qv:1;Pc.copy(P.bitmap,v,{x:0,y:0},{x:N.x+F,y:N.y+F},P.bitmap)}}this.image=v,this.positions=s}}Qt(e0,"GlyphAtlas");class WE{constructor(i){this.tileID=new Jo(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=du(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,s,c,p,g){this.status="parsing",this.data=i,this.collisionBoxArray=new Ii;const v=new Cd(Object.keys(i.layers).sort()),w=new Jv(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},S=new w_(256,256),P={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},N=s.familiesBySource[this.source];for(const ye in N){const _e=i.layers[ye];if(!_e)continue;let Ze=!1,He=!1;for(const Ke of N[ye])"symbol"===Ke[0].type?Ze=!0:He=!0;if(!0===this.isSymbolTile&&!Ze||!1===this.isSymbolTile&&!He)continue;1===_e.version&&Ji(`Vector tile source "${this.source}" layer "${ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=v.encode(ye),wt=[];for(let Ke=0;Ke<_e.length;Ke++){const ht=_e.feature(Ke),ct=w.getId(ht,ye);wt.push({feature:ht,id:ct,index:Ke,sourceLayerIndex:st})}for(const Ke of N[ye]){const ht=Ke[0];void 0!==this.isSymbolTile&&"symbol"===ht.type!==this.isSymbolTile||ht.minzoom&&this.zoom<Math.floor(ht.minzoom)||ht.maxzoom&&this.zoom>=ht.maxzoom||"none"!==ht.visibility&&(Tm(Ke,this.zoom,c),(T[ht.id]=ht.createBucket({index:w.bucketLayerIDs.length,layers:Ke,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(wt,P,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(Ke.map(ct=>ct.id)))}}let F,V,j,q;S.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=()=>{if(F)return g(F);if(V&&j&&q){const ye=new e0(V),_e=new bb(j,q);for(const Ze in T){const He=T[Ze];He instanceof gu?(Tm(He.layers,this.zoom,c),i_(He,V,ye.positions,j,_e.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):He.hasPattern&&(He instanceof Tf||He instanceof Xp||He instanceof eh)&&(Tm(He.layers,this.zoom,c),He.addFeatures(P,this.tileID.canonical,_e.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:In(T).filter(Ze=>!Ze.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ye.image,lineAtlas:S,imageAtlas:_e,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?ye.positions:null})}},ge=ln(P.glyphDependencies,ye=>Object.keys(ye).map(Number));Object.keys(ge).length?p.send("getGlyphs",{uid:this.uid,stacks:ge},(ye,_e)=>{F||(F=ye,V=_e,se())},void 0,!1,J):V={};const ae=Object.keys(P.iconDependencies);ae.length?p.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ye,_e)=>{F||(F=ye,j=_e,se())},void 0,!1,J):j={};const de=Object.keys(P.patternDependencies);de.length?p.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(ye,_e)=>{F||(F=ye,q=_e,se())},void 0,!1,J):q={},se()}}function Tm(o,i,s){const c=new R(i);for(const p of o)p.recalculate(c,s)}class E_{constructor(i){this.entries={},this.scheduler=i}request(i,s,c,p){const g=this.entries[i]=this.entries[i]||{callbacks:[]};if(g.result){const[v,w]=g.result;return this.scheduler?this.scheduler.add(()=>{p(v,w)},s):p(v,w),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((v,w)=>{g.result=[v,w];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(v,w)},s):T(v,w);setTimeout(()=>delete this.entries[i],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(v=>v!==p),g.callbacks.length||(g.cancel(),delete this.entries[i]))}}}function Rs(o,i,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},p=>{const g=Qa(o.request,(v,w,T,S)=>{v?p(v):w&&p(null,{vectorTile:s?void 0:new Yp(new sm(w)),rawData:w,cacheControl:T,expires:S})});return()=>{g.cancel(),p()}},i)}const C_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class t0{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(i,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(1!==p)throw new Error(`Got v${p} data when expected v1.`);const g=C_[15&c];if(!g)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new t0(w,v,g,i)}constructor(i,s=64,c=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const g=C_.indexOf(this.ArrayType),v=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=i,this.coords[this._pos++]=s,c}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return qf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:w}=this,T=[0,g.length-1,0],S=[];for(;T.length;){const P=T.pop()||0,N=T.pop()||0,F=T.pop()||0;if(N-F<=w){for(let J=F;J<=N;J++){const se=v[2*J],ge=v[2*J+1];se>=i&&se<=c&&ge>=s&&ge<=p&&S.push(g[J])}continue}const V=F+N>>1,j=v[2*V],q=v[2*V+1];j>=i&&j<=c&&q>=s&&q<=p&&S.push(g[V]),(0===P?i<=j:s<=q)&&(T.push(F),T.push(V-1),T.push(1-P)),(0===P?c>=j:p>=q)&&(T.push(V+1),T.push(N),T.push(1-P))}return S}within(i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],T=[],S=c*c;for(;w.length;){const P=w.pop()||0,N=w.pop()||0,F=w.pop()||0;if(N-F<=v){for(let J=F;J<=N;J++)Ub(g[2*J],g[2*J+1],i,s)<=S&&T.push(p[J]);continue}const V=F+N>>1,j=g[2*V],q=g[2*V+1];Ub(j,q,i,s)<=S&&T.push(p[V]),(0===P?i-c<=j:s-c<=q)&&(w.push(F),w.push(V-1),w.push(1-P)),(0===P?i+c>=j:s+c>=q)&&(w.push(V+1),w.push(N),w.push(1-P))}return T}}function qf(o,i,s,c,p,g){if(p-c<=s)return;const v=c+p>>1;tc(o,i,v,c,p,g),qf(o,i,s,c,v-1,1-g),qf(o,i,s,v+1,p,1-g)}function tc(o,i,s,c,p,g){for(;p>c;){if(p-c>600){const S=p-c+1,P=s-c+1,N=Math.log(S),F=.5*Math.exp(2*N/3),V=.5*Math.sqrt(N*F*(S-F)/S)*(P-S/2<0?-1:1);tc(o,i,s,Math.max(c,Math.floor(s-P*F/S+V)),Math.min(p,Math.floor(s+(S-P)*F/S+V)),g)}const v=i[2*s+g];let w=c,T=p;for(_h(o,i,c,s),i[2*p+g]>v&&_h(o,i,c,p);w<T;){for(_h(o,i,w,T),w++,T--;i[2*w+g]<v;)w++;for(;i[2*T+g]>v;)T--}i[2*c+g]===v?_h(o,i,c,T):(T++,_h(o,i,T,p)),T<=s&&(c=T+1),s<=T&&(p=T-1)}}function _h(o,i,s,c){T_(o,s,c),T_(i,2*s,2*c),T_(i,2*s+1,2*c+1)}function T_(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}function Ub(o,i,s,c){const p=o-s,g=i-c;return p*p+g*g}u.ARRAY_TYPE=Ss,u.AUTH_ERR_MSG=xe,u.Aabb=uo,u.Actor=class{constructor(o,i,s){this.target=o,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},di(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=rs()?o:Q,this.scheduler=new m_}send(o,i,s,c,p=!1,g){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[v]=s);const w=Ml(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:o,hasCallback:!!s,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:$u(i,w)},w),{cancel:()=>{s&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const i=o.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(i.mustQueue||rs()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,i),c&&c.metadata||{type:"message"})}else this.processTask(s,i)}processTask(o,i){if("<response>"===i.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(i.error?s(iu(i.error)):s(null,iu(i.data)))}else{const s=Ml(this.globalScope)?void 0:[],c=i.hasCallback?(g,v)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?$u(g):null,data:$u(v,s)},s)}:g=>{},p=iu(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,c);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],p.source)[g[1]](p,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=nh,u.Color=cn,u.ColorMode=ec,u.CullFaceMode=wl,u.DEMData=Oc,u.DataConstantProperty=G,u.DedupedRequest=E_,u.DepthMode=Td,u.EXTENT=_n,u.Elevation=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const s=i.getSource().maxzoom,c=1<<s,p=Math.floor(o.x),g=Math.floor((o.x-p)*c),v=Math.floor(o.y*c),w=this.findDEMTileFor(new Jo(s,p,s,g,v));return!(!w||!w.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,s=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const c=this._source();if(!c||o.y<0||o.y>1)return i;const p=c.getSource().maxzoom,g=1<<p,v=Math.floor(o.x),w=o.x-v,T=new Jo(p,v,p,Math.floor(w*g),Math.floor(o.y*g)),S=this.findDEMTileFor(T);if(!S||!S.dem)return i;const P=S.dem,N=1<<S.tileID.canonical.z,F=(w*N-S.tileID.canonical.x)*P.dim,V=(o.y*N-S.tileID.canonical.y)*P.dim,j=Math.floor(F),q=Math.floor(V);return(s?this.exaggeration():1)*ci(ci(P.get(j,q),P.get(j,q+1),V-q),ci(P.get(j+1,q),P.get(j+1,q+1),V-q),F-j)}getAtTileOffset(o,i,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new df(o.wrap+(o.canonical.x+i/_n)/c,(o.canonical.y+s/_n)/c))}getAtTileOffsetFunc(o,i,s,c){return p=>{const g=this.getAtTileOffset(o,p.x,p.y),v=c.upVector(o.canonical,p.x,p.y);return ra(v,v,g*c.upVectorScale(o.canonical,i,s).metersToTile),v}}getForTilePoints(o,i,s,c){if(this.isUsingMockSource())return!1;const p=Cm.create(this,o,c);return!!p&&(i.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const s=i.dem.tree,c=i.tileID,p=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/p-c.canonical.x,v=o.canonical.y/p-c.canonical.y,w=0;for(let T=0;T<o.canonical.z-c.canonical.z&&!s.leaves[w];T++){g*=2,v*=2;const S=2*Math.floor(v)+Math.floor(g);w=s.childOffsets[w]+S,g%=1,v%=1}return{min:this.exaggeration()*s.minimums[w],max:this.exaggeration()*s.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=_o,u.EvaluationParameters=R,u.Event=Ta,u.Evented=Vs,u.FillExtrusionBucket=eh,u.Frustum=cf,u.FrustumCorners=Wy,u.GLOBE_RADIUS=ja,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=Qh,u.GLOBE_ZOOM_THRESHOLD_MIN=vg,u.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,i){const s=new Et,c=new Kt,p=[],g=o+1+2,v=i[0]+1,w=i[0]+1+(1+i.length),T=(S,P,N)=>{let F=S===g-1?S-2:0===S?S:S-1;return F+=N?24575:0,[F,P]};for(let S=0;S<g;++S)s.emplaceBack(...T(S,0,!0));for(let S=0;S<v;++S)for(let P=0;P<g;++P)s.emplaceBack(...T(P,S,(0===P||P===g-1)&&!0));for(let S=0;S<i.length;++S){const P=i[S];for(let N=0;N<g;++N)s.emplaceBack(...T(N,P,!0))}for(let S=0;S<i.length;++S){const P=c.length,N=i[S]+1+2,F=new Kt;for(let q=0;q<N-1;q++){const J=q===N-2,se=J?g*(w-i.length+S-q):g;for(let ge=0;ge<g-1;ge++){const ae=q*g+ge;0===q||J||0===ge||ge===g-2?(F.emplaceBack(ae+1,ae,ae+se),F.emplaceBack(ae+se,ae+se+1,ae+1)):(c.emplaceBack(ae+1,ae,ae+se),c.emplaceBack(ae+se,ae+se+1,ae+1))}}const V=ji.simpleSegment(0,P,s.length,c.length-P);for(let q=0;q<F.uint16.length;q+=3)c.emplaceBack(F.uint16[q],F.uint16[q+1],F.uint16[q+2]);const j=ji.simpleSegment(0,P,s.length,c.length-P);p.push({withoutSkirts:V,withSkirts:j})}return{vertices:s,indices:c,segments:p}}_createGrid(o){const i=this._fillGridMeshWithLods(64,td);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,lf.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new Kt;for(let p=0;p<=64;p++)i.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const s=new Si,c=new Si;this._poleSegments=[];for(let p=0,g=0;p<vg;p++){const v=360/(1<<p);s.emplaceBack(0,-ja,0,.5,0),c.emplaceBack(0,-ja,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,S=ci(0,v,T),[P,N,F]=nd($x,Qy,S,ja);s.emplaceBack(P,N,F,T,0),c.emplaceBack(P,N,F,T,1)}this._poleSegments.push(ji.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,jx,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,jx,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,i){if(!this._wireframeSegments){const s=new co,c=64,p=c+1+2,g=1;this._wireframeSegments=[];for(let v=0,w=0;v<td.length;v++){const T=td[v];for(let P=g;P<T+g;P++)for(let N=g;N<c+g;N++){const F=P*p+N;s.emplaceBack(F,F+1),s.emplaceBack(F,F+p),s.emplaceBack(F,F+p+1)}const S=T*c*3;this._wireframeSegments.push(ji.simpleSegment(0,w,(T+1)*p,S)),w+=S}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},u.GlyphManager=gd,u.ImagePosition=Nv,u.KDBush=t0,u.LivePerformanceUtils=Hd,u.LngLat=xi,u.LngLatBounds=ia,u.LocalGlyphMode=Rf,u.MAX_MERCATOR_LATITUDE=Bo,u.MercatorCoordinate=df,u.ONE_EM=fo,u.OverscaledTileID=Jo,u.PerformanceMarkers=Ea,u.Point=ze,u.Properties=ce,u.RGBAImage=As,u.Ray=Zy,u.RequestManager=class{constructor(o,i,s){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let s=0;s<10;s++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ot,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!Se(o))return o;const s=zt(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!Se(o))return o;const s=zt(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeSourceURL(o,i,s,c){if(!Se(o))return o;const p=zt(o);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),s&&p.params.push(`language=${s}`),c&&p.params.push(`worldview=${c}`),this._makeAPIURL(p,this._customAccessToken||i)}normalizeSpriteURL(o,i,s,c){const p=zt(o);return Se(o)?(p.path=`/styles/v1${p.path}/sprite${i}${s}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${i}${s}`,Ct(p))}normalizeTileURL(o,i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Se(o))return o;const c=zt(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||s&&"raster"!==c.authority&&512===s?"@2x":""}${Re.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${Ae.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Ae.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(g){for(const v of g){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(c.params)||Ae.ACCESS_TOKEN;return Ae.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(o,i){const s=zt(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Ae.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Ae.TILE_URL_VERSION}/`,"")}`;let p=s.params;return i&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(o,i){const s=!!i&&Se(i),c=[];for(const p of o.tiles||[])Ve(p)?c.push(this.canonicalizeTileURL(p,s)):c.push(p);return c}_makeAPIURL(o,i){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=zt(Ae.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const p=o.params.indexOf("secure");p>=0&&o.params.splice(p,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!Ae.REQUIRE_ACCESS_TOKEN)return Ct(o);if(i=i||Ae.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(p=>-1===p.indexOf("access_token")),o.params.push(`access_token=${i||""}`),Ct(o)}},u.ResourceType=Ja,u.SegmentVector=ji,u.SourceCache=Nc,u.StencilMode=Za,u.StructArrayLayout1ui2=Yo,u.StructArrayLayout2f1f2i16=wn,u.StructArrayLayout2i4=Et,u.StructArrayLayout2ui4=co,u.StructArrayLayout3f12=Jn,u.StructArrayLayout3ui6=Kt,u.StructArrayLayout4i8=ut,u.StructArrayLayout5f20=Si,u.Texture=_u,u.Tile=Hf,u.Transitionable=H,u.Uniform1f=Ep,u.Uniform1i=class extends wc{constructor(o){super(o),this.current=0}set(o,i,s){this.fetchUniformLocation(o,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},u.Uniform2f=class extends wc{constructor(o){super(o),this.current=[0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},u.Uniform3f=class extends wc{constructor(o){super(o),this.current=[0,0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},u.Uniform4f=zy,u.UniformColor=ug,u.UniformMatrix2f=class extends wc{constructor(o){super(o),this.current=Ux}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},u.UniformMatrix3f=class extends wc{constructor(o){super(o),this.current=Vx}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},u.UniformMatrix4f=class extends wc{constructor(o){super(o),this.current=Wh}set(o,i,s){if(this.fetchUniformLocation(o,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},u.UnwrappedTileID=Dv,u.ValidationError=ft,u.VectorTileFeature=Kp,u.VectorTileWorkerSource=class extends Vs{constructor(o,i,s,c,p){super(),this.actor=o,this.layerIndex=i,this.availableImages=s,this.loadVectorData=p||Rs,this.loading={},this.loaded={},this.deduped=new E_(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,i){const s=o.uid,c=o&&o.request,p=c&&c.collectResourceTiming,g=this.loading[s]=new WE(o);g.abort=this.loadVectorData(o,(v,w)=>{const T=!this.loading[s];if(delete this.loading[s],T||v||!w)return g.status="done",T||(this.loaded[s]=g),i(v);const S=w.rawData,P={};w.expires&&(P.expires=w.expires),w.cacheControl&&(P.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new Yp(new sm(S));const N=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,V)=>{if(F||!V)return i(F);const j={};if(p){const q=Ru(c);q.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(q)))}i(null,si({rawTileData:S.slice(0)},V,P,j))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,i){const s=this.loaded,c=o.uid,p=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=du(o.tileID.canonical,o.projection);const v=(w,T)=>{const S=g.reloadCallback;S&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,S)),i(w,T)};"parsing"===g.status?g.reloadCallback=v:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(o,i){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),i()}removeTile(o,i){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],i()}},u.WritingMode=Ga,u.ZoomDependentExpression=jl,u.add=Tc,u.addDynamicAttributes=_m,u.adjoint=function(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=i[4],w=i[5],T=i[6],S=i[7],P=i[8];return o[0]=v*P-w*S,o[1]=p*S-c*P,o[2]=c*w-p*v,o[3]=w*T-g*P,o[4]=s*P-p*T,o[5]=p*g-s*w,o[6]=g*S-v*T,o[7]=c*T-s*S,o[8]=s*v-c*g,o},u.asyncAll=dn,u.bezier=qr,u.bindAll=di,u.boundsAttributes=Wv,u.bufferConvexPolygon=function(o,i){const s=[];for(let c=0;c<o.length;c++){const p=rr(c-1,-1,o.length-1),g=rr(c+1,-1,o.length-1),v=o[c],w=o[g],T=o[p].sub(v).unit(),S=w.sub(v).unit(),P=S.angleWithSep(T.x,T.y),N=T.add(S).unit().mult(-1*i/Math.sin(P/2));s.push(v.add(N))}return s},u.cacheEntryPossiblyAdded=function(o){Il++,Il>Zc&&(o.getActor().send("enforceCacheSizeLimit",ac),Il=0)},u.calculateGlobeLabelMatrix=function(o,i){const{x:s,y:c}=o.point,p=Ky(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Ec(p,p,Zu(aa(i)))},u.calculateGlobeMatrix=function(o){const{x:i,y:s}=o.point,{lng:c,lat:p}=o._center;return Ky(i,s,o.worldSize,c,p)},u.calculateGlobeMercatorMatrix=function(o){const i=o.pixelsPerMeter,s=i/Xl(1,o.center.lat),c=ml(new Float64Array(16));return Yh(c,c,[o.point.x,o.point.y,0]),Cc(c,c,[s,s,i]),Float32Array.from(c)},u.circumferenceAtLatitude=Fp,u.clamp=Dn,u.clearTileCache=function(o){if(!va())return;const i=Q.caches.delete(Ya);o&&i.catch(o).then(()=>o())},u.clipLine=Vv,u.clone=function(o){var i=new Ss(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},u.clone$1=An,u.collisionCircleLayout=Gg,u.config=Ae,u.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},u.create=function(){var o=new Ss(16);return Ss!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},u.create$1=fg,u.createExpression=Na,u.createLayout=Pe,u.createStyleLayer=function(o){return"custom"===o.type?new ym(o):new p_[o.type](o)},u.cross=Mp,u.degToRad=kt,u.distance=function(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])},u.div=function(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o[2]=i[2]/s[2],o},u.dot=oa,u.earthRadius=su,u.ease=Er,u.easeCubicInOut=qi,u.ecefToLatLng=function([o,i,s]){const c=Math.hypot(o,i,s),p=Math.atan2(o,s),g=.5*Math.PI-Math.acos(-i/c);return new xi(Tn(p),Tn(g))},u.emitValidationErrors=pp,u.endsWith=pi,u.enforceCacheSizeLimit=function(o){xa(),io&&io.then(i=>{i.keys().then(s=>{for(let c=0;c<s.length-o;c++)i.delete(s[c])})})},u.evaluateSizeForFeature=Df,u.evaluateSizeForZoom=uu,u.evaluateVariableOffset=n_,u.evented=b,u.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},u.exactEquals$1=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},u.exported=Bs,u.exported$1=Re,u.extend=si,u.extend$1=os,u.fillExtrusionHeightLift=Fg,u.filterObject=is,u.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},u.fromQuat=function(o,i){var s=i[0],c=i[1],p=i[2],g=i[3],v=s+s,w=c+c,T=p+p,S=s*v,P=c*v,N=c*w,F=p*v,V=p*w,j=p*T,q=g*v,J=g*w,se=g*T;return o[0]=1-N-j,o[1]=P+se,o[2]=F-J,o[3]=0,o[4]=P-se,o[5]=1-S-j,o[6]=V+q,o[7]=0,o[8]=F+J,o[9]=V-q,o[10]=1-S-N,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},u.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},u.fromScaling=Tp,u.furthestTileCorner=function(o){const i=Math.round((o+45+360)%360/90)%4;return ki[i]},u.getAABBPointSquareDist=function(o,i,s){let c=0;for(let p=0;p<2;++p){const g=s?s[p]:0;o[p]>g&&(c+=(o[p]-g)*(o[p]-g)),i[p]<g&&(c+=(g-i[p])*(g-i[p]))}return c},u.getAnchorAlignment=um,u.getAnchorJustification=Of,u.getBounds=function(o){let i=1/0,s=1/0,c=-1/0,p=-1/0;for(const g of o)i=Math.min(i,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),p=Math.max(p,g.y);return{min:new ze(i,s),max:new ze(c,p)}},u.getColumn=ya,u.getDefaultExportFromCjs=he,u.getGridMatrix=function(o,i,s,c){const p=i.getNorth(),g=i.getSouth(),v=i.getWest(),w=i.getEast(),T=1<<o.z,S=w-v,P=p-g,N=S/64,F=-P/td[s],V=[0,N,0,F,0,0,p,v,0];if(o.z>0){const j=180/c;jy(V,V,[j/S+1,0,0,0,j/P+1,0,-.5*j/N,.5*j/F,1])}return V[2]=T,V[5]=o.x,V[8]=o.y,V},u.getImage=ue,u.getJSON=function(o,i){return ba(si(o,{type:"json"}),i)},u.getLatitudinalLod=function(o){const i=Bo-5;o=Dn(o,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(kt(o))),3);return Math.round(s*(td.length-1))},u.getMapSessionAPI=Lr,u.getPerformanceMeasurement=Ru,u.getProjection=u_,u.getRTLTextPluginStatus=E,u.getReferrer=ys,u.getTilePoint=function(o,{x:i,y:s},c=0){return new ze(((i-c)*o.scale-o.x)*_n,(s*o.scale-o.y)*_n)},u.getTileVec3=function(o,i,s=0){return Kh(((i.x-s)*o.scale-o.x)*_n,(i.y*o.scale-o.y)*_n,Hx(i.z,i.y))},u.getVideo=function(o,i){const s=Q.document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let c=0;c<o.length;c++){const p=Q.document.createElement("source");wa(o[c])||(s.crossOrigin="Anonymous"),p.src=o[c],s.appendChild(p)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(o){const i=[0,0,0],s=ml(new Float64Array(16));return Ec(s,o.pixelMatrix,o.globeMatrix),gr(i,i,s),new ze(i[0],i[1])},u.globeDenormalizeECEF=Zu,u.globeECEFOrigin=function(o,i){const s=[0,0,0];return gr(s,s,id(aa(i.canonical))),gr(s,s,o),s},u.globeMetersToEcef=Rp,u.globeNormalizeECEF=id,u.globePixelsToTileUnits=function(o,i){return _n/(512*Math.pow(2,o))*Op(aa(i))},u.globePoleMatrixForTile=function(o,i,s){const c=ml(new Float64Array(16)),p=(i/(1<<o)-.5)*Math.PI*2;return nf(c,s.globeMatrix,p),Float32Array.from(c)},u.globeTileBounds=aa,u.globeTiltAtLngLat=Jy,u.globeToMercatorTransition=ho,u.globeUseCustomAntiAliasing=function(o,i,s){const c=ho(s.zoom),p=o.style.map._antialias,g=!!i.extStandardDerivatives,v=i.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===c&&!p&&!v&&g},u.identity=ml,u.identity$1=qu,u.invert=tf,u.isFullscreen=function(){return!!Q.document.fullscreenElement||!!Q.document.webkitFullscreenElement},u.isLngLatBehindGlobe=xo,u.isMapAuthenticated=function(o){return Mr.has(o)},u.isMapboxURL=Se,u.isSafariWithAntialiasingBug=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!Ml(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=zo,u.latLngToECEF=Sc,u.len=Ip,u.length=Gu,u.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},u.lngFromMercatorX=ca,u.loadVectorTile=Rs,u.makeRequest=ba,u.mapValue=function(o,i,s,c,p){return Dn((o-i)/(s-i)*(p-c)+c,c,p)},u.mercatorScale=Gx,u.mercatorXfromLng=Ha,u.mercatorYfromLat=fs,u.mercatorZfromAltitude=Xl,u.mul=$y,u.mul$1=Sp,u.multiply=Ec,u.multiply$1=jy,u.multiply$2=ru,u.nextPowerOfTwo=Mn,u.normalize=Ko,u.normalize$1=NE,u.normalize$2=_g,u.number=ci,u.ortho=function(o,i,s,c,p,g,v){var w=1/(i-s),T=1/(c-p),S=1/(g-v);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(i+s)*w,o[13]=(p+c)*T,o[14]=(v+g)*S,o[15]=1,o},u.pbf=qg,u.perspective=function(o,i,s,c,p){var g,v=1/Math.tan(i/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=p&&p!==1/0?(o[10]=(p+c)*(g=1/(c-p)),o[14]=2*p*c*g):(o[10]=-1,o[14]=-2*c),o},u.pick=function(o,i){const s={};for(let c=0;c<i.length;c++){const p=i[c];p in o&&(s[p]=o[p])}return s},u.plugin=A,u.pointGeometry=ke,u.polesInViewport=function(o){const i=ml(new Float64Array(16));Ec(i,o.pixelMatrix,o.globeMatrix);const s=[0,sa,0],c=[0,$a,0];return gr(s,s,i),gr(c,c,i),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!xo(o,new xi(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!xo(o,new xi(o.center.lat,-90))]},u.polygonContainsPoint=au,u.polygonIntersectsBox=iv,u.polygonIntersectsPolygon=od,u.polygonizeBounds=function(o,i,s=0,c=!0){const p=new ze(s,s),g=o.sub(p),v=i.add(p),w=[g,new ze(v.x,g.y),v,new ze(g.x,v.y)];return c&&w.push(g.clone()),w},u.posAttributes=lf,u.postMapLoadEvent=pr,u.postPerformanceEvent=Cr,u.postTurnstileEvent=Bt,u.potpack=ah,u.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},u.radToDeg=Tn,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:a}),b.on("pluginStateChange",o),o},u.removeAuthState=function(o){Mr.delete(o)},u.renderColorRamp=Ku,u.resample=Xu,u.rotateX=pg,u.rotateX$1=Jh,u.rotateY=nf,u.rotateY$1=Gy,u.rotateZ=function(o,i,s){var c=Math.sin(s),p=Math.cos(s),g=i[0],v=i[1],w=i[2],T=i[3],S=i[4],P=i[5],N=i[6],F=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=g*p+S*c,o[1]=v*p+P*c,o[2]=w*p+N*c,o[3]=T*p+F*c,o[4]=S*p-g*c,o[5]=P*p-v*c,o[6]=N*p-w*c,o[7]=F*p-T*c,o},u.rotateZ$1=function(o,i,s){s*=.5;var c=i[0],p=i[1],g=i[2],v=i[3],w=Math.sin(s),T=Math.cos(s);return o[0]=c*T+p*w,o[1]=p*T-c*w,o[2]=g*T+v*w,o[3]=v*T-g*w,o},u.scale=Cc,u.scale$1=Ap,u.scale$2=ra,u.scaleAndAdd=sf,u.set=function(o,i,s,c){return o[0]=i,o[1]=s,o[2]=c,o},u.setCacheLimits=function(o,i){ac=o,Zc=i},u.setColumn=function(o,i,s){o[4*i+0]=s[0],o[4*i+1]=s[1],o[4*i+2]=s[2],o[4*i+3]=s[3]},u.setRTLTextPlugin=function(o,i,s=!1){if(m===vp||m===pl||m===za)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=Bs.resolveURL(o),m=vp,Hu=i,_(),s||I()},u.smoothstep=En,u.spec=it,u.squaredLength=function(o){var i=o[0],s=o[1],c=o[2];return i*i+s*s+c*c},u.storeAuthState=function(o,i){i?Mr.add(o):Mr.delete(o)},u.sub=Is,u.subtract=Fo,u.symbolSize=im,u.tileAABB=function(o,i,s,c,p,g,v,w,T){if("globe"===T.name)return function Yy(o,i,s){const c=i/o.worldSize,p=o.globeMatrix;if(s.z<=1){const He=aa(s).getCorners();return bg(He,p,c),uo.fromPoints(He)}const g=hf(s),v=kp(g);bg(v,p,c);const w=Number.MAX_VALUE,T=[-w,-w,-w],S=[w,w,w];if(g.contains(o.center)){for(const wt of v)mr(S,S,wt),rf(T,T,wt);T[2]=0;const He=o.point,st=[He.x*c,He.y*c,0];return mr(S,S,st),rf(T,T,st),new uo(S,T)}const P=[p[12]*c,p[13]*c,p[14]*c],N=g.getCenter(),F=Dn(o.center.lat,-Bo,Bo),V=Dn(N.lat,-Bo,Bo),j=Ha(o.center.lng),q=fs(F);let J=j-Ha(N.lng);const se=q-fs(V);J>.5?J-=1:J<-.5&&(J+=1);let ge=0;Math.abs(J)>Math.abs(se)?ge=J>=0?1:3:(ge=se>=0?0:2,sf(P,P,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(kt(se>=0?g.getSouth():g.getNorth()))*ja));const ae=v[ge],de=v[(ge+1)%4],ye=new xg(ae,de,P),_e=[Lp(ye,0)||ae[0],Lp(ye,1)||ae[1],Lp(ye,2)||ae[2]],Ze=ho(o.zoom);if(Ze>0){const He=function({x:wt,y:Ke,z:ht},ct,_t,Pt,rt){const $t=1/(1<<ht);let nn=wt*$t,Ht=nn+$t,Bn=Ke*$t,Lt=Bn+$t,yn=0;const Vn=(nn+Ht)/2-Pt;return Vn>.5?yn=-1:Vn<-.5&&(yn=1),nn=((nn+yn)*ct-(Pt*=ct))*_t+Pt,Ht=((Ht+yn)*ct-Pt)*_t+Pt,Bn=(Bn*ct-(rt*=ct))*_t+rt,Lt=(Lt*ct-rt)*_t+rt,[[nn,Lt,0],[Ht,Lt,0],[Ht,Bn,0],[nn,Bn,0]]}(s,i,o._pixelsPerMercatorPixel,j,q);for(let wt=0;wt<v.length;wt++)Mc(v[wt],He[wt],Ze);const st=Tc([],He[ge],He[(ge+1)%4]);ra(st,st,.5),Mc(_e,st,Ze)}for(const He of v)mr(S,S,He),rf(T,T,He);return S[2]=Math.min(ae[2],de[2]),mr(S,S,_e),rf(T,T,_e),new uo(S,T)}(o,i,new nh(s,c,p));const S=du({z:s,x:c,y:p},T);return new uo([(g+S.x/S.scale)*i,i*(S.y/S.scale),v],[(g+S.x2/S.scale)*i,i*(S.y2/S.scale),w])},u.tileCornersToBounds=hf,u.tileTransform=du,u.transformMat3=function(o,i,s){var c=i[0],p=i[1],g=i[2];return o[0]=c*s[0]+p*s[3]+g*s[6],o[1]=c*s[1]+p*s[4]+g*s[7],o[2]=c*s[2]+p*s[5]+g*s[8],o},u.transformMat4=gr,u.transformMat4$1=ou,u.transformQuat=Dc,u.transitionTileAABBinECEF=Xy,u.translate=Yh,u.transpose=function(o,i){if(o===i){var s=i[1],c=i[2],p=i[5];o[1]=i[3],o[2]=i[6],o[3]=s,o[5]=i[7],o[6]=c,o[7]=p}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},u.triggerPluginCompletionEvent=f,u.uniqueId=Oi,u.updateGlobeVertexNormal=function(o,i,s,c,p){const g=5*i+2;o.float32[g+0]=s,o.float32[g+1]=c,o.float32[g+2]=p},u.validateCustomStyleLayer=function(o){const i=[],s=o.id;return void 0===s&&i.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},u.validateFilter=o=>Ds(ea(o)),u.validateFog=o=>Ds(No(o)),u.validateLayer=o=>Ds($l(o)),u.validateLight=o=>Ds(zr(o)),u.validateSource=o=>Ds(dl(o)),u.validateStyle=ju,u.validateTerrain=o=>Ds(Hh(o)),u.values=In,u.vectorTile=yf,u.version=Ie,u.warnOnce=Ji,u.window=Q,u.wrap=rr}),Ue(0,function(u){function Q(fe){if("number"==typeof fe||"boolean"==typeof fe||"string"==typeof fe||null==fe)return JSON.stringify(fe);if(Array.isArray(fe)){let Y="[";for(const ue of fe)Y+=`${Q(ue)},`;return`${Y}]`}let Z="{";for(const Y of Object.keys(fe).sort())Z+=`${Y}:${Q(fe[Y])},`;return`${Z}}`}function Ie(fe){let Z="";for(const Y of u.refProperties)Z+=`/${Q(fe[Y])}`;return Z}class Le{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Y){for(const xe of Z)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=u.createStyleLayer(xe)).compileFilter(),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of Y)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ue=function(xe,Se){const Ve={};for(let De=0;De<xe.length;De++){const Je=Se&&Se[xe[De].id]||Ie(xe[De]);Se&&(Se[xe[De].id]=Je);let Rt=Ve[Je];Rt||(Rt=Ve[Je]=[]),Rt.push(xe[De])}const Be=[];for(const De in Ve)Be.push(Ve[De]);return Be}(u.values(this._layerConfigs),this.keyCache);for(const xe of ue){const Se=xe.map(zt=>this._layers[zt.id]),Ve=Se[0];if("none"===Ve.visibility)continue;const Be=Ve.source||"";let De=this.familiesBySource[Be];De||(De=this.familiesBySource[Be]={});const Je=Ve.sourceLayer||"_geojsonTileLayer";let Rt=De[Je];Rt||(Rt=De[Je]=[]),Rt.push(Se)}}}class Ae{loadTile(Z,Y){const{uid:ue,encoding:xe,rawImageData:Se,padding:Ve,buildQuadTree:Be}=Z,De=u.window.ImageBitmap&&Se instanceof u.window.ImageBitmap?this.getImageData(Se,Ve):Se;Y(null,new u.DEMData(ue,De,xe,Ve<1,Be))}getImageData(Z,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ue=this.offscreenCanvasContext.getImageData(-Y,-Y,Z.width+2*Y,Z.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}function Re(fe,Z){if(0!==fe.length){yt(fe[0],Z);for(var Y=1;Y<fe.length;Y++)yt(fe[Y],!Z)}}function yt(fe,Z){for(var Y=0,ue=0,xe=0,Se=fe.length,Ve=Se-1;xe<Se;Ve=xe++){var Be=(fe[xe][0]-fe[Ve][0])*(fe[Ve][1]+fe[xe][1]),De=Y+Be;ue+=Math.abs(Y)>=Math.abs(Be)?Y-De+Be:Be-De+Y,Y=De}Y+ue>=0!=!!Z&&fe.reverse()}var Yt=u.getDefaultExportFromCjs(function fe(Z,Y){var ue,xe=Z&&Z.type;if("FeatureCollection"===xe)for(ue=0;ue<Z.features.length;ue++)fe(Z.features[ue],Y);else if("GeometryCollection"===xe)for(ue=0;ue<Z.geometries.length;ue++)fe(Z.geometries[ue],Y);else if("Feature"===xe)fe(Z.geometry,Y);else if("Polygon"===xe)Re(Z.coordinates,Y);else if("MultiPolygon"===xe)for(ue=0;ue<Z.coordinates.length;ue++)Re(Z.coordinates[ue],Y);return Z});const Vt=u.VectorTileFeature.prototype.toGeoJSON;var St={exports:{}},Ft=u.pointGeometry,Ot=u.vectorTile.VectorTileFeature,he=tt;function tt(fe,Z){this.options=Z||{},this.features=fe,this.length=fe.length}function bt(fe,Z){this.id="number"==typeof fe.id?fe.id:void 0,this.type=fe.type,this.rawGeometry=1===fe.type?[fe.geometry]:fe.geometry,this.properties=fe.tags,this.extent=Z||4096}tt.prototype.feature=function(fe){return new bt(this.features[fe],this.options.extent)},bt.prototype.loadGeometry=function(){var fe=this.rawGeometry;this.geometry=[];for(var Z=0;Z<fe.length;Z++){for(var Y=fe[Z],ue=[],xe=0;xe<Y.length;xe++)ue.push(new Ft(Y[xe][0],Y[xe][1]));this.geometry.push(ue)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var fe=this.geometry,Z=1/0,Y=-1/0,ue=1/0,xe=-1/0,Se=0;Se<fe.length;Se++)for(var Ve=fe[Se],Be=0;Be<Ve.length;Be++){var De=Ve[Be];Z=Math.min(Z,De.x),Y=Math.max(Y,De.x),ue=Math.min(ue,De.y),xe=Math.max(xe,De.y)}return[Z,ue,Y,xe]},bt.prototype.toGeoJSON=Ot.prototype.toGeoJSON;var Ge=u.pbf,ke=he;function at(fe){var Z=new Ge;return function(Y,ue){for(var xe in Y.layers)ue.writeMessage(3,ze,Y.layers[xe])}(fe,Z),Z.finish()}function ze(fe,Z){var Y;Z.writeVarintField(15,fe.version||1),Z.writeStringField(1,fe.name||""),Z.writeVarintField(5,fe.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<fe.length;Y++)ue.feature=fe.feature(Y),Z.writeMessage(2,Nt,ue);var xe=ue.keys;for(Y=0;Y<xe.length;Y++)Z.writeStringField(3,xe[Y]);var Se=ue.values;for(Y=0;Y<Se.length;Y++)Z.writeMessage(4,qi,Se[Y])}function Nt(fe,Z){var Y=fe.feature;void 0!==Y.id&&Z.writeVarintField(1,Y.id),Z.writeMessage(2,Wt,fe),Z.writeVarintField(3,Y.type),Z.writeMessage(4,ki,Y)}function Wt(fe,Z){var Y=fe.feature,ue=fe.keys,xe=fe.values,Se=fe.keycache,Ve=fe.valuecache;for(var Be in Y.properties){var De=Y.properties[Be],Je=Se[Be];if(null!==De){void 0===Je&&(ue.push(Be),Se[Be]=Je=ue.length-1),Z.writeVarint(Je);var Rt=typeof De;"string"!==Rt&&"boolean"!==Rt&&"number"!==Rt&&(De=JSON.stringify(De));var zt=Rt+":"+De,Ct=Ve[zt];void 0===Ct&&(xe.push(De),Ve[zt]=Ct=xe.length-1),Z.writeVarint(Ct)}}}function kt(fe,Z){return(Z<<3)+(7&fe)}function Tn(fe){return fe<<1^fe>>31}function ki(fe,Z){for(var Y=fe.loadGeometry(),ue=fe.type,xe=0,Se=0,Ve=Y.length,Be=0;Be<Ve;Be++){var De=Y[Be],Je=1;1===ue&&(Je=De.length),Z.writeVarint(kt(1,Je));for(var Rt=3===ue?De.length-1:De.length,zt=0;zt<Rt;zt++){1===zt&&1!==ue&&Z.writeVarint(kt(2,Rt-1));var Ct=De[zt].x-xe,kn=De[zt].y-Se;Z.writeVarint(Tn(Ct)),Z.writeVarint(Tn(kn)),xe+=Ct,Se+=kn}3===ue&&Z.writeVarint(kt(7,1))}}function qi(fe,Z){var Y=typeof fe;"string"===Y?Z.writeStringField(1,fe):"boolean"===Y?Z.writeBooleanField(7,fe):"number"===Y&&(fe%1!=0?Z.writeDoubleField(3,fe):fe<0?Z.writeSVarintField(6,fe):Z.writeVarintField(5,fe))}St.exports=at,St.exports.fromVectorTileJs=at,St.exports.fromGeojsonVt=function(fe,Z){Z=Z||{};var Y={};for(var ue in fe)Y[ue]=new ke(fe[ue].features,Z),Y[ue].name=ue,Y[ue].version=Z.version,Y[ue].extent=Z.extent;return at({layers:Y})},St.exports.GeoJSONWrapper=ke;var qr=u.getDefaultExportFromCjs(St.exports);const Er={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},Dn=Math.fround||(En=new Float32Array(1),fe=>(En[0]=+fe,En[0]));var En;const rr=3,dn=5,In=6;class si{constructor(Z){this.options=Object.assign(Object.create(Er),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Y,minZoom:ue,maxZoom:xe}=this.options;Y&&console.time("total time");const Se=`prepare ${Z.length} points`;Y&&console.time(Se),this.points=Z;const Ve=[];for(let De=0;De<Z.length;De++){const Je=Z[De];if(!Je.geometry)continue;const[Rt,zt]=Je.geometry.coordinates,Ct=Dn(li(Rt)),kn=Dn(Mn(zt));Ve.push(Ct,kn,1/0,De,-1,1),this.options.reduce&&Ve.push(0)}let Be=this.trees[xe+1]=this._createTree(Ve);Y&&console.timeEnd(Se);for(let De=xe;De>=ue;De--){const Je=+Date.now();Be=this.trees[De]=this._createTree(this._cluster(Be,De)),Y&&console.log("z%d: %d clusters in %dms",De,Be.numItems,+Date.now()-Je)}return Y&&console.timeEnd("total time"),this}getClusters(Z,Y){let ue=((Z[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Z[1]));let Se=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ue=-180,Se=180;else if(ue>Se){const zt=this.getClusters([ue,xe,180,Ve],Y),Ct=this.getClusters([-180,xe,Se,Ve],Y);return zt.concat(Ct)}const Be=this.trees[this._limitZoom(Y)],De=Be.range(li(ue),Mn(Ve),li(Se),Mn(xe)),Je=Be.data,Rt=[];for(const zt of De){const Ct=this.stride*zt;Rt.push(Je[Ct+dn]>1?Zi(Je,Ct,this.clusterProps):this.points[Je[Ct+rr]])}return Rt}getChildren(Z){const Y=this._getOriginId(Z),ue=this._getOriginZoom(Z),xe="No cluster with the specified id.",Se=this.trees[ue];if(!Se)throw new Error(xe);const Ve=Se.data;if(Y*this.stride>=Ve.length)throw new Error(xe);const Be=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),De=Se.within(Ve[Y*this.stride],Ve[Y*this.stride+1],Be),Je=[];for(const Rt of De){const zt=Rt*this.stride;Ve[zt+4]===Z&&Je.push(Ve[zt+dn]>1?Zi(Ve,zt,this.clusterProps):this.points[Ve[zt+rr]])}if(0===Je.length)throw new Error(xe);return Je}getLeaves(Z,Y,ue){const xe=[];return this._appendLeaves(xe,Z,Y=Y||10,ue=ue||0,0),xe}getTile(Z,Y,ue){const xe=this.trees[this._limitZoom(Z)],Se=Math.pow(2,Z),{extent:Ve,radius:Be}=this.options,De=Be/Ve,Je=(ue-De)/Se,Rt=(ue+1+De)/Se,zt={features:[]};return this._addTileFeatures(xe.range((Y-De)/Se,Je,(Y+1+De)/Se,Rt),xe.data,Y,ue,Se,zt),0===Y&&this._addTileFeatures(xe.range(1-De/Se,Je,1,Rt),xe.data,Se,ue,Se,zt),Y===Se-1&&this._addTileFeatures(xe.range(0,Je,De/Se,Rt),xe.data,-1,ue,Se,zt),zt.features.length?zt:null}getClusterExpansionZoom(Z){let Y=this._getOriginZoom(Z)-1;for(;Y<=this.options.maxZoom;){const ue=this.getChildren(Z);if(Y++,1!==ue.length)break;Z=ue[0].properties.cluster_id}return Y}_appendLeaves(Z,Y,ue,xe,Se){const Ve=this.getChildren(Y);for(const Be of Ve){const De=Be.properties;if(De&&De.cluster?Se+De.point_count<=xe?Se+=De.point_count:Se=this._appendLeaves(Z,De.cluster_id,ue,xe,Se):Se<xe?Se++:Z.push(Be),Z.length===ue)break}return Se}_createTree(Z){const Y=new u.KDBush(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<Z.length;ue+=this.stride)Y.add(Z[ue],Z[ue+1]);return Y.finish(),Y.data=Z,Y}_addTileFeatures(Z,Y,ue,xe,Se,Ve){for(const Be of Z){const De=Be*this.stride,Je=Y[De+dn]>1;let Rt,zt,Ct;if(Je)Rt=Oi(Y,De,this.clusterProps),zt=Y[De],Ct=Y[De+1];else{const zn=this.points[Y[De+rr]];Rt=zn.properties;const[Sn,Bt]=zn.geometry.coordinates;zt=li(Sn),Ct=Mn(Bt)}const kn={type:1,geometry:[[Math.round(this.options.extent*(zt*Se-ue)),Math.round(this.options.extent*(Ct*Se-xe))]],tags:Rt};let Gn;Gn=Je||this.options.generateId?Y[De+rr]:this.points[Y[De+rr]].id,void 0!==Gn&&(kn.id=Gn),Ve.features.push(kn)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Y){const{radius:ue,extent:xe,reduce:Se,minPoints:Ve}=this.options,Be=ue/(xe*Math.pow(2,Y)),De=Z.data,Je=[],Rt=this.stride;for(let zt=0;zt<De.length;zt+=Rt){if(De[zt+2]<=Y)continue;De[zt+2]=Y;const Ct=De[zt],kn=De[zt+1],Gn=Z.within(De[zt],De[zt+1],Be),zn=De[zt+dn];let Sn=zn;for(const Bt of Gn){const Ui=Bt*Rt;De[Ui+2]>Y&&(Sn+=De[Ui+dn])}if(Sn>zn&&Sn>=Ve){let Bt,Ui=Ct*zn,pr=kn*zn,Mi=-1;const Cr=((zt/Rt|0)<<5)+(Y+1)+this.points.length;for(const jo of Gn){const Lr=jo*Rt;if(De[Lr+2]<=Y)continue;De[Lr+2]=Y;const Mr=De[Lr+dn];Ui+=De[Lr]*Mr,pr+=De[Lr+1]*Mr,De[Lr+4]=Cr,Se&&(Bt||(Bt=this._map(De,zt,!0),Mi=this.clusterProps.length,this.clusterProps.push(Bt)),Se(Bt,this._map(De,Lr)))}De[zt+4]=Cr,Je.push(Ui/Sn,pr/Sn,1/0,Cr,-1,Sn),Se&&Je.push(Mi)}else{for(let Bt=0;Bt<Rt;Bt++)Je.push(De[zt+Bt]);if(Sn>1)for(const Bt of Gn){const Ui=Bt*Rt;if(!(De[Ui+2]<=Y)){De[Ui+2]=Y;for(let pr=0;pr<Rt;pr++)Je.push(De[Ui+pr])}}}}return Je}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Y,ue){if(Z[Y+dn]>1){const Ve=this.clusterProps[Z[Y+In]];return ue?Object.assign({},Ve):Ve}const xe=this.points[Z[Y+rr]].properties,Se=this.options.map(xe);return ue&&Se===xe?Object.assign({},Se):Se}}function Zi(fe,Z,Y){return{type:"Feature",id:fe[Z+rr],properties:Oi(fe,Z,Y),geometry:{type:"Point",coordinates:[(ue=fe[Z],360*(ue-.5)),Zr(fe[Z+1])]}};var ue}function Oi(fe,Z,Y){const ue=fe[Z+dn],xe=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,Se=fe[Z+In],Ve=-1===Se?{}:Object.assign({},Y[Se]);return Object.assign(Ve,{cluster:!0,cluster_id:fe[Z+rr],point_count:ue,point_count_abbreviated:xe})}function li(fe){return fe/360+.5}function Mn(fe){const Z=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function Zr(fe){const Z=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function di(fe,Z,Y,ue){for(var xe,Se=ue,Ve=Y-Z>>1,Be=Y-Z,De=fe[Z],Je=fe[Z+1],Rt=fe[Y],zt=fe[Y+1],Ct=Z+3;Ct<Y;Ct+=3){var kn=pi(fe[Ct],fe[Ct+1],De,Je,Rt,zt);if(kn>Se)xe=Ct,Se=kn;else if(kn===Se){var Gn=Math.abs(Ct-Ve);Gn<Be&&(xe=Ct,Be=Gn)}}Se>ue&&(xe-Z>3&&di(fe,Z,xe,ue),fe[xe+2]=Se,Y-xe>3&&di(fe,xe,Y,ue))}function pi(fe,Z,Y,ue,xe,Se){var Ve=xe-Y,Be=Se-ue;if(0!==Ve||0!==Be){var De=((fe-Y)*Ve+(Z-ue)*Be)/(Ve*Ve+Be*Be);De>1?(Y=xe,ue=Se):De>0&&(Y+=Ve*De,ue+=Be*De)}return(Ve=fe-Y)*Ve+(Be=Z-ue)*Be}function ln(fe,Z,Y,ue){var xe={id:void 0===fe?null:fe,type:Z,geometry:Y,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Se){var Ve=Se.geometry,Be=Se.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)is(Se,Ve);else if("Polygon"===Be||"MultiLineString"===Be)for(var De=0;De<Ve.length;De++)is(Se,Ve[De]);else if("MultiPolygon"===Be)for(De=0;De<Ve.length;De++)for(var Je=0;Je<Ve[De].length;Je++)is(Se,Ve[De][Je])}(xe),xe}function is(fe,Z){for(var Y=0;Y<Z.length;Y+=3)fe.minX=Math.min(fe.minX,Z[Y]),fe.minY=Math.min(fe.minY,Z[Y+1]),fe.maxX=Math.max(fe.maxX,Z[Y]),fe.maxY=Math.max(fe.maxY,Z[Y+1])}function An(fe,Z,Y,ue){if(Z.geometry){var xe=Z.geometry.coordinates,Se=Z.geometry.type,Ve=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),Be=[],De=Z.id;if(Y.promoteId?De=Z.properties[Y.promoteId]:Y.generateId&&(De=ue||0),"Point"===Se)Ns(xe,Be);else if("MultiPoint"===Se)for(var Je=0;Je<xe.length;Je++)Ns(xe[Je],Be);else if("LineString"===Se)Ji(xe,Be,Ve,!1);else if("MultiLineString"===Se){if(Y.lineMetrics){for(Je=0;Je<xe.length;Je++)Ji(xe[Je],Be=[],Ve,!1),fe.push(ln(De,"LineString",Be,Z.properties));return}go(xe,Be,Ve,!1)}else if("Polygon"===Se)go(xe,Be,Ve,!0);else{if("MultiPolygon"!==Se){if("GeometryCollection"===Se){for(Je=0;Je<Z.geometry.geometries.length;Je++)An(fe,{id:De,geometry:Z.geometry.geometries[Je],properties:Z.properties},Y,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Je=0;Je<xe.length;Je++){var Rt=[];go(xe[Je],Rt,Ve,!0),Be.push(Rt)}}fe.push(ln(De,Se,Be,Z.properties))}}function Ns(fe,Z){Z.push(sc(fe[0])),Z.push(rs(fe[1])),Z.push(0)}function Ji(fe,Z,Y,ue){for(var xe,Se,Ve=0,Be=0;Be<fe.length;Be++){var De=sc(fe[Be][0]),Je=rs(fe[Be][1]);Z.push(De),Z.push(Je),Z.push(0),Be>0&&(Ve+=ue?(xe*Je-De*Se)/2:Math.sqrt(Math.pow(De-xe,2)+Math.pow(Je-Se,2))),xe=De,Se=Je}var Rt=Z.length-3;Z[2]=1,di(Z,0,Rt,Y),Z[Rt+2]=1,Z.size=Math.abs(Ve),Z.start=0,Z.end=Z.size}function go(fe,Z,Y,ue){for(var xe=0;xe<fe.length;xe++){var Se=[];Ji(fe[xe],Se,Y,ue),Z.push(Se)}}function sc(fe){return fe/360+.5}function rs(fe){var Z=Math.sin(fe*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function no(fe,Z,Y,ue,xe,Se,Ve,Be){if(ue/=Z,Se>=(Y/=Z)&&Ve<ue)return fe;if(Ve<Y||Se>=ue)return null;for(var De=[],Je=0;Je<fe.length;Je++){var Rt=fe[Je],zt=Rt.geometry,Ct=Rt.type,kn=0===xe?Rt.minX:Rt.minY,Gn=0===xe?Rt.maxX:Rt.maxY;if(kn>=Y&&Gn<ue)De.push(Rt);else if(!(Gn<Y||kn>=ue)){var zn=[];if("Point"===Ct||"MultiPoint"===Ct)qc(zt,zn,Y,ue,xe);else if("LineString"===Ct)Ml(zt,zn,Y,ue,xe,!1,Be.lineMetrics);else if("MultiLineString"===Ct)ya(zt,zn,Y,ue,xe,!1);else if("Polygon"===Ct)ya(zt,zn,Y,ue,xe,!0);else if("MultiPolygon"===Ct)for(var Sn=0;Sn<zt.length;Sn++){var Bt=[];ya(zt[Sn],Bt,Y,ue,xe,!0),Bt.length&&zn.push(Bt)}if(zn.length){if(Be.lineMetrics&&"LineString"===Ct){for(Sn=0;Sn<zn.length;Sn++)De.push(ln(Rt.id,Ct,zn[Sn],Rt.tags));continue}"LineString"!==Ct&&"MultiLineString"!==Ct||(1===zn.length?(Ct="LineString",zn=zn[0]):Ct="MultiLineString"),"Point"!==Ct&&"MultiPoint"!==Ct||(Ct=3===zn.length?"Point":"MultiPoint"),De.push(ln(Rt.id,Ct,zn,Rt.tags))}}}return De.length?De:null}function qc(fe,Z,Y,ue,xe){for(var Se=0;Se<fe.length;Se+=3){var Ve=fe[Se+xe];Ve>=Y&&Ve<=ue&&(Z.push(fe[Se]),Z.push(fe[Se+1]),Z.push(fe[Se+2]))}}function Ml(fe,Z,Y,ue,xe,Se,Ve){for(var Be,De,Je=Sl(fe),Rt=0===xe?ac:Zc,zt=fe.start,Ct=0;Ct<fe.length-3;Ct+=3){var kn=fe[Ct],Gn=fe[Ct+1],zn=fe[Ct+2],Sn=fe[Ct+3],Bt=fe[Ct+4],Ui=0===xe?kn:Gn,pr=0===xe?Sn:Bt,Mi=!1;Ve&&(Be=Math.sqrt(Math.pow(kn-Sn,2)+Math.pow(Gn-Bt,2))),Ui<Y?pr>Y&&(De=Rt(Je,kn,Gn,Sn,Bt,Y),Ve&&(Je.start=zt+Be*De)):Ui>ue?pr<ue&&(De=Rt(Je,kn,Gn,Sn,Bt,ue),Ve&&(Je.start=zt+Be*De)):Ya(Je,kn,Gn,zn),pr<Y&&Ui>=Y&&(De=Rt(Je,kn,Gn,Sn,Bt,Y),Mi=!0),pr>ue&&Ui<=ue&&(De=Rt(Je,kn,Gn,Sn,Bt,ue),Mi=!0),!Se&&Mi&&(Ve&&(Je.end=zt+Be*De),Z.push(Je),Je=Sl(fe)),Ve&&(zt+=Be)}var Cr=fe.length-3;kn=fe[Cr],Gn=fe[Cr+1],zn=fe[Cr+2],(Ui=0===xe?kn:Gn)>=Y&&Ui<=ue&&Ya(Je,kn,Gn,zn),Cr=Je.length-3,Se&&Cr>=3&&(Je[Cr]!==Je[0]||Je[Cr+1]!==Je[1])&&Ya(Je,Je[0],Je[1],Je[2]),Je.length&&Z.push(Je)}function Sl(fe){var Z=[];return Z.size=fe.size,Z.start=fe.start,Z.end=fe.end,Z}function ya(fe,Z,Y,ue,xe,Se){for(var Ve=0;Ve<fe.length;Ve++)Ml(fe[Ve],Z,Y,ue,xe,Se,!1)}function Ya(fe,Z,Y,ue){fe.push(Z),fe.push(Y),fe.push(ue)}function ac(fe,Z,Y,ue,xe,Se){var Ve=(Se-Z)/(ue-Z);return fe.push(Se),fe.push(Y+(xe-Y)*Ve),fe.push(1),Ve}function Zc(fe,Z,Y,ue,xe,Se){var Ve=(Se-Y)/(xe-Y);return fe.push(Z+(ue-Z)*Ve),fe.push(Se),fe.push(1),Ve}function io(fe,Z){for(var Y=[],ue=0;ue<fe.length;ue++){var xe,Se=fe[ue],Ve=Se.type;if("Point"===Ve||"MultiPoint"===Ve||"LineString"===Ve)xe=Fs(Se.geometry,Z);else if("MultiLineString"===Ve||"Polygon"===Ve){xe=[];for(var Be=0;Be<Se.geometry.length;Be++)xe.push(Fs(Se.geometry[Be],Z))}else if("MultiPolygon"===Ve)for(xe=[],Be=0;Be<Se.geometry.length;Be++){for(var De=[],Je=0;Je<Se.geometry[Be].length;Je++)De.push(Fs(Se.geometry[Be][Je],Z));xe.push(De)}Y.push(ln(Se.id,Ve,xe,Se.tags))}return Y}function Fs(fe,Z){var Y=[];Y.size=fe.size,void 0!==fe.start&&(Y.start=fe.start,Y.end=fe.end);for(var ue=0;ue<fe.length;ue+=3)Y.push(fe[ue]+Z,fe[ue+1],fe[ue+2]);return Y}function va(fe,Z){if(fe.transformed)return fe;var Y,ue,xe,Se=1<<fe.z,Ve=fe.x,Be=fe.y;for(Y=0;Y<fe.features.length;Y++){var De=fe.features[Y],Je=De.geometry,Rt=De.type;if(De.geometry=[],1===Rt)for(ue=0;ue<Je.length;ue+=2)De.geometry.push(xa(Je[ue],Je[ue+1],Z,Se,Ve,Be));else for(ue=0;ue<Je.length;ue++){var zt=[];for(xe=0;xe<Je[ue].length;xe+=2)zt.push(xa(Je[ue][xe],Je[ue][xe+1],Z,Se,Ve,Be));De.geometry.push(zt)}}return fe.transformed=!0,fe}function xa(fe,Z,Y,ue,xe,Se){return[Math.round(Y*(fe*ue-xe)),Math.round(Y*(Z*ue-Se))]}function Ka(fe,Z,Y,ue,xe){for(var Se=Z===xe.maxZoom?0:xe.tolerance/((1<<Z)*xe.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ue,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<fe.length;Be++){Ve.numFeatures++,Il(Ve,fe[Be],Se,xe);var De=fe[Be].minX,Je=fe[Be].minY,Rt=fe[Be].maxX,zt=fe[Be].maxY;De<Ve.minX&&(Ve.minX=De),Je<Ve.minY&&(Ve.minY=Je),Rt>Ve.maxX&&(Ve.maxX=Rt),zt>Ve.maxY&&(Ve.maxY=zt)}return Ve}function Il(fe,Z,Y,ue){var xe=Z.geometry,Se=Z.type,Ve=[];if("Point"===Se||"MultiPoint"===Se)for(var Be=0;Be<xe.length;Be+=3)Ve.push(xe[Be]),Ve.push(xe[Be+1]),fe.numPoints++,fe.numSimplified++;else if("LineString"===Se)Ja(Ve,xe,fe,Y,!1,!1);else if("MultiLineString"===Se||"Polygon"===Se)for(Be=0;Be<xe.length;Be++)Ja(Ve,xe[Be],fe,Y,"Polygon"===Se,0===Be);else if("MultiPolygon"===Se)for(var De=0;De<xe.length;De++){var Je=xe[De];for(Be=0;Be<Je.length;Be++)Ja(Ve,Je[Be],fe,Y,!0,0===Be)}if(Ve.length){var Rt=Z.tags||null;if("LineString"===Se&&ue.lineMetrics){for(var zt in Rt={},Z.tags)Rt[zt]=Z.tags[zt];Rt.mapbox_clip_start=xe.start/xe.size,Rt.mapbox_clip_end=xe.end/xe.size}var Ct={geometry:Ve,type:"Polygon"===Se||"MultiPolygon"===Se?3:"LineString"===Se||"MultiLineString"===Se?2:1,tags:Rt};null!==Z.id&&(Ct.id=Z.id),fe.features.push(Ct)}}function Ja(fe,Z,Y,ue,xe,Se){var Ve=ue*ue;if(ue>0&&Z.size<(xe?Ve:ue))Y.numPoints+=Z.length/3;else{for(var Be=[],De=0;De<Z.length;De+=3)(0===ue||Z[De+2]>Ve)&&(Y.numSimplified++,Be.push(Z[De]),Be.push(Z[De+1])),Y.numPoints++;xe&&function(Je,Rt){for(var zt=0,Ct=0,kn=Je.length,Gn=kn-2;Ct<kn;Gn=Ct,Ct+=2)zt+=(Je[Ct]-Je[Gn])*(Je[Ct+1]+Je[Gn+1]);if(zt>0===Rt)for(Ct=0,kn=Je.length;Ct<kn/2;Ct+=2){var zn=Je[Ct],Sn=Je[Ct+1];Je[Ct]=Je[kn-2-Ct],Je[Ct+1]=Je[kn-1-Ct],Je[kn-2-Ct]=zn,Je[kn-1-Ct]=Sn}}(Be,Se),fe.push(Be)}}function ro(fe,Z){var Y=(Z=this.options=function(xe,Se){for(var Ve in Se)xe[Ve]=Se[Ve];return xe}(Object.create(this.options),Z)).debug;if(Y&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe,Se,Ve,Be,De,Je,ue=function(xe,Se){var Ve=[];if("FeatureCollection"===xe.type)for(var Be=0;Be<xe.features.length;Be++)An(Ve,xe.features[Be],Se,Be);else An(Ve,"Feature"===xe.type?xe:{geometry:xe},Se);return Ve}(fe,Z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Be=xe=ue,De=no(xe,1,-1-(Ve=(Se=Z).buffer/Se.extent),Ve,0,-1,2,Se),Je=no(xe,1,1-Ve,2+Ve,0,-1,2,Se),(De||Je)&&(Be=no(xe,1,-Ve,1+Ve,0,-1,2,Se)||[],De&&(Be=io(De,1).concat(Be)),Je&&(Be=Be.concat(io(Je,-1)))),(ue=Be).length&&this.splitTile(ue,0,0,0),Y&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ys(fe,Z,Y){return 32*((1<<fe)*Y+Z)+fe}function ba(fe,Z){const Y=fe.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ue=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ue)return Z(null,null);const xe=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(Be){this._feature=Be,this.extent=u.EXTENT,this.type=Be.type,this.properties=Be.tags,"id"in Be&&!isNaN(Be.id)&&(this.id=parseInt(Be.id,10))}loadGeometry(){if(1===this._feature.type){const Be=[];for(const De of this._feature.geometry)Be.push([new u.Point(De[0],De[1])]);return Be}{const Be=[];for(const De of this._feature.geometry){const Je=[];for(const Rt of De)Je.push(new u.Point(Rt[0],Rt[1]));Be.push(Je)}return Be}}toGeoJSON(Be,De,Je){return Vt.call(this,Be,De,Je)}}(this._features[Ve])}}(ue.features);let Se=qr(xe);0===Se.byteOffset&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),Z(null,{vectorTile:xe,rawData:Se.buffer})}ro.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ro.prototype.splitTile=function(fe,Z,Y,ue,xe,Se,Ve){for(var Be=[fe,Z,Y,ue],De=this.options,Je=De.debug;Be.length;){ue=Be.pop(),Y=Be.pop(),Z=Be.pop(),fe=Be.pop();var Rt=1<<Z,zt=ys(Z,Y,ue),Ct=this.tiles[zt];if(!Ct&&(Je>1&&console.time("creation"),Ct=this.tiles[zt]=Ka(fe,Z,Y,ue,De),this.tileCoords.push({z:Z,x:Y,y:ue}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Y,ue,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));var kn="z"+Z;this.stats[kn]=(this.stats[kn]||0)+1,this.total++}if(Ct.source=fe,xe){if(Z===De.maxZoom||Z===xe)continue;var Gn=1<<xe-Z;if(Y!==Math.floor(Se/Gn)||ue!==Math.floor(Ve/Gn))continue}else if(Z===De.indexMaxZoom||Ct.numPoints<=De.indexMaxPoints)continue;if(Ct.source=null,0!==fe.length){Je>1&&console.time("clipping");var zn,Sn,Bt,Ui,pr,Mi,Cr=.5*De.buffer/De.extent,jo=.5-Cr,Lr=.5+Cr,Mr=1+Cr;zn=Sn=Bt=Ui=null,pr=no(fe,Rt,Y-Cr,Y+Lr,0,Ct.minX,Ct.maxX,De),Mi=no(fe,Rt,Y+jo,Y+Mr,0,Ct.minX,Ct.maxX,De),fe=null,pr&&(zn=no(pr,Rt,ue-Cr,ue+Lr,1,Ct.minY,Ct.maxY,De),Sn=no(pr,Rt,ue+jo,ue+Mr,1,Ct.minY,Ct.maxY,De),pr=null),Mi&&(Bt=no(Mi,Rt,ue-Cr,ue+Lr,1,Ct.minY,Ct.maxY,De),Ui=no(Mi,Rt,ue+jo,ue+Mr,1,Ct.minY,Ct.maxY,De),Mi=null),Je>1&&console.timeEnd("clipping"),Be.push(zn||[],Z+1,2*Y,2*ue),Be.push(Sn||[],Z+1,2*Y,2*ue+1),Be.push(Bt||[],Z+1,2*Y+1,2*ue),Be.push(Ui||[],Z+1,2*Y+1,2*ue+1)}}},ro.prototype.getTile=function(fe,Z,Y){var ue=this.options,xe=ue.extent,Se=ue.debug;if(fe<0||fe>24)return null;var Ve=1<<fe,Be=ys(fe,Z=(Z%Ve+Ve)%Ve,Y);if(this.tiles[Be])return va(this.tiles[Be],xe);Se>1&&console.log("drilling down to z%d-%d-%d",fe,Z,Y);for(var De,Je=fe,Rt=Z,zt=Y;!De&&Je>0;)Je--,Rt=Math.floor(Rt/2),zt=Math.floor(zt/2),De=this.tiles[ys(Je,Rt,zt)];return De&&De.source?(Se>1&&console.log("found parent tile z%d-%d-%d",Je,Rt,zt),Se>1&&console.time("drilling down"),this.splitTile(De.source,Je,Rt,zt,fe,Z,Y),Se>1&&console.timeEnd("drilling down"),this.tiles[Be]?va(this.tiles[Be],xe):null):null};class Qa extends u.VectorTileWorkerSource{constructor(Z,Y,ue,xe,Se){super(Z,Y,ue,xe,ba),Se&&(this.loadGeoJSON=Se)}loadData(Z,Y){const ue=Z&&Z.request,xe=ue&&ue.collectResourceTiming;this.loadGeoJSON(Z,(Se,Ve)=>{if(Se||!Ve)return Y(Se);if("object"!=typeof Ve)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Yt(Ve,!0);try{if(Z.filter){const De=u.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===De.result)throw new Error(De.value.map(Rt=>`${Rt.key}: ${Rt.message}`).join(", "));Ve={type:"FeatureCollection",features:Ve.features.filter(Rt=>De.value.evaluate({zoom:0},Rt))}}this._geoJSONIndex=Z.cluster?new si(function({superclusterOptions:De,clusterProperties:Je}){if(!Je||!De)return De;const Rt={},zt={},Ct={accumulated:null,zoom:0},kn={properties:null},Gn=Object.keys(Je);for(const zn of Gn){const[Sn,Bt]=Je[zn],Ui=u.createExpression(Bt),pr=u.createExpression("string"==typeof Sn?[Sn,["accumulated"],["get",zn]]:Sn);Rt[zn]=Ui.value,zt[zn]=pr.value}return De.map=zn=>{kn.properties=zn;const Sn={};for(const Bt of Gn)Sn[Bt]=Rt[Bt].evaluate(Ct,kn);return Sn},De.reduce=(zn,Sn)=>{kn.properties=Sn;for(const Bt of Gn)Ct.accumulated=zn[Bt],zn[Bt]=zt[Bt].evaluate(Ct,kn)},De}(Z)).load(Ve.features):new ro(De=Ve,Z.geojsonVtOptions)}catch(De){return Y(De)}this.loaded={};const Be={};if(xe){const De=u.getPerformanceMeasurement(ue);De&&(Be.resourceTiming={},Be.resourceTiming[Z.source]=JSON.parse(JSON.stringify(De)))}Y(null,Be)}var De})}reloadTile(Z,Y){const ue=this.loaded;return ue&&ue[Z.uid]?super.reloadTile(Z,Y):this.loadTile(Z,Y)}loadGeoJSON(Z,Y){if(Z.request)u.getJSON(Z.request,Y);else{if("string"!=typeof Z.data)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(Z.data))}catch{return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ue){Y(ue)}}getClusterChildren(Z,Y){try{Y(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ue){Y(ue)}}getClusterLeaves(Z,Y){try{Y(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ue){Y(ue)}}}class wa{constructor(Z){this.self=Z,this.actor=new u.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Qa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,ue)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ue},this.self.registerRTLTextPlugin=Y=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=Y.applyArabicShaping,u.plugin.processBidirectionalText=Y.processBidirectionalText,u.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(Z,Y,ue){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],ue()}checkIfReady(Z,Y,ue){ue()}setReferrer(Z,Y){this.referrer=Y}spriteLoaded(Z,Y){this.isSpriteLoaded[Z]=Y;for(const ue in this.workerSources[Z]){const xe=this.workerSources[Z][ue];for(const Se in xe)xe[Se]instanceof u.VectorTileWorkerSource&&(xe[Se].isSpriteLoaded=Y,xe[Se].fire(new u.Event("isSpriteLoaded")))}}setImages(Z,Y,ue){this.availableImages[Z]=Y;for(const xe in this.workerSources[Z]){const Se=this.workerSources[Z][xe];for(const Ve in Se)Se[Ve].availableImages=Y}ue()}enableTerrain(Z,Y,ue){this.terrain=Y,ue()}setProjection(Z,Y){this.projections[Z]=u.getProjection(Y)}setLayers(Z,Y,ue){this.getLayerIndex(Z).replace(Y),ue()}updateLayers(Z,Y,ue){this.getLayerIndex(Z).update(Y.layers,Y.removedIds),ue()}loadTile(Z,Y,ue){const xe=this.enableTerrain?u.extend({enableTerrain:this.terrain},Y):Y;xe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Y.type,Y.source).loadTile(xe,ue)}loadDEMTile(Z,Y,ue){const xe=this.enableTerrain?u.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(Z,Y.source).loadTile(xe,ue)}reloadTile(Z,Y,ue){const xe=this.enableTerrain?u.extend({enableTerrain:this.terrain},Y):Y;xe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Y.type,Y.source).reloadTile(xe,ue)}abortTile(Z,Y,ue){this.getWorkerSource(Z,Y.type,Y.source).abortTile(Y,ue)}removeTile(Z,Y,ue){this.getWorkerSource(Z,Y.type,Y.source).removeTile(Y,ue)}removeSource(Z,Y,ue){if(!this.workerSources[Z]||!this.workerSources[Z][Y.type]||!this.workerSources[Z][Y.type][Y.source])return;const xe=this.workerSources[Z][Y.type][Y.source];delete this.workerSources[Z][Y.type][Y.source],void 0!==xe.removeSource?xe.removeSource(Y,ue):ue()}loadWorkerSource(Z,Y,ue){try{this.self.importScripts(Y.url),ue()}catch(xe){ue(xe.toString())}}syncRTLPluginState(Z,Y,ue){try{u.plugin.setState(Y);const xe=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=xe){this.self.importScripts(xe);const Se=u.plugin.isParsed();ue(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Se)}}catch(xe){ue(xe.toString())}}getAvailableImages(Z){let Y=this.availableImages[Z];return Y||(Y=[]),Y}getLayerIndex(Z){let Y=this.layerIndexes[Z];return Y||(Y=this.layerIndexes[Z]=new Le),Y}getWorkerSource(Z,Y,ue){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Y]||(this.workerSources[Z][Y]={}),this.workerSources[Z][Y][ue]||(this.workerSources[Z][Y][ue]=new this.workerSourceTypes[Y]({send:(Se,Ve,Be,De,Je,Rt)=>{this.actor.send(Se,Ve,Be,Z,Je,Rt)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][Y][ue]}getDEMWorkerSource(Z,Y){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Y]||(this.demWorkerSources[Z][Y]=new Ae),this.demWorkerSources[Z][Y]}enforceCacheSizeLimit(Z,Y){u.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(Z,Y,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new wa(self)),wa}),Ue(0,function(u){function Q(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let f=0;f<m.length;f++)if(!Q(m[f],a[f]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==a){if("object"!=typeof a||Object.keys(m).length!==Object.keys(a).length)return!1;for(const f in m)if(!Q(m[f],a[f]))return!1;return!0}return m===a}var Ie=Le;function Le(m){return a=m,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,E=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(E);try{b=new Worker(I),_=!0}catch{_=!1}return b&&b.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===_.width}()||(void 0===Ae[f=a&&a.failIfMajorPerformanceCaveat]&&(Ae[f]=function(_){var b,I,A,R,E=(I=_,A=document.createElement("canvas"),(R=Object.create(Le.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,A.getContext("webgl",R)||A.getContext("experimental-webgl",R));if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),!0===E.getShaderParameter(b,E.COMPILE_STATUS))}(f)),!Ae[f]||document.documentMode));var a,f}var Ae={};function Re(m,a,f){const _=u.window.document.createElement(m);return void 0!==a&&(_.className=a),f&&f.appendChild(_),_}function yt(m,a,f){const _=u.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(a))_.setAttributeNS(null,b,a[b]);return f&&f.appendChild(_),_}Le.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Yt=u.window.document&&u.window.document.documentElement.style,Vt=Yt&&void 0!==Yt.userSelect?"userSelect":"WebkitUserSelect";let St;function Ft(){Yt&&Vt&&(St=Yt[Vt],Yt[Vt]="none")}function Ot(){Yt&&Vt&&(Yt[Vt]=St)}function he(m){m.preventDefault(),m.stopPropagation(),u.window.removeEventListener("click",he,!0)}function tt(){u.window.addEventListener("click",he,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",he,!0)},0)}function bt(m,a){const f=m.getBoundingClientRect();return at(m,f,a)}function Ge(m,a){const f=m.getBoundingClientRect(),_=[];for(let b=0;b<a.length;b++)_.push(at(m,f,a[b]));return _}function ke(m){return void 0!==u.window.InstallTrigger&&2===m.button&&m.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function at(m,a,f){const _=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new u.Point((f.clientX-a.left)*_,(f.clientY-a.top)*_)}function ze(m,a){var f=a[0],_=a[1],b=a[2],E=a[3],I=f*E-b*_;return I?(m[0]=E*(I=1/I),m[1]=-_*I,m[2]=-b*I,m[3]=f*I,m):null}function Nt(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class Wt extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,_);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let _=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new u.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,f){if(!a)return!0;let _=0;for(const b of a){if(b[0]<_||b[1]<b[0]||f<b[1])return!1;_=b[1]}return!0}_validateContent(a,f){return!(a&&(4!==a.length||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let _=!0;if(!this.isLoaded())for(const b of a)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const _={};for(const b of a){this.images[b]||this.fire(new u.Event("styleimagemissing",{id:b}));const E=this.images[b];E?_[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!(!E.userImage||!E.userImage.render)}:u.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],_=this.getImage(a);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},E=new u.ImagePosition(b,_);this.patterns[a]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const E in this.patterns)a.push(this.patterns[E].bin);const{w:f,h:_}=u.potpack(a),b=this.atlasImage;b.resize({width:f||1,height:_||1});for(const E in this.patterns){const{bin:I}=this.patterns[E],A=I.x+1,R=I.y+1,B=this.images[E].data,z=B.width,H=B.height;u.RGBAImage.copy(B,b,{x:0,y:0},{x:A,y:R},{width:z,height:H}),u.RGBAImage.copy(B,b,{x:0,y:H-1},{x:A,y:R-1},{width:z,height:1}),u.RGBAImage.copy(B,b,{x:0,y:0},{x:A,y:R+H},{width:z,height:1}),u.RGBAImage.copy(B,b,{x:z-1,y:0},{x:A-1,y:R},{width:1,height:H}),u.RGBAImage.copy(B,b,{x:0,y:0},{x:A+z,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.images[f];Nt(_)&&this.updateImage(f,_)}}}const kt=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(m,a){return function([f,_,b]){const E=u.degToRad(_+90),I=u.degToRad(b);return{x:f*Math.cos(E)*Math.sin(I),y:f*Math.sin(E)*Math.sin(I),z:f*Math.cos(I),azimuthal:_,polar:b}}(m.expression.evaluate(a))}interpolate(m,a,f){return{x:u.number(m.x,a.x,f),y:u.number(m.y,a.y,f),z:u.number(m.z,a.z,f),azimuthal:u.number(m.azimuthal,a.azimuthal,f),polar:u.number(m.polar,a.polar,f)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)});class Tn extends u.Evented{constructor(a){super(),this._transitionable=new u.Transitionable(kt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(u.validateLight,a,f))for(const _ in a){const b=a[_];u.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,_){return(!_||!1!==_.validate)&&u.emitValidationErrors(this,a.call(u.validateStyle,u.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const ki=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)});let qi=class extends u.Evented{constructor(m,a){super(),this._transitionable=new u.Transitionable(ki),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(m){for(const a in m){const f=m[a];u.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),f):this._transitionable.setValue(a,f)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function qr(m,a,f,_){const b=u.smoothstep(45,65,f),[E,I]=Er(m,_),A=u.length(a);let R=1-Math.min(1,Math.exp((A-E)/(I-E)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*b*m.alpha}function Er(m,a){const f=.5/Math.tan(.5*a);return[m.range[0]+f,m.range[1]+f]}const Dn=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])});class En extends u.Evented{constructor(a,f){super(),this._transitionable=new u.Transitionable(Dn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const a=this._transform,f="globe"===a.projection.name,_=u.globeToMercatorTransition(a.zoom),b=this.properties.get("range"),E=[.5,3];return{range:f?[u.number(E[0],b[0],_),u.number(E[1],b[1],_)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(u.validateFog,a,f)){for(const _ of Object.keys(u.spec.fog))a&&void 0===a[_]&&(a[_]=u.spec.fog[_].default);for(const _ in a){const b=a[_];u.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?function(_,b,E){const I=u.MercatorCoordinate.fromLngLat(b),A=E.elevation?E.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,A];return u.transformMat4(R,R,E.mercatorFogMatrix),qr(_,R,E.pitch,E._fov)}(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Er(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,_){return(!_||!1!==_.validate)&&u.emitValidationErrors(this,a.call(u.validateStyle,u.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class rr{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const E=new rr.Actor(_[b],f,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,f,_){u.asyncAll(this.actors,(b,E)=>{b.send(a,f,E)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dn(m,a,f){return a*(u.EXTENT/(m.tileSize*Math.pow(2,f-m.tileID.overscaledZ)))}rr.Actor=u.Actor;class In{constructor(a,f,_,b){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(a,f){let _,b;if(a instanceof u.Point||"number"==typeof a[0]){const E=u.Point.convert(a);_=[E],b=f.isPointAboveHorizon(E)}else{const E=u.Point.convert(a[0]),I=u.Point.convert(a[1]);_=[E,I],b=u.polygonizeBounds(E,I).every(A=>f.isPointAboveHorizon(A))}return new In(_,f.getCameraPoint(),b,f)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],b=u.polygonizeBounds(f,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(b[3]=this.cameraPoint)),u.bufferConvexPolygon(b,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],b=u.polygonizeBounds(f,_,a),E=this.cameraPoint.clone();switch(3*((E.y>f.y)+(E.y>_.y))+((E.x>f.x)+(E.x>_.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(a,f,_,b=0){const E=a.queryPadding/f._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(E,f):this._bufferedScreenMercator(E,f);let A=a.tileID.wrap+(I.unwrapped?b:0);const R=I.polygon.map(re=>u.getTilePoint(a.tileTransform,re,A));if(!u.polygonIntersectsBox(R,0,0,u.EXTENT,u.EXTENT))return;A=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const B=this.screenGeometryMercator.polygon.map(re=>u.getTileVec3(a.tileTransform,re,A)),z=B.map(re=>new u.Point(re[0],re[1])),H=f.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),K=u.getTileVec3(a.tileTransform,H,A),te=B.map(re=>{const G=u.sub(re,re,K);return u.normalize(G,G),new u.Ray(K,G)}),ie=dn(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:te,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ne=u.getBounds(R),ne.min.x=u.clamp(ne.min.x,0,u.EXTENT),ne.min.y=u.clamp(ne.min.y,0,u.EXTENT),ne.max.x=u.clamp(ne.max.x,0,u.EXTENT),ne.max.y=u.clamp(ne.max.y,0,u.EXTENT),ne),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:ie};var ne}_bufferedScreenMercator(a,f){const _=Oi(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let b;return b="globe"===f.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(a,f){const _=Oi(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let b;return b="globe"===f.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[_]=b,b}}_projectAndResample(a,f){const _=function(E,I){const A=u.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-u.GLOBE_RADIUS,0,1],B=[0,u.GLOBE_RADIUS,0,1],z=[0,0,0,1];u.transformMat4$1(R,R,A),u.transformMat4$1(B,B,A),u.transformMat4$1(z,z,A);const H=new u.Point(R[0]/R[3],R[1]/R[3]),K=new u.Point(B[0]/B[3],B[1]/B[3]),te=u.polygonContainsPoint(E,H)&&R[3]<z[3],ie=u.polygonContainsPoint(E,K)&&B[3]<z[3];if(!te&&!ie)return null;const ne=function(Ce,Ne,Pe){for(let Xe=1;Xe<Ce.length;Xe++){const Et=Zi(Ne.pointCoordinate3D(Ce[Xe-1]).x),je=Zi(Ne.pointCoordinate3D(Ce[Xe]).x);if(Pe<0){if(Et<je)return{idx:Xe,t:-Et/(je-1-Et)}}else if(je<Et)return{idx:Xe,t:(1-Et)/(je+1-Et)}}return null}(E,I,te?-1:1);if(!ne)return null;const{idx:re,t:G}=ne;let ee=re>1?si(E.slice(0,re),I):[],le=re<E.length?si(E.slice(re),I):[];ee=ee.map(Ce=>new u.Point(Zi(Ce.x),Ce.y)),le=le.map(Ce=>new u.Point(Zi(Ce.x),Ce.y));const ce=[...ee];0===ce.length&&ce.push(le[le.length-1]);const Ee=u.number(ce[ce.length-1].y,(0===le.length?ee[0]:le[0]).y,G);let Te;return Te=te?[new u.Point(0,Ee),new u.Point(0,0),new u.Point(1,0),new u.Point(1,Ee)]:[new u.Point(1,Ee),new u.Point(1,1),new u.Point(0,1),new u.Point(0,Ee)],ce.push(...Te),0===le.length?ce.push(ee[0]):ce.push(...le),{polygon:ce.map(Ce=>new u.MercatorCoordinate(Ce.x,Ce.y)),unwrapped:!1}}(a,f);if(_)return _;const b=function(E,I){let A=!1,R=-1/0,B=0;for(let H=0;H<E.length-1;H++)E[H].x>R&&(R=E[H].x,B=H);for(let H=0;H<E.length-1;H++){const K=(B+H)%(E.length-1),te=E[K],ie=E[K+1];Math.abs(te.x-ie.x)>.5&&(te.x<ie.x?(te.x+=1,0===K&&(E[E.length-1].x+=1)):(ie.x+=1,K+1===E.length-1&&(E[0].x+=1)),A=!0)}const z=u.mercatorXfromLng(I.center.lng);return A&&z<Math.abs(z-1)&&E.forEach(H=>{H.x-=1}),{polygon:E,unwrapped:A}}(si(a,f).map(E=>new u.Point(Zi(E.x),E.y)),f);return{polygon:b.polygon.map(E=>new u.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function si(m,a){return u.resample(m,f=>{const _=a.pointCoordinate3D(f);f.x=_.x,f.y=_.y},1/256)}function Zi(m){return m<0?1+m%1:m%1}function Oi(m){return 100*m|0}function li(m,a,f,_,b){const E=function(I,A){if(I)return b(I);if(A){m.url&&A.tiles&&m.tiles&&delete m.tiles;const R=u.pick(u.extend(A,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(R.vectorLayers=A.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=a.canonicalizeTileset(R,m.url),b(null,R)}};return m.url?u.getJSON(a.transformRequest(a.normalizeSourceURL(m.url,null,f,_),u.ResourceType.Source),E):u.exported.frame(()=>E(null,m))}class Mn{constructor(a,f,_){this.bounds=u.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),_=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*f),b=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*f),I=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=_&&a.x<E&&a.y>=b&&a.y<I}}class Zr{constructor(a,f,_){this.context=a;const b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const di={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pi{constructor(a,f,_,b){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.context=a;const E=a.gl;this.buffer=E.createBuffer(),a.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let _=0;_<this.attributes.length;_++){const b=f.attributes[this.attributes[_].name];void 0!==b&&a.enableVertexAttribArray(b)}}setVertexAttribPointers(a,f,_){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],I=f.attributes[E.name];void 0!==I&&a.vertexAttribPointer(I,E.components,a[di[E.type]],!1,this.itemSize,E.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ln{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class is extends ln{getDefault(){return u.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class An extends ln{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ns extends ln{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Ji extends ln{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class go extends ln{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class sc extends ln{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class rs extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class no extends ln{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class qc extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class Ml extends ln{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Sl extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class ya extends ln{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ya extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class ac extends ln{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Zc extends ln{getDefault(){return u.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class io extends ln{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Fs extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class va extends ln{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class xa extends ln{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let Ka,Il=class extends ln{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Ja extends ln{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class ro extends ln{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ys extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class ba extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Qa extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class wa extends ln{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class fe extends ln{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Z extends ln{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Y extends ln{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ue extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class xe extends ln{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Se extends ln{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Ve extends Se{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Be extends Se{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class De extends Be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Je{constructor(a,f,_,b){this.context=a,this.width=f,this.height=_;const E=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Ve(a,E),b&&(this.depthAttachment=new Be(a,E))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class Rt{constructor(a,f=!1){if(this.gl=a,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const _=a;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(a),deleteVertexArrayOES:_.deleteVertexArray.bind(a),bindVertexArrayOES:_.bindVertexArray.bind(a)}}this.clearColor=new is(this),this.clearDepth=new An(this),this.clearStencil=new Ns(this),this.colorMask=new Ji(this),this.depthMask=new go(this),this.stencilMask=new sc(this),this.stencilFunc=new rs(this),this.stencilOp=new no(this),this.stencilTest=new qc(this),this.depthRange=new Ml(this),this.depthTest=new Sl(this),this.depthFunc=new ya(this),this.blend=new Ya(this),this.blendFunc=new ac(this),this.blendColor=new Zc(this),this.blendEquation=new io(this),this.cullFace=new Fs(this),this.cullFaceSide=new va(this),this.frontFace=new xa(this),this.program=new Il(this),this.activeTexture=new Ja(this),this.viewport=new ro(this),this.bindFramebuffer=new ys(this),this.bindRenderbuffer=new ba(this),this.bindTexture=new Qa(this),this.bindVertexBuffer=new wa(this),this.bindElementBuffer=new fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Z(this),this.pixelStoreUnpack=new Y(this),this.pixelStoreUnpackPremultiplyAlpha=new ue(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new Zr(this,a,f)}createVertexBuffer(a,f,_){return new pi(this,a,f,_)}createRenderbuffer(a,f,_){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,a,f,_),this.bindRenderbuffer.set(null),E}createFramebuffer(a,f,_){return new Je(this,a,f,_)}clear({color:a,depth:f,stencil:_}){const b=this.gl;let E=0;a&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==f&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),void 0!==_&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(E)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){Q(a.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class zt extends u.Evented{constructor(a,f,_,b){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(f,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(a){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=li(this._options,this.map._requestManager,f,_,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new u.ErrorEvent(b))):E&&(u.extend(this,E),E.bounds&&(this.tileBounds=new Mn(E.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(b)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(a,f){const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(_,u.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,a.actor&&"expired"!==a.state)"loading"===a.state?a.reloadCallback=f:a.request=a.actor.send("reloadTile",b,E.bind(this));else if(a.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const I=u.loadVectorTile.call({deduped:this._deduped},b,(A,R)=>{A||!R?E.call(this,A):(b.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},a.actor&&a.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);a.request={cancel:I}}function E(I,A){return delete a.request,a.aborted?f(null):I&&404!==I.status?f(I):(A&&A.resourceTiming&&(a.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&a.setExpiryData(A),a.loadVectorData(A,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ct extends u.Evented{constructor(a,f,_,b){super(),this.id=a,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},f),u.extend(this,u.pick(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=li(this._options,this.map._requestManager,null,null,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new u.ErrorEvent(f)):_&&(u.extend(this,_),_.bounds&&(this.tileBounds=new Mn(_.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(_.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(f)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const _=u.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=u.getImage(this.map._requestManager.transformRequest(b,u.ResourceType.Tile),(E,I,A,R)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):E?(a.state="errored",f(E)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:A,expires:R}),a.setTexture(I,this.map.painter),a.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(a,f,_){a.setTexture(f,_)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function kn(m,a,f,_,b,E,I,A){const R=[m,f,b,a,_,E,1,1,1],B=[I,A,1],z=u.adjoint([],R),[H,K,te]=u.transformMat3(B,B,u.transpose(z,z));return u.multiply$1(R,[H,0,0,0,K,0,0,0,te],R)}class Gn extends u.Evented{constructor(a,f,_,b){super(),this.id=a,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=f,this._dirty=!1}load(a,f){this._loaded=f||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(_,b)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new u.ErrorEvent(_));else if(b){const{HTMLImageElement:E}=u.window;this.image=b instanceof E?u.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,E=1/0,I=-1/0,A=-1/0;for(const H of _)b=Math.min(b,H.x),E=Math.min(E,H.y),I=Math.max(I,H.x),A=Math.max(A,H.y);const R=Math.max(I-b,A-E),B=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,B);return new u.CanonicalTileID(B,Math.floor((b+I)/2*z),Math.floor((E+A)/2*z))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const R in this.tiles){const B=this.tiles[R];"loaded"!==B.state&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const f=u.tileTransform(this.tileID,this.map.transform.projection),[_,b,E,I]=this.coordinates.map(R=>{const B=f.projection.project(R[0],R[1]);return u.getTilePoint(f,B)._round()});this.perspectiveTransform=function(R,B,z,H,K,te,ie,ne,re,G){const ee=kn(0,0,R,0,0,B,R,B),le=kn(z,H,K,te,ie,ne,re,G);return u.multiply$1(le,u.adjoint(ee,ee),le),[le[6]/le[8]*R/u.EXTENT,le[7]/le[8]*B/u.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,I.x,I.y,E.x,E.y);const A=this._boundsArray=new u.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(b.x,b.y,u.EXTENT,0),A.emplaceBack(I.x,I.y,0,u.EXTENT),A.emplaceBack(E.x,E.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(A,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,f=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const zn={vector:zt,raster:Ct,"raster-dem":class extends Ct{constructor(m,a,f,_){super(m,a,f,_),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const f=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,E){b&&(m.state="errored",a(b)),E&&(m.dem=E,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=u.getImage(this.map._requestManager.transformRequest(f,u.ResourceType.Tile),function(b,E,I,A){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(b)m.state="errored",a(b);else if(E){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:I,expires:A});const R=u.window.ImageBitmap&&E instanceof u.window.ImageBitmap&&(null==Ka&&(Ka=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),Ka),B=1-(E.width-u.prevPowerOfTwo(E.width))/2;B<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=R?E:u.exported.getImageData(E,B),H={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:B};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",H,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const a=m.canonical,f=Math.pow(2,a.z),_=(a.x-1+f)%f,b=0===a.x?m.wrap-1:m.wrap,E=(a.x+1+f)%f,I=a.x+1===f?m.wrap+1:m.wrap,A={};return A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y).key]={backfilled:!1},a.y>0&&(A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y-1).key]={backfilled:!1}),a.y+1<f&&(A[new u.OverscaledTileID(m.overscaledZ,b,a.z,_,a.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},A[new u.OverscaledTileID(m.overscaledZ,I,a.z,E,a.y+1).key]={backfilled:!1}),A}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends u.Evented{constructor(m,a,f,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(_),this._data=a.data,this._options=u.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const b=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*b,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*b,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*b,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},a),this}getClusterLeaves(m,a,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:a,offset:f},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=u.extend({},this.workerOptions),a=this._data;"string"==typeof a?(m.request=this.map._requestManager.transformRequest(u.exported.resolveURL(a),u.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new u.ErrorEvent(f));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new u.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,a){const f=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(f,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?a(null):_?a(_):(m.loadVectorData(b,this.map.painter,"reloadTile"===f),a(null))),void 0,"loadTile"===f)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Gn{constructor(m,a,f,_){super(m,a,f,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,u.ResourceType.Source).url);u.getVideo(this.urls,(a,f)=>{this._loaded=!0,a?this.fire(new u.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(m,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Gn,canvas:class extends Gn{constructor(m,a,f,_){super(m,a,f,_),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(E=>"number"!=typeof E))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends u.Evented{constructor(m,a,f,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mn(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:f,z:_}=m.canonical;return this._implementation.hasTile({x:a,y:f,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:f,y:_,z:b}=m.tileID.canonical,E=new u.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:f,y:_,z:b},{signal:E.signal})).then(function(I){return delete m.request,m.aborted?(m.state="unloaded",a(null)):void 0===I?(m.state="errored",a(null)):null===I?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):(A=I)instanceof u.window.ImageData||A instanceof u.window.HTMLCanvasElement||A instanceof u.window.ImageBitmap||A instanceof u.window.HTMLImageElement?(this.loadTileData(m,I),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(I=>{20!==I.code&&(m.state="errored",a(I))}),m.request.cancel=()=>E.abort()}loadTileData(m,a){Ct.loadTileData(m,a,this._map.painter)}unloadTileData(m){Ct.unloadTileData(m,this._map.painter)}unloadTile(m,a){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:f,y:_,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:f,y:_,z:b})}a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Sn=function(m,a,f,_){const b=new zn[a.type](m,a,f,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Bt(m,a){const f=u.identity([]);return u.scale(f,f,[.5*m.width,.5*-m.height,1]),u.translate(f,f,[1,-1,0]),u.multiply(f,f,m.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function Ui(m,a,f,_,b,E,I,A=!1){const R=m.tilesIn(_,I,A);R.sort(Mi);const B=[];for(const H of R)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(a,f,m._state,H,b,E,Bt(m.transform,H.tile.tileID),A)});const z=function(H){const K={},te={};for(const ie of H){const ne=ie.queryResults,re=ie.wrappedTileID,G=te[re]=te[re]||{};for(const ee in ne){const le=ne[ee],ce=G[ee]=G[ee]||{},Ee=K[ee]=K[ee]||[];for(const Te of le)ce[Te.featureIndex]||(ce[Te.featureIndex]=!0,Ee.push(Te))}}return K}(B);for(const H in z)z[H].forEach(K=>{const te=K.feature,ie=te.layer;ie&&"background"!==ie.type&&"sky"!==ie.type&&(te.source=ie.source,ie["source-layer"]&&(te.sourceLayer=ie["source-layer"]),te.state=void 0!==te.id?m.getFeatureState(ie["source-layer"],te.id):{})});return z}function pr(m,a){const f=m.getRenderableIds().map(E=>m.getTileByID(E)),_=[],b={};for(let E=0;E<f.length;E++){const I=f[E],A=I.tileID.canonical.key;b[A]||(b[A]=!0,I.querySourceFeatures(_,a))}return _}function Mi(m,a){const f=m.tileID,_=a.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Cr(){return null!=Hu.workerClass?new Hu.workerClass:new u.window.Worker(Hu.workerUrl)}const jo="mapboxgl_preloaded_worker_pool";class Lr{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Lr.workerCount;)this.workers.push(new Cr);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jo]}numActive(){return Object.keys(this.active).length}}let Mr;function Ea(){return Mr||(Mr=new Lr),Mr}function Hd(m,a){const f={};for(const _ in m)"ref"!==_&&(f[_]=m[_]);return u.refProperties.forEach(_=>{_ in a&&(f[_]=a[_])}),f}function Nh(m){m=m.slice();const a=Object.create(null);for(let f=0;f<m.length;f++)a[m[f].id]=m[f];for(let f=0;f<m.length;f++)"ref"in m[f]&&(m[f]=Hd(m[f],a[m[f].ref]));return m}Lr.workerCount=2;const Kn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ru(m,a,f){f.push({command:Kn.addSource,args:[m,a[m]]})}function vr(m,a,f){a.push({command:Kn.removeSource,args:[m]}),f[m]=!0}function Ca(m,a,f,_){vr(m,f,_),Ru(m,a,f)}function oo(m,a,f){let _;for(_ in m[f])if(m[f].hasOwnProperty(_)&&"data"!==_&&!Q(m[f][_],a[f][_]))return!1;for(_ in a[f])if(a[f].hasOwnProperty(_)&&"data"!==_&&!Q(m[f][_],a[f][_]))return!1;return!0}function zs(m,a,f,_,b,E){let I;for(I in a=a||{},m=m||{})m.hasOwnProperty(I)&&(Q(m[I],a[I])||f.push({command:E,args:[_,I,a[I],b]}));for(I in a)a.hasOwnProperty(I)&&!m.hasOwnProperty(I)&&(Q(m[I],a[I])||f.push({command:E,args:[_,I,a[I],b]}))}function Bs(m){return m.id}function Lu(m,a){return m[a.id]=a,m}class lc{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=u.clamp(a,0,1);let f=1,_=this._distances[f];const b=a*this.paddedLength+this.padding;for(;_<b&&f<this._distances.length;)_=this._distances[++f];const E=f-1,I=this._distances[E],A=_-I,R=A>0?(b-I)/A:0;return this.points[E].mult(1-R).add(this.points[f].mult(R))}}class Ta{constructor(a,f,_){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(f/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,_,b,E){this._forEachCell(f,_,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(a,f,_,b){this._forEachCell(f-b,_-b,f+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(_),this.circles.push(b)}_insertBoxCell(a,f,_,b,E,I){this.boxCells[E].push(I)}_insertCircleCell(a,f,_,b,E,I){this.circleCells[E].push(I)}_query(a,f,_,b,E,I){if(_<0||a>this.width||b<0||f>this.height)return!E&&[];const A=[];if(a<=0&&f<=0&&this.width<=_&&this.height<=b){if(E)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],z=this.circles[3*R+1],H=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:B-H,y1:z-H,x2:B+H,y2:z+H})}return I?A.filter(I):A}return this._forEachCell(a,f,_,b,this._queryCell,A,{hitTest:E,seenUids:{box:{},circle:{}}},I),E?A.length>0:A}_queryCircle(a,f,_,b,E){const I=a-_,A=a+_,R=f-_,B=f+_;if(A<0||I>this.width||B<0||R>this.height)return!b&&[];const z=[];return this._forEachCell(I,R,A,B,this._queryCellCircle,z,{hitTest:b,circle:{x:a,y:f,radius:_},seenUids:{box:{},circle:{}}},E),b?z.length>0:z}query(a,f,_,b,E){return this._query(a,f,_,b,!1,E)}hitTest(a,f,_,b,E){return this._query(a,f,_,b,!0,E)}hitTestCircle(a,f,_,b){return this._queryCircle(a,f,_,!0,b)}_queryCell(a,f,_,b,E,I,A,R){const B=A.seenUids,z=this.boxCells[E];if(null!==z){const K=this.bboxes;for(const te of z)if(!B.box[te]){B.box[te]=!0;const ie=4*te;if(a<=K[ie+2]&&f<=K[ie+3]&&_>=K[ie+0]&&b>=K[ie+1]&&(!R||R(this.boxKeys[te]))){if(A.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[te],x1:K[ie],y1:K[ie+1],x2:K[ie+2],y2:K[ie+3]})}}}const H=this.circleCells[E];if(null!==H){const K=this.circles;for(const te of H)if(!B.circle[te]){B.circle[te]=!0;const ie=3*te;if(this._circleAndRectCollide(K[ie],K[ie+1],K[ie+2],a,f,_,b)&&(!R||R(this.circleKeys[te]))){if(A.hitTest)return I.push(!0),!0;{const ne=K[ie],re=K[ie+1],G=K[ie+2];I.push({key:this.circleKeys[te],x1:ne-G,y1:re-G,x2:ne+G,y2:re+G})}}}}}_queryCellCircle(a,f,_,b,E,I,A,R){const B=A.circle,z=A.seenUids,H=this.boxCells[E];if(null!==H){const te=this.bboxes;for(const ie of H)if(!z.box[ie]){z.box[ie]=!0;const ne=4*ie;if(this._circleAndRectCollide(B.x,B.y,B.radius,te[ne+0],te[ne+1],te[ne+2],te[ne+3])&&(!R||R(this.boxKeys[ie])))return I.push(!0),!0}}const K=this.circleCells[E];if(null!==K){const te=this.circles;for(const ie of K)if(!z.circle[ie]){z.circle[ie]=!0;const ne=3*ie;if(this._circlesCollide(te[ne],te[ne+1],te[ne+2],B.x,B.y,B.radius)&&(!R||R(this.circleKeys[ie])))return I.push(!0),!0}}}_forEachCell(a,f,_,b,E,I,A,R){const B=this._convertToXCellCoord(a),z=this._convertToYCellCoord(f),H=this._convertToXCellCoord(_),K=this._convertToYCellCoord(b);for(let te=B;te<=H;te++)for(let ie=z;ie<=K;ie++)if(E.call(this,a,f,_,b,this.xCellCount*ie+te,I,A,R))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,_,b,E,I){const A=b-a,R=E-f,B=_+I;return B*B>A*A+R*R}_circleAndRectCollide(a,f,_,b,E,I,A){const R=(I-b)/2,B=Math.abs(a-(b+R));if(B>R+_)return!1;const z=(A-E)/2,H=Math.abs(f-(E+z));if(H>z+_)return!1;if(B<=R||H<=z)return!0;const K=B-R,te=H-z;return K*K+te*te<=_*_}}const _o={unknown:0,flipRequired:1,flipNotRequired:2},Vs=Math.tan(85*Math.PI/180);function it(m,a,f,_,b,E,I){const A=u.create();if(f)if("globe"===E.name){const R=u.calculateGlobeLabelMatrix(b,a);u.multiply(A,A,R)}else{const R=ze([],I);A[0]=R[0],A[1]=R[1],A[4]=R[2],A[5]=R[3],_||u.rotateZ(A,A,b.angle)}else u.multiply(A,b.labelPlaneMatrix,m);return A}function os(m,a,f,_,b,E,I){const A=it(m,a,f,_,b,E,I);return"globe"===E.name&&f||(A[2]=A[6]=A[10]=A[14]=0),A}function Qi(m,a,f,_,b,E,I){if(f){if("globe"===E.name){const A=it(m,a,f,_,b,E,I);return u.invert(A,A),u.multiply(A,m,A),A}{const A=u.clone(m),R=u.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],u.multiply(A,A,R),_||u.rotateZ(A,A,-b.angle),A}}return b.glCoordMatrix}function On(m,a,f,_){const b=[m,a,f,1];f?u.transformMat4$1(b,b,_):qn(b,b,_);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function or(m,a){return Math.min(.5+m/a*.5,1.5)}function Ao(m,a){const f=m[0]/m[3],_=m[1]/m[3];return f>=-a[0]&&f<=a[0]&&_>=-a[1]&&_<=a[1]}function Us(m,a,f,_,b,E,I,A,R,B){const z=f.transform,H=_?m.textSizeData:m.iconSizeData,K=u.evaluateSizeForZoom(H,f.transform.zoom),te="globe"===z.projection.name,ie=[256/f.width*2+1,256/f.height*2+1],ne=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ne.clear();let re=null;te&&(re=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const G=m.lineVertexArray,ee=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,le=f.transform.width/f.transform.height;let ce,Ee=!1;for(let Te=0;Te<ee.length;Te++){const Ce=ee.get(Te),{numGlyphs:Ne,writingMode:Pe}=Ce;if(Pe!==u.WritingMode.vertical||Ee||ce===u.WritingMode.horizontal||(Ee=!0),ce=Pe,(Ce.hidden||Pe===u.WritingMode.vertical)&&!Ee){sr(Ne,ne);continue}Ee=!1;const Xe=new u.Point(Ce.tileAnchorX,Ce.tileAnchorY);let{x:Et,y:je,z:ut}=z.projection.projectTilePoint(Xe.x,Xe.y,B.canonical);if(R){const[Ln,en,wn]=R(Xe);Et+=Ln,je+=en,ut+=wn}const et=[Et,je,ut,1];if(u.transformMat4$1(et,et,a),!Ao(et,ie)){sr(Ne,ne);continue}const xt=or(f.transform.cameraToCenterDistance,et[3]),We=u.evaluateSizeForFeature(H,K,Ce),lt=I?We/xt:We*xt,Dt=On(Et,je,ut,b);if(Dt[3]<=0){sr(Ne,ne);continue}let pt={};const It=I?null:R,un=ot(Ce,lt,!1,A,a,b,E,m.glyphOffsetArray,G,ne,re,Dt,Xe,pt,le,It,z.projection,B,I);Ee=un.useVertical,It&&un.needsFlipping&&(pt={}),(un.notEnoughRoom||Ee||un.needsFlipping&&ot(Ce,lt,!0,A,a,b,E,m.glyphOffsetArray,G,ne,re,Dt,Xe,pt,le,It,z.projection,B,I).notEnoughRoom)&&sr(Ne,ne)}_?(m.text.dynamicLayoutVertexBuffer.updateData(ne),re&&m.text.globeExtVertexBuffer.updateData(re)):(m.icon.dynamicLayoutVertexBuffer.updateData(ne),re&&m.icon.globeExtVertexBuffer.updateData(re))}function el(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const{lineStartIndex:re,glyphStartIndex:G,segment:ee}=A,le=G+A.numGlyphs,ce=re+A.lineLength,Ee=a.getoffsetX(G),Te=a.getoffsetX(le-1),Ce=fn(m*Ee,f,_,b,E,I,ee,re,ce,R,B,z,H,K,!0,te,ie,ne);if(!Ce)return null;const Ne=fn(m*Te,f,_,b,E,I,ee,re,ce,R,B,z,H,K,!0,te,ie,ne);return Ne?{first:Ce,last:Ne}:null}function Da(m,a,f,_){return m===u.WritingMode.horizontal&&Math.abs(_)>Math.abs(f)?{useVertical:!0}:m===u.WritingMode.vertical?_>0?{needsFlipping:!0}:null:a!==_o.unknown&&(0===(b=f)||Math.abs(_/b)>Vs)?a===_o.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null;var b}function ot(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G,ee){const le=a/24,ce=m.lineOffsetX*le,Ee=m.lineOffsetY*le,{lineStartIndex:Te,glyphStartIndex:Ce,numGlyphs:Ne,segment:Pe,writingMode:Xe,flipState:Et}=m,je=Te+m.lineLength,ut=et=>{if(z){const[Dt,pt,It]=et.up,un=B.length;u.updateGlobeVertexNormal(z,un+0,Dt,pt,It),u.updateGlobeVertexNormal(z,un+1,Dt,pt,It),u.updateGlobeVertexNormal(z,un+2,Dt,pt,It),u.updateGlobeVertexNormal(z,un+3,Dt,pt,It)}const[xt,We,lt]=et.point;u.addDynamicAttributes(B,xt,We,lt,et.angle)};if(Ne>1){const et=el(le,A,ce,Ee,f,H,K,m,R,E,te,ne,!1,re,G,ee);if(!et)return{notEnoughRoom:!0};if(_&&!f){let[xt,We,lt]=et.first.point,[Dt,pt,It]=et.last.point;[xt,We]=On(xt,We,lt,I),[Dt,pt]=On(Dt,pt,It,I);const un=Da(Xe,Et,(Dt-xt)*ie,pt-We);if(m.flipState=un&&un.needsFlipping?_o.flipRequired:_o.flipNotRequired,un)return un}ut(et.first);for(let xt=Ce+1;xt<Ce+Ne-1;xt++){const We=fn(le*A.getoffsetX(xt),ce,Ee,f,H,K,Pe,Te,je,R,E,te,ne,!1,!1,re,G,ee);if(!We)return B.length-=4*(xt-Ce),{notEnoughRoom:!0};ut(We)}ut(et.last)}else{if(_&&!f){const xt=On(K.x,K.y,0,b),We=Te+Pe+1,lt=new u.Point(R.getx(We),R.gety(We)),Dt=On(lt.x,lt.y,0,b),pt=Dt[3]>0?Dt:gn(K,lt,xt,1,b,void 0,re,G.canonical),It=Da(Xe,Et,(pt[0]-xt[0])*ie,pt[1]-xt[1]);if(m.flipState=It&&It.needsFlipping?_o.flipRequired:_o.flipNotRequired,It)return It}const et=fn(le*A.getoffsetX(Ce),ce,Ee,f,H,K,Pe,Te,je,R,E,te,ne,!1,!1,re,G,ee);if(!et)return{notEnoughRoom:!0};ut(et)}return{}}function vn(m,a,f,_,b){const{x:E,y:I,z:A}=_.projectTilePoint(m.x,m.y,a);if(!b)return On(E,I,A,f);const[R,B,z]=b(m);return On(E+R,I+B,A+z,f)}function gn(m,a,f,_,b,E,I,A){const R=vn(m.sub(a)._unit()._add(m),A,b,I,E);return u.sub(R,f,R),u.normalize(R,R),u.scaleAndAdd(R,f,R,_)}function fn(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G){const ee=_?m-a:m+a;let le=ee>0?1:-1,ce=0;_&&(le*=-1,ce=Math.PI),le<0&&(ce+=Math.PI);let Ee=A+I+(le>0?0:1)|0,Te=b,Ce=b,Ne=0,Pe=0;const Xe=Math.abs(ee),Et=[],je=[];let ut=E,et=ut;const xt=()=>gn(et,ut,Ce,Xe-Ne+1,z,K,ne,re.canonical);for(;Ne+Pe<=Xe;){if(Ee+=le,Ee<A||Ee>=R)return null;if(Ce=Te,et=ut,Et.push(Ce),te&&je.push(et),ut=new u.Point(B.getx(Ee),B.gety(Ee)),Te=H[Ee],!Te){const wn=vn(ut,re.canonical,z,ne,K);Te=wn[3]>0?H[Ee]=wn:xt()}Ne+=Pe,Pe=u.distance(Ce,Te)}ie&&K&&(H[Ee]&&(Te=xt(),Pe=u.distance(Ce,Te)),H[Ee]=Te);const We=(Xe-Ne)/Pe,lt=ut.sub(et)._mult(We)._add(et),Dt=u.sub([],Te,Ce),pt=u.scaleAndAdd([],Ce,Dt,We);let It=[0,0,1],un=Dt[0],Ln=Dt[1];if(G&&(It=ne.upVector(re.canonical,lt.x,lt.y),0!==It[0]||0!==It[1]||1!==It[2])){const wn=[It[2],0,-It[0]],ei=u.cross([],It,wn);u.normalize(wn,wn),u.normalize(ei,ei),un=u.dot(Dt,wn),Ln=u.dot(Dt,ei)}if(f){const wn=u.cross([],It,Dt);u.normalize(wn,wn),u.scaleAndAdd(pt,pt,wn,f*le)}const en=ce+Math.atan2(Ln,un);return Et.push(pt),te&&je.push(lt),{point:pt,angle:en,path:Et,tilePath:je,up:It}}function sr(m,a){const f=a.length,_=f+4*m;a.resize(_),a.float32.fill(-1/0,4*f,4*_)}function qn(m,a,f){const _=a[0],b=a[1];return m[0]=f[0]*_+f[4]*b+f[12],m[1]=f[1]*_+f[5]*b+f[13],m[3]=f[3]*_+f[7]*b+f[15],m}const Wi=100;class ss{constructor(a,f,_=new Ta(a.width+200,a.height+200,25),b=new Ta(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Wi,this.screenBottomBoundary=a.height+Wi,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,_,b,E,I,A,R){let B=_.projectedAnchorX,z=_.projectedAnchorY,H=_.projectedAnchorZ;const K=_.elevation,te=_.tileID,ie=a.getProjection();if(K&&te){const[Te,Ce,Ne]=ie.upVector(te.canonical,_.tileAnchorX,_.tileAnchorY),Pe=ie.upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Te*K*Pe,z+=Ce*K*Pe,H+=Ne*K*Pe}const ne=this.projectAndGetPerspectiveRatio(A,B,z,H,_.tileID,"globe"===ie.name||!!K||this.transform.pitch>0,ie),re=I*ne.perspectiveRatio,G=(_.x1*f+b.x-_.padding)*re+ne.point.x,ee=(_.y1*f+b.y-_.padding)*re+ne.point.y,le=(_.x2*f+b.x+_.padding)*re+ne.point.x,ce=(_.y2*f+b.y+_.padding)*re+ne.point.y,Ee=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(G,ee,le,ce)||!E&&this.grid.hitTest(G,ee,le,ce,R)||Ee?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[G,ee,le,ce],offscreen:this.isOffscreen(G,ee,le,ce),occluded:!1}}placeCollisionCircles(a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const re=[],G=this.transform.elevation,ee=a.getProjection(),le=G?G.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,ee):null,ce=new u.Point(_.tileAnchorX,_.tileAnchorY);let{x:Ee,y:Te,z:Ce}=ee.projectTilePoint(ce.x,ce.y,ne.canonical);if(le){const[lt,Dt,pt]=le(ce);Ee+=lt,Te+=Dt,Ce+=pt}const Ne="globe"===ee.name,Pe=this.projectAndGetPerspectiveRatio(A,Ee,Te,Ce,ne,Ne||!!G||this.transform.pitch>0,ee),{perspectiveRatio:Xe}=Pe,Et=(H?I/Xe:I*Xe)/u.ONE_EM,je=On(Ee,Te,Ce,R),ut=Pe.signedDistanceFromCamera>0?el(Et,E,_.lineOffsetX*Et,_.lineOffsetY*Et,!1,je,ce,_,b,R,{},G&&!H?le:null,H&&!!G,ee,ne,H):null;let et=!1,xt=!1,We=!0;if(ut&&!Pe.occluded){const lt=.5*te*Xe+ie,Dt=new u.Point(-100,-100),pt=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),It=new lc,{first:un,last:Ln}=ut,en=un.path.length;let wn=[];for(let Kt=en-1;Kt>=1;Kt--)wn.push(un.path[Kt]);for(let Kt=1;Kt<Ln.path.length;Kt++)wn.push(Ln.path[Kt]);const ei=2.5*lt;B&&(wn=wn.map(([Kt,Ti,Ni],Fi)=>(le&&!Ne&&(Ni=le(Fi<en-1?un.tilePath[en-1-Fi]:Ln.tilePath[Fi-en+2])[2]),On(Kt,Ti,Ni,B))),wn.some(Kt=>Kt[3]<=0)&&(wn=[]));let Jn=[];if(wn.length>0){let Kt=1/0,Ti=-1/0,Ni=1/0,Fi=-1/0;for(const Si of wn)Kt=Math.min(Kt,Si[0]),Ni=Math.min(Ni,Si[1]),Ti=Math.max(Ti,Si[0]),Fi=Math.max(Fi,Si[1]);Ti>=Dt.x&&Kt<=pt.x&&Fi>=Dt.y&&Ni<=pt.y&&(Jn=[wn.map(Si=>new u.Point(Si[0],Si[1]))],(Kt<Dt.x||Ti>pt.x||Ni<Dt.y||Fi>pt.y)&&(Jn=u.clipLine(Jn,Dt.x,Dt.y,pt.x,pt.y)))}for(const Kt of Jn){It.reset(Kt,.25*lt);let Ti=0;Ti=It.length<=.5*lt?1:Math.ceil(It.paddedLength/ei)+1;for(let Ni=0;Ni<Ti;Ni++){const Fi=Ni/Math.max(Ti-1,1),Si=It.lerp(Fi),yo=Si.x+Wi,co=Si.y+Wi;re.push(yo,co,lt,0);const Yo=yo-lt,Ba=co-lt,_i=yo+lt,Ii=co+lt;if(We=We&&this.isOffscreen(Yo,Ba,_i,Ii),xt=xt||this.isInsideGrid(Yo,Ba,_i,Ii),!f&&this.grid.hitTestCircle(yo,co,lt,K)&&(et=!0,!z))return{circles:[],offscreen:!1,collisionDetected:et,occluded:!1}}}}return{circles:!z&&et||!xt?[]:re,offscreen:We,collisionDetected:et,occluded:Pe.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const f=[];let _=1/0,b=1/0,E=-1/0,I=-1/0;for(const z of a){const H=new u.Point(z.x+Wi,z.y+Wi);_=Math.min(_,H.x),b=Math.min(b,H.y),E=Math.max(E,H.x),I=Math.max(I,H.y),f.push(H)}const A=this.grid.query(_,b,E,I).concat(this.ignoredGrid.query(_,b,E,I)),R={},B={};for(const z of A){const H=z.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const K=[new u.Point(z.x1,z.y1),new u.Point(z.x2,z.y1),new u.Point(z.x2,z.y2),new u.Point(z.x1,z.y2)];u.polygonIntersectsPolygon(f,K)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===B[H.bucketInstanceId]&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(a,f,_,b,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:E},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,_,b,E){const I=f?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:b,collisionGroupID:E};for(let R=0;R<a.length;R+=4)I.insertCircle(A,a[R],a[R+1],a[R+2])}projectAndGetPerspectiveRatio(a,f,_,b,E,I,A){const R=[f,_,b,1];let B=!1;b||this.transform.pitch>0?(u.transformMat4$1(R,R,a),this.fogState&&E&&"globe"!==A.name&&(B=function(K,te,ie,ne,re,G){const ee=G.calculateFogTileMatrix(re),le=[te,ie,ne];return u.transformMat4(le,le,ee),qr(K,le,G.pitch,G._fov)}(this.fogState,f,_,b,E.toUnwrapped(),this.transform)>.9)):qn(R,R,a);const z=R[3];return{point:new u.Point((R[0]/z+1)/2*this.transform.width+Wi,(-R[1]/z+1)/2*this.transform.height+Wi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:I&&R[2]>z||B}}isOffscreen(a,f,_,b){return _<Wi||a>=this.screenRightBoundary||b<Wi||f>this.screenBottomBoundary}isInsideGrid(a,f,_,b){return _>=0&&a<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=u.identity([]);return u.translate(a,a,[-100,-100,0]),a}}function Xi(m,a,f){const _=a.createTileMatrix(m,m.worldSize,f.toUnwrapped());return u.multiply(new Float32Array(16),m.projMatrix,_)}function jn(m,a,f){if(a.projection.name===f.projection.name)return m.projMatrix;const _=f.clone();return _.setProjection(a.projection),Xi(_,a.getProjection(),m)}function gi(m,a,f){return a.name===f.projection.name?m.projMatrix:Xi(f,a,m)}class ar{constructor(a,f,_,b){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Po{constructor(a,f,_,b,E,I=!1){this.text=new ar(a?a.text:null,f,_,E),this.icon=new ar(a?a.icon:null,f,b,E),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class js{constructor(a,f,_,b=!1){this.text=a,this.icon=f,this.skipFade=_,this.clipped=b}}class Ei{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Pn{constructor(a,f,_,b,E){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=E}}class tl{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[a]}}function $s(m,a,f,_,b){const{horizontalAlign:E,verticalAlign:I}=u.getAnchorAlignment(m),A=-(E-.5)*a,R=-(I-.5)*f,B=u.evaluateVariableOffset(m,_);return new u.Point(A+B[0]*b,R+B[1]*b)}function Al(m,a,f,_,b){const E=new u.Point(m,a);return f&&E._rotate(_?b:-b),E}class Ma{constructor(a,f,_,b,E){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new ss(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new tl(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,_,b){const E=_.getBucket(f),I=_.latestFeatureIndex;if(!E||!I||f.id!==E.layerIds[0])return;const A=E.layers[0].layout,R=_.collisionBoxArray,B=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/u.EXTENT,H=_.tileID.toUnwrapped();this.transform.setProjection(E.projection);const K=(te=_.tileID,ie=E.getProjection(),ne=this.transform,ie.name===this.projection?ne.calculateProjMatrix(te.toUnwrapped()):Xi(ne,ie,te));var te,ie,ne;const re="map"===A.get("text-pitch-alignment"),G="map"===A.get("text-rotation-alignment");f.compileFilter();const ee=f.dynamicFilter(),le=f.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(_),Ee=os(K,_.tileID.canonical,re,G,this.transform,E.getProjection(),ce);let Te=null;if(re){const Pe=Qi(K,_.tileID.canonical,re,G,this.transform,E.getProjection(),ce);Te=u.multiply([],this.transform.labelPlaneMatrix,Pe)}let Ce=null;ee&&_.latestFeatureIndex&&(Ce={unwrappedTileID:H,dynamicFilter:ee,dynamicFilterNeedsFeature:le,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new Pn(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,_.tileID);const Ne={bucket:E,layout:A,posMatrix:K,textLabelPlaneMatrix:Ee,labelToScreenMatrix:Te,clippingData:Ce,scale:B,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const Pe of E.sortKeyRanges){const{sortKey:Xe,symbolInstanceStart:Et,symbolInstanceEnd:je}=Pe;a.push({sortKey:Xe,symbolInstanceStart:Et,symbolInstanceEnd:je,parameters:Ne})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re,G,ee){const{textOffset0:le,textOffset1:ce,crossTileID:Ee}=K,Te=[le,ce],Ce=$s(a,_,b,Te,E),Ne=this.collisionIndex.placeCollisionBox(ie,E,f,Al(Ce.x,Ce.y,I,A,this.transform.angle),H,R,B,z.predicate);if(re){const Pe=ie.getSymbolInstanceIconSize(ee,this.transform.zoom,K.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ie,Pe,re,Al(Ce.x,Ce.y,I,A,this.transform.angle),H,R,B,z.predicate).box.length)return}if(Ne.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ee]&&this.prevPlacement.placements[Ee]&&this.prevPlacement.placements[Ee].text&&(Pe=this.prevPlacement.variableOffsets[Ee].anchor),this.variableOffsets[Ee]={textOffset:Te,width:_,height:b,anchor:a,textScale:E,prevAnchor:Pe},this.markUsedJustification(ie,a,K,ne),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ne,K),this.placedOrientations[Ee]=ne),{shift:Ce,placedGlyphBoxes:Ne}}}placeLayerBucketPart(a,f,_,b){const{bucket:E,layout:I,posMatrix:A,textLabelPlaneMatrix:R,labelToScreenMatrix:B,clippingData:z,textPixelRatio:H,holdingForFade:K,collisionBoxArray:te,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ne,collisionGroup:re}=a.parameters,G=I.get("text-optional"),ee=I.get("icon-optional"),le=I.get("text-allow-overlap"),ce=I.get("icon-allow-overlap"),Ee="map"===I.get("text-rotation-alignment"),Te="map"===I.get("text-pitch-alignment"),Ce="none"!==I.get("icon-text-fit"),Ne="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(E.projection);let Pe=le&&(ce||!E.hasIconData()||ee),Xe=ce&&(le||!E.hasTextData()||G);!E.collisionArrays&&te&&E.deserializeCollisionBoxes(te),_&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,te);const Et=(je,ut,et)=>{const{crossTileID:xt,numVerticalGlyphVertices:We}=je;if(z){const _i={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ii=null;if(z.dynamicFilterNeedsFeature){const mi=this.retainedQueryData[E.bucketInstanceId];Ii=z.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:mi.bucketIndex,sourceLayerIndex:mi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(_i,Ii,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new u.Point(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[xt]=new js(!1,!1,!1,!0),void f.add(xt)}if(f.has(xt))return;if(K)return void(this.placements[xt]=new js(!1,!1,!1));let lt=!1,Dt=!1,pt=!0,It=!1,un=!1,Ln=null,en={box:null,offscreen:null,occluded:null},wn={box:null,offscreen:null,occluded:null},ei=null,Jn=null,Kt=null,Ti=0,Ni=0,Fi=0;et.textFeatureIndex?Ti=et.textFeatureIndex:je.useRuntimeCollisionCircles&&(Ti=je.featureIndex),et.verticalTextFeatureIndex&&(Ni=et.verticalTextFeatureIndex);const Si=_i=>{_i.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Ii=this.transform.elevation;(Ii||_i.elevation)&&(_i.elevation=Ii?Ii.getAtTileOffset(_i.tileID,_i.tileAnchorX,_i.tileAnchorY):0)},yo=et.textBox;if(yo){Si(yo);const _i=mi=>{let Xn=u.WritingMode.horizontal;if(E.allowVerticalPlacement&&!mi&&this.prevPlacement){const vo=this.prevPlacement.placedOrientations[xt];vo&&(this.placedOrientations[xt]=vo,Xn=vo,this.markUsedOrientation(E,Xn,je))}return Xn},Ii=(mi,Xn)=>{if(E.allowVerticalPlacement&&We>0&&et.verticalTextBox){for(const vo of E.writingModes)if(vo===u.WritingMode.vertical?(en=Xn(),wn=en):en=mi(),en&&en.box&&en.box.length)break}else en=mi()};if(I.get("text-variable-anchor")){let mi=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xt]){const zi=this.prevPlacement.variableOffsets[xt];mi.indexOf(zi.anchor)>0&&(mi=mi.filter(tr=>tr!==zi.anchor),mi.unshift(zi.anchor))}const Xn=(zi,tr,Gh)=>{const Hl=E.getSymbolInstanceTextSize(ie,je,this.transform.zoom,ut),Va=(zi.x2-zi.x1)*Hl+2*zi.padding,Br=(zi.y2-zi.y1)*Hl+2*zi.padding,Gl=Ce&&!ce?tr:null;Gl&&Si(Gl);let bc={box:[],offscreen:!1,occluded:!1};const qh=le?2*mi.length:mi.length;for(let Ms=0;Ms<qh;++Ms){const Zh=this.attemptAnchorPlacement(mi[Ms%mi.length],zi,Va,Br,Hl,Ee,Te,H,A,re,Ms>=mi.length,je,ut,E,Gh,Gl,ie,ne);if(Zh&&(bc=Zh.placedGlyphBoxes,bc&&bc.box&&bc.box.length)){lt=!0,Ln=Zh.shift;break}}return bc};Ii(()=>Xn(yo,et.iconBox,u.WritingMode.horizontal),()=>{const zi=et.verticalTextBox;return zi&&Si(zi),E.allowVerticalPlacement&&!(en&&en.box&&en.box.length)&&We>0&&zi?Xn(zi,et.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),en&&(lt=en.box,pt=en.offscreen,It=en.occluded);const vo=_i(!(!en||!en.box));if(!lt&&this.prevPlacement){const zi=this.prevPlacement.variableOffsets[xt];zi&&(this.variableOffsets[xt]=zi,this.markUsedJustification(E,zi.anchor,je,vo))}}else{const mi=(Xn,vo)=>{const zi=E.getSymbolInstanceTextSize(ie,je,this.transform.zoom,ut),tr=this.collisionIndex.placeCollisionBox(E,zi,Xn,new u.Point(0,0),le,H,A,re.predicate);return tr&&tr.box&&tr.box.length&&(this.markUsedOrientation(E,vo,je),this.placedOrientations[xt]=vo),tr};Ii(()=>mi(yo,u.WritingMode.horizontal),()=>{const Xn=et.verticalTextBox;return E.allowVerticalPlacement&&We>0&&Xn?(Si(Xn),mi(Xn,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),_i(!!(en&&en.box&&en.box.length))}}if(ei=en,lt=ei&&ei.box&&ei.box.length>0,pt=ei&&ei.offscreen,It=ei&&ei.occluded,je.useRuntimeCollisionCircles){const _i=E.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),Ii=u.evaluateSizeForFeature(E.textSizeData,ie,_i),mi=I.get("text-padding");Jn=this.collisionIndex.placeCollisionCircles(E,le,_i,E.lineVertexArray,E.glyphOffsetArray,Ii,A,R,B,_,Te,re.predicate,je.collisionCircleDiameter*Ii/u.ONE_EM,mi,this.retainedQueryData[E.bucketInstanceId].tileID),lt=le||Jn.circles.length>0&&!Jn.collisionDetected,pt=pt&&Jn.offscreen,It=Jn.occluded}if(et.iconFeatureIndex&&(Fi=et.iconFeatureIndex),et.iconBox){const _i=Ii=>{Si(Ii);const mi=Ce&&Ln?Al(Ln.x,Ln.y,Ee,Te,this.transform.angle):new u.Point(0,0),Xn=E.getSymbolInstanceIconSize(ne,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Xn,Ii,mi,ce,H,A,re.predicate)};wn&&wn.box&&wn.box.length&&et.verticalIconBox?(Kt=_i(et.verticalIconBox),Dt=Kt.box.length>0):(Kt=_i(et.iconBox),Dt=Kt.box.length>0),pt=pt&&Kt.offscreen,un=Kt.occluded}const co=G||0===je.numHorizontalGlyphVertices&&0===We,Yo=ee||0===je.numIconVertices;if(co||Yo?Yo?co||(Dt=Dt&&lt):lt=Dt&&lt:Dt=lt=Dt&&lt,lt&&ei&&ei.box&&this.collisionIndex.insertCollisionBox(ei.box,I.get("text-ignore-placement"),E.bucketInstanceId,wn&&wn.box&&Ni?Ni:Ti,re.ID),Dt&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,I.get("icon-ignore-placement"),E.bucketInstanceId,Fi,re.ID),Jn&&(lt&&this.collisionIndex.insertCollisionCircles(Jn.circles,I.get("text-ignore-placement"),E.bucketInstanceId,Ti,re.ID),_)){const _i=E.bucketInstanceId;let Ii=this.collisionCircleArrays[_i];void 0===Ii&&(Ii=this.collisionCircleArrays[_i]=new Ei);for(let mi=0;mi<Jn.circles.length;mi+=4)Ii.circles.push(Jn.circles[mi+0]),Ii.circles.push(Jn.circles[mi+1]),Ii.circles.push(Jn.circles[mi+2]),Ii.circles.push(Jn.collisionDetected?1:0)}const Ba="globe"!==E.projection.name;Pe=Pe&&(Ba||!It),Xe=Xe&&(Ba||!un),this.placements[xt]=new js(lt||Pe,Dt||Xe,pt||E.justReloaded),f.add(xt)};if(Ne){const je=E.getSortedSymbolIndexes(this.transform.angle);for(let ut=je.length-1;ut>=0;--ut){const et=je[ut];Et(E.symbolInstances.get(et),et,E.collisionArrays[et])}}else for(let je=a.symbolInstanceStart;je<a.symbolInstanceEnd;je++)Et(E.symbolInstances.get(je),je,E.collisionArrays[je]);if(_&&E.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[E.bucketInstanceId];u.invert(je.invProjMatrix,A),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(a,f,_,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R,crossTileID:B}=_,z=u.getAnchorJustification(f),H=b===u.WritingMode.vertical?R:"left"===z?E:"center"===z?I:"right"===z?A:-1;E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=H>=0&&E!==H?0:B),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:B),A>=0&&(a.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:B),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=H>=0&&R!==H?0:B)}markUsedOrientation(a,f,_){const b=f===u.WritingMode.horizontal||f===u.WritingMode.horizontalOnly?f:0,E=f===u.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:B}=_,z=a.text.placedSymbolArray;I>=0&&(z.get(I).placedOrientation=b),A>=0&&(z.get(A).placedOrientation=b),R>=0&&(z.get(R).placedOrientation=b),B>=0&&(z.get(B).placedOrientation=E)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(a):1,E=f?f.opacities:{},I=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(const R in this.placements){const B=this.placements[R],z=E[R];z?(this.opacities[R]=new Po(z,b,B.text,B.icon,null,B.clipped),_=_||B.text!==z.text.placed||B.icon!==z.icon.placed):(this.opacities[R]=new Po(null,b,B.text,B.icon,B.skipFade,B.clipped),_=_||B.text||B.icon)}for(const R in E){const B=E[R];if(!this.opacities[R]){const z=new Po(B,b,!1,!1);z.isHidden()||(this.opacities[R]=z,_=_||B.text.placed||B.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);_?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const _=new Set;for(const b of f){const E=b.getBucket(a);E&&b.latestFeatureIndex&&a.id===E.layerIds[0]&&this.updateBucketOpacities(E,_,b.collisionBoxArray)}}updateBucketOpacities(a,f,_){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const b=a.layers[0].layout,E=!!a.layers[0].dynamicFilter(),I=new Po(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),B=b.get("text-variable-anchor"),z="map"===b.get("text-rotation-alignment"),H="map"===b.get("text-pitch-alignment"),K="none"!==b.get("icon-text-fit"),te=new Po(null,0,A&&(R||!a.hasIconData()||b.get("icon-optional")),R&&(A||!a.hasTextData()||b.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const ie=(re,G,ee)=>{for(let le=0;le<G/4;le++)re.opacityVertexArray.emplaceBack(ee)};let ne=0;for(let re=0;re<a.symbolInstances.length;re++){const G=a.symbolInstances.get(re),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:le,crossTileID:ce,numIconVertices:Ee}=G,Te=f.has(ce);let Ce=this.opacities[ce];Te?Ce=I:Ce||(Ce=te,this.opacities[ce]=Ce),f.add(ce);const Ne=ee>0||le>0,Pe=Ee>0,Xe=this.placedOrientations[ce],Et=Xe===u.WritingMode.vertical,je=Xe===u.WritingMode.horizontal||Xe===u.WritingMode.horizontalOnly;if(!Ne&&!Pe||Ce.isHidden()||ne++,Ne){const ut=Or(Ce.text);ie(a.text,ee,Et?lr:ut),ie(a.text,le,je?lr:ut);const et=Ce.text.isHidden(),{leftJustifiedTextSymbolIndex:xt,centerJustifiedTextSymbolIndex:We,rightJustifiedTextSymbolIndex:lt,verticalPlacedTextSymbolIndex:Dt}=G,pt=a.text.placedSymbolArray,It=et||Et?1:0;xt>=0&&(pt.get(xt).hidden=It),We>=0&&(pt.get(We).hidden=It),lt>=0&&(pt.get(lt).hidden=It),Dt>=0&&(pt.get(Dt).hidden=et||je?1:0);const un=this.variableOffsets[ce];un&&this.markUsedJustification(a,un.anchor,G,Xe);const Ln=this.placedOrientations[ce];Ln&&(this.markUsedJustification(a,"left",G,Ln),this.markUsedOrientation(a,Ln,G))}if(Pe){const ut=Or(Ce.icon),{placedIconSymbolIndex:et,verticalPlacedIconSymbolIndex:xt}=G,We=a.icon.placedSymbolArray,lt=Ce.icon.isHidden()?1:0;et>=0&&(ie(a.icon,Ee,Et?lr:ut),We.get(et).hidden=lt),xt>=0&&(ie(a.icon,G.numVerticalIconVertices,je?lr:ut),We.get(xt).hidden=lt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ut=a.collisionArrays[re];if(ut){let et=new u.Point(0,0),xt=!0;if(ut.textBox||ut.verticalTextBox){if(B){const lt=this.variableOffsets[ce];lt?(et=$s(lt.anchor,lt.width,lt.height,lt.textOffset,lt.textScale),z&&et._rotate(H?this.transform.angle:-this.transform.angle)):xt=!1}E&&(xt=!Ce.clipped),ut.textBox&&Mt(a.textCollisionBox.collisionVertexArray,Ce.text.placed,!xt||Et,et.x,et.y),ut.verticalTextBox&&Mt(a.textCollisionBox.collisionVertexArray,Ce.text.placed,!xt||je,et.x,et.y)}const We=xt&&!(je||!ut.verticalIconBox);ut.iconBox&&Mt(a.iconCollisionBox.collisionVertexArray,Ce.icon.placed,We,K?et.x:0,K?et.y:0),ut.verticalIconBox&&Mt(a.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!We,K?et.x:0,K?et.y:0)}}}if(a.fullyClipped=0===ne,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=re.invProjMatrix,a.placementViewportMatrix=re.viewportMatrix,a.collisionCircleArray=re.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function Mt(m,a,f,_,b){m.emplaceBack(a?1:0,f?1:0,_||0,b||0),m.emplaceBack(a?1:0,f?1:0,_||0,b||0),m.emplaceBack(a?1:0,f?1:0,_||0,b||0),m.emplaceBack(a?1:0,f?1:0,_||0,b||0)}const kr=Math.pow(2,25),cn=Math.pow(2,24),on=Math.pow(2,17),$o=Math.pow(2,16),ai=Math.pow(2,9),Ro=Math.pow(2,8),Pl=Math.pow(2,1);function Or(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const a=m.placed?1:0,f=Math.floor(127*m.opacity);return f*kr+a*cn+f*on+a*$o+f*ai+a*Ro+f*Pl+a}const lr=0;class as{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,_,b,E){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(I,b,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(f.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class Wc{constructor(a,f,_,b,E,I,A,R){this.placement=new Ma(a,E,I,A,R),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(a,f,_){const b=u.exported.now(),E=()=>{const I=u.exported.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=f[a[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new as(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Wr=512/u.EXTENT/2;class Ci{constructor(a,f,_){this.tileID=a,this.bucketInstanceId=_,this.index=new u.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=a.canonical.x*u.EXTENT,E=a.canonical.y*u.EXTENT;for(let I=0;I<f.length;I++){const{key:A,crossTileID:R,tileAnchorX:B,tileAnchorY:z}=f.get(I),H=Math.floor((b+B)*Wr),K=Math.floor((E+z)*Wr);this.index.add(H,K),this.keys.push(A),this.crossTileIDs.push(R)}this.index.finish()}findMatches(a,f,_){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=Wr/Math.pow(2,f.canonical.z-this.tileID.canonical.z),I=f.canonical.x*u.EXTENT,A=f.canonical.y*u.EXTENT;for(let R=0;R<a.length;R++){const B=a.get(R);if(B.crossTileID)continue;const{key:z,tileAnchorX:H,tileAnchorY:K}=B,te=Math.floor((I+H)*E),ie=Math.floor((A+K)*E),ne=this.index.range(te-b,ie-b,te+b,ie+b);for(const re of ne){const G=this.crossTileIDs[re];if(this.keys[re]===z&&!_.has(G)){_.add(G),B.crossTileID=G;break}}}}}class Sa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ku{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(0!==f)for(const _ in this.indexes){const b=this.indexes[_],E={};for(const I in b){const A=b[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),E[A.tileID.key]=A}this.indexes[_]=E}this.lng=a}addBucket(a,f,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let E=0;E<f.symbolInstances.length;E++)f.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const b=this.usedCrossTileIDs[a.overscaledZ];for(const E in this.indexes){const I=this.indexes[E];if(Number(E)>a.overscaledZ)for(const A in I){const R=I[A];R.tileID.isChildOf(a)&&R.findMatches(f.symbolInstances,a,b)}else{const A=I[a.scaledTo(Number(E)).key];A&&A.findMatches(f.symbolInstances,a,b)}}for(let E=0;E<f.symbolInstances.length;E++){const I=f.symbolInstances.get(E);I.crossTileID||(I.crossTileID=_.generate(),b.add(I.crossTileID))}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Ci(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const _ of f.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let f=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const E in b)a[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[E]),delete b[E],f=!0)}return f}}class Hs{constructor(){this.layerIndexes={},this.crossTileIDs=new Sa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,_,b){let E=this.layerIndexes[a.id];void 0===E&&(E=this.layerIndexes[a.id]=new ku);let I=!1;const A={};"globe"!==b.name&&E.handleWrapJump(_);for(const R of f){const B=R.getBucket(a);B&&a.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(R.tileID,B,this.crossTileIDs)&&(I=!0),A[B.bucketInstanceId]=!0)}return E.removeStaleBuckets(A)&&(I=!0),I}pruneUnusedLayers(a){const f={};a.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Ia=(m,a)=>u.emitValidationErrors(m,a&&a.filter(f=>"source.canvas"!==f.identifier)),Xc=u.pick(Kn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ou=u.pick(Kn,["setCenter","setZoom","setBearing","setPitch"]),Fh={version:8,layers:[],sources:{}},Ur={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class jt extends u.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new rr(Ea(),this),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(a._requestManager,f.localFontFamily?u.LocalGlyphMode.all:f.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new Hs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const _=this;this._rtlTextPluginCallback=jt.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,I)=>{if(u.triggerPluginCompletionEvent(E),I&&I.every(A=>A))for(const A in _._sourceCaches){const R=_._sourceCaches[A],B=R.getSource().type;"vector"!==B&&"geojson"!==B||R.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===E.id&&this._validateLayer(A)}})}loadURL(a,f={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof f.validate?f.validate:!u.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const b=this.map._requestManager.transformRequest(a,u.ResourceType.Style);this._request=u.getJSON(b,(E,I)=>{this._request=null,E?this.fire(new u.ErrorEvent(E)):I&&this._load(I,_)})}loadJSON(a,f={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(a,!1!==f.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Fh,!1)}_updateLayerCount(a,f){const _=f?1:-1;a.is3D()&&(this._num3DLayers+=_),"circle"===a.type&&(this._numCircleLayers+=_),"symbol"===a.type&&(this._numSymbolLayers+=_)}_load(a,f){if(f&&Ia(this,u.validateStyle(a)))return;this._loaded=!0,this.stylesheet=u.clone$1(a),this._updateMapProjection();for(const b in a.sources)this.addSource(b,a.sources[b],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const _=Nh(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of _){const E=u.createStyleLayer(b);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Tn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(f,_,b){let E,I,A;const R=u.exported.devicePixelRatio>1?"@2x":"";let B=u.getJSON(_.transformRequest(_.normalizeSpriteURL(f,R,".json"),u.ResourceType.SpriteJSON),(K,te)=>{B=null,A||(A=K,E=te,H())}),z=u.getImage(_.transformRequest(_.normalizeSpriteURL(f,R,".png"),u.ResourceType.SpriteImage),(K,te)=>{z=null,A||(A=K,I=te,H())});function H(){if(A)b(A);else if(E&&I){const K=u.exported.getImageData(I),te={};for(const ie in E){const{width:ne,height:re,x:G,y:ee,sdf:le,pixelRatio:ce,stretchX:Ee,stretchY:Te,content:Ce}=E[ie],Ne=new u.RGBAImage({width:ne,height:re});u.RGBAImage.copy(K,Ne,{x:G,y:ee},{x:0,y:0},{width:ne,height:re}),te[ie]={data:Ne,pixelRatio:ce,sdf:le,stretchX:Ee,stretchY:Te,content:Ce}}b(null,te)}}return{cancel(){B&&(B.cancel(),B=null),z&&(z.cancel(),z=null)}}}(a,this.map._requestManager,(f,_)=>{if(this._spriteRequest=null,f)this.fire(new u.ErrorEvent(f));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const _=a.sourceLayer;_&&("geojson"===f.type||f.vectorLayerIds&&-1===f.vectorLayerIds.indexOf(_))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const _ of a){const b=this._layers[_];"custom"!==b.type&&f.push(b.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&("function"==typeof a.isLayerDraped?a.isLayerDraped():Ur[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const I in this._updatedSources){const A=this._updatedSources[I];"reload"===A?this._reloadSource(I):"clear"===A&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const E=this._sourceCaches[b];_[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];if(E.recalculate(a,this._availableImages),!E.isHidden(a.zoom)){const A=this._getLayerSourceCache(E);A&&(A.used=!0)}const I=this.map.painter;if(I){const A=E.getProgramIds();if(!A)continue;const R=E.getProgramConfiguration(a.zoom);for(const B of A)I.useProgram(B,R)}}for(const b in _){const E=this._sourceCaches[b];_[b]!==E.used&&E.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Ia(this,u.validateStyle(a)))return!1;(a=u.clone$1(a)).layers=Nh(a.layers);const f=function(b,E){if(!b)return[{command:Kn.setStyle,args:[E]}];let I=[];try{if(!Q(b.version,E.version))return[{command:Kn.setStyle,args:[E]}];Q(b.center,E.center)||I.push({command:Kn.setCenter,args:[E.center]}),Q(b.zoom,E.zoom)||I.push({command:Kn.setZoom,args:[E.zoom]}),Q(b.bearing,E.bearing)||I.push({command:Kn.setBearing,args:[E.bearing]}),Q(b.pitch,E.pitch)||I.push({command:Kn.setPitch,args:[E.pitch]}),Q(b.sprite,E.sprite)||I.push({command:Kn.setSprite,args:[E.sprite]}),Q(b.glyphs,E.glyphs)||I.push({command:Kn.setGlyphs,args:[E.glyphs]}),Q(b.transition,E.transition)||I.push({command:Kn.setTransition,args:[E.transition]}),Q(b.light,E.light)||I.push({command:Kn.setLight,args:[E.light]}),Q(b.fog,E.fog)||I.push({command:Kn.setFog,args:[E.fog]}),Q(b.projection,E.projection)||I.push({command:Kn.setProjection,args:[E.projection]});const A={},R=[];!function(H,K,te,ie){let ne;for(ne in K=K||{},H=H||{})H.hasOwnProperty(ne)&&(K.hasOwnProperty(ne)||vr(ne,te,ie));for(ne in K){if(!K.hasOwnProperty(ne))continue;const re=K[ne];H.hasOwnProperty(ne)?Q(H[ne],re)||("geojson"===H[ne].type&&"geojson"===re.type&&oo(H,K,ne)?te.push({command:Kn.setGeoJSONSourceData,args:[ne,re.data]}):Ca(ne,K,te,ie)):Ru(ne,K,te)}}(b.sources,E.sources,R,A);const B=[];b.layers&&b.layers.forEach(H=>{H.source&&A[H.source]?I.push({command:Kn.removeLayer,args:[H.id]}):B.push(H)});let z=b.terrain;z&&A[z.source]&&(I.push({command:Kn.setTerrain,args:[void 0]}),z=void 0),I=I.concat(R),Q(z,E.terrain)||I.push({command:Kn.setTerrain,args:[E.terrain]}),function(H,K,te){K=K||[];const ie=(H=H||[]).map(Bs),ne=K.map(Bs),re=H.reduce(Lu,{}),G=K.reduce(Lu,{}),ee=ie.slice(),le=Object.create(null);let ce,Ee,Te,Ce,Ne,Pe,Xe;for(ce=0,Ee=0;ce<ie.length;ce++)Te=ie[ce],G.hasOwnProperty(Te)?Ee++:(te.push({command:Kn.removeLayer,args:[Te]}),ee.splice(ee.indexOf(Te,Ee),1));for(ce=0,Ee=0;ce<ne.length;ce++)Te=ne[ne.length-1-ce],ee[ee.length-1-ce]!==Te&&(re.hasOwnProperty(Te)?(te.push({command:Kn.removeLayer,args:[Te]}),ee.splice(ee.lastIndexOf(Te,ee.length-Ee),1)):Ee++,Pe=ee[ee.length-ce],te.push({command:Kn.addLayer,args:[G[Te],Pe]}),ee.splice(ee.length-ce,0,Te),le[Te]=!0);for(ce=0;ce<ne.length;ce++)if(Te=ne[ce],Ce=re[Te],Ne=G[Te],!le[Te]&&!Q(Ce,Ne))if(Q(Ce.source,Ne.source)&&Q(Ce["source-layer"],Ne["source-layer"])&&Q(Ce.type,Ne.type)){for(Xe in zs(Ce.layout,Ne.layout,te,Te,null,Kn.setLayoutProperty),zs(Ce.paint,Ne.paint,te,Te,null,Kn.setPaintProperty),Q(Ce.filter,Ne.filter)||te.push({command:Kn.setFilter,args:[Te,Ne.filter]}),Q(Ce.minzoom,Ne.minzoom)&&Q(Ce.maxzoom,Ne.maxzoom)||te.push({command:Kn.setLayerZoomRange,args:[Te,Ne.minzoom,Ne.maxzoom]}),Ce)Ce.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?zs(Ce[Xe],Ne[Xe],te,Te,Xe.slice(6),Kn.setPaintProperty):Q(Ce[Xe],Ne[Xe])||te.push({command:Kn.setLayerProperty,args:[Te,Xe,Ne[Xe]]}));for(Xe in Ne)Ne.hasOwnProperty(Xe)&&!Ce.hasOwnProperty(Xe)&&"layout"!==Xe&&"paint"!==Xe&&"filter"!==Xe&&"metadata"!==Xe&&"minzoom"!==Xe&&"maxzoom"!==Xe&&(0===Xe.indexOf("paint.")?zs(Ce[Xe],Ne[Xe],te,Te,Xe.slice(6),Kn.setPaintProperty):Q(Ce[Xe],Ne[Xe])||te.push({command:Kn.setLayerProperty,args:[Te,Xe,Ne[Xe]]}))}else te.push({command:Kn.removeLayer,args:[Te]}),Pe=ee[ee.lastIndexOf(Te)+1],te.push({command:Kn.addLayer,args:[Ne,Pe]})}(B,E.layers,I)}catch(A){console.warn("Unable to compute style diff:",A),I=[{command:Kn.setStyle,args:[E]}]}return I}(this.serialize(),a).filter(b=>!(b.command in Ou));if(0===f.length)return!1;const _=f.filter(b=>!(b.command in Xc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return f.forEach(b=>{"setTransition"!==b.command&&"setProjection"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,_={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(u.validateSource,`sources.${a}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=Sn(a,f,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:b.serialize(),sourceId:a}));const E=I=>{const A=(I?"symbol:":"other:")+a,R=this._sourceCaches[A]=new u.SourceCache(A,b,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=R,R.style=this,R.onAdd(this.map)};E(!1),"vector"!==f.type&&"geojson"!==f.type||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===a)return this.fire(new u.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new u.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(a);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}_getSources(){const a=[];for(const f in this._otherSourceCaches){const _=this._getSourceCache(f);_&&a.push(_.getSource())}return a}addLayer(a,f,_={}){this._checkLoaded();const b=a.id;if(this.getLayer(b))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if("custom"===a.type){if(Ia(this,u.validateCustomStyleLayer(a)))return;E=u.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(b,a.source),a=u.clone$1(a),a=u.extend(a,{source:b})),this._validate(u.validateLayer,`layers.${b}`,a,{arrayIndex:-1},_))return;E=u.createStyleLayer(a),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const I=f?this._order.indexOf(f):this._order.length;if(f&&-1===I)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=E;const A=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&A&&"custom"!==E.type){const R=this._removedLayers[b];delete this._removedLayers[b],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",A.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const _=this._order.indexOf(a);this._order.splice(_,1);const b=f?this._order.indexOf(f):this._order.length;f&&-1===b?this.fire(new u.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(b,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,_){this._checkLoaded();const b=this.getLayer(a);b?b.minzoom===f&&b.maxzoom===_||(null!=f&&(b.minzoom=f),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,_={}){this._checkLoaded();const b=this.getLayer(a);if(b){if(!Q(b.filter,f))return null==f?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(u.validateFilter,`layers.${b.id}.filter`,f,{layerType:b.type},_)||(b.filter=u.clone$1(f),this._updateLayer(b)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&u.clone$1(f.filter)}setLayoutProperty(a,f,_,b={}){this._checkLoaded();const E=this.getLayer(a);E?Q(E.getLayoutProperty(f),_)||(E.setLayoutProperty(f,_,b),this._updateLayer(E)):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const _=this.getLayer(a);if(_)return _.getLayoutProperty(f);this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,_,b={}){this._checkLoaded();const E=this.getLayer(a);E?Q(E.getPaintProperty(f),_)||(E.setPaintProperty(f,_,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const _=this.getLayer(a);return _&&_.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const _=a.source,b=a.sourceLayer,E=this.getSource(_);if(!E)return void this.fire(new u.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=E.type;if("geojson"===I&&b)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!b)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const R of A)R.setFeatureState(b,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const _=a.source,b=this.getSource(_);if(!b)return void this.fire(new u.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const E=b.type,I="vector"===E?a.sourceLayer:void 0;if("vector"===E&&!I)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const R of A)R.removeFeatureState(I,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,_=a.sourceLayer,b=this.getSource(f);if(b){if("vector"!==b.type||_)return void 0===a.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(_,a.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const _=this._sourceCaches[f].getSource();a[_.id]||(a[_.id]=_.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},f=>void 0!==f)}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&"raster"!==f.getSource().type&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=I=>"fill-extrusion"===this._layers[I].type,_={},b=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(f(A)){_[A]=I;for(const R of a){const B=R[A];if(B)for(const z of B)b.push(z)}}}b.sort((I,A)=>A.intersectionZ-I.intersectionZ);const E=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(f(A))for(let R=b.length-1;R>=0;R--){const B=b[R].feature;if(_[B.layer.id]<I)break;E.push(B),b.pop()}else for(const R of a){const B=R[A];if(B)for(const z of B)E.push(z.feature)}}return E}queryRenderedFeatures(a,f,_){f&&f.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of f.layers){const B=this._layers[R];if(!B)return this.fire(new u.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const E=[];f.availableImages=this._availableImages;const I=f&&f.layers?f.layers.some(R=>{const B=this.getLayer(R);return B&&B.is3D()}):this.has3DLayers(),A=In.createFromScreenPoints(a,_);for(const R in this._sourceCaches){const B=this._sourceCaches[R].getSource().id;f.layers&&!b[B]||E.push(Ui(this._sourceCaches[R],this._layers,this._serializedLayers,A,f,_,I,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(R,B,z,H,K,te,ie){const ne={},re=te.queryRenderedSymbols(H),G=[];for(const ee of Object.keys(re).map(Number))G.push(ie[ee]);G.sort(Mi);for(const ee of G){const le=ee.featureIndex.lookupSymbolFeatures(re[ee.bucketInstanceId],B,ee.bucketIndex,ee.sourceLayerIndex,K.filter,K.layers,K.availableImages,R);for(const ce in le){const Ee=ne[ce]=ne[ce]||[],Te=le[ce];Te.sort((Ce,Ne)=>{const Pe=ee.featureSortOrder;if(Pe){const Xe=Pe.indexOf(Ce.featureIndex);return Pe.indexOf(Ne.featureIndex)-Xe}return Ne.featureIndex-Ce.featureIndex});for(const Ce of Te)Ee.push(Ce)}}for(const ee in ne)ne[ee].forEach(le=>{const ce=le.feature,Ee=z(R[ee]);if(!Ee)return;const Te=Ee.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=Te});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(a,f){f&&f.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const _=this._getSourceCaches(a);let b=[];for(const E of _)b=b.concat(pr(E,f));return b}addSourceType(a,f,_){return jt.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(jt.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const I in a)if(!Q(a[I],_[I])){b=!0;break}if(!b)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,f),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=a;if(1===f){if("object"==typeof _.source){const b="terrain-dem-src";this.addSource(b,_.source),_=u.clone$1(_),_=u.extend(_,{source:b})}if(this._validate(u.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,f)}else{const b=this.terrain,E=b.get();for(const I of Object.keys(u.spec.terrain))!_.hasOwnProperty(I)&&u.spec.terrain[I].default&&(_[I]=u.spec.terrain[I].default);for(const I in _)if(!Q(_[I],E[I])){b.set(_),this.stylesheet.terrain=_;const A=this._setTransitionParameters({duration:0});b.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new En(a,this.map.transform);this.stylesheet.fog=a;const _=this._setTransitionParameters({duration:0});f.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,_=f.get();0===Object.keys(a).length&&f.set(a);for(const b in a)if(!Q(a[b],_[b])){f.set(a),this.stylesheet.fog=a;const E=this._setTransitionParameters({duration:0});f.updateTransitions(E);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:u.exported.now(),transition:u.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(_=>this.isLayerDraped(this._layers[_])),f=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const _=this.terrain=new qi(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});_.updateTransitions(b)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];"fill-extrusion"===f.type&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];"symbol"===f.type&&this._updateLayer(f)}}_validate(a,f,_,b,E={}){return(!E||!1!==E.validate)&&Ia(this,a.call(u.validateStyle,u.extend({key:f,style:this.serialize(),value:_,styleSpec:u.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const _ of f)_.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const _ of f)_.resume(),_.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,_,b,E=!1){let I=!1,A=!1;const R={};for(const B of this._order){const z=this._layers[B];if("symbol"!==z.type)continue;if(!R[z.source]){const K=this._getLayerSourceCache(z);if(!K)continue;R[z.source]=K.getRenderableIds(!0).map(te=>K.getTileByID(te)).sort((te,ie)=>ie.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ie.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,R[z.source],a.center.lng,a.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),a.zoom))&&(this.pauseablePlacement=new Wc(a,this._order,E,f,_,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const B of this._order){const z=this._layers[B];"symbol"===z.type&&this.placement.updateLayerOpacities(z,R[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,_){this.imageManager.getImages(f.icons,_),this._updateTilesForChangedImages();const b=E=>{E&&E.setDependencies(f.tileID.key,f.type,f.icons)};b(this._otherSourceCaches[f.source]),b(this._symbolSourceCaches[f.source])}getGlyphs(a,f,_){this.glyphManager.getGlyphs(f.stacks,_)}getResource(a,f,_){return u.makeRequest(f,_)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return 0===f.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}jt.getSourceType=function(m){return zn[m]},jt.setSourceType=function(m,a){zn[m]=a},jt.registerForPluginStateChange=u.registerForPluginStateChange;var zh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",so="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ho="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",an="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Aa="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Nr={},Gs={};const Rl=[];Xr(zh,Rl),Xr(Ho,Rl),Xr(an,Rl),Xr(Aa,Rl),Nr=fi("",Ho),Gs=fi(Aa,an);const Nu=fi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Yc=zh,Pa="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Ll={background:fi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:fi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:fi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:fi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:fi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:fi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:fi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:fi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:fi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:fi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:fi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:fi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:fi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:fi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:fi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:fi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:fi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:fi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:fi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",so),skyboxGradient:fi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",so),skyboxCapture:fi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:fi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Xr(m,a){const f=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of f)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=_.split(" ");for(const E of b)a.includes(E)||a.push(E)}}function fi(m,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...Rl];return Xr(m,E),Xr(a,E),{fragmentSource:m=m.replace(f,(I,A,R,B,z)=>(b[z]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = u_${z};\n#endif\n`)),vertexSource:a=a.replace(f,(I,A,R,B,z)=>{const H="float"===B?"vec2":"vec4",K=z.match(/color/)?"color":H;return b[z]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\nvarying ${R} ${B} ${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${R} ${H} a_${z};\n#else\nuniform ${R} ${B} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = a_${z};\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${R} ${B} ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${R} ${B} ${z} = u_${z};\n#endif\n`}),staticAttributes:_,usedDefines:E}}class Bh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,_,b,E,I,A){this.context=a;let R=this.boundPaintVertexBuffers.length!==b.length;for(let z=0;!R&&z<b.length;z++)this.boundPaintVertexBuffers[z]!==b[z]&&(R=!0);let B=this.boundDynamicVertexBuffers.length!==A.length;for(let z=0;!B&&z<A.length;z++)this.boundDynamicVertexBuffers[z]!==A[z]&&(B=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||R||B||this.boundIndexBuffer!==E||this.boundVertexOffset!==I)this.freshBind(f,_,b,E,I,A);else{a.bindVertexArrayOES.set(this.vao);for(const z of A)z&&z.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(a,f,_,b,E,I){let A;const R=a.numAttributes,B=this.context,z=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=I;else{A=B.currentNumAttributes||0;for(let H=R;H<A;H++)z.disableVertexAttribArray(H)}f.enableAttributes(z,a),f.bind(),f.setVertexAttribPointers(z,a,E);for(const H of _)H.enableAttributes(z,a),H.bind(),H.setVertexAttribPointers(z,a,E);for(const H of I)H&&(H.enableAttributes(z,a),H.bind(),H.setVertexAttribPointers(z,a,E));b&&b.bind(),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function $n(m,a){const f=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new u.MercatorCoordinate(0,_/f).toLngLat().lat,new u.MercatorCoordinate(0,(_+1)/f).toLngLat().lat]}function cc(m,a,f,_,b,E,I){const A=m.context,R=A.gl,B=f.fbo;if(!B)return;m.prepareDrawTile();const z=m.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,B.colorAttachment.get());const H=((ne,re,G,ee)=>{const le=G.paint.get("hillshade-shadow-color"),ce=G.paint.get("hillshade-highlight-color"),Ee=G.paint.get("hillshade-accent-color");let Te=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(Te-=ne.transform.angle);const Ce=!ne.options.moving;return{u_matrix:ee||ne.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:$n(0,re.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Te],u_shadow:le,u_highlight:ce,u_accent:Ee}})(m,f,_,m.terrain?a.projMatrix:null);m.prepareDrawProgram(A,z,a.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:te,tileBoundsSegments:ie}=m.getTileBoundsBuffers(f);z.draw(A,R.TRIANGLES,b,E,I,u.CullFaceMode.disabled,H,_.id,K,te,ie)}function uc(m,a,f){if(!a.needsDEMTextureUpload)return;const _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(f.stride);const E=f.getPixels();a.demTexture?a.demTexture.update(E,{premultiply:!1}):a.demTexture=new u.Texture(_,E,b.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Yr(m,a,f,_,b,E){const I=m.context,A=I.gl;if(!a.dem)return;const R=a.dem;if(I.activeTexture.set(A.TEXTURE1),uc(m,a,R),!a.demTexture)return;a.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const B=R.dim;I.activeTexture.set(A.TEXTURE0);let z=a.fbo;if(!z){const ie=new u.Texture(I,{width:B,height:B,data:null},A.RGBA);ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),z=a.fbo=I.createFramebuffer(B,B,!0),z.colorAttachment.set(ie.texture)}I.bindFramebuffer.set(z.framebuffer),I.viewport.set([0,0,B,B]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:te}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,b,E,u.CullFaceMode.disabled,((ie,ne)=>{const re=ne.stride,G=u.create();return u.ortho(G,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(G,G,[0,-u.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[re,re],u_zoom:ie.overscaledZ,u_unpack:ne.unpackVector}})(a.tileID,R),f.id,H,K,te),a.needsHillshadePrepare=!1}const Kc=m=>({u_matrix:new u.UniformMatrix4f(m),u_image0:new u.Uniform1i(m),u_skirt_height:new u.Uniform1f(m)}),kl=(m,a)=>({u_matrix:m,u_image0:0,u_skirt_height:a}),Di=(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:f,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:I,u_frustum_tr:A,u_frustum_br:R,u_frustum_bl:B,u_globe_pos:z,u_globe_radius:H,u_viewport:K,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:te});function hc(m,a){return null!=m&&null!=a&&!(!m.hasData()||!a.hasData())&&null!=m.demTexture&&null!=a.demTexture&&m.tileID.key!==a.tileID.key}const Ra=new class{constructor(){this.operations={}}newMorphing(m,a,f,_,b){if(m in this.operations){const E=this.operations[m];E.to.tileID.key!==f.tileID.key&&(E.queued=f)}else this.operations[m]={startTime:_,phase:0,duration:b,from:a,to:f,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const f=this.operations[a];for(f.phase=(m-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Xt={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ol(m){return 6*Math.pow(1.5,22-m)}function dc(m,a){const f=1<<m.z;return!a&&(0===m.x||m.x===f-1)||0===m.y||m.y===f-1}const nl=m=>({u_matrix:m});function La(m,a,f,_,b){if(b>0){const E=u.exported.now(),I=(E-m.timeAdded)/b,A=a?(E-a.timeAdded)/b:-1,R=f.getSource(),B=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),z=!a||Math.abs(a.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),H=z&&m.refreshedUponExpiration?1:u.clamp(z?I:1-A,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class qs extends u.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new rr(Ea(),null),b=Sn("mock-dem",f,_,a.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class Nl extends u.SourceCache{constructor(a){const f=Sn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new rr(Ea(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,_){if(a.freezeTileCoverage)return;this.transform=a;const b=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,I)=>{if(E[I.key]="",!this._tiles[I.key]){const A=new u.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);A.state="loaded",this._tiles[I.key]=A}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(a){const f=this.proxyCachedFBO[a];if(void 0!==f){const _=Object.values(f);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class il extends u.OverscaledTileID{constructor(a,f,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=_}}class Lo extends u.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,E]=function(R){const B=new u.StructArrayLayout2i4,z=new u.StructArrayLayout3ui6,H=131;B.reserve(17161),z.reserve(33800);const K=u.EXTENT/128,te=u.EXTENT+K/2,ie=te+K;for(let re=-K;re<ie;re+=K)for(let G=-K;G<ie;G+=K){const ee=G<0||G>te||re<0||re>te?24575:0,le=u.clamp(Math.round(G),0,u.EXTENT),ce=u.clamp(Math.round(re),0,u.EXTENT);B.emplaceBack(le+ee,ce)}const ne=(re,G)=>{const ee=G*H+re;z.emplaceBack(ee+1,ee,ee+H),z.emplaceBack(ee+H,ee+H+1,ee+1)};for(let re=1;re<129;re++)for(let G=1;G<129;G++)ne(G,re);return[0,129].forEach(re=>{for(let G=0;G<130;G++)ne(G,re),ne(re,G)}),[B,z,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(_,u.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(b),this.gridSegments=u.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,_.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nl(f.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const A=I.gl;this._overlapStencilMode=new u.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qs(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,f,_){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const b=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const E=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(f,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),f.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=f.getIds().map(R=>{const B=f.getTileByID(R).tileID;return B.projMatrix=_.calculateProjMatrix(B.toUnwrapped()),B});(function(R,B){const z=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new u.Point(z.x,z.y);R.sort((K,te)=>{if(te.overscaledZ-K.overscaledZ)return te.overscaledZ-K.overscaledZ;const ie=new u.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ne=new u.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),re=H.mult(1<<K.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(ie)-re.distSqr(ne)})})(b,this.painter),this._previousZoom=_.zoom;const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const B=I[R];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,a[R],E),B.usedForTerrain))continue;const z=a[R];B.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[f.id]=b.map(R=>new il(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const B=this.terrainTileForTile[R.key];if(!B)continue;const z=B.tileID.key;z in A||(this._visibleDemTiles.push(B),A[z]=z)}}_assignTerrainTiles(a){this._initializing||a.forEach(f=>{if(this.terrainTileForTile[f.key])return;const _=this._findTileCoveringTileID(f,this.sourceCache);_&&(this.terrainTileForTile[f.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),uc(this.painter,b,E))}}_prepareDemTileUniforms(a,f,_,b){if(!f||null==f.demTexture)return!1;const E=a.tileID.canonical,I=Math.pow(2,f.tileID.canonical.z-E.z),A=b||"";return _[`u_dem_tl${A}`]=[E.x*I%1,E.y*I%1],_[`u_dem_scale${A}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const _=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(a,_,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const E=b.dem.tree.minimums[0];return E>0&&a++,_+E},0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new u.Texture(a,b,f.RGBA,{premultiply:!1}),E}setupElevationDraw(a,f,_){const b=this.painter.context,E=b.gl,I=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let R=null,B=null,z=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,K=_.morphing.dstDemTile;z=_.morphing.phase,H&&K&&(this._prepareDemTileUniforms(a,H,I,"_prev")&&(B=H),this._prepareDemTileUniforms(a,K,I)&&(R=K))}if(B&&R?(b.activeTexture.set(E.TEXTURE2),R.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),B.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),I.u_dem_lerp=z):(R=this.terrainTileForTile[a.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(a,R,I)?R.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const H=(1<<R.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=H}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),f.setTerrainUniformValues(b,I),"globe"===this.painter.transform.projection.name){const H=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);f.setGlobeUniformValues(b,H)}}globeUniformValues(a,f,_){const b=a.projection;return{u_tile_tl_up:b.upVector(f,0,0),u_tile_tr_up:b.upVector(f,u.EXTENT,0),u_tile_br_up:b.upVector(f,u.EXTENT,u.EXTENT),u_tile_bl_up:b.upVector(f,0,u.EXTENT),u_tile_up_scale:_?u.globeMetersToEcef(1):b.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,_=this.painter.context;0!==a.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,I,A,R){if("globe"===b.transform.projection.name)!function(B,z,H,K,te){const ie=B.context,ne=ie.gl;let re,G;const ee=B.options.showTerrainWireframe?2:0,le=B.transform,ce=u.globeUseCustomAntiAliasing(B,ie,le),Ee=(xt,We)=>{if(G===xt)return;const lt=[Xt[xt],"PROJECTION_GLOBE_VIEW"];ce&&lt.push("CUSTOM_ANTIALIASING"),We&&lt.push(Xt[ee]),re=B.useProgram("globeRaster",null,lt),G=xt},Te=B.colorModeForRenderPass(),Ce=new u.DepthMode(ne.LEQUAL,u.DepthMode.ReadWrite,B.depthRangeFor3D);Ra.update(te);const Ne=u.calculateGlobeMercatorMatrix(le),Pe=[u.mercatorXfromLng(le.center.lng),u.mercatorYfromLat(le.center.lat)],Xe=ee?[!1,!0]:[!1],Et=B.globeSharedBuffers,je=[le.width*u.exported.devicePixelRatio,le.height*u.exported.devicePixelRatio],ut=Float32Array.from(le.globeMatrix),et={useDenormalizedUpVectorScale:!0};if(Xe.forEach(xt=>{const We=B.transform,lt=Ol(We.zoom)*z.exaggeration();G=-1;const Dt=xt?ne.LINES:ne.TRIANGLES;for(const pt of K){const It=H.getTile(pt),un=u.StencilMode.disabled,Ln=z.prevTerrainTileForTile[pt.key],en=z.terrainTileForTile[pt.key];hc(Ln,en)&&Ra.newMorphing(pt.key,Ln,en,te,250),ie.activeTexture.set(ne.TEXTURE0),It.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const wn=Ra.getMorphValuesForProxy(pt.key),ei=wn?1:0;wn&&u.extend$1(et,{morphing:{srcDemTile:wn.from,dstDemTile:wn.to,phase:u.easeCubicInOut(wn.phase)}});const Jn=u.tileCornersToBounds(pt.canonical),Kt=u.getLatitudinalLod(Jn.getCenter().lat),Ti=u.getGridMatrix(pt.canonical,Jn,Kt,We.worldSize/We._pixelsPerMercatorPixel),Ni=u.globeNormalizeECEF(u.globeTileBounds(pt.canonical)),Fi=Di(We.projMatrix,ut,Ne,Ni,u.globeToMercatorTransition(We.zoom),Pe,We.frustumCorners.TL,We.frustumCorners.TR,We.frustumCorners.BR,We.frustumCorners.BL,We.globeCenterInViewSpace,We.globeRadius,je,lt,Ti);if(Ee(ei,xt),z.setupElevationDraw(It,re,et),B.prepareDrawProgram(ie,re,pt.toUnwrapped()),Et){const[Si,yo,co]=xt?Et.getWirefameBuffers(B.context,Kt):Et.getGridBuffers(Kt,0!==lt);re.draw(ie,Dt,Ce,un,Te,u.CullFaceMode.backCCW,Fi,"globe_raster",Si,yo,co)}}}),Et){const xt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&xt.push("CUSTOM_ANTIALIASING"),re=B.useProgram("globeRaster",null,xt);for(const We of K){const{x:lt,y:Dt,z:pt}=We.canonical,It=0===Dt,un=Dt===(1<<pt)-1,[Ln,en,wn,ei]=Et.getPoleBuffers(pt);if(ei&&(It||un)){const Jn=H.getTile(We);ie.activeTexture.set(ne.TEXTURE0),Jn.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Kt=u.globePoleMatrixForTile(pt,lt,le);const Ti=u.globeNormalizeECEF(u.globeTileBounds(We.canonical)),Ni=(Fi,Si)=>Fi.draw(ie,ne.TRIANGLES,Ce,u.StencilMode.disabled,Te,u.CullFaceMode.disabled,Di(le.projMatrix,Kt,Kt,Ti,0,Pe,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,je,0),"globe_pole_raster",Si,wn,ei);z.setupElevationDraw(Jn,re,et),B.prepareDrawProgram(ie,re,We.toUnwrapped()),It&&Ni(re,Ln),un&&(Kt=u.scale(u.create(),Kt,[1,-1,1]),Ni(re,en))}}}}(b,E,I,A,R);else{const B=b.context,z=B.gl;let H,K;const te=b.options.showTerrainWireframe?2:0,ie=(le,ce)=>{if(K===le)return;const Ee=[Xt[le]];ce&&Ee.push(Xt[te]),H=b.useProgram("terrainRaster",null,Ee),K=le},ne=b.colorModeForRenderPass(),re=new u.DepthMode(z.LEQUAL,u.DepthMode.ReadWrite,b.depthRangeFor3D);Ra.update(R);const G=b.transform,ee=Ol(G.zoom)*E.exaggeration();(te?[!1,!0]:[!1]).forEach(le=>{K=-1;const ce=le?z.LINES:z.TRIANGLES,[Ee,Te]=le?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const Ce of A){const Ne=I.getTile(Ce),Pe=u.StencilMode.disabled,Xe=E.prevTerrainTileForTile[Ce.key],Et=E.terrainTileForTile[Ce.key];hc(Xe,Et)&&Ra.newMorphing(Ce.key,Xe,Et,R,250),B.activeTexture.set(z.TEXTURE0),Ne.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const je=Ra.getMorphValuesForProxy(Ce.key),ut=je?1:0;let et;je&&(et={morphing:{srcDemTile:je.from,dstDemTile:je.to,phase:u.easeCubicInOut(je.phase)}});const xt=kl(Ce.projMatrix,dc(Ce.canonical,G.renderWorldCopies)?ee/10:ee);ie(ut,le),E.setupElevationDraw(Ne,H,et),b.prepareDrawProgram(B,H,Ce.toUnwrapped()),H.draw(B,ce,re,Pe,ne,u.CullFaceMode.backCCW,xt,"terrain_raster",E.gridBuffer,Ee,Te)}})}}(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const f=this.painter,_=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],I=this._drapedRenderBatches.shift(),A=[],R=f.style.order;let B=0;for(const z of E){const H=b.getTileByID(z.proxyTileKey),K=b.proxyCachedFBO[z.key]?b.proxyCachedFBO[z.key][a]:void 0,te=void 0!==K?b.renderCache[K]:this.pool[B++],ie=void 0!==K;if(H.texture=te.tex,ie&&!te.dirty){A.push(H.tileID);continue}let ne;_.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(_.clear({color:u.Color.transparent,stencil:0}),te.dirty=!1);for(let re=I.start;re<=I.end;++re){const G=f.style._layers[R[re]];if(G.isHidden(f.transform.zoom))continue;const ee=f.style._getLayerSourceCache(G),le=ee?this.proxyToSource[z.key][ee.id]:[z];if(!le)continue;const ce=le;_.viewport.set([0,0,te.fb.width,te.fb.height]),ne!==(ee?ee.id:null)&&(this._setupStencil(te,le,G,ee),ne=ee?ee.id:null),f.renderLayer(f,ee,G,ce)}this.renderedToTile?(te.dirty=!0,A.push(H.tileID)):ie||--B,5===B&&(B=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(0===f)return{efficiency:100};let _,b=0,E=0,I=!1;for(let A=0;A<f;++A){const R=a._layers[a.order[A]];this._style.isLayerDraped(R)?(I&&++b,++E):I||(I=!0,_=R.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{a=Math.min(a,f.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,f,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const I=E.tileID,A=1<<I.overscaledZ,{x:R,y:B}=I.canonical,z=R/A,H=(R+1)/A,K=B/A,te=(B+1)/A;return{minx:z,miny:K,maxx:H,maxy:te,t:E.dem.tree.raycastRoot(z,K,H,te,a,f,_),tile:E}});b.sort((E,I)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const E of b){if(null==E.t)return null;const I=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,a,f,_);if(null!=I)return I}return null}_createFBO(){const a=this.painter.context,f=a.gl,_=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const b=new u.Texture(a,{width:_[0],height:_[1],data:null},f.RGBA);b.bind(f.LINEAR,f.CLAMP_TO_EDGE);const E=a.createFramebuffer(_[0],_[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new De(a,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const f=this._style._layers[a],_=f.isHidden(this.painter.transform.zoom);return"custom"===f.type?!_&&f.shouldRedrape():!_&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const _ of this._style._getSources())if(_ instanceof zt){a=!0;break}if(!a)return;const f={};for(let _=0;_<this._style.order.length;++_){const b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(E&&!f[E.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof u.ZoomDependentExpression){f[E.id]=!0;for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][E.id];if(A)for(const R of A)this._clearRenderCacheForTile(E.id,R)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Ct){a=!0;break}if(!a)return;const f={};for(let _=0;_<this._style.order.length;++_){const b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(!E||f[E.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const I=b.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][E.id];if(R)for(const B of R){const z=La(E.getTile(B),E.findLoadedParent(B,0),E,this.painter.transform,I);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(E.id,B)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(0===f)return;const _=[];let b,E=0,I=this._style._layers[a[E]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++E<f;)I=this._style._layers[a[E]];for(;E<f;++E){const A=this._style._layers[a[E]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===b&&(b=E):void 0!==b&&(_.push({start:b,end:E-1}),b=void 0))}void 0!==b&&_.push({start:b,end:E-1}),this._drapedRenderBatches=_}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const I=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let A=0;A<I.length;++A){const R=Object.values(I[A]);f.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const A=_[I];if(f.getTileByID(A.key),void 0!==f.proxyCachedFBO[A.key]){const R=a[A.key],B=this.proxyToSource[A.key];let z=0;for(const H in B){const K=B[H],te=R[H];if(!te||te.length!==K.length||K.some((ie,ne)=>ie!==te[ne]||b[H]&&b[H].hasOwnProperty(ie.key))){z=-1;break}++z}for(const H in f.proxyCachedFBO[A.key])f.renderCache[f.proxyCachedFBO[A.key][H]].dirty=z<0||z!==Object.values(R).length}}const E=[...this._drapedRenderBatches];E.sort((I,A)=>A.end-A.start-(I.end-I.start));for(const I of E)for(const A of _){if(f.proxyCachedFBO[A.key])continue;let R=f.renderCachePool.pop();void 0===R&&f.renderCache.length<50&&(R=f.renderCache.length,f.renderCache.push(this._createFBO())),void 0!==R&&(f.proxyCachedFBO[A.key]={},f.proxyCachedFBO[A.key][I.start]=R,f.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,I=E.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=f.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(a,f){const _=this.painter,b=this.painter.context,E=b.gl;_._tileClippingMaskIDs={},b.setColorMode(u.ColorMode.disabled),b.setDepthMode(u.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const A of a){const R=_._tileClippingMaskIDs[A.key]=--f;I.draw(b,E.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:E.ALWAYS,mask:0},R,255,E.KEEP,E.KEEP,E.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,nl(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const _=[a.x,a.y,1,1];u.transformMat4$1(_,_,f.pixelMatrixInverse),u.scale$1(_,_,1/_[3]),_[0]/=f.worldSize,_[1]/=f.worldSize;const b=f._camera.position,E=u.mercatorZfromAltitude(1,f.center.lat),I=[b[0],b[1],b[2]/E,0],A=u.subtract([],_.slice(0,3),I);u.normalize(A,A);const R=this.raycast(I,A,this._exaggeration);return null!==R&&R?(u.scaleAndAdd(I,I,A,R),I[3]=I[2],I[2]*=E,I):null}drawDepth(){const a=this.painter,f=a.context,_=this.proxySourceCache,b=Math.ceil(a.width),E=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=f.gl,A=f.createFramebuffer(b,E,!0);f.activeTexture.set(I.TEXTURE0);const R=new u.Texture(f,{width:b,height:E,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),A.colorAttachment.set(R.texture);const B=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,b,E);A.depthAttachment.set(B),this._depthFBO=A,this._depthTexture=R}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,b,E]),function(I,A,R,B){if("globe"===I.transform.projection.name)return;const z=I.context,H=z.gl;z.clear({depth:1});const K=I.useProgram("terrainDepth"),te=new u.DepthMode(H.LESS,u.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ie of B){const ne=R.getTile(ie),re=kl(ie.projMatrix,0);A.setupElevationDraw(ne,K),K.draw(z,H.TRIANGLES,te,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,re,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,_){if(a.getSource()instanceof Gn)return this._setupProxiedCoordsForImageSource(a,f,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords;for(let A=0;A<E.length;A++){const R=E[A],B=this._findTileCoveringTileID(R,a);if(B){const z=this._createProxiedId(R,B,_[R.key]&&_[R.key][a.id]);b.push(z),this.proxyToSource[R.key][a.id]=[z]}}let I=!1;for(let A=0;A<f.length;A++){const R=a.getTile(f[A]);if(!R||!R.hasData())continue;const B=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[B.tileID.key][a.id],H=this._createProxiedId(B.tileID,R,_[B.tileID.key]&&_[B.tileID.key][a.id]);z?z.splice(z.length-1,0,H):this.proxyToSource[B.tileID.key][a.id]=[H],b.push(H),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,f,_){if(!a.getSource().loaded())return;const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords,I=a.getSource(),A=new u.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((z,H)=>(z.min.x=Math.min(z.min.x,H.x-A.x),z.min.y=Math.min(z.min.y,H.y-A.y),z.max.x=Math.max(z.max.x,H.x-A.x),z.max.y=Math.max(z.max.y,H.y-A.y),z),{min:new u.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(z,H)=>{const K=z.wrap+z.canonical.x/(1<<z.canonical.z),te=z.canonical.y/(1<<z.canonical.z),ie=u.EXTENT/(1<<z.canonical.z),ne=H.wrap+H.canonical.x/(1<<H.canonical.z),re=H.canonical.y/(1<<H.canonical.z);return K+ie<ne+R.min.x||K>ne+R.max.x||te+ie<re+R.min.y||te>re+R.max.y};for(let z=0;z<E.length;z++){const H=E[z];for(let K=0;K<f.length;K++){const te=a.getTile(f[K]);if(!te||!te.hasData()||B(H,te.tileID))continue;const ie=this._createProxiedId(H,te,_[H.key]&&_[H.key][a.id]),ne=this.proxyToSource[H.key][a.id];ne?ne.push(ie):this.proxyToSource[H.key][a.id]=[ie],b.push(ie)}}}_createProxiedId(a,f,_){let b=this.orthoMatrix;if(_){const E=_.find(I=>I.key===f.tileID.key);if(E)return E}if(f.tileID.key!==a.key){const E=a.canonical.z-f.tileID.canonical.z;let I,A,R;b=u.create();const B=f.tileID.wrap-a.wrap<<a.overscaledZ;E>0?(I=u.EXTENT>>E,A=I*((f.tileID.canonical.x<<E)-a.canonical.x+B),R=I*((f.tileID.canonical.y<<E)-a.canonical.y)):(I=u.EXTENT<<-E,A=u.EXTENT*(f.tileID.canonical.x-(a.canonical.x+B<<-E)),R=u.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-E))),u.ortho(b,0,I,0,I,0,1),u.translate(b,b,[A,R,0])}return new il(f.tileID,a.key,b)}_findTileCoveringTileID(a,f){let _=f.getTile(a);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[f.id],E=b[a.key];if(_=E?f.getTileByID(E):null,_&&_.hasData()||null===E)return _;let I=_?_.tileID:a,A=I.overscaledZ;const R=f.getSource().minzoom,B=[];if(!E){const H=f.getSource().maxzoom;if(a.canonical.z>=H){const K=a.canonical.z-H;f.getSource().reparseOverscaled?(A=Math.max(a.canonical.z+2,f.transform.tileZoom),I=new u.OverscaledTileID(A,a.wrap,H,a.canonical.x>>K,a.canonical.y>>K)):0!==K&&(A=H,I=new u.OverscaledTileID(A,a.wrap,H,a.canonical.x>>K,a.canonical.y>>K))}I.key!==a.key&&(B.push(I.key),_=f.getTile(I))}const z=H=>{B.forEach(K=>{b[K]=H}),B.length=0};for(A-=1;A>=R&&(!_||!_.hasData());A--){_&&z(_.tileID.key);const H=I.calculateScaledKey(A);if(_=f.getTileByID(H),_&&_.hasData())break;const K=b[H];if(null===K)break;void 0===K?B.push(H):_=f.getTileByID(K)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(f){let _=0;const b=new u.StructArrayLayout2ui4,E=131;for(let I=1;I<129;I++){for(let A=1;A<129;A++)_=I*E+A,b.emplaceBack(_,_+1),b.emplaceBack(_,_+E),b.emplaceBack(_+1,_+E),128===I&&b.emplaceBack(_+E,_+E+1);b.emplaceBack(_+1,_+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ci{static cacheKey(a,f,_,b){let E=`${f}${b?b.cacheKey:""}`;for(const I of _)a.usedDefines.includes(I)&&(E+=`/${I}`);return E}constructor(a,f,_,b,E,I){const A=a.gl;this.program=A.createProgram();const R=function(G){const ee=[];for(let le=0;le<G.length;le++){if(null===G[le])continue;const ce=G[le].split(" ");ee.push(ce.pop())}return ee}(_.staticAttributes),B=b?b.getBinderAttributes():[],z=R.concat(B);let H=b?b.defines():[];H=H.concat(I.map(G=>`#define ${G}`));const K=a.isWebGL2?"#version 300 es\n":"",te=K+H.concat(a.extStandardDerivatives&&0===K.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Pa):Pa,Pa,Yc,Nu.fragmentSource,Gs.fragmentSource,_.fragmentSource).join("\n"),ie=K+H.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Yc,Nu.vertexSource,Gs.vertexSource,Nr.vertexSource,_.vertexSource).join("\n"),ne=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ne,te),A.compileShader(ne),A.attachShader(this.program,ne);const re=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(re,ie),A.compileShader(re),A.attachShader(this.program,re),this.attributes={},this.numAttributes=z.length;for(let G=0;G<this.numAttributes;G++)z[G]&&(A.bindAttribLocation(this.program,G,z[G]),this.attributes[z[G]]=G);A.linkProgram(this.program),A.deleteShader(re),A.deleteShader(ne),this.fixedUniforms=E(a),this.binderUniforms=b?b.getUniforms(a):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(G=a),u_dem_prev:new u.Uniform1i(G),u_dem_unpack:new u.Uniform4f(G),u_dem_tl:new u.Uniform2f(G),u_dem_scale:new u.Uniform1f(G),u_dem_tl_prev:new u.Uniform2f(G),u_dem_scale_prev:new u.Uniform1f(G),u_dem_size:new u.Uniform1f(G),u_dem_lerp:new u.Uniform1f(G),u_exaggeration:new u.Uniform1f(G),u_depth:new u.Uniform1i(G),u_depth_size_inv:new u.Uniform2f(G),u_meter_to_dem:new u.Uniform1f(G),u_label_plane_matrix_inv:new u.UniformMatrix4f(G)}),I.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new u.Uniform3f(G),u_tile_tr_up:new u.Uniform3f(G),u_tile_br_up:new u.Uniform3f(G),u_tile_bl_up:new u.Uniform3f(G),u_tile_up_scale:new u.Uniform1f(G)}))(a)),I.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new u.UniformMatrix4f(G),u_fog_range:new u.Uniform2f(G),u_fog_color:new u.Uniform4f(G),u_fog_horizon_blend:new u.Uniform1f(G),u_fog_temporal_offset:new u.Uniform1f(G),u_frustum_tl:new u.Uniform3f(G),u_frustum_tr:new u.Uniform3f(G),u_frustum_br:new u.Uniform3f(G),u_frustum_bl:new u.Uniform3f(G),u_globe_pos:new u.Uniform3f(G),u_globe_radius:new u.Uniform1f(G),u_globe_transition:new u.Uniform1f(G),u_is_globe:new u.Uniform1i(G),u_viewport:new u.Uniform2f(G)}))(a))}var G}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)_[b]&&_[b].set(this.program,b,f[b])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)_[b]&&_[b].set(this.program,b,f[b])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)_[b].set(this.program,b,f[b])}}draw(a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne){const re=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(b),a.setColorMode(E),a.setCullFace(I);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,A[ee]);ie&&ie.setUniforms(this.program,a,this.binderUniforms,K,{zoom:te});const G={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[f];for(const ee of H.get()){const le=ee.vaos||(ee.vaos={});(le[R]||(le[R]=new Bh)).bind(a,this,B,ie?ie.getPaintVertexBuffers():[],z,ee.vertexOffset,ne||[]),re.drawElements(f,ee.primitiveLength*G,re.UNSIGNED_SHORT,ee.primitiveOffset*G*2)}}}function fc(m,a){const f=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,m.transform.tileZoom)/f,b=_*(a.tileID.canonical.x+a.tileID.wrap*f),E=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/dn(a,1,m.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Gd=u.create(),Zs=(m,a,f,_,b,E,I,A,R,B,z)=>{const H=a.style.light,K=H.properties.get("position"),te=[K.x,K.y,K.z],ie=u.create$1();"viewport"===H.properties.get("anchor")&&(u.fromRotation(ie,-a.transform.angle),u.transformMat3(te,te,ie));const ne=H.properties.get("color"),re=a.transform,G={u_matrix:m,u_lightpos:te,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+f,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return"globe"===re.projection.name&&(G.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=z,G.u_merc_center=B,G.u_up_dir=re.projection.upVector(new u.CanonicalTileID(0,0,0),B[0]*u.EXTENT,B[1]*u.EXTENT),G.u_height_lift=A),G},Fl=(m,a,f,_,b,E,I,A,R,B,z,H)=>{const K=Zs(m,a,f,_,b,E,I,R,B,z,H),te={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return u.extend(K,fc(a,A),te)},vs=m=>({u_matrix:m}),Fu=(m,a,f)=>u.extend(vs(m),fc(a,f)),Vh=(m,a)=>({u_matrix:m,u_world:a}),qd=(m,a,f,_)=>u.extend(Fu(m,a,f),{u_world:_}),Go=u.create(),ko=(m,a,f,_,b,E)=>{const I=m.transform,A="globe"===I.projection.name;let R;if("map"===E.paint.get("circle-pitch-alignment"))if(A){const z=u.globePixelsToTileUnits(I.zoom,a.canonical)*I._pixelsPerMercatorPixel;R=Float32Array.from([z,0,0,z])}else R=I.calculatePixelsToTileUnitsMatrix(f);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:m.translatePosMatrix(a.projMatrix,f,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Go,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){B.u_inv_rot_matrix=_,B.u_merc_center=b,B.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],B.u_zoom_transition=u.globeToMercatorTransition(I.zoom);const z=b[0]*u.EXTENT,H=b[1]*u.EXTENT;B.u_up_dir=I.projection.upVector(new u.CanonicalTileID(0,0,0),z,H)}return B},zu=m=>{const a=[];return"map"===m.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},jr=(m,a,f,_)=>{const b=u.EXTENT/f.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/b,a.pixelsToGLUnits[1]/b]}},Jc=(m,a,f=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:f}),sn=u.create(),Bu=(m,a,f,_,b,E,I)=>{const A=m.transform,R="globe"===A.projection.name,B=R?u.globePixelsToTileUnits(A.zoom,a.canonical)*A._pixelsPerMercatorPixel:dn(f,1,E),z={u_matrix:a.projMatrix,u_extrude_scale:B,u_intensity:I,u_inv_rot_matrix:sn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){z.u_inv_rot_matrix=_,z.u_merc_center=b,z.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],z.u_zoom_transition=u.globeToMercatorTransition(A.zoom);const H=b[0]*u.EXTENT,K=b[1]*u.EXTENT;z.u_up_dir=A.projection.upVector(new u.CanonicalTileID(0,0,0),H,K)}return z},tn=(m,a,f,_,b,E,I)=>{const A=m.transform,R=A.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:rl(m,a,f,_),u_pixels_to_tile_units:R,u_device_pixel_ratio:E,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:qo(f)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ls(a,m.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Ws=(m,a,f,_,b)=>{const E=m.transform;return{u_matrix:rl(m,a,f,_),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:ls(a,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ls(m,a){return 1/dn(m,1,a.tileZoom)}function rl(m,a,f,_){return m.translatePosMatrix(_||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function qo(m){const a=m.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const zl=(m,a,f,_,b,E)=>{return{u_matrix:m,u_tl_parent:a,u_scale_parent:f,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(I=b.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:xs(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var I,A};function xs(m){m*=Math.PI/180;const a=Math.sin(m),f=Math.cos(m);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Co=u.create(),Bl=(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne)=>{const re=b.transform,G={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:re.width/re.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+_,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Co,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Co,u_up_vector:[0,-1,0]};return"globe"===ne.name&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=H,G.u_inv_rot_matrix=te,G.u_merc_center=K,G.u_camera_forward=re._camera.forward(),G.u_ecef_origin=u.globeECEFOrigin(re.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(re.globeMatrix),G.u_up_vector=ie),G},xr=(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne,re)=>u.extend(Bl(m,a,f,_,b,E,I,A,R,B,H,K,te,ie,ne,re),{u_gamma_scale:_?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+z}),cs=(m,a,f,_,b,E,I,A,R,B,z,H,K,te,ie,ne)=>u.extend(xr(m,a,f,_,b,E,I,A,!0,R,!0,z,H,K,te,ie,ne),{u_texsize_icon:B,u_texture_icon:1}),ni=(m,a,f)=>({u_matrix:m,u_opacity:a,u_color:f}),Qc=(m,a,f,_,b)=>u.extend(function(E,I,A){const R=I.imageManager.getPattern(E.toString()),{width:B,height:z}=I.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),K=A.tileSize*Math.pow(2,I.transform.tileZoom)/H,te=K*(A.tileID.canonical.x+A.tileID.wrap*H),ie=K*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[B,z],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/dn(A,1,I.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}}(_,f,b),{u_matrix:m,u_opacity:a}),Oo={fillExtrusion:m=>({u_matrix:new u.UniformMatrix4f(m),u_lightpos:new u.Uniform3f(m),u_lightintensity:new u.Uniform1f(m),u_lightcolor:new u.Uniform3f(m),u_vertical_gradient:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_edge_radius:new u.Uniform1f(m),u_ao:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_up_dir:new u.Uniform3f(m),u_height_lift:new u.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_lightpos:new u.Uniform3f(m),u_lightintensity:new u.Uniform1f(m),u_lightcolor:new u.Uniform3f(m),u_vertical_gradient:new u.Uniform1f(m),u_height_factor:new u.Uniform1f(m),u_edge_radius:new u.Uniform1f(m),u_ao:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_up_dir:new u.Uniform3f(m),u_height_lift:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m)}),fill:m=>({u_matrix:new u.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),fillOutline:m=>({u_matrix:new u.UniformMatrix4f(m),u_world:new u.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_world:new u.Uniform2f(m),u_image:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new u.Uniform1f(m),u_extrude_scale:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_up_dir:new u.Uniform3f(m)}),collisionBox:m=>({u_matrix:new u.UniformMatrix4f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_extrude_scale:new u.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new u.UniformMatrix4f(m),u_inv_matrix:new u.UniformMatrix4f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_viewport_size:new u.Uniform2f(m)}),debug:m=>({u_color:new u.UniformColor(m),u_matrix:new u.UniformMatrix4f(m),u_overlay:new u.Uniform1i(m),u_overlay_scale:new u.Uniform1f(m)}),clippingMask:m=>({u_matrix:new u.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new u.Uniform1f(m),u_intensity:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_up_dir:new u.Uniform3f(m)}),heatmapTexture:m=>({u_image:new u.Uniform1i(m),u_color_ramp:new u.Uniform1i(m),u_opacity:new u.Uniform1f(m)}),hillshade:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_latrange:new u.Uniform2f(m),u_light:new u.Uniform2f(m),u_shadow:new u.UniformColor(m),u_highlight:new u.UniformColor(m),u_accent:new u.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new u.UniformMatrix4f(m),u_image:new u.Uniform1i(m),u_dimension:new u.Uniform2f(m),u_zoom:new u.Uniform1f(m),u_unpack:new u.Uniform4f(m)}),line:m=>({u_matrix:new u.UniformMatrix4f(m),u_pixels_to_tile_units:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_units_to_pixels:new u.Uniform2f(m),u_dash_image:new u.Uniform1i(m),u_gradient_image:new u.Uniform1i(m),u_image_height:new u.Uniform1f(m),u_texsize:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_alpha_discard_threshold:new u.Uniform1f(m),u_trim_offset:new u.Uniform2f(m)}),linePattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_texsize:new u.Uniform2f(m),u_pixels_to_tile_units:new u.UniformMatrix2f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_units_to_pixels:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m),u_alpha_discard_threshold:new u.Uniform1f(m)}),raster:m=>({u_matrix:new u.UniformMatrix4f(m),u_tl_parent:new u.Uniform2f(m),u_scale_parent:new u.Uniform1f(m),u_fade_t:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_image0:new u.Uniform1i(m),u_image1:new u.Uniform1i(m),u_brightness_low:new u.Uniform1f(m),u_brightness_high:new u.Uniform1f(m),u_saturation_factor:new u.Uniform1f(m),u_contrast_factor:new u.Uniform1f(m),u_spin_weights:new u.Uniform3f(m),u_perspective_transform:new u.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_camera_forward:new u.Uniform3f(m),u_tile_matrix:new u.UniformMatrix4f(m),u_up_vector:new u.Uniform3f(m),u_ecef_origin:new u.Uniform3f(m),u_texture:new u.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_texture:new u.Uniform1i(m),u_gamma_scale:new u.Uniform1f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_tile_id:new u.Uniform3f(m),u_zoom_transition:new u.Uniform1f(m),u_inv_rot_matrix:new u.UniformMatrix4f(m),u_merc_center:new u.Uniform2f(m),u_camera_forward:new u.Uniform3f(m),u_tile_matrix:new u.UniformMatrix4f(m),u_up_vector:new u.Uniform3f(m),u_ecef_origin:new u.Uniform3f(m),u_is_halo:new u.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new u.Uniform1i(m),u_is_size_feature_constant:new u.Uniform1i(m),u_size_t:new u.Uniform1f(m),u_size:new u.Uniform1f(m),u_camera_to_center_distance:new u.Uniform1f(m),u_rotate_symbol:new u.Uniform1i(m),u_aspect_ratio:new u.Uniform1f(m),u_fade_change:new u.Uniform1f(m),u_matrix:new u.UniformMatrix4f(m),u_label_plane_matrix:new u.UniformMatrix4f(m),u_coord_matrix:new u.UniformMatrix4f(m),u_is_text:new u.Uniform1i(m),u_pitch_with_map:new u.Uniform1i(m),u_texsize:new u.Uniform2f(m),u_texsize_icon:new u.Uniform2f(m),u_texture:new u.Uniform1i(m),u_texture_icon:new u.Uniform1i(m),u_gamma_scale:new u.Uniform1f(m),u_device_pixel_ratio:new u.Uniform1f(m),u_is_halo:new u.Uniform1i(m)}),background:m=>({u_matrix:new u.UniformMatrix4f(m),u_opacity:new u.Uniform1f(m),u_color:new u.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new u.UniformMatrix4f(m),u_opacity:new u.Uniform1f(m),u_image:new u.Uniform1i(m),u_pattern_tl:new u.Uniform2f(m),u_pattern_br:new u.Uniform2f(m),u_texsize:new u.Uniform2f(m),u_pattern_size:new u.Uniform2f(m),u_pixel_coord_upper:new u.Uniform2f(m),u_pixel_coord_lower:new u.Uniform2f(m),u_tile_units_to_pixels:new u.Uniform1f(m)}),terrainRaster:Kc,terrainDepth:Kc,skybox:m=>({u_matrix:new u.UniformMatrix4f(m),u_sun_direction:new u.Uniform3f(m),u_cubemap:new u.Uniform1i(m),u_opacity:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new u.UniformMatrix4f(m),u_color_ramp:new u.Uniform1i(m),u_center_direction:new u.Uniform3f(m),u_radius:new u.Uniform1f(m),u_opacity:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new u.UniformMatrix3f(m),u_sun_direction:new u.Uniform3f(m),u_sun_intensity:new u.Uniform1f(m),u_color_tint_r:new u.Uniform4f(m),u_color_tint_m:new u.Uniform4f(m),u_luminance:new u.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new u.UniformMatrix4f(m),u_globe_matrix:new u.UniformMatrix4f(m),u_normalize_matrix:new u.UniformMatrix4f(m),u_merc_matrix:new u.UniformMatrix4f(m),u_zoom_transition:new u.Uniform1f(m),u_merc_center:new u.Uniform2f(m),u_image0:new u.Uniform1i(m),u_grid_matrix:new u.UniformMatrix3f(m),u_skirt_height:new u.Uniform1f(m),u_frustum_tl:new u.Uniform3f(m),u_frustum_tr:new u.Uniform3f(m),u_frustum_br:new u.Uniform3f(m),u_frustum_bl:new u.Uniform3f(m),u_globe_pos:new u.Uniform3f(m),u_globe_radius:new u.Uniform1f(m),u_viewport:new u.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new u.Uniform3f(m),u_frustum_tr:new u.Uniform3f(m),u_frustum_br:new u.Uniform3f(m),u_frustum_bl:new u.Uniform3f(m),u_horizon:new u.Uniform1f(m),u_transition:new u.Uniform1f(m),u_fadeout_range:new u.Uniform1f(m),u_color:new u.Uniform4f(m),u_high_color:new u.Uniform4f(m),u_space_color:new u.Uniform4f(m),u_star_intensity:new u.Uniform1f(m),u_star_density:new u.Uniform1f(m),u_star_size:new u.Uniform1f(m),u_temporal_offset:new u.Uniform1f(m),u_horizon_angle:new u.Uniform1f(m),u_rotation_matrix:new u.UniformMatrix4f(m)})};let Xs;function ol(m,a,f,_,b,E,I){const A=m.context,R=A.gl,B=m.transform,z=m.useProgram("collisionBox"),H=[];let K=0,te=0;for(let ce=0;ce<_.length;ce++){const Ee=_[ce],Te=a.getTile(Ee),Ce=Te.getBucket(f);if(!Ce)continue;const Ne=jn(Ee,Ce,B);let Pe=Ne;0===b[0]&&0===b[1]||(Pe=m.translatePosMatrix(Ne,Te,b,E));const Xe=I?Ce.textCollisionBox:Ce.iconCollisionBox,Et=Ce.collisionCircleArray;if(Et.length>0){const je=u.create(),ut=Pe;u.mul(je,Ce.placementInvProjMatrix,B.glCoordMatrix),u.mul(je,je,Ce.placementViewportMatrix),H.push({circleArray:Et,circleOffset:te,transform:ut,invTransform:je,projection:Ce.getProjection()}),K+=Et.length/4,te=K}Xe&&(m.terrain&&m.terrain.setupElevationDraw(Te,z),z.draw(A,R.LINES,u.DepthMode.disabled,u.StencilMode.disabled,m.colorModeForRenderPass(),u.CullFaceMode.disabled,jr(Pe,B,Te,Ce.getProjection()),f.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,B.zoom,null,[Xe.collisionVertexBuffer,Xe.collisionVertexBufferExt]))}if(!I||!H.length)return;const ie=m.useProgram("collisionCircle"),ne=new u.StructArrayLayout2f1f2i16;ne.resize(4*K),ne._trim();let re=0;for(const ce of H)for(let Ee=0;Ee<ce.circleArray.length/4;Ee++){const Te=4*Ee,Ce=ce.circleArray[Te+0],Ne=ce.circleArray[Te+1],Pe=ce.circleArray[Te+2],Xe=ce.circleArray[Te+3];ne.emplace(re++,Ce,Ne,Pe,Xe,0),ne.emplace(re++,Ce,Ne,Pe,Xe,1),ne.emplace(re++,Ce,Ne,Pe,Xe,2),ne.emplace(re++,Ce,Ne,Pe,Xe,3)}(!Xs||Xs.length<2*K)&&(Xs=function(ce){const Ee=2*ce,Te=new u.StructArrayLayout3ui6;Te.resize(Ee),Te._trim();for(let Ce=0;Ce<Ee;Ce++){const Ne=6*Ce;Te.uint16[Ne+0]=4*Ce+0,Te.uint16[Ne+1]=4*Ce+1,Te.uint16[Ne+2]=4*Ce+2,Te.uint16[Ne+3]=4*Ce+2,Te.uint16[Ne+4]=4*Ce+3,Te.uint16[Ne+5]=4*Ce+0}return Te}(K));const G=A.createIndexBuffer(Xs,!0),ee=A.createVertexBuffer(ne,u.collisionCircleLayout.members,!0);for(const ce of H){const Ee={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(le=B).getCameraToCenterDistance(ce.projection),u_viewport_size:[le.width,le.height]};ie.draw(A,R.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,m.colorModeForRenderPass(),u.CullFaceMode.disabled,Ee,f.id,ee,G,u.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,B.zoom)}var le;ee.destroy(),G.destroy()}const Zo=u.create();function bs({width:m,height:a,anchor:f,textOffset:_,textScale:b},E){const{horizontalAlign:I,verticalAlign:A}=u.getAnchorAlignment(f),R=-(I-.5)*m,B=-(A-.5)*a,z=u.evaluateVariableOffset(f,_);return new u.Point((R/b+z[0])*E,(B/b+z[1])*E)}function eu(m,a,f,_,b,E,I,A,R,B,z){const H=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,te=m.icon.dynamicLayoutVertexArray,ie={},ne=m.getProjection(),re=gi(A,ne,E),G=E.elevation,ee=ne.upVectorScale(A.canonical,E.center.lat,E.worldSize).metersToTile;K.clear();for(let le=0;le<H.length;le++){const ce=H.get(le),{tileAnchorX:Ee,tileAnchorY:Te,numGlyphs:Ce}=ce,Ne=ce.hidden||!ce.crossTileID||m.allowVerticalPlacement&&!ce.placedOrientation?null:_[ce.crossTileID];if(Ne){let Pe=0,Xe=0,Et=0;if(G){const It=G?G.getAtTileOffset(A,Ee,Te):0,[un,Ln,en]=ne.upVector(A.canonical,Ee,Te);Pe=It*un*ee,Xe=It*Ln*ee,Et=It*en*ee}let[je,ut,et,xt]=On(ce.projectedAnchorX+Pe,ce.projectedAnchorY+Xe,ce.projectedAnchorZ+Et,f?re:I);const We=or(E.getCameraToCenterDistance(ne),xt);let lt=b.evaluateSizeForFeature(m.textSizeData,B,ce)*We/u.ONE_EM;f&&(lt*=m.tilePixelRatio/R);const Dt=bs(Ne,lt);f?(({x:je,y:ut,z:et}=ne.projectTilePoint(Ee+Dt.x,Te+Dt.y,A.canonical)),[je,ut,et]=On(je+Pe,ut+Xe,et+Et,I)):(a&&Dt._rotate(-E.angle),je+=Dt.x,ut+=Dt.y,et=0);const pt=m.allowVerticalPlacement&&ce.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let It=0;It<Ce;It++)u.addDynamicAttributes(K,je,ut,et,pt);z&&ce.associatedIconIndex>=0&&(ie[ce.associatedIconIndex]={x:je,y:ut,z:et,angle:pt})}else sr(Ce,K)}if(z){te.clear();const le=m.icon.placedSymbolArray;for(let ce=0;ce<le.length;ce++){const Ee=le.get(ce),{numGlyphs:Te}=Ee,Ce=ie[ce];if(Ee.hidden||!Ce)sr(Te,te);else{const{x:Ne,y:Pe,z:Xe,angle:Et}=Ce;for(let je=0;je<Te;je++)u.addDynamicAttributes(te,Ne,Pe,Xe,Et)}}m.icon.dynamicLayoutVertexBuffer.updateData(te)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function sl(m,a,f){return f.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Ys(m,a,f,_,b,E,I,A,R,B,z,H){const K=m.context,te=K.gl,ie=m.transform,ne="map"===A,re="map"===R,G=ne&&"point"!==f.layout.get("symbol-placement"),ee=ne&&!re&&!G,le=void 0!==f.layout.get("symbol-sort-key").constantOr(1);let ce=!1;const Ee=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),Te=[u.mercatorXfromLng(ie.center.lng),u.mercatorYfromLat(ie.center.lat)],Ce=f.layout.get("text-variable-anchor"),Ne="globe"===ie.projection.name,Pe=[],Xe=[0,-1,0];let Et=Xe;!Ne&&!ie.mercatorFromTransition||ne||(Et=function(je){const ut=je._camera.getWorldToCamera(je.worldSize,1),et=u.multiply([],ut,je.globeMatrix);u.invert(et,et);const xt=[0,0,0],We=[0,1,0,0];return u.transformMat4$1(We,We,et),xt[0]=We[0],xt[1]=We[1],xt[2]=We[2],u.normalize(xt,xt),xt}(ie));for(const je of _){const ut=a.getTile(je),et=ut.getBucket(f);if(!et||"mercator"===et.projection.name&&Ne)continue;const xt=b?et.text:et.icon;if(!xt||et.fullyClipped||!xt.segments.get().length)continue;const We=xt.programConfigurations.get(f.id),lt=b||et.sdfIcons,Dt=b?et.textSizeData:et.iconSizeData,pt=re||0!==ie.pitch,It=u.evaluateSizeForZoom(Dt,ie.zoom);let un,Ln,en,wn,ei=[0,0],Jn=null;if(b)Ln=ut.glyphAtlasTexture,en=te.LINEAR,un=ut.glyphAtlasTexture.size,et.iconsInText&&(ei=ut.imageAtlasTexture.size,Jn=ut.imageAtlasTexture,wn=pt||m.options.rotating||m.options.zooming||"composite"===Dt.kind||"camera"===Dt.kind?te.LINEAR:te.NEAREST);else{const Br=1!==f.layout.get("icon-size").constantOr(0)||et.iconsNeedLinear;Ln=ut.imageAtlasTexture,en=lt||m.options.rotating||m.options.zooming||Br||pt?te.LINEAR:te.NEAREST,un=ut.imageAtlasTexture.size}const Kt="globe"===et.projection.name,Ti=Kt?Et:Xe,Ni=Kt?u.globeToMercatorTransition(ie.zoom):0,Fi=gi(je,et.getProjection(),ie),Si=ie.calculatePixelsToTileUnitsMatrix(ut),yo=it(Fi,ut.tileID.canonical,re,ne,ie,et.getProjection(),Si),co=m.terrain&&re&&G?u.invert(u.create(),yo):Zo,Yo=Qi(Fi,ut.tileID.canonical,re,ne,ie,et.getProjection(),Si),Ba=Ce&&et.hasTextData(),_i="none"!==f.layout.get("icon-text-fit")&&Ba&&et.hasIconData();if(G){const Br=ie.elevation,Gl=Br?Br.getAtTileOffsetFunc(je,ie.center.lat,ie.worldSize,et.getProjection()):null,bc=os(Fi,ut.tileID.canonical,re,ne,ie,et.getProjection(),Si);Us(et,Fi,m,b,bc,Yo,re,B,Gl,je)}const Ii=G||b&&Ce||_i,mi=m.translatePosMatrix(Fi,ut,E,I),Xn=Ii?Zo:yo,vo=m.translatePosMatrix(Yo,ut,E,I,!0),zi=et.getProjection().createInversionMatrix(ie,je.canonical),tr=[];m.terrainRenderModeElevated()&&re&&tr.push("PITCH_WITH_MAP_TERRAIN"),Kt&&tr.push("PROJECTION_GLOBE_VIEW"),Ii&&tr.push("PROJECTED_POS_ON_VIEWPORT");const Gh=lt&&0!==f.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let Hl;Hl=lt?et.iconsInText?cs(Dt.kind,It,ee,re,m,mi,Xn,vo,un,ei,je,Ni,Te,zi,Ti,et.getProjection()):xr(Dt.kind,It,ee,re,m,mi,Xn,vo,b,un,!0,je,Ni,Te,zi,Ti,et.getProjection()):Bl(Dt.kind,It,ee,re,m,mi,Xn,vo,b,un,je,Ni,Te,zi,Ti,et.getProjection());const Va={program:m.useProgram(sl(lt,b,et),We,tr),buffers:xt,uniformValues:Hl,atlasTexture:Ln,atlasTextureIcon:Jn,atlasInterpolation:en,atlasInterpolationIcon:wn,isSDF:lt,hasHalo:Gh,tile:ut,labelPlaneMatrixInv:co};if(le&&et.canOverlap){ce=!0;const Br=xt.segments.get();for(const Gl of Br)Pe.push({segments:new u.SegmentVector([Gl]),sortKey:Gl.sortKey,state:Va})}else Pe.push({segments:xt.segments,sortKey:0,state:Va})}ce&&Pe.sort((je,ut)=>je.sortKey-ut.sortKey);for(const je of Pe){const ut=je.state;if(m.terrain&&m.terrain.setupElevationDraw(ut.tile,ut.program,{useDepthForOcclusion:!Ne,labelPlaneMatrixInv:ut.labelPlaneMatrixInv}),K.activeTexture.set(te.TEXTURE0),ut.atlasTexture.bind(ut.atlasInterpolation,te.CLAMP_TO_EDGE),ut.atlasTextureIcon&&(K.activeTexture.set(te.TEXTURE1),ut.atlasTextureIcon&&ut.atlasTextureIcon.bind(ut.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),ut.isSDF){const et=ut.uniformValues;ut.hasHalo&&(et.u_is_halo=1,Ks(ut.buffers,je.segments,f,m,ut.program,Ee,z,H,et)),et.u_is_halo=0}Ks(ut.buffers,je.segments,f,m,ut.program,Ee,z,H,ut.uniformValues)}}function Ks(m,a,f,_,b,E,I,A,R){const B=_.context,z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];b.draw(B,B.gl.TRIANGLES,E,I,A,u.CullFaceMode.disabled,R,f.id,m.layoutVertexBuffer,m.indexBuffer,a,f.paint,_.transform.zoom,m.programConfigurations.get(f.id),z)}function pc(m,a,f,_,b,E,I){const A=m.context.gl,R=f.paint.get("fill-pattern"),B=R&&R.constantOr(1);let z,H,K,te,ie;I?(H=B&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=A.LINES):(H=B?"fillPattern":"fill",z=A.TRIANGLES);for(const ne of _){const re=a.getTile(ne);if(B&&!re.patternsLoaded())continue;const G=re.getBucket(f);if(!G)continue;m.prepareDrawTile();const ee=G.programConfigurations.get(f.id),le=m.useProgram(H,ee);B&&(m.context.activeTexture.set(A.TEXTURE0),re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ee.updatePaintBuffers());const ce=R.constantOr(null);if(ce&&re.imageAtlas){const Te=re.imageAtlas.patternPositions[ce.toString()];Te&&ee.setConstantPatternPositions(Te)}const Ee=m.translatePosMatrix(ne.projMatrix,re,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(I){te=G.indexBuffer2,ie=G.segments2;const Te=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];K="fillOutlinePattern"===H&&B?qd(Ee,m,re,Te):Vh(Ee,Te)}else te=G.indexBuffer,ie=G.segments,K=B?Fu(Ee,m,re):vs(Ee);m.prepareDrawProgram(m.context,le,ne.toUnwrapped()),le.draw(m.context,z,b,m.stencilModeForClipping(ne),E,u.CullFaceMode.disabled,K,f.id,G.layoutVertexBuffer,te,ie,f.paint,m.transform.zoom,ee)}}function Js(m,a,f,_,b,E,I){const A=m.context,R=A.gl,B=m.transform,z=f.paint.get("fill-extrusion-pattern"),H=z.constantOr(1),K=f.paint.get("fill-extrusion-opacity"),te=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],ie=f.layout.get("fill-extrusion-edge-radius"),ne=ie>0&&!f.paint.get("fill-extrusion-rounded-roof"),re=ne?0:ie,G="globe"===B.projection.name?u.fillExtrusionHeightLift():0,ee="globe"===B.projection.name,le=ee?u.globeToMercatorTransition(B.zoom):0,ce=[u.mercatorXfromLng(B.center.lng),u.mercatorYfromLat(B.center.lat)],Ee=[];ee&&Ee.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&Ee.push("FAUX_AO"),ne&&Ee.push("ZERO_ROOF_RADIUS");for(const Te of _){const Ce=a.getTile(Te),Ne=Ce.getBucket(f);if(!Ne||Ne.projection.name!==B.projection.name)continue;const Pe=Ne.programConfigurations.get(f.id),Xe=m.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Pe,Ee);if(m.terrain){const lt=m.terrain;if(m.style.terrainSetForDrapingOnly())lt.setupElevationDraw(Ce,Xe,{useMeterToDem:!0});else{if(!Ne.enableTerrain)continue;if(lt.setupElevationDraw(Ce,Xe,{useMeterToDem:!0}),Vu(A,a,Te,Ne,f,lt),!Ne.centroidVertexBuffer){const Dt=Xe.attributes.a_centroid_pos;void 0!==Dt&&R.vertexAttrib2f(Dt,0,0)}}}H&&(m.context.activeTexture.set(R.TEXTURE0),Ce.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const Et=z.constantOr(null);if(Et&&Ce.imageAtlas){const lt=Ce.imageAtlas.patternPositions[Et.toString()];lt&&Pe.setConstantPatternPositions(lt)}const je=m.translatePosMatrix(Te.projMatrix,Ce,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),ut=B.projection.createInversionMatrix(B,Te.canonical),et=f.paint.get("fill-extrusion-vertical-gradient"),xt=H?Fl(je,m,et,K,te,re,Te,Ce,G,le,ce,ut):Zs(je,m,et,K,te,re,Te,G,le,ce,ut);m.prepareDrawProgram(A,Xe,Te.toUnwrapped());const We=[];m.terrain&&We.push(Ne.centroidVertexBuffer),ee&&We.push(Ne.layoutVertexExtBuffer),Xe.draw(A,A.gl.TRIANGLES,b,E,I,u.CullFaceMode.backCCW,xt,f.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,f.paint,m.transform.zoom,Pe,We)}}function Vu(m,a,f,_,b,E){const I=[G=>{let ee=G.canonical.x-1,le=G.wrap;return ee<0&&(ee=(1<<G.canonical.z)-1,le--),new u.OverscaledTileID(G.overscaledZ,le,G.canonical.z,ee,G.canonical.y)},G=>{let ee=G.canonical.x+1,le=G.wrap;return ee===1<<G.canonical.z&&(ee=0,le++),new u.OverscaledTileID(G.overscaledZ,le,G.canonical.z,ee,G.canonical.y)},G=>new u.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new u.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],A=G=>{const ee=a.getSource().minzoom,le=Ee=>{const Te=a.getTileByID(Ee);if(Te&&Te.hasData())return Te.getBucket(b)},ce=[0,-1,1];for(const Ee of ce){if(G.overscaledZ+Ee<ee)continue;const Te=le(G.calculateScaledKey(G.overscaledZ+Ee));if(Te)return Te}},R=[0,0,0],B=(G,ee)=>(R[0]=Math.min(G.min.y,ee.min.y),R[1]=Math.max(G.max.y,ee.max.y),R[2]=u.EXTENT-ee.min.x>G.max.x?ee.min.x-u.EXTENT:G.max.x,R),z=(G,ee)=>(R[0]=Math.min(G.min.x,ee.min.x),R[1]=Math.max(G.max.x,ee.max.x),R[2]=u.EXTENT-ee.min.y>G.max.y?ee.min.y-u.EXTENT:G.max.y,R),H=[(G,ee)=>B(G,ee),(G,ee)=>B(ee,G),(G,ee)=>z(G,ee),(G,ee)=>z(ee,G)],K=new u.Point(0,0);let te,ie,ne;const re=(G,ee,le,ce,Ee)=>{const Te=[[ce?le:G,ce?G:le,0],[ce?le:ee,ce?ee:le,0]],Ce=Ee<0?u.EXTENT+Ee:Ee,Ne=[ce?Ce:(G+ee)/2,ce?(G+ee)/2:Ce,0];return 0===le&&Ee<0||0!==le&&Ee>0?E.getForTilePoints(ne,[Ne],!0,ie):Te.push(Ne),E.getForTilePoints(f,Te,!0,te),Math.max(Te[0][2],Te[1][2],Ne[2])/E.exaggeration()};for(let G=0;G<4;G++){const ee=(G<2?1:5)-G,le=_.borders[G];if(0===le.length)continue;const ce=ne=I[G](f),Ee=A(ce);if(!(Ee&&Ee instanceof u.FillExtrusionBucket&&Ee.enableTerrain)||_.borderDoneWithNeighborZ[G]===Ee.canonical.z&&Ee.borderDoneWithNeighborZ[ee]===_.canonical.z||(ie=E.findDEMTileFor(ce),!ie||!ie.dem))continue;if(!te){const Pe=E.findDEMTileFor(f);if(!Pe||!Pe.dem)return;te=Pe}const Te=Ee.borders[ee];let Ce=0;const Ne=Ee.borderDoneWithNeighborZ[ee]!==_.canonical.z;if(_.canonical.z===Ee.canonical.z){for(let Pe=0;Pe<le.length;Pe++){const Xe=_.featuresOnBorder[le[Pe]],Et=Xe.borders[G];let je;for(;Ce<Te.length&&(je=Ee.featuresOnBorder[Te[Ce]],!(je.borders[ee][1]>Et[0]+3));)Ne&&Ee.encodeCentroid(void 0,je,!1),Ce++;if(je&&Ce<Te.length){const ut=Ce;let et=0;for(;!(je.borders[ee][0]>Et[1]-3)&&(et++,++Ce!==Te.length);)je=Ee.featuresOnBorder[Te[Ce]];if(je=Ee.featuresOnBorder[Te[ut]],Xe.intersectsCount()>1||je.intersectsCount()>1||1!==et){1!==et&&(Ce=ut),_.encodeCentroid(void 0,Xe,!1),Ne&&Ee.encodeCentroid(void 0,je,!1);continue}const xt=H[G](Xe,je),We=G%2?u.EXTENT-1:0;K.x=re(xt[0],Math.min(u.EXTENT-1,xt[1]),We,G<2,xt[2]),K.y=0,_.encodeCentroid(K,Xe,!1),Ne&&Ee.encodeCentroid(K,je,!1)}else _.encodeCentroid(void 0,Xe,!1)}_.borderDoneWithNeighborZ[G]=Ee.canonical.z,_.needsCentroidUpdate=!0,Ne&&(Ee.borderDoneWithNeighborZ[ee]=_.canonical.z,Ee.needsCentroidUpdate=!0)}else{for(const Pe of le)_.encodeCentroid(void 0,_.featuresOnBorder[Pe],!1);if(Ne){for(const Pe of Te)Ee.encodeCentroid(void 0,Ee.featuresOnBorder[Pe],!1);Ee.borderDoneWithNeighborZ[ee]=_.canonical.z,Ee.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[G]=Ee.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const ws=new u.Color(1,0,0,1),Zd=new u.Color(0,1,0,1),Uu=new u.Color(0,0,1,1),Wd=new u.Color(1,0,1,1),Uh=new u.Color(0,1,1,1);function us(m,a,f){const _=m.context,b=m.transform,E=_.gl,I="globe"===b.projection.name,A=I?["PROJECTION_GLOBE_VIEW"]:null;let R=f.projMatrix;if(I&&u.globeToMercatorTransition(b.zoom)>0){const Xe=u.transitionTileAABBinECEF(f.canonical,b),Et=u.globeDenormalizeECEF(Xe);R=u.multiply(new Float32Array(16),b.globeMatrix,Et),u.multiply(R,b.projMatrix,R)}const B=m.useProgram("debug",null,A),z=a.getTileByID(f.key);m.terrain&&m.terrain.setupElevationDraw(z,B);const H=u.DepthMode.disabled,K=u.StencilMode.disabled,te=m.colorModeForRenderPass();_.activeTexture.set(E.TEXTURE0),m.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),I?z._makeGlobeTileDebugBuffers(m.context,b):z._makeDebugTileBoundsBuffers(m.context,b.projection);const ne=z._tileDebugBuffer||m.debugBuffer,re=z._tileDebugIndexBuffer||m.debugIndexBuffer,G=z._tileDebugSegments||m.debugSegments;B.draw(_,E.LINE_STRIP,H,K,te,u.CullFaceMode.disabled,Jc(R,u.Color.red),"$debug",ne,re,G,null,null,null,[z._globeTileDebugBorderBuffer]);const ee=z.latestRawTileData,le=Math.floor((ee&&ee.byteLength||0)/1024),ce=a.getTile(f).tileSize,Ee=512/Math.min(ce,512)*(f.overscaledZ/b.zoom)*.5;let Te=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Te+=` => ${f.overscaledZ}`),Te+=` ${le}kb`,function(Xe,Et){Xe.initDebugOverlayCanvas();const je=Xe.debugOverlayCanvas,ut=Xe.context.gl,et=Xe.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,je.width,je.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(Et,5,5),et.strokeText(Et,5,5),Xe.debugOverlayTexture.update(je),Xe.debugOverlayTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}(m,Te);const Ce=z._tileDebugTextBuffer||m.debugBuffer,Ne=z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Pe=z._tileDebugTextSegments||m.debugSegments;B.draw(_,E.TRIANGLES,H,K,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,Jc(R,u.Color.transparent,Ee),"$debug",Ce,Ne,Pe,null,null,null,[z._globeTileDebugTextBuffer])}function hs(m,a,f,_){Vl(m,0,a+f/2,m.transform.width,f,_)}function ka(m,a,f,_){Vl(m,a-f/2,0,f,m.transform.height,_)}function Vl(m,a,f,_,b,E){const I=m.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(a*u.exported.devicePixelRatio,f*u.exported.devicePixelRatio,_*u.exported.devicePixelRatio,b*u.exported.devicePixelRatio),I.clear({color:E}),A.disable(A.SCISSOR_TEST)}const mc=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jh}=mc;function Es(m,a,f,_){m.emplaceBack(a,f,_)}class gc{constructor(a){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,Es(this.vertexArray,-1,-1,1),Es(this.vertexArray,1,-1,1),Es(this.vertexArray,-1,1,1),Es(this.vertexArray,1,1,1),Es(this.vertexArray,-1,-1,-1),Es(this.vertexArray,1,-1,-1),Es(this.vertexArray,-1,1,-1),Es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,jh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function ao(m,a,f,_,b,E){const I=m.gl,A=a.paint.get("sky-atmosphere-color"),R=a.paint.get("sky-atmosphere-halo-color"),B=a.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:u.fromMat4(u.create$1(),_),u_sun_direction:b,u_sun_intensity:B,u_color_tint_r:[(ie=A).r,ie.g,ie.b,ie.a],u_color_tint_m:[(ne=R).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var ie,ne;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+E,a.skyboxTexture,0),f.draw(m,I.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,z,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const _c=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class al{constructor(a){const f=new u.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const _=new u.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,_c.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const er={symbol:function(m,a,f,_,b){if("translucent"!==m.renderPass)return;const E=u.StencilMode.disabled,I=m.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(A,R,B,z,H,K,te){const ie=R.transform,ne="map"===H,re="map"===K;for(const G of A){const ee=z.getTile(G),le=ee.getBucket(B);if(!le||!le.text||!le.text.segments.get().length)continue;const ce=u.evaluateSizeForZoom(le.textSizeData,ie.zoom),Ee=gi(G,le.getProjection(),ie),Te=ie.calculatePixelsToTileUnitsMatrix(ee),Ce=it(Ee,ee.tileID.canonical,re,ne,ie,le.getProjection(),Te),Ne="none"!==B.layout.get("icon-text-fit")&&le.hasIconData();if(ce){const Pe=Math.pow(2,ie.zoom-ee.tileID.overscaledZ);eu(le,ne,re,te,u.symbolSize,ie,Ce,G,Pe,ce,Ne)}}}(_,m,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),b),0!==f.paint.get("icon-opacity").constantOr(1)&&Ys(m,a,f,_,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),E,I),0!==f.paint.get("text-opacity").constantOr(1)&&Ys(m,a,f,_,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),E,I),a.map.showCollisionBoxes&&(ol(m,a,f,_,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),ol(m,a,f,_,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,f,_){if("translucent"!==m.renderPass)return;const b=f.paint.get("circle-opacity"),E=f.paint.get("circle-stroke-width"),I=f.paint.get("circle-stroke-opacity"),A=void 0!==f.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===E.constantOr(1)||0===I.constantOr(1)))return;const R=m.context,B=R.gl,z=m.transform,H=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),K=u.StencilMode.disabled,te=m.colorModeForRenderPass(),ie="globe"===z.projection.name,ne=[u.mercatorXfromLng(z.center.lng),u.mercatorYfromLat(z.center.lat)],re=[];for(let ee=0;ee<_.length;ee++){const le=_[ee],ce=a.getTile(le),Ee=ce.getBucket(f);if(!Ee||Ee.projection.name!==z.projection.name)continue;const Te=Ee.programConfigurations.get(f.id),Ce=zu(f);ie&&Ce.push("PROJECTION_GLOBE_VIEW");const Ne=m.useProgram("circle",Te,Ce),Pe=Ee.layoutVertexBuffer,Xe=Ee.globeExtVertexBuffer,Et=Ee.indexBuffer,je=z.projection.createInversionMatrix(z,le.canonical),ut={programConfiguration:Te,program:Ne,layoutVertexBuffer:Pe,globeExtVertexBuffer:Xe,indexBuffer:Et,uniformValues:ko(m,le,ce,je,ne,f),tile:ce};if(A){const et=Ee.segments.get();for(const xt of et)re.push({segments:new u.SegmentVector([xt]),sortKey:xt.sortKey,state:ut})}else re.push({segments:Ee.segments,sortKey:0,state:ut})}A&&re.sort((ee,le)=>ee.sortKey-le.sortKey);const G={useDepthForOcclusion:!ie};for(const ee of re){const{programConfiguration:le,program:ce,layoutVertexBuffer:Ee,globeExtVertexBuffer:Te,indexBuffer:Ce,uniformValues:Ne,tile:Pe}=ee.state,Xe=ee.segments;m.terrain&&m.terrain.setupElevationDraw(Pe,ce,G),m.prepareDrawProgram(R,ce,Pe.tileID.toUnwrapped()),ce.draw(R,B.TRIANGLES,H,K,te,u.CullFaceMode.disabled,Ne,f.id,Ee,Ce,Xe,f.paint,z.zoom,le,[Te])}},heatmap:function(m,a,f,_){if(0!==f.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const b=m.context,E=b.gl,I=u.StencilMode.disabled,A=new u.ColorMode([E.ONE,E.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(te,ie,ne,re){const G=te.gl,ee=ie.width*re,le=ie.height*re;te.activeTexture.set(G.TEXTURE1),te.viewport.set([0,0,ee,le]);let ce=ne.heatmapFbo;if(!ce||ce&&(ce.width!==ee||ce.height!==le)){ce&&ce.destroy();const Ee=G.createTexture();G.bindTexture(G.TEXTURE_2D,Ee),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ce=ne.heatmapFbo=te.createFramebuffer(ee,le,!1),function(Te,Ce,Ne,Pe,Xe,Et){const je=Te.gl;je.texImage2D(je.TEXTURE_2D,0,Te.isWebGL2&&Te.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Xe,Et,0,je.RGBA,Te.extRenderToTextureHalfFloat?Te.isWebGL2?je.HALF_FLOAT:Te.extTextureHalfFloat.HALF_FLOAT_OES:je.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Ne)}(te,0,Ee,ce,ee,le)}else G.bindTexture(G.TEXTURE_2D,ce.colorAttachment.get()),te.bindFramebuffer.set(ce.framebuffer)})(b,m,f,"globe"===m.transform.projection.name?.5:.25),b.clear({color:u.Color.transparent});const R=m.transform,B="globe"===R.projection.name,z=B?["PROJECTION_GLOBE_VIEW"]:null,H=B?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,K=[u.mercatorXfromLng(R.center.lng),u.mercatorYfromLat(R.center.lat)];for(let te=0;te<_.length;te++){const ie=_[te];if(a.hasRenderableParent(ie))continue;const ne=a.getTile(ie),re=ne.getBucket(f);if(!re||re.projection.name!==R.projection.name)continue;const G=re.programConfigurations.get(f.id),ee=m.useProgram("heatmap",G,z),{zoom:le}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ne,ee),m.prepareDrawProgram(b,ee,ie.toUnwrapped());const ce=R.projection.createInversionMatrix(R,ie.canonical);ee.draw(b,E.TRIANGLES,u.DepthMode.disabled,I,A,H,Bu(m,ie,ne,ce,K,le,f.paint.get("heatmap-intensity")),f.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,f.paint,m.transform.zoom,G,B?[re.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,E){const I=b.context,A=I.gl,R=E.heatmapFbo;if(!R)return;I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(A.TEXTURE1);let B=E.colorRampTexture;B||(B=E.colorRampTexture=new u.Texture(I,E.colorRamp,A.RGBA)),B.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(I,A.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,b.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(m,f))},line:function(m,a,f,_){if("translucent"!==m.renderPass)return;const b=f.paint.get("line-opacity"),E=f.paint.get("line-width");if(0===b.constantOr(1)||0===E.constantOr(1))return;const I=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),A=m.colorModeForRenderPass(),R=m.terrain&&m.terrain.renderingToTexture?1:u.exported.devicePixelRatio,B=f.paint.get("line-dasharray"),z=B.constantOr(1),H=f.layout.get("line-cap"),K=f.paint.get("line-pattern"),te=K.constantOr(1),ie=f.paint.get("line-gradient"),ne=te?"linePattern":"line",re=m.context,G=re.gl,ee=(ce=>{const Ee=[];qo(ce)&&Ee.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&Ee.push("RENDER_LINE_GRADIENT");const Te=ce.paint.get("line-trim-offset");0===Te[0]&&0===Te[1]||Ee.push("RENDER_LINE_TRIM_OFFSET");const Ce=ce.paint.get("line-pattern").constantOr(1),Ne=1!==ce.paint.get("line-opacity").constantOr(1);return!Ce&&Ne&&Ee.push("RENDER_LINE_ALPHA_DISCARD"),Ee})(f);let le=ee.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ce of _){const Ee=a.getTile(ce);if(te&&!Ee.patternsLoaded())continue;const Te=Ee.getBucket(f);if(!Te)continue;m.prepareDrawTile();const Ce=Te.programConfigurations.get(f.id),Ne=m.useProgram(ne,Ce,ee),Pe=K.constantOr(null);if(Pe&&Ee.imageAtlas){const lt=Ee.imageAtlas.patternPositions[Pe.toString()];lt&&Ce.setConstantPatternPositions(lt)}const Xe=B.constantOr(null),Et=H.constantOr(null);if(!te&&Xe&&Et&&Ee.lineAtlas){const lt=Ee.lineAtlas.getDash(Xe,Et);lt&&Ce.setConstantPatternPositions(lt)}let[je,ut]=f.paint.get("line-trim-offset");("round"===Et||"square"===Et)&&je!==ut&&(0===je&&(je-=1),1===ut&&(ut+=1));const et=m.terrain?ce.projMatrix:null,xt=te?Ws(m,Ee,f,et,R):tn(m,Ee,f,et,Te.lineClipsArray.length,R,[je,ut]);if(ie){const lt=Te.gradients[f.id];let Dt=lt.texture;if(f.gradientVersion!==lt.version){let pt=256;if(f.stepInterpolant){const It=a.getSource().maxzoom,un=ce.canonical.z===It?Math.ceil(1<<m.transform.maxZoom-ce.canonical.z):1;pt=u.clamp(u.nextPowerOfTwo(Te.maxLineLength/u.EXTENT*1024*un),256,re.maxTextureSize)}lt.gradient=u.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:lt.gradient||void 0,clips:Te.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new u.Texture(re,lt.gradient,G.RGBA),lt.version=f.gradientVersion,Dt=lt.texture}re.activeTexture.set(G.TEXTURE1),Dt.bind(f.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}z&&(re.activeTexture.set(G.TEXTURE0),Ee.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),Ce.updatePaintBuffers()),te&&(re.activeTexture.set(G.TEXTURE0),Ee.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ce.updatePaintBuffers()),m.prepareDrawProgram(re,Ne,ce.toUnwrapped());const We=lt=>{Ne.draw(re,G.TRIANGLES,I,lt,A,u.CullFaceMode.disabled,xt,f.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,f.paint,m.transform.zoom,Ce,[Te.layoutVertexBuffer2])};if(le){const lt=m.stencilModeForClipping(ce).ref;0===lt&&m.terrain&&re.clear({stencil:0});const Dt={func:G.EQUAL,mask:255};xt.u_alpha_discard_threshold=.8,We(new u.StencilMode(Dt,lt,255,G.KEEP,G.KEEP,G.INVERT)),xt.u_alpha_discard_threshold=0,We(new u.StencilMode(Dt,lt,255,G.KEEP,G.KEEP,G.KEEP))}else We(m.stencilModeForClipping(ce))}le&&(m.resetStencilClippingMasks(),m.terrain&&re.clear({stencil:0}))},fill:function(m,a,f,_){const b=f.paint.get("fill-color"),E=f.paint.get("fill-opacity");if(0===E.constantOr(1))return;const I=m.colorModeForRenderPass(),A=f.paint.get("fill-pattern"),R=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===b.constantOr(u.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(m.renderPass===R){const B=m.depthModeForSublayer(1,"opaque"===m.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);pc(m,a,f,_,B,I,!1)}if("translucent"===m.renderPass&&f.paint.get("fill-antialias")){const B=m.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);pc(m,a,f,_,B,I,!0)}},"fill-extrusion":function(m,a,f,_){const b=f.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===m.renderPass){const E=new u.DepthMode(m.context.gl.LEQUAL,u.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==b||f.paint.get("fill-extrusion-pattern").constantOr(1))Js(m,a,f,_,E,u.StencilMode.disabled,u.ColorMode.disabled),Js(m,a,f,_,E,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const I=m.colorModeForRenderPass();Js(m,a,f,_,E,u.StencilMode.disabled,I)}}},hillshade:function(m,a,f,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const b=m.context,E=m.depthModeForSublayer(0,u.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),A=m.terrain&&m.terrain.renderingToTexture,[R,B]="translucent"!==m.renderPass||A?[{},_]:m.stencilConfigForOverlap(_);for(const z of B){const H=a.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===m.renderPass)Yr(m,H,f,E,u.StencilMode.disabled,I);else if("translucent"===m.renderPass){const K=A&&m.terrain?m.terrain.stencilModeForRTTOverlap(z):R[z.overscaledZ];cc(m,z,H,f,E,K,I)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,f,_,b,E){if("translucent"!==m.renderPass||0===f.paint.get("raster-opacity")||!_.length)return;const I=m.context,A=I.gl,R=a.getSource(),B=m.useProgram("raster"),z=m.colorModeForRenderPass(),H=m.terrain&&m.terrain.renderingToTexture,[K,te]=R instanceof Gn||H?[{},_]:m.stencilConfigForOverlap(_),ie=te[te.length-1].overscaledZ,ne=!m.options.moving;for(const re of te){const G=H?u.DepthMode.disabled:m.depthModeForSublayer(re.overscaledZ-ie,1===f.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,A.LESS),ee=re.toUnwrapped(),le=a.getTile(re);if(H&&(!le||!le.hasData()))continue;const ce=H?re.projMatrix:m.transform.calculateProjMatrix(ee,ne),Ee=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(re):K[re.overscaledZ],Te=E?0:f.paint.get("raster-fade-duration");le.registerFadeDuration(Te);const Ce=a.findLoadedParent(re,0),Ne=La(le,Ce,a,m.transform,Te);let Pe,Xe;m.terrain&&m.terrain.prepareDrawTile();const Et="nearest"===f.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),le.texture.bind(Et,A.CLAMP_TO_EDGE),I.activeTexture.set(A.TEXTURE1),Ce?(Ce.texture.bind(Et,A.CLAMP_TO_EDGE),Pe=Math.pow(2,Ce.tileID.overscaledZ-le.tileID.overscaledZ),Xe=[le.tileID.canonical.x*Pe%1,le.tileID.canonical.y*Pe%1]):le.texture.bind(Et,A.CLAMP_TO_EDGE),le.texture.useMipmap&&I.extTextureFilterAnisotropic&&m.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const je=zl(ce,Xe||[0,0],Pe||1,Ne,f,R instanceof Gn?R.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(I,B,ee),R instanceof Gn)R.boundsBuffer&&R.boundsSegments&&B.draw(I,A.TRIANGLES,G,u.StencilMode.disabled,z,u.CullFaceMode.disabled,je,f.id,R.boundsBuffer,m.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:ut,tileBoundsIndexBuffer:et,tileBoundsSegments:xt}=m.getTileBoundsBuffers(le);B.draw(I,A.TRIANGLES,G,Ee,z,u.CullFaceMode.disabled,je,f.id,ut,et,xt)}}m.resetStencilClippingMasks()},background:function(m,a,f,_){const b=f.paint.get("background-color"),E=f.paint.get("background-opacity");if(0===E)return;const I=m.context,A=I.gl,R=m.transform,B=R.tileSize,z=f.paint.get("background-pattern");if(m.isPatternMissing(z))return;const H=!z&&1===b.a&&1===E&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const K=u.StencilMode.disabled,te=m.depthModeForSublayer(0,"opaque"===H?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),ie=m.colorModeForRenderPass(),ne=m.useProgram(z?"backgroundPattern":"background");let re,G=_;G||(re=m.getBackgroundTiles(),G=Object.values(re).map(ee=>ee.tileID)),z&&(I.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));for(const ee of G){const le=ee.toUnwrapped(),ce=_?ee.projMatrix:m.transform.calculateProjMatrix(le);m.prepareDrawTile();const Ee=a?a.getTile(ee):re?re[ee.key]:new u.Tile(ee,B,R.zoom,m),Te=z?Qc(ce,E,m,z,{tileID:ee,tileSize:B}):ni(ce,E,b);m.prepareDrawProgram(I,ne,le);const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:Ne,tileBoundsSegments:Pe}=m.getTileBoundsBuffers(Ee);ne.draw(I,A.TRIANGLES,te,K,ie,u.CullFaceMode.disabled,Te,f.id,Ce,Ne,Pe)}},sky:function(m,a,f){const _=m.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:u.smoothstep(7,8,_.zoom),E=f.paint.get("sky-opacity")*b;if(0===E)return;const I=m.context,A=f.paint.get("sky-type"),R=new u.DepthMode(I.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),B=m.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===m.renderPass?f.needsSkyboxCapture(m)&&(function(z,H,K,te){const ie=z.context,ne=ie.gl;let re=H.skyboxFbo;if(!re){re=H.skyboxFbo=ie.createFramebuffer(32,32,!1),H.skyboxGeometry=new gc(ie),H.skyboxTexture=ie.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,H.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ce=0;ce<6;++ce)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(re.framebuffer),ie.viewport.set([0,0,32,32]);const G=H.getCenter(z,!0),ee=z.useProgram("skyboxCapture"),le=new Float64Array(16);u.identity(le),u.rotateY(le,le,.5*-Math.PI),ao(ie,H,ee,le,G,0),u.identity(le),u.rotateY(le,le,.5*Math.PI),ao(ie,H,ee,le,G,1),u.identity(le),u.rotateX(le,le,.5*-Math.PI),ao(ie,H,ee,le,G,2),u.identity(le),u.rotateX(le,le,.5*Math.PI),ao(ie,H,ee,le,G,3),u.identity(le),ao(ie,H,ee,le,G,4),u.identity(le),u.rotateY(le,le,Math.PI),ao(ie,H,ee,le,G,5),ie.viewport.set([0,0,z.width,z.height])}(m,f),f.markSkyboxValid(m)):"sky"===m.renderPass&&function(z,H,K,te,ie){const ne=z.context,re=ne.gl,G=z.transform,ee=z.useProgram("skybox");ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,H.skyboxTexture);const le={u_matrix:G.skyboxMatrix,u_sun_direction:H.getCenter(z,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:ie};z.prepareDrawProgram(ne,ee),ee.draw(ne,re.TRIANGLES,K,u.StencilMode.disabled,z.colorModeForRenderPass(),u.CullFaceMode.backCW,le,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,f,R,E,B):"gradient"===A&&"sky"===m.renderPass&&function(z,H,K,te,ie){const ne=z.context,re=ne.gl,G=z.transform,ee=z.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new gc(ne)),ne.activeTexture.set(re.TEXTURE0);let le=H.colorRampTexture;le||(le=H.colorRampTexture=new u.Texture(ne,H.colorRamp,re.RGBA)),le.bind(re.LINEAR,re.CLAMP_TO_EDGE);const ce=(Ee=G.skyboxMatrix,Te=H.getCenter(z,!1),Ce=H.paint.get("sky-gradient-radius"),Ne=te,Pe=ie,{u_matrix:Ee,u_color_ramp:0,u_center_direction:Te,u_radius:u.degToRad(Ce),u_opacity:Ne,u_temporal_offset:Pe});var Ee,Te,Ce,Ne,Pe;z.prepareDrawProgram(ne,ee),ee.draw(ne,re.TRIANGLES,K,u.StencilMode.disabled,z.colorModeForRenderPass(),u.CullFaceMode.backCW,ce,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,f,R,E,B)},debug:function(m,a,f){for(let _=0;_<f.length;_++)us(m,a,f[_])},custom:function(m,a,f,_){const b=m.context,E=f.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&f.isLayerDraped()){if("offscreen"===m.renderPass){const I=E.prerender;if(I){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const A=m.transform.pointMerc;I.call(E,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(m.transform.zoom),[A.x,A.y],m.transform.pixelsPerMeterRatio)}else I.call(E,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const A=E.renderToTile;if(A){const R=_[0].canonical,B=new u.MercatorCoordinate(R.x+_[0].wrap*(1<<R.z),R.y,R.z);b.setDepthMode(u.DepthMode.disabled),b.setStencilMode(u.StencilMode.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),A.call(E,b.gl,B),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(u.StencilMode.disabled);const I="3d"===E.renderingMode?new u.DepthMode(m.context.gl.LEQUAL,u.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,u.DepthMode.ReadOnly);if(b.setDepthMode(I),"globe"===m.transform.projection.name){const A=m.transform.pointMerc;E.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(m.transform.zoom),[A.x,A.y],m.transform.pixelsPerMeterRatio)}else E.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else u.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ll{constructor(a,f,_=!1){this.context=new Rt(a,_),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,f){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Lo(this,a));const b=this._terrain;this.transform.elevation=_?b:null,b.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||"globe"===this.transform.projection.name||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=f.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const E=_+.78*(b-_);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*u.exported.devicePixelRatio,this.height=f*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const a=this.context,f=new u.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(u.EXTENT,0),f.emplaceBack(0,u.EXTENT),f.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const _=new u.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(u.EXTENT,0),_.emplaceBack(0,u.EXTENT),_.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=a.createVertexBuffer(_,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const b=new u.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(b,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const E=new u.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(u.EXTENT,0,u.EXTENT,0),E.emplaceBack(0,u.EXTENT,0,u.EXTENT),E.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(E,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const I=new u.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const A=new u.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])A.emplaceBack(B);this.debugIndexBuffer=a.createIndexBuffer(A),this.emptyTexture=new u.Texture(a,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=u.create();const R=this.context.gl;this.stencilClearMode=new u.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new al(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,f.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,nl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,_){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){A=!0;break}if(!A)return}this.currentStencilSource=f.id;const b=this.context,E=b.gl;this.nextStencilID+_.length>256&&this.clearStencil(),b.setColorMode(u.ColorMode.disabled),b.setDepthMode(u.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of _){const R=f.getTile(A),B=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:K}=this.getTileBoundsBuffers(R);I.draw(b,E.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:E.ALWAYS,mask:0},B,255,E.KEEP,E.KEEP,E.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,nl(A.projMatrix),"$clipping",z,H,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new u.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new u.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,_=a.sort((I,A)=>A.overscaledZ-I.overscaledZ),b=_[_.length-1].overscaledZ,E=_[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const I={};for(let A=0;A<E;A++)I[A+b]=new u.StencilMode({func:f.GEQUAL,mask:255},A+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=E,[I,_]}return[{[b]:u.StencilMode.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([a.CONSTANT_COLOR,a.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(a,f,_){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new u.DepthMode(_||this.context.gl.LEQUAL,f,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const B in b){const z=b[B];z.used&&z.prepare(this.context)}const E={},I={},A={};for(const B in b){const z=b[B];E[B]=z.getVisibleCoordinates(),I[B]=E[B].slice().reverse(),A[B]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const B of _){const z=this.style._layers[B],H=a._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const K=H?I[H.id]:void 0;("custom"===z.type||z.isSky()||K&&K.length)&&this.renderLayer(this,H,z,K)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);if(B.isSky())continue;const H=z?I[z.id]:void 0;this._renderTileClippingMasks(B,z,H),this.renderLayer(this,z,B,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,z){const H=B.context,K=H.gl,te=B.transform,ie=new u.DepthMode(K.LEQUAL,u.DepthMode.ReadOnly,[0,1]),ne=B.useProgram("globeAtmosphere",null,"globe"===te.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),re=u.globeToMercatorTransition(te.zoom),G=z.properties.get("color").toArray01(),ee=z.properties.get("high-color").toArray01(),le=z.properties.get("space-color").toArray01PremultipliedAlpha(),ce=u.identity$1([]);u.rotateY$1(ce,ce,-u.degToRad(te._center.lng)),u.rotateX$1(ce,ce,u.degToRad(te._center.lat)),u.rotateZ$1(ce,ce,te.angle),u.rotateX$1(ce,ce,-te._pitch);const Ee=u.fromQuat(new Float32Array(16),ce),Te=u.mapValue(z.properties.get("star-intensity"),0,1,0,.25),Ne=u.mapValue(z.properties.get("horizon-blend"),0,1,5e-4,.25),Pe=u.globeUseCustomAntiAliasing(B,H,te)&&5e-4===Ne?te.worldSize/(2*Math.PI*1.025)-1:te.globeRadius,Xe=B.frameCounter/1e3%1,Et=u.length(te.globeCenterInViewSpace),je=Math.sqrt(Math.pow(Et,2)-Math.pow(Pe,2)),ut=Math.acos(je/Et),et={u_frustum_tl:te.frustumCorners.TL,u_frustum_tr:te.frustumCorners.TR,u_frustum_br:te.frustumCorners.BR,u_frustum_bl:te.frustumCorners.BL,u_horizon:te.frustumCorners.horizon,u_transition:re,u_fadeout_range:Ne,u_color:G,u_high_color:ee,u_space_color:le,u_star_intensity:Te,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xe,u_horizon_angle:ut,u_rotation_matrix:Ee};B.prepareDrawProgram(H,ne);const xt=B.atmosphereBuffer;xt&&ne.draw(H,K.TRIANGLES,ie,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,et,"skybox",xt.vertexBuffer,xt.indexBuffer,xt.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,z,B,z?I[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const B=this.style._layers[_[this.currentLayer]],z=a._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=z?("symbol"===B.type?A:I)[z.id]:void 0;this._renderTileClippingMasks(B,z,z?E[z.id]:void 0),this.renderLayer(this,z,B,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;u.values(this.style._layers).forEach(z=>{const H=a._getLayerSourceCache(z);H&&!z.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<H.getSource().maxzoom)&&(B=H)}),B&&this.options.showTileBoundaries&&er.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const z=B.transform.padding;hs(B,B.transform.height-(z.top||0),3,ws),hs(B,z.bottom||0,3,Zd),ka(B,z.left||0,3,Uu),ka(B,B.transform.width-(z.right||0),3,Wd);const H=B.transform.centerPoint;var K,te,ie,ne;Vl(K=B,(te=H.x)-1,(ie=B.transform.height-H.y)-10,2,20,ne=Uh),Vl(K,te-10,ie-1,20,2,ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(_.type)||a.terrain&&"custom"===_.type)&&er[_.type](a,f,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let _=this.gpuTimers[a.id];_||(_=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),_.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),a.beginQueryEXT(a.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const _ in a){const b=a[_],E=this.context.extTimerQuery,I=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),f[_]=I}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let _=0;for(const b of a)_+=f.getQueryObjectEXT(b,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(b);return _}translatePosMatrix(a,f,_,b,E){if(!_[0]&&!_[1])return a;const I=E?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(I){const B=Math.sin(I),z=Math.cos(I);_=[_[0]*z-_[1]*B,_[0]*B+_[1]*z]}const A=[E?_[0]:dn(f,_[0],this.transform.zoom),E?_[1]:dn(f,_[1],this.transform.zoom),0],R=new Float32Array(16);return u.translate(R,a,A),R}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){return null===a||void 0!==a&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),f&&b.push("ZERO_EXAGGERATION"),_&&!a&&0!==_.getOpacity(this.transform.pitch)&&b.push("FOG"),a&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(a,f,_){this.cache=this.cache||{};const b=_||[],E=this.currentGlobalDefines().concat(b),I=ci.cacheKey(Ll[a],a,E,f);return this.cache[I]||(this.cache[I]=new ci(this.context,a,Ll[a],f,Oo[a],E)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),I=((A,R,B,z,H,K,te,ie,ne,re,G)=>{const ee=A.transform,le=R.properties.get("color").toArray01();le[3]=z;const ce=A.frameCounter/1e3%1;return{u_fog_matrix:B?ee.calculateFogTileMatrix(B):A.identityMat,u_fog_range:R.getFovAdjustedRange(ee._fov),u_fog_color:le,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:H,u_frustum_tr:K,u_frustum_br:te,u_frustum_bl:ie,u_globe_pos:ne,u_globe_radius:re,u_viewport:G,u_globe_transition:u.globeToMercatorTransition(ee.zoom),u_is_globe:+("globe"===ee.projection.name)}})(this,b,_,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);f.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)f[b.key]=a[b.key]||new u.Tile(b,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class tu{constructor(a=0,f=0,_=0,b=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=_,this.right=b}interpolate(a,f,_){return null!=f.top&&null!=a.top&&(this.top=u.number(a.top,f.top,_)),null!=f.bottom&&null!=a.bottom&&(this.bottom=u.number(a.bottom,f.bottom,_)),null!=f.left&&null!=a.left&&(this.left=u.number(a.left,f.left,_)),null!=f.right&&null!=a.right&&(this.right=u.number(a.right,f.right,_)),this}getCenter(a,f){const _=u.clamp((this.left+a-this.right)/2,0,a),b=u.clamp((this.top+f-this.bottom)/2,0,f);return new u.Point(_,b)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new tu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wo(m,a){const f=u.getColumn(m,3);u.fromQuat(m,a),u.setColumn(m,3,f)}function Nn(m,a){const f=u.identity$1([]);return u.rotateZ$1(f,f,-a),u.rotateX$1(f,f,-m),f}function Ul(m,a){const f=[m[0],m[1],0],_=[a[0],a[1],0];if(u.length(f)>=1e-15){const I=u.normalize([],f);u.scale$2(_,I,u.dot(_,I)),a[0]=_[0],a[1]=_[1]}const b=u.cross([],a,m);if(u.len(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return Nn(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),E)}class cl{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof u.MercatorCoordinate?a:new u.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=u.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const _=this.position,b=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(a)):0,E=u.MercatorCoordinate.fromLngLat(a,b),I=[E.x-_.x,E.y-_.y,E.z-_.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Ul(I,f)}setPitchBearing(a,f){this.orientation=Nn(u.degToRad(a),u.degToRad(-f))}}class Rn{constructor(a,f){this._transform=u.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new u.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=u.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&u.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||u.identity$1([]),a&&Wo(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=Nn(a,f),Wo(this._transform,this._orientation)}forward(){const a=u.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=u.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=u.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const _=new Float64Array(16);return u.invert(_,this.getWorldToCamera(a,f)),_}getWorldToCameraPosition(a,f,_){const b=this.position;u.scale$2(b,b,-a);const E=new Float64Array(16);return u.fromScaling(E,[_,_,_]),u.translate(E,E,b),E[10]*=f,E}getWorldToCamera(a,f){const _=new Float64Array(16),b=new Float64Array(4),E=this.position;return u.conjugate(b,this._orientation),u.scale$2(E,E,-a),u.fromQuat(_,b),u.translate(_,_,E),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=f,_[9]*=f,_[10]*=f,_[11]*=f,_}getCameraToClipPerspective(a,f,_,b){const E=new Float64Array(16);return u.perspective(E,a,f,_,b),E}getDistanceToElevation(a,f=!1){const _=0===a?0:u.mercatorZfromAltitude(a,f?u.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(_-this.position[2])/b[2]}clone(){return new Rn([...this.position],[...this.orientation])}}function br(m,a){const f=Tr(m.projection,m.zoom,m.width,m.height),_=function(E,I,A,R,B){const z=new u.LngLat(A.lng-180*cr,A.lat),H=new u.LngLat(A.lng+180*cr,A.lat),K=E.project(z.lng,z.lat),te=E.project(H.lng,H.lat),ie=-Math.atan2(te.y-K.y,te.x-K.x),ne=u.MercatorCoordinate.fromLngLat(A);ne.y=u.clamp(ne.y,-1+cr,1-cr);const re=ne.toLngLat(),G=E.project(re.lng,re.lat),ee=u.MercatorCoordinate.fromLngLat(re);ee.x+=cr;const le=ee.toLngLat(),ce=E.project(le.lng,le.lat),Ee=Kr(ce.x-G.x,ce.y-G.y,ie),Te=u.MercatorCoordinate.fromLngLat(re);Te.y+=cr;const Ce=Te.toLngLat(),Ne=E.project(Ce.lng,Ce.lat),Pe=Kr(Ne.x-G.x,Ne.y-G.y,ie),Xe=Math.abs(Ee.x)/Math.abs(Pe.y),Et=u.identity([]);u.rotateZ(Et,Et,-ie*(1-(B?0:R)));const je=u.identity([]);return u.scale(je,je,[1,1-(1-Xe)*R,1]),je[4]=-Pe.x/Pe.y*R,u.rotateZ(je,je,ie),u.multiply(je,Et,je),je}(m.projection,0,m.center,f,a),b=ii(m);return u.scale(_,_,[b,b,1]),_}function ii(m){const a=m.projection,f=Tr(m.projection,m.zoom,m.width,m.height),_=ul(a,m.center),b=ul(a,u.LngLat.convert(a.center));return Math.pow(2,_*f+(1-f)*b)}function Tr(m,a,f,_,b=1/0){const E=m.range;if(!E)return 0;const I=Math.min(b,Math.max(f,_)),A=Math.log(I/1024)/Math.LN2;return u.smoothstep(E[0]+A,E[1]+A,a)}const cr=1/4e4;function ul(m,a){const f=u.clamp(a.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),_=new u.LngLat(a.lng-180*cr,f),b=new u.LngLat(a.lng+180*cr,f),E=m.project(_.lng,f),I=m.project(b.lng,f),A=u.MercatorCoordinate.fromLngLat(_),R=u.MercatorCoordinate.fromLngLat(b),B=I.x-E.x,z=I.y-E.y,H=R.x-A.x,K=R.y-A.y,te=Math.sqrt((H*H+K*K)/(B*B+z*z));return Math.log(te)/Math.LN2}function Kr(m,a,f){const _=Math.cos(f),b=Math.sin(f);return{x:m*_-a*b,y:m*b+a*_}}class Oa{constructor(a,f,_,b,E,I,A){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=b??60,this.setProjection(I),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new tu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Rn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new Oa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,f=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const _=!Q(f,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.Point(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var _,b,E,I,A,R,B,z,H,K;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(_=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,I=this.angle,A=(E=this.rotationMatrix)[0],R=E[1],B=E[2],z=E[3],H=Math.sin(I),K=Math.cos(I),b[0]=A*K+B*H,b[1]=R*K+z*H,b[2]=A*-H+B*K,b[3]=R*-H+z*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=u.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=u.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,E=0;for(let I=0;I<f.length;I++){const A=new u.Point(f[I][0]*this.width,_+f[I][1]*(this.height-_)),R=a.pointCoordinate(A);if(!R)continue;const B=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);b+=R[3]*B,E+=B}return 0===E?NaN:b/E}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*f,b=this._mercatorZfromZoom(a),E=this._mercatorZfromZoom(this._maxZoom),I=Math.max(b-_,E);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const b=u.length(u.sub([],this._camera.position,_));return u.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!u.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];u.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new cl;return f.position=new u.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!u.length$1(a))return!1;u.normalize$1(a,a);const f=u.transformQuat([],[0,0,-1],a),_=u.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;const b=Ul(f,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;a[2]=u.clamp(a[2],b/_,b/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,_){this._unmodified=!1,this._edgeInsets.interpolate(a,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new u.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new u.Point(0,0)),b=this.pointCoordinate(new u.Point(this.width,0)),E=this.pointCoordinate(new u.Point(this.width,this.height)),I=this.pointCoordinate(new u.Point(0,this.height)),A=Math.floor(Math.min(_.x,b.x,E.x,I.x)),R=Math.floor(Math.max(_.x,b.x,E.x,I.x)),B=1;for(let z=A-B;z<=R+B;z++)0!==z&&f.push(new u.UnwrappedTileID(z,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const _=f,b=this.elevation&&!a.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==a.minzoom&&f<a.minzoom)return[];void 0!==a.maxzoom&&f>a.maxzoom&&(f=a.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,R=1<<f,B=[R*I.x,R*I.y,0],z="globe"===this.projection.name,H=!z,K=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,H),te=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=R*u.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),re=[R*te.x,R*te.y,ne*(H?1:ie)],G=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,le=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=a.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?ii(this):1,Te=We=>{const Dt=new u.MercatorCoordinate(We.x+25e-6,We.y,We.z),pt=new u.MercatorCoordinate(We.x,We.y+25e-6,We.z),It=We.toLngLat(),un=Dt.toLngLat(),Ln=pt.toLngLat(),en=this.locationCoordinate(It),wn=this.locationCoordinate(un),ei=this.locationCoordinate(Ln),Jn=Math.hypot(wn.x-en.x,wn.y-en.y),Kt=Math.hypot(ei.x-en.x,ei.y-en.y);return Math.sqrt(Jn*Kt)*Ee/25e-6},Ce=We=>{const lt=le,Dt=ce;return{aabb:u.tileAABB(this,R,0,0,0,We,Dt,lt,this.projection),zoom:0,x:0,y:0,minZ:Dt,maxZ:lt,wrap:We,fullyVisible:!1}},Ne=[];let Pe=[];const Xe=f,Et=a.reparseOverscaled?_:f,je=We=>We*We,ut=je((ne-this._centerAltitude)*ie),et=We=>{if(!this._elevation||!We.tileID||!E)return;const lt=this._elevation.getMinMaxForTile(We.tileID),Dt=We.aabb;lt?(Dt.min[2]=lt.min,Dt.max[2]=lt.max,Dt.center[2]=(Dt.min[2]+Dt.max[2])/2):(We.shouldSplit=xt(We),We.shouldSplit||(Dt.min[2]=Dt.max[2]=Dt.center[2]=this._centerAltitude))},xt=We=>{if(We.zoom<ee)return!0;if(We.zoom===Xe)return!1;if(null!=We.shouldSplit)return We.shouldSplit;const lt=We.aabb.distanceX(re),Dt=We.aabb.distanceY(re);let pt=ut,It=1;if(z){pt=je(We.aabb.distanceZ(re));const en=Math.pow(2,We.zoom),wn=u.latFromMercatorY((We.y+1)/en),ei=u.latFromMercatorY(We.y/en),Jn=Math.min(Math.max(A,wn),ei),Kt=u.circumferenceAtLatitude(Jn)/u.circumferenceAtLatitude(A);if(It=Jn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Kt/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&We.zoom===Xe-1&&Kt>=.9)return!0}else if(b&&(pt=je(We.aabb.distanceZ(re)*ie)),this.projection.isReprojectedInTileSpace&&_<=5){const en=Math.pow(2,We.zoom),wn=Te(new u.MercatorCoordinate((We.x+.5)/en,(We.y+.5)/en));It=wn>.85?1:wn}const un=lt*lt+Dt*Dt+pt;return un<je((1<<Xe-We.zoom)*G*It*((en,wn)=>{if(wn*je(.707)<en)return 1;const ei=Math.sqrt(wn/en);return ei/(1.4144271570014144+(Math.pow(1.1,ei-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,ut),un))};if(this.renderWorldCopies)for(let We=1;We<=3;We++)Ne.push(Ce(-We)),Ne.push(Ce(We));for(Ne.push(Ce(0));Ne.length>0;){const We=Ne.pop(),lt=We.x,Dt=We.y;let pt=We.fullyVisible;if(!pt){const It=We.aabb.intersects(K);if(0===It)continue;pt=2===It}if(We.zoom!==Xe&&xt(We))for(let It=0;It<4;It++){const un=(lt<<1)+It%2,Ln=(Dt<<1)+(It>>1),en={aabb:E?We.aabb.quadrant(It):u.tileAABB(this,R,We.zoom+1,un,Ln,We.wrap,We.minZ,We.maxZ,this.projection),zoom:We.zoom+1,x:un,y:Ln,wrap:We.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:We.minZ,maxZ:We.maxZ};b&&!z&&(en.tileID=new u.OverscaledTileID(We.zoom+1===Xe?Et:We.zoom+1,We.wrap,We.zoom+1,un,Ln),et(en)),Ne.push(en)}else{const It=We.zoom===Xe?Et:We.zoom;if(a.minzoom&&a.minzoom>It)continue;const un=B[0]-(.5+lt+(We.wrap<<We.zoom))*(1<<f-We.zoom),Ln=B[1]-.5-Dt,en=We.tileID?We.tileID:new u.OverscaledTileID(It,We.wrap,We.zoom,lt,Dt);Pe.push({tileID:en,distanceSq:un*un+Ln*Ln})}}if(this.fogCullDistSq){const We=this.fogCullDistSq,lt=this.horizonLineFromTop();Pe=Pe.filter(Dt=>{const pt=[0,0,0,1],It=[u.EXTENT,u.EXTENT,0,1],un=this.calculateFogTileMatrix(Dt.tileID.toUnwrapped());u.transformMat4$1(pt,pt,un),u.transformMat4$1(It,It,un);const Ln=u.getAABBPointSquareDist(pt,It);if(0===Ln)return!0;let en=!1;const wn=this._elevation;if(wn&&Ln>We&&0!==lt){const ei=this.calculateProjMatrix(Dt.tileID.toUnwrapped());let Jn;a.isTerrainDEM||(Jn=wn.getMinMaxForTile(Dt.tileID)),Jn||(Jn={min:ce,max:le});const Kt=u.furthestTileCorner(this.rotation),Ti=[Kt[0]*u.EXTENT,Kt[1]*u.EXTENT,Jn.max];u.transformMat4(Ti,Ti,ei),en=(1-Ti[1])*this.height*.5<lt}return Ln<We||en})}return Pe.sort((We,lt)=>We.distanceSq-lt.distanceSq).map(We=>We.tileID)}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=u.clamp(a.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),_=this.projection.project(a.lng,f);return new u.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/u.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let _,b;const E=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(f.x-E.x)/A,b=(f.y-E.y)/A}else{const A=this.pointCoordinate(f),R=this.pointCoordinate(E);_=A.x-R.x,b=A.y-R.y}const I=this.locationCoordinate(a);this.setLocation(new u.MercatorCoordinate(I.x-_,I.y-b))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const _=f?u.mercatorZfromAltitude(f,a.lat):void 0,b=this.projection.project(a.lng,a.lat);return new u.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const _=f??this._centerAltitude,b=[a.x,a.y,0,1],E=[a.x,a.y,1,1];u.transformMat4$1(b,b,this.pixelMatrixInverse),u.transformMat4$1(E,E,this.pixelMatrixInverse);const I=E[3];u.scale$1(b,b,1/b[3]),u.scale$1(E,E,1/I);const A=b[2],R=E[2];return{p0:b,p1:E,t:A===R?0:(_-A)/(R-A)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return u.transformMat4$1(f,f,this.pixelMatrixInverse),u.transformMat4$1(_,_,this.pixelMatrixInverse),u.scale$1(f,f,1/f[3]),u.scale$1(_,_,1/_[3]),f[2]=u.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,_[2]=u.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,u.scale$1(f,f,1/this.worldSize),u.scale$1(_,_,1/this.worldSize),new u.Ray([f[0],f[1],f[2]],u.normalize([],u.sub([],_,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:_,t:b}=a,E=u.mercatorZfromAltitude(f[2],this._center.lat),I=u.mercatorZfromAltitude(_[2],this._center.lat);return new u.MercatorCoordinate(u.number(f[0],_[0],b)/this.worldSize,u.number(f[1],_[1],b)/this.worldSize,u.number(E,I,b))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let f=this.projection.pointCoordinate3D(this,a.x,a.y);if(f)return new u.MercatorCoordinate(f[0],f[1],f[2]);let _=0,b=this.horizonLineFromTop();if(a.y>b)return this.pointCoordinate(a);const E=.02*b,I=a.clone();for(let A=0;A<10&&b-_>E;A++){I.y=u.number(_,b,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(b=I.y,f=R):_=I.y}return f?new u.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const _=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,b=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return u.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new u.Point(b[0]/b[3],b[1]/b[3]):new u.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new u.Point(f,a)),I=this.pointLocation3D(new u.Point(b,a)),A=this.pointLocation3D(new u.Point(b,_)),R=this.pointLocation3D(new u.Point(f,_));let B=Math.min(E.lng,I.lng,A.lng,R.lng),z=Math.max(E.lng,I.lng,A.lng,R.lng),H=Math.min(E.lat,I.lat,A.lat,R.lat),K=Math.max(E.lat,I.lat,A.lat,R.lat);const te=Math.pow(2,-this.zoom)/16*270,ie="globe"===this.projection.name?1:4,ne=(re,G,ee,le,ce)=>{const Ee=(re+ee)/2,Te=(G+le)/2,Ce=new u.Point(Ee,Te),{lng:Ne,lat:Pe}=this.pointLocation3D(Ce),Xe=Math.max(0,B-Ne,H-Pe,Ne-z,Pe-K);B=Math.min(B,Ne),z=Math.max(z,Ne),H=Math.min(H,Pe),K=Math.max(K,Pe),(ce<ie||Xe>te)&&(ne(re,G,Ee,Te,ce+1),ne(Ee,Te,ee,le,ce+1))};if(ne(f,a,b,a,1),ne(b,a,b,_,1),ne(b,_,f,_,1),ne(f,_,f,a,1),"globe"===this.projection.name){const[re,G]=u.polesInViewport(this);re?(K=90,z=180,B=-180):G&&(H=-90,z=180,B=-180)}return new u.LngLatBounds(new u.LngLat(B,H),new u.LngLat(z,K))}_getBoundsRectangular(a,f){const{top:_,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=new u.Point(b,_),R=new u.Point(I,_),B=new u.Point(I,E),z=new u.Point(b,E);let H=this.pointCoordinate(A,a),K=this.pointCoordinate(R,a);const te=this.pointCoordinate(B,f),ie=this.pointCoordinate(z,f),ne=(re,G)=>(G.y-re.y)/(G.x-re.x);return H.y>1&&K.y>=0?H=new u.MercatorCoordinate((1-ie.y)/ne(ie,H)+ie.x,1):H.y<0&&K.y<=1&&(H=new u.MercatorCoordinate(-ie.y/ne(ie,H)+ie.x,0)),K.y>1&&H.y>=0?K=new u.MercatorCoordinate((1-te.y)/ne(te,K)+te.x,1):K.y<0&&H.y<=1&&(K=new u.MercatorCoordinate(-te.y/ne(te,K)+te.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(te))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce((_,b)=>{if(b.dem){const E=b.dem.tree;_.min=Math.min(_.min,E.minimums[0]),_.max=Math.max(_.max,E.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,_=this._distanceTileDataCache;if(_[f])return _[f];const b=a.canonical,E=1/this.height,I=this.cameraWorldSize,A=I/this.zoomScale(b.z),R=(b.x+Math.pow(2,b.z)*a.wrap)*A,B=b.y*A,z=this.point;z.x*=I/this.worldSize,z.y*=I/this.worldSize;const H=this.angle,K=Math.sin(-H),te=-Math.cos(-H);return _[f]={bearing:[K,te],center:[(z.x-R)*E,(z.y-B)*E],scale:A/u.EXTENT*E},_[f]}calculateFogTileMatrix(a){const f=a.key,_=this._fogTileMatrixCache;if(_[f])return _[f];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return u.multiply(b,this.worldToFogMatrix,b),_[f]=new Float32Array(b),_[f]}calculateProjMatrix(a,f=!1){const _=a.key,b=f?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const E=this.calculatePosMatrix(a,this.worldSize);return u.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,E),b[_]=new Float32Array(E),b[_]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[f])return _[f];const b=function(E,I){const{scale:A}=E.tileTransform,R=A*u.EXTENT/(E.tileSize*Math.pow(2,I.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return B=new Float32Array(4),K=(z=I.inverseAdjustmentMatrix)[1],te=z[2],ie=z[3],re=(H=[R,R])[1],B[0]=z[0]*(ne=H[0]),B[1]=K*ne,B[2]=te*re,B[3]=ie*re,B;var B,z,H,K,te,ie,ne,re}(a,this);return _[f]=b,_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const a=1/this.worldSize,f=u.fromScaling([],[a,a,a]);return u.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const f=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),b=this._camera.forward(),E=u.mercatorZfromAltitude(1,this._center.lat);_[2]/=E,b[2]/=E,u.normalize(b,b);const I=a.raycast(_,b,a.exaggeration());if(I){const A=u.scaleAndAdd([],_,b,I),R=new u.MercatorCoordinate(A[0],A[1],u.mercatorZfromAltitude(A[2],u.latFromMercatorY(A[1]))),B=(R.z+u.length([R.x-_[0],R.y-_[1],R.z-_[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,_=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(_),E=f.getAtPointOrZero(new u.MercatorCoordinate(...b)),I=this.pixelsPerMeter/this.worldSize*E,A=this._minimumHeightOverTerrain(),R=b[2]-I;if(R<=A)if(R<0||a){const B=this.locationCoordinate(this._center,this._centerAltitude),z=[b[0],b[1],B.z-b[2]],H=u.length(z);z[2]-=(A-R)/this._pixelsPerMercatorPixel;const K=u.length(z);if(0===K)return;u.scale$2(z,z,H/K*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],B.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const K=this.center;return K.lat=u.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(K.lng=u.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const f=this._unmodified,{x:_,y:b}=this.point;let E=0,I=_,A=b;const R=this.width/2,B=this.height/2,z=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(b-B<z&&(A=z+B),b+B>H&&(A=H-B),H-z<this.height&&(E=Math.max(E,this.height/(H-z)),A=(H+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,ie=this.worldSize/2-(K+te)/2;I=(_+ie+this.worldSize)%this.worldSize-ie,I-R<K&&(I=K+R),I+R>te&&(I=te-R),te-K<this.width&&(E=Math.max(E,this.width/(te-K)),I=(te+K)/2)}I===_&&A===b||(this.center=this.unproject(new u.Point(I,A))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const _=Tr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b="meters"===this.projection.zAxisUnit?f:1,E=this._camera.getWorldToCamera(this.worldSize,b),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-a.x/this.width,I[9]=2*a.y/this.height;let A=u.mul([],I,E);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),Ce=u.identity([]);u.translate(Ce,Ce,[Te.x*this.worldSize,Te.y*this.worldSize,0]),u.multiply(Ce,Ce,br(this)),u.translate(Ce,Ce,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),u.multiply(A,A,Ce),this.inverseAdjustmentMatrix=function(Ne){const Pe=br(Ne,!0);return ze([],[Pe[0],Pe[1],Pe[4],Pe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],A,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=A,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const R=u.invert([],I);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);u.identity(B),u.scale(B,B,[1,-1,1]),u.rotateX(B,B,this._pitch),u.rotateZ(B,B,this.angle);const z=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-a.x/this.width,z[9]=2*(a.y+H)/this.height,this.skyboxMatrix=u.multiply(B,z,B);const K=this.point,te=K.x,ie=K.y,ne=this.width%2/2,re=this.height%2/2,G=Math.cos(this.angle),ee=Math.sin(this.angle),le=te-Math.round(te)+G*ne+ee*re,ce=ie-Math.round(ie)+G*re+ee*ne,Ee=new Float64Array(A);if(u.translate(Ee,Ee,[le>.5?le-1:le,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=Ee,A=u.create(),u.scale(A,A,[this.width/2,-this.height/2,1]),u.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=u.create(),u.scale(A,A,[1,-1,1]),u.translate(A,A,[-1,-1,0]),u.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=u.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(Te,Te,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[a,a,f];u.scale$2(E,E,b),u.scale$2(_,_,-1),u.multiply$2(_,_,E);const I=u.create();u.translate(I,I,_),u.scale(I,I,E),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,b)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*E,b.y/this.worldSize-_[1]*E,a/this.worldSize*this._centerAltitude-_[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],b=a[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((f-_)/b,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,a,E),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),E=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),A=Math.max((a[2]-E)/Math.cos(_),I),R=this._zoomFromMercatorZ(A);u.scaleAndAdd(a,a,f,A),this._pitch=u.clamp(_,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(b,-Math.PI,Math.PI),this._setZoom(u.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,_=u.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;_-f>1e-6&&_>f;){const I=f+.5*(_-f),A=this.tileSize*Math.pow(2,I),R=this.getCameraToCenterDistance(this.projection,I,A),B=this.scaleZoom(R/(a*this.tileSize)),z=Math.abs(I-B);z<E&&(E=z,b=I),I<B?f=I:_=I}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const _=Math.min(a.x,f.x),b=Math.max(a.x,f.x),E=Math.min(a.y,f.y),I=Math.max(a.y,f.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new u.Point(_,E),new u.Point(b,I),new u.Point(_,I),new u.Point(b,E)],R=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const z of A){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const K=this.rayIntersectionCoordinate(H);if(K.x<R||K.y<0||K.x>B||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.Point(0,0),new u.Point(this.width,this.height))}zoomDeltaToMovement(a,f){const _=u.length(u.sub([],this._camera.position,a)),b=this._zoomFromMercatorZ(_)+f;return _-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const a=function([f,_,b],E){const I=[f,_,b,1];u.transformMat4$1(I,I,E);const A=I[3]=Math.max(I[3],1e-6);return I[0]/=A,I[1]/=A,I[2]/=A,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,a))}}getCameraToCenterDistance(a,f=this.zoom,_=this.worldSize){const b=Tr(a,f,this.width,this.height,1024),E=a.pixelSpaceConversion(this.center.lat,_,b);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(a,a,this.globeMatrix),a}}function Na(m,a){let f=!1,_=null;const b=()=>{_=null,f&&(m(),_=setTimeout(b,a),f=!1)};return()=>(f=!0,_||b(),_)}class hl{constructor(a){this._hashName=a&&encodeURIComponent(a),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Na(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,u.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=jl(a);if(this._hashName){const _=this._hashName;let b=!1;const E=u.window.location.hash.slice(1).split("&").map(I=>{const A=I.split("=")[0];return A===_?(b=!0,`${A}=${f}`):I}).filter(I=>I);return b||E.push(`${_}=${f}`),`#${E.join("&")}`}return`#${f}`}_getCurrentHash(){const a=u.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(f=_)}),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,a)}}function jl(m,a){const f=m.getCenter(),_=Math.round(100*m.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),I=Math.round(f.lng*E)/E,A=Math.round(f.lat*E)/E,R=m.getBearing(),B=m.getPitch();let z=a?`/${I}/${A}/${_}`:`${_}/${A}/${I}`;return(R||B)&&(z+="/"+Math.round(10*R)/10),B&&(z+=`/${Math.round(B)}`),z}const yc={linearity:.3,easing:u.bezier(0,0,.3,1)},Yi=u.extend({deceleration:2500,maxSpeed:1400},yc),Jt=u.extend({deceleration:20,maxSpeed:1400},yc),ft=u.extend({deceleration:1e3,maxSpeed:360},yc),h=u.extend({deceleration:1e3,maxSpeed:90},yc);class x{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=u.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const E=k(f.pan.mag(),_,u.extend({},Yi,a||{}));b.offset=f.pan.mult(E.amount/f.pan.mag()),b.center=this._map.transform.center,M(b,E)}if(f.zoom){const E=k(f.zoom,_,Jt);b.zoom=this._map.transform.zoom+E.amount,M(b,E)}if(f.bearing){const E=k(f.bearing,_,ft);b.bearing=this._map.transform.bearing+u.clamp(E.amount,-179,179),M(b,E)}if(f.pitch){const E=k(f.pitch,_,h);b.pitch=this._map.transform.pitch+E.amount,M(b,E)}if(b.zoom||b.bearing){const E=void 0===f.pinchAround?f.around:f.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function M(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function k(m,a,f){const{maxSpeed:_,linearity:b,deceleration:E}=f,I=u.clamp(m*b/(a/1e3),-_,_),A=Math.abs(I)/(E*b);return{easing:f.easing,duration:1e3*A,amount:I*(A/2)}}class U extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,_,b={}){const E=bt(f.getCanvasContainer(),_),I=f.unproject(E);super(a,u.extend({point:E,lngLat:I,originalEvent:_},b)),this._defaultPrevented=!1,this.target=f}}class X extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,_){const b="touchend"===a?_.changedTouches:_.touches,E=Ge(f.getCanvasContainer(),b),I=E.map(R=>f.unproject(R)),A=E.reduce((R,B,z,H)=>R.add(B.div(H.length)),new u.Point(0,0));super(a,{points:E,point:A,lngLats:I,lngLat:f.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class we extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class qe{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new we(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new U(a.type,this._map,a))}mouseup(a){this._map.fire(new U(a.type,this._map,a))}preclick(a){const f=u.extend({},a);f.type="preclick",this._map.fire(new U(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new U(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new U(a.type,this._map,a))}mouseover(a){this._map.fire(new U(a.type,this._map,a))}mouseout(a){this._map.fire(new U(a.type,this._map,a))}touchstart(a){return this._firePreventable(new X(a.type,this._map,a))}touchmove(a){this._map.fire(new X(a.type,this._map,a))}touchend(a){this._map.fire(new X(a.type,this._map,a))}touchcancel(a){this._map.fire(new X(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oe{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new U(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new U("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new U(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tt{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&0===a.button&&(Ft(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const _=f,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(_)||!this._box&&_.dist(b)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Re("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const I=Math.min(b.x,_.x),A=Math.max(b.x,_.x),R=Math.min(b.y,_.y),B=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=A-I+"px",this._box.style.height=B-R+"px")})}mouseupWindow(a,f){if(!this._active)return;const _=this._startPos,b=f;if(_&&0===a.button){if(this.reset(),tt(),_.x!==b.x||_.y!==b.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:E=>E.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ot(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new u.Event(a,{originalEvent:f}))}}function rn(m,a){const f={};for(let _=0;_<m.length;_++)f[m[_].identifier]=a[_];return f}class bn{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const E=new u.Point(0,0);for(const I of b)E._add(I);return E.div(b.length)}(f),this.touches=rn(_,f)))}touchmove(a,f,_){if(this.aborted||!this.centroid)return;const b=rn(_,f);for(const E in this.touches){const I=b[E];(!I||I.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(a,f,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class xn{constructor(a){this.singleTap=new bn(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,_){this.singleTap.touchstart(a,f,_)}touchmove(a,f,_){this.singleTap.touchmove(a,f,_)}touchend(a,f,_){const b=this.singleTap.touchend(a,f,_);if(b){const E=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(E&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Fr{constructor(){this._zoomIn=new xn({numTouches:1,numTaps:2}),this._zoomOut=new xn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,_){this._zoomIn.touchstart(a,f,_),this._zoomOut.touchstart(a,f,_)}touchmove(a,f,_){this._zoomIn.touchmove(a,f,_),this._zoomOut.touchmove(a,f,_)}touchend(a,f,_){const b=this._zoomIn.touchend(a,f,_),E=this._zoomOut.touchend(a,f,_);return b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(b)},{originalEvent:a})}):E?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(E)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ur={0:1,2:2};class Ki{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const _=ke(a);this._correctButton(a,_)&&(this._lastPoint=f,this._eventButton=_)}mousemoveWindow(a,f){const _=this._lastPoint;if(_)if(a.preventDefault(),null!=this._eventButton&&function(b,E){const I=ur[E];return void 0===b.buttons||(b.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(_,f)}mouseupWindow(a){this._lastPoint&&ke(a)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr extends Ki{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return 0===f&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class Qs extends Ki{_correctButton(a,f){return 0===f&&a.ctrlKey||2===f}_move(a,f){const _=.8*(f.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class Cs extends Ki{_correctButton(a,f){return 0===f&&a.ctrlKey||2===f}_move(a,f){const _=-.5*(f.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class Xo{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.Point(0,0)}touchstart(a,f,_){return this._calculateTransform(a,f,_)}touchmove(a,f,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,_)}}touchend(a,f,_){this._calculateTransform(a,f,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,_){_.length>0&&(this._active=!0);const b=rn(_,f),E=new u.Point(0,0),I=new u.Point(0,0);let A=0;for(const B in b){const z=b[B],H=this._touches[B];H&&(E._add(z),I._add(z.sub(H)),A++,b[B]=z)}if(this._touches=b,A<this._minTouches||!I.mag())return;const R=I.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(A),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ea{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,_){return{}}touchstart(a,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,_){const b=this._firstTwoTouches;if(!b)return;a.preventDefault();const[E,I]=b,A=Ts(_,f,E),R=Ts(_,f,I);if(!A||!R)return;const B=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],B,a)}touchend(a,f,_){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,I=Ts(_,f,b),A=Ts(_,f,E);I&&A||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ts(m,a,f){for(let _=0;_<m.length;_++)if(m[_].identifier===f)return a[_]}function ri(m,a){return Math.log(m/a)/Math.LN2}class $h extends ea{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(ri(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ri(this._distance,_),pinchAround:f}}}function hr(m,a){return 180*m.angleWith(a)/Math.PI}class $l extends ea{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hr(this._vector,_),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const b=hr(a,_);return Math.abs(b)<f}}function Jr(m){return Math.abs(m.y)>Math.abs(m.x)}class vc extends ea{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Jr(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,_){const b=this._lastPoints;if(!b)return;const E=a[0].sub(b[0]),I=a[1].sub(b[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(E,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(E.y+I.y)/2*-.5})}gestureBeginsVertically(a,f,_){if(void 0!==this._valid)return this._valid;const b=a.mag()>=2,E=f.mag()>=2;if(!b&&!E)return;if(!b||!E)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=a.y>0==f.y>0;return Jr(a)&&Jr(f)&&I}}const dl={panStep:100,bearingStep:15,pitchStep:10};class fl{constructor(){const a=dl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,_=0,b=0,E=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),E=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),E=1);break;case 38:a.shiftKey?b=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?b=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:zr,zoom:f?Math.round(R)+f*(a.shiftKey?2:1):R,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-I*this._panStep],center:A.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zr(m){return m*(2-m)}const Hh=4.000244140625;class No{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=u.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==f&&f%Hh==0?this._type="wheel":0!==f&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=bt(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Hh?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==B&&(B=1/B);const z=f(),H=Math.pow(2,z),K="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(K*B))),"wheel"===this._type&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:f(),b=this._startZoom,E=this._easing;let I,A=!1;if("wheel"===this._type&&b&&E){const R=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),B=E(R);I=u.number(b,_,B),R<1?this._frameId||(this._frameId=!0):A=!0}else I=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:I-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=u.ease;if(this._prevEase){const _=this._prevEase,b=(u.exported.now()-_.start)/_.duration,E=_.easing(b+.01)-_.easing(b),I=.27/Math.sqrt(E*E+1e-4)*.01,A=Math.sqrt(.0729-I*I);f=u.bezier(I,A,.25,1)}return this._prevEase={start:u.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class To{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class lo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xc{constructor(){this._tap=new xn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=f[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,f,_))}touchmove(a,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=f[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,a.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(a,f,_)}touchend(a,f,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(a,f,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(a,f,_){this._el=a,this._mousePan=f,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ta{constructor(a,f,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xd{constructor(a,f,_,b){this._el=a,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ds=m=>m.zoom||m.drag||m.pitch||m.rotate;class pp extends u.Event{}class Ry{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const _=u.sub([],f,a);this.radius=u.length(_[2]<0?u.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){u.div(a,a,this.constants),u.normalize(a,a),u.mul$1(a,a,this.constants);const f=u.scale$2([],a,this.radius);if(f[2]>0){const _=u.scale$2([],[0,0,1],u.dot(f,[0,0,1])),b=u.scale$2([],u.normalize([],[f[0],f[1],0]),this.radius),E=u.add([],f,u.scale$2([],u.sub([],u.add([],b,_),f),2));f[0]=E[0],f[1]=E[1]}return f}}function na(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Fa{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new x(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ry,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),u.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[b,E,I]of this._listeners)b.addEventListener(E,b===u.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,f,_]of this._listeners)a.removeEventListener(f,a===u.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new qe(f,a));const b=f.boxZoom=new Tt(f,a);this._add("boxZoom",b);const E=new Fr,I=new lo;f.doubleClickZoom=new To(I,E),this._add("tapZoom",E),this._add("clickZoom",I);const A=new xc;this._add("tapDragZoom",A);const R=f.touchPitch=new vc(f);this._add("touchPitch",R);const B=new Qs(a),z=new Cs(a);f.dragRotate=new ta(a,B,z),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new Sr(a),K=new Xo(f,a);f.dragPan=new ju(_,H,K),this._add("mousePan",H),this._add("touchPan",K,["touchZoom","touchRotate"]);const te=new $l,ie=new $h;f.touchZoomRotate=new Xd(_,ie,te,A),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oe(f));const ne=f.scrollZoom=new No(f,this);this._add("scrollZoom",ne,["mousePan"]);const re=f.keyboard=new fl;this._add("keyboard",re);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[G]&&f[G].enable(a[G])}_add(a,f,_){this._handlers.push({handlerName:a,handler:f,allowed:_}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ds(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,_){for(const b in a)if(b!==_&&(!f||f.indexOf(b)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const _ of a)this._el.contains(_.target)&&f.push(_);return f}handleEvent(a,f){this._updatingCamera=!0;const _="renderFrame"===a.type,b=_?void 0:a,E={needsRenderFrame:!1},I={},A={},R=a.touches?this._getMapTouches(a.touches):void 0,B=R?Ge(this._el,R):_?void 0:bt(this._el,a);for(const{handlerName:K,handler:te,allowed:ie}of this._handlers){if(!te.isEnabled())continue;let ne;this._blockedByActive(A,ie,K)?te.reset():te[f||a.type]&&(ne=te[f||a.type](a,B,R),this.mergeHandlerResult(E,I,ne,K,b),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||te.isActive())&&(A[K]=te)}const z={};for(const K in this._previousActiveHandlers)A[K]||(z[K]=b);this._previousActiveHandlers=A,(Object.keys(z).length||na(E))&&(this._changes.push([E,I,z]),this._triggerRenderFrame()),(Object.keys(A).length||na(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=E;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(a,f,_,b,E){if(!_)return;u.extend(a,_);const I={handlerName:b,originalEvent:_.originalEvent||E};void 0!==_.zoomDelta&&(f.zoom=I),void 0!==_.panDelta&&(f.drag=I),void 0!==_.pitchDelta&&(f.pitch=I),void 0!==_.bearingDelta&&(f.rotate=I)}_applyChanges(){const a={},f={},_={};for(const[b,E,I]of this._changes)b.panDelta&&(a.panDelta=(a.panDelta||new u.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(a.around=b.around),void 0!==b.aroundCoord&&(a.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(a.pinchAround=b.pinchAround),b.noInertia&&(a.noInertia=b.noInertia),u.extend(f,E),u.extend(_,I);this._updateMapTransform(a,f,_),this._changes=[]}_updateMapTransform(a,f,_){const b=this._map,E=b.transform,I=ee=>[ee.x,ee.y,ee.z];if((ee=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!na(a)){const ee=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",ee!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!na(a))return void this._fireEvents(f,_,!0);let{panDelta:A,zoomDelta:R,bearingDelta:B,pitchDelta:z,around:H,aroundCoord:K,pinchAround:te}=a;E._isCameraConstrained&&(R>0&&(R=0),E._isCameraConstrained=!1),void 0!==te&&(H=te),(R||(ee=>f.drag&&!this._eventsInProgress.drag)())&&H&&(this._dragOrigin=I(E.pointCoordinate3D(H)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),H=H||b.transform.centerPoint,B&&(E.bearing+=B),z&&(E.pitch+=z),E._updateCameraState();const ie=[0,0,0];if(A)if("mercator"===E.projection.name){const ee=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H).dir),le=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(H.sub(A)).dir);ie[0]=le[0]-ee[0],ie[1]=le[1]-ee[1]}else{const ee=E.pointCoordinate(H);if("globe"===E.projection.name){A=A.rotate(-E.angle);const le=E._pixelsPerMercatorPixel/E.worldSize;ie[0]=-A.x*u.mercatorScale(u.latFromMercatorY(ee.y))*le,ie[1]=-A.y*u.mercatorScale(E.center.lat)*le}else{const le=E.pointCoordinate(H.sub(A));ee&&le&&(ie[0]=le.x-ee.x,ie[1]=le.y-ee.y)}}const ne=E.zoom,re=[0,0,0];if(R){const ee=I(K||E.pointCoordinate3D(H)),le={dir:u.normalize([],u.sub([],ee,E._camera.position))};if(le.dir[2]<0){const ce=E.zoomDeltaToMovement(ee,R);u.scale$2(re,le.dir,ce)}}const G=u.add(ie,ie,re);E._translateCameraConstrained(G),R&&Math.abs(E.zoom-ne)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,_,!0)}_fireEvents(a,f,_){const b=Ds(this._eventsInProgress),E=Ds(a),I={};for(const z in a){const{originalEvent:H}=a[z];this._eventsInProgress[z]||(I[`${z}start`]=H),this._eventsInProgress[z]=a[z]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const z in I)this._fireEvent(z,I[z]);E&&this._fireEvent("move",E.originalEvent);for(const z in a){const{originalEvent:H}=a[z];this._fireEvent(z,H)}const A={};let R;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:K}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],R=f[H]||K,A[`${z}end`]=R)}for(const z in A)this._fireEvent(z,A[z]);const B=Ds(this._eventsInProgress);if(_&&(b||E)&&!B){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:R})):(this._map.fire(new u.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new u.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new pp("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const nu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yd extends u.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=!1!==f.respectPrefersReducedMotion,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,_){return a=u.Point.convert(a).mult(-1),this.panTo(this.transform.center,u.extend({offset:a},f),_)}panTo(a,f,_){return this.easeTo(u.extend({center:a},f),_)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,_){return this.easeTo(u.extend({zoom:a},f),_)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,_){return this.easeTo(u.extend({bearing:a},f),_)}resetNorth(a,f){return this.rotateTo(0,u.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=u.LngLatBounds.convert(a);const _=f&&f.bearing||0,b=f&&f.pitch||0,E=a.getNorthWest(),I=a.getSouthEast();return this._cameraForBounds(this.transform,E,I,_,b,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=u.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const _=a.padding;a.padding={top:_,bottom:_,right:_,left:_}}return a.padding=u.extend(f,a.padding),a}_minimumAABBFrustumDistance(a,f){const _=f.max[0]-f.min[0],b=f.max[1]-f.min[1];return _/b>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):b/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,_,b,E,I){const A=a.clone(),R=this._extendCameraOptions(I);A.bearing=b,A.pitch=E;const B=u.LngLat.convert(f),z=u.LngLat.convert(_),H=.5*(B.lat+z.lat),K=.5*(B.lng+z.lng),te=u.latLngToECEF(H,K),ie=u.normalize([],te),ne=u.normalize([],u.cross([],ie,[0,1,0])),re=u.cross([],ne,ie),G=[ne[0],ne[1],ne[2],0,re[0],re[1],re[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],ee=[te,u.latLngToECEF(B.lat,B.lng),u.latLngToECEF(z.lat,B.lng),u.latLngToECEF(z.lat,z.lng),u.latLngToECEF(B.lat,z.lng),u.latLngToECEF(H,B.lng),u.latLngToECEF(H,z.lng),u.latLngToECEF(B.lat,K),u.latLngToECEF(z.lat,K)];let le=u.Aabb.fromPoints(ee.map(pt=>[u.dot(ne,pt),u.dot(re,pt),u.dot(ie,pt)]));const ce=u.transformMat4([],le.center,G);0===u.squaredLength(ce)&&u.set(ce,0,0,1),u.normalize(ce,ce),u.scale$2(ce,ce,u.GLOBE_RADIUS),A.center=u.ecefToLatLng(ce);const Ee=A.getWorldToCameraMatrix(),Te=u.invert(new Float64Array(16),Ee);le=u.Aabb.applyTransform(le,u.multiply([],Ee,G)),u.transformMat4(ce,ce,Ee);const Ce=.5*(le.max[2]-le.min[2]),Ne=this._minimumAABBFrustumDistance(A,le),Pe=u.scale$2([],[0,0,1],Ce),Xe=u.add(Pe,ce,Pe),Et=Ne+(0===A.pitch?0:u.distance(ce,Xe)),je=A.globeCenterInViewSpace,ut=u.sub([],ce,[je[0],je[1],je[2]]);u.normalize(ut,ut),u.scale$2(ut,ut,Et);const et=u.add([],ce,ut);u.transformMat4(et,et,Te);const xt=u.earthRadius/u.GLOBE_RADIUS,We=u.length(et),lt=u.mercatorZfromAltitude(Math.max(We*xt-u.earthRadius,Number.EPSILON),0),Dt=Math.min(A.zoomFromMercatorZAdjusted(lt),R.maxZoom);return Dt>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=Dt,this._cameraForBounds(A,f,_,b,E,I)):{center:A.center,zoom:Dt,bearing:b,pitch:E}}queryTerrainElevation(a,f){const _=this.transform.elevation;return _?(f=u.extend({},{exaggerated:!0},f),_.getAtPoint(u.MercatorCoordinate.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,_,b,E,I){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,f,_,b,E,I);const A=a.clone(),R=this._extendCameraOptions(I),B=A.padding;A.bearing=b,A.pitch=E;const z=u.LngLat.convert(f),H=u.LngLat.convert(_),K=new u.LngLat(z.lng,H.lat),te=new u.LngLat(H.lng,z.lat),ie=A.project(z),ne=A.project(H),re=this.queryTerrainElevation(z),G=this.queryTerrainElevation(H),ee=this.queryTerrainElevation(K),le=this.queryTerrainElevation(te),ce=[[ie.x,ie.y,Math.min(re||0,G||0,ee||0,le||0)],[ne.x,ne.y,Math.max(re||0,G||0,ee||0,le||0)]];let Ee=u.Aabb.fromPoints(ce);const Te=A.getWorldToCameraMatrix(),Ce=u.invert(new Float64Array(16),Te);Ee=u.Aabb.applyTransform(Ee,Te);const Ne=u.sub([],Ee.max,Ee.min),Pe=B.left||0,Xe=B.right||0,Et=B.bottom||0,je=B.top||0,{left:ut,right:et,top:xt,bottom:We}=R.padding,lt=.5*(Pe+Xe),Dt=.5*(je+Et),pt=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Pe+Xe+ut+et))/Ne[0],(A.height-(Et+je+We+xt))/Ne[1])),R.maxZoom),It=A.scale/A.zoomScale(pt);Ee=new u.Aabb([Ee.min[0]-(ut+lt)*It,Ee.min[1]-(We+Dt)*It,Ee.min[2]],[Ee.max[0]+(et+lt)*It,Ee.max[1]+(xt+Dt)*It,Ee.max[2]]);const un=.5*Ne[2],Ln=this._minimumAABBFrustumDistance(A,Ee),en=[0,0,1,0];u.transformMat4$1(en,en,Te),u.normalize$2(en,en);const wn=u.scale$2([],en,Ln+un),ei=u.add([],Ee.center,wn),Jn=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new u.Point(R.offset.x,R.offset.y):u.Point.convert(R.offset)).rotate(-u.degToRad(b));Ee.center[0]-=Jn.x*It,Ee.center[1]+=Jn.y*It,u.transformMat4(Ee.center,Ee.center,Ce),u.transformMat4(ei,ei,Ce);const Kt=[Ee.center[0],Ee.center[1],ei[2]*A.pixelsPerMeter];u.scale$2(Kt,Kt,1/A.worldSize);const Ti=u.lngFromMercatorX(Kt[0]),Ni=u.latFromMercatorY(Kt[1]),Fi=Math.min(A._zoomFromMercatorZ(Kt[2]),R.maxZoom),Si=new u.LngLat(Ti,Ni);return A.mercatorFromTransition&&Fi<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Fi,this._cameraForBounds(A,f,_,b,E,I)):{center:Si,zoom:Fi,bearing:b,pitch:E}}fitBounds(a,f,_){const b=this.cameraForBounds(a,f);return this._fitInternal(b,f,_)}fitScreenCoordinates(a,f,_,b,E){const I=u.Point.convert(a),A=u.Point.convert(f),R=new u.Point(Math.min(I.x,A.x),Math.min(I.y,A.y)),B=new u.Point(Math.max(I.x,A.x),Math.max(I.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,A))return this;const z=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(B),K=this.transform.pointLocation3D(new u.Point(R.x,B.y)),te=this.transform.pointLocation3D(new u.Point(B.x,R.y)),ie=[Math.min(z.lng,H.lng,K.lng,te.lng),Math.min(z.lat,H.lat,K.lat,te.lat)],ne=[Math.max(z.lng,H.lng,K.lng,te.lng),Math.max(z.lat,H.lat,K.lat,te.lat)],re=b&&b.pitch?b.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,ie,ne,_,re,b);return this._fitInternal(G,b,E)}_fitInternal(a,f,_){return a?(delete(f=u.extend(a,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(a,f){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,I=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(b=!0,_.zoom=+a.zoom),void 0!==a.center&&(_.center=u.LngLat.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(E=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(I=!0,_.pitch=+a.pitch),null==a.padding||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new u.Event("movestart",f)).fire(new u.Event("move",f)),b&&this.fire(new u.Event("zoomstart",f)).fire(new u.Event("zoom",f)).fire(new u.Event("zoomend",f)),E&&this.fire(new u.Event("rotatestart",f)).fire(new u.Event("rotate",f)).fire(new u.Event("rotateend",f)),I&&this.fire(new u.Event("pitchstart",f)).fire(new u.Event("pitch",f)).fire(new u.Event("pitchend",f)),this.fire(new u.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(nu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const _=this.transform;if(!_.projection.supportsFreeCamera)return u.warnOnce(nu),this;this.stop();const b=_.zoom,E=_.pitch,I=_.bearing;_.setFreeCameraOptions(a);const A=b!==_.zoom,R=E!==_.pitch,B=I!==_.bearing;return this.fire(new u.Event("movestart",f)).fire(new u.Event("move",f)),A&&this.fire(new u.Event("zoomstart",f)).fire(new u.Event("zoom",f)).fire(new u.Event("zoomend",f)),B&&this.fire(new u.Event("rotatestart",f)).fire(new u.Event("rotate",f)).fire(new u.Event("rotateend",f)),R&&this.fire(new u.Event("pitchstart",f)).fire(new u.Event("pitch",f)).fire(new u.Event("pitchend",f)),this.fire(new u.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),(!1===(a=u.extend({offset:[0,0],duration:500,easing:u.ease},a)).animate||this._prefersReducedMotion(a))&&(a.duration=0);const _=this.transform,b=this.getZoom(),E=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in a?+a.zoom:b,B="bearing"in a?this._normalizeBearing(a.bearing,E):E,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,K=u.Point.convert(a.offset);let te,ie,ne;if("globe"===_.projection.name){const Pe=u.MercatorCoordinate.fromLngLat(_.center),Xe=K.rotate(-_.angle);Pe.x+=Xe.x/_.worldSize,Pe.y+=Xe.y/_.worldSize;const Et=Pe.toLngLat(),je=u.LngLat.convert(a.center||Et);this._normalizeCenter(je),te=_.centerPoint.add(Xe),ie=new u.Point(Pe.x,Pe.y).mult(_.worldSize),ne=new u.Point(u.mercatorXfromLng(je.lng),u.mercatorYfromLat(je.lat)).mult(_.worldSize).sub(ie)}else{te=_.centerPoint.add(K);const Pe=_.pointLocation(te),Xe=u.LngLat.convert(a.center||Pe);this._normalizeCenter(Xe),ie=_.project(Pe),ne=_.project(Xe).sub(ie)}const re=_.zoomScale(R-b);let G,ee;a.around&&(G=u.LngLat.convert(a.around),ee=_.locationPoint(G));const le=this._zooming||R!==b,ce=this._rotating||E!==B,Ee=this._pitching||z!==I,Te=!_.isPaddingEqual(H),Ce=Pe=>Xe=>{if(le&&(Pe.zoom=u.number(b,R,Xe)),ce&&(Pe.bearing=u.number(E,B,Xe)),Ee&&(Pe.pitch=u.number(I,z,Xe)),Te&&(Pe.interpolatePadding(A,H,Xe),te=Pe.centerPoint.add(K)),G)Pe.setLocationAtPoint(G,ee);else{const Et=Pe.zoomScale(Pe.zoom-b),je=R>b?Math.min(2,re):Math.max(.5,re),ut=Math.pow(je,1-Xe),et=Pe.unproject(ie.add(ne.mult(Xe*ut)).mult(Et));Pe.setLocationAtPoint(Pe.renderWorldCopies?et.wrap():et,te)}return a.preloadOnly||this._fireMoveEvents(f),Pe};if(a.preloadOnly){const Pe=this._emulate(Ce,a.duration,_);return this._preloadTiles(Pe),this}const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=ce,this._pitching=Ee,this._padding=Te,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,Ne),this._ease(Ce(_),Pe=>{_.recenterOnTerrain(),this._afterEase(f,Pe)},a),this}_prepareEase(a,f,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||_.moving||this.fire(new u.Event("movestart",a)),this._zooming&&!_.zooming&&this.fire(new u.Event("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new u.Event("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new u.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new u.Event("move",a)),this._zooming&&this.fire(new u.Event("zoom",a)),this._rotating&&this.fire(new u.Event("rotate",a)),this._pitching&&this.fire(new u.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new u.Event("zoomend",a)),b&&this.fire(new u.Event("rotateend",a)),E&&this.fire(new u.Event("pitchend",a)),this.fire(new u.Event("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const pt=u.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pt,f)}this.stop(),a=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},a);const _=this.transform,b=this.getZoom(),E=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in a?u.clamp(+a.zoom,_.minZoom,_.maxZoom):b,B="bearing"in a?this._normalizeBearing(a.bearing,E):E,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,K=_.zoomScale(R-b),te=u.Point.convert(a.offset);let ie=_.centerPoint.add(te);const ne=_.pointLocation(ie),re=u.LngLat.convert(a.center||ne);this._normalizeCenter(re);const G=_.project(ne),ee=_.project(re).sub(G);let le=a.curve;const ce=Math.max(_.width,_.height),Ee=ce/K,Te=ee.mag();if("minZoom"in a){const pt=u.clamp(Math.min(a.minZoom,b,R),_.minZoom,_.maxZoom),It=ce/_.zoomScale(pt-b);le=Math.sqrt(It/Te*2)}const Ce=le*le;function Ne(pt){const It=(Ee*Ee-ce*ce+(pt?-1:1)*Ce*Ce*Te*Te)/(2*(pt?Ee:ce)*Ce*Te);return Math.log(Math.sqrt(It*It+1)-It)}function Pe(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Xe(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const Et=Ne(0);let je=function(pt){return Xe(Et)/Xe(Et+le*pt)},ut=function(pt){return ce*((Xe(Et)*(Pe(It=Et+le*pt)/Xe(It))-Pe(Et))/Ce)/Te;var It},et=(Ne(1)-Et)/le;if(Math.abs(Te)<1e-6||!isFinite(et)){if(Math.abs(ce-Ee)<1e-6)return this.easeTo(a,f);const pt=Ee<ce?-1:1;et=Math.abs(Math.log(Ee/ce))/le,ut=function(){return 0},je=function(It){return Math.exp(pt*le*It)}}a.duration="duration"in a?+a.duration:1e3*et/("screenSpeed"in a?+a.screenSpeed/le:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const xt=E!==B,We=z!==I,lt=!_.isPaddingEqual(H),Dt=pt=>It=>{const un=It*et,Ln=1/je(un);pt.zoom=1===It?R:b+pt.scaleZoom(Ln),xt&&(pt.bearing=u.number(E,B,It)),We&&(pt.pitch=u.number(I,z,It)),lt&&(pt.interpolatePadding(A,H,It),ie=pt.centerPoint.add(te));const en=1===It?re:pt.unproject(G.add(ee.mult(ut(un))).mult(Ln));return pt.setLocationAtPoint(pt.renderWorldCopies?en.wrap():en,ie),pt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),pt};if(a.preloadOnly){const pt=this._emulate(Dt,a.duration,_);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=xt,this._pitching=We,this._padding=lt,this._prepareEase(f,!1),this._ease(Dt(_),()=>this._afterEase(f),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,f)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,f,_){!1===_.animate||0===_.duration?(a(1),f()):(this._easeStart=u.exported.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=u.wrap(a,-180,180);const _=Math.abs(a-f);return Math.abs(a-360-f)<_&&(a-=360),Math.abs(a+360-f)<_&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const _=a.lng-f.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&u.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,_){const b=Math.ceil(15*f/1e3),E=[],I=a(_.clone());for(let A=0;A<=b;A++){const R=I(A/b);E.push(R.clone())}return E}}class Qt{constructor(a={}){this.options=a,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Re("button","mapboxgl-ctrl-attrib-button",this._container),Re("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Re("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===f&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const _=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",_),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(a){const _=f.reduce((b,E,I)=>(E.value&&(b+=`${E.key}=${E.value}${I<f.length-1?"&":""}`),b),"?");a.href=`${u.config.FEEDBACK_URL}/${_}#${jl(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style._sourceCaches;for(const b in f){const E=f[b];if(E.used){const I=E.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((b,E)=>b.length-E.length),a=a.filter((b,E)=>{for(let I=E+1;I<a.length;I++)if(a[I].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class mp{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Re("div","mapboxgl-ctrl");const f=Re("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const f in a){const _=a[f].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class gp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const b of _)if(b.id===a)return void(b.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function $u(m,a,f){if(m=new u.LngLat(m.lng,m.lat),a){const _=new u.LngLat(m.lng-360,m.lat),b=new u.LngLat(m.lng+360,m.lat),E=360*Math.ceil(Math.abs(m.lng-f.center.lng)/360),I=f.locationPoint(m).distSqr(a),A=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(_).distSqr(a)<I&&(A||Math.abs(_.lng-f.center.lng)<E)?m=_:f.locationPoint(b).distSqr(a)<I&&(A||Math.abs(b.lng-f.center.lng)<E)&&(m=b)}for(;Math.abs(m.lng-f.center.lng)>180;){const _=f.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=f.width&&_.y<=f.height)break;m.lng>f.center.lng?m.lng-=360:m.lng+=360}return m}const iu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gt extends u.Evented{constructor(a,f){if(super(),(a instanceof u.window.HTMLElement||f)&&(a=u.extend({element:a},f)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=u.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Re("div");const b=41,E=27,I=yt("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),A=yt("radialGradient",{id:"shadowGradient"},yt("defs",{},I));yt("stop",{offset:"10%","stop-opacity":.4},A),yt("stop",{offset:"100%","stop-opacity":.05},A),yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=u.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in iu)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=u.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,_=a.charCode||a.keyCode;"Space"!==f&&"Enter"!==f&&32!==_&&13!==_||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,_=this._element;this._popup&&(f===_||_.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const _=a.unproject(f),b=a.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(_)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(f);let b;a._showingGlobe()&&u.isLngLatBehindGlobe(a.transform,this._lngLat)?b=0:(b=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${iu[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${f.x}px,${f.y}px)\n        `}_calculateXYTransform(){const a=this._pos,f=this._map,_=this.getPitchAlignment();if(!f||!a||"map"!==_)return"";if(!f._showingGlobe()){const R=f.getPitch();return R?`rotateX(${R}deg)`:""}const b=u.radToDeg(u.globeTiltAtLngLat(f.transform,this._lngLat)),E=a.sub(u.globeCenterToScreenPoint(f.transform)),I=Math.abs(E.x)+Math.abs(E.y);if(0===I)return"";const A=b/I;return`rotateX(${-E.y*A}deg) rotateY(${E.x*A}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let _=0;const b=this.getRotationAlignment();if("map"===b)if(f._showingGlobe()){const E=f.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=f.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);_=u.radToDeg(Math.atan2(I.y,I.x))-90}else _=-f.getBearing();else if("horizon"===b){const E=u.smoothstep(4,6,f.getZoom()),I=u.globeCenterToScreenPoint(f.transform);I.y+=E*f.transform.height;const A=a.sub(I),R=u.radToDeg(Math.atan2(A.y,A.x));_=(R>90?R-270:R+90)*(1-E)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){u.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=$u(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),!0===a?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=u.Point.convert(a),this._update(),this}_onMove(a){const f=this._map;if(!f)return;const _=this._pointerdownPos,b=this._positionDelta;if(_&&b){if(!this._isDragging){const E=this._clickTolerance||f._clickTolerance;if(a.point.dist(_)<E)return;this._isDragging=!0}this._pos=a.point.sub(b),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,_=this._pos;f&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const _p={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ly=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ag(m=new u.Point(0,0),a="bottom"){if("number"==typeof m){const f=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new u.Point(0,m);case"top-left":return new u.Point(f,f);case"top-right":return new u.Point(-f,f);case"bottom":return new u.Point(0,-m);case"bottom-left":return new u.Point(f,-f);case"bottom-right":return new u.Point(-f,-f);case"left":return new u.Point(m,0);case"right":return new u.Point(-m,0)}return new u.Point(0,0)}return m instanceof u.Point||Array.isArray(m)?u.Point.convert(m):u.Point.convert(m[a]||[0,0])}class yp{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=u.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,_){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+_}}const Kd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Jd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},ky={showCompass:!0,showZoom:!0,visualizePitch:!1};class Oy{constructor(a,f,_=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Qs({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new Cs({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),Ft()}move(a,f){const _=this.map,b=this.mouseRotate.mousemoveWindow(a,f),E=b&&b.bearingDelta;if(E&&_.setBearing(_.getBearing()+E),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,f),A=I&&I.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ot(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(u.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),bt(this.element,a)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,bt(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ge(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=Ge(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},pl={maxWidth:100,unit:"metric"},za={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Hu={version:u.version,supported:Ie,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends Yd{constructor(m){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(m=u.extend({},Jd,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(m.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Oa(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new gp,this._domRenderTaskQueue=new gp,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},Kd,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new yp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=u.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Fa(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new hl("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,u.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Qt({customAttribution:m.customAttribution})),this._logoControl=new mp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new u.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new u.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(m,a){if(void 0===a&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[a];return-1!==a.indexOf("bottom")?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new u.Event("movestart",m)).fire(new u.Event("move",m)),this.fire(new u.Event("resize",m)),a&&this.fire(new u.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(u.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?u.window.navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(a=>"auto"===a?u.window.navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,a=m.projection.name;let f;"globe"===a&&m.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),f=!0):"mercator"===a&&m.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;if(a="globe"===m.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(u.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(u.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,f){if("mouseenter"===m||"mouseover"===m){let _=!1;const b=I=>{const A=a.filter(B=>this.getLayer(B)),R=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];R.length?_||(_=!0,f.call(this,new U(m,this,I.originalEvent,{features:R}))):_=!1},E=()=>{_=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:b,mouseout:E}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const b=I=>{const A=a.filter(R=>this.getLayer(R));(A.length?this.queryRenderedFeatures(I.point,{layers:A}):[]).length?_=!0:_&&(_=!1,f.call(this,new U(m,this,I.originalEvent)))},E=I=>{_&&(_=!1,f.call(this,new U(m,this,I.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:b,mouseout:E}}}{const _=b=>{const E=a.filter(A=>this.getLayer(A)),I=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];I.length&&(b.features=I,f.call(this,b),delete b.features)};return{layers:new Set(a),listener:f,delegates:{[m]:_}}}}on(m,a,f){if(void 0===f)return super.on(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,a,f){if(void 0===f)return super.once(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,f);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,a,f){if(void 0===f)return super.off(m,a);a=new Set(Array.isArray(a)?a:[a]);const _=(E,I)=>{if(E.size!==I.size)return!1;for(const A of E)if(!I.has(A))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(E=>{for(let I=0;I<E.length;I++){const A=E[I];if(A.listener===f&&_(A.layers,a)){for(const R in A.delegates)this.off(R,A.delegates[R]);return E.splice(I,1),this}}})(b),this}queryRenderedFeatures(m,a){return this.style?(void 0!==a||void 0===m||m instanceof u.Point||Array.isArray(m)||(a=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(m,a){return this.style.querySourceFeatures(m,a)}isPointOnSurface(m){const{name:a}=this.transform.projection;return"globe"!==a&&"mercator"!==a&&u.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(u.Point.convert(m))}setStyle(m,a){return!1!==(a=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(null==a)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new jt(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new jt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,a){if("string"==typeof m){const f=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(f,u.ResourceType.Style);u.getJSON(_,(b,E)=>{b?this.fire(new u.ErrorEvent(b)):E&&this._updateDiff(E,a)})}else"object"==typeof m&&this._updateDiff(m,a)}_updateDiff(m,a){try{this.style.setState(m)&&this._update(!0)}catch(f){u.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(m,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(m,a){return this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const a in m){const f=m[a]._tiles;for(const _ in f){const b=f[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(m,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,f)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,a,{pixelRatio:f=1,sdf:_=!1,stretchX:b,stretchY:E,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap){const{width:A,height:R,data:B}=u.exported.getImageData(a);this.style.addImage(m,{data:new u.RGBAImage({width:A,height:R},B),pixelRatio:f,stretchX:b,stretchY:E,content:I,sdf:_,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=a,B=a;this.style.addImage(m,{data:new u.RGBAImage({width:A,height:R},new Uint8Array(B.data)),pixelRatio:f,stretchX:b,stretchY:E,content:I,sdf:_,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,a){const f=this.style.getImage(m);if(!f)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap?u.exported.getImageData(a):a,{width:b,height:E}=_;void 0!==b&&void 0!==E?b===f.data.width&&E===f.data.height?(f.data.replace(_.data,!(a instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&a instanceof u.window.ImageBitmap)),this.style.updateImage(m,f)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})\n                must be that same as the previous version of the image\n                (${f.data.width}, ${f.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){u.getImage(this._requestManager.transformRequest(m,u.ResourceType.Image),(f,_)=>{a(f,_ instanceof u.window.HTMLImageElement?u.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,a){return this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)}moveLayer(m,a){return this.style.moveLayer(m,a),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,a,f){return this.style.setLayerZoomRange(m,a,f),this._update(!0)}setFilter(m,a,f={}){return this.style.setFilter(m,a,f),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,a,f,_={}){return this.style.setPaintProperty(m,a,f,_),this._update(!0)}getPaintProperty(m,a){return this.style.getPaintProperty(m,a)}setLayoutProperty(m,a,f,_={}){return this.style.setLayoutProperty(m,a,f,_),this._update(!0)}getLayoutProperty(m,a){return this.style.getLayoutProperty(m,a)}setLight(m,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(m),this.transform):0}setFeatureState(m,a){return this.style.setFeatureState(m,a),this._update()}removeFeatureState(m,a){return this.style.removeFeatureState(m,a),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,_,b,E=this._container;for(;E&&(!_||!b);){const I=u.window.getComputedStyle(E).transform;I&&"none"!==I&&(f=I.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&"0"!==f[0]&&"1"!==f[0]&&(_=f[0]),f[3]&&"0"!==f[3]&&"1"!==f[3]&&(b=f[3])),E=E.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=b?Math.abs(a/b):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Re("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Re("div","mapboxgl-canvas-container",m);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Re("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=Re("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=Re("div",`mapboxgl-ctrl-${b}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const f=u.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(m),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);-1!==a&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const m=u.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",m),f=a||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);f?(this._useWebGL2&&!a&&u.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),u.storeAuthState(f,!0),this.painter=new ll(f,this.transform,!!a),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(f)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;const f=this.painter.context.extTimerQuery,_=u.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,B=u.exported.now(),z=new u.EvaluationParameters(A,{now:B,fadeDuration:b,pitch:R,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const A=u.exported.now()-_;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout(()=>{const R=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new u.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),u.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new u.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(E=this._updateAverageElevation(_,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const f=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&f(0);if((a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const I=Math.abs(_-b);if(I>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),f(b);this._averageElevation.easeTo(b,m,300)}else if(I>1e-4)return this._averageElevation.jumpTo(b),f(b)}return!!this._averageElevation.isEasing(m)&&f(this._averageElevation.getValue(m))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===u.AUTH_ERR_MSG||401===m.status)){const a=this.painter.context.gl;u.storeAuthState(a,!1),this._logoControl instanceof mp&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,_=f.createFramebuffer();function b(E){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,E,0);const I=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,I),I}return f.bindFramebuffer(f.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),a.canvasCopies.map(b),a.timeStamps)}_canvasPixelComparison(m,a,f){let _=f[1]-f[0];const b=m.length/4;for(let E=0;E<a.length;E++){const I=a[E];let A=0;for(let R=0;R<I.length;R+=4)I[R]===m[R]&&I[R+1]===m[R+1]&&I[R+2]===m[R+2]&&I[R+3]===m[R+3]&&(A+=1);_+=(f[E+2]-f[E+1])*(1-A/b)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1),u.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=u.exported.frame(a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)}))}_preloadTiles(m){const a=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(a,(f,_)=>f._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===u.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,a){u.setCacheLimits(m,a)}get version(){return u.version}},NavigationControl:class{constructor(m){this.options=u.extend({},ky,m),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Re("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Re("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))}),this._compassIcon=Re("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),f=a===m.getMaxZoom(),_=a===m.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oy(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const f=Re("button",m,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(m,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",f),m.firstElementChild&&m.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends u.Evented{constructor(m){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},vp,m),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Na(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,m(f)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(f=>a("denied"!==f.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),f=m.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",m)),this._finish()}}_updateCamera(m){const a=new u.LngLat(m.coords.longitude,m.coords.latitude),f=m.coords.accuracy,_=this._map.getBearing(),b=u.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),b,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new u.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=u.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Re("button","mapboxgl-ctrl-geolocate",this._container),Re("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Re("div","mapboxgl-user-location"),this._dotElement.appendChild(Re("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Re("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Re("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qt,ScaleControl:class{constructor(m){this.options=u.extend({},pl,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,_=a._containerWidth/2-m/2,b=a.unproject([_,f]),E=a.unproject([_+m,f]),I=b.distanceTo(E);if("imperial"===this.options.unit){const A=3.2808*I;A>5280?this._setScale(m,A/5280,"mile"):this._setScale(m,A,"foot")}else"nautical"===this.options.unit?this._setScale(m,I/1852,"nautical-mile"):I>=1e3?this._setScale(m,I/1e3,"kilometer"):this._setScale(m,I,"meter")}_setScale(m,a,f){this._map._requestDomTask(()=>{const _=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let A=E/I;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(R){const B=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*B)/B}(A),I*A}(a),b=_/a;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==f?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(_):`${_}&nbsp;${za[f]}`,this._container.style.width=m*b+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof u.window.HTMLElement?this._container=m.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Re("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Re("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(m){super(),this.options=u.extend(Object.create(_p),m),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=u.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(u.window.document.createTextNode(m))}setHTML(m){const a=u.window.document.createDocumentFragment(),f=u.window.document.createElement("body");let _;for(f.innerHTML=m;_=f.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Re("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const f=this._closeButton=Re("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,_=this._pos;if(!a||!f||!_)return"bottom";const b=f.offsetWidth,E=f.offsetHeight,I=_.x<b/2,A=_.x>a.transform.width-b/2;if(_.y+m<E)return I?"top-left":A?"top-right":"top";if(_.y>a.transform.height-E){if(I)return"bottom-left";if(A)return"bottom-right"}return I?"left":A?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let _=this._container;if(_||(_=this._container=Re("div","mapboxgl-popup",a.getContainer()),this._tip=Re("div","mapboxgl-popup-tip",_),_.appendChild(f)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$u(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m?m:a.project(this._lngLat),E=ag(this.options.offset),I=this._anchor=this._getAnchor(E.y),A=ag(this.options.offset,I),R=b.add(A).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${iu[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&a._showingGlobe()){const b=u.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Ly);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Gt,Style:jt,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.Point,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:cl,Evented:u.Evented,config:u.config,prewarm:function(){Ea().acquire(jo)},clearPrewarmedResources:function(){const m=Mr;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(jo),Mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(m){u.config.ACCESS_TOKEN=m},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(m){u.config.API_URL=m},get workerCount(){return Lr.workerCount},set workerCount(m){Lr.workerCount=m},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){u.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){u.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return Hu}),gt}()},681:function(Zt){var gt;gt=function(){var qt="",ve=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function gt(Ie){return Ie.match(ve)||[]}function Me(Ie){return{language:(Ie=gt(Ie))[1]||qt,extlang:Ie[2]||qt,script:Ie[3]||qt,region:Ie[4]||qt}}function u(Ie,Le,Ae){Object.defineProperty(Ie,Le,{value:Ae,enumerable:!0})}function Q(Ie,Le,Ae){function Re(yt){return gt(yt)[Ie]||qt}u(Re,"pattern",Le),u(Me,Ae,Re)}return Q(1,/^[a-zA-Z]{2,3}$/,"language"),Q(2,/^[a-zA-Z]{3}$/,"extlang"),Q(3,/^[a-zA-Z]{4}$/,"script"),Q(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),u(Me,"split",function Ue(Ie){return gt(Ie).filter(function(Le,Ae){return Le&&Ae})}),Me},Zt.exports?Zt.exports=gt():this.subtag=gt()},28:(Zt,qt,ve)=>{"use strict";var gt=ve(603);Zt.exports=gt,typeof window<"u"&&(window.Suggestions=gt)},331:Zt=>{"use strict";var qt=function(ve){return this.component=ve,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,ve.el.parentNode.insertBefore(this.wrapper,ve.el.nextSibling),this};qt.prototype.show=function(){this.element.style.display="block"},qt.prototype.hide=function(){this.element.style.display="none"},qt.prototype.add=function(ve){this.items.push(ve)},qt.prototype.clear=function(){this.items=[],this.active=0},qt.prototype.isEmpty=function(){return!this.items.length},qt.prototype.isVisible=function(){return"block"===this.element.style.display},qt.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var ve=0;ve<this.items.length;ve++)this.drawItem(this.items[ve],this.active===ve);this.show()}else this.hide()},qt.prototype.drawItem=function(ve,gt){var Ue=document.createElement("li"),Me=document.createElement("a");gt&&(Ue.className+=" active"),Me.innerHTML=ve.string,Ue.appendChild(Me),this.element.appendChild(Ue),Ue.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Ue.addEventListener("mouseup",function(){this.handleMouseUp.call(this,ve)}.bind(this))},qt.prototype.handleMouseUp=function(ve){this.selectingListItem=!1,this.component.value(ve.original),this.clear(),this.draw()},qt.prototype.move=function(ve){this.active=ve,this.draw()},qt.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},qt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},qt.prototype.drawError=function(ve){var gt=document.createElement("li");gt.innerHTML=ve,this.element.appendChild(gt),this.show()},Zt.exports=qt},603:(Zt,qt,ve)=>{"use strict";var gt=ve(498),Ue=ve(424),Me=ve(331),u=function(Q,Ie,Le){return this.options=gt({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Le=Le||{}),this.el=Q,this.data=Ie||[],this.list=new Me(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(Ae){this.handleKeyUp(Ae.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(Ae){this.handleKeyDown(Ae)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(Ae){this.handlePaste(Ae)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};u.prototype.handleKeyUp=function(Q){40===Q||38===Q||27===Q||13===Q||9===Q||this.handleInputChange(this.el.value)},u.prototype.handleKeyDown=function(Q){switch(Q.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&Q.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},u.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},u.prototype.handlePaste=function(Q){if(Q.clipboardData)this.handleInputChange(Q.clipboardData.getData("Text"));else{var Ie=this;setTimeout(function(){Ie.handleInputChange(Q.target.value)},100)}},u.prototype.handleInputChange=function(Q){this.query=this.normalize(Q),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Ie){for(var Le=0;Le<Ie.length&&(this.list.add(Ie[Le]),Le!==this.options.limit-1);Le++);this.list.draw()}.bind(this))},u.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},u.prototype.update=function(Q){this.data=Q,this.handleKeyUp()},u.prototype.clear=function(){this.data=[],this.list.clear()},u.prototype.normalize=function(Q){return Q.toLowerCase()},u.prototype.match=function(Q,Ie){return Q.indexOf(Ie)>-1},u.prototype.value=function(Q){if(this.selected=Q,this.el.value=this.getItemValue(Q),document.createEvent){var Ie=document.createEvent("HTMLEvents");Ie.initEvent("change",!0,!1),this.el.dispatchEvent(Ie)}else this.el.fireEvent("onchange")},u.prototype.getCandidates=function(Q){var Ie={pre:"<strong>",post:"</strong>",extract:function(Ae){return this.getItemValue(Ae)}.bind(this)};Q(this.options.filter?Ue.filter(this.query,this.data,Ie).map(function(Ae){return{original:Ae.original,string:this.render(Ae.original,Ae.string)}}.bind(this)):this.data.map(function(Ae){return{original:Ae,string:this.render(Ae)}}.bind(this)))},u.prototype.getItemValue=function(Q){return Q},u.prototype.render=function(Q,Ie){if(Ie)return Ie;for(var Le=this.getItemValue(Q.original?Q.original:Q),Ae=this.normalize(Le),Re=Ae.lastIndexOf(this.query);Re>-1;){var yt=Re+this.query.length;Le=Le.slice(0,Re)+"<strong>"+Le.slice(Re,yt)+"</strong>"+Le.slice(yt),Re=Ae.slice(0,Re).lastIndexOf(this.query)}return Le},u.prototype.renderError=function(Q){this.list.drawError(Q)},Zt.exports=u},498:Zt=>{Zt.exports=function ve(){for(var gt={},Ue=0;Ue<arguments.length;Ue++){var Me=arguments[Ue];for(var u in Me)qt.call(Me,u)&&(gt[u]=Me[u])}return gt};var qt=Object.prototype.hasOwnProperty},630:(Zt,qt,ve)=>{"use strict";ve.d(qt,{x0:()=>u});let u=(Q=21)=>crypto.getRandomValues(new Uint8Array(Q)).reduce((Ie,Le)=>Ie+((Le&=63)<36?Le.toString(36):Le<62?(Le-26).toString(36).toUpperCase():Le>62?"-":"_"),"")}},Zt=>{Zt(Zt.s=540)}]);